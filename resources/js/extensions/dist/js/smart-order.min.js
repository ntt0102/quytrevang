class Config {
    appName = "SmartOrder";
    version = "2.0.2";
    publishDate = "17/03/2023";
    developer = "Tho PS";
    domain = "https://quytrevang.nguyenvanxuanphu.com";
    domain1 = "http://localhost";
    endpoint = {
        socket: "https://datafeed.vps.com.vn",
        getConfig: "/api/so/get-config",
        setConfig: "/api/so/set-config",
        getBackground: "/api/so/background",
        getChart: "/api/so/get-chart",
        report: "/api/so/report",
        register: "/api/auth/create-account",
        login: "/api/auth/login",
        logout: "/api/auth/logout",
        user: "/api/auth/so/user"
    };
    timeFrames = [
        { text: "Tick", value: 0 },
        { text: "1 min", value: 1 },
        { text: "2 min", value: 2 },
        { text: "3 min", value: 3 },
        { text: "5 min", value: 5 },
        { text: "7 min", value: 7 },
        { text: "10 min", value: 10 },
        { text: "15 min", value: 15 },
        { text: "30 min", value: 30 },
        { text: "1 day", value: 1440 }
    ];
    chartTypes = [
        { text: "Nến", value: "candlestick" },
        { text: "Đường", value: "line" },
        { text: "Thanh", value: "bar" }
    ];
}

class Alert {
    // Hàm khởi tạo
    constructor() {}
    // Các phương thức
    show = (
        status = "success",
        text = "message",
        autoclose = true,
        keep = false
    ) => {
        this.notify = new Notify({
            status: status,
            text: text,
            autoclose: autoclose,
            position: "right bottom"
        });
        this.keep = keep;
    };
    hide = () =>
        new Promise(resolve => {
            if (!this.keep) this.notify.close();
            else this.keep = false;
            setTimeout(() => resolve(), 500);
        });
}

class Crypto {
    key = "19AqVgG36ekVzc1HyEmE9vfA7PH78DFCwhdwUxJ7dns=";
    // Hàm khởi tạo
    constructor() {
        this.format = this.formatCrypto();
    }
    // Các phương thức
    formatCrypto = () => {
        return {
            stringify: cipherParams => {
                var j = {
                    ct: cipherParams.ciphertext.toString(CryptoJS.enc.Base64)
                };
                if (cipherParams.iv) j.iv = cipherParams.iv.toString();
                if (cipherParams.salt) j.s = cipherParams.salt.toString();
                return JSON.stringify(j);
            },
            parse: jsonStr => {
                var j = JSON.parse(jsonStr);
                var cipherParams = CryptoJS.lib.CipherParams.create({
                    ciphertext: CryptoJS.enc.Base64.parse(j.ct)
                });
                if (j.iv) cipherParams.iv = CryptoJS.enc.Hex.parse(j.iv);
                if (j.s) cipherParams.salt = CryptoJS.enc.Hex.parse(j.s);
                return cipherParams;
            }
        };
    };
    encrypt = text => {
        return CryptoJS.AES.encrypt(JSON.stringify(text), this.key, {
            format: this.format
        }).toString();
    };
    decrypt = encrypted => {
        return JSON.parse(
            CryptoJS.AES.decrypt(JSON.stringify(encrypted), this.key, {
                format: this.format
            }).toString(CryptoJS.enc.Utf8)
        );
    };
}

class Store {
    // Hàm khởi tạo
    constructor() {
        this.create();
    }

    // Các phương thức
    create = () => {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open("vpsDB", 1);
            request.onupgradeneeded = e => {
                console.log("onupgradeneeded");
                this.store = e.target.result;
                this.store.createObjectStore("data", { keyPath: "time" });
                this.store.createObjectStore("order", { keyPath: "kind" });
                this.store.createObjectStore("marker", { keyPath: "time" });
                this.store.createObjectStore("line", { keyPath: "price" });
                this.store.createObjectStore("ruler", { keyPath: "point" });
                this.store.createObjectStore("alert", { keyPath: "price" });
                resolve();
            };
            request.onsuccess = e => {
                console.log("onsuccess");
                this.store = e.target.result;
                resolve();
            };
            request.onerror = () => {
                console.log("onerror");
                location.reload();
                reject();
            };
        });
    };
    get = tables => {
        var database = this.store;
        return new Promise(function(resolve, reject) {
            var tx = database.transaction(tables, "readonly");
            if (Array.isArray(tables)) {
                var stores = tables.map(table => tx.objectStore(table));
                var promises = stores.map(loadStore);
                Promise.all(promises).then(arr => resolve(arr));
            } else {
                var store = tx.objectStore(tables);
                loadStore(store).then(d => resolve(d));
            }
        });

        function loadStore(store) {
            return new Promise(function(resolve, reject) {
                const request = store.getAll();
                request.onsuccess = e => resolve(e.target.result);
                request.onerror = () => reject();
            });
        }
    };
    set = (table, data) => {
        const store = this.store
            .transaction(table, "readwrite")
            .objectStore(table);
        if (Array.isArray(data)) {
            if (data.length > 0) data.forEach(item => store.put(item));
        } else store.put(data);
    };
    clear = table => {
        var database = this.store;
        return new Promise(function(resolve, reject) {
            const request = database
                .transaction(table, "readwrite")
                .objectStore(table)
                .clear();

            request.onsuccess = () => {
                resolve();
            };

            request.onerror = err => {
                console.error(`Error to empty Object Store: ${table}`);
                reject();
            };
        });
    };
}

class Chart {
    // Các thuộc tính
    chart = {};
    series = {};
    data = { original: [], price: [], volume: [] };
    order = { entry: {}, tp: {}, sl: {} };
    lines = [];
    makers = [];
    ruler = { start: {}, end: {}, point: 0 };
    alerts = [];
    crosshair = {};
    hasCrosshair = false;
    hasNewData = false;
    alertAudio = new Audio(chrome.runtime.getURL("alert.wav"));
    UP_COLOR = "rgb(38,166,154)";
    DOWN_COLOR = "rgb(239,83,80)";

    // Hàm khởi tạo
    constructor(global, callback) {
        this.global = global;
        this.callback = callback;
        this.global.toggleSpinner = this.toggleSpinner;
        this.global.isInSession = this.isInSession;
        this.alertAudio.loop = true;
    }

    // Các phương thức
    create = () => {
        this.timeFrame = this.global.timeFrame;
        this.chartType = this.global.chartType;
        this.createContainerElement();
        this.createChart();
        this.createDataArea();
        this.createToolArea();
        this.createLegendArea();
        this.createFreeArea();
        if (this.global.isOpeningMarket) {
            this.secInterval = setInterval(
                () => this.secIntervalHandler(this),
                1000
            );
            this.minInterval = setInterval(
                () => this.minIntervalHandler(this),
                60000
            );
        }
        window.addEventListener("resize", () => this.eventChartResize(this));
        window.addEventListener("keydown", e => this.eventKeyPress(e, this));
    };
    remove = () => {
        window.removeEventListener("resize", () => this.eventChartResize(this));
        window.removeEventListener("keydown", e => this.eventKeyPress(e, this));
        clearInterval(this.secInterval);
        clearInterval(this.minInterval);
        //
        this.containerElement.remove();
    };
    createContainerElement = () => {
        var container = document.createElement("div");
        document.body.append(container);
        container.id = "lightWeightChartContainer";
        container.style.width = "100vw";
        container.style.height = "100vh";
        //
        var chartContainer = document.createElement("div");
        container.prepend(chartContainer);
        chartContainer.style.width = "100%";
        chartContainer.style.height = "100%";
        chartContainer.addEventListener("contextmenu", e =>
            this.eventChartContextmenu(e, this)
        );
        chartContainer.addEventListener("click", e =>
            this.eventChartClick(e, this)
        );
        this.containerElement = container;
        this.chartContainerElement = chartContainer;
    };
    createChart = () => {
        const chartOptions = {
            localization: { dateFormat: "dd/MM/yyyy", locale: "vi-VN" },
            rightPriceScale: {
                visible: true,
                scaleMargins: this.global.isVolume
                    ? { top: 0.1, bottom: 0.21 }
                    : { top: 0.2, bottom: 0.1 }
            },
            leftPriceScale: { visible: false },
            layout: {
                backgroundColor: "#000000",
                textColor: "#CCCCCC"
            },
            grid: {
                vertLines: {
                    color: "#1B1E27",
                    style: LightweightCharts.LineStyle.Dashed
                },
                horzLines: {
                    color: "#1B1E27",
                    style: LightweightCharts.LineStyle.Dashed
                }
            },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: {
                timeVisible: true,
                rightOffset: 20,
                minBarSpacing: 0.1
            }
        };
        this.chart = LightweightCharts.createChart(
            this.chartContainerElement,
            chartOptions
        );
        this.chart.subscribeCrosshairMove(e =>
            this.eventChartCrosshairMove(e, this)
        );
        this.chart.subscribeCustomPriceLineDragged(e =>
            this.eventPriceLineDrag(e, this)
        );
        //
        this.series.volume = this.chart.addHistogramSeries({
            priceScaleId: "volume",
            priceFormat: { type: "volume" },
            scaleMargins: { top: 0.8, bottom: 0 },
            visible: this.global.isVolume
        });
        //
        this.createPriceSeries();
        this.chart.timeScale().fitContent();
    };
    createPriceSeries = () => {
        switch (this.chartType) {
            case "candlestick":
                this.series.price = this.chart.addCandlestickSeries({
                    priceFormat: { minMove: 0.1 }
                });
                break;
            case "line":
                this.series.price = this.chart.addLineSeries({
                    color: "#CCCCCC",
                    priceFormat: { minMove: 0.1 }
                });
                break;
            case "bar":
                this.series.price = this.chart.addBarSeries({
                    thinBars: false,
                    priceFormat: { minMove: 0.1 }
                });
                break;
        }
    };
    createDataArea = () => {
        var container = document.createElement("div");
        container.id = "dataAreaDiv";
        container.className = "area";
        this.containerElement.append(container);
        //
        var img = document.createElement("img");
        img.id = "spinnerImg";
        img.style.opacity = 0;
        img.src = chrome.runtime.getURL("spinner.gif");
        container.append(img);
        this.spinnerImg = img;
        //
        var input = document.createElement("input");
        input.id = "dateInput";
        input.type = "date";
        input.value = moment().format("YYYY-MM-DD");
        input.className = "command";
        input.title = "Dữ liệu của ngày";
        input.addEventListener("change", e => {
            if (!!e.target.value) this.loadChartData();
        });
        container.append(input);
        this.dateInput = input;
        //
        var select = document.createElement("select");
        select.id = "chartTypeSelect";
        select.className = "command";
        select.title = "Loại biểu đồ giá";
        this.global.chartTypes.forEach((item, index) => {
            var option = document.createElement("option");
            option.value = item.value;
            option.text = item.text;
            select.appendChild(option);
        });
        select.value = this.chartType;
        select.addEventListener("change", e => {
            if (this.timeFrame == 0 && e.target.value != "line") {
                this.chartTypeSelect.value = "line";
                this.global.alert.show(
                    "warning",
                    "Chỉ có thể mở biểu đồ Đường trong khung thời gian Tick."
                );
                return false;
            }
            this.chartType = e.target.value;
            this.chart.remove();
            this.createChart();
            this.series.price.setData(this.data.price);
            this.series.volume.setData(this.data.volume);
            this.getToolsData();
        });
        container.append(select);
        this.chartTypeSelect = select;
        //
        var select = document.createElement("select");
        select.id = "timeFrameSelect";
        select.className = "command";
        select.title = "Khung thời gian [Ctrl+0]";
        this.global.timeFrames.forEach((item, index) => {
            var option = document.createElement("option");
            option.value = item.value;
            option.text = item.text;
            select.appendChild(option);
        });
        select.value = this.timeFrame;
        select.addEventListener("change", e => {
            this.timeFrame = e.target.value;
            this.loadChartData().then(() =>
                this.chart.timeScale().resetTimeScale()
            );
            if (this.timeFrame == 0 && this.chartType != "line") {
                this.chartTypeSelect.value = "line";
                this.chartTypeSelect.dispatchEvent(new Event("change"));
            }
        });
        container.append(select);
        this.timeFrameSelect = select;
        //
        var button = document.createElement("div");
        button.className = "command fa fa-refresh";
        button.title = "Làm mới [Ctrl+M]";
        button.addEventListener("click", () => this.loadChartData());
        container.append(button);
        this.refreshButton = button;
        //
        var button = document.createElement("div");
        button.className = "command fa fa-trash";
        button.title = "Xoá ngày khác [Ctrl+,]";
        button.addEventListener("click", () => {
            this.global.store.clear("data");
            this.loadChartData();
        });
        container.append(button);
        this.clearButton = button;
    };
    createToolArea = () => {
        var container = document.createElement("div");
        container.id = "toolAreaDiv";
        container.className = "area";
        this.containerElement.append(container);
        //
        var button = document.createElement("div");
        button.className = "command fa fa-minus";
        button.title = "Vẽ đường ngang [Ctrl+K][Ctrl+Shift+K]";
        button.addEventListener("click", e => {
            const selected = e.target.classList.contains("selected");
            document
                .querySelectorAll("#toolAreaDiv > .command")
                .forEach(el => el.classList.remove("selected"));
            if (!selected) e.target.classList.add("selected");
            e.stopPropagation();
        });
        button.addEventListener("contextmenu", e => {
            this.removeHorizontalLine();
            e.target.classList.remove("selected");
            e.preventDefault();
            e.stopPropagation();
        });
        container.append(button);
        this.drawLineButton = button;
        //
        var button = document.createElement("div");
        button.className = "command fa fa-map-marker";
        button.title = "Vẽ đánh dấu [Ctrl+L][Ctrl+Shift+L]";
        button.addEventListener("click", e => {
            const selected = e.target.classList.contains("selected");
            document
                .querySelectorAll("#toolAreaDiv > .command")
                .forEach(el => el.classList.remove("selected"));
            if (!selected) e.target.classList.add("selected");
            e.stopPropagation();
        });
        button.addEventListener("contextmenu", e => {
            this.removeMaker();
            e.target.classList.remove("selected");
            e.preventDefault();
            e.stopPropagation();
        });
        container.append(button);
        this.drawMarkerButton = button;
        //
        var button = document.createElement("div");
        button.className = "command fa fa-arrows-v";
        button.title = "Thước đo giá [Ctrl+;][Ctrl+Shift+;]";
        button.addEventListener("click", e => {
            const selected = e.target.classList.contains("selected");
            document
                .querySelectorAll("#toolAreaDiv > .command")
                .forEach(el => el.classList.remove("selected"));
            if (!selected) {
                e.target.classList.add("selected");
                this.removeRuler();
            }
            e.stopPropagation();
        });
        button.addEventListener("contextmenu", e => {
            this.removeRuler();
            e.target.classList.remove("selected");
            e.preventDefault();
            e.stopPropagation();
        });
        container.append(button);
        this.drawRulerButton = button;
        //
        var button = document.createElement("div");
        button.className = "command fa fa-bell-o";
        button.title = "Đặt cảnh báo [Ctrl+'][Ctrl+Shift+']";
        button.addEventListener("click", e => {
            const selected = e.target.classList.contains("selected");
            document
                .querySelectorAll("#toolAreaDiv > .command")
                .forEach(el => el.classList.remove("selected"));
            if (!selected) e.target.classList.add("selected");
            e.stopPropagation();
        });
        button.addEventListener("contextmenu", e => {
            this.removeAlert();
            e.target.classList.remove("selected");
            e.preventDefault();
            e.stopPropagation();
        });
        container.append(button);
        this.drawAlertButton = button;
    };
    createLegendArea = () => {
        var container = document.createElement("div");
        container.id = "legendAreaDiv";
        this.containerElement.append(container);
        //
        var p = document.createElement("p");
        container.append(p);
        this.priceLegendP = p;
        //
        var p = document.createElement("p");
        p.style.display = this.global.isVolume ? "block" : "none";
        container.append(p);
        this.volumeLegendP = p;
    };
    createFreeArea = () => {
        var container = this.containerElement;
        //
        var button = document.createElement("button");
        button.id = "cancelOrderButton";
        button.innerText = "X";
        button.style.display = "none";
        button.addEventListener("click", () => {
            this.callback.closeOrderPositionCallback();
            this.callback.cancelOrderCallback();
            this.toggleCancelOrderButton(false);
            this.removeOrderLine("entry");
            this.removeOrderLine("tp");
            this.removeOrderLine("sl");
            this.global.store.clear("order");
        });
        container.append(button);
        this.cancelOrderButton = button;
        //
        var button = document.createElement("button");
        button.id = "entryOrderButton";
        button.innerText = "Entry";
        button.style.display = "none";
        button.addEventListener("click", () => {
            this.callback.orderEntryPriceCallback(this.order);
            this.drawOrderLine("entry");
            this.toggleCancelOrderButton(true);
            this.hideOrderButton();
        });
        container.append(button);
        this.entryOrderButton = button;
        //
        var button = document.createElement("button");
        button.id = "tpslOrderButton";
        button.innerText = "TP/SL";
        button.style.display = "none";
        button.addEventListener("click", () => {
            this.callback.orderTpPriceCallback(this.order, true);
            this.drawOrderLine("tp");
            this.callback.orderSlPriceCallback(this.order, true);
            this.drawOrderLine("sl");
            this.hideOrderButton();
        });
        container.append(button);
        this.tpslOrderButton = button;
        //
        var button = document.createElement("div");
        button.id = "scrollButton";
        button.className = "command fa fa-angle-double-right";
        button.addEventListener("click", () =>
            this.chart.timeScale().scrollToRealTime()
        );
        container.append(button);
    };
    eventChartContextmenu = (e, self) => {
        if (self.global.isSmartPro) self.showOrderButton();
        e.preventDefault();
    };
    eventChartClick = (e, self) => {
        self.hideOrderButton();
        if (self.drawLineButton.classList.contains("selected"))
            self.drawHorizontalLine();
        else if (self.drawMarkerButton.classList.contains("selected"))
            self.drawMaker();
        else if (self.drawRulerButton.classList.contains("selected"))
            self.drawRuler();
        else if (self.drawAlertButton.classList.contains("selected"))
            self.drawAlert();
    };
    eventChartCrosshairMove = (e, self) => {
        if (e.time) {
            var price = e.seriesPrices.get(self.series.price);
            var volume = e.seriesPrices.get(self.series.volume);
            if (!!price && self.chartType != "line") price = price.close;
            self.updateLegend(price, volume);
            self.hasCrosshair = true;
            self.crosshair.time = e.time;
            self.crosshair.price = price;
        } else {
            self.hasCrosshair = false;
            if (!self.global.isMobile) {
                self.crosshair.time = null;
                self.crosshair.price = null;
            }
        }
        if (e.point != undefined) {
            self.crosshair.x = e.point.x;
            self.crosshair.y = e.point.y;
        }
    };
    eventPriceLineDrag = (e, self) => {
        var line = e.customPriceLine;
        var lineOptions = line.options();
        lineOptions.price = self.formatPrice(lineOptions.price);
        const oldPrice = +e.fromPriceString;
        const newPrice = lineOptions.price;
        switch (lineOptions.lineType) {
            case "order":
                if (newPrice != oldPrice) {
                    var isChanged = false;
                    const position = self.callback.getOrderPositionCallback();
                    if (lineOptions.kind == "entry") {
                        if (!position) {
                            isChanged = true;
                            self.order[lineOptions.kind].price = newPrice;
                            self.callback.orderEntryPriceCallback(self.order);
                            self.drawOrderLine(lineOptions.kind);
                        }
                    } else {
                        if (self.order.side * position > 0) {
                            isChanged = true;
                            self.order[lineOptions.kind].price = newPrice;
                            if (lineOptions.kind == "tp")
                                self.callback.orderTpPriceCallback(self.order);
                            else self.callback.orderSlPriceCallback(self.order);
                            self.drawOrderLine(lineOptions.kind);
                        }
                    }
                    //
                    if (!isChanged) {
                        line.applyOptions({ price: oldPrice });
                        self.global.alert.show(
                            "warning",
                            "Không được thay đổi."
                        );
                    }
                }
                break;
            case "line":
                self.global.store.set("line", {
                    price: oldPrice,
                    removed: true
                });
                self.global.store.set("line", lineOptions);
                self.drawLineButton.classList.remove("selected");
                break;
            case "ruler":
                if (lineOptions.point == 1) {
                    self.global.store.set("ruler", lineOptions);
                    if (self.ruler.point == 2) {
                        const distance = +self.ruler.end.options().title;
                        const endPrice = +(newPrice + distance).toFixed(1);
                        self.ruler.end.applyOptions({ price: endPrice });
                        self.global.store.set(
                            "ruler",
                            self.ruler.end.options()
                        );
                    }
                } else {
                    const startPrice = +self.ruler.start.options().price;
                    const distance = (newPrice - startPrice).toFixed(1);
                    line.applyOptions({ title: distance });
                    self.global.store.set("ruler", line.options());
                }
                break;
            case "alert":
                self.alertAudio.pause();
                self.global.store.set("alert", {
                    price: oldPrice,
                    removed: true
                });
                const currentPrice = self.data.price.slice(-1)[0].value;
                var title = newPrice >= currentPrice ? ">" : "<";
                line.applyOptions({ title: title });
                self.global.store.set("alert", line.options());
                self.drawAlertButton.classList.remove("selected");
                break;
        }
    };
    //
    showOrderButton = () => {
        if (this.callback.getOrderPositionCallback()) {
            if (
                this.order.entry.hasOwnProperty("line") &&
                !this.order.tp.hasOwnProperty("line")
            ) {
                this.tpslOrderButton.style.left =
                    +(
                        this.crosshair.x +
                        (this.crosshair.x > innerWidth - 61 ? -61 : 1)
                    ) + "px";
                this.tpslOrderButton.style.top =
                    +(
                        this.crosshair.y +
                        (this.crosshair.y > innerHeight - 51 ? -51 : 1)
                    ) + "px";
                this.tpslOrderButton.style.display = "block";
            }
        } else {
            if (!this.order.entry.hasOwnProperty("line")) {
                const price = this.coordinateToPrice(this.crosshair.y);
                const side =
                    price >= this.data.price.slice(-1)[0].value ? 1 : -1;
                this.order.entry.price = price;
                this.order.side = side;

                this.entryOrderButton.style.left =
                    +(
                        this.crosshair.x +
                        (this.crosshair.x > innerWidth - 71 ? -71 : 1)
                    ) + "px";
                this.entryOrderButton.style.top =
                    +(
                        this.crosshair.y +
                        (this.crosshair.y > innerHeight - 61 ? -61 : 1)
                    ) + "px";
                this.entryOrderButton.style.background =
                    side > 0 ? "green" : "red";
                this.entryOrderButton.innerText = `${
                    side > 0 ? "LONG" : "SHORT"
                } ${price}`;
                this.entryOrderButton.style.display = "block";
            }
        }
    };
    hideOrderButton = () => {
        this.entryOrderButton.style.display = "none";
        this.tpslOrderButton.style.display = "none";
    };
    //
    drawOrderLine = kind => {
        var color, title;
        switch (kind) {
            case "entry":
                color = "silver";
                title = this.order.side > 0 ? "Long" : "Short";
                break;
            case "tp":
                color = "lime";
                title = Math.abs(
                    this.order.tp.price - this.order.entry.price
                ).toFixed(1);
                break;
            case "sl":
                color = "red";
                title = Math.abs(
                    this.order.sl.price - this.order.entry.price
                ).toFixed(1);
                break;
        }
        if (this.order[kind].hasOwnProperty("line")) {
            this.order[kind].line.applyOptions({
                price: this.order[kind].price,
                title: title
            });
        } else {
            this.order[kind].line = this.series.price.createPriceLine({
                lineType: "order",
                kind: kind,
                price: this.order[kind].price,
                color: color,
                lineWidth: 1,
                lineStyle: LightweightCharts.LineStyle.Solid,
                title: title,
                draggable: true
            });
        }
        this.global.store.set("order", {
            kind: kind,
            price: +this.order[kind].price,
            side: this.order.side
        });
    };
    removeOrderLine = kind => {
        if (this.order[kind].hasOwnProperty("line")) {
            this.series.price.removePriceLine(this.order[kind].line);
            delete this.order[kind].line;
        }
    };
    //
    drawHorizontalLine = () => {
        const TYPE = "line";
        const price = this.formatPrice(
            this.coordinateToPrice(this.crosshair.y)
        );
        const existIndex = this.lines.findIndex(line => {
            const ops = line.options();
            return (ops.type = TYPE && +ops.price == price);
        });
        if (existIndex != -1) {
            const removeLine = this.lines.splice(existIndex, 1);
            this.series.price.removePriceLine(removeLine[0]);
            this.global.store.set("line", { price: price, removed: true });
        } else {
            const options = {
                lineType: TYPE,
                price: price,
                color: "aqua",
                lineWidth: 1,
                lineStyle: LightweightCharts.LineStyle.Dotted,
                draggable: true
            };
            this.lines.push(this.series.price.createPriceLine(options));
            this.global.store.set("line", options);
        }
        this.drawLineButton.classList.remove("selected");
    };
    removeHorizontalLine = () => {
        this.lines.forEach(line => this.series.price.removePriceLine(line));
        this.lines = [];
        this.global.store.clear("line");
    };
    //
    drawMaker = () => {
        if (this.crosshair.time) {
            const markers = this.markers.filter(
                item => item.time != this.crosshair.time
            );
            if (markers.length == this.markers.length) {
                const dir =
                    this.crosshair.y >=
                    this.series.price.priceToCoordinate(this.crosshair.price);
                this.markers.push({
                    time: this.crosshair.time,
                    position: dir ? "belowBar" : "aboveBar",
                    color: dir ? "lime" : "red",
                    shape: dir ? "arrowUp" : "arrowDown"
                });
            } else this.markers = markers;
            this.series.price.setMarkers(this.markers);
            this.global.store
                .clear("marker")
                .then(() => this.global.store.set("marker", this.markers));
            //
            this.drawMarkerButton.classList.remove("selected");
        }
    };
    removeMaker = () => {
        this.markers = [];
        this.series.price.setMarkers([]);
        this.global.store.clear("marker");
    };
    //
    drawRuler = () => {
        const price = this.coordinateToPrice(this.crosshair.y);
        var options = {
            lineType: "ruler",
            price: price,
            color: "yellow",
            lineWidth: 1,
            lineStyle: LightweightCharts.LineStyle.Dotted,
            draggable: true
        };
        if (this.ruler.point == 0) {
            const point = 1;
            options.point = point;
            options.title = "0";
            this.ruler.start = this.series.price.createPriceLine(options);
            this.ruler.point = point;
            this.global.store.set("ruler", options);
        } else if (this.ruler.point == 1) {
            const startPrice = +this.ruler.start.options().price;
            const point = 2;
            options.point = point;
            options.title = (price - startPrice).toFixed(1);
            this.ruler.end = this.series.price.createPriceLine(options);
            this.ruler.point = point;
            this.global.store.set("ruler", options);
            this.drawRulerButton.classList.remove("selected");
        }
    };
    removeRuler = () => {
        if (this.ruler.point > 0) {
            this.series.price.removePriceLine(this.ruler.start);
            if (this.ruler.point > 1)
                this.series.price.removePriceLine(this.ruler.end);
            //
            this.ruler = { start: {}, end: {}, point: 0 };
            this.global.store.clear("ruler");
        }
    };
    //
    drawAlert = () => {
        const TYPE = "alert";
        const price = this.formatPrice(
            this.coordinateToPrice(this.crosshair.y)
        );
        const existIndex = this.alerts.findIndex(line => {
            const ops = line.options();
            return (ops.type = TYPE && +ops.price == price);
        });
        if (existIndex != -1) {
            const removeLine = this.alerts.splice(existIndex, 1);
            this.series.price.removePriceLine(removeLine[0]);
            this.global.store.set("alert", { price: price, removed: true });
        } else {
            const options = {
                lineType: TYPE,
                price: price,
                title:
                    price >= this.data.original.slice(-1)[0].price ? ">" : "<",
                color: "#FF00FF",
                lineWidth: 1,
                lineStyle: LightweightCharts.LineStyle.Dotted,
                draggable: true
            };
            this.alerts.push(this.series.price.createPriceLine(options));
            this.global.store.set("alert", options);
        }
        this.drawAlertButton.classList.remove("selected");
        this.alertAudio.pause();
    };
    removeAlert = () => {
        this.alerts.forEach(line => this.series.price.removePriceLine(line));
        this.alerts = [];
        this.global.store.clear("alert");
        this.alertAudio.pause();
    };
    //
    toggleCancelOrderButton = visible => {
        if (visible) {
            this.cancelOrderButton.style.display = "block";
            this.cancelOrderButton.style.background =
                this.order.side > 0 ? "green" : "red";
        } else this.cancelOrderButton.style.display = "none";
    };
    //
    updateLegend = (price, volume) => {
        if (!!price) this.priceLegendP.innerText = price;
        if (!!volume)
            this.volumeLegendP.innerText = volume.toLocaleString("en-US");
    };
    coordinateToPrice = y => {
        return this.formatPrice(this.series.price.coordinateToPrice(y));
    };
    formatPrice = price => {
        return +(+price.toFixed(1));
    };
    //
    loadChartData = () => {
        return new Promise(async (resolve, reject) => {
            this.toggleSpinner(true);
            const svData = await this.getServerData();
            start: while (true) {
                this.hasNewData = false;
                const lcData = await this.global.store.get("data");
                const ids = new Set(svData.map(d => d.time));
                const data = [
                    ...svData,
                    ...lcData.filter(d => !ids.has(d.time))
                ].sort((a, b) => a.time - b.time);
                if (this.hasNewData) continue start;
                this.global.store
                    .clear("data")
                    .then(() => this.global.store.set("data", data));
                //
                this.data = data.reduce(
                    (r, item) => this.generateChartData(r, item),
                    {
                        original: [],
                        price: [],
                        volume: []
                    }
                );
                // console.log("data: ", this.data);
                //
                if (!!this.data.original.length) {
                    this.series.price.setData(this.data.price);
                    this.series.volume.setData(this.data.volume);
                    this.updateLegend(
                        this.data.price.slice(-1)[0].value,
                        this.data.volume.slice(-1)[0].value
                    );
                }
                //
                this.toggleSpinner(false);
                resolve();
                break;
            }
        });
    };
    updateChartData = param => {
        this.hasNewData = true;
        this.data = this.generateChartData(this.data, param);
        const lastPrice = this.data.price.slice(-1)[0];
        const lastVolume = this.data.volume.slice(-1)[0];
        //
        if (this.timeFrame > 0) {
            this.series.price.setData(this.data.price);
            this.series.volume.setData(this.data.volume);
        } else {
            this.series.price.update(lastPrice);
            this.series.volume.update(lastVolume);
        }
        if (!this.hasCrosshair) {
            this.updateLegend(lastPrice.value, lastVolume.value);
        }
        //
        this.global.store.set("data", param);
        this.data.original.push(param);
    };
    getServerData = () => {
        return new Promise(async (resolve, reject) => {
            const date = this.dateInput.value;
            const data = this.global.crypto.encrypt({
                date: date,
                deviceId: this.global.deviceId
            });
            const url = this.global.domain + this.global.endpoint.getChart;
            start: while (true) {
                try {
                    var response = await fetch(url, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${this.global.accessToken}`
                        },
                        body: data
                    });
                    var json = await response.json();
                    json = this.global.crypto.decrypt(json);
                    // console.log("json: ", json);
                    if (!json.isOk) this.callback.alertInvalidAccessCallback();
                    resolve(json.data);
                    break;
                } catch (e) {
                    console.log(e);
                    // continue start;
                }
            }
        });
    };
    generateChartData = (r, item) => {
        var time = item.time + 7 * 60 * 60;
        var volumeColor = this.UP_COLOR;
        var volume = item.volume,
            openPrice = 0,
            highPrice = 0,
            lowPrice = 0;
        if (this.timeFrame > 0) {
            const period = 60 * this.timeFrame;
            const timeIndex = Math.floor(time / period);
            var isSameTime = false;
            if (!!r.price.length) {
                const prevTime = r.price.slice(-1)[0].time;
                if (timeIndex == Math.floor(prevTime / period))
                    isSameTime = true;
            }
            if (isSameTime) {
                const prevPrice = r.price.pop();
                openPrice = prevPrice.open;
                highPrice = prevPrice.high;
                lowPrice = prevPrice.low;
                if (item.price < lowPrice) lowPrice = item.price;
                if (item.price > highPrice) highPrice = item.price;
                //
                const prevVolume = r.volume.pop();
                volume += prevVolume.value;
                volumeColor =
                    item.price >= openPrice ? this.UP_COLOR : this.DOWN_COLOR;
            } else {
                openPrice = item.price;
                highPrice = item.price;
                lowPrice = item.price;
            }
            time = timeIndex * period;
        }
        r.original.push(item);
        r.price.push({
            time: time,
            value: item.price,
            open: openPrice,
            high: highPrice,
            low: lowPrice,
            close: item.price
        });
        r.volume.push({
            time: time,
            value: volume,
            color: volumeColor
        });
        //
        return r;
    };
    getToolsData = () => {
        return new Promise(async (resolve, reject) => {
            const order = await this.global.store.get("order");
            order.map(item => {
                this.order.side = item.side;
                this.order[item.kind].price = item.price;
                this.drawOrderLine(item.kind);
                if (item.kind == "entry") {
                    if (this.callback.getOrderPositionCallback()) {
                        this.order.entry.line.applyOptions({
                            draggable: false
                        });
                    }
                    this.toggleCancelOrderButton(true);
                }
            });
            //
            const lines = await this.global.store.get("line");
            lines.forEach(line => {
                if (!line.removed)
                    this.lines.push(this.series.price.createPriceLine(line));
            });
            //
            this.markers = await this.global.store.get("marker");
            this.series.price.setMarkers(this.markers);
            //
            const rulerLines = await this.global.store.get("ruler");
            if (rulerLines.length == 2) {
                rulerLines.forEach(line => {
                    this.ruler.point = 2;
                    if (line.point == 1)
                        this.ruler.start = this.series.price.createPriceLine(
                            line
                        );
                    else
                        this.ruler.end = this.series.price.createPriceLine(
                            line
                        );
                });
            }
            //
            const alertLines = await this.global.store.get("alert");
            alertLines.forEach(line => {
                if (!line.removed)
                    this.alerts.push(this.series.price.createPriceLine(line));
            });
            //
            resolve();
        });
    };
    connectSocket = () => {
        var self = this;
        var msg = { action: "join", list: self.global.symbol };
        var socket = io(self.global.endpoint.socket);
        socket.on("connect", () => socket.emit("regs", JSON.stringify(msg)));
        socket.on("reconnect", () => {
            self.loadChartData();
            if (self.isInSession()) socket.emit("regs", JSON.stringify(msg));
        });
        socket.on("stockps", data => {
            if (data.data.id == 3220) {
                const param = {
                    time: moment(
                        `${moment().format("YYYY-MM-DD")} ${data.data.time}`
                    ).unix(),
                    price: data.data.lastPrice,
                    volume: data.data.lastVol
                };
                self.updateChartData(param);
            }
        });
    };
    //
    secIntervalHandler = self => {
        if (self.callback.getOrderPositionCallback()) {
            if (
                self.global.isTpSl &&
                self.order.entry.hasOwnProperty("line") &&
                !self.order.tp.hasOwnProperty("line")
            ) {
                self.callback.orderTpPriceCallback(self.order, true);
                self.drawOrderLine("tp");
                self.callback.orderSlPriceCallback(self.order, true);
                self.drawOrderLine("sl");
                self.order.entry.line.applyOptions({
                    draggable: false
                });
                self.global.alert.show("success", "Đã mở vị thế.");
            }
        } else {
            if (self.order.tp.hasOwnProperty("line")) {
                self.callback.cancelOrderCallback();
                self.toggleCancelOrderButton(false);
                self.removeOrderLine("entry");
                self.removeOrderLine("tp");
                self.removeOrderLine("sl");
                self.global.store.clear("order");
                self.global.alert.show("success", "Đã đóng vị thế.");
            }
        }
        if (self.alertAudio.paused) {
            self.alerts.forEach(alert => {
                const ops = alert.options();
                if (!ops.removed && !!self.data.original.length) {
                    const currentPrice = self.data.original.slice(-1)[0].price;
                    if (
                        (ops.title == ">" && currentPrice >= ops.price) ||
                        (ops.title == "<" && currentPrice <= ops.price)
                    )
                        self.alertAudio.play();
                }
            });
        }
        if (moment().unix() == self.global.time.start) self.connectSocket();
    };
    minIntervalHandler = self => {
        if (self.isInSession()) self.loadChartData();
    };
    isInSession = () => {
        return (
            moment().unix() >= this.global.time.start &&
            moment().unix() <= this.global.time.end
        );
    };
    //
    toggleChartVolume = visible => {
        this.global.isVolume = visible;
        this.series.volume.applyOptions({ visible: visible });
        this.volumeLegendP.style.display = visible ? "block" : "none";
        this.chart.applyOptions({
            rightPriceScale: {
                scaleMargins: visible
                    ? { top: 0.1, bottom: 0.21 }
                    : { top: 0.2, bottom: 0.1 }
            }
        });
    };
    //
    toggleSpinner = visible => {
        this.spinnerImg.style.opacity = visible ? 1 : 0;
    };
    eventChartResize = self => {
        self.chart.resize(window.innerWidth, window.innerHeight);
    };
    eventKeyPress = (e, self) => {
        try {
            if (e.ctrlKey || e.metaKey) {
                if (e.shiftKey) {
                    switch (e.keyCode) {
                        case 39:
                            self.chart.timeScale().scrollToRealTime();
                            break;
                    }
                } else {
                    switch (e.keyCode) {
                        case 38:
                            self.chart.timeScale().applyOptions({
                                barSpacing:
                                    self.chart.options().timeScale.barSpacing +
                                    0.1
                            });
                            break;
                        case 40:
                            if (
                                options.timeScale.barSpacing >
                                options.timeScale.minBarSpacing
                            )
                                self.chart.timeScale().applyOptions({
                                    barSpacing:
                                        self.chart.options().timeScale
                                            .barSpacing - 0.1
                                });
                            break;
                        case 37:
                            self.ch
                                .timeScale()
                                .scrollToPosition(
                                    self.chart.timeScale().scrollPosition() - 10
                                );
                            break;
                        case 39:
                            self.ch
                                .timeScale()
                                .scrollToPosition(
                                    self.chart.timeScale().scrollPosition() + 10
                                );
                            break;
                        case 75:
                            self.drawLineButton.click();
                            break;
                        case 76:
                            self.drawMarkerButton.click();
                            break;
                        case 186:
                            self.drawRulerButton.click();
                            break;
                        case 222:
                            self.drawAlertButton.click();
                            break;
                        case 96:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[0].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[0].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 97:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[1].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[1].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 98:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[2].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[2].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 99:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[3].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[3].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 100:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[4].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[4].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 101:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[5].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[5].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 102:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[6].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[6].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 103:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[7].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[7].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 104:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[8].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[8].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 105:
                            if (
                                self.timeFrame !=
                                self.global.timeFrames[9].value
                            ) {
                                self.timeFrameSelect.value =
                                    self.global.timeFrames[9].value;
                                self.timeFrameSelect.dispatchEvent(
                                    new Event("change")
                                );
                            }
                            break;
                        case 77:
                            self.refreshButton.click();
                            break;
                        case 188:
                            self.clearButton.click();
                            break;
                    }
                }
            }
        } catch (error) {}
    };
}

class Popup {
    // Các thuộc tính
    TK = "__so";

    // Hàm khởi tạo
    constructor(global, callback) {
        this.global = global;
        this.callback = callback;
        this.createContainerElement();
    }

    // Các phương thức
    createContainerElement = () => {
        var container = document.createElement("div");
        container.id = "optionViewContainer";
        document.body.append(container);
        this.containerElement = container;
    };
    createNoLoginElement = () => {
        this.createHeaderContainer();
        this.createLoginContainer();
        this.createRegisterContainer();
    };
    createHeaderContainer = () => {
        var div = document.createElement("div");
        div.id = "hearderContainer";
        this.containerElement.append(div);
        //
        var p = document.createElement("span");
        div.append(p);
        p.className = "title";
        p.innerText = this.global.appName;
        //
        var logout = document.createElement("span");
        div.append(logout);
        logout.className = "logout fa fa-sign-out";
        logout.title = "Đăng xuất";
        logout.style.display = "none";
        logout.addEventListener("click", () => this.logout(this));
        this.logoutButton = logout;
    };
    createLoginContainer = () => {
        var div = document.createElement("div");
        div.id = "loginContainer";
        div.className = "section";
        this.containerElement.append(div);
        this.loginContainer = div;
        //
        var wrapper = document.createElement("form");
        div.append(wrapper);
        wrapper.className = "wrapper";
        wrapper.addEventListener("submit", e => this.login(e, this));
        //
        var p = document.createElement("span");
        wrapper.append(p);
        p.className = "invalid";
        this.loginMessage = p;
        //
        var input = document.createElement("input");
        wrapper.append(input);
        input.id = "LoginUserName";
        input.type = "text";
        input.placeholder = "Email hoặc Số điện thoại";
        input.required = true;
        this.loginUsername = input;
        if (!this.global.isLoggedin) this.loginUsername.focus();
        //
        input = document.createElement("input");
        wrapper.append(input);
        input.id = "LoginPassword";
        input.type = "password";
        input.placeholder = "Mật khẩu";
        input.required = true;
        this.loginPassword = input;
        //
        var checkboxWrapper = document.createElement("div");
        checkboxWrapper.style.display = "flex";
        wrapper.append(checkboxWrapper);
        input = document.createElement("input");
        checkboxWrapper.append(input);
        input.type = "checkbox";
        input.style.width = "17px";
        this.loginRememberMe = input;
        var span = document.createElement("span");
        checkboxWrapper.append(span);
        span.innerHTML = "&ensp;Lưu đăng nhập";
        //
        var button = document.createElement("button");
        wrapper.append(button);
        button.innerText = "ĐĂNG NHẬP";
        button.type = "submit";
        this.loginSubmit = button;
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Gia hạn";
        route.addEventListener("click", () => {
            this.setActivedSection(this.renewalContainer);
        });
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Đăng ký";
        route.addEventListener("click", () => {
            this.setActivedSection(this.registerContainer);
            this.registerName.focus();
        });
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Phần mềm";
        route.addEventListener("click", () => {
            this.setActivedSection(this.aboutContainer);
        });
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trang chủ";
        route.addEventListener("click", () =>
            window.open("https://smartorder.nguyenvanxuanphu.com")
        );
    };
    createRegisterContainer = () => {
        var div = document.createElement("div");
        div.id = "registerContainer";
        div.className = "section";
        this.containerElement.append(div);
        this.registerContainer = div;
        //
        var wrapper = document.createElement("form");
        div.append(wrapper);
        wrapper.className = "wrapper";
        wrapper.addEventListener("submit", e => this.registerAccount(e, this));
        //
        var span = document.createElement("span");
        span.innerText = "Được 7 ngày dùng thử với 2 thiết bị.";
        wrapper.append(span);
        //
        var span = document.createElement("span");
        wrapper.append(span);
        span.className = "invalid";
        this.registerMessage = span;
        //
        var input = document.createElement("input");
        wrapper.append(input);
        input.type = "text";
        input.placeholder = "Tên";
        input.required = true;
        this.registerName = input;
        //
        input = document.createElement("input");
        wrapper.append(input);
        input.type = "email";
        input.placeholder = "Email";
        input.required = true;
        this.registerEmail = input;
        //
        input = document.createElement("input");
        wrapper.append(input);
        input.type = "text";
        input.placeholder = "Số điện thoại";
        input.required = true;
        input.setAttribute("maxlength", 10);
        input.setAttribute("pattern", "[0-9]+");
        this.registerPhone = input;
        //
        input = document.createElement("input");
        wrapper.append(input);
        input.type = "password";
        input.placeholder = "Mật khẩu";
        input.required = true;
        this.registerPassword = input;
        //
        input = document.createElement("input");
        wrapper.append(input);
        input.type = "password";
        input.placeholder = "Xác nhận mật khẩu";
        input.required = true;
        this.registerConfirmPassword = input;
        //
        var button = document.createElement("button");
        wrapper.append(button);
        button.innerText = "ĐĂNG KÝ";
        button.type = "submit";
        this.registerSubmit = button;
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Đăng nhập";
        route.addEventListener("click", () => {
            this.setActivedSection(this.loginContainer);
            this.loginUsername.focus();
        });
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trang chủ";
        route.addEventListener("click", () =>
            window.open("https://smartorder.nguyenvanxuanphu.com")
        );
    };
    createLoggedinElement = () => {
        this.createOptionContainer();
        this.createInfoContainer();
        this.createAboutContainer();
        this.createRenewalContainer();
        //
        this.setActivedSection(this.optionContainer);
        this.toggleLogoutButton(true);
    };
    createOptionContainer = () => {
        var div = document.createElement("div");
        div.id = "optionContainer";
        div.className = "section";
        this.containerElement.append(div);
        this.optionContainer = div;
        //
        var wrapper = document.createElement("form");
        div.append(wrapper);
        wrapper.className = "wrapper";
        wrapper.addEventListener("submit", e => this.setServerConfig(e, this));
        //
        var list = document.createElement("div");
        list.className = "list";
        wrapper.append(list);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Khung thời gian:";
        item.append(label);
        var select = document.createElement("select");
        select.style.width = "69px";
        this.global.timeFrames.forEach((item, index) => {
            var option = document.createElement("option");
            option.value = item.value;
            option.text = item.text;
            select.appendChild(option);
        });
        select.value = this.global.timeFrame;
        this.timeFrameSelect = select;
        item.append(select);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Loại biểu đồ:";
        item.append(label);
        select = document.createElement("select");
        select.style.width = "69px";
        this.global.chartTypes.forEach((item, index) => {
            var option = document.createElement("option");
            option.value = item.value;
            option.text = item.text;
            select.appendChild(option);
        });
        select.value = this.global.chartType;
        this.chartTypeSelect = select;
        item.append(select);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Số hợp đồng:";
        item.append(label);
        var input = document.createElement("input");
        input.type = "number";
        input.style.width = "69px";
        input.style.height = "21px";
        input.value = this.global.contractNumber;
        this.contractNumberInput = input;
        item.append(input);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Điểm chốt lời:";
        item.append(label);
        var input = document.createElement("input");
        input.type = "number";
        input.style.width = "69px";
        input.style.height = "21px";
        input.value = this.global.takeProfit;
        this.takeProfitInput = input;
        item.append(input);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Điểm cắt lỗ:";
        item.append(label);
        var input = document.createElement("input");
        input.type = "number";
        input.style.width = "69px";
        input.style.height = "21px";
        input.value = this.global.stopLoss;
        this.stopLossInput = input;
        item.append(input);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Tự động đặt TP/SL:";
        item.append(label);
        input = document.createElement("input");
        input.type = "checkbox";
        input.style.width = "17px";
        input.checked = !!this.global.isTpSl;
        this.isTpSlCheckbox = input;
        item.append(input);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Hiển thị biểu đồ khối lượng:";
        item.append(label);
        input = document.createElement("input");
        input.type = "checkbox";
        input.style.width = "17px";
        input.checked = !!this.global.isVolume;
        this.isVolumeCheckbox = input;
        item.append(input);
        //
        item = document.createElement("div");
        item.className = "item";
        list.append(item);
        label = document.createElement("span");
        label.innerText = "Mở biểu đồ khi khởi động:";
        item.append(label);
        input = document.createElement("input");
        input.type = "checkbox";
        input.style.width = "17px";
        input.checked = !!this.global.isViewChart;
        this.isViewChartCheckbox = input;
        item.append(input);
        //
        var button = document.createElement("button");
        wrapper.append(button);
        button.innerText = "LƯU CÀI ĐẶT";
        button.type = "submit";
        this.optionSubmit = button;
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Dịch vụ";
        route.addEventListener("click", () =>
            this.setActivedSection(this.infoContainer)
        );
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Phần mềm";
        route.addEventListener("click", () =>
            this.setActivedSection(this.aboutContainer)
        );
    };
    createInfoContainer = () => {
        var div = document.createElement("div");
        div.id = "infoContainer";
        div.className = "section";
        this.containerElement.append(div);
        this.infoContainer = div;
        //
        var wrapper = document.createElement("div");
        wrapper.className = "wrapper";
        div.append(wrapper);
        //
        var list = document.createElement("div");
        list.className = "list";
        wrapper.append(list);
        var title = document.createElement("span");
        list.append(title);
        title.className = "title";
        title.innerText = "Thông tin tài khoản:";
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Tên:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.user.name;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Email:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.user.email;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Điện thoại:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.user.phone;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Ngày đăng ký:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = moment(this.global.registerDate).format("DD/MM/YYYY");
        item.append(value);
        //
        var list = document.createElement("div");
        list.className = "list";
        wrapper.append(list);
        var title = document.createElement("span");
        list.append(title);
        title.className = "title";
        title.innerText = "Thông tin gói dịch vụ:";
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Ngày bắt đầu:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = moment(this.global.startDate).format("DD/MM/YYYY");
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Ngày hết hạn:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = moment(this.global.expiresDate).format("DD/MM/YYYY");
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Số lượng thiết bị:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.deviceLimit;
        item.append(value);
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trở về";
        route.addEventListener("click", () =>
            this.setActivedSection(this.optionContainer)
        );
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Gia hạn";
        route.addEventListener("click", () => {
            this.setActivedSection(this.renewalContainer);
        });
    };
    createAboutContainer = () => {
        var div = document.createElement("div");
        div.id = "aboutContainer";
        div.className = "section";
        this.containerElement.append(div);
        this.aboutContainer = div;
        //
        var wrapper = document.createElement("div");
        wrapper.className = "wrapper";
        div.append(wrapper);
        //
        var list = document.createElement("div");
        list.className = "list";
        wrapper.append(list);
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Phiên bản:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.version;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Ngày xuất bản:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.publishDate;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Nhà phát triển:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.developer;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Số điện thoại:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.contact.phone;
        item.append(value);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("span");
        label.innerText = "Email:";
        item.append(label);
        var value = document.createElement("span");
        value.innerText = this.global.contact.email;
        item.append(value);
        //
        if (this.global.version != this.global.latestVersion) {
            var download = document.createElement("form");
            download.setAttribute("method", "get");
            download.setAttribute(
                "action",
                "https://quytrevang.nguyenvanxuanphu.com/storage/files/smartorder.zip"
            );
            download.className = "download";
            wrapper.append(download);
            var label = document.createElement("span");
            download.append(label);
            label.innerHTML = "Đã có phiên bản cập nhật mới.";
            var button = document.createElement("button");
            download.append(button);
            button.type = "submit";
            button.innerText = "TẢI XUỐNG";
        }
        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trở về";
        route.addEventListener("click", () =>
            this.setActivedSection(this.prevSection)
        );
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trang chủ";
        route.addEventListener("click", () =>
            window.open("https://smartorder.nguyenvanxuanphu.com")
        );
    };
    createRenewalContainer = () => {
        var container = document.createElement("div");
        container.id = "renewalContainer";
        container.className = "section";
        this.containerElement.append(container);
        this.renewalContainer = container;
        //
        var wrapper = document.createElement("div");
        wrapper.className = "wrapper";
        container.append(wrapper);
        //
        var list = document.createElement("div");
        list.className = "list";
        wrapper.append(list);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("div");
        label.innerText = "1. Chọn lần mua:";
        label.className = "title";
        item.append(label);
        var select = document.createElement("select");
        select.style.width = "80px";
        [
            { t: "Mua mới", v: 1 },
            { t: "Gia hạn", v: 2 }
        ].forEach(item => {
            var option = document.createElement("option");
            option.value = item.v;
            option.text = item.t;
            select.appendChild(option);
        });
        this.buyType = 2;
        select.value = this.buyType;
        select.addEventListener("change", e => {
            this.buyType = e.target.value;
            if (!!this.plan) {
                const temp = this.updatePlanInfo(this.buyType, this.plan);
                this.planPrice = temp.planPrice;
                this.planSaveMoney = temp.planSaveMoney;
                if (this.deviceNumber > 0) {
                    this.updatePaymentInfo(
                        this.deviceNumber,
                        this.planPrice,
                        this.planSaveMoney
                    );
                }
            }
        });
        item.append(select);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("div");
        label.innerText = "2. Chọn thời gian:";
        label.className = "title";
        item.append(label);
        var select = document.createElement("select");
        select.style.width = "80px";
        var option = document.createElement("option");
        option.value = 0;
        option.text = "";
        select.appendChild(option);
        this.global.plans.forEach((item, index) => {
            var option = document.createElement("option");
            option.value = item.months;
            option.text = item.name;
            select.appendChild(option);
        });
        select.addEventListener("change", e => {
            const value = e.target.value;
            if (value > 0) {
                this.plan = this.global.plans.filter(p => p.months == value)[0];
                const temp = this.updatePlanInfo(this.buyType, this.plan);
                this.planPrice = temp.planPrice;
                this.planSaveMoney = temp.planSaveMoney;
                this.priceInfo.style.display = "flex";
                //
                if (this.deviceNumber > 0) {
                    this.updatePaymentInfo(
                        this.deviceNumber,
                        this.planPrice,
                        this.planSaveMoney
                    );
                }
            } else {
                this.updatePaymentInfo();
                this.priceInfo.style.display = "none";
            }
        });
        item.append(select);
        //
        var item = document.createElement("div");
        item.className = "item";
        item.style.display = "none";
        list.append(item);
        this.priceInfo = item;
        var label = document.createElement("div");
        item.append(label);
        this.priceLabel = label;
        var label = document.createElement("div");
        item.append(label);
        this.saveMoneyLabel = label;
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var label = document.createElement("div");
        label.innerText = "3. Chọn số thiết bị:";
        label.className = "title";
        item.append(label);
        var input = document.createElement("input");
        input.type = "number";
        input.style.width = "80px";
        input.style.height = "21px";
        input.addEventListener("change", e => {
            this.deviceNumber = Math.floor(e.target.value);
            this.updatePaymentInfo(
                this.deviceNumber,
                this.planPrice,
                this.planSaveMoney
            );
        });
        item.append(input);
        //
        var label = document.createElement("div");
        label.innerText = "4. Thanh toán:";
        label.className = "title";
        list.append(label);
        //
        var item = document.createElement("div");
        item.className = "item";
        list.append(item);
        var bank = document.createElement("div");
        item.append(bank);
        var info = document.createElement("div");
        info.innerText = `${this.global.bankAccount.bank_name}: ${this.global.bankAccount.account_number}`;
        bank.append(info);
        var info = document.createElement("div");
        info.innerText = `Tên: ${this.global.bankAccount.account_name.toLowerCase()}`;
        bank.append(info);
        var info = document.createElement("div");
        info.innerText = `NDCK: so ${
            this.global.isLoggedin ? this.global.user.phone : "<SĐT>"
        }`;
        bank.append(info);
        var info = document.createElement("div");
        bank.append(info);
        this.totalPriceInfo = info;
        var info = document.createElement("div");
        bank.append(info);
        this.totalSaveMoneyInfo = info;

        var qrCode = document.createElement("img");
        qrCode.style.width = "90px";
        qrCode.style.height = "90px";
        qrCode.style.visibility = "hidden";
        item.append(qrCode);
        this.qrCodeImg = qrCode;

        //
        var routeWrapper = document.createElement("div");
        routeWrapper.className = "link-group";
        wrapper.append(routeWrapper);
        var route = document.createElement("span");
        routeWrapper.append(route);
        route.className = "link";
        route.innerText = "Trở về";
        route.addEventListener("click", () =>
            this.setActivedSection(this.prevSection)
        );
    };
    removeLoggedinElement = () => {
        if (!!this.infoContainer) this.infoContainer.remove();
        if (!!this.optionContainer) this.optionContainer.remove();
        if (!!this.aboutContainer) this.aboutContainer.remove();
        //
        this.logoutButton.style.display = "none";
        this.setActivedSection(this.loginContainer);
        this.loginUsername.focus();
    };
    registerAccount = (e, self) => {
        e.preventDefault();
        if (self.registerConfirmPassword.value != self.registerPassword.value) {
            self.registerMessage.innerText = "Mật khẩu không khớp";
            return false;
        } else {
            self.registerSubmit.innerText = "Đang đăng ký...";
            self.registerSubmit.disabled = true;
            self.registerMessage.innerText = "";
            const data = self.global.crypto.encrypt({
                name: self.registerName.value,
                email: self.registerEmail.value,
                phone: self.registerPhone.value,
                password: self.registerPassword.value,
                deviceId: self.global.deviceId,
                chanel: self.global.appName
            });
            const url = self.global.domain + self.global.endpoint.register;
            fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: data
            })
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error(response.statusText);
                })
                .then(async json => {
                    json = self.global.crypto.decrypt(json);
                    // console.log("register: ", json);
                    self.registerSubmit.innerText = "ĐĂNG KÝ";
                    self.registerSubmit.disabled = false;
                    if (json.isOk) {
                        this.global.isLoggedin = true;
                        self.setToken(json.token);
                        self.global.accessToken = json.token.access_token;
                        self.global.user = json.user;
                        await self.callback.loginCallback();
                        self.global.alert.show("success", "Đăng ký thành công");
                        self.registerName.value = "";
                        self.registerEmail.value = "";
                        self.registerPhone.value = "";
                        self.registerPassword.value = "";
                        self.registerConfirmPassword.value = "";
                    } else {
                        if (json.message == "emailExist")
                            self.registerMessage.innerText =
                                "Emai này đã đăng ký";
                        else if (json.message == "phoneExist")
                            self.registerMessage.innerText =
                                "Số điện thoại này đã đăng ký";
                        else if (json.message == "deviceExist")
                            self.registerMessage.innerText =
                                "Tài khoản khác đã dùng thiết bị này";
                    }
                })
                .catch(error => {
                    console.log(error);
                    self.global.alert.show("error", "Đăng ký lỗi");
                    self.registerSubmit.innerText = "ĐĂNG KÝ";
                    self.registerSubmit.disabled = false;
                });
        }
    };
    login = (e, self) => {
        e.preventDefault();
        self.loginSubmit.innerText = "Đang đăng nhập...";
        self.loginSubmit.disabled = true;
        self.loginMessage.innerText = "";
        const data = self.global.crypto.encrypt({
            username: self.loginUsername.value,
            password: self.loginPassword.value,
            rememberMe: self.loginRememberMe.checked,
            deviceId: self.global.deviceId,
            chanel: self.global.appName
        });
        const url = self.global.domain + self.global.endpoint.login;
        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: data
        })
            .then(response => {
                if (response.ok) return response.json();
                throw new Error(response.statusText);
            })
            .then(async json => {
                json = self.global.crypto.decrypt(json);
                // console.log("login: ", json);
                if (json.isOk) {
                    this.global.isLoggedin = true;
                    self.setToken(json.token);
                    self.global.accessToken = json.token.access_token;
                    self.global.user = json.user;
                    await self.callback.loginCallback();
                    self.loginUsername.value = "";
                    self.loginPassword.value = "";
                } else {
                    if (json.message == "unauthorized")
                        self.loginMessage.innerText = "Sai thông tin đăng nhập";
                    else if (json.message == "unsetup")
                        self.loginMessage.innerText = "Lỗi khởi tạo tài khoản";
                    else if (json.message == "expired")
                        self.loginMessage.innerText = "Quá hạn sử dụng dịch vụ";
                    else if (json.message == "deviceLimit")
                        self.loginMessage.innerText = "Quá giới hạn thiết bị";
                }
                self.loginSubmit.innerText = "ĐĂNG NHẬP";
                self.loginSubmit.disabled = false;
            })
            .catch(error => {
                self.global.alert.show("error", "Đăng nhập lỗi");
                self.loginSubmit.innerText = "ĐĂNG NHẬP";
                self.loginSubmit.disabled = false;
            });
    };
    logout = self => {
        const url = self.global.domain + self.global.endpoint.logout;
        fetch(url, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${self.global.accessToken}`
            }
        }).then(() => {
            this.global.isLoggedin = false;
            self.removeToken();
            self.callback.logoutCallback();
        });
    };
    getUser = () => {
        return new Promise(resolve => {
            this.global.accessToken = this.getToken();
            if (!this.global.accessToken) resolve();
            else {
                const data = this.global.crypto.encrypt({
                    deviceId: this.global.deviceId
                });
                const url = this.global.domain + this.global.endpoint.user;
                fetch(url, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${this.global.accessToken}`
                    },
                    body: data
                })
                    .then(response => {
                        if (response.ok) return response.json();
                        throw new Error(response.statusText);
                    })
                    .then(json => {
                        json = this.global.crypto.decrypt(json);
                        // console.log("gU: ", json);
                        this.global.isLoggedin = json.isOk;
                        if (json.isOk) this.global.user = json.user;
                        else this.alertInvalidAccess(true);
                        resolve();
                    })
                    .catch(error => resolve());
            }
        });
    };
    getServerConfig = () => {
        return new Promise((resolve, reject) => {
            const data = this.global.crypto.encrypt({
                deviceId: this.global.deviceId
            });
            const url = this.global.domain + this.global.endpoint.getConfig;
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${this.global.accessToken}`
                },
                body: data
            })
                .then(response => response.json())
                .then(json => {
                    json = this.global.crypto.decrypt(json);
                    console.log("serverConfig", json);
                    if (json.isOk)
                        for (const key in json.config)
                            this.global[key] = json.config[key];
                    else this.alertInvalidAccess();
                    resolve();
                })
                .catch(err => {
                    console.log(err);
                    var choice = confirm(
                        "Get server config error. Refresh now?"
                    );
                    if (choice) location.reload();
                });
        });
    };
    setServerConfig = (e, self) => {
        e.preventDefault();
        return new Promise(resolve => {
            self.optionSubmit.innerText = "Đang lưu cài đặt...";
            self.optionSubmit.disabled = true;
            const data = self.global.crypto.encrypt({
                timeFrame: +self.timeFrameSelect.value,
                chartType: self.chartTypeSelect.value,
                contractNumber: +self.contractNumberInput.value,
                takeProfit: +self.takeProfitInput.value,
                stopLoss: +self.stopLossInput.value,
                isTpSl: self.isTpSlCheckbox.checked,
                isVolume: self.isVolumeCheckbox.checked,
                isViewChart: self.isViewChartCheckbox.checked,
                deviceId: self.global.deviceId
            });
            const url = self.global.domain + self.global.endpoint.setConfig;
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${self.global.accessToken}`
                },
                body: data
            })
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error(response.statusText);
                })
                .then(async json => {
                    json = self.global.crypto.decrypt(json);
                    // console.log("setConfig: ", json);
                    self.optionSubmit.innerText = "LƯU CÀI ĐẶT";
                    self.optionSubmit.disabled = false;
                    if (json.isOk) {
                        self.global.alert.show(
                            "success",
                            "Lưu cài đặt thành công"
                        );
                        self.global.isTpSl = self.isTpSlCheckbox.checked;
                        self.callback.toggleChartVolumeCallback(
                            self.isVolumeCheckbox.checked
                        );
                    } else {
                        if (json.message == "unauthorized")
                            self.alertInvalidAccess();
                        else
                            self.global.alert.show(
                                "error",
                                "Lưu cài đặt thất bại"
                            );
                    }
                    resolve();
                });
        });
    };
    getServerBackground = () => {
        return new Promise((resolve, reject) => {
            const data = this.global.crypto.encrypt({
                deviceId: this.global.deviceId
            });
            const url = this.global.domain + this.global.endpoint.getBackground;
            fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: data
            })
                .then(response => response.json())
                .then(json => {
                    json = this.global.crypto.decrypt(json);
                    console.log("serverBackground", json);
                    if (json.isOk)
                        for (const key in json.config)
                            this.global[key] = json.config[key];
                    else this.alertInvalidAccess();
                    resolve();
                })
                .catch(err => {
                    console.log(err);
                    var choice = confirm(
                        "Get server config error. Refresh now?"
                    );
                    if (choice) location.reload();
                });
        });
    };
    setToken = token => {
        localStorage.setItem(this.TK, JSON.stringify(token));
    };
    removeToken = () => {
        localStorage.removeItem(this.TK);
    };
    getToken = () => {
        const token = JSON.parse(localStorage.getItem(this.TK));
        if (!token) return false;
        if (moment().isBefore(token.expires_at)) return token.access_token;
        this.global.alert.show("waring", "Phiên đăng nhập hết hạn");
        return false;
    };
    toggle = (visible = true) => {
        if (!visible || this.containerElement.classList.contains("show"))
            this.containerElement.classList.remove("show");
        else {
            this.setActivedSection(
                this.global.isLoggedin
                    ? this.optionContainer
                    : this.loginContainer
            );
            this.containerElement.classList.add("show");
        }
    };
    toggleLogoutButton = visible => {
        this.logoutButton.style.display = visible ? "block" : "none";
    };
    setActivedSection = el => {
        var activeEl = document.querySelector(
            "#optionViewContainer .section.active"
        );
        if (activeEl) {
            this.prevSection = activeEl;
            activeEl.classList.remove("active");
        }
        this.currSection = el;
        el.classList.add("active");
    };
    alertInvalidAccess = (h = false) => {
        this.logout(this);
        const msg = "Tài khoản đăng nhập sai cách";
        if (h)
            this.global.alert
                .hide()
                .then(() => this.global.alert.show("error", msg, true, true));
        else this.global.alert.show("error", msg);
    };
    currencyFormat = input => {
        return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND"
        }).format(input);
    };
    updatePlanInfo = (buyType, plan) => {
        const isRenewal = buyType == "2";
        const pricePerDevice = isRenewal ? plan.renewal_price : plan.price;
        this.priceLabel.innerText = `${this.currencyFormat(
            pricePerDevice
        )}/tháng`;
        const planPrice = plan.months * pricePerDevice;
        const planSaveMoney =
            plan.months * (plan.highest_price - pricePerDevice);
        this.saveMoneyLabel.innerText = `Tiết kiệm: ${this.currencyFormat(
            planSaveMoney
        )}`;
        return {
            planPrice,
            planSaveMoney
        };
    };
    updatePaymentInfo = (
        deviceNumber = 0,
        planPrice = 0,
        planSaveMoney = 0
    ) => {
        if (deviceNumber > 0) {
            const price = deviceNumber * planPrice;
            this.totalPriceInfo.innerText = `Tổng giá: ${this.currencyFormat(
                price
            )}`;
            this.totalSaveMoneyInfo.innerText = `Tiết kiệm: ${this.currencyFormat(
                deviceNumber * planSaveMoney
            )}`;
            this.qrCodeImg.src = `https://img.vietqr.io/image/${
                this.global.bankAccount.bank_name
            }-${
                this.global.bankAccount.account_number
            }-fcaSnpq.jpg?accountName=${
                this.global.bankAccount.account_name
            }&amount=${price}&addInfo=so ${
                this.global.isLoggedin ? this.global.user.phone : ""
            }`;
            this.qrCodeImg.style.visibility = "visible";
        } else {
            this.totalPriceInfo.innerText = "";
            this.totalSaveMoneyInfo.innerText = "";
            this.qrCodeImg.style.visibility = "hidden";
        }
    };
}

class Menu {
    // Các thuộc tính

    // Hàm khởi tạo
    constructor(global, callback) {
        this.global = global;
        this.callback = callback;
        this.createContainerElement();
        this.createNoLoginElement();
    }
    //
    // Các phương thức
    createContainerElement = () => {
        var container = document.createElement("div");
        container.id = "menuContainer";
        document.body.append(container);
        this.containerElement = container;
    };
    createLoggedinElement = () => {
        var button = document.createElement("button");
        button.id = "lightWeightButton";
        button.classList = "fa fa-line-chart";
        button.title = "Biểu đồ đặt lệnh";
        button.addEventListener("click", () =>
            this.callback.toggleLightWeightButtonCallback()
        );
        this.containerElement.prepend(button);
        this.lightWeightButton = button;
        //
        var button = document.createElement("button");
        button.classList = "fa fa-bar-chart";
        button.title = "Biểu đồ phân tích";
        button.addEventListener("click", () =>
            this.callback.toggleTradingViewButtonCallback()
        );
        this.containerElement.prepend(button);
        this.tradingViewButton = button;
        //
        if (
            !!this.global.isReport &&
            this.global.isOpeningMarket &&
            !this.global.isReportedResult
        ) {
            var button = document.createElement("button");
            button.id = "reportButton";
            button.classList = "fa fa-flag-checkered";
            button.title = "Báo cáo kết quả";
            button.addEventListener("click", () =>
                this.reportTradingResult(this)
            );
            this.containerElement.append(button);
            this.reportButton = button;
        }
        //
        this.settingButton.classList.replace("fa-sign-in", "fa-cog");
        //
        this.interval = setInterval(() => {
            this.blinkLightWeightButton(this);
            if (moment().unix() == this.global.time.end)
                this.reportTradingResult(this);
        }, 1000);
    };
    removeLoggedinElement = () => {
        if (!!this.tradingViewButton) this.tradingViewButton.remove();
        if (!!this.lightWeightButton) this.lightWeightButton.remove();
        if (
            !!this.global.isReport &&
            this.global.isOpeningMarket &&
            !this.global.isReportedResult
        )
            if (!!this.reportButton) this.reportButton.remove();
        //
        this.settingButton.classList.replace("fa-cog", "fa-sign-in");
        //
        clearInterval(this.interval);
    };
    createNoLoginElement = () => {
        var button = document.createElement("button");
        button.id = "settingButton";
        button.classList = "fa fa-sign-in";
        button.title = "Cài đặt";
        button.addEventListener("click", () =>
            this.callback.togglePopupCallback(true)
        );
        this.containerElement.append(button);
        this.settingButton = button;
    };
    blinkLightWeightButton = self => {
        if (self.global.isInSession()) {
            if (self.lightWeightButton.classList.contains("dark"))
                self.lightWeightButton.classList.remove("dark");
            else self.lightWeightButton.classList.add("dark");
        }
    };
    reportTradingResult = self => {
        if (self.global.isOpeningMarket && !self.global.isReportedResult) {
            self.global.alert.show("warning", "Đang gửi báo cáo . . .", false);
            self.global.isReportedResult = true;
            self.global.toggleSpinner(true);
            const url = self.global.domain + self.global.endpoint.report;
            const data = self.global.crypto.encrypt({
                ...self.callback.getReportDataCallback(),
                ...{ deviceId: self.global.deviceId }
            });
            fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${self.global.accessToken}`
                },
                body: data
            })
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error(response.statusText);
                })
                .then(json => {
                    json = self.global.crypto.decrypt(json);
                    self.global.isReportedResult = json.isOk;
                    if (json.isOk) {
                        self.global.alert.hide().then(() => {
                            if (json.isExecuted)
                                self.global.alert.show(
                                    "success",
                                    "Báo cáo đã gửi thành công."
                                );
                            else
                                self.global.alert.show(
                                    "warning",
                                    "Đã gửi báo cáo"
                                );
                        });
                        self.reportButton.remove();
                    } else if (json.message == "unauthorized")
                        self.callback.alertInvalidAccessCallback();
                    //
                    self.global.toggleSpinner(false);
                })
                .catch(error => {
                    self.global.isReportedResult = false;
                    self.global.alert
                        .hide()
                        .then(() =>
                            self.global.alert.show(
                                "error",
                                "Gửi báo cáo thất bại"
                            )
                        );
                    self.global.toggleSpinner(false);
                });
        }
    };
}

class SmartOrder {
    // Hàm khởi tạo
    constructor() {
        this.global = new Config();
        this.global.alert = new Alert();
        this.global.store = new Store();
        this.global.crypto = new Crypto(this.global);
        this.global.deviceId = new DeviceUUID().get();
        this.global.isMobile = navigator.userAgentData.mobile;
        this.chart = new Chart(this.global, {
            getOrderPositionCallback: this.getOrderPositionCallback,
            closeOrderPositionCallback: this.closeOrderPositionCallback,
            orderEntryPriceCallback: this.orderEntryPriceCallback,
            orderTpPriceCallback: this.orderTpPriceCallback,
            orderSlPriceCallback: this.orderSlPriceCallback,
            cancelOrderCallback: this.cancelOrderCallback,
            alertInvalidAccessCallback: this.alertInvalidAccessCallback
        });
        this.popup = new Popup(this.global, {
            loginCallback: this.loginCallback,
            logoutCallback: this.logoutCallback,
            toggleChartVolumeCallback: this.toggleChartVolumeCallback
        });
        this.menu = new Menu(this.global, {
            toggleTradingViewButtonCallback: this
                .toggleTradingViewButtonCallback,
            toggleLightWeightButtonCallback: this
                .toggleLightWeightButtonCallback,
            togglePopupCallback: this.togglePopupCallback,
            getReportDataCallback: this.getReportDataCallback,
            alertInvalidAccessCallback: this.alertInvalidAccessCallback
        });
        this.registerFullscreenEvent();
        this.detectVpsSystem();
    }
    //
    // Các phương thức
    init = async () => {
        this.popup.createNoLoginElement();
        console.log("deviceId: ", this.global.deviceId);
        await this.popup.getUser();
        if (this.global.isLoggedin) {
            await this.loginCallback();
            document.getElementById(
                "sohopdong"
            ).value = this.global.contractNumber;
            document.getElementById("right_price").value = "MTL";
        } else {
            await this.popup.getServerBackground();
            this.popup.createAboutContainer();
            this.popup.createRenewalContainer();
            this.menu.settingButton.click();
        }
    };
    loginCallback = async () => {
        this.global.alert.show("warning", "Đang khởi tạo biểu đồ . . .", false);
        await this.popup.getServerConfig();
        this.popup.createLoggedinElement();
        this.chart.create();
        await this.chart.loadChartData();
        await this.chart.getToolsData();
        this.menu.createLoggedinElement();
        if (!!this.global.isViewChart) this.menu.lightWeightButton.click();
        this.chart.connectSocket();
        this.global.alert.hide();
    };
    logoutCallback = () => {
        this.menu.removeLoggedinElement();
        this.popup.removeLoggedinElement();
        this.chart.remove();
        this.toggleTradingViewButtonCallback(false);
        this.toggleLightWeightButtonCallback(false);
    };
    toggleTradingViewButtonCallback = (visible = true) => {
        var leftEl = document.getElementById("left_order_type");
        var rightEl = document.getElementById("right_order_type");
        var orderEl = document.querySelector(
            "#mainFooter .foot_tab:nth-child(1)"
        );
        var condOrderEl = document.querySelector(
            "#mainFooter .foot_tab:nth-child(2)"
        );
        orderEl.classList.remove("fa", "fa-check-circle");
        condOrderEl.classList.remove("fa", "fa-question-circle");
        if (!visible || document.body.classList.contains("tradingview-chart")) {
            document.body.classList.remove("tradingview-chart");
            document.body.classList.remove("full-chart");
            if (this.global.isSmartPro) {
                leftEl.innerText = "Lệnh thường";
                rightEl.innerText = "Lệnh điều kiện";
                orderEl.innerText = "DANH SÁCH LỆNH";
                condOrderEl.innerText = "DANH SÁCH LỆNH ĐIỀU KIỆN";
            }
        } else {
            this.togglePopupCallback(false);
            document.body.classList.add("tradingview-chart");
            document.body.classList.add("full-chart");
            document.body.classList.remove("lightweight-chart");
            if (this.global.isSmartPro) {
                leftEl.innerText = "LT";
                rightEl.innerText = "LĐK";
                orderEl.innerText = "LỆNH THƯỜNG";
                condOrderEl.innerText = "L. ĐIỀU KIỆN";
            }
        }
    };
    toggleLightWeightButtonCallback = (visible = true) => {
        var leftEl = document.getElementById("left_order_type");
        var rightEl = document.getElementById("right_order_type");
        var orderEl = document.querySelector(
            "#mainFooter .foot_tab:nth-child(1)"
        );
        var condOrderEl = document.querySelector(
            "#mainFooter .foot_tab:nth-child(2)"
        );
        if (!visible || document.body.classList.contains("lightweight-chart")) {
            document.body.classList.remove("lightweight-chart");
            document.body.classList.remove("full-chart");
            if (this.global.isSmartPro) {
                leftEl.innerText = "Lệnh thường";
                rightEl.innerText = "Lệnh điều kiện";
                orderEl.classList.remove("fa", "fa-check-circle");
                orderEl.innerText = "DANH SÁCH LỆNH";
                condOrderEl.classList.remove("fa", "fa-question-circle");
                condOrderEl.innerText = "DANH SÁCH LỆNH ĐIỀU KIỆN";
            }
        } else {
            this.togglePopupCallback(false);
            document.body.classList.add("lightweight-chart");
            document.body.classList.add("full-chart");
            document.body.classList.remove("tradingview-chart");
            if (this.global.isSmartPro) {
                leftEl.innerText = "LT";
                rightEl.innerText = "LĐK";
                orderEl.classList.add("fa", "fa-check-circle");
                orderEl.innerText = "";
                condOrderEl.classList.add("fa", "fa-question-circle");
                condOrderEl.innerText = "";
            }
        }
    };
    getReportDataCallback = () => {
        return {
            revenue: +document
                .getElementById("vmAccInfo")
                .innerText.replaceAll(",", ""),
            fees: +document
                .getElementById("othersAccInfo")
                .innerText.replaceAll(",", "")
        };
    };
    getOrderPositionCallback = () => {
        const el = document.querySelector(
            `#danhmuc_${this.global.symbol} > td:nth-child(2)`
        );
        if (!el) return 0;
        const position = el.innerText;
        if (isNaN(position)) return 0;
        else return +position;
    };
    closeOrderPositionCallback = () => {
        const position = this.getOrderPositionCallback();
        if (position) {
            document.getElementById("select_normal_order_wrapper").click();
            document.getElementById("right_price").value = "MTL";
            document.getElementById("sohopdong").value = Math.abs(position);
            document
                .getElementById(`btn_${position > 0 ? "short" : "long"}`)
                .click();
        }
    };
    orderEntryPriceCallback = order => {
        this.callJavascript("onCancelAllOrderPending('order_condition')");
        document.getElementById("select_condition_order_wrapper").click();
        document.getElementById("right_stopOrderIndex").value =
            order.entry.price;
        document.getElementById("right_price").value = "MTL";
        document.getElementById("right_selStopOrderType").value =
            order.side > 0 ? "SOL" : "SOU";
        //
        setTimeout(() => {
            document
                .getElementById(`btn_${order.side > 0 ? "long" : "short"}`)
                .click();
        }, 1000);
    };
    orderTpPriceCallback = (order, isInit = false) => {
        this.callJavascript("onCancelAllOrderPending('order')");
        if (isInit)
            order.tp.price =
                +order.entry.price + order.side * this.global.takeProfit;
        setTimeout(() => {
            document.getElementById("select_normal_order_wrapper").click();
            document.getElementById("right_price").value = order.tp.price;
            document
                .getElementById(`btn_${order.side < 0 ? "long" : "short"}`)
                .click();
        }, 1000);
    };
    orderSlPriceCallback = (order, isInit = false) => {
        this.callJavascript("onCancelAllOrderPending('order_condition')");
        if (isInit)
            order.sl.price =
                +order.entry.price - order.side * this.global.stopLoss;
        setTimeout(() => {
            document.getElementById("select_condition_order_wrapper").click();
            document.getElementById("right_stopOrderIndex").value =
                order.sl.price;
            document.getElementById("right_price").value = "MTL";
            document.getElementById("right_selStopOrderType").value =
                order.side < 0 ? "SOL" : "SOU";
            document
                .getElementById(`btn_${order.side < 0 ? "long" : "short"}`)
                .click();
        }, 1000);
    };
    cancelOrderCallback = () => {
        this.callJavascript("onCancelAllOrderPending('order_condition')");
        this.callJavascript("onCancelAllOrderPending('order')");
    };
    toggleChartVolumeCallback = visible =>
        this.chart.toggleChartVolume(visible);
    togglePopupCallback = visible => this.popup.toggle(visible);
    alertInvalidAccessCallback = () => this.popup.alertInvalidAccess();
    callJavascript = script => {
        var button = document.createElement("button");
        button.setAttribute("onclick", script);
        button.click();
    };
    registerFullscreenEvent = () => {
        document
            .querySelector(".timeStamp")
            .addEventListener("dblclick", () => {
                if (document.fullscreenElement) document.exitFullscreen();
                else document.documentElement.requestFullscreen();
            });
    };
    detectVpsSystem = () => {
        const site = window.location.hostname.split(".")[0];
        document.body.classList.add(site);
        this.global.isSmartPro = site == "smartpro";
    };
}

var smartOrder = new SmartOrder();
smartOrder.init();

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImEuQ29uZmlnLmpzIiwiYi5BbGVydC5qcyIsImIuQ3J5cHRvLmpzIiwiYy5TdG9yZS5qcyIsImQuY2hhcnQuanMiLCJlLnBvcHVwLmpzIiwiZi5tZW51LmpzIiwiei5tYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3R1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0b0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNtYXJ0LW9yZGVyLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIENvbmZpZyB7XHJcbiAgICBhcHBOYW1lID0gXCJTbWFydE9yZGVyXCI7XHJcbiAgICB2ZXJzaW9uID0gXCIyLjAuMlwiO1xyXG4gICAgcHVibGlzaERhdGUgPSBcIjE3LzAzLzIwMjNcIjtcclxuICAgIGRldmVsb3BlciA9IFwiVGhvIFBTXCI7XHJcbiAgICBkb21haW4gPSBcImh0dHBzOi8vcXV5dHJldmFuZy5uZ3V5ZW52YW54dWFucGh1LmNvbVwiO1xyXG4gICAgZG9tYWluMSA9IFwiaHR0cDovL2xvY2FsaG9zdFwiO1xyXG4gICAgZW5kcG9pbnQgPSB7XHJcbiAgICAgICAgc29ja2V0OiBcImh0dHBzOi8vZGF0YWZlZWQudnBzLmNvbS52blwiLFxyXG4gICAgICAgIGdldENvbmZpZzogXCIvYXBpL3NvL2dldC1jb25maWdcIixcclxuICAgICAgICBzZXRDb25maWc6IFwiL2FwaS9zby9zZXQtY29uZmlnXCIsXHJcbiAgICAgICAgZ2V0QmFja2dyb3VuZDogXCIvYXBpL3NvL2JhY2tncm91bmRcIixcclxuICAgICAgICBnZXRDaGFydDogXCIvYXBpL3NvL2dldC1jaGFydFwiLFxyXG4gICAgICAgIHJlcG9ydDogXCIvYXBpL3NvL3JlcG9ydFwiLFxyXG4gICAgICAgIHJlZ2lzdGVyOiBcIi9hcGkvYXV0aC9jcmVhdGUtYWNjb3VudFwiLFxyXG4gICAgICAgIGxvZ2luOiBcIi9hcGkvYXV0aC9sb2dpblwiLFxyXG4gICAgICAgIGxvZ291dDogXCIvYXBpL2F1dGgvbG9nb3V0XCIsXHJcbiAgICAgICAgdXNlcjogXCIvYXBpL2F1dGgvc28vdXNlclwiXHJcbiAgICB9O1xyXG4gICAgdGltZUZyYW1lcyA9IFtcclxuICAgICAgICB7IHRleHQ6IFwiVGlja1wiLCB2YWx1ZTogMCB9LFxyXG4gICAgICAgIHsgdGV4dDogXCIxIG1pblwiLCB2YWx1ZTogMSB9LFxyXG4gICAgICAgIHsgdGV4dDogXCIyIG1pblwiLCB2YWx1ZTogMiB9LFxyXG4gICAgICAgIHsgdGV4dDogXCIzIG1pblwiLCB2YWx1ZTogMyB9LFxyXG4gICAgICAgIHsgdGV4dDogXCI1IG1pblwiLCB2YWx1ZTogNSB9LFxyXG4gICAgICAgIHsgdGV4dDogXCI3IG1pblwiLCB2YWx1ZTogNyB9LFxyXG4gICAgICAgIHsgdGV4dDogXCIxMCBtaW5cIiwgdmFsdWU6IDEwIH0sXHJcbiAgICAgICAgeyB0ZXh0OiBcIjE1IG1pblwiLCB2YWx1ZTogMTUgfSxcclxuICAgICAgICB7IHRleHQ6IFwiMzAgbWluXCIsIHZhbHVlOiAzMCB9LFxyXG4gICAgICAgIHsgdGV4dDogXCIxIGRheVwiLCB2YWx1ZTogMTQ0MCB9XHJcbiAgICBdO1xyXG4gICAgY2hhcnRUeXBlcyA9IFtcclxuICAgICAgICB7IHRleHQ6IFwiTuG6v25cIiwgdmFsdWU6IFwiY2FuZGxlc3RpY2tcIiB9LFxyXG4gICAgICAgIHsgdGV4dDogXCLEkMaw4budbmdcIiwgdmFsdWU6IFwibGluZVwiIH0sXHJcbiAgICAgICAgeyB0ZXh0OiBcIlRoYW5oXCIsIHZhbHVlOiBcImJhclwiIH1cclxuICAgIF07XHJcbn1cclxuIiwiY2xhc3MgQWxlcnQge1xyXG4gICAgLy8gSMOgbSBraOG7n2kgdOG6oW9cclxuICAgIGNvbnN0cnVjdG9yKCkge31cclxuICAgIC8vIEPDoWMgcGjGsMahbmcgdGjhu6ljXHJcbiAgICBzaG93ID0gKFxyXG4gICAgICAgIHN0YXR1cyA9IFwic3VjY2Vzc1wiLFxyXG4gICAgICAgIHRleHQgPSBcIm1lc3NhZ2VcIixcclxuICAgICAgICBhdXRvY2xvc2UgPSB0cnVlLFxyXG4gICAgICAgIGtlZXAgPSBmYWxzZVxyXG4gICAgKSA9PiB7XHJcbiAgICAgICAgdGhpcy5ub3RpZnkgPSBuZXcgTm90aWZ5KHtcclxuICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXHJcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXHJcbiAgICAgICAgICAgIGF1dG9jbG9zZTogYXV0b2Nsb3NlLFxyXG4gICAgICAgICAgICBwb3NpdGlvbjogXCJyaWdodCBib3R0b21cIlxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMua2VlcCA9IGtlZXA7XHJcbiAgICB9O1xyXG4gICAgaGlkZSA9ICgpID0+XHJcbiAgICAgICAgbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5rZWVwKSB0aGlzLm5vdGlmeS5jbG9zZSgpO1xyXG4gICAgICAgICAgICBlbHNlIHRoaXMua2VlcCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUoKSwgNTAwKTtcclxuICAgICAgICB9KTtcclxufVxyXG4iLCJjbGFzcyBDcnlwdG8ge1xyXG4gICAga2V5ID0gXCIxOUFxVmdHMzZla1Z6YzFIeUVtRTl2ZkE3UEg3OERGQ3doZHdVeEo3ZG5zPVwiO1xyXG4gICAgLy8gSMOgbSBraOG7n2kgdOG6oW9cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuZm9ybWF0ID0gdGhpcy5mb3JtYXRDcnlwdG8oKTtcclxuICAgIH1cclxuICAgIC8vIEPDoWMgcGjGsMahbmcgdGjhu6ljXHJcbiAgICBmb3JtYXRDcnlwdG8gPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc3RyaW5naWZ5OiBjaXBoZXJQYXJhbXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgdmFyIGogPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3Q6IGNpcGhlclBhcmFtcy5jaXBoZXJ0ZXh0LnRvU3RyaW5nKENyeXB0b0pTLmVuYy5CYXNlNjQpXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWYgKGNpcGhlclBhcmFtcy5pdikgai5pdiA9IGNpcGhlclBhcmFtcy5pdi50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNpcGhlclBhcmFtcy5zYWx0KSBqLnMgPSBjaXBoZXJQYXJhbXMuc2FsdC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGopO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwYXJzZToganNvblN0ciA9PiB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaiA9IEpTT04ucGFyc2UoanNvblN0cik7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2lwaGVyUGFyYW1zID0gQ3J5cHRvSlMubGliLkNpcGhlclBhcmFtcy5jcmVhdGUoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNpcGhlcnRleHQ6IENyeXB0b0pTLmVuYy5CYXNlNjQucGFyc2Uoai5jdClcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGouaXYpIGNpcGhlclBhcmFtcy5pdiA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2Uoai5pdik7XHJcbiAgICAgICAgICAgICAgICBpZiAoai5zKSBjaXBoZXJQYXJhbXMuc2FsdCA9IENyeXB0b0pTLmVuYy5IZXgucGFyc2Uoai5zKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjaXBoZXJQYXJhbXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIGVuY3J5cHQgPSB0ZXh0ID0+IHtcclxuICAgICAgICByZXR1cm4gQ3J5cHRvSlMuQUVTLmVuY3J5cHQoSlNPTi5zdHJpbmdpZnkodGV4dCksIHRoaXMua2V5LCB7XHJcbiAgICAgICAgICAgIGZvcm1hdDogdGhpcy5mb3JtYXRcclxuICAgICAgICB9KS50b1N0cmluZygpO1xyXG4gICAgfTtcclxuICAgIGRlY3J5cHQgPSBlbmNyeXB0ZWQgPT4ge1xyXG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKFxyXG4gICAgICAgICAgICBDcnlwdG9KUy5BRVMuZGVjcnlwdChKU09OLnN0cmluZ2lmeShlbmNyeXB0ZWQpLCB0aGlzLmtleSwge1xyXG4gICAgICAgICAgICAgICAgZm9ybWF0OiB0aGlzLmZvcm1hdFxyXG4gICAgICAgICAgICB9KS50b1N0cmluZyhDcnlwdG9KUy5lbmMuVXRmOClcclxuICAgICAgICApO1xyXG4gICAgfTtcclxufVxyXG4iLCJjbGFzcyBTdG9yZSB7XHJcbiAgICAvLyBIw6BtIGto4bufaSB04bqhb1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDw6FjIHBoxrDGoW5nIHRo4bupY1xyXG4gICAgY3JlYXRlID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihcInZwc0RCXCIsIDEpO1xyXG4gICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJvbnVwZ3JhZGVuZWVkZWRcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlID0gZS50YXJnZXQucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5jcmVhdGVPYmplY3RTdG9yZShcImRhdGFcIiwgeyBrZXlQYXRoOiBcInRpbWVcIiB9KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUuY3JlYXRlT2JqZWN0U3RvcmUoXCJvcmRlclwiLCB7IGtleVBhdGg6IFwia2luZFwiIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5jcmVhdGVPYmplY3RTdG9yZShcIm1hcmtlclwiLCB7IGtleVBhdGg6IFwidGltZVwiIH0pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zdG9yZS5jcmVhdGVPYmplY3RTdG9yZShcImxpbmVcIiwgeyBrZXlQYXRoOiBcInByaWNlXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLmNyZWF0ZU9iamVjdFN0b3JlKFwicnVsZXJcIiwgeyBrZXlQYXRoOiBcInBvaW50XCIgfSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN0b3JlLmNyZWF0ZU9iamVjdFN0b3JlKFwiYWxlcnRcIiwgeyBrZXlQYXRoOiBcInByaWNlXCIgfSk7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm9uc3VjY2Vzc1wiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUgPSBlLnRhcmdldC5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwib25lcnJvclwiKTtcclxuICAgICAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgZ2V0ID0gdGFibGVzID0+IHtcclxuICAgICAgICB2YXIgZGF0YWJhc2UgPSB0aGlzLnN0b3JlO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgdmFyIHR4ID0gZGF0YWJhc2UudHJhbnNhY3Rpb24odGFibGVzLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0YWJsZXMpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmVzID0gdGFibGVzLm1hcCh0YWJsZSA9PiB0eC5vYmplY3RTdG9yZSh0YWJsZSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb21pc2VzID0gc3RvcmVzLm1hcChsb2FkU3RvcmUpO1xyXG4gICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oYXJyID0+IHJlc29sdmUoYXJyKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSh0YWJsZXMpO1xyXG4gICAgICAgICAgICAgICAgbG9hZFN0b3JlKHN0b3JlKS50aGVuKGQgPT4gcmVzb2x2ZShkKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbG9hZFN0b3JlKHN0b3JlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXRBbGwoKTtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZSA9PiByZXNvbHZlKGUudGFyZ2V0LnJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiByZWplY3QoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHNldCA9ICh0YWJsZSwgZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy5zdG9yZVxyXG4gICAgICAgICAgICAudHJhbnNhY3Rpb24odGFibGUsIFwicmVhZHdyaXRlXCIpXHJcbiAgICAgICAgICAgIC5vYmplY3RTdG9yZSh0YWJsZSk7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEubGVuZ3RoID4gMCkgZGF0YS5mb3JFYWNoKGl0ZW0gPT4gc3RvcmUucHV0KGl0ZW0pKTtcclxuICAgICAgICB9IGVsc2Ugc3RvcmUucHV0KGRhdGEpO1xyXG4gICAgfTtcclxuICAgIGNsZWFyID0gdGFibGUgPT4ge1xyXG4gICAgICAgIHZhciBkYXRhYmFzZSA9IHRoaXMuc3RvcmU7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gZGF0YWJhc2VcclxuICAgICAgICAgICAgICAgIC50cmFuc2FjdGlvbih0YWJsZSwgXCJyZWFkd3JpdGVcIilcclxuICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSh0YWJsZSlcclxuICAgICAgICAgICAgICAgIC5jbGVhcigpO1xyXG5cclxuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgdG8gZW1wdHkgT2JqZWN0IFN0b3JlOiAke3RhYmxlfWApO1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KCk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG59XHJcbiIsImNsYXNzIENoYXJ0IHtcclxuICAgIC8vIEPDoWMgdGh14buZYyB0w61uaFxyXG4gICAgY2hhcnQgPSB7fTtcclxuICAgIHNlcmllcyA9IHt9O1xyXG4gICAgZGF0YSA9IHsgb3JpZ2luYWw6IFtdLCBwcmljZTogW10sIHZvbHVtZTogW10gfTtcclxuICAgIG9yZGVyID0geyBlbnRyeToge30sIHRwOiB7fSwgc2w6IHt9IH07XHJcbiAgICBsaW5lcyA9IFtdO1xyXG4gICAgbWFrZXJzID0gW107XHJcbiAgICBydWxlciA9IHsgc3RhcnQ6IHt9LCBlbmQ6IHt9LCBwb2ludDogMCB9O1xyXG4gICAgYWxlcnRzID0gW107XHJcbiAgICBjcm9zc2hhaXIgPSB7fTtcclxuICAgIGhhc0Nyb3NzaGFpciA9IGZhbHNlO1xyXG4gICAgaGFzTmV3RGF0YSA9IGZhbHNlO1xyXG4gICAgYWxlcnRBdWRpbyA9IG5ldyBBdWRpbyhjaHJvbWUucnVudGltZS5nZXRVUkwoXCJhbGVydC53YXZcIikpO1xyXG4gICAgVVBfQ09MT1IgPSBcInJnYigzOCwxNjYsMTU0KVwiO1xyXG4gICAgRE9XTl9DT0xPUiA9IFwicmdiKDIzOSw4Myw4MClcIjtcclxuXHJcbiAgICAvLyBIw6BtIGto4bufaSB04bqhb1xyXG4gICAgY29uc3RydWN0b3IoZ2xvYmFsLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsID0gZ2xvYmFsO1xyXG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcclxuICAgICAgICB0aGlzLmdsb2JhbC50b2dnbGVTcGlubmVyID0gdGhpcy50b2dnbGVTcGlubmVyO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsLmlzSW5TZXNzaW9uID0gdGhpcy5pc0luU2Vzc2lvbjtcclxuICAgICAgICB0aGlzLmFsZXJ0QXVkaW8ubG9vcCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ8OhYyBwaMawxqFuZyB0aOG7qWNcclxuICAgIGNyZWF0ZSA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLnRpbWVGcmFtZSA9IHRoaXMuZ2xvYmFsLnRpbWVGcmFtZTtcclxuICAgICAgICB0aGlzLmNoYXJ0VHlwZSA9IHRoaXMuZ2xvYmFsLmNoYXJ0VHlwZTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUNvbnRhaW5lckVsZW1lbnQoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUNoYXJ0KCk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVEYXRhQXJlYSgpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlVG9vbEFyZWEoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUxlZ2VuZEFyZWEoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUZyZWVBcmVhKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZ2xvYmFsLmlzT3BlbmluZ01hcmtldCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlY0ludGVydmFsID0gc2V0SW50ZXJ2YWwoXHJcbiAgICAgICAgICAgICAgICAoKSA9PiB0aGlzLnNlY0ludGVydmFsSGFuZGxlcih0aGlzKSxcclxuICAgICAgICAgICAgICAgIDEwMDBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5taW5JbnRlcnZhbCA9IHNldEludGVydmFsKFxyXG4gICAgICAgICAgICAgICAgKCkgPT4gdGhpcy5taW5JbnRlcnZhbEhhbmRsZXIodGhpcyksXHJcbiAgICAgICAgICAgICAgICA2MDAwMFxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCAoKSA9PiB0aGlzLmV2ZW50Q2hhcnRSZXNpemUodGhpcykpO1xyXG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBlID0+IHRoaXMuZXZlbnRLZXlQcmVzcyhlLCB0aGlzKSk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3ZlID0gKCkgPT4ge1xyXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsICgpID0+IHRoaXMuZXZlbnRDaGFydFJlc2l6ZSh0aGlzKSk7XHJcbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGUgPT4gdGhpcy5ldmVudEtleVByZXNzKGUsIHRoaXMpKTtcclxuICAgICAgICBjbGVhckludGVydmFsKHRoaXMuc2VjSW50ZXJ2YWwpO1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5taW5JbnRlcnZhbCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQucmVtb3ZlKCk7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlQ29udGFpbmVyRWxlbWVudCA9ICgpID0+IHtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZChjb250YWluZXIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5pZCA9IFwibGlnaHRXZWlnaHRDaGFydENvbnRhaW5lclwiO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS53aWR0aCA9IFwiMTAwdndcIjtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gXCIxMDB2aFwiO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGNoYXJ0Q29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBjb250YWluZXIucHJlcGVuZChjaGFydENvbnRhaW5lcik7XHJcbiAgICAgICAgY2hhcnRDb250YWluZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICBjaGFydENvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcclxuICAgICAgICBjaGFydENvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZSA9PlxyXG4gICAgICAgICAgICB0aGlzLmV2ZW50Q2hhcnRDb250ZXh0bWVudShlLCB0aGlzKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY2hhcnRDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT5cclxuICAgICAgICAgICAgdGhpcy5ldmVudENoYXJ0Q2xpY2soZSwgdGhpcylcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmNoYXJ0Q29udGFpbmVyRWxlbWVudCA9IGNoYXJ0Q29udGFpbmVyO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZUNoYXJ0ID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGNoYXJ0T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbG9jYWxpemF0aW9uOiB7IGRhdGVGb3JtYXQ6IFwiZGQvTU0veXl5eVwiLCBsb2NhbGU6IFwidmktVk5cIiB9LFxyXG4gICAgICAgICAgICByaWdodFByaWNlU2NhbGU6IHtcclxuICAgICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzY2FsZU1hcmdpbnM6IHRoaXMuZ2xvYmFsLmlzVm9sdW1lXHJcbiAgICAgICAgICAgICAgICAgICAgPyB7IHRvcDogMC4xLCBib3R0b206IDAuMjEgfVxyXG4gICAgICAgICAgICAgICAgICAgIDogeyB0b3A6IDAuMiwgYm90dG9tOiAwLjEgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBsZWZ0UHJpY2VTY2FsZTogeyB2aXNpYmxlOiBmYWxzZSB9LFxyXG4gICAgICAgICAgICBsYXlvdXQ6IHtcclxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjMDAwMDAwXCIsXHJcbiAgICAgICAgICAgICAgICB0ZXh0Q29sb3I6IFwiI0NDQ0NDQ1wiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdyaWQ6IHtcclxuICAgICAgICAgICAgICAgIHZlcnRMaW5lczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcIiMxQjFFMjdcIixcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogTGlnaHR3ZWlnaHRDaGFydHMuTGluZVN0eWxlLkRhc2hlZFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhvcnpMaW5lczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiBcIiMxQjFFMjdcIixcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogTGlnaHR3ZWlnaHRDaGFydHMuTGluZVN0eWxlLkRhc2hlZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjcm9zc2hhaXI6IHsgbW9kZTogTGlnaHR3ZWlnaHRDaGFydHMuQ3Jvc3NoYWlyTW9kZS5Ob3JtYWwgfSxcclxuICAgICAgICAgICAgdGltZVNjYWxlOiB7XHJcbiAgICAgICAgICAgICAgICB0aW1lVmlzaWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHJpZ2h0T2Zmc2V0OiAyMCxcclxuICAgICAgICAgICAgICAgIG1pbkJhclNwYWNpbmc6IDAuMVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmNoYXJ0ID0gTGlnaHR3ZWlnaHRDaGFydHMuY3JlYXRlQ2hhcnQoXHJcbiAgICAgICAgICAgIHRoaXMuY2hhcnRDb250YWluZXJFbGVtZW50LFxyXG4gICAgICAgICAgICBjaGFydE9wdGlvbnNcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuY2hhcnQuc3Vic2NyaWJlQ3Jvc3NoYWlyTW92ZShlID0+XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRDaGFydENyb3NzaGFpck1vdmUoZSwgdGhpcylcclxuICAgICAgICApO1xyXG4gICAgICAgIHRoaXMuY2hhcnQuc3Vic2NyaWJlQ3VzdG9tUHJpY2VMaW5lRHJhZ2dlZChlID0+XHJcbiAgICAgICAgICAgIHRoaXMuZXZlbnRQcmljZUxpbmVEcmFnKGUsIHRoaXMpXHJcbiAgICAgICAgKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMuc2VyaWVzLnZvbHVtZSA9IHRoaXMuY2hhcnQuYWRkSGlzdG9ncmFtU2VyaWVzKHtcclxuICAgICAgICAgICAgcHJpY2VTY2FsZUlkOiBcInZvbHVtZVwiLFxyXG4gICAgICAgICAgICBwcmljZUZvcm1hdDogeyB0eXBlOiBcInZvbHVtZVwiIH0sXHJcbiAgICAgICAgICAgIHNjYWxlTWFyZ2luczogeyB0b3A6IDAuOCwgYm90dG9tOiAwIH0sXHJcbiAgICAgICAgICAgIHZpc2libGU6IHRoaXMuZ2xvYmFsLmlzVm9sdW1lXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB0aGlzLmNyZWF0ZVByaWNlU2VyaWVzKCk7XHJcbiAgICAgICAgdGhpcy5jaGFydC50aW1lU2NhbGUoKS5maXRDb250ZW50KCk7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlUHJpY2VTZXJpZXMgPSAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmNoYXJ0VHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIFwiY2FuZGxlc3RpY2tcIjpcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlID0gdGhpcy5jaGFydC5hZGRDYW5kbGVzdGlja1Nlcmllcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2VGb3JtYXQ6IHsgbWluTW92ZTogMC4xIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJsaW5lXCI6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmllcy5wcmljZSA9IHRoaXMuY2hhcnQuYWRkTGluZVNlcmllcyh7XHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IFwiI0NDQ0NDQ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlRm9ybWF0OiB7IG1pbk1vdmU6IDAuMSB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiYmFyXCI6XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcmllcy5wcmljZSA9IHRoaXMuY2hhcnQuYWRkQmFyU2VyaWVzKHtcclxuICAgICAgICAgICAgICAgICAgICB0aGluQmFyczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2VGb3JtYXQ6IHsgbWluTW92ZTogMC4xIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGNyZWF0ZURhdGFBcmVhID0gKCkgPT4ge1xyXG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGNvbnRhaW5lci5pZCA9IFwiZGF0YUFyZWFEaXZcIjtcclxuICAgICAgICBjb250YWluZXIuY2xhc3NOYW1lID0gXCJhcmVhXCI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChjb250YWluZXIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgICAgaW1nLmlkID0gXCJzcGlubmVySW1nXCI7XHJcbiAgICAgICAgaW1nLnN0eWxlLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgIGltZy5zcmMgPSBjaHJvbWUucnVudGltZS5nZXRVUkwoXCJzcGlubmVyLmdpZlwiKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGltZyk7XHJcbiAgICAgICAgdGhpcy5zcGlubmVySW1nID0gaW1nO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LmlkID0gXCJkYXRlSW5wdXRcIjtcclxuICAgICAgICBpbnB1dC50eXBlID0gXCJkYXRlXCI7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSBtb21lbnQoKS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpO1xyXG4gICAgICAgIGlucHV0LmNsYXNzTmFtZSA9IFwiY29tbWFuZFwiO1xyXG4gICAgICAgIGlucHV0LnRpdGxlID0gXCJE4buvIGxp4buHdSBj4bunYSBuZ8OgeVwiO1xyXG4gICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICghIWUudGFyZ2V0LnZhbHVlKSB0aGlzLmxvYWRDaGFydERhdGEoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGlucHV0KTtcclxuICAgICAgICB0aGlzLmRhdGVJbnB1dCA9IGlucHV0O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XHJcbiAgICAgICAgc2VsZWN0LmlkID0gXCJjaGFydFR5cGVTZWxlY3RcIjtcclxuICAgICAgICBzZWxlY3QuY2xhc3NOYW1lID0gXCJjb21tYW5kXCI7XHJcbiAgICAgICAgc2VsZWN0LnRpdGxlID0gXCJMb+G6oWkgYmnhu4N1IMSR4buTIGdpw6FcIjtcclxuICAgICAgICB0aGlzLmdsb2JhbC5jaGFydFR5cGVzLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xyXG4gICAgICAgICAgICBvcHRpb24udmFsdWUgPSBpdGVtLnZhbHVlO1xyXG4gICAgICAgICAgICBvcHRpb24udGV4dCA9IGl0ZW0udGV4dDtcclxuICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgc2VsZWN0LnZhbHVlID0gdGhpcy5jaGFydFR5cGU7XHJcbiAgICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVGcmFtZSA9PSAwICYmIGUudGFyZ2V0LnZhbHVlICE9IFwibGluZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJ0VHlwZVNlbGVjdC52YWx1ZSA9IFwibGluZVwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnQuc2hvdyhcclxuICAgICAgICAgICAgICAgICAgICBcIndhcm5pbmdcIixcclxuICAgICAgICAgICAgICAgICAgICBcIkNo4buJIGPDsyB0aOG7gyBt4bufIGJp4buDdSDEkeG7kyDEkMaw4budbmcgdHJvbmcga2h1bmcgdGjhu51pIGdpYW4gVGljay5cIlxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNoYXJ0VHlwZSA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLmNoYXJ0LnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNoYXJ0KCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnNldERhdGEodGhpcy5kYXRhLnByaWNlKTtcclxuICAgICAgICAgICAgdGhpcy5zZXJpZXMudm9sdW1lLnNldERhdGEodGhpcy5kYXRhLnZvbHVtZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0VG9vbHNEYXRhKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChzZWxlY3QpO1xyXG4gICAgICAgIHRoaXMuY2hhcnRUeXBlU2VsZWN0ID0gc2VsZWN0O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XHJcbiAgICAgICAgc2VsZWN0LmlkID0gXCJ0aW1lRnJhbWVTZWxlY3RcIjtcclxuICAgICAgICBzZWxlY3QuY2xhc3NOYW1lID0gXCJjb21tYW5kXCI7XHJcbiAgICAgICAgc2VsZWN0LnRpdGxlID0gXCJLaHVuZyB0aOG7nWkgZ2lhbiBbQ3RybCswXVwiO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsLnRpbWVGcmFtZXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gaXRlbS50ZXh0O1xyXG4gICAgICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzZWxlY3QudmFsdWUgPSB0aGlzLnRpbWVGcmFtZTtcclxuICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBlID0+IHtcclxuICAgICAgICAgICAgdGhpcy50aW1lRnJhbWUgPSBlLnRhcmdldC52YWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5sb2FkQ2hhcnREYXRhKCkudGhlbigoKSA9PlxyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFydC50aW1lU2NhbGUoKS5yZXNldFRpbWVTY2FsZSgpXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnRpbWVGcmFtZSA9PSAwICYmIHRoaXMuY2hhcnRUeXBlICE9IFwibGluZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJ0VHlwZVNlbGVjdC52YWx1ZSA9IFwibGluZVwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFydFR5cGVTZWxlY3QuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoXCJjaGFuZ2VcIikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChzZWxlY3QpO1xyXG4gICAgICAgIHRoaXMudGltZUZyYW1lU2VsZWN0ID0gc2VsZWN0O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgYnV0dG9uLmNsYXNzTmFtZSA9IFwiY29tbWFuZCBmYSBmYS1yZWZyZXNoXCI7XHJcbiAgICAgICAgYnV0dG9uLnRpdGxlID0gXCJMw6BtIG3hu5tpIFtDdHJsK01dXCI7XHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmxvYWRDaGFydERhdGEoKSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMucmVmcmVzaEJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcImNvbW1hbmQgZmEgZmEtdHJhc2hcIjtcclxuICAgICAgICBidXR0b24udGl0bGUgPSBcIlhvw6EgbmfDoHkga2jDoWMgW0N0cmwrLF1cIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuc3RvcmUuY2xlYXIoXCJkYXRhXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmxvYWRDaGFydERhdGEoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGJ1dHRvbik7XHJcbiAgICAgICAgdGhpcy5jbGVhckJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgIH07XHJcbiAgICBjcmVhdGVUb29sQXJlYSA9ICgpID0+IHtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBjb250YWluZXIuaWQgPSBcInRvb2xBcmVhRGl2XCI7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwiYXJlYVwiO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5hcHBlbmQoY29udGFpbmVyKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcImNvbW1hbmQgZmEgZmEtbWludXNcIjtcclxuICAgICAgICBidXR0b24udGl0bGUgPSBcIlbhur0gxJHGsOG7nW5nIG5nYW5nIFtDdHJsK0tdW0N0cmwrU2hpZnQrS11cIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdG9vbEFyZWFEaXYgPiAuY29tbWFuZFwiKVxyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpKTtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3RlZCkgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlSG9yaXpvbnRhbExpbmUoKTtcclxuICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMuZHJhd0xpbmVCdXR0b24gPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBidXR0b24uY2xhc3NOYW1lID0gXCJjb21tYW5kIGZhIGZhLW1hcC1tYXJrZXJcIjtcclxuICAgICAgICBidXR0b24udGl0bGUgPSBcIlbhur0gxJHDoW5oIGThuqV1IFtDdHJsK0xdW0N0cmwrU2hpZnQrTF1cIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdG9vbEFyZWFEaXYgPiAuY29tbWFuZFwiKVxyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpKTtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3RlZCkgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlTWFrZXIoKTtcclxuICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMuZHJhd01hcmtlckJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSBcImNvbW1hbmQgZmEgZmEtYXJyb3dzLXZcIjtcclxuICAgICAgICBidXR0b24udGl0bGUgPSBcIlRoxrDhu5tjIMSRbyBnacOhIFtDdHJsKztdW0N0cmwrU2hpZnQrO11cIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdG9vbEFyZWFEaXYgPiAuY29tbWFuZFwiKVxyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpKTtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3RlZCkge1xyXG4gICAgICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVSdWxlcigpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5yZW1vdmVSdWxlcigpO1xyXG4gICAgICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGJ1dHRvbik7XHJcbiAgICAgICAgdGhpcy5kcmF3UnVsZXJCdXR0b24gPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBidXR0b24uY2xhc3NOYW1lID0gXCJjb21tYW5kIGZhIGZhLWJlbGwtb1wiO1xyXG4gICAgICAgIGJ1dHRvbi50aXRsZSA9IFwixJDhurd0IGPhuqNuaCBiw6FvIFtDdHJsKyddW0N0cmwrU2hpZnQrJ11cIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdG9vbEFyZWFEaXYgPiAuY29tbWFuZFwiKVxyXG4gICAgICAgICAgICAgICAgLmZvckVhY2goZWwgPT4gZWwuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpKTtcclxuICAgICAgICAgICAgaWYgKCFzZWxlY3RlZCkgZS50YXJnZXQuY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY29udGV4dG1lbnVcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQWxlcnQoKTtcclxuICAgICAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMuZHJhd0FsZXJ0QnV0dG9uID0gYnV0dG9uO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZUxlZ2VuZEFyZWEgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmlkID0gXCJsZWdlbmRBcmVhRGl2XCI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChjb250YWluZXIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicFwiKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHApO1xyXG4gICAgICAgIHRoaXMucHJpY2VMZWdlbmRQID0gcDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInBcIik7XHJcbiAgICAgICAgcC5zdHlsZS5kaXNwbGF5ID0gdGhpcy5nbG9iYWwuaXNWb2x1bWUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHApO1xyXG4gICAgICAgIHRoaXMudm9sdW1lTGVnZW5kUCA9IHA7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlRnJlZUFyZWEgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyRWxlbWVudDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgIGJ1dHRvbi5pZCA9IFwiY2FuY2VsT3JkZXJCdXR0b25cIjtcclxuICAgICAgICBidXR0b24uaW5uZXJUZXh0ID0gXCJYXCI7XHJcbiAgICAgICAgYnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFjay5jbG9zZU9yZGVyUG9zaXRpb25DYWxsYmFjaygpO1xyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrLmNhbmNlbE9yZGVyQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVDYW5jZWxPcmRlckJ1dHRvbihmYWxzZSk7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlT3JkZXJMaW5lKFwiZW50cnlcIik7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlT3JkZXJMaW5lKFwidHBcIik7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlT3JkZXJMaW5lKFwic2xcIik7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLnN0b3JlLmNsZWFyKFwib3JkZXJcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMuY2FuY2VsT3JkZXJCdXR0b24gPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBidXR0b24uaWQgPSBcImVudHJ5T3JkZXJCdXR0b25cIjtcclxuICAgICAgICBidXR0b24uaW5uZXJUZXh0ID0gXCJFbnRyeVwiO1xyXG4gICAgICAgIGJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2sub3JkZXJFbnRyeVByaWNlQ2FsbGJhY2sodGhpcy5vcmRlcik7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd09yZGVyTGluZShcImVudHJ5XCIpO1xyXG4gICAgICAgICAgICB0aGlzLnRvZ2dsZUNhbmNlbE9yZGVyQnV0dG9uKHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLmhpZGVPcmRlckJ1dHRvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQoYnV0dG9uKTtcclxuICAgICAgICB0aGlzLmVudHJ5T3JkZXJCdXR0b24gPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBidXR0b24uaWQgPSBcInRwc2xPcmRlckJ1dHRvblwiO1xyXG4gICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSBcIlRQL1NMXCI7XHJcbiAgICAgICAgYnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsYmFjay5vcmRlclRwUHJpY2VDYWxsYmFjayh0aGlzLm9yZGVyLCB0cnVlKTtcclxuICAgICAgICAgICAgdGhpcy5kcmF3T3JkZXJMaW5lKFwidHBcIik7XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2sub3JkZXJTbFByaWNlQ2FsbGJhY2sodGhpcy5vcmRlciwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd09yZGVyTGluZShcInNsXCIpO1xyXG4gICAgICAgICAgICB0aGlzLmhpZGVPcmRlckJ1dHRvbigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmQoYnV0dG9uKTtcclxuICAgICAgICB0aGlzLnRwc2xPcmRlckJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGJ1dHRvbi5pZCA9IFwic2Nyb2xsQnV0dG9uXCI7XHJcbiAgICAgICAgYnV0dG9uLmNsYXNzTmFtZSA9IFwiY29tbWFuZCBmYSBmYS1hbmdsZS1kb3VibGUtcmlnaHRcIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuY2hhcnQudGltZVNjYWxlKCkuc2Nyb2xsVG9SZWFsVGltZSgpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKGJ1dHRvbik7XHJcbiAgICB9O1xyXG4gICAgZXZlbnRDaGFydENvbnRleHRtZW51ID0gKGUsIHNlbGYpID0+IHtcclxuICAgICAgICBpZiAoc2VsZi5nbG9iYWwuaXNTbWFydFBybykgc2VsZi5zaG93T3JkZXJCdXR0b24oKTtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9O1xyXG4gICAgZXZlbnRDaGFydENsaWNrID0gKGUsIHNlbGYpID0+IHtcclxuICAgICAgICBzZWxmLmhpZGVPcmRlckJ1dHRvbigpO1xyXG4gICAgICAgIGlmIChzZWxmLmRyYXdMaW5lQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucyhcInNlbGVjdGVkXCIpKVxyXG4gICAgICAgICAgICBzZWxmLmRyYXdIb3Jpem9udGFsTGluZSgpO1xyXG4gICAgICAgIGVsc2UgaWYgKHNlbGYuZHJhd01hcmtlckJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJzZWxlY3RlZFwiKSlcclxuICAgICAgICAgICAgc2VsZi5kcmF3TWFrZXIoKTtcclxuICAgICAgICBlbHNlIGlmIChzZWxmLmRyYXdSdWxlckJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJzZWxlY3RlZFwiKSlcclxuICAgICAgICAgICAgc2VsZi5kcmF3UnVsZXIoKTtcclxuICAgICAgICBlbHNlIGlmIChzZWxmLmRyYXdBbGVydEJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJzZWxlY3RlZFwiKSlcclxuICAgICAgICAgICAgc2VsZi5kcmF3QWxlcnQoKTtcclxuICAgIH07XHJcbiAgICBldmVudENoYXJ0Q3Jvc3NoYWlyTW92ZSA9IChlLCBzZWxmKSA9PiB7XHJcbiAgICAgICAgaWYgKGUudGltZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJpY2UgPSBlLnNlcmllc1ByaWNlcy5nZXQoc2VsZi5zZXJpZXMucHJpY2UpO1xyXG4gICAgICAgICAgICB2YXIgdm9sdW1lID0gZS5zZXJpZXNQcmljZXMuZ2V0KHNlbGYuc2VyaWVzLnZvbHVtZSk7XHJcbiAgICAgICAgICAgIGlmICghIXByaWNlICYmIHNlbGYuY2hhcnRUeXBlICE9IFwibGluZVwiKSBwcmljZSA9IHByaWNlLmNsb3NlO1xyXG4gICAgICAgICAgICBzZWxmLnVwZGF0ZUxlZ2VuZChwcmljZSwgdm9sdW1lKTtcclxuICAgICAgICAgICAgc2VsZi5oYXNDcm9zc2hhaXIgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZWxmLmNyb3NzaGFpci50aW1lID0gZS50aW1lO1xyXG4gICAgICAgICAgICBzZWxmLmNyb3NzaGFpci5wcmljZSA9IHByaWNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYuaGFzQ3Jvc3NoYWlyID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICghc2VsZi5nbG9iYWwuaXNNb2JpbGUpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuY3Jvc3NoYWlyLnRpbWUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5jcm9zc2hhaXIucHJpY2UgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlLnBvaW50ICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBzZWxmLmNyb3NzaGFpci54ID0gZS5wb2ludC54O1xyXG4gICAgICAgICAgICBzZWxmLmNyb3NzaGFpci55ID0gZS5wb2ludC55O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBldmVudFByaWNlTGluZURyYWcgPSAoZSwgc2VsZikgPT4ge1xyXG4gICAgICAgIHZhciBsaW5lID0gZS5jdXN0b21QcmljZUxpbmU7XHJcbiAgICAgICAgdmFyIGxpbmVPcHRpb25zID0gbGluZS5vcHRpb25zKCk7XHJcbiAgICAgICAgbGluZU9wdGlvbnMucHJpY2UgPSBzZWxmLmZvcm1hdFByaWNlKGxpbmVPcHRpb25zLnByaWNlKTtcclxuICAgICAgICBjb25zdCBvbGRQcmljZSA9ICtlLmZyb21QcmljZVN0cmluZztcclxuICAgICAgICBjb25zdCBuZXdQcmljZSA9IGxpbmVPcHRpb25zLnByaWNlO1xyXG4gICAgICAgIHN3aXRjaCAobGluZU9wdGlvbnMubGluZVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSBcIm9yZGVyXCI6XHJcbiAgICAgICAgICAgICAgICBpZiAobmV3UHJpY2UgIT0gb2xkUHJpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXNDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zaXRpb24gPSBzZWxmLmNhbGxiYWNrLmdldE9yZGVyUG9zaXRpb25DYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lT3B0aW9ucy5raW5kID09IFwiZW50cnlcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0NoYW5nZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5vcmRlcltsaW5lT3B0aW9ucy5raW5kXS5wcmljZSA9IG5ld1ByaWNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFjay5vcmRlckVudHJ5UHJpY2VDYWxsYmFjayhzZWxmLm9yZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZHJhd09yZGVyTGluZShsaW5lT3B0aW9ucy5raW5kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLm9yZGVyLnNpZGUgKiBwb3NpdGlvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm9yZGVyW2xpbmVPcHRpb25zLmtpbmRdLnByaWNlID0gbmV3UHJpY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGluZU9wdGlvbnMua2luZCA9PSBcInRwXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFjay5vcmRlclRwUHJpY2VDYWxsYmFjayhzZWxmLm9yZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugc2VsZi5jYWxsYmFjay5vcmRlclNsUHJpY2VDYWxsYmFjayhzZWxmLm9yZGVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZHJhd09yZGVyTGluZShsaW5lT3B0aW9ucy5raW5kKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghaXNDaGFuZ2VkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUuYXBwbHlPcHRpb25zKHsgcHJpY2U6IG9sZFByaWNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hbGVydC5zaG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3YXJuaW5nXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIktow7RuZyDEkcaw4bujYyB0aGF5IMSR4buVaS5cIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwibGluZVwiOlxyXG4gICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuc3RvcmUuc2V0KFwibGluZVwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IG9sZFByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZWQ6IHRydWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuc3RvcmUuc2V0KFwibGluZVwiLCBsaW5lT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdMaW5lQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwicnVsZXJcIjpcclxuICAgICAgICAgICAgICAgIGlmIChsaW5lT3B0aW9ucy5wb2ludCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuc3RvcmUuc2V0KFwicnVsZXJcIiwgbGluZU9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLnJ1bGVyLnBvaW50ID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSArc2VsZi5ydWxlci5lbmQub3B0aW9ucygpLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRQcmljZSA9ICsobmV3UHJpY2UgKyBkaXN0YW5jZSkudG9GaXhlZCgxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ydWxlci5lbmQuYXBwbHlPcHRpb25zKHsgcHJpY2U6IGVuZFByaWNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5zdG9yZS5zZXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInJ1bGVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJ1bGVyLmVuZC5vcHRpb25zKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHJpY2UgPSArc2VsZi5ydWxlci5zdGFydC5vcHRpb25zKCkucHJpY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSAobmV3UHJpY2UgLSBzdGFydFByaWNlKS50b0ZpeGVkKDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxpbmUuYXBwbHlPcHRpb25zKHsgdGl0bGU6IGRpc3RhbmNlIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnN0b3JlLnNldChcInJ1bGVyXCIsIGxpbmUub3B0aW9ucygpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwiYWxlcnRcIjpcclxuICAgICAgICAgICAgICAgIHNlbGYuYWxlcnRBdWRpby5wYXVzZSgpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuc3RvcmUuc2V0KFwiYWxlcnRcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlOiBvbGRQcmljZSxcclxuICAgICAgICAgICAgICAgICAgICByZW1vdmVkOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQcmljZSA9IHNlbGYuZGF0YS5wcmljZS5zbGljZSgtMSlbMF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSBuZXdQcmljZSA+PSBjdXJyZW50UHJpY2UgPyBcIj5cIiA6IFwiPFwiO1xyXG4gICAgICAgICAgICAgICAgbGluZS5hcHBseU9wdGlvbnMoeyB0aXRsZTogdGl0bGUgfSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5zdG9yZS5zZXQoXCJhbGVydFwiLCBsaW5lLm9wdGlvbnMoKSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdBbGVydEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy9cclxuICAgIHNob3dPcmRlckJ1dHRvbiA9ICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5jYWxsYmFjay5nZXRPcmRlclBvc2l0aW9uQ2FsbGJhY2soKSkge1xyXG4gICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyLmVudHJ5Lmhhc093blByb3BlcnR5KFwibGluZVwiKSAmJlxyXG4gICAgICAgICAgICAgICAgIXRoaXMub3JkZXIudHAuaGFzT3duUHJvcGVydHkoXCJsaW5lXCIpXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cHNsT3JkZXJCdXR0b24uc3R5bGUubGVmdCA9XHJcbiAgICAgICAgICAgICAgICAgICAgKyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9zc2hhaXIueCArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICh0aGlzLmNyb3NzaGFpci54ID4gaW5uZXJXaWR0aCAtIDYxID8gLTYxIDogMSlcclxuICAgICAgICAgICAgICAgICAgICApICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cHNsT3JkZXJCdXR0b24uc3R5bGUudG9wID1cclxuICAgICAgICAgICAgICAgICAgICArKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3NzaGFpci55ICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuY3Jvc3NoYWlyLnkgPiBpbm5lckhlaWdodCAtIDUxID8gLTUxIDogMSlcclxuICAgICAgICAgICAgICAgICAgICApICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cHNsT3JkZXJCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5vcmRlci5lbnRyeS5oYXNPd25Qcm9wZXJ0eShcImxpbmVcIikpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlID0gdGhpcy5jb29yZGluYXRlVG9QcmljZSh0aGlzLmNyb3NzaGFpci55KTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNpZGUgPVxyXG4gICAgICAgICAgICAgICAgICAgIHByaWNlID49IHRoaXMuZGF0YS5wcmljZS5zbGljZSgtMSlbMF0udmFsdWUgPyAxIDogLTE7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyLmVudHJ5LnByaWNlID0gcHJpY2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9yZGVyLnNpZGUgPSBzaWRlO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuZW50cnlPcmRlckJ1dHRvbi5zdHlsZS5sZWZ0ID1cclxuICAgICAgICAgICAgICAgICAgICArKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3NzaGFpci54ICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuY3Jvc3NoYWlyLnggPiBpbm5lcldpZHRoIC0gNzEgPyAtNzEgOiAxKVxyXG4gICAgICAgICAgICAgICAgICAgICkgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVudHJ5T3JkZXJCdXR0b24uc3R5bGUudG9wID1cclxuICAgICAgICAgICAgICAgICAgICArKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyb3NzaGFpci55ICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuY3Jvc3NoYWlyLnkgPiBpbm5lckhlaWdodCAtIDYxID8gLTYxIDogMSlcclxuICAgICAgICAgICAgICAgICAgICApICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbnRyeU9yZGVyQnV0dG9uLnN0eWxlLmJhY2tncm91bmQgPVxyXG4gICAgICAgICAgICAgICAgICAgIHNpZGUgPiAwID8gXCJncmVlblwiIDogXCJyZWRcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW50cnlPcmRlckJ1dHRvbi5pbm5lclRleHQgPSBgJHtcclxuICAgICAgICAgICAgICAgICAgICBzaWRlID4gMCA/IFwiTE9OR1wiIDogXCJTSE9SVFwiXHJcbiAgICAgICAgICAgICAgICB9ICR7cHJpY2V9YDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW50cnlPcmRlckJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGhpZGVPcmRlckJ1dHRvbiA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmVudHJ5T3JkZXJCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIHRoaXMudHBzbE9yZGVyQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIH07XHJcbiAgICAvL1xyXG4gICAgZHJhd09yZGVyTGluZSA9IGtpbmQgPT4ge1xyXG4gICAgICAgIHZhciBjb2xvciwgdGl0bGU7XHJcbiAgICAgICAgc3dpdGNoIChraW5kKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJlbnRyeVwiOlxyXG4gICAgICAgICAgICAgICAgY29sb3IgPSBcInNpbHZlclwiO1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgPSB0aGlzLm9yZGVyLnNpZGUgPiAwID8gXCJMb25nXCIgOiBcIlNob3J0XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcInRwXCI6XHJcbiAgICAgICAgICAgICAgICBjb2xvciA9IFwibGltZVwiO1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgPSBNYXRoLmFicyhcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9yZGVyLnRwLnByaWNlIC0gdGhpcy5vcmRlci5lbnRyeS5wcmljZVxyXG4gICAgICAgICAgICAgICAgKS50b0ZpeGVkKDEpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJzbFwiOlxyXG4gICAgICAgICAgICAgICAgY29sb3IgPSBcInJlZFwiO1xyXG4gICAgICAgICAgICAgICAgdGl0bGUgPSBNYXRoLmFicyhcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm9yZGVyLnNsLnByaWNlIC0gdGhpcy5vcmRlci5lbnRyeS5wcmljZVxyXG4gICAgICAgICAgICAgICAgKS50b0ZpeGVkKDEpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm9yZGVyW2tpbmRdLmhhc093blByb3BlcnR5KFwibGluZVwiKSkge1xyXG4gICAgICAgICAgICB0aGlzLm9yZGVyW2tpbmRdLmxpbmUuYXBwbHlPcHRpb25zKHtcclxuICAgICAgICAgICAgICAgIHByaWNlOiB0aGlzLm9yZGVyW2tpbmRdLnByaWNlLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMub3JkZXJba2luZF0ubGluZSA9IHRoaXMuc2VyaWVzLnByaWNlLmNyZWF0ZVByaWNlTGluZSh7XHJcbiAgICAgICAgICAgICAgICBsaW5lVHlwZTogXCJvcmRlclwiLFxyXG4gICAgICAgICAgICAgICAga2luZDoga2luZCxcclxuICAgICAgICAgICAgICAgIHByaWNlOiB0aGlzLm9yZGVyW2tpbmRdLnByaWNlLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6IGNvbG9yLFxyXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICAgICAgICAgICAgbGluZVN0eWxlOiBMaWdodHdlaWdodENoYXJ0cy5MaW5lU3R5bGUuU29saWQsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZ2xvYmFsLnN0b3JlLnNldChcIm9yZGVyXCIsIHtcclxuICAgICAgICAgICAga2luZDoga2luZCxcclxuICAgICAgICAgICAgcHJpY2U6ICt0aGlzLm9yZGVyW2tpbmRdLnByaWNlLFxyXG4gICAgICAgICAgICBzaWRlOiB0aGlzLm9yZGVyLnNpZGVcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZW1vdmVPcmRlckxpbmUgPSBraW5kID0+IHtcclxuICAgICAgICBpZiAodGhpcy5vcmRlcltraW5kXS5oYXNPd25Qcm9wZXJ0eShcImxpbmVcIikpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXJpZXMucHJpY2UucmVtb3ZlUHJpY2VMaW5lKHRoaXMub3JkZXJba2luZF0ubGluZSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm9yZGVyW2tpbmRdLmxpbmU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8vXHJcbiAgICBkcmF3SG9yaXpvbnRhbExpbmUgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgVFlQRSA9IFwibGluZVwiO1xyXG4gICAgICAgIGNvbnN0IHByaWNlID0gdGhpcy5mb3JtYXRQcmljZShcclxuICAgICAgICAgICAgdGhpcy5jb29yZGluYXRlVG9QcmljZSh0aGlzLmNyb3NzaGFpci55KVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgY29uc3QgZXhpc3RJbmRleCA9IHRoaXMubGluZXMuZmluZEluZGV4KGxpbmUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvcHMgPSBsaW5lLm9wdGlvbnMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIChvcHMudHlwZSA9IFRZUEUgJiYgK29wcy5wcmljZSA9PSBwcmljZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGV4aXN0SW5kZXggIT0gLTEpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVtb3ZlTGluZSA9IHRoaXMubGluZXMuc3BsaWNlKGV4aXN0SW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLnNlcmllcy5wcmljZS5yZW1vdmVQcmljZUxpbmUocmVtb3ZlTGluZVswXSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLnN0b3JlLnNldChcImxpbmVcIiwgeyBwcmljZTogcHJpY2UsIHJlbW92ZWQ6IHRydWUgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGxpbmVUeXBlOiBUWVBFLFxyXG4gICAgICAgICAgICAgICAgcHJpY2U6IHByaWNlLFxyXG4gICAgICAgICAgICAgICAgY29sb3I6IFwiYXF1YVwiLFxyXG4gICAgICAgICAgICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICAgICAgICAgICAgbGluZVN0eWxlOiBMaWdodHdlaWdodENoYXJ0cy5MaW5lU3R5bGUuRG90dGVkLFxyXG4gICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiB0cnVlXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHRoaXMubGluZXMucHVzaCh0aGlzLnNlcmllcy5wcmljZS5jcmVhdGVQcmljZUxpbmUob3B0aW9ucykpO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5zZXQoXCJsaW5lXCIsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRyYXdMaW5lQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcclxuICAgIH07XHJcbiAgICByZW1vdmVIb3Jpem9udGFsTGluZSA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmxpbmVzLmZvckVhY2gobGluZSA9PiB0aGlzLnNlcmllcy5wcmljZS5yZW1vdmVQcmljZUxpbmUobGluZSkpO1xyXG4gICAgICAgIHRoaXMubGluZXMgPSBbXTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5jbGVhcihcImxpbmVcIik7XHJcbiAgICB9O1xyXG4gICAgLy9cclxuICAgIGRyYXdNYWtlciA9ICgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5jcm9zc2hhaXIudGltZSkge1xyXG4gICAgICAgICAgICBjb25zdCBtYXJrZXJzID0gdGhpcy5tYXJrZXJzLmZpbHRlcihcclxuICAgICAgICAgICAgICAgIGl0ZW0gPT4gaXRlbS50aW1lICE9IHRoaXMuY3Jvc3NoYWlyLnRpbWVcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgaWYgKG1hcmtlcnMubGVuZ3RoID09IHRoaXMubWFya2Vycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRpciA9XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jcm9zc2hhaXIueSA+PVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnByaWNlVG9Db29yZGluYXRlKHRoaXMuY3Jvc3NoYWlyLnByaWNlKTtcclxuICAgICAgICAgICAgICAgIHRoaXMubWFya2Vycy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICB0aW1lOiB0aGlzLmNyb3NzaGFpci50aW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBkaXIgPyBcImJlbG93QmFyXCIgOiBcImFib3ZlQmFyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IGRpciA/IFwibGltZVwiIDogXCJyZWRcIixcclxuICAgICAgICAgICAgICAgICAgICBzaGFwZTogZGlyID8gXCJhcnJvd1VwXCIgOiBcImFycm93RG93blwiXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHRoaXMubWFya2VycyA9IG1hcmtlcnM7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnNldE1hcmtlcnModGhpcy5tYXJrZXJzKTtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuc3RvcmVcclxuICAgICAgICAgICAgICAgIC5jbGVhcihcIm1hcmtlclwiKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5nbG9iYWwuc3RvcmUuc2V0KFwibWFya2VyXCIsIHRoaXMubWFya2VycykpO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICB0aGlzLmRyYXdNYXJrZXJCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZW1vdmVNYWtlciA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLm1hcmtlcnMgPSBbXTtcclxuICAgICAgICB0aGlzLnNlcmllcy5wcmljZS5zZXRNYXJrZXJzKFtdKTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5jbGVhcihcIm1hcmtlclwiKTtcclxuICAgIH07XHJcbiAgICAvL1xyXG4gICAgZHJhd1J1bGVyID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByaWNlID0gdGhpcy5jb29yZGluYXRlVG9QcmljZSh0aGlzLmNyb3NzaGFpci55KTtcclxuICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgbGluZVR5cGU6IFwicnVsZXJcIixcclxuICAgICAgICAgICAgcHJpY2U6IHByaWNlLFxyXG4gICAgICAgICAgICBjb2xvcjogXCJ5ZWxsb3dcIixcclxuICAgICAgICAgICAgbGluZVdpZHRoOiAxLFxyXG4gICAgICAgICAgICBsaW5lU3R5bGU6IExpZ2h0d2VpZ2h0Q2hhcnRzLkxpbmVTdHlsZS5Eb3R0ZWQsXHJcbiAgICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMucnVsZXIucG9pbnQgPT0gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBwb2ludCA9IDE7XHJcbiAgICAgICAgICAgIG9wdGlvbnMucG9pbnQgPSBwb2ludDtcclxuICAgICAgICAgICAgb3B0aW9ucy50aXRsZSA9IFwiMFwiO1xyXG4gICAgICAgICAgICB0aGlzLnJ1bGVyLnN0YXJ0ID0gdGhpcy5zZXJpZXMucHJpY2UuY3JlYXRlUHJpY2VMaW5lKG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB0aGlzLnJ1bGVyLnBvaW50ID0gcG9pbnQ7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLnN0b3JlLnNldChcInJ1bGVyXCIsIG9wdGlvbnMpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5ydWxlci5wb2ludCA9PSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHJpY2UgPSArdGhpcy5ydWxlci5zdGFydC5vcHRpb25zKCkucHJpY2U7XHJcbiAgICAgICAgICAgIGNvbnN0IHBvaW50ID0gMjtcclxuICAgICAgICAgICAgb3B0aW9ucy5wb2ludCA9IHBvaW50O1xyXG4gICAgICAgICAgICBvcHRpb25zLnRpdGxlID0gKHByaWNlIC0gc3RhcnRQcmljZSkudG9GaXhlZCgxKTtcclxuICAgICAgICAgICAgdGhpcy5ydWxlci5lbmQgPSB0aGlzLnNlcmllcy5wcmljZS5jcmVhdGVQcmljZUxpbmUob3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMucnVsZXIucG9pbnQgPSBwb2ludDtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuc3RvcmUuc2V0KFwicnVsZXJcIiwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHRoaXMuZHJhd1J1bGVyQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmVtb3ZlUnVsZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHRoaXMucnVsZXIucG9pbnQgPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnJlbW92ZVByaWNlTGluZSh0aGlzLnJ1bGVyLnN0YXJ0KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucnVsZXIucG9pbnQgPiAxKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXJpZXMucHJpY2UucmVtb3ZlUHJpY2VMaW5lKHRoaXMucnVsZXIuZW5kKTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgdGhpcy5ydWxlciA9IHsgc3RhcnQ6IHt9LCBlbmQ6IHt9LCBwb2ludDogMCB9O1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5jbGVhcihcInJ1bGVyXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICAvL1xyXG4gICAgZHJhd0FsZXJ0ID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IFRZUEUgPSBcImFsZXJ0XCI7XHJcbiAgICAgICAgY29uc3QgcHJpY2UgPSB0aGlzLmZvcm1hdFByaWNlKFxyXG4gICAgICAgICAgICB0aGlzLmNvb3JkaW5hdGVUb1ByaWNlKHRoaXMuY3Jvc3NoYWlyLnkpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBjb25zdCBleGlzdEluZGV4ID0gdGhpcy5hbGVydHMuZmluZEluZGV4KGxpbmUgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvcHMgPSBsaW5lLm9wdGlvbnMoKTtcclxuICAgICAgICAgICAgcmV0dXJuIChvcHMudHlwZSA9IFRZUEUgJiYgK29wcy5wcmljZSA9PSBwcmljZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGV4aXN0SW5kZXggIT0gLTEpIHtcclxuICAgICAgICAgICAgY29uc3QgcmVtb3ZlTGluZSA9IHRoaXMuYWxlcnRzLnNwbGljZShleGlzdEluZGV4LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5zZXJpZXMucHJpY2UucmVtb3ZlUHJpY2VMaW5lKHJlbW92ZUxpbmVbMF0pO1xyXG4gICAgICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5zZXQoXCJhbGVydFwiLCB7IHByaWNlOiBwcmljZSwgcmVtb3ZlZDogdHJ1ZSB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgbGluZVR5cGU6IFRZUEUsXHJcbiAgICAgICAgICAgICAgICBwcmljZTogcHJpY2UsXHJcbiAgICAgICAgICAgICAgICB0aXRsZTpcclxuICAgICAgICAgICAgICAgICAgICBwcmljZSA+PSB0aGlzLmRhdGEub3JpZ2luYWwuc2xpY2UoLTEpWzBdLnByaWNlID8gXCI+XCIgOiBcIjxcIixcclxuICAgICAgICAgICAgICAgIGNvbG9yOiBcIiNGRjAwRkZcIixcclxuICAgICAgICAgICAgICAgIGxpbmVXaWR0aDogMSxcclxuICAgICAgICAgICAgICAgIGxpbmVTdHlsZTogTGlnaHR3ZWlnaHRDaGFydHMuTGluZVN0eWxlLkRvdHRlZCxcclxuICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogdHJ1ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmFsZXJ0cy5wdXNoKHRoaXMuc2VyaWVzLnByaWNlLmNyZWF0ZVByaWNlTGluZShvcHRpb25zKSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLnN0b3JlLnNldChcImFsZXJ0XCIsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmRyYXdBbGVydEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XHJcbiAgICAgICAgdGhpcy5hbGVydEF1ZGlvLnBhdXNlKCk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3ZlQWxlcnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5hbGVydHMuZm9yRWFjaChsaW5lID0+IHRoaXMuc2VyaWVzLnByaWNlLnJlbW92ZVByaWNlTGluZShsaW5lKSk7XHJcbiAgICAgICAgdGhpcy5hbGVydHMgPSBbXTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZS5jbGVhcihcImFsZXJ0XCIpO1xyXG4gICAgICAgIHRoaXMuYWxlcnRBdWRpby5wYXVzZSgpO1xyXG4gICAgfTtcclxuICAgIC8vXHJcbiAgICB0b2dnbGVDYW5jZWxPcmRlckJ1dHRvbiA9IHZpc2libGUgPT4ge1xyXG4gICAgICAgIGlmICh2aXNpYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsT3JkZXJCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgICAgICAgdGhpcy5jYW5jZWxPcmRlckJ1dHRvbi5zdHlsZS5iYWNrZ3JvdW5kID1cclxuICAgICAgICAgICAgICAgIHRoaXMub3JkZXIuc2lkZSA+IDAgPyBcImdyZWVuXCIgOiBcInJlZFwiO1xyXG4gICAgICAgIH0gZWxzZSB0aGlzLmNhbmNlbE9yZGVyQnV0dG9uLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIH07XHJcbiAgICAvL1xyXG4gICAgdXBkYXRlTGVnZW5kID0gKHByaWNlLCB2b2x1bWUpID0+IHtcclxuICAgICAgICBpZiAoISFwcmljZSkgdGhpcy5wcmljZUxlZ2VuZFAuaW5uZXJUZXh0ID0gcHJpY2U7XHJcbiAgICAgICAgaWYgKCEhdm9sdW1lKVxyXG4gICAgICAgICAgICB0aGlzLnZvbHVtZUxlZ2VuZFAuaW5uZXJUZXh0ID0gdm9sdW1lLnRvTG9jYWxlU3RyaW5nKFwiZW4tVVNcIik7XHJcbiAgICB9O1xyXG4gICAgY29vcmRpbmF0ZVRvUHJpY2UgPSB5ID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5mb3JtYXRQcmljZSh0aGlzLnNlcmllcy5wcmljZS5jb29yZGluYXRlVG9QcmljZSh5KSk7XHJcbiAgICB9O1xyXG4gICAgZm9ybWF0UHJpY2UgPSBwcmljZSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICsoK3ByaWNlLnRvRml4ZWQoMSkpO1xyXG4gICAgfTtcclxuICAgIC8vXHJcbiAgICBsb2FkQ2hhcnREYXRhID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlU3Bpbm5lcih0cnVlKTtcclxuICAgICAgICAgICAgY29uc3Qgc3ZEYXRhID0gYXdhaXQgdGhpcy5nZXRTZXJ2ZXJEYXRhKCk7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYXNOZXdEYXRhID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsY0RhdGEgPSBhd2FpdCB0aGlzLmdsb2JhbC5zdG9yZS5nZXQoXCJkYXRhXCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaWRzID0gbmV3IFNldChzdkRhdGEubWFwKGQgPT4gZC50aW1lKSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gW1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnN2RGF0YSxcclxuICAgICAgICAgICAgICAgICAgICAuLi5sY0RhdGEuZmlsdGVyKGQgPT4gIWlkcy5oYXMoZC50aW1lKSlcclxuICAgICAgICAgICAgICAgIF0uc29ydCgoYSwgYikgPT4gYS50aW1lIC0gYi50aW1lKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc05ld0RhdGEpIGNvbnRpbnVlIHN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuc3RvcmVcclxuICAgICAgICAgICAgICAgICAgICAuY2xlYXIoXCJkYXRhXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5nbG9iYWwuc3RvcmUuc2V0KFwiZGF0YVwiLCBkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YS5yZWR1Y2UoXHJcbiAgICAgICAgICAgICAgICAgICAgKHIsIGl0ZW0pID0+IHRoaXMuZ2VuZXJhdGVDaGFydERhdGEociwgaXRlbSksXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbDogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaWNlOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm9sdW1lOiBbXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImRhdGE6IFwiLCB0aGlzLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIGlmICghIXRoaXMuZGF0YS5vcmlnaW5hbC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlcmllcy5wcmljZS5zZXREYXRhKHRoaXMuZGF0YS5wcmljZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJpZXMudm9sdW1lLnNldERhdGEodGhpcy5kYXRhLnZvbHVtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMZWdlbmQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5wcmljZS5zbGljZSgtMSlbMF0udmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS52b2x1bWUuc2xpY2UoLTEpWzBdLnZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZVNwaW5uZXIoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICB1cGRhdGVDaGFydERhdGEgPSBwYXJhbSA9PiB7XHJcbiAgICAgICAgdGhpcy5oYXNOZXdEYXRhID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmRhdGEgPSB0aGlzLmdlbmVyYXRlQ2hhcnREYXRhKHRoaXMuZGF0YSwgcGFyYW0pO1xyXG4gICAgICAgIGNvbnN0IGxhc3RQcmljZSA9IHRoaXMuZGF0YS5wcmljZS5zbGljZSgtMSlbMF07XHJcbiAgICAgICAgY29uc3QgbGFzdFZvbHVtZSA9IHRoaXMuZGF0YS52b2x1bWUuc2xpY2UoLTEpWzBdO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaWYgKHRoaXMudGltZUZyYW1lID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLnNlcmllcy5wcmljZS5zZXREYXRhKHRoaXMuZGF0YS5wcmljZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnZvbHVtZS5zZXREYXRhKHRoaXMuZGF0YS52b2x1bWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnVwZGF0ZShsYXN0UHJpY2UpO1xyXG4gICAgICAgICAgICB0aGlzLnNlcmllcy52b2x1bWUudXBkYXRlKGxhc3RWb2x1bWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuaGFzQ3Jvc3NoYWlyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGVnZW5kKGxhc3RQcmljZS52YWx1ZSwgbGFzdFZvbHVtZS52YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5nbG9iYWwuc3RvcmUuc2V0KFwiZGF0YVwiLCBwYXJhbSk7XHJcbiAgICAgICAgdGhpcy5kYXRhLm9yaWdpbmFsLnB1c2gocGFyYW0pO1xyXG4gICAgfTtcclxuICAgIGdldFNlcnZlckRhdGEgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IHRoaXMuZGF0ZUlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nbG9iYWwuY3J5cHRvLmVuY3J5cHQoe1xyXG4gICAgICAgICAgICAgICAgZGF0ZTogZGF0ZSxcclxuICAgICAgICAgICAgICAgIGRldmljZUlkOiB0aGlzLmdsb2JhbC5kZXZpY2VJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5nbG9iYWwuZG9tYWluICsgdGhpcy5nbG9iYWwuZW5kcG9pbnQuZ2V0Q2hhcnQ7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5nbG9iYWwuYWNjZXNzVG9rZW59YFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBkYXRhXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAganNvbiA9IHRoaXMuZ2xvYmFsLmNyeXB0by5kZWNyeXB0KGpzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwianNvbjogXCIsIGpzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghanNvbi5pc09rKSB0aGlzLmNhbGxiYWNrLmFsZXJ0SW52YWxpZEFjY2Vzc0NhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShqc29uLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlIHN0YXJ0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgZ2VuZXJhdGVDaGFydERhdGEgPSAociwgaXRlbSkgPT4ge1xyXG4gICAgICAgIHZhciB0aW1lID0gaXRlbS50aW1lICsgNyAqIDYwICogNjA7XHJcbiAgICAgICAgdmFyIHZvbHVtZUNvbG9yID0gdGhpcy5VUF9DT0xPUjtcclxuICAgICAgICB2YXIgdm9sdW1lID0gaXRlbS52b2x1bWUsXHJcbiAgICAgICAgICAgIG9wZW5QcmljZSA9IDAsXHJcbiAgICAgICAgICAgIGhpZ2hQcmljZSA9IDAsXHJcbiAgICAgICAgICAgIGxvd1ByaWNlID0gMDtcclxuICAgICAgICBpZiAodGhpcy50aW1lRnJhbWUgPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBlcmlvZCA9IDYwICogdGhpcy50aW1lRnJhbWU7XHJcbiAgICAgICAgICAgIGNvbnN0IHRpbWVJbmRleCA9IE1hdGguZmxvb3IodGltZSAvIHBlcmlvZCk7XHJcbiAgICAgICAgICAgIHZhciBpc1NhbWVUaW1lID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICghIXIucHJpY2UubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2VGltZSA9IHIucHJpY2Uuc2xpY2UoLTEpWzBdLnRpbWU7XHJcbiAgICAgICAgICAgICAgICBpZiAodGltZUluZGV4ID09IE1hdGguZmxvb3IocHJldlRpbWUgLyBwZXJpb2QpKVxyXG4gICAgICAgICAgICAgICAgICAgIGlzU2FtZVRpbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpc1NhbWVUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2UHJpY2UgPSByLnByaWNlLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgb3BlblByaWNlID0gcHJldlByaWNlLm9wZW47XHJcbiAgICAgICAgICAgICAgICBoaWdoUHJpY2UgPSBwcmV2UHJpY2UuaGlnaDtcclxuICAgICAgICAgICAgICAgIGxvd1ByaWNlID0gcHJldlByaWNlLmxvdztcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnByaWNlIDwgbG93UHJpY2UpIGxvd1ByaWNlID0gaXRlbS5wcmljZTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLnByaWNlID4gaGlnaFByaWNlKSBoaWdoUHJpY2UgPSBpdGVtLnByaWNlO1xyXG4gICAgICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgICAgIGNvbnN0IHByZXZWb2x1bWUgPSByLnZvbHVtZS5wb3AoKTtcclxuICAgICAgICAgICAgICAgIHZvbHVtZSArPSBwcmV2Vm9sdW1lLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgdm9sdW1lQ29sb3IgPVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0ucHJpY2UgPj0gb3BlblByaWNlID8gdGhpcy5VUF9DT0xPUiA6IHRoaXMuRE9XTl9DT0xPUjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG9wZW5QcmljZSA9IGl0ZW0ucHJpY2U7XHJcbiAgICAgICAgICAgICAgICBoaWdoUHJpY2UgPSBpdGVtLnByaWNlO1xyXG4gICAgICAgICAgICAgICAgbG93UHJpY2UgPSBpdGVtLnByaWNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRpbWUgPSB0aW1lSW5kZXggKiBwZXJpb2Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHIub3JpZ2luYWwucHVzaChpdGVtKTtcclxuICAgICAgICByLnByaWNlLnB1c2goe1xyXG4gICAgICAgICAgICB0aW1lOiB0aW1lLFxyXG4gICAgICAgICAgICB2YWx1ZTogaXRlbS5wcmljZSxcclxuICAgICAgICAgICAgb3Blbjogb3BlblByaWNlLFxyXG4gICAgICAgICAgICBoaWdoOiBoaWdoUHJpY2UsXHJcbiAgICAgICAgICAgIGxvdzogbG93UHJpY2UsXHJcbiAgICAgICAgICAgIGNsb3NlOiBpdGVtLnByaWNlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgci52b2x1bWUucHVzaCh7XHJcbiAgICAgICAgICAgIHRpbWU6IHRpbWUsXHJcbiAgICAgICAgICAgIHZhbHVlOiB2b2x1bWUsXHJcbiAgICAgICAgICAgIGNvbG9yOiB2b2x1bWVDb2xvclxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9O1xyXG4gICAgZ2V0VG9vbHNEYXRhID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgdGhpcy5nbG9iYWwuc3RvcmUuZ2V0KFwib3JkZXJcIik7XHJcbiAgICAgICAgICAgIG9yZGVyLm1hcChpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMub3JkZXIuc2lkZSA9IGl0ZW0uc2lkZTtcclxuICAgICAgICAgICAgICAgIHRoaXMub3JkZXJbaXRlbS5raW5kXS5wcmljZSA9IGl0ZW0ucHJpY2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdPcmRlckxpbmUoaXRlbS5raW5kKTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmtpbmQgPT0gXCJlbnRyeVwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2suZ2V0T3JkZXJQb3NpdGlvbkNhbGxiYWNrKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vcmRlci5lbnRyeS5saW5lLmFwcGx5T3B0aW9ucyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvZ2dsZUNhbmNlbE9yZGVyQnV0dG9uKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgY29uc3QgbGluZXMgPSBhd2FpdCB0aGlzLmdsb2JhbC5zdG9yZS5nZXQoXCJsaW5lXCIpO1xyXG4gICAgICAgICAgICBsaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFsaW5lLnJlbW92ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lcy5wdXNoKHRoaXMuc2VyaWVzLnByaWNlLmNyZWF0ZVByaWNlTGluZShsaW5lKSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICB0aGlzLm1hcmtlcnMgPSBhd2FpdCB0aGlzLmdsb2JhbC5zdG9yZS5nZXQoXCJtYXJrZXJcIik7XHJcbiAgICAgICAgICAgIHRoaXMuc2VyaWVzLnByaWNlLnNldE1hcmtlcnModGhpcy5tYXJrZXJzKTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgY29uc3QgcnVsZXJMaW5lcyA9IGF3YWl0IHRoaXMuZ2xvYmFsLnN0b3JlLmdldChcInJ1bGVyXCIpO1xyXG4gICAgICAgICAgICBpZiAocnVsZXJMaW5lcy5sZW5ndGggPT0gMikge1xyXG4gICAgICAgICAgICAgICAgcnVsZXJMaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucnVsZXIucG9pbnQgPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLnBvaW50ID09IDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucnVsZXIuc3RhcnQgPSB0aGlzLnNlcmllcy5wcmljZS5jcmVhdGVQcmljZUxpbmUoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJ1bGVyLmVuZCA9IHRoaXMuc2VyaWVzLnByaWNlLmNyZWF0ZVByaWNlTGluZShcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgIGNvbnN0IGFsZXJ0TGluZXMgPSBhd2FpdCB0aGlzLmdsb2JhbC5zdG9yZS5nZXQoXCJhbGVydFwiKTtcclxuICAgICAgICAgICAgYWxlcnRMaW5lcy5mb3JFYWNoKGxpbmUgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFsaW5lLnJlbW92ZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGVydHMucHVzaCh0aGlzLnNlcmllcy5wcmljZS5jcmVhdGVQcmljZUxpbmUobGluZSkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy9cclxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIGNvbm5lY3RTb2NrZXQgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciBtc2cgPSB7IGFjdGlvbjogXCJqb2luXCIsIGxpc3Q6IHNlbGYuZ2xvYmFsLnN5bWJvbCB9O1xyXG4gICAgICAgIHZhciBzb2NrZXQgPSBpbyhzZWxmLmdsb2JhbC5lbmRwb2ludC5zb2NrZXQpO1xyXG4gICAgICAgIHNvY2tldC5vbihcImNvbm5lY3RcIiwgKCkgPT4gc29ja2V0LmVtaXQoXCJyZWdzXCIsIEpTT04uc3RyaW5naWZ5KG1zZykpKTtcclxuICAgICAgICBzb2NrZXQub24oXCJyZWNvbm5lY3RcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmxvYWRDaGFydERhdGEoKTtcclxuICAgICAgICAgICAgaWYgKHNlbGYuaXNJblNlc3Npb24oKSkgc29ja2V0LmVtaXQoXCJyZWdzXCIsIEpTT04uc3RyaW5naWZ5KG1zZykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNvY2tldC5vbihcInN0b2NrcHNcIiwgZGF0YSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLmRhdGEuaWQgPT0gMzIyMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcGFyYW0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZTogbW9tZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBgJHttb21lbnQoKS5mb3JtYXQoXCJZWVlZLU1NLUREXCIpfSAke2RhdGEuZGF0YS50aW1lfWBcclxuICAgICAgICAgICAgICAgICAgICApLnVuaXgoKSxcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogZGF0YS5kYXRhLmxhc3RQcmljZSxcclxuICAgICAgICAgICAgICAgICAgICB2b2x1bWU6IGRhdGEuZGF0YS5sYXN0Vm9sXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgc2VsZi51cGRhdGVDaGFydERhdGEocGFyYW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgLy9cclxuICAgIHNlY0ludGVydmFsSGFuZGxlciA9IHNlbGYgPT4ge1xyXG4gICAgICAgIGlmIChzZWxmLmNhbGxiYWNrLmdldE9yZGVyUG9zaXRpb25DYWxsYmFjaygpKSB7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLmlzVHBTbCAmJlxyXG4gICAgICAgICAgICAgICAgc2VsZi5vcmRlci5lbnRyeS5oYXNPd25Qcm9wZXJ0eShcImxpbmVcIikgJiZcclxuICAgICAgICAgICAgICAgICFzZWxmLm9yZGVyLnRwLmhhc093blByb3BlcnR5KFwibGluZVwiKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2sub3JkZXJUcFByaWNlQ2FsbGJhY2soc2VsZi5vcmRlciwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdPcmRlckxpbmUoXCJ0cFwiKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2sub3JkZXJTbFByaWNlQ2FsbGJhY2soc2VsZi5vcmRlciwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmRyYXdPcmRlckxpbmUoXCJzbFwiKTtcclxuICAgICAgICAgICAgICAgIHNlbGYub3JkZXIuZW50cnkubGluZS5hcHBseU9wdGlvbnMoe1xyXG4gICAgICAgICAgICAgICAgICAgIGRyYWdnYWJsZTogZmFsc2VcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuc2hvdyhcInN1Y2Nlc3NcIiwgXCLEkMOjIG3hu58gduG7iyB0aOG6vy5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAoc2VsZi5vcmRlci50cC5oYXNPd25Qcm9wZXJ0eShcImxpbmVcIikpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuY2FsbGJhY2suY2FuY2VsT3JkZXJDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi50b2dnbGVDYW5jZWxPcmRlckJ1dHRvbihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLnJlbW92ZU9yZGVyTGluZShcImVudHJ5XCIpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5yZW1vdmVPcmRlckxpbmUoXCJ0cFwiKTtcclxuICAgICAgICAgICAgICAgIHNlbGYucmVtb3ZlT3JkZXJMaW5lKFwic2xcIik7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5zdG9yZS5jbGVhcihcIm9yZGVyXCIpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuc2hvdyhcInN1Y2Nlc3NcIiwgXCLEkMOjIMSRw7NuZyB24buLIHRo4bq/LlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2VsZi5hbGVydEF1ZGlvLnBhdXNlZCkge1xyXG4gICAgICAgICAgICBzZWxmLmFsZXJ0cy5mb3JFYWNoKGFsZXJ0ID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG9wcyA9IGFsZXJ0Lm9wdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgIGlmICghb3BzLnJlbW92ZWQgJiYgISFzZWxmLmRhdGEub3JpZ2luYWwubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFByaWNlID0gc2VsZi5kYXRhLm9yaWdpbmFsLnNsaWNlKC0xKVswXS5wcmljZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChvcHMudGl0bGUgPT0gXCI+XCIgJiYgY3VycmVudFByaWNlID49IG9wcy5wcmljZSkgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgKG9wcy50aXRsZSA9PSBcIjxcIiAmJiBjdXJyZW50UHJpY2UgPD0gb3BzLnByaWNlKVxyXG4gICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5hbGVydEF1ZGlvLnBsYXkoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtb21lbnQoKS51bml4KCkgPT0gc2VsZi5nbG9iYWwudGltZS5zdGFydCkgc2VsZi5jb25uZWN0U29ja2V0KCk7XHJcbiAgICB9O1xyXG4gICAgbWluSW50ZXJ2YWxIYW5kbGVyID0gc2VsZiA9PiB7XHJcbiAgICAgICAgaWYgKHNlbGYuaXNJblNlc3Npb24oKSkgc2VsZi5sb2FkQ2hhcnREYXRhKCk7XHJcbiAgICB9O1xyXG4gICAgaXNJblNlc3Npb24gPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChcclxuICAgICAgICAgICAgbW9tZW50KCkudW5peCgpID49IHRoaXMuZ2xvYmFsLnRpbWUuc3RhcnQgJiZcclxuICAgICAgICAgICAgbW9tZW50KCkudW5peCgpIDw9IHRoaXMuZ2xvYmFsLnRpbWUuZW5kXHJcbiAgICAgICAgKTtcclxuICAgIH07XHJcbiAgICAvL1xyXG4gICAgdG9nZ2xlQ2hhcnRWb2x1bWUgPSB2aXNpYmxlID0+IHtcclxuICAgICAgICB0aGlzLmdsb2JhbC5pc1ZvbHVtZSA9IHZpc2libGU7XHJcbiAgICAgICAgdGhpcy5zZXJpZXMudm9sdW1lLmFwcGx5T3B0aW9ucyh7IHZpc2libGU6IHZpc2libGUgfSk7XHJcbiAgICAgICAgdGhpcy52b2x1bWVMZWdlbmRQLnN0eWxlLmRpc3BsYXkgPSB2aXNpYmxlID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgICAgICAgdGhpcy5jaGFydC5hcHBseU9wdGlvbnMoe1xyXG4gICAgICAgICAgICByaWdodFByaWNlU2NhbGU6IHtcclxuICAgICAgICAgICAgICAgIHNjYWxlTWFyZ2luczogdmlzaWJsZVxyXG4gICAgICAgICAgICAgICAgICAgID8geyB0b3A6IDAuMSwgYm90dG9tOiAwLjIxIH1cclxuICAgICAgICAgICAgICAgICAgICA6IHsgdG9wOiAwLjIsIGJvdHRvbTogMC4xIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIC8vXHJcbiAgICB0b2dnbGVTcGlubmVyID0gdmlzaWJsZSA9PiB7XHJcbiAgICAgICAgdGhpcy5zcGlubmVySW1nLnN0eWxlLm9wYWNpdHkgPSB2aXNpYmxlID8gMSA6IDA7XHJcbiAgICB9O1xyXG4gICAgZXZlbnRDaGFydFJlc2l6ZSA9IHNlbGYgPT4ge1xyXG4gICAgICAgIHNlbGYuY2hhcnQucmVzaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG4gICAgfTtcclxuICAgIGV2ZW50S2V5UHJlc3MgPSAoZSwgc2VsZikgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIGlmIChlLmN0cmxLZXkgfHwgZS5tZXRhS2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZS5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNoYXJ0LnRpbWVTY2FsZSgpLnNjcm9sbFRvUmVhbFRpbWUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzODpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hhcnQudGltZVNjYWxlKCkuYXBwbHlPcHRpb25zKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXJTcGFjaW5nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNoYXJ0Lm9wdGlvbnMoKS50aW1lU2NhbGUuYmFyU3BhY2luZyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAuMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRpbWVTY2FsZS5iYXJTcGFjaW5nID5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRpbWVTY2FsZS5taW5CYXJTcGFjaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGFydC50aW1lU2NhbGUoKS5hcHBseU9wdGlvbnMoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXJTcGFjaW5nOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGFydC5vcHRpb25zKCkudGltZVNjYWxlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmJhclNwYWNpbmcgLSAwLjFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDM3OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jaFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aW1lU2NhbGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zY3JvbGxUb1Bvc2l0aW9uKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNoYXJ0LnRpbWVTY2FsZSgpLnNjcm9sbFBvc2l0aW9uKCkgLSAxMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAzOTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2hcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGltZVNjYWxlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2Nyb2xsVG9Qb3NpdGlvbihcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jaGFydC50aW1lU2NhbGUoKS5zY3JvbGxQb3NpdGlvbigpICsgMTBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzU6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmRyYXdMaW5lQnV0dG9uLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA3NjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZHJhd01hcmtlckJ1dHRvbi5jbGljaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTg2OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kcmF3UnVsZXJCdXR0b24uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDIyMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZHJhd0FsZXJ0QnV0dG9uLmNsaWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5NjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZSAhPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbMF0udmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LnZhbHVlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1swXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC5kaXNwYXRjaEV2ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXZlbnQoXCJjaGFuZ2VcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgOTc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWUgIT1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzFdLnZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC52YWx1ZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbMV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QuZGlzcGF0Y2hFdmVudChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEV2ZW50KFwiY2hhbmdlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDk4OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lICE9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1syXS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QudmFsdWUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzJdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LmRpc3BhdGNoRXZlbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFdmVudChcImNoYW5nZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSA5OTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZSAhPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbM10udmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LnZhbHVlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1szXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC5kaXNwYXRjaEV2ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXZlbnQoXCJjaGFuZ2VcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTAwOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lICE9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1s0XS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QudmFsdWUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzRdLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LmRpc3BhdGNoRXZlbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFdmVudChcImNoYW5nZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDE6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWUgIT1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzVdLnZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC52YWx1ZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbNV0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QuZGlzcGF0Y2hFdmVudChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEV2ZW50KFwiY2hhbmdlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwMjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZSAhPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbNl0udmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LnZhbHVlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1s2XS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC5kaXNwYXRjaEV2ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXZlbnQoXCJjaGFuZ2VcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMTAzOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lICE9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1s3XS52YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QudmFsdWUgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzddLnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LmRpc3BhdGNoRXZlbnQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFdmVudChcImNoYW5nZVwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMDQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWUgIT1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50aW1lRnJhbWVzWzhdLnZhbHVlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC52YWx1ZSA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbOF0udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi50aW1lRnJhbWVTZWxlY3QuZGlzcGF0Y2hFdmVudChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEV2ZW50KFwiY2hhbmdlXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDEwNTpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZSAhPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnRpbWVGcmFtZXNbOV0udmFsdWVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGltZUZyYW1lU2VsZWN0LnZhbHVlID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudGltZUZyYW1lc1s5XS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnRpbWVGcmFtZVNlbGVjdC5kaXNwYXRjaEV2ZW50KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXZlbnQoXCJjaGFuZ2VcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNzc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlZnJlc2hCdXR0b24uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE4ODpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuY2xlYXJCdXR0b24uY2xpY2soKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxyXG4gICAgfTtcclxufVxyXG4iLCJjbGFzcyBQb3B1cCB7XHJcbiAgICAvLyBDw6FjIHRodeG7mWMgdMOtbmhcclxuICAgIFRLID0gXCJfX3NvXCI7XHJcblxyXG4gICAgLy8gSMOgbSBraOG7n2kgdOG6oW9cclxuICAgIGNvbnN0cnVjdG9yKGdsb2JhbCwgY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLmdsb2JhbCA9IGdsb2JhbDtcclxuICAgICAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVDb250YWluZXJFbGVtZW50KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ8OhYyBwaMawxqFuZyB0aOG7qWNcclxuICAgIGNyZWF0ZUNvbnRhaW5lckVsZW1lbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmlkID0gXCJvcHRpb25WaWV3Q29udGFpbmVyXCI7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmQoY29udGFpbmVyKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQgPSBjb250YWluZXI7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlTm9Mb2dpbkVsZW1lbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVIZWFkZXJDb250YWluZXIoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZUxvZ2luQ29udGFpbmVyKCk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVSZWdpc3RlckNvbnRhaW5lcigpO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZUhlYWRlckNvbnRhaW5lciA9ICgpID0+IHtcclxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkaXYuaWQgPSBcImhlYXJkZXJDb250YWluZXJcIjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQuYXBwZW5kKGRpdik7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGRpdi5hcHBlbmQocCk7XHJcbiAgICAgICAgcC5jbGFzc05hbWUgPSBcInRpdGxlXCI7XHJcbiAgICAgICAgcC5pbm5lclRleHQgPSB0aGlzLmdsb2JhbC5hcHBOYW1lO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGxvZ291dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGRpdi5hcHBlbmQobG9nb3V0KTtcclxuICAgICAgICBsb2dvdXQuY2xhc3NOYW1lID0gXCJsb2dvdXQgZmEgZmEtc2lnbi1vdXRcIjtcclxuICAgICAgICBsb2dvdXQudGl0bGUgPSBcIsSQxINuZyB4deG6pXRcIjtcclxuICAgICAgICBsb2dvdXQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIGxvZ291dC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5sb2dvdXQodGhpcykpO1xyXG4gICAgICAgIHRoaXMubG9nb3V0QnV0dG9uID0gbG9nb3V0O1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZUxvZ2luQ29udGFpbmVyID0gKCkgPT4ge1xyXG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGRpdi5pZCA9IFwibG9naW5Db250YWluZXJcIjtcclxuICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJzZWN0aW9uXCI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChkaXYpO1xyXG4gICAgICAgIHRoaXMubG9naW5Db250YWluZXIgPSBkaXY7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgICAgIGRpdi5hcHBlbmQod3JhcHBlcik7XHJcbiAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSBcIndyYXBwZXJcIjtcclxuICAgICAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZSA9PiB0aGlzLmxvZ2luKGUsIHRoaXMpKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQocCk7XHJcbiAgICAgICAgcC5jbGFzc05hbWUgPSBcImludmFsaWRcIjtcclxuICAgICAgICB0aGlzLmxvZ2luTWVzc2FnZSA9IHA7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQoaW5wdXQpO1xyXG4gICAgICAgIGlucHV0LmlkID0gXCJMb2dpblVzZXJOYW1lXCI7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwidGV4dFwiO1xyXG4gICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gXCJFbWFpbCBob+G6t2MgU+G7kSDEkWnhu4duIHRob+G6oWlcIjtcclxuICAgICAgICBpbnB1dC5yZXF1aXJlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5sb2dpblVzZXJuYW1lID0gaW5wdXQ7XHJcbiAgICAgICAgaWYgKCF0aGlzLmdsb2JhbC5pc0xvZ2dlZGluKSB0aGlzLmxvZ2luVXNlcm5hbWUuZm9jdXMoKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKGlucHV0KTtcclxuICAgICAgICBpbnB1dC5pZCA9IFwiTG9naW5QYXNzd29yZFwiO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcInBhc3N3b3JkXCI7XHJcbiAgICAgICAgaW5wdXQucGxhY2Vob2xkZXIgPSBcIk3huq10IGto4bqpdVwiO1xyXG4gICAgICAgIGlucHV0LnJlcXVpcmVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmxvZ2luUGFzc3dvcmQgPSBpbnB1dDtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBjaGVja2JveFdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGNoZWNrYm94V3JhcHBlci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQoY2hlY2tib3hXcmFwcGVyKTtcclxuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICBjaGVja2JveFdyYXBwZXIuYXBwZW5kKGlucHV0KTtcclxuICAgICAgICBpbnB1dC50eXBlID0gXCJjaGVja2JveFwiO1xyXG4gICAgICAgIGlucHV0LnN0eWxlLndpZHRoID0gXCIxN3B4XCI7XHJcbiAgICAgICAgdGhpcy5sb2dpblJlbWVtYmVyTWUgPSBpbnB1dDtcclxuICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGNoZWNrYm94V3JhcHBlci5hcHBlbmQoc3Bhbik7XHJcbiAgICAgICAgc3Bhbi5pbm5lckhUTUwgPSBcIiZlbnNwO0zGsHUgxJHEg25nIG5o4bqtcFwiO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQoYnV0dG9uKTtcclxuICAgICAgICBidXR0b24uaW5uZXJUZXh0ID0gXCLEkMSCTkcgTkjhuqxQXCI7XHJcbiAgICAgICAgYnV0dG9uLnR5cGUgPSBcInN1Ym1pdFwiO1xyXG4gICAgICAgIHRoaXMubG9naW5TdWJtaXQgPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgcm91dGVXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuY2xhc3NOYW1lID0gXCJsaW5rLWdyb3VwXCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQocm91dGVXcmFwcGVyKTtcclxuICAgICAgICB2YXIgcm91dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuYXBwZW5kKHJvdXRlKTtcclxuICAgICAgICByb3V0ZS5jbGFzc05hbWUgPSBcImxpbmtcIjtcclxuICAgICAgICByb3V0ZS5pbm5lclRleHQgPSBcIkdpYSBo4bqhblwiO1xyXG4gICAgICAgIHJvdXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5yZW5ld2FsQ29udGFpbmVyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgcm91dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuYXBwZW5kKHJvdXRlKTtcclxuICAgICAgICByb3V0ZS5jbGFzc05hbWUgPSBcImxpbmtcIjtcclxuICAgICAgICByb3V0ZS5pbm5lclRleHQgPSBcIsSQxINuZyBrw71cIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZWRTZWN0aW9uKHRoaXMucmVnaXN0ZXJDb250YWluZXIpO1xyXG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyTmFtZS5mb2N1cygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHJvdXRlV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmNsYXNzTmFtZSA9IFwibGluay1ncm91cFwiO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKHJvdXRlV3JhcHBlcik7XHJcbiAgICAgICAgdmFyIHJvdXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmFwcGVuZChyb3V0ZSk7XHJcbiAgICAgICAgcm91dGUuY2xhc3NOYW1lID0gXCJsaW5rXCI7XHJcbiAgICAgICAgcm91dGUuaW5uZXJUZXh0ID0gXCJQaOG6p24gbeG7gW1cIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNldEFjdGl2ZWRTZWN0aW9uKHRoaXMuYWJvdXRDb250YWluZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByb3V0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHJvdXRlV3JhcHBlci5hcHBlbmQocm91dGUpO1xyXG4gICAgICAgIHJvdXRlLmNsYXNzTmFtZSA9IFwibGlua1wiO1xyXG4gICAgICAgIHJvdXRlLmlubmVyVGV4dCA9IFwiVHJhbmcgY2jhu6dcIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwczovL3NtYXJ0b3JkZXIubmd1eWVudmFueHVhbnBodS5jb21cIilcclxuICAgICAgICApO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZVJlZ2lzdGVyQ29udGFpbmVyID0gKCkgPT4ge1xyXG4gICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGRpdi5pZCA9IFwicmVnaXN0ZXJDb250YWluZXJcIjtcclxuICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJzZWN0aW9uXCI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChkaXYpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJDb250YWluZXIgPSBkaXY7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgICAgIGRpdi5hcHBlbmQod3JhcHBlcik7XHJcbiAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSBcIndyYXBwZXJcIjtcclxuICAgICAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZSA9PiB0aGlzLnJlZ2lzdGVyQWNjb3VudChlLCB0aGlzKSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHNwYW4uaW5uZXJUZXh0ID0gXCLEkMaw4bujYyA3IG5nw6B5IGTDuW5nIHRo4butIHbhu5tpIDIgdGhp4bq/dCBi4buLLlwiO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKHNwYW4pO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChzcGFuKTtcclxuICAgICAgICBzcGFuLmNsYXNzTmFtZSA9IFwiaW52YWxpZFwiO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJNZXNzYWdlID0gc3BhbjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwidGV4dFwiO1xyXG4gICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gXCJUw6puXCI7XHJcbiAgICAgICAgaW5wdXQucmVxdWlyZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJOYW1lID0gaW5wdXQ7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwiZW1haWxcIjtcclxuICAgICAgICBpbnB1dC5wbGFjZWhvbGRlciA9IFwiRW1haWxcIjtcclxuICAgICAgICBpbnB1dC5yZXF1aXJlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlckVtYWlsID0gaW5wdXQ7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwidGV4dFwiO1xyXG4gICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gXCJT4buRIMSRaeG7h24gdGhv4bqhaVwiO1xyXG4gICAgICAgIGlucHV0LnJlcXVpcmVkID0gdHJ1ZTtcclxuICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtYXhsZW5ndGhcIiwgMTApO1xyXG4gICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInBhdHRlcm5cIiwgXCJbMC05XStcIik7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlclBob25lID0gaW5wdXQ7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwicGFzc3dvcmRcIjtcclxuICAgICAgICBpbnB1dC5wbGFjZWhvbGRlciA9IFwiTeG6rXQga2jhuql1XCI7XHJcbiAgICAgICAgaW5wdXQucmVxdWlyZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJQYXNzd29yZCA9IGlucHV0O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQoaW5wdXQpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcInBhc3N3b3JkXCI7XHJcbiAgICAgICAgaW5wdXQucGxhY2Vob2xkZXIgPSBcIljDoWMgbmjhuq1uIG3huq10IGto4bqpdVwiO1xyXG4gICAgICAgIGlucHV0LnJlcXVpcmVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29uZmlybVBhc3N3b3JkID0gaW5wdXQ7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSBcIsSQxIJORyBLw51cIjtcclxuICAgICAgICBidXR0b24udHlwZSA9IFwic3VibWl0XCI7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlclN1Ym1pdCA9IGJ1dHRvbjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciByb3V0ZVdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHJvdXRlV3JhcHBlci5jbGFzc05hbWUgPSBcImxpbmstZ3JvdXBcIjtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChyb3V0ZVdyYXBwZXIpO1xyXG4gICAgICAgIHZhciByb3V0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHJvdXRlV3JhcHBlci5hcHBlbmQocm91dGUpO1xyXG4gICAgICAgIHJvdXRlLmNsYXNzTmFtZSA9IFwibGlua1wiO1xyXG4gICAgICAgIHJvdXRlLmlubmVyVGV4dCA9IFwixJDEg25nIG5o4bqtcFwiO1xyXG4gICAgICAgIHJvdXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5sb2dpbkNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMubG9naW5Vc2VybmFtZS5mb2N1cygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByb3V0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHJvdXRlV3JhcHBlci5hcHBlbmQocm91dGUpO1xyXG4gICAgICAgIHJvdXRlLmNsYXNzTmFtZSA9IFwibGlua1wiO1xyXG4gICAgICAgIHJvdXRlLmlubmVyVGV4dCA9IFwiVHJhbmcgY2jhu6dcIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwczovL3NtYXJ0b3JkZXIubmd1eWVudmFueHVhbnBodS5jb21cIilcclxuICAgICAgICApO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZUxvZ2dlZGluRWxlbWVudCA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmNyZWF0ZU9wdGlvbkNvbnRhaW5lcigpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlSW5mb0NvbnRhaW5lcigpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQWJvdXRDb250YWluZXIoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVJlbmV3YWxDb250YWluZXIoKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5vcHRpb25Db250YWluZXIpO1xyXG4gICAgICAgIHRoaXMudG9nZ2xlTG9nb3V0QnV0dG9uKHRydWUpO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZU9wdGlvbkNvbnRhaW5lciA9ICgpID0+IHtcclxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkaXYuaWQgPSBcIm9wdGlvbkNvbnRhaW5lclwiO1xyXG4gICAgICAgIGRpdi5jbGFzc05hbWUgPSBcInNlY3Rpb25cIjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQuYXBwZW5kKGRpdik7XHJcbiAgICAgICAgdGhpcy5vcHRpb25Db250YWluZXIgPSBkaXY7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgICAgIGRpdi5hcHBlbmQod3JhcHBlcik7XHJcbiAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSBcIndyYXBwZXJcIjtcclxuICAgICAgICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZSA9PiB0aGlzLnNldFNlcnZlckNvbmZpZyhlLCB0aGlzKSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgbGlzdC5jbGFzc05hbWUgPSBcImxpc3RcIjtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChsaXN0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiS2h1bmcgdGjhu51pIGdpYW46XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHZhciBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xyXG4gICAgICAgIHNlbGVjdC5zdHlsZS53aWR0aCA9IFwiNjlweFwiO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsLnRpbWVGcmFtZXMuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHtcclxuICAgICAgICAgICAgdmFyIG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IGl0ZW0udmFsdWU7XHJcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gaXRlbS50ZXh0O1xyXG4gICAgICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzZWxlY3QudmFsdWUgPSB0aGlzLmdsb2JhbC50aW1lRnJhbWU7XHJcbiAgICAgICAgdGhpcy50aW1lRnJhbWVTZWxlY3QgPSBzZWxlY3Q7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQoc2VsZWN0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIkxv4bqhaSBiaeG7g3UgxJHhu5M6XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XHJcbiAgICAgICAgc2VsZWN0LnN0eWxlLndpZHRoID0gXCI2OXB4XCI7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuY2hhcnRUeXBlcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gaXRlbS52YWx1ZTtcclxuICAgICAgICAgICAgb3B0aW9uLnRleHQgPSBpdGVtLnRleHQ7XHJcbiAgICAgICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHNlbGVjdC52YWx1ZSA9IHRoaXMuZ2xvYmFsLmNoYXJ0VHlwZTtcclxuICAgICAgICB0aGlzLmNoYXJ0VHlwZVNlbGVjdCA9IHNlbGVjdDtcclxuICAgICAgICBpdGVtLmFwcGVuZChzZWxlY3QpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiU+G7kSBo4bujcCDEkeG7k25nOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwibnVtYmVyXCI7XHJcbiAgICAgICAgaW5wdXQuc3R5bGUud2lkdGggPSBcIjY5cHhcIjtcclxuICAgICAgICBpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjIxcHhcIjtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IHRoaXMuZ2xvYmFsLmNvbnRyYWN0TnVtYmVyO1xyXG4gICAgICAgIHRoaXMuY29udHJhY3ROdW1iZXJJbnB1dCA9IGlucHV0O1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGlucHV0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIsSQaeG7g20gY2jhu5F0IGzhu51pOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwibnVtYmVyXCI7XHJcbiAgICAgICAgaW5wdXQuc3R5bGUud2lkdGggPSBcIjY5cHhcIjtcclxuICAgICAgICBpbnB1dC5zdHlsZS5oZWlnaHQgPSBcIjIxcHhcIjtcclxuICAgICAgICBpbnB1dC52YWx1ZSA9IHRoaXMuZ2xvYmFsLnRha2VQcm9maXQ7XHJcbiAgICAgICAgdGhpcy50YWtlUHJvZml0SW5wdXQgPSBpbnB1dDtcclxuICAgICAgICBpdGVtLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCLEkGnhu4NtIGPhuq90IGzhu5c6XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcclxuICAgICAgICBpbnB1dC50eXBlID0gXCJudW1iZXJcIjtcclxuICAgICAgICBpbnB1dC5zdHlsZS53aWR0aCA9IFwiNjlweFwiO1xyXG4gICAgICAgIGlucHV0LnN0eWxlLmhlaWdodCA9IFwiMjFweFwiO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy5nbG9iYWwuc3RvcExvc3M7XHJcbiAgICAgICAgdGhpcy5zdG9wTG9zc0lucHV0ID0gaW5wdXQ7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQoaW5wdXQpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiVOG7sSDEkeG7mW5nIMSR4bq3dCBUUC9TTDpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9IFwiY2hlY2tib3hcIjtcclxuICAgICAgICBpbnB1dC5zdHlsZS53aWR0aCA9IFwiMTdweFwiO1xyXG4gICAgICAgIGlucHV0LmNoZWNrZWQgPSAhIXRoaXMuZ2xvYmFsLmlzVHBTbDtcclxuICAgICAgICB0aGlzLmlzVHBTbENoZWNrYm94ID0gaW5wdXQ7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQoaW5wdXQpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiSGnhu4NuIHRo4buLIGJp4buDdSDEkeG7kyBraOG7kWkgbMaw4bujbmc6XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcImNoZWNrYm94XCI7XHJcbiAgICAgICAgaW5wdXQuc3R5bGUud2lkdGggPSBcIjE3cHhcIjtcclxuICAgICAgICBpbnB1dC5jaGVja2VkID0gISF0aGlzLmdsb2JhbC5pc1ZvbHVtZTtcclxuICAgICAgICB0aGlzLmlzVm9sdW1lQ2hlY2tib3ggPSBpbnB1dDtcclxuICAgICAgICBpdGVtLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJN4bufIGJp4buDdSDEkeG7kyBraGkga2jhu59pIMSR4buZbmc6XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcImNoZWNrYm94XCI7XHJcbiAgICAgICAgaW5wdXQuc3R5bGUud2lkdGggPSBcIjE3cHhcIjtcclxuICAgICAgICBpbnB1dC5jaGVja2VkID0gISF0aGlzLmdsb2JhbC5pc1ZpZXdDaGFydDtcclxuICAgICAgICB0aGlzLmlzVmlld0NoYXJ0Q2hlY2tib3ggPSBpbnB1dDtcclxuICAgICAgICBpdGVtLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSBcIkzGr1UgQ8OASSDEkOG6tlRcIjtcclxuICAgICAgICBidXR0b24udHlwZSA9IFwic3VibWl0XCI7XHJcbiAgICAgICAgdGhpcy5vcHRpb25TdWJtaXQgPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgcm91dGVXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuY2xhc3NOYW1lID0gXCJsaW5rLWdyb3VwXCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQocm91dGVXcmFwcGVyKTtcclxuICAgICAgICB2YXIgcm91dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuYXBwZW5kKHJvdXRlKTtcclxuICAgICAgICByb3V0ZS5jbGFzc05hbWUgPSBcImxpbmtcIjtcclxuICAgICAgICByb3V0ZS5pbm5lclRleHQgPSBcIkThu4tjaCB24bulXCI7XHJcbiAgICAgICAgcm91dGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5pbmZvQ29udGFpbmVyKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdmFyIHJvdXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmFwcGVuZChyb3V0ZSk7XHJcbiAgICAgICAgcm91dGUuY2xhc3NOYW1lID0gXCJsaW5rXCI7XHJcbiAgICAgICAgcm91dGUuaW5uZXJUZXh0ID0gXCJQaOG6p24gbeG7gW1cIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVkU2VjdGlvbih0aGlzLmFib3V0Q29udGFpbmVyKVxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlSW5mb0NvbnRhaW5lciA9ICgpID0+IHtcclxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkaXYuaWQgPSBcImluZm9Db250YWluZXJcIjtcclxuICAgICAgICBkaXYuY2xhc3NOYW1lID0gXCJzZWN0aW9uXCI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChkaXYpO1xyXG4gICAgICAgIHRoaXMuaW5mb0NvbnRhaW5lciA9IGRpdjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICB3cmFwcGVyLmNsYXNzTmFtZSA9IFwid3JhcHBlclwiO1xyXG4gICAgICAgIGRpdi5hcHBlbmQod3JhcHBlcik7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgbGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgbGlzdC5jbGFzc05hbWUgPSBcImxpc3RcIjtcclxuICAgICAgICB3cmFwcGVyLmFwcGVuZChsaXN0KTtcclxuICAgICAgICB2YXIgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsaXN0LmFwcGVuZCh0aXRsZSk7XHJcbiAgICAgICAgdGl0bGUuY2xhc3NOYW1lID0gXCJ0aXRsZVwiO1xyXG4gICAgICAgIHRpdGxlLmlubmVyVGV4dCA9IFwiVGjDtG5nIHRpbiB0w6BpIGtob+G6o246XCI7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJUw6puOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICB2YWx1ZS5pbm5lclRleHQgPSB0aGlzLmdsb2JhbC51c2VyLm5hbWU7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJFbWFpbDpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gdGhpcy5nbG9iYWwudXNlci5lbWFpbDtcclxuICAgICAgICBpdGVtLmFwcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIsSQaeG7h24gdGhv4bqhaTpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gdGhpcy5nbG9iYWwudXNlci5waG9uZTtcclxuICAgICAgICBpdGVtLmFwcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIk5nw6B5IMSRxINuZyBrw706XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHZhbHVlLmlubmVyVGV4dCA9IG1vbWVudCh0aGlzLmdsb2JhbC5yZWdpc3RlckRhdGUpLmZvcm1hdChcIkREL01NL1lZWVlcIik7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxpc3QuY2xhc3NOYW1lID0gXCJsaXN0XCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQobGlzdCk7XHJcbiAgICAgICAgdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQodGl0bGUpO1xyXG4gICAgICAgIHRpdGxlLmNsYXNzTmFtZSA9IFwidGl0bGVcIjtcclxuICAgICAgICB0aXRsZS5pbm5lclRleHQgPSBcIlRow7RuZyB0aW4gZ8OzaSBk4buLY2ggduG7pTpcIjtcclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIk5nw6B5IGLhuq90IMSR4bqndTpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gbW9tZW50KHRoaXMuZ2xvYmFsLnN0YXJ0RGF0ZSkuZm9ybWF0KFwiREQvTU0vWVlZWVwiKTtcclxuICAgICAgICBpdGVtLmFwcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIk5nw6B5IGjhur90IGjhuqFuOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICB2YWx1ZS5pbm5lclRleHQgPSBtb21lbnQodGhpcy5nbG9iYWwuZXhwaXJlc0RhdGUpLmZvcm1hdChcIkREL01NL1lZWVlcIik7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJT4buRIGzGsOG7o25nIHRoaeG6v3QgYuG7izpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gdGhpcy5nbG9iYWwuZGV2aWNlTGltaXQ7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHJvdXRlV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmNsYXNzTmFtZSA9IFwibGluay1ncm91cFwiO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKHJvdXRlV3JhcHBlcik7XHJcbiAgICAgICAgdmFyIHJvdXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmFwcGVuZChyb3V0ZSk7XHJcbiAgICAgICAgcm91dGUuY2xhc3NOYW1lID0gXCJsaW5rXCI7XHJcbiAgICAgICAgcm91dGUuaW5uZXJUZXh0ID0gXCJUcuG7nyB24buBXCI7XHJcbiAgICAgICAgcm91dGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5vcHRpb25Db250YWluZXIpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB2YXIgcm91dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuYXBwZW5kKHJvdXRlKTtcclxuICAgICAgICByb3V0ZS5jbGFzc05hbWUgPSBcImxpbmtcIjtcclxuICAgICAgICByb3V0ZS5pbm5lclRleHQgPSBcIkdpYSBo4bqhblwiO1xyXG4gICAgICAgIHJvdXRlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5yZW5ld2FsQ29udGFpbmVyKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBjcmVhdGVBYm91dENvbnRhaW5lciA9ICgpID0+IHtcclxuICAgICAgICB2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBkaXYuaWQgPSBcImFib3V0Q29udGFpbmVyXCI7XHJcbiAgICAgICAgZGl2LmNsYXNzTmFtZSA9IFwic2VjdGlvblwiO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5hcHBlbmQoZGl2KTtcclxuICAgICAgICB0aGlzLmFib3V0Q29udGFpbmVyID0gZGl2O1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gXCJ3cmFwcGVyXCI7XHJcbiAgICAgICAgZGl2LmFwcGVuZCh3cmFwcGVyKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBsaXN0LmNsYXNzTmFtZSA9IFwibGlzdFwiO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKGxpc3QpO1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiUGhpw6puIGLhuqNuOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICB2YWx1ZS5pbm5lclRleHQgPSB0aGlzLmdsb2JhbC52ZXJzaW9uO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKHZhbHVlKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiTmfDoHkgeHXhuqV0IGLhuqNuOlwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICB2YWx1ZS5pbm5lclRleHQgPSB0aGlzLmdsb2JhbC5wdWJsaXNoRGF0ZTtcclxuICAgICAgICBpdGVtLmFwcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICBsYWJlbC5pbm5lclRleHQgPSBcIk5ow6AgcGjDoXQgdHJp4buDbjpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gdGhpcy5nbG9iYWwuZGV2ZWxvcGVyO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKHZhbHVlKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiU+G7kSDEkWnhu4duIHRob+G6oWk6XCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHZhbHVlLmlubmVyVGV4dCA9IHRoaXMuZ2xvYmFsLmNvbnRhY3QucGhvbmU7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uY2xhc3NOYW1lID0gXCJpdGVtXCI7XHJcbiAgICAgICAgbGlzdC5hcHBlbmQoaXRlbSk7XHJcbiAgICAgICAgdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCJFbWFpbDpcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgdmFsdWUuaW5uZXJUZXh0ID0gdGhpcy5nbG9iYWwuY29udGFjdC5lbWFpbDtcclxuICAgICAgICBpdGVtLmFwcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpZiAodGhpcy5nbG9iYWwudmVyc2lvbiAhPSB0aGlzLmdsb2JhbC5sYXRlc3RWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBkb3dubG9hZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb3JtXCIpO1xyXG4gICAgICAgICAgICBkb3dubG9hZC5zZXRBdHRyaWJ1dGUoXCJtZXRob2RcIiwgXCJnZXRcIik7XHJcbiAgICAgICAgICAgIGRvd25sb2FkLnNldEF0dHJpYnV0ZShcclxuICAgICAgICAgICAgICAgIFwiYWN0aW9uXCIsXHJcbiAgICAgICAgICAgICAgICBcImh0dHBzOi8vcXV5dHJldmFuZy5uZ3V5ZW52YW54dWFucGh1LmNvbS9zdG9yYWdlL2ZpbGVzL3NtYXJ0b3JkZXIuemlwXCJcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgZG93bmxvYWQuY2xhc3NOYW1lID0gXCJkb3dubG9hZFwiO1xyXG4gICAgICAgICAgICB3cmFwcGVyLmFwcGVuZChkb3dubG9hZCk7XHJcbiAgICAgICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgICAgICBkb3dubG9hZC5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgICAgICBsYWJlbC5pbm5lckhUTUwgPSBcIsSQw6MgY8OzIHBoacOqbiBi4bqjbiBj4bqtcCBuaOG6rXQgbeG7m2kuXCI7XHJcbiAgICAgICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICBkb3dubG9hZC5hcHBlbmQoYnV0dG9uKTtcclxuICAgICAgICAgICAgYnV0dG9uLnR5cGUgPSBcInN1Ym1pdFwiO1xyXG4gICAgICAgICAgICBidXR0b24uaW5uZXJUZXh0ID0gXCJU4bqiSSBYVeG7kE5HXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIHJvdXRlV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmNsYXNzTmFtZSA9IFwibGluay1ncm91cFwiO1xyXG4gICAgICAgIHdyYXBwZXIuYXBwZW5kKHJvdXRlV3JhcHBlcik7XHJcbiAgICAgICAgdmFyIHJvdXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgcm91dGVXcmFwcGVyLmFwcGVuZChyb3V0ZSk7XHJcbiAgICAgICAgcm91dGUuY2xhc3NOYW1lID0gXCJsaW5rXCI7XHJcbiAgICAgICAgcm91dGUuaW5uZXJUZXh0ID0gXCJUcuG7nyB24buBXCI7XHJcbiAgICAgICAgcm91dGUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5wcmV2U2VjdGlvbilcclxuICAgICAgICApO1xyXG4gICAgICAgIHZhciByb3V0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xyXG4gICAgICAgIHJvdXRlV3JhcHBlci5hcHBlbmQocm91dGUpO1xyXG4gICAgICAgIHJvdXRlLmNsYXNzTmFtZSA9IFwibGlua1wiO1xyXG4gICAgICAgIHJvdXRlLmlubmVyVGV4dCA9IFwiVHJhbmcgY2jhu6dcIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwczovL3NtYXJ0b3JkZXIubmd1eWVudmFueHVhbnBodS5jb21cIilcclxuICAgICAgICApO1xyXG4gICAgfTtcclxuICAgIGNyZWF0ZVJlbmV3YWxDb250YWluZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgY29udGFpbmVyLmlkID0gXCJyZW5ld2FsQ29udGFpbmVyXCI7XHJcbiAgICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic2VjdGlvblwiO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5hcHBlbmQoY29udGFpbmVyKTtcclxuICAgICAgICB0aGlzLnJlbmV3YWxDb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgd3JhcHBlci5jbGFzc05hbWUgPSBcIndyYXBwZXJcIjtcclxuICAgICAgICBjb250YWluZXIuYXBwZW5kKHdyYXBwZXIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxpc3QuY2xhc3NOYW1lID0gXCJsaXN0XCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQobGlzdCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiMS4gQ2jhu41uIGzhuqduIG11YTpcIjtcclxuICAgICAgICBsYWJlbC5jbGFzc05hbWUgPSBcInRpdGxlXCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQobGFiZWwpO1xyXG4gICAgICAgIHZhciBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic2VsZWN0XCIpO1xyXG4gICAgICAgIHNlbGVjdC5zdHlsZS53aWR0aCA9IFwiODBweFwiO1xyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgeyB0OiBcIk11YSBt4bubaVwiLCB2OiAxIH0sXHJcbiAgICAgICAgICAgIHsgdDogXCJHaWEgaOG6oW5cIiwgdjogMiB9XHJcbiAgICAgICAgXS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gaXRlbS52O1xyXG4gICAgICAgICAgICBvcHRpb24udGV4dCA9IGl0ZW0udDtcclxuICAgICAgICAgICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5idXlUeXBlID0gMjtcclxuICAgICAgICBzZWxlY3QudmFsdWUgPSB0aGlzLmJ1eVR5cGU7XHJcbiAgICAgICAgc2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuYnV5VHlwZSA9IGUudGFyZ2V0LnZhbHVlO1xyXG4gICAgICAgICAgICBpZiAoISF0aGlzLnBsYW4pIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRlbXAgPSB0aGlzLnVwZGF0ZVBsYW5JbmZvKHRoaXMuYnV5VHlwZSwgdGhpcy5wbGFuKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhblByaWNlID0gdGVtcC5wbGFuUHJpY2U7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYW5TYXZlTW9uZXkgPSB0ZW1wLnBsYW5TYXZlTW9uZXk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZXZpY2VOdW1iZXIgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYXltZW50SW5mbyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VOdW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhblByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYW5TYXZlTW9uZXlcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQoc2VsZWN0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBsYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgbGFiZWwuaW5uZXJUZXh0ID0gXCIyLiBDaOG7jW4gdGjhu51pIGdpYW46XCI7XHJcbiAgICAgICAgbGFiZWwuY2xhc3NOYW1lID0gXCJ0aXRsZVwiO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB2YXIgc2VsZWN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNlbGVjdFwiKTtcclxuICAgICAgICBzZWxlY3Quc3R5bGUud2lkdGggPSBcIjgwcHhcIjtcclxuICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICBvcHRpb24udmFsdWUgPSAwO1xyXG4gICAgICAgIG9wdGlvbi50ZXh0ID0gXCJcIjtcclxuICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5wbGFucy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4ge1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgb3B0aW9uLnZhbHVlID0gaXRlbS5tb250aHM7XHJcbiAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gaXRlbS5uYW1lO1xyXG4gICAgICAgICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBlID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHZhbHVlID4gMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGFuID0gdGhpcy5nbG9iYWwucGxhbnMuZmlsdGVyKHAgPT4gcC5tb250aHMgPT0gdmFsdWUpWzBdO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdGVtcCA9IHRoaXMudXBkYXRlUGxhbkluZm8odGhpcy5idXlUeXBlLCB0aGlzLnBsYW4pO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGFuUHJpY2UgPSB0ZW1wLnBsYW5QcmljZTtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhblNhdmVNb25leSA9IHRlbXAucGxhblNhdmVNb25leTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJpY2VJbmZvLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kZXZpY2VOdW1iZXIgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYXltZW50SW5mbyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXZpY2VOdW1iZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGxhblByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYW5TYXZlTW9uZXlcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYXltZW50SW5mbygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcmljZUluZm8uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQoc2VsZWN0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGl0ZW0uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHRoaXMucHJpY2VJbmZvID0gaXRlbTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB0aGlzLnByaWNlTGFiZWwgPSBsYWJlbDtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGl0ZW0uYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICB0aGlzLnNhdmVNb25leUxhYmVsID0gbGFiZWw7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaXRlbS5jbGFzc05hbWUgPSBcIml0ZW1cIjtcclxuICAgICAgICBsaXN0LmFwcGVuZChpdGVtKTtcclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiMy4gQ2jhu41uIHPhu5EgdGhp4bq/dCBi4buLOlwiO1xyXG4gICAgICAgIGxhYmVsLmNsYXNzTmFtZSA9IFwidGl0bGVcIjtcclxuICAgICAgICBpdGVtLmFwcGVuZChsYWJlbCk7XHJcbiAgICAgICAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSBcIm51bWJlclwiO1xyXG4gICAgICAgIGlucHV0LnN0eWxlLndpZHRoID0gXCI4MHB4XCI7XHJcbiAgICAgICAgaW5wdXQuc3R5bGUuaGVpZ2h0ID0gXCIyMXB4XCI7XHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5kZXZpY2VOdW1iZXIgPSBNYXRoLmZsb29yKGUudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVQYXltZW50SW5mbyhcclxuICAgICAgICAgICAgICAgIHRoaXMuZGV2aWNlTnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGFuUHJpY2UsXHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYW5TYXZlTW9uZXlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpdGVtLmFwcGVuZChpbnB1dCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGxhYmVsLmlubmVyVGV4dCA9IFwiNC4gVGhhbmggdG/DoW46XCI7XHJcbiAgICAgICAgbGFiZWwuY2xhc3NOYW1lID0gXCJ0aXRsZVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGxhYmVsKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHZhciBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmNsYXNzTmFtZSA9IFwiaXRlbVwiO1xyXG4gICAgICAgIGxpc3QuYXBwZW5kKGl0ZW0pO1xyXG4gICAgICAgIHZhciBiYW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBpdGVtLmFwcGVuZChiYW5rKTtcclxuICAgICAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaW5mby5pbm5lclRleHQgPSBgJHt0aGlzLmdsb2JhbC5iYW5rQWNjb3VudC5iYW5rX25hbWV9OiAke3RoaXMuZ2xvYmFsLmJhbmtBY2NvdW50LmFjY291bnRfbnVtYmVyfWA7XHJcbiAgICAgICAgYmFuay5hcHBlbmQoaW5mbyk7XHJcbiAgICAgICAgdmFyIGluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGluZm8uaW5uZXJUZXh0ID0gYFTDqm46ICR7dGhpcy5nbG9iYWwuYmFua0FjY291bnQuYWNjb3VudF9uYW1lLnRvTG93ZXJDYXNlKCl9YDtcclxuICAgICAgICBiYW5rLmFwcGVuZChpbmZvKTtcclxuICAgICAgICB2YXIgaW5mbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgaW5mby5pbm5lclRleHQgPSBgTkRDSzogc28gJHtcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuaXNMb2dnZWRpbiA/IHRoaXMuZ2xvYmFsLnVzZXIucGhvbmUgOiBcIjxTxJBUPlwiXHJcbiAgICAgICAgfWA7XHJcbiAgICAgICAgYmFuay5hcHBlbmQoaW5mbyk7XHJcbiAgICAgICAgdmFyIGluZm8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGJhbmsuYXBwZW5kKGluZm8pO1xyXG4gICAgICAgIHRoaXMudG90YWxQcmljZUluZm8gPSBpbmZvO1xyXG4gICAgICAgIHZhciBpbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBiYW5rLmFwcGVuZChpbmZvKTtcclxuICAgICAgICB0aGlzLnRvdGFsU2F2ZU1vbmV5SW5mbyA9IGluZm87XHJcblxyXG4gICAgICAgIHZhciBxckNvZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gICAgICAgIHFyQ29kZS5zdHlsZS53aWR0aCA9IFwiOTBweFwiO1xyXG4gICAgICAgIHFyQ29kZS5zdHlsZS5oZWlnaHQgPSBcIjkwcHhcIjtcclxuICAgICAgICBxckNvZGUuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgaXRlbS5hcHBlbmQocXJDb2RlKTtcclxuICAgICAgICB0aGlzLnFyQ29kZUltZyA9IHFyQ29kZTtcclxuXHJcbiAgICAgICAgLy9cclxuICAgICAgICB2YXIgcm91dGVXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuY2xhc3NOYW1lID0gXCJsaW5rLWdyb3VwXCI7XHJcbiAgICAgICAgd3JhcHBlci5hcHBlbmQocm91dGVXcmFwcGVyKTtcclxuICAgICAgICB2YXIgcm91dGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICByb3V0ZVdyYXBwZXIuYXBwZW5kKHJvdXRlKTtcclxuICAgICAgICByb3V0ZS5jbGFzc05hbWUgPSBcImxpbmtcIjtcclxuICAgICAgICByb3V0ZS5pbm5lclRleHQgPSBcIlRy4bufIHbhu4FcIjtcclxuICAgICAgICByb3V0ZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cclxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVkU2VjdGlvbih0aGlzLnByZXZTZWN0aW9uKVxyXG4gICAgICAgICk7XHJcbiAgICB9O1xyXG4gICAgcmVtb3ZlTG9nZ2VkaW5FbGVtZW50ID0gKCkgPT4ge1xyXG4gICAgICAgIGlmICghIXRoaXMuaW5mb0NvbnRhaW5lcikgdGhpcy5pbmZvQ29udGFpbmVyLnJlbW92ZSgpO1xyXG4gICAgICAgIGlmICghIXRoaXMub3B0aW9uQ29udGFpbmVyKSB0aGlzLm9wdGlvbkNvbnRhaW5lci5yZW1vdmUoKTtcclxuICAgICAgICBpZiAoISF0aGlzLmFib3V0Q29udGFpbmVyKSB0aGlzLmFib3V0Q29udGFpbmVyLnJlbW92ZSgpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5sb2dvdXRCdXR0b24uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgIHRoaXMuc2V0QWN0aXZlZFNlY3Rpb24odGhpcy5sb2dpbkNvbnRhaW5lcik7XHJcbiAgICAgICAgdGhpcy5sb2dpblVzZXJuYW1lLmZvY3VzKCk7XHJcbiAgICB9O1xyXG4gICAgcmVnaXN0ZXJBY2NvdW50ID0gKGUsIHNlbGYpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgaWYgKHNlbGYucmVnaXN0ZXJDb25maXJtUGFzc3dvcmQudmFsdWUgIT0gc2VsZi5yZWdpc3RlclBhc3N3b3JkLnZhbHVlKSB7XHJcbiAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJNZXNzYWdlLmlubmVyVGV4dCA9IFwiTeG6rXQga2jhuql1IGtow7RuZyBraOG7m3BcIjtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJTdWJtaXQuaW5uZXJUZXh0ID0gXCLEkGFuZyDEkcSDbmcga8O9Li4uXCI7XHJcbiAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJTdWJtaXQuZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZWxmLnJlZ2lzdGVyTWVzc2FnZS5pbm5lclRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gc2VsZi5nbG9iYWwuY3J5cHRvLmVuY3J5cHQoe1xyXG4gICAgICAgICAgICAgICAgbmFtZTogc2VsZi5yZWdpc3Rlck5hbWUudmFsdWUsXHJcbiAgICAgICAgICAgICAgICBlbWFpbDogc2VsZi5yZWdpc3RlckVtYWlsLnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgcGhvbmU6IHNlbGYucmVnaXN0ZXJQaG9uZS52YWx1ZSxcclxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBzZWxmLnJlZ2lzdGVyUGFzc3dvcmQudmFsdWUsXHJcbiAgICAgICAgICAgICAgICBkZXZpY2VJZDogc2VsZi5nbG9iYWwuZGV2aWNlSWQsXHJcbiAgICAgICAgICAgICAgICBjaGFuZWw6IHNlbGYuZ2xvYmFsLmFwcE5hbWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IHNlbGYuZ2xvYmFsLmRvbWFpbiArIHNlbGYuZ2xvYmFsLmVuZHBvaW50LnJlZ2lzdGVyO1xyXG4gICAgICAgICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBkYXRhXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyBqc29uID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBqc29uID0gc2VsZi5nbG9iYWwuY3J5cHRvLmRlY3J5cHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZWdpc3RlcjogXCIsIGpzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJTdWJtaXQuaW5uZXJUZXh0ID0gXCLEkMSCTkcgS8OdXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWdpc3RlclN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uLmlzT2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuaXNMb2dnZWRpbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0VG9rZW4oanNvbi50b2tlbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLmFjY2Vzc1Rva2VuID0ganNvbi50b2tlbi5hY2Nlc3NfdG9rZW47XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnVzZXIgPSBqc29uLnVzZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuY2FsbGJhY2subG9naW5DYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hbGVydC5zaG93KFwic3VjY2Vzc1wiLCBcIsSQxINuZyBrw70gdGjDoG5oIGPDtG5nXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlZ2lzdGVyTmFtZS52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJFbWFpbC52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJQaG9uZS52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJQYXNzd29yZC52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJDb25maXJtUGFzc3dvcmQudmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqc29uLm1lc3NhZ2UgPT0gXCJlbWFpbEV4aXN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlZ2lzdGVyTWVzc2FnZS5pbm5lclRleHQgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiRW1haSBuw6B5IMSRw6MgxJHEg25nIGvDvVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChqc29uLm1lc3NhZ2UgPT0gXCJwaG9uZUV4aXN0XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnJlZ2lzdGVyTWVzc2FnZS5pbm5lclRleHQgPVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiU+G7kSDEkWnhu4duIHRob+G6oWkgbsOgeSDEkcOjIMSRxINuZyBrw71cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoanNvbi5tZXNzYWdlID09IFwiZGV2aWNlRXhpc3RcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJNZXNzYWdlLmlubmVyVGV4dCA9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJUw6BpIGtob+G6o24ga2jDoWMgxJHDoyBkw7luZyB0aGnhur90IGLhu4sgbsOgeVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hbGVydC5zaG93KFwiZXJyb3JcIiwgXCLEkMSDbmcga8O9IGzhu5dpXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucmVnaXN0ZXJTdWJtaXQuaW5uZXJUZXh0ID0gXCLEkMSCTkcgS8OdXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yZWdpc3RlclN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGxvZ2luID0gKGUsIHNlbGYpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgc2VsZi5sb2dpblN1Ym1pdC5pbm5lclRleHQgPSBcIsSQYW5nIMSRxINuZyBuaOG6rXAuLi5cIjtcclxuICAgICAgICBzZWxmLmxvZ2luU3VibWl0LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICBzZWxmLmxvZ2luTWVzc2FnZS5pbm5lclRleHQgPSBcIlwiO1xyXG4gICAgICAgIGNvbnN0IGRhdGEgPSBzZWxmLmdsb2JhbC5jcnlwdG8uZW5jcnlwdCh7XHJcbiAgICAgICAgICAgIHVzZXJuYW1lOiBzZWxmLmxvZ2luVXNlcm5hbWUudmFsdWUsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBzZWxmLmxvZ2luUGFzc3dvcmQudmFsdWUsXHJcbiAgICAgICAgICAgIHJlbWVtYmVyTWU6IHNlbGYubG9naW5SZW1lbWJlck1lLmNoZWNrZWQsXHJcbiAgICAgICAgICAgIGRldmljZUlkOiBzZWxmLmdsb2JhbC5kZXZpY2VJZCxcclxuICAgICAgICAgICAgY2hhbmVsOiBzZWxmLmdsb2JhbC5hcHBOYW1lXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgdXJsID0gc2VsZi5nbG9iYWwuZG9tYWluICsgc2VsZi5nbG9iYWwuZW5kcG9pbnQubG9naW47XHJcbiAgICAgICAgZmV0Y2godXJsLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcclxuICAgICAgICAgICAgYm9keTogZGF0YVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5vaykgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oYXN5bmMganNvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICBqc29uID0gc2VsZi5nbG9iYWwuY3J5cHRvLmRlY3J5cHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImxvZ2luOiBcIiwganNvbik7XHJcbiAgICAgICAgICAgICAgICBpZiAoanNvbi5pc09rKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuaXNMb2dnZWRpbiA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRUb2tlbihqc29uLnRva2VuKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hY2Nlc3NUb2tlbiA9IGpzb24udG9rZW4uYWNjZXNzX3Rva2VuO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLnVzZXIgPSBqc29uLnVzZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5jYWxsYmFjay5sb2dpbkNhbGxiYWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dpblVzZXJuYW1lLnZhbHVlID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2luUGFzc3dvcmQudmFsdWUgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi5tZXNzYWdlID09IFwidW5hdXRob3JpemVkXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9naW5NZXNzYWdlLmlubmVyVGV4dCA9IFwiU2FpIHRow7RuZyB0aW4gxJHEg25nIG5o4bqtcFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGpzb24ubWVzc2FnZSA9PSBcInVuc2V0dXBcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dpbk1lc3NhZ2UuaW5uZXJUZXh0ID0gXCJM4buXaSBraOG7n2kgdOG6oW8gdMOgaSBraG/huqNuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoanNvbi5tZXNzYWdlID09IFwiZXhwaXJlZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2luTWVzc2FnZS5pbm5lclRleHQgPSBcIlF1w6EgaOG6oW4gc+G7rSBk4bulbmcgZOG7i2NoIHbhu6VcIjtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChqc29uLm1lc3NhZ2UgPT0gXCJkZXZpY2VMaW1pdFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2luTWVzc2FnZS5pbm5lclRleHQgPSBcIlF1w6EgZ2nhu5tpIGjhuqFuIHRoaeG6v3QgYuG7i1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc2VsZi5sb2dpblN1Ym1pdC5pbm5lclRleHQgPSBcIsSQxIJORyBOSOG6rFBcIjtcclxuICAgICAgICAgICAgICAgIHNlbGYubG9naW5TdWJtaXQuZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLmFsZXJ0LnNob3coXCJlcnJvclwiLCBcIsSQxINuZyBuaOG6rXAgbOG7l2lcIik7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmxvZ2luU3VibWl0LmlubmVyVGV4dCA9IFwixJDEgk5HIE5I4bqsUFwiO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5sb2dpblN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBsb2dvdXQgPSBzZWxmID0+IHtcclxuICAgICAgICBjb25zdCB1cmwgPSBzZWxmLmdsb2JhbC5kb21haW4gKyBzZWxmLmdsb2JhbC5lbmRwb2ludC5sb2dvdXQ7XHJcbiAgICAgICAgZmV0Y2godXJsLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7c2VsZi5nbG9iYWwuYWNjZXNzVG9rZW59YFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmlzTG9nZ2VkaW4gPSBmYWxzZTtcclxuICAgICAgICAgICAgc2VsZi5yZW1vdmVUb2tlbigpO1xyXG4gICAgICAgICAgICBzZWxmLmNhbGxiYWNrLmxvZ291dENhbGxiYWNrKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgZ2V0VXNlciA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmFjY2Vzc1Rva2VuID0gdGhpcy5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuZ2xvYmFsLmFjY2Vzc1Rva2VuKSByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2xvYmFsLmNyeXB0by5lbmNyeXB0KHtcclxuICAgICAgICAgICAgICAgICAgICBkZXZpY2VJZDogdGhpcy5nbG9iYWwuZGV2aWNlSWRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5nbG9iYWwuZG9tYWluICsgdGhpcy5nbG9iYWwuZW5kcG9pbnQudXNlcjtcclxuICAgICAgICAgICAgICAgIGZldGNoKHVybCwge1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuZ2xvYmFsLmFjY2Vzc1Rva2VufWBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHk6IGRhdGFcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGpzb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqc29uID0gdGhpcy5nbG9iYWwuY3J5cHRvLmRlY3J5cHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZ1U6IFwiLCBqc29uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuaXNMb2dnZWRpbiA9IGpzb24uaXNPaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uaXNPaykgdGhpcy5nbG9iYWwudXNlciA9IGpzb24udXNlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB0aGlzLmFsZXJ0SW52YWxpZEFjY2Vzcyh0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHJlc29sdmUoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBnZXRTZXJ2ZXJDb25maWcgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2xvYmFsLmNyeXB0by5lbmNyeXB0KHtcclxuICAgICAgICAgICAgICAgIGRldmljZUlkOiB0aGlzLmdsb2JhbC5kZXZpY2VJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5nbG9iYWwuZG9tYWluICsgdGhpcy5nbG9iYWwuZW5kcG9pbnQuZ2V0Q29uZmlnO1xyXG4gICAgICAgICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3RoaXMuZ2xvYmFsLmFjY2Vzc1Rva2VufWBcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBkYXRhXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAgICAgICAudGhlbihqc29uID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBqc29uID0gdGhpcy5nbG9iYWwuY3J5cHRvLmRlY3J5cHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXJ2ZXJDb25maWdcIiwganNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uaXNPaylcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4ganNvbi5jb25maWcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbFtrZXldID0ganNvbi5jb25maWdba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHRoaXMuYWxlcnRJbnZhbGlkQWNjZXNzKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNob2ljZSA9IGNvbmZpcm0oXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiR2V0IHNlcnZlciBjb25maWcgZXJyb3IuIFJlZnJlc2ggbm93P1wiXHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hvaWNlKSBsb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHNldFNlcnZlckNvbmZpZyA9IChlLCBzZWxmKSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgc2VsZi5vcHRpb25TdWJtaXQuaW5uZXJUZXh0ID0gXCLEkGFuZyBsxrB1IGPDoGkgxJHhurd0Li4uXCI7XHJcbiAgICAgICAgICAgIHNlbGYub3B0aW9uU3VibWl0LmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHNlbGYuZ2xvYmFsLmNyeXB0by5lbmNyeXB0KHtcclxuICAgICAgICAgICAgICAgIHRpbWVGcmFtZTogK3NlbGYudGltZUZyYW1lU2VsZWN0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgY2hhcnRUeXBlOiBzZWxmLmNoYXJ0VHlwZVNlbGVjdC52YWx1ZSxcclxuICAgICAgICAgICAgICAgIGNvbnRyYWN0TnVtYmVyOiArc2VsZi5jb250cmFjdE51bWJlcklucHV0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgdGFrZVByb2ZpdDogK3NlbGYudGFrZVByb2ZpdElucHV0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgc3RvcExvc3M6ICtzZWxmLnN0b3BMb3NzSW5wdXQudmFsdWUsXHJcbiAgICAgICAgICAgICAgICBpc1RwU2w6IHNlbGYuaXNUcFNsQ2hlY2tib3guY2hlY2tlZCxcclxuICAgICAgICAgICAgICAgIGlzVm9sdW1lOiBzZWxmLmlzVm9sdW1lQ2hlY2tib3guY2hlY2tlZCxcclxuICAgICAgICAgICAgICAgIGlzVmlld0NoYXJ0OiBzZWxmLmlzVmlld0NoYXJ0Q2hlY2tib3guY2hlY2tlZCxcclxuICAgICAgICAgICAgICAgIGRldmljZUlkOiBzZWxmLmdsb2JhbC5kZXZpY2VJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gc2VsZi5nbG9iYWwuZG9tYWluICsgc2VsZi5nbG9iYWwuZW5kcG9pbnQuc2V0Q29uZmlnO1xyXG4gICAgICAgICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3NlbGYuZ2xvYmFsLmFjY2Vzc1Rva2VufWBcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBkYXRhXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5zdGF0dXNUZXh0KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihhc3luYyBqc29uID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBqc29uID0gc2VsZi5nbG9iYWwuY3J5cHRvLmRlY3J5cHQoanNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJzZXRDb25maWc6IFwiLCBqc29uKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvblN1Ym1pdC5pbm5lclRleHQgPSBcIkzGr1UgQ8OASSDEkOG6tlRcIjtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wdGlvblN1Ym1pdC5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uLmlzT2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuc2hvdyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3VjY2Vzc1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJMxrB1IGPDoGkgxJHhurd0IHRow6BuaCBjw7RuZ1wiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLmlzVHBTbCA9IHNlbGYuaXNUcFNsQ2hlY2tib3guY2hlY2tlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFjay50b2dnbGVDaGFydFZvbHVtZUNhbGxiYWNrKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pc1ZvbHVtZUNoZWNrYm94LmNoZWNrZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi5tZXNzYWdlID09IFwidW5hdXRob3JpemVkXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmFsZXJ0SW52YWxpZEFjY2VzcygpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hbGVydC5zaG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiZXJyb3JcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIkzGsHUgY8OgaSDEkeG6t3QgdGjhuqV0IGLhuqFpXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIGdldFNlcnZlckJhY2tncm91bmQgPSAoKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2xvYmFsLmNyeXB0by5lbmNyeXB0KHtcclxuICAgICAgICAgICAgICAgIGRldmljZUlkOiB0aGlzLmdsb2JhbC5kZXZpY2VJZFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gdGhpcy5nbG9iYWwuZG9tYWluICsgdGhpcy5nbG9iYWwuZW5kcG9pbnQuZ2V0QmFja2dyb3VuZDtcclxuICAgICAgICAgICAgZmV0Y2godXJsLCB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9LFxyXG4gICAgICAgICAgICAgICAgYm9keTogZGF0YVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oanNvbiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAganNvbiA9IHRoaXMuZ2xvYmFsLmNyeXB0by5kZWNyeXB0KGpzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic2VydmVyQmFja2dyb3VuZFwiLCBqc29uKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoanNvbi5pc09rKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBqc29uLmNvbmZpZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsW2tleV0gPSBqc29uLmNvbmZpZ1trZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5hbGVydEludmFsaWRBY2Nlc3MoKTtcclxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hvaWNlID0gY29uZmlybShcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCJHZXQgc2VydmVyIGNvbmZpZyBlcnJvci4gUmVmcmVzaCBub3c/XCJcclxuICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaG9pY2UpIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgc2V0VG9rZW4gPSB0b2tlbiA9PiB7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5USywgSlNPTi5zdHJpbmdpZnkodG9rZW4pKTtcclxuICAgIH07XHJcbiAgICByZW1vdmVUb2tlbiA9ICgpID0+IHtcclxuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLlRLKTtcclxuICAgIH07XHJcbiAgICBnZXRUb2tlbiA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCB0b2tlbiA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5USykpO1xyXG4gICAgICAgIGlmICghdG9rZW4pIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAobW9tZW50KCkuaXNCZWZvcmUodG9rZW4uZXhwaXJlc19hdCkpIHJldHVybiB0b2tlbi5hY2Nlc3NfdG9rZW47XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnQuc2hvdyhcIndhcmluZ1wiLCBcIlBoacOqbiDEkcSDbmcgbmjhuq1wIGjhur90IGjhuqFuXCIpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICB0b2dnbGUgPSAodmlzaWJsZSA9IHRydWUpID0+IHtcclxuICAgICAgICBpZiAoIXZpc2libGUgfHwgdGhpcy5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucyhcInNob3dcIikpXHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwic2hvd1wiKTtcclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRBY3RpdmVkU2VjdGlvbihcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmlzTG9nZ2VkaW5cclxuICAgICAgICAgICAgICAgICAgICA/IHRoaXMub3B0aW9uQ29udGFpbmVyXHJcbiAgICAgICAgICAgICAgICAgICAgOiB0aGlzLmxvZ2luQ29udGFpbmVyXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwic2hvd1wiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgdG9nZ2xlTG9nb3V0QnV0dG9uID0gdmlzaWJsZSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2dvdXRCdXR0b24uc3R5bGUuZGlzcGxheSA9IHZpc2libGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIjtcclxuICAgIH07XHJcbiAgICBzZXRBY3RpdmVkU2VjdGlvbiA9IGVsID0+IHtcclxuICAgICAgICB2YXIgYWN0aXZlRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBcIiNvcHRpb25WaWV3Q29udGFpbmVyIC5zZWN0aW9uLmFjdGl2ZVwiXHJcbiAgICAgICAgKTtcclxuICAgICAgICBpZiAoYWN0aXZlRWwpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmV2U2VjdGlvbiA9IGFjdGl2ZUVsO1xyXG4gICAgICAgICAgICBhY3RpdmVFbC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmN1cnJTZWN0aW9uID0gZWw7XHJcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZChcImFjdGl2ZVwiKTtcclxuICAgIH07XHJcbiAgICBhbGVydEludmFsaWRBY2Nlc3MgPSAoaCA9IGZhbHNlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5sb2dvdXQodGhpcyk7XHJcbiAgICAgICAgY29uc3QgbXNnID0gXCJUw6BpIGtob+G6o24gxJHEg25nIG5o4bqtcCBzYWkgY8OhY2hcIjtcclxuICAgICAgICBpZiAoaClcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnRcclxuICAgICAgICAgICAgICAgIC5oaWRlKClcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHRoaXMuZ2xvYmFsLmFsZXJ0LnNob3coXCJlcnJvclwiLCBtc2csIHRydWUsIHRydWUpKTtcclxuICAgICAgICBlbHNlIHRoaXMuZ2xvYmFsLmFsZXJ0LnNob3coXCJlcnJvclwiLCBtc2cpO1xyXG4gICAgfTtcclxuICAgIGN1cnJlbmN5Rm9ybWF0ID0gaW5wdXQgPT4ge1xyXG4gICAgICAgIHJldHVybiBuZXcgSW50bC5OdW1iZXJGb3JtYXQoXCJ2aS1WTlwiLCB7XHJcbiAgICAgICAgICAgIHN0eWxlOiBcImN1cnJlbmN5XCIsXHJcbiAgICAgICAgICAgIGN1cnJlbmN5OiBcIlZORFwiXHJcbiAgICAgICAgfSkuZm9ybWF0KGlucHV0KTtcclxuICAgIH07XHJcbiAgICB1cGRhdGVQbGFuSW5mbyA9IChidXlUeXBlLCBwbGFuKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXNSZW5ld2FsID0gYnV5VHlwZSA9PSBcIjJcIjtcclxuICAgICAgICBjb25zdCBwcmljZVBlckRldmljZSA9IGlzUmVuZXdhbCA/IHBsYW4ucmVuZXdhbF9wcmljZSA6IHBsYW4ucHJpY2U7XHJcbiAgICAgICAgdGhpcy5wcmljZUxhYmVsLmlubmVyVGV4dCA9IGAke3RoaXMuY3VycmVuY3lGb3JtYXQoXHJcbiAgICAgICAgICAgIHByaWNlUGVyRGV2aWNlXHJcbiAgICAgICAgKX0vdGjDoW5nYDtcclxuICAgICAgICBjb25zdCBwbGFuUHJpY2UgPSBwbGFuLm1vbnRocyAqIHByaWNlUGVyRGV2aWNlO1xyXG4gICAgICAgIGNvbnN0IHBsYW5TYXZlTW9uZXkgPVxyXG4gICAgICAgICAgICBwbGFuLm1vbnRocyAqIChwbGFuLmhpZ2hlc3RfcHJpY2UgLSBwcmljZVBlckRldmljZSk7XHJcbiAgICAgICAgdGhpcy5zYXZlTW9uZXlMYWJlbC5pbm5lclRleHQgPSBgVGnhur90IGtp4buHbTogJHt0aGlzLmN1cnJlbmN5Rm9ybWF0KFxyXG4gICAgICAgICAgICBwbGFuU2F2ZU1vbmV5XHJcbiAgICAgICAgKX1gO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHBsYW5QcmljZSxcclxuICAgICAgICAgICAgcGxhblNhdmVNb25leVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgdXBkYXRlUGF5bWVudEluZm8gPSAoXHJcbiAgICAgICAgZGV2aWNlTnVtYmVyID0gMCxcclxuICAgICAgICBwbGFuUHJpY2UgPSAwLFxyXG4gICAgICAgIHBsYW5TYXZlTW9uZXkgPSAwXHJcbiAgICApID0+IHtcclxuICAgICAgICBpZiAoZGV2aWNlTnVtYmVyID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBwcmljZSA9IGRldmljZU51bWJlciAqIHBsYW5QcmljZTtcclxuICAgICAgICAgICAgdGhpcy50b3RhbFByaWNlSW5mby5pbm5lclRleHQgPSBgVOG7lW5nIGdpw6E6ICR7dGhpcy5jdXJyZW5jeUZvcm1hdChcclxuICAgICAgICAgICAgICAgIHByaWNlXHJcbiAgICAgICAgICAgICl9YDtcclxuICAgICAgICAgICAgdGhpcy50b3RhbFNhdmVNb25leUluZm8uaW5uZXJUZXh0ID0gYFRp4bq/dCBraeG7h206ICR7dGhpcy5jdXJyZW5jeUZvcm1hdChcclxuICAgICAgICAgICAgICAgIGRldmljZU51bWJlciAqIHBsYW5TYXZlTW9uZXlcclxuICAgICAgICAgICAgKX1gO1xyXG4gICAgICAgICAgICB0aGlzLnFyQ29kZUltZy5zcmMgPSBgaHR0cHM6Ly9pbWcudmlldHFyLmlvL2ltYWdlLyR7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbC5iYW5rQWNjb3VudC5iYW5rX25hbWVcclxuICAgICAgICAgICAgfS0ke1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuYmFua0FjY291bnQuYWNjb3VudF9udW1iZXJcclxuICAgICAgICAgICAgfS1mY2FTbnBxLmpwZz9hY2NvdW50TmFtZT0ke1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nbG9iYWwuYmFua0FjY291bnQuYWNjb3VudF9uYW1lXHJcbiAgICAgICAgICAgIH0mYW1vdW50PSR7cHJpY2V9JmFkZEluZm89c28gJHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmlzTG9nZ2VkaW4gPyB0aGlzLmdsb2JhbC51c2VyLnBob25lIDogXCJcIlxyXG4gICAgICAgICAgICB9YDtcclxuICAgICAgICAgICAgdGhpcy5xckNvZGVJbWcuc3R5bGUudmlzaWJpbGl0eSA9IFwidmlzaWJsZVwiO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudG90YWxQcmljZUluZm8uaW5uZXJUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgdGhpcy50b3RhbFNhdmVNb25leUluZm8uaW5uZXJUZXh0ID0gXCJcIjtcclxuICAgICAgICAgICAgdGhpcy5xckNvZGVJbWcuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG4iLCJjbGFzcyBNZW51IHtcclxuICAgIC8vIEPDoWMgdGh14buZYyB0w61uaFxyXG5cclxuICAgIC8vIEjDoG0ga2jhu59pIHThuqFvXHJcbiAgICBjb25zdHJ1Y3RvcihnbG9iYWwsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwgPSBnbG9iYWw7XHJcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlQ29udGFpbmVyRWxlbWVudCgpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlTm9Mb2dpbkVsZW1lbnQoKTtcclxuICAgIH1cclxuICAgIC8vXHJcbiAgICAvLyBDw6FjIHBoxrDGoW5nIHRo4bupY1xyXG4gICAgY3JlYXRlQ29udGFpbmVyRWxlbWVudCA9ICgpID0+IHtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBjb250YWluZXIuaWQgPSBcIm1lbnVDb250YWluZXJcIjtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZChjb250YWluZXIpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGNvbnRhaW5lcjtcclxuICAgIH07XHJcbiAgICBjcmVhdGVMb2dnZWRpbkVsZW1lbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgYnV0dG9uLmlkID0gXCJsaWdodFdlaWdodEJ1dHRvblwiO1xyXG4gICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QgPSBcImZhIGZhLWxpbmUtY2hhcnRcIjtcclxuICAgICAgICBidXR0b24udGl0bGUgPSBcIkJp4buDdSDEkeG7kyDEkeG6t3QgbOG7h25oXCI7XHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxyXG4gICAgICAgICAgICB0aGlzLmNhbGxiYWNrLnRvZ2dsZUxpZ2h0V2VpZ2h0QnV0dG9uQ2FsbGJhY2soKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LnByZXBlbmQoYnV0dG9uKTtcclxuICAgICAgICB0aGlzLmxpZ2h0V2VpZ2h0QnV0dG9uID0gYnV0dG9uO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgYnV0dG9uLmNsYXNzTGlzdCA9IFwiZmEgZmEtYmFyLWNoYXJ0XCI7XHJcbiAgICAgICAgYnV0dG9uLnRpdGxlID0gXCJCaeG7g3UgxJHhu5MgcGjDom4gdMOtY2hcIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2sudG9nZ2xlVHJhZGluZ1ZpZXdCdXR0b25DYWxsYmFjaygpXHJcbiAgICAgICAgKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQucHJlcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMudHJhZGluZ1ZpZXdCdXR0b24gPSBidXR0b247XHJcbiAgICAgICAgLy9cclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICAgICEhdGhpcy5nbG9iYWwuaXNSZXBvcnQgJiZcclxuICAgICAgICAgICAgdGhpcy5nbG9iYWwuaXNPcGVuaW5nTWFya2V0ICYmXHJcbiAgICAgICAgICAgICF0aGlzLmdsb2JhbC5pc1JlcG9ydGVkUmVzdWx0XHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICAgIHZhciBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICBidXR0b24uaWQgPSBcInJlcG9ydEJ1dHRvblwiO1xyXG4gICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0ID0gXCJmYSBmYS1mbGFnLWNoZWNrZXJlZFwiO1xyXG4gICAgICAgICAgICBidXR0b24udGl0bGUgPSBcIkLDoW8gY8OhbyBr4bq/dCBxdeG6o1wiO1xyXG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9ydFRyYWRpbmdSZXN1bHQodGhpcylcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgICAgICB0aGlzLnJlcG9ydEJ1dHRvbiA9IGJ1dHRvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy9cclxuICAgICAgICB0aGlzLnNldHRpbmdCdXR0b24uY2xhc3NMaXN0LnJlcGxhY2UoXCJmYS1zaWduLWluXCIsIFwiZmEtY29nXCIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5ibGlua0xpZ2h0V2VpZ2h0QnV0dG9uKHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAobW9tZW50KCkudW5peCgpID09IHRoaXMuZ2xvYmFsLnRpbWUuZW5kKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvcnRUcmFkaW5nUmVzdWx0KHRoaXMpO1xyXG4gICAgICAgIH0sIDEwMDApO1xyXG4gICAgfTtcclxuICAgIHJlbW92ZUxvZ2dlZGluRWxlbWVudCA9ICgpID0+IHtcclxuICAgICAgICBpZiAoISF0aGlzLnRyYWRpbmdWaWV3QnV0dG9uKSB0aGlzLnRyYWRpbmdWaWV3QnV0dG9uLnJlbW92ZSgpO1xyXG4gICAgICAgIGlmICghIXRoaXMubGlnaHRXZWlnaHRCdXR0b24pIHRoaXMubGlnaHRXZWlnaHRCdXR0b24ucmVtb3ZlKCk7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICAhIXRoaXMuZ2xvYmFsLmlzUmVwb3J0ICYmXHJcbiAgICAgICAgICAgIHRoaXMuZ2xvYmFsLmlzT3BlbmluZ01hcmtldCAmJlxyXG4gICAgICAgICAgICAhdGhpcy5nbG9iYWwuaXNSZXBvcnRlZFJlc3VsdFxyXG4gICAgICAgIClcclxuICAgICAgICAgICAgaWYgKCEhdGhpcy5yZXBvcnRCdXR0b24pIHRoaXMucmVwb3J0QnV0dG9uLnJlbW92ZSgpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5zZXR0aW5nQnV0dG9uLmNsYXNzTGlzdC5yZXBsYWNlKFwiZmEtY29nXCIsIFwiZmEtc2lnbi1pblwiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XHJcbiAgICB9O1xyXG4gICAgY3JlYXRlTm9Mb2dpbkVsZW1lbnQgPSAoKSA9PiB7XHJcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XHJcbiAgICAgICAgYnV0dG9uLmlkID0gXCJzZXR0aW5nQnV0dG9uXCI7XHJcbiAgICAgICAgYnV0dG9uLmNsYXNzTGlzdCA9IFwiZmEgZmEtc2lnbi1pblwiO1xyXG4gICAgICAgIGJ1dHRvbi50aXRsZSA9IFwiQ8OgaSDEkeG6t3RcIjtcclxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgICAgICAgIHRoaXMuY2FsbGJhY2sudG9nZ2xlUG9wdXBDYWxsYmFjayh0cnVlKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmFwcGVuZChidXR0b24pO1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ0J1dHRvbiA9IGJ1dHRvbjtcclxuICAgIH07XHJcbiAgICBibGlua0xpZ2h0V2VpZ2h0QnV0dG9uID0gc2VsZiA9PiB7XHJcbiAgICAgICAgaWYgKHNlbGYuZ2xvYmFsLmlzSW5TZXNzaW9uKCkpIHtcclxuICAgICAgICAgICAgaWYgKHNlbGYubGlnaHRXZWlnaHRCdXR0b24uY2xhc3NMaXN0LmNvbnRhaW5zKFwiZGFya1wiKSlcclxuICAgICAgICAgICAgICAgIHNlbGYubGlnaHRXZWlnaHRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcImRhcmtcIik7XHJcbiAgICAgICAgICAgIGVsc2Ugc2VsZi5saWdodFdlaWdodEJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZGFya1wiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmVwb3J0VHJhZGluZ1Jlc3VsdCA9IHNlbGYgPT4ge1xyXG4gICAgICAgIGlmIChzZWxmLmdsb2JhbC5pc09wZW5pbmdNYXJrZXQgJiYgIXNlbGYuZ2xvYmFsLmlzUmVwb3J0ZWRSZXN1bHQpIHtcclxuICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuc2hvdyhcIndhcm5pbmdcIiwgXCLEkGFuZyBn4butaSBiw6FvIGPDoW8gLiAuIC5cIiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBzZWxmLmdsb2JhbC5pc1JlcG9ydGVkUmVzdWx0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VsZi5nbG9iYWwudG9nZ2xlU3Bpbm5lcih0cnVlKTtcclxuICAgICAgICAgICAgY29uc3QgdXJsID0gc2VsZi5nbG9iYWwuZG9tYWluICsgc2VsZi5nbG9iYWwuZW5kcG9pbnQucmVwb3J0O1xyXG4gICAgICAgICAgICBjb25zdCBkYXRhID0gc2VsZi5nbG9iYWwuY3J5cHRvLmVuY3J5cHQoe1xyXG4gICAgICAgICAgICAgICAgLi4uc2VsZi5jYWxsYmFjay5nZXRSZXBvcnREYXRhQ2FsbGJhY2soKSxcclxuICAgICAgICAgICAgICAgIC4uLnsgZGV2aWNlSWQ6IHNlbGYuZ2xvYmFsLmRldmljZUlkIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZldGNoKHVybCwge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7c2VsZi5nbG9iYWwuYWNjZXNzVG9rZW59YFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGJvZHk6IGRhdGFcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGpzb24gPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGpzb24gPSBzZWxmLmdsb2JhbC5jcnlwdG8uZGVjcnlwdChqc29uKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5pc1JlcG9ydGVkUmVzdWx0ID0ganNvbi5pc09rO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uLmlzT2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuaGlkZSgpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpzb24uaXNFeGVjdXRlZClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5hbGVydC5zaG93KFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInN1Y2Nlc3NcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJCw6FvIGPDoW8gxJHDoyBn4butaSB0aMOgbmggY8O0bmcuXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZ2xvYmFsLmFsZXJ0LnNob3coXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid2FybmluZ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIsSQw6MgZ+G7rWkgYsOhbyBjw6FvXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5yZXBvcnRCdXR0b24ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqc29uLm1lc3NhZ2UgPT0gXCJ1bmF1dGhvcml6ZWRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5jYWxsYmFjay5hbGVydEludmFsaWRBY2Nlc3NDYWxsYmFjaygpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwudG9nZ2xlU3Bpbm5lcihmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC5pc1JlcG9ydGVkUmVzdWx0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmhpZGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5nbG9iYWwuYWxlcnQuc2hvdyhcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImVycm9yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJH4butaSBiw6FvIGPDoW8gdGjhuqV0IGLhuqFpXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmdsb2JhbC50b2dnbGVTcGlubmVyKGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuIiwiY2xhc3MgU21hcnRPcmRlciB7XHJcbiAgICAvLyBIw6BtIGto4bufaSB04bqhb1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwgPSBuZXcgQ29uZmlnKCk7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnQgPSBuZXcgQWxlcnQoKTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5zdG9yZSA9IG5ldyBTdG9yZSgpO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsLmNyeXB0byA9IG5ldyBDcnlwdG8odGhpcy5nbG9iYWwpO1xyXG4gICAgICAgIHRoaXMuZ2xvYmFsLmRldmljZUlkID0gbmV3IERldmljZVVVSUQoKS5nZXQoKTtcclxuICAgICAgICB0aGlzLmdsb2JhbC5pc01vYmlsZSA9IG5hdmlnYXRvci51c2VyQWdlbnREYXRhLm1vYmlsZTtcclxuICAgICAgICB0aGlzLmNoYXJ0ID0gbmV3IENoYXJ0KHRoaXMuZ2xvYmFsLCB7XHJcbiAgICAgICAgICAgIGdldE9yZGVyUG9zaXRpb25DYWxsYmFjazogdGhpcy5nZXRPcmRlclBvc2l0aW9uQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGNsb3NlT3JkZXJQb3NpdGlvbkNhbGxiYWNrOiB0aGlzLmNsb3NlT3JkZXJQb3NpdGlvbkNhbGxiYWNrLFxyXG4gICAgICAgICAgICBvcmRlckVudHJ5UHJpY2VDYWxsYmFjazogdGhpcy5vcmRlckVudHJ5UHJpY2VDYWxsYmFjayxcclxuICAgICAgICAgICAgb3JkZXJUcFByaWNlQ2FsbGJhY2s6IHRoaXMub3JkZXJUcFByaWNlQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIG9yZGVyU2xQcmljZUNhbGxiYWNrOiB0aGlzLm9yZGVyU2xQcmljZUNhbGxiYWNrLFxyXG4gICAgICAgICAgICBjYW5jZWxPcmRlckNhbGxiYWNrOiB0aGlzLmNhbmNlbE9yZGVyQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGFsZXJ0SW52YWxpZEFjY2Vzc0NhbGxiYWNrOiB0aGlzLmFsZXJ0SW52YWxpZEFjY2Vzc0NhbGxiYWNrXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5wb3B1cCA9IG5ldyBQb3B1cCh0aGlzLmdsb2JhbCwge1xyXG4gICAgICAgICAgICBsb2dpbkNhbGxiYWNrOiB0aGlzLmxvZ2luQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIGxvZ291dENhbGxiYWNrOiB0aGlzLmxvZ291dENhbGxiYWNrLFxyXG4gICAgICAgICAgICB0b2dnbGVDaGFydFZvbHVtZUNhbGxiYWNrOiB0aGlzLnRvZ2dsZUNoYXJ0Vm9sdW1lQ2FsbGJhY2tcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLm1lbnUgPSBuZXcgTWVudSh0aGlzLmdsb2JhbCwge1xyXG4gICAgICAgICAgICB0b2dnbGVUcmFkaW5nVmlld0J1dHRvbkNhbGxiYWNrOiB0aGlzXHJcbiAgICAgICAgICAgICAgICAudG9nZ2xlVHJhZGluZ1ZpZXdCdXR0b25DYWxsYmFjayxcclxuICAgICAgICAgICAgdG9nZ2xlTGlnaHRXZWlnaHRCdXR0b25DYWxsYmFjazogdGhpc1xyXG4gICAgICAgICAgICAgICAgLnRvZ2dsZUxpZ2h0V2VpZ2h0QnV0dG9uQ2FsbGJhY2ssXHJcbiAgICAgICAgICAgIHRvZ2dsZVBvcHVwQ2FsbGJhY2s6IHRoaXMudG9nZ2xlUG9wdXBDYWxsYmFjayxcclxuICAgICAgICAgICAgZ2V0UmVwb3J0RGF0YUNhbGxiYWNrOiB0aGlzLmdldFJlcG9ydERhdGFDYWxsYmFjayxcclxuICAgICAgICAgICAgYWxlcnRJbnZhbGlkQWNjZXNzQ2FsbGJhY2s6IHRoaXMuYWxlcnRJbnZhbGlkQWNjZXNzQ2FsbGJhY2tcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyRnVsbHNjcmVlbkV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5kZXRlY3RWcHNTeXN0ZW0oKTtcclxuICAgIH1cclxuICAgIC8vXHJcbiAgICAvLyBDw6FjIHBoxrDGoW5nIHRo4bupY1xyXG4gICAgaW5pdCA9IGFzeW5jICgpID0+IHtcclxuICAgICAgICB0aGlzLnBvcHVwLmNyZWF0ZU5vTG9naW5FbGVtZW50KCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJkZXZpY2VJZDogXCIsIHRoaXMuZ2xvYmFsLmRldmljZUlkKTtcclxuICAgICAgICBhd2FpdCB0aGlzLnBvcHVwLmdldFVzZXIoKTtcclxuICAgICAgICBpZiAodGhpcy5nbG9iYWwuaXNMb2dnZWRpbikge1xyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmxvZ2luQ2FsbGJhY2soKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHJcbiAgICAgICAgICAgICAgICBcInNvaG9wZG9uZ1wiXHJcbiAgICAgICAgICAgICkudmFsdWUgPSB0aGlzLmdsb2JhbC5jb250cmFjdE51bWJlcjtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyaWdodF9wcmljZVwiKS52YWx1ZSA9IFwiTVRMXCI7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wb3B1cC5nZXRTZXJ2ZXJCYWNrZ3JvdW5kKCk7XHJcbiAgICAgICAgICAgIHRoaXMucG9wdXAuY3JlYXRlQWJvdXRDb250YWluZXIoKTtcclxuICAgICAgICAgICAgdGhpcy5wb3B1cC5jcmVhdGVSZW5ld2FsQ29udGFpbmVyKCk7XHJcbiAgICAgICAgICAgIHRoaXMubWVudS5zZXR0aW5nQnV0dG9uLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGxvZ2luQ2FsbGJhY2sgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnQuc2hvdyhcIndhcm5pbmdcIiwgXCLEkGFuZyBraOG7n2kgdOG6oW8gYmnhu4N1IMSR4buTIC4gLiAuXCIsIGZhbHNlKTtcclxuICAgICAgICBhd2FpdCB0aGlzLnBvcHVwLmdldFNlcnZlckNvbmZpZygpO1xyXG4gICAgICAgIHRoaXMucG9wdXAuY3JlYXRlTG9nZ2VkaW5FbGVtZW50KCk7XHJcbiAgICAgICAgdGhpcy5jaGFydC5jcmVhdGUoKTtcclxuICAgICAgICBhd2FpdCB0aGlzLmNoYXJ0LmxvYWRDaGFydERhdGEoKTtcclxuICAgICAgICBhd2FpdCB0aGlzLmNoYXJ0LmdldFRvb2xzRGF0YSgpO1xyXG4gICAgICAgIHRoaXMubWVudS5jcmVhdGVMb2dnZWRpbkVsZW1lbnQoKTtcclxuICAgICAgICBpZiAoISF0aGlzLmdsb2JhbC5pc1ZpZXdDaGFydCkgdGhpcy5tZW51LmxpZ2h0V2VpZ2h0QnV0dG9uLmNsaWNrKCk7XHJcbiAgICAgICAgdGhpcy5jaGFydC5jb25uZWN0U29ja2V0KCk7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuYWxlcnQuaGlkZSgpO1xyXG4gICAgfTtcclxuICAgIGxvZ291dENhbGxiYWNrID0gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMubWVudS5yZW1vdmVMb2dnZWRpbkVsZW1lbnQoKTtcclxuICAgICAgICB0aGlzLnBvcHVwLnJlbW92ZUxvZ2dlZGluRWxlbWVudCgpO1xyXG4gICAgICAgIHRoaXMuY2hhcnQucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy50b2dnbGVUcmFkaW5nVmlld0J1dHRvbkNhbGxiYWNrKGZhbHNlKTtcclxuICAgICAgICB0aGlzLnRvZ2dsZUxpZ2h0V2VpZ2h0QnV0dG9uQ2FsbGJhY2soZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIHRvZ2dsZVRyYWRpbmdWaWV3QnV0dG9uQ2FsbGJhY2sgPSAodmlzaWJsZSA9IHRydWUpID0+IHtcclxuICAgICAgICB2YXIgbGVmdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsZWZ0X29yZGVyX3R5cGVcIik7XHJcbiAgICAgICAgdmFyIHJpZ2h0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJpZ2h0X29yZGVyX3R5cGVcIik7XHJcbiAgICAgICAgdmFyIG9yZGVyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBcIiNtYWluRm9vdGVyIC5mb290X3RhYjpudGgtY2hpbGQoMSlcIlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdmFyIGNvbmRPcmRlckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgXCIjbWFpbkZvb3RlciAuZm9vdF90YWI6bnRoLWNoaWxkKDIpXCJcclxuICAgICAgICApO1xyXG4gICAgICAgIG9yZGVyRWwuY2xhc3NMaXN0LnJlbW92ZShcImZhXCIsIFwiZmEtY2hlY2stY2lyY2xlXCIpO1xyXG4gICAgICAgIGNvbmRPcmRlckVsLmNsYXNzTGlzdC5yZW1vdmUoXCJmYVwiLCBcImZhLXF1ZXN0aW9uLWNpcmNsZVwiKTtcclxuICAgICAgICBpZiAoIXZpc2libGUgfHwgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuY29udGFpbnMoXCJ0cmFkaW5ndmlldy1jaGFydFwiKSkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJ0cmFkaW5ndmlldy1jaGFydFwiKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QucmVtb3ZlKFwiZnVsbC1jaGFydFwiKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2xvYmFsLmlzU21hcnRQcm8pIHtcclxuICAgICAgICAgICAgICAgIGxlZnRFbC5pbm5lclRleHQgPSBcIkzhu4duaCB0aMaw4budbmdcIjtcclxuICAgICAgICAgICAgICAgIHJpZ2h0RWwuaW5uZXJUZXh0ID0gXCJM4buHbmggxJFp4buBdSBraeG7h25cIjtcclxuICAgICAgICAgICAgICAgIG9yZGVyRWwuaW5uZXJUZXh0ID0gXCJEQU5IIFPDgUNIIEzhu4ZOSFwiO1xyXG4gICAgICAgICAgICAgICAgY29uZE9yZGVyRWwuaW5uZXJUZXh0ID0gXCJEQU5IIFPDgUNIIEzhu4ZOSCDEkEnhu4BVIEtJ4buGTlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy50b2dnbGVQb3B1cENhbGxiYWNrKGZhbHNlKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKFwidHJhZGluZ3ZpZXctY2hhcnRcIik7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcImZ1bGwtY2hhcnRcIik7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImxpZ2h0d2VpZ2h0LWNoYXJ0XCIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nbG9iYWwuaXNTbWFydFBybykge1xyXG4gICAgICAgICAgICAgICAgbGVmdEVsLmlubmVyVGV4dCA9IFwiTFRcIjtcclxuICAgICAgICAgICAgICAgIHJpZ2h0RWwuaW5uZXJUZXh0ID0gXCJMxJBLXCI7XHJcbiAgICAgICAgICAgICAgICBvcmRlckVsLmlubmVyVGV4dCA9IFwiTOG7hk5IIFRIxq/hu5xOR1wiO1xyXG4gICAgICAgICAgICAgICAgY29uZE9yZGVyRWwuaW5uZXJUZXh0ID0gXCJMLiDEkEnhu4BVIEtJ4buGTlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRvZ2dsZUxpZ2h0V2VpZ2h0QnV0dG9uQ2FsbGJhY2sgPSAodmlzaWJsZSA9IHRydWUpID0+IHtcclxuICAgICAgICB2YXIgbGVmdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsZWZ0X29yZGVyX3R5cGVcIik7XHJcbiAgICAgICAgdmFyIHJpZ2h0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJpZ2h0X29yZGVyX3R5cGVcIik7XHJcbiAgICAgICAgdmFyIG9yZGVyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBcIiNtYWluRm9vdGVyIC5mb290X3RhYjpudGgtY2hpbGQoMSlcIlxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdmFyIGNvbmRPcmRlckVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcclxuICAgICAgICAgICAgXCIjbWFpbkZvb3RlciAuZm9vdF90YWI6bnRoLWNoaWxkKDIpXCJcclxuICAgICAgICApO1xyXG4gICAgICAgIGlmICghdmlzaWJsZSB8fCBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5jb250YWlucyhcImxpZ2h0d2VpZ2h0LWNoYXJ0XCIpKSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImxpZ2h0d2VpZ2h0LWNoYXJ0XCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJmdWxsLWNoYXJ0XCIpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nbG9iYWwuaXNTbWFydFBybykge1xyXG4gICAgICAgICAgICAgICAgbGVmdEVsLmlubmVyVGV4dCA9IFwiTOG7h25oIHRoxrDhu51uZ1wiO1xyXG4gICAgICAgICAgICAgICAgcmlnaHRFbC5pbm5lclRleHQgPSBcIkzhu4duaCDEkWnhu4F1IGtp4buHblwiO1xyXG4gICAgICAgICAgICAgICAgb3JkZXJFbC5jbGFzc0xpc3QucmVtb3ZlKFwiZmFcIiwgXCJmYS1jaGVjay1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgICAgICBvcmRlckVsLmlubmVyVGV4dCA9IFwiREFOSCBTw4FDSCBM4buGTkhcIjtcclxuICAgICAgICAgICAgICAgIGNvbmRPcmRlckVsLmNsYXNzTGlzdC5yZW1vdmUoXCJmYVwiLCBcImZhLXF1ZXN0aW9uLWNpcmNsZVwiKTtcclxuICAgICAgICAgICAgICAgIGNvbmRPcmRlckVsLmlubmVyVGV4dCA9IFwiREFOSCBTw4FDSCBM4buGTkggxJBJ4buAVSBLSeG7hk5cIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudG9nZ2xlUG9wdXBDYWxsYmFjayhmYWxzZSk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZChcImxpZ2h0d2VpZ2h0LWNoYXJ0XCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJmdWxsLWNoYXJ0XCIpO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJ0cmFkaW5ndmlldy1jaGFydFwiKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2xvYmFsLmlzU21hcnRQcm8pIHtcclxuICAgICAgICAgICAgICAgIGxlZnRFbC5pbm5lclRleHQgPSBcIkxUXCI7XHJcbiAgICAgICAgICAgICAgICByaWdodEVsLmlubmVyVGV4dCA9IFwiTMSQS1wiO1xyXG4gICAgICAgICAgICAgICAgb3JkZXJFbC5jbGFzc0xpc3QuYWRkKFwiZmFcIiwgXCJmYS1jaGVjay1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgICAgICBvcmRlckVsLmlubmVyVGV4dCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBjb25kT3JkZXJFbC5jbGFzc0xpc3QuYWRkKFwiZmFcIiwgXCJmYS1xdWVzdGlvbi1jaXJjbGVcIik7XHJcbiAgICAgICAgICAgICAgICBjb25kT3JkZXJFbC5pbm5lclRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIGdldFJlcG9ydERhdGFDYWxsYmFjayA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXZlbnVlOiArZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZChcInZtQWNjSW5mb1wiKVxyXG4gICAgICAgICAgICAgICAgLmlubmVyVGV4dC5yZXBsYWNlQWxsKFwiLFwiLCBcIlwiKSxcclxuICAgICAgICAgICAgZmVlczogK2RvY3VtZW50XHJcbiAgICAgICAgICAgICAgICAuZ2V0RWxlbWVudEJ5SWQoXCJvdGhlcnNBY2NJbmZvXCIpXHJcbiAgICAgICAgICAgICAgICAuaW5uZXJUZXh0LnJlcGxhY2VBbGwoXCIsXCIsIFwiXCIpXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBnZXRPcmRlclBvc2l0aW9uQ2FsbGJhY2sgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICAgICAgICBgI2RhbmhtdWNfJHt0aGlzLmdsb2JhbC5zeW1ib2x9ID4gdGQ6bnRoLWNoaWxkKDIpYFxyXG4gICAgICAgICk7XHJcbiAgICAgICAgaWYgKCFlbCkgcmV0dXJuIDA7XHJcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBlbC5pbm5lclRleHQ7XHJcbiAgICAgICAgaWYgKGlzTmFOKHBvc2l0aW9uKSkgcmV0dXJuIDA7XHJcbiAgICAgICAgZWxzZSByZXR1cm4gK3Bvc2l0aW9uO1xyXG4gICAgfTtcclxuICAgIGNsb3NlT3JkZXJQb3NpdGlvbkNhbGxiYWNrID0gKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZXRPcmRlclBvc2l0aW9uQ2FsbGJhY2soKTtcclxuICAgICAgICBpZiAocG9zaXRpb24pIHtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWxlY3Rfbm9ybWFsX29yZGVyX3dyYXBwZXJcIikuY2xpY2soKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyaWdodF9wcmljZVwiKS52YWx1ZSA9IFwiTVRMXCI7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic29ob3Bkb25nXCIpLnZhbHVlID0gTWF0aC5hYnMocG9zaXRpb24pO1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKGBidG5fJHtwb3NpdGlvbiA+IDAgPyBcInNob3J0XCIgOiBcImxvbmdcIn1gKVxyXG4gICAgICAgICAgICAgICAgLmNsaWNrKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIG9yZGVyRW50cnlQcmljZUNhbGxiYWNrID0gb3JkZXIgPT4ge1xyXG4gICAgICAgIHRoaXMuY2FsbEphdmFzY3JpcHQoXCJvbkNhbmNlbEFsbE9yZGVyUGVuZGluZygnb3JkZXJfY29uZGl0aW9uJylcIik7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZWxlY3RfY29uZGl0aW9uX29yZGVyX3dyYXBwZXJcIikuY2xpY2soKTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJpZ2h0X3N0b3BPcmRlckluZGV4XCIpLnZhbHVlID1cclxuICAgICAgICAgICAgb3JkZXIuZW50cnkucHJpY2U7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyaWdodF9wcmljZVwiKS52YWx1ZSA9IFwiTVRMXCI7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyaWdodF9zZWxTdG9wT3JkZXJUeXBlXCIpLnZhbHVlID1cclxuICAgICAgICAgICAgb3JkZXIuc2lkZSA+IDAgPyBcIlNPTFwiIDogXCJTT1VcIjtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBkb2N1bWVudFxyXG4gICAgICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKGBidG5fJHtvcmRlci5zaWRlID4gMCA/IFwibG9uZ1wiIDogXCJzaG9ydFwifWApXHJcbiAgICAgICAgICAgICAgICAuY2xpY2soKTtcclxuICAgICAgICB9LCAxMDAwKTtcclxuICAgIH07XHJcbiAgICBvcmRlclRwUHJpY2VDYWxsYmFjayA9IChvcmRlciwgaXNJbml0ID0gZmFsc2UpID0+IHtcclxuICAgICAgICB0aGlzLmNhbGxKYXZhc2NyaXB0KFwib25DYW5jZWxBbGxPcmRlclBlbmRpbmcoJ29yZGVyJylcIik7XHJcbiAgICAgICAgaWYgKGlzSW5pdClcclxuICAgICAgICAgICAgb3JkZXIudHAucHJpY2UgPVxyXG4gICAgICAgICAgICAgICAgK29yZGVyLmVudHJ5LnByaWNlICsgb3JkZXIuc2lkZSAqIHRoaXMuZ2xvYmFsLnRha2VQcm9maXQ7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VsZWN0X25vcm1hbF9vcmRlcl93cmFwcGVyXCIpLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmlnaHRfcHJpY2VcIikudmFsdWUgPSBvcmRlci50cC5wcmljZTtcclxuICAgICAgICAgICAgZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZChgYnRuXyR7b3JkZXIuc2lkZSA8IDAgPyBcImxvbmdcIiA6IFwic2hvcnRcIn1gKVxyXG4gICAgICAgICAgICAgICAgLmNsaWNrKCk7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcbiAgICB9O1xyXG4gICAgb3JkZXJTbFByaWNlQ2FsbGJhY2sgPSAob3JkZXIsIGlzSW5pdCA9IGZhbHNlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5jYWxsSmF2YXNjcmlwdChcIm9uQ2FuY2VsQWxsT3JkZXJQZW5kaW5nKCdvcmRlcl9jb25kaXRpb24nKVwiKTtcclxuICAgICAgICBpZiAoaXNJbml0KVxyXG4gICAgICAgICAgICBvcmRlci5zbC5wcmljZSA9XHJcbiAgICAgICAgICAgICAgICArb3JkZXIuZW50cnkucHJpY2UgLSBvcmRlci5zaWRlICogdGhpcy5nbG9iYWwuc3RvcExvc3M7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2VsZWN0X2NvbmRpdGlvbl9vcmRlcl93cmFwcGVyXCIpLmNsaWNrKCk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmlnaHRfc3RvcE9yZGVySW5kZXhcIikudmFsdWUgPVxyXG4gICAgICAgICAgICAgICAgb3JkZXIuc2wucHJpY2U7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmlnaHRfcHJpY2VcIikudmFsdWUgPSBcIk1UTFwiO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJpZ2h0X3NlbFN0b3BPcmRlclR5cGVcIikudmFsdWUgPVxyXG4gICAgICAgICAgICAgICAgb3JkZXIuc2lkZSA8IDAgPyBcIlNPTFwiIDogXCJTT1VcIjtcclxuICAgICAgICAgICAgZG9jdW1lbnRcclxuICAgICAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZChgYnRuXyR7b3JkZXIuc2lkZSA8IDAgPyBcImxvbmdcIiA6IFwic2hvcnRcIn1gKVxyXG4gICAgICAgICAgICAgICAgLmNsaWNrKCk7XHJcbiAgICAgICAgfSwgMTAwMCk7XHJcbiAgICB9O1xyXG4gICAgY2FuY2VsT3JkZXJDYWxsYmFjayA9ICgpID0+IHtcclxuICAgICAgICB0aGlzLmNhbGxKYXZhc2NyaXB0KFwib25DYW5jZWxBbGxPcmRlclBlbmRpbmcoJ29yZGVyX2NvbmRpdGlvbicpXCIpO1xyXG4gICAgICAgIHRoaXMuY2FsbEphdmFzY3JpcHQoXCJvbkNhbmNlbEFsbE9yZGVyUGVuZGluZygnb3JkZXInKVwiKTtcclxuICAgIH07XHJcbiAgICB0b2dnbGVDaGFydFZvbHVtZUNhbGxiYWNrID0gdmlzaWJsZSA9PlxyXG4gICAgICAgIHRoaXMuY2hhcnQudG9nZ2xlQ2hhcnRWb2x1bWUodmlzaWJsZSk7XHJcbiAgICB0b2dnbGVQb3B1cENhbGxiYWNrID0gdmlzaWJsZSA9PiB0aGlzLnBvcHVwLnRvZ2dsZSh2aXNpYmxlKTtcclxuICAgIGFsZXJ0SW52YWxpZEFjY2Vzc0NhbGxiYWNrID0gKCkgPT4gdGhpcy5wb3B1cC5hbGVydEludmFsaWRBY2Nlc3MoKTtcclxuICAgIGNhbGxKYXZhc2NyaXB0ID0gc2NyaXB0ID0+IHtcclxuICAgICAgICB2YXIgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICBidXR0b24uc2V0QXR0cmlidXRlKFwib25jbGlja1wiLCBzY3JpcHQpO1xyXG4gICAgICAgIGJ1dHRvbi5jbGljaygpO1xyXG4gICAgfTtcclxuICAgIHJlZ2lzdGVyRnVsbHNjcmVlbkV2ZW50ID0gKCkgPT4ge1xyXG4gICAgICAgIGRvY3VtZW50XHJcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLnRpbWVTdGFtcFwiKVxyXG4gICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImRibGNsaWNrXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudCkgZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTtcclxuICAgICAgICAgICAgICAgIGVsc2UgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlcXVlc3RGdWxsc2NyZWVuKCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIGRldGVjdFZwc1N5c3RlbSA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBzaXRlID0gd2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLnNwbGl0KFwiLlwiKVswXTtcclxuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoc2l0ZSk7XHJcbiAgICAgICAgdGhpcy5nbG9iYWwuaXNTbWFydFBybyA9IHNpdGUgPT0gXCJzbWFydHByb1wiO1xyXG4gICAgfTtcclxufVxyXG5cclxudmFyIHNtYXJ0T3JkZXIgPSBuZXcgU21hcnRPcmRlcigpO1xyXG5zbWFydE9yZGVyLmluaXQoKTtcclxuIl19
