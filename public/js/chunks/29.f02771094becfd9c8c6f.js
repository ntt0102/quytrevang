(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{Eeih:function(t,e,n){"use strict";n.r(e);var o=n("L2JU"),a=n("0woa");function i(){return{comments:[],updatedAt:null}}var r={namespaced:!0,state:i,getters:{comments:function(t){return t.comments}},actions:{fetch:function(t,e){var n=t.commit,o=(t.dispatch,t.getters,t.state);t.rootGetters;return!(moment().diff(o.updatedAt,"seconds")<3)&&new Promise((function(t,e){axios.get("comments").then((function(e){n("setState",e.data),t()}))}))},markAsRead:function(t,e){t.commit;var n=t.dispatch;t.getters,t.state,t.rootGetters;return new Promise((function(t,o){axios.post("comments",{id:e},{noLoading:!0}).then((function(e){t(),n("User.layout/initLayout",["comments"],{root:!0})}))}))},delete:function(t,e){var n=t.commit,o=t.dispatch;t.getters,t.state,t.rootGetters;return new Promise((function(t,a){axios.post("comments/delete",{ids:e}).then((function(e){n("setState",e.data),t(),o("User.layout/initLayout",["comments"],{root:!0})}))}))},resetState:function(t){(0,t.commit)("resetState")}},mutations:{setState:function(t,e){t.comments=e,t.updatedAt=moment()},resetState:function(t){t=Object.assign(t,{comments:[],updatedAt:null})}}};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==s(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==s(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===s(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var u={components:{DxDataGrid:a.DxDataGrid,DxColumn:a.DxColumn},data:function(){return{gridData:null,selectedId:null}},beforeCreate:function(){this.$store.registerModule("Admin.comments",r)},created:function(){this.fetch()},destroyed:function(){this.$store.unregisterModule("Admin.comments")},computed:d(d({},Object(o.c)("Admin.comments",["comments"])),{},{dataGrid:function(){return this.$refs.dataGrid.instance}}),watch:{comments:function(){this.cloneDeepData()}},methods:d(d({},Object(o.b)("Admin.comments",["fetch","markAsRead","delete","resetState"])),{},{onCellClick:function(t){0==t.columnIndex&&(this.selectedId=this.selectedId!=t.data.id?t.data.id:null,console.log(t),1!=t.data.read&&(t.data.read=1,this.markAsRead(t.data.id)))},onSave:function(t){var e=this;this.delete(t.changes.map((function(t){return t.key}))).then((function(){e.$toasted.success(e.$mt.messages.success.saved)}))},cloneDeepData:function(){this.gridData=this.$mf.cloneDeep(this.comments)}})},m=(n("o0Gb"),n("KHd+")),p=Object(m.a)(u,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"comments-page"},[e("h2",{staticClass:"content-block"},[t._v("\n    "+t._s(t.$t("admin.comments.title"))+"\n  ")]),t._v(" "),e("div",{staticClass:"content-block dx-card responsive-paddings"},[e("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":t.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,mode:"batch"},showColumnHeaders:!1,showColumnLines:!0},on:{contentReady:function(e){return t.$mf.dataGridPreload(t.gridData,t.dataGrid)},cellClick:t.onCellClick,saved:t.onSave},scopedSlots:t._u([{key:"dataCellTemplate",fn:function(n){var o=n.data;return[e("div",{staticClass:"comment"},[e("div",{staticClass:"subject"},[e("span",{class:o.data.read?"mark":"unread"},[t._v(t._s(o.data.subject))]),t._v(" "),o.data.url_images.length>0?e("i",{staticClass:"far fa-paperclip"}):t._e()]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:o.data.id==t.selectedId,expression:"data.data.id == selectedId"}]},[e("div",{staticClass:"info"},[e("div",[e("em",[t._v(t._s(o.data.sent_at))])]),t._v(" "),e("div",[e("b",[t._v(t._s(o.data.name))])]),t._v(" "),e("div",[e("i",{staticClass:"dx-icon-tel"}),t._v("\n                "+t._s(t._f("phone")(o.data.phone))+"\n              ")]),t._v(" "),o.data.user_code?e("RouterLink",{attrs:{to:{name:"users",query:{code:o.data.user_code}}}},[t._v(t._s(t.$t("admin.comments.viewUser").replace("{code}",o.data.user_code)))]):t._e()],1),t._v(" "),e("div",{staticClass:"content"},[t._v("\n              "+t._s(o.data.content)+"\n            ")]),t._v(" "),o.data.url_images.length?e("Photoswipe",t._l(o.data.url_images,(function(n,o){return e("div",{key:o},[e("img",{directives:[{name:"pswp",rawName:"v-pswp",value:n,expression:"url"}],attrs:{src:n,alt:t.$appName}})])})),0):t._e()],1)])]}}])},[e("DxColumn",{attrs:{"cell-template":"dataCellTemplate"}}),t._v(" "),e("DxColumn",{attrs:{width:50,type:"buttons",buttons:[{name:"delete"}],alignment:"center"}})],1)],1)])}),[],!1,null,null,null);e.default=p.exports},n3kp:function(t,e,n){var o=n("xSbr");"string"==typeof o&&(o=[[t.i,o,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n("aET+")(o,a);o.locals&&(t.exports=o.locals)},o0Gb:function(t,e,n){"use strict";n("n3kp")},xSbr:function(t,e,n){(t.exports=n("I1BE")(!1)).push([t.i,".comments-page .dx-row>td:first-child{cursor:pointer}.comment{padding:10px}.comment .subject .mark{-webkit-text-decoration-line:line-through;text-decoration-line:line-through}.comment .subject .unread{-webkit-text-decoration-line:none;text-decoration-line:none;font-weight:700}.comment .info{line-height:20px;font-size:13px;margin:10px 0 20px 10px}.comment .content{white-space:pre-line}",""])}}]);