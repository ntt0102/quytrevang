(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"1rnm":function(t,e,r){(t.exports=r("I1BE")(!1)).push([t.i,".price-plans-popup .dx-popup-content{padding:0}",""])},"6osD":function(t,e,r){"use strict";r("jcST")},DP10:function(t,e,r){"use strict";r.r(e);var n=r("L2JU"),a=r("0woa");function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){d(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function d(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var l={components:{DxDataGrid:a.DxDataGrid,DxColumn:a.DxColumn},data:function(){return{gridData:null,validationRules:{name:[{type:"required",message:this.$t("admin.smartorders.planName")+this.$mt.validations.required}],months:[{type:"required",message:this.$t("admin.smartorders.months")+this.$mt.validations.required}],price:[{type:"required",message:this.$t("admin.smartorders.planPrice")+this.$mt.validations.required}],renewalPrice:[{type:"required",message:this.$t("admin.smartorders.renewalPrice")+this.$mt.validations.required}],highestPrice:[{type:"required",message:this.$t("admin.smartorders.highestPrice")+this.$mt.validations.required}]}}},computed:s(s({},Object(n.c)("Admin.smartorders",["plans"])),{},{popup:function(){return this.$refs.popup.instance},dataGrid:function(){return this.$refs.dataGrid.instance}}),watch:{plans:function(){this.gridData=this.$mf.cloneDeep(this.plans)}},methods:s(s({},Object(n.b)("Admin.smartorders",["getPlans","savePlans"])),{},{show:function(){var t=this;this.popup.show(),this.getPlans(),this.$mf.pushPopupToHistoryState((function(){return t.popup.hide()}))},onSave:function(t){var e=this;setTimeout((function(){return e.$bus.emit("checkPin",(function(){return e.savePlans({changes:t.changes})}))}),100)},onHiding:function(){this.gridData=null,this.$mf.popRouteHistoryState()}})},c=(r("6osD"),r("KHd+")),u=Object(c.a)(l,(function(){var t=this,e=t._self._c;return e("DxPopup",{ref:"popup",staticClass:"price-plans-popup",attrs:{showCloseButton:!0,fullScreen:!!t.$devices.phone,"show-title":!0,title:t.$t("admin.smartorders.pricePlans")},on:{hiding:t.onHiding},scopedSlots:t._u([{key:"content",fn:function(){return[e("DxScrollView",[e("div",[e("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":t.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:8},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,mode:"batch",startEditAction:"dblClick"}},on:{contentReady:function(e){return t.$mf.dataGridPreload(t.gridData,t.dataGrid)},saved:t.onSave},scopedSlots:t._u([{key:"commandCellTemplate",fn:function(r){var n=r.data;return[e("DxToolbar",{attrs:{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:function(){t.dataGrid.deleteRow(n.rowIndex)}}}]}})]}}])},[e("DxColumn",{attrs:{fixed:!0,width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t("titles.commandHeaderTitleShort")}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"name","data-type":"string",caption:t.$t("admin.smartorders.planName"),"validation-rules":t.validationRules.name}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"months","data-type":"number",caption:t.$t("admin.smartorders.months"),"validation-rules":t.validationRules.months}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"price","data-type":"number",format:"#,##0","editor-options":{step:"1000",format:"#,##0"},caption:t.$t("admin.smartorders.planPrice"),"validation-rules":t.validationRules.price}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"renewal_price","data-type":"number",format:"#,##0","editor-options":{step:"1000",format:"#,##0"},caption:t.$t("admin.smartorders.renewalPrice"),"validation-rules":t.validationRules.renewalPrice}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"highest_price","data-type":"number",format:"#,##0","editor-options":{step:"1000",format:"#,##0"},caption:t.$t("admin.smartorders.highestPrice"),"validation-rules":t.validationRules.highestPrice}})],1)],1)])]},proxy:!0}])})}),[],!1,null,null,null).exports;r("wd/R");function m(){return{sos:[],users:[],plans:[]}}var p={namespaced:!0,state:m,getters:{sos:function(t){return t.sos},users:function(t){return t.users},plans:function(t){return t.plans}},actions:{fetch:function(t){var e=t.commit;t.dispatch,t.getters,t.state,t.rootGetters;return new Promise((function(t,r){axios.get("so/manage").then((function(r){e("setState",r.data),t()}))}))},validateDuplicateUser:function(t,e){var r=t.state,n=(t.rootGetters,r.sos.find((function(t){return t.id===e.data.id})));return n&&e.value==n.user_code?Promise.resolve(!0):new Promise((function(t,r){axios.post("so/manage/validate-user",{userCode:e.value},{noLoading:!0}).then((function(e){t(e.data)}))}))},save:function(t,e){t.commit;var r=t.dispatch;t.getters,t.state,t.rootGetters;return new Promise((function(t,n){axios.post("so/manage",e).then((function(e){t(),e.data.isOk&&r("fetch")}))}))},getPlans:function(t){var e=t.commit;t.dispatch,t.getters,t.state,t.rootGetters;return new Promise((function(t,r){axios.get("so/plans").then((function(r){e("setPlans",r.data),t()}))}))},savePlans:function(t,e){t.commit;var r=t.dispatch;t.getters,t.state,t.rootGetters;return new Promise((function(t,n){axios.post("so/plans",e).then((function(e){t(),e.data.isOk&&r("getPlans")}))}))},resetState:function(t){(0,t.commit)("resetState")}},mutations:{setState:function(t,e){t.sos=e.sos,t.users=e.users},setPlans:function(t,e){t.plans=e.plans},resetState:function(t){t=Object.assign(t,{sos:[],users:[],plans:[]})}}};function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function v(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?h(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==f(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===f(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var b={components:{DxDataGrid:a.DxDataGrid,DxColumn:a.DxColumn,PricePlansPopup:u},data:function(){return{gridData:null,validationRules:{user:[{type:"required",message:this.$t("admin.smartorders.user")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateUser,message:this.$t("admin.smartorders.user")+this.$mt.validations.duplicate}],balance:[{type:"periods",message:this.$t("admin.smartorders.periods")+this.$mt.validations.required}],lastTransaction:[{type:"deviceLimit",message:this.$t("admin.smartorders.deviceLimit")+this.$mt.validations.required}],startedAt:[{type:"required",message:this.$t("admin.smartorders.startedAt")+this.$mt.validations.required}]}}},beforeCreate:function(){this.$store.registerModule("Admin.smartorders",p)},created:function(){this.fetch()},destroyed:function(){this.$store.unregisterModule("Admin.smartorders")},computed:v(v({},Object(n.c)("Admin.smartorders",["sos","users"])),{},{dataGrid:function(){return this.$refs.dataGrid.instance}}),watch:{sos:function(){this.cloneDeepData()}},methods:v(v({},Object(n.b)("Admin.smartorders",["fetch","validateDuplicateUser","save"])),{},{onSave:function(t){var e=this;this.$bus.emit("checkPin",(function(){return e.save({changes:t.changes})}))},cloneDeepData:function(){this.gridData=this.$mf.cloneDeep(this.sos)},onInitNewRow:function(t){t.data.last_transaction=this.$t("admin.smartorders.openNewBook")},onToolbarPreparing:function(t){var e=this;t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{icon:"far fa-tags small",hint:this.$t("admin.smartorders.pricePlans"),onClick:function(){e.$refs.pricePlansPopup.show()}}})}})},y=Object(c.a)(b,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"smartorders-page"},[e("h2",{staticClass:"content-block"},[t._v("\n        "+t._s(t.$t("admin.smartorders.title"))+"\n    ")]),t._v(" "),e("div",{staticClass:"content-block dx-card responsive-paddings"},[e("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":t.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-chooser":{enabled:!0,mode:"select",allowSearch:!0},"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"batch"}},on:{contentReady:function(e){return t.$mf.dataGridPreload(t.gridData,t.dataGrid)},"init-new-row":t.onInitNewRow,"toolbar-preparing":t.onToolbarPreparing,saved:t.onSave},scopedSlots:t._u([{key:"commandCellTemplate",fn:function(r){var n=r.data;return[e("DxToolbar",{attrs:{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"far fa-empty-set small",hint:t.$t("admin.smartorders.clearDevices"),text:t.$t("admin.smartorders.clearDevices"),onClick:function(){return t.dataGrid.cellValue(n.rowIndex,"devices",[])}}},{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:function(){return t.dataGrid.deleteRow(n.rowIndex)}}}]}})]}}])},[e("DxColumn",{attrs:{fixed:!0,width:t.$devices.phone?35:70,alignment:"center",type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t("titles.commandHeaderTitle".concat(t.$devices.phone?"Short":""))}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"user_code",dataType:"number",name:"userCode","header-filter":{allowSearch:!0},caption:t.$t("admin.smartorders.user"),"validation-rules":t.validationRules.user,lookup:{dataSource:t.users,displayExpr:"name",valueExpr:"code",searchEnabled:!0,searchExpr:["code","name"]}}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"started_at","data-type":"date","editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT},caption:t.$t("admin.smartorders.startedAt")}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"periods",dataType:"string","header-filter":{allowSearch:!0},caption:t.$t("admin.smartorders.periods"),"validation-rules":t.validationRules.periods}}),t._v(" "),e("DxColumn",{attrs:{"data-field":"device_limit",dataType:"number","header-filter":{allowSearch:!0},caption:t.$t("admin.smartorders.deviceLimit"),"validation-rules":t.validationRules.deviceLimit}}),t._v(" "),e("DxColumn",{attrs:{visible:!1,"data-field":"devices",dataType:"string","header-filter":{allowSearch:!0},caption:t.$t("admin.smartorders.devices")}})],1)],1),t._v(" "),e("PricePlansPopup",{ref:"pricePlansPopup"})],1)}),[],!1,null,null,null);e.default=y.exports},jcST:function(t,e,r){var n=r("1rnm");"string"==typeof n&&(n=[[t.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r("aET+")(n,a);n.locals&&(t.exports=n.locals)}}]);