import{y as Gt,u as Jt,b as Zt,c as Qt,i as ee,r as O,d as er,e as Se,x as tr,z as rr,w as De,v as L,f as ir,g as sr,j as Ae,h as g,A as de,B as $,C as Ee,t as _e,E as or,G as N,H as Re,I as ar,o as lr}from"./app-e4f2b1c5.js";import{t as a,s as nr,_ as cr}from"./alert-b38c7cb8.js";import pr from"./ColorPicker-fb8a0382.js";import{c as dr}from"./lightweight-charts.esm.development-03366bac.js";const ur={class:"content-block dx-card responsive-paddings"},fr={class:"area data-area"},hr=["title"],mr=["title"],gr=["title"],vr=["title"],yr={class:"area tool-area"},xr=["title"],Cr=["title"],br=["title"],Pr=["title"],kr=["title"],Or=["title"],Lr=["title"],wr=["title"],Tr=["title"],Fr=["title"],Sr=["title"],Dr=["title"],Ar=["title"],Er=["title"],_r=["title"],Rr=["src"],ze=3,$e=2,zr="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",$r=120,Br={__name:"Index",setup(Mr){const Be={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},V=moment().format("YYYY-MM-DD"),w={START:moment(V+" 08:45:00").unix(),ATO:moment(V+" 09:00:00").unix(),ATC:moment(V+" 14:30:00").unix(),END:moment(V+" 14:45:00").unix()},v=Jt(),Me=Zt(),{t:C}=Qt(),Ve=ee("devices"),h=ee("mf"),ue=ee("bus"),U=ee("filters"),D=O(null),fe=O(null),q=O(null),he=O(null),me=O(null),ge=O(null),ve=O(null),Ie=O(null),Y=O(null),H=O(null),te=O(null),re=O(null),ie=O(null),se=O(null),oe=O(null),K=O(null),ae=O(null),W=O(null),B=O(null),X=O(null),Ne=O(null);let e={chart:{},series:{},data:{whitespace:[],original:[],price:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},C:{},D:{}},pattern1:{A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},pattern2:{O:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const f=er({symbol:"VNINDEX",chartDate:Me.query.date??V,clock:moment().format("HH:mm:ss"),isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),T=Se(()=>v.state.tradingOrder.status),qe=Se(()=>`https://iboard.ssi.com.vn/chart/?language=vi&theme=dark&symbol=${f.symbol}`);v.dispatch("tradingOrder/getConfig").then(()=>{le()}),v.dispatch("tradingOrder/getStatus"),e.interval=setInterval(tt,1e3),e.interval60=setInterval(()=>v.dispatch("tradingOrder/getStatus"),6e4),a.create(),tr(()=>{e.chart=dr(fe.value,Be),D.value.addEventListener("click",We),D.value.addEventListener("contextmenu",Ye),e.chart.subscribeCrosshairMove(Xe),e.chart.subscribeCustomPriceLineDragged(Ue),e.series.whitespace=e.chart.addLineSeries({priceScaleId:"whitespace",visible:!1}),e.series.box=e.chart.addHistogramSeries({priceScaleId:"box",scaleMargins:{top:0,bottom:0},color:"#667b68",lastValueVisible:!1,priceLineVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",priceFormat:{minMove:1},lastValueVisible:!1}),e.series.price=e.chart.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{minMove:.1}}),e.series.avg=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.1},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(He).observe(D.value),document.addEventListener("keydown",Ke),document.addEventListener("fullscreenchange",je),v.dispatch("tradingStock/getChartData",f.symbol).then(()=>{Je()})}),rr(()=>{clearInterval(e.interval),clearInterval(e.interval60),e.socketStop=!0,e.websocket.close(),e.websocket=null}),De(()=>v.state.tradingStock.chartData,Ze),De(()=>v.state.tradingOrder.isChartLoading,t=>{he.value.style.display=t?"block":"none"});function Ye(t){rt(),t.preventDefault()}function We(){ne(),Y.value.classList.contains("selected")?I():H.value.classList.contains("selected")?ut():te.value.classList.contains("selected")?mt():ae.value.classList.contains("selected")?ce():re.value.classList.contains("selected")?yt():ie.value.classList.contains("selected")?Pe():se.value.classList.contains("selected")?Oe():oe.value.classList.contains("selected")?we():K.value.classList.contains("selected")&&Dt()}function Xe(t){if(t.time){let r=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=r}else Ve.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function Ue(t){let r=t.customPriceLine,i=r.options();i.price=G(i.price);const l=+t.fromPriceString,n=i.price;switch(i.lineType){case"order":if(n!=l){let s=!1;i.kind=="entry"?T.value.position||(s=!0,e.order[i.kind].price=n,v.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"change",price:e.order.entry.price}}).then(p=>{p.isOk?(E(i.kind),L.success(C("trading.orderChart.changeEntrySuccess"))):(r.applyOptions({price:l}),S(p.message))})):(s=!0,e.order[i.kind].price=n,i.kind=="tp"?v.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"change",price:e.order.tp.price}}).then(p=>{p.isOk?(E(i.kind),L.success(C("trading.orderChart.changeTpSuccess"))):(r.applyOptions({price:l}),S(p.message))}):v.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"change",price:e.order.sl.price}}).then(p=>{p.isOk?(E(i.kind),L.success(C("trading.orderChart.changeSlSuccess"))):(r.applyOptions({price:l}),S(p.message))})),s||(r.applyOptions({price:l}),L.show(C("trading.orderChart.noChangeOrderLine")))}break;case"line":a.set("line",{price:l,removed:!0}),a.set("line",i),Y.value.classList.remove("selected");break;case"ruler":switch(i.point){case"l0":if(a.set("ruler",i),e.ruler.pointCount==2){const A=+e.ruler.l1.options().title,M=+(n-A).toFixed(1);e.ruler.ln1.applyOptions({price:M}),a.set("ruler",e.ruler.ln1.options());const Z=+(n+A).toFixed(1);e.ruler.l1.applyOptions({price:Z}),a.set("ruler",e.ruler.l1.options());const Q=+(n+A*2).toFixed(1);e.ruler.l2.applyOptions({price:Q}),a.set("ruler",e.ruler.l2.options());const Kt=+(n+A*3).toFixed(1);e.ruler.l3.applyOptions({price:Kt}),a.set("ruler",e.ruler.l3.options());const jt=+(n+A*4).toFixed(1);e.ruler.l4.applyOptions({price:jt}),a.set("ruler",e.ruler.l4.options())}break;case"ln1":const s=+e.ruler.l0.options().price,p=n-s;r.applyOptions({title:p.toFixed(1)}),a.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(-p).toFixed(1),price:+(s-p).toFixed(1)}),a.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-p*2).toFixed(1),price:+(s-p*2).toFixed(1)}),a.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-p*3).toFixed(1),price:+(s-p*3).toFixed(1)}),a.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-p*4).toFixed(1),price:+(s-p*4).toFixed(1)}),a.set("ruler",e.ruler.l4.options());break;case"l1":const u=+e.ruler.l0.options().price,c=n-u;r.applyOptions({title:c.toFixed(1)}),a.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-c).toFixed(1),price:+(u-c).toFixed(1)}),a.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(c*2).toFixed(1),price:+(u+c*2).toFixed(1)}),a.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(c*3).toFixed(1),price:+(u+c*3).toFixed(1)}),a.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(c*4).toFixed(1),price:+(u+c*4).toFixed(1)}),a.set("ruler",e.ruler.l4.options());break;case"l2":const m=+e.ruler.l0.options().price,b=n-m;r.applyOptions({title:b.toFixed(1)}),a.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-b*.5).toFixed(1),price:+(m-b*.5).toFixed(1)}),a.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(b*.5).toFixed(1),price:+(m+b*.5).toFixed(1)}),a.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(b*1.5).toFixed(1),price:+(m+b*1.5).toFixed(1)}),a.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(b*2).toFixed(1),price:+(m+b*2).toFixed(1)}),a.set("ruler",e.ruler.l4.options());break;case"l3":const y=+e.ruler.l0.options().price,x=n-y;r.applyOptions({title:x.toFixed(1)}),a.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-x/3).toFixed(1),price:+(y-x/3).toFixed(1)}),a.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(x/3).toFixed(1),price:+(y+x/3).toFixed(1)}),a.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(x*2/3).toFixed(1),price:+(y+x*2/3).toFixed(1)}),a.set("ruler",e.ruler.l2.options());break;case"l4":const P=+e.ruler.l0.options().price,k=n-P;r.applyOptions({title:k.toFixed(1)}),a.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-k/4).toFixed(1),price:+(P-k/4).toFixed(1)}),a.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(k/4).toFixed(1),price:+(P+k/4).toFixed(1)}),a.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(k/2).toFixed(1),price:+(P+k/2).toFixed(1)}),a.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(k*3/4).toFixed(1),price:+(P+k*3/4).toFixed(1)}),a.set("ruler",e.ruler.l3.options());break}break;case"pattern1":if(h.isSet(e.pattern1.C)){const s=+e.pattern1.A.options().price,u=+e.pattern1.B.options().price-s;e.pattern1.B.applyOptions({title:u.toFixed(1)}),a.set("pattern1",e.pattern1.B.options()),e.pattern1.C.applyOptions({price:+(s+.5*u).toFixed(1),title:(.5*u).toFixed(1)}),a.set("pattern1",e.pattern1.C.options()),e.pattern1.X1.applyOptions({price:+(s-.375*u).toFixed(1),title:(-.375*u).toFixed(1)}),a.set("pattern1",e.pattern1.X1.options()),e.pattern1.X2.applyOptions({price:+(s-.5*u).toFixed(1),title:(-.5*u).toFixed(1)}),a.set("pattern1",e.pattern1.X2.options()),e.pattern1.Y1.applyOptions({price:+(s-u).toFixed(1),title:-u.toFixed(1)}),a.set("pattern1",e.pattern1.Y1.options()),e.pattern1.Y2.applyOptions({price:+(s-2*u).toFixed(1),title:(-2*u).toFixed(1)}),a.set("pattern1",e.pattern1.Y2.options())}break;case"pattern2":if(h.isSet(e.pattern2.T)){const s=e.pattern2.E.options(),p=+s.price1,u=+s.price2,c=+s.price3,m=+s.price4,b=+s.price,y=c-u,x=p-m,P=c-m,k=b-m;let A,M;i.point=="S"?(M=+e.pattern2.S.options().price,A=b-M):(A=Math.abs(y)>Math.abs(k/2)?y:k/2,M=b-A,e.pattern2.S.applyOptions({price:+M.toFixed(1)}));const Z=M+(Math.abs(k)>Math.abs(P)?Math.abs(k)>Math.abs(x)?1:1.5:2)*k,Q=Z-b;e.pattern2.S.applyOptions({title:`SL=${(-A).toFixed(1)}`}),a.set("pattern2",e.pattern2.S.options()),e.pattern2.E.applyOptions({title:`RR=${(Q/A).toFixed(1)}`}),a.set("pattern2",e.pattern2.E.options()),e.pattern2.T.applyOptions({price:+Z.toFixed(1),title:`TP=${Q.toFixed(1)}`}),a.set("pattern2",e.pattern2.T.options())}break;case"alert":a.set("alert",{price:l,removed:!0});const d=e.data.price.slice(-1)[0].value;let o=n>=d?">":"<";r.applyOptions({title:o}),a.set("alert",r.options()),K.value.classList.remove("selected");break;case"box":if(i.point==1)ce(!0);else if(i.point==5){const s=+e.box[2].z.options().price,p=+e.box[4].z.options().price,u=s-p;e.box[5].z.applyOptions({price:+(s+.375*u).toFixed(1),title:(.375*u).toFixed(1)}),e.box[6].z.applyOptions({price:+(s+u).toFixed(1),title:u.toFixed(1)}),e.box[7].z.applyOptions({price:+(s+2*u).toFixed(1),title:(2*u).toFixed(1)}),a.get("box").then(c=>{c[4].z=e.box[4].z.options(),a.set("box",c[4]),c[5].z=e.box[5].z.options(),a.set("box",c[5]),c[6].z=e.box[6].z.options(),a.set("box",c[6]),c[7].z=e.box[7].z.options(),a.set("box",c[7])})}break}}function He(){D.value&&(e.chart.resize(D.value.offsetWidth,D.value.offsetHeight),D.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ke(t){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 38:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.05});break;case 40:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.05});break;case 37:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-10);break;case 39:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+10);break;case 96:H.value.click();break;case 97:Y.value.click();break;case 98:ge.value.click();break;case 99:me.value.click();case 100:ve.value.click();break}}function je(){D.value&&(document.fullscreenElement?(f.isFullscreen=!0,D.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(f.isFullscreen=!1,D.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Ge(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Je(){return new Promise(async t=>{T.value.pending&&((await a.get("order")).map(m=>{e.order.side=m.side,e.order[m.kind].price=m.price,E(m.kind),_(!0)}),e.order.tp.hasOwnProperty("line")&&e.order.entry.line.applyOptions({draggable:!1})),(await a.get("line")).forEach(c=>{c.removed||e.lines.push(e.series.price.createPriceLine(c))});const i=await a.get("box");i.length>0&&(e.box=i,i.forEach((c,m)=>{h.isSet(c.x)&&e.series.box.update(c.x),h.isSet(c.y)&&(e.box[m].y=e.series.cash.createPriceLine(c.y)),h.isSet(c.z)&&(e.box[m].z=e.series.price.createPriceLine(c.z))}));const l=await a.get("ruler");l.length>0&&(e.ruler.pointCount=l.length>1?2:1,l.forEach(c=>{e.ruler[c.point]=e.series.price.createPriceLine(c)}));const n=await a.get("target");n.length>0&&n.forEach(c=>{e.target[c.point]=e.series.cash.createPriceLine(c)});const d=await a.get("pattern1");d.length>0&&d.forEach(c=>{e.pattern1[c.point]=e.series.price.createPriceLine(c)});const o=await a.get("uplps");o.length>0&&o.forEach(c=>{e.uplps[c.title]=e.series[c.title.includes("P")?"price":"cash"].createPriceLine(c)});const s=await a.get("downlps");s.length>0&&s.forEach(c=>{e.downlps[c.title]=e.series[c.title.includes("P")?"price":"cash"].createPriceLine(c)});const p=await a.get("pattern2");p.length>0&&p.forEach(c=>{e.pattern2[c.point]=e.series.price.createPriceLine(c)}),(await a.get("alert")).forEach(c=>{c.removed||e.alerts.push(e.series.price.createPriceLine(c))}),t()})}function Ze(){const t=v.state.tradingStock.chartData;e.series.price.setData(t.price),e.series.avg.setData(t.avg),e.series.cash.setData(t.cash),e.chart.applyOptions({watermark:{text:f.symbol}})}function Qe(t){const r=e.data.original.length;if(e.data.original=et(e.data.original,[t]),e.data.original.length>r){const i=e.data.price.slice(-1)[0].value,l=e.data.cash.slice(-1)[0].value,n=t.price-i,d=n>0?1:n<0?-1:0,o={time:t.time,value:t.price},s={time:t.time,value:l+d*t.volume};e.data.price.push(o),e.series.price.update(o),e.data.cash.push(s),e.series.cash.update(s)}}function et(t,r){return Array.from(new Map([...t,...r].sort((i,l)=>i.time-l.time).map(i=>[i.time,i])).values())}function le(){e.websocket=new WebSocket(zr),e.websocket.onopen=t=>{let r={action:"join",list:v.state.tradingOrder.config.symbol};e.websocket.send(`42${JSON.stringify(["regs",JSON.stringify(r)])}`)},e.websocket.onclose=t=>{if(e.socketStop)return!1;j()&&(ye(!0),le(),moment().diff(e.socketRefreshTime,"seconds")>$r&&pe())},e.websocket.onmessage=t=>{if(ye(!1),t.data.substr(0,1)==4&&t.data.substr(1,1)==2){const r=JSON.parse(t.data.substr(2));if(r[0]=="stockps"){const i=r[1].data;i.id==3220&&(e.data.original.length>0&&Qe({time:moment(`${V} ${i.time}`).unix()+7*60*60,price:i.lastPrice,volume:i.lastVol}),Vt(),Mt())}}}}function tt(){const t=moment().unix();j(t)&&(T.value.position&&t>w.ATC-5*60&&(it(),t>w.ATC-15&&e.order.tp.hasOwnProperty("line")&&v.dispatch("tradingOrder/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),_(!1),a.clear("order"),L.success(C("trading.orderChart.autoCancelTpSlSuccess")),J()):S(r.message)})),t==w.START&&le()),f.clock=moment().format("HH:mm:ss")}function rt(){if(v.state.tradingOrder.config.openingMarket){const t=moment().unix();if(j(t)&&(e.order.tp.hasOwnProperty("line")||T.value.position&&t>w.ATO&&t<w.ATC&&(e.order.entry.price=e.data.price.slice(-1)[0].value,e.order.side=T.value.position,X.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",X.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",X.value.style.display="block"),!e.order.entry.hasOwnProperty("line"))){let r=null,i=0;T.value.position?(t<w.ATO?r="ATO":t>w.ATC&&(r="ATC"),r&&(e.order.entry.price=r,i=-T.value.position)):t>w.ATO&&t<w.ATC&&(r=z(e.crosshair.y),i=r>=e.data.price.slice(-1)[0].value?1:-1,e.order.side=i,e.order.entry.price=r),i&&(B.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",B.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",B.value.style.background=i>0?"green":"red",B.value.innerText=`${i>0?"LONG":"SHORT"} ${r}`,B.value.style.display="block")}}}function ne(){B.value.style.display="none",X.value.style.display="none"}function _(t){W.value.style.display=t?"block":"none"}function it(){W.value.classList.contains("blink")||W.value.classList.add("blink")}function ye(t){t?q.value.classList.contains("blink")||q.value.classList.add("blink"):q.value.classList.contains("blink")&&q.value.classList.remove("blink")}function E(t){let r,i;switch(t){case"entry":r="yellow",i=e.order.side>0?"LONG":"SHORT";break;case"tp":r="lime",i=Math.abs(e.order.tp.price-e.order.entry.price).toFixed(1);break;case"sl":r="red",i=Math.abs(e.order.sl.price-e.order.entry.price).toFixed(1);break}e.order[t].hasOwnProperty("line")?e.order[t].line.applyOptions({price:e.order[t].price,title:i}):e.order[t].line=e.series.price.createPriceLine({lineType:"order",kind:t,price:e.order[t].price,color:r,lineWidth:1,lineStyle:0,title:i,draggable:!0}),a.set("order",{kind:t,price:+e.order[t].price,side:e.order.side})}function F(t){e.order[t].hasOwnProperty("line")&&(e.series.price.removePriceLine(e.order[t].line),delete e.order[t].line)}function st(t){f.showTradingView=!f.showTradingView,t.stopPropagation()}function ot(t){f.showColorPicker=!f.showColorPicker,t.stopPropagation()}function at(t){h.isSet(e.pattern1.X)&&(I(+e.pattern1.X.options().price),I(+e.pattern1.Y.options().price),I(+e.pattern1.Z.options().price),I(+e.pattern1.T.options().price)),t.preventDefault(),t.stopPropagation()}function lt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function nt(t){ct(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function I(t=null,r=!1,i=!1){const l="line";t||(t=G(z(e.crosshair.y)));const n=e.lines.length;if(e.lines=e.lines.filter(d=>{const o=d.options(),s=o.type=t==+o.price;return s&&(e.series.price.removePriceLine(d),a.set("line",{price:t,removed:!0})),!s}),e.lines.length==n&&!i||r){const d={lineType:l,price:t,color:f.color,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(d)),a.set("line",d)}Y.value.classList.remove("selected")}function ct(){e.lines.forEach(t=>e.series.price.removePriceLine(t)),e.lines=[],a.clear("line")}function pt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),xe()),t.stopPropagation()}function dt(t){xe(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ut(){const t=z(e.crosshair.y);let r={lineType:"ruler",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)r.point="l0",r.color="#F44336",r.title="0",e.ruler[r.point]=e.series.price.createPriceLine(r),e.ruler.pointCount++,a.set("ruler",r);else{const i=+e.ruler.l0.options().price,l=t-i;r.point="l1",r.color="#FF9800",r.title=l.toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),a.set("ruler",r);const n=-l;r.point="ln1",r.color="#FF9800",r.title=n.toFixed(1),r.price=+(i+n).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),a.set("ruler",r);const d=2*l;r.point="l2",r.color="#FFEB3B",r.title=d.toFixed(1),r.price=+(i+d).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),a.set("ruler",r);const o=3*l;r.point="l3",r.color="#4CAF50",r.title=o.toFixed(1),r.price=+(i+o).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),a.set("ruler",r);const s=4*l;r.point="l4",r.color="#009688",r.title=s.toFixed(1),r.price=+(i+s).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),a.set("ruler",r),e.ruler.pointCount++,H.value.classList.remove("selected")}}function xe(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},a.clear("ruler"))}function ft(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Ce()),t.stopPropagation()}function ht(t){Ce(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function mt(){let r={lineType:"target",price:z(e.crosshair.y,"cash"),lineWidth:1,lineStyle:0,draggable:!1,axisLabelVisible:!1};if(h.isSet(e.target.A)?h.isSet(e.target.B)?(r.point="C",r.title="C",r.color="#9C27B0"):(r.point="B",r.title="B",r.color="#E91E63"):(r.point="A",r.title="A",r.color="#E91E63"),e.target[r.point]=e.series.cash.createPriceLine(r),a.set("target",r),r.point=="C"){const i=+e.target.A.options().price,l=+e.target.B.options().price,n=+e.target.C.options().price;r.point="D",r.price=+(n+l-i).toFixed(1),r.title="D",r.color="#9C27B0",e.target[r.point]=e.series.cash.createPriceLine(r),a.set("target",r),te.value.classList.remove("selected")}}function Ce(){h.isSet(e.target.A)&&(e.series.cash.removePriceLine(e.target.A),h.isSet(e.target.B)&&(e.series.cash.removePriceLine(e.target.B),h.isSet(e.target.C)&&(e.series.cash.removePriceLine(e.target.C),e.series.cash.removePriceLine(e.target.D))),e.target={A:{},B:{},C:{},D:{}},a.clear("target"))}function gt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),be()),t.stopPropagation()}function vt(t){be(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function yt(){const t=z(e.crosshair.y);let r={lineType:"pattern1",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(h.isSet(e.pattern1.A)){const i=+e.pattern1.A.options().price,l=t-i;r.point="B",r.title=l.toFixed(1),r.color="#FF9800",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),r.point="C",r.price=+(i+.5*l).toFixed(1),r.title=(.5*l).toFixed(1),r.color="#FF9800",r.draggable=!1,e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),r.point="X1",r.price=+(i-.375*l).toFixed(1),r.title=(-.375*l).toFixed(1),r.color="#2196F3",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),r.point="X2",r.price=+(i-.5*l).toFixed(1),r.title=(-.5*l).toFixed(1),r.color="#2196F3",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),r.point="Y1",r.price=+(i-l).toFixed(1),r.title=-l.toFixed(1),r.color="#673AB7",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),r.point="Y2",r.price=+(i-2*l).toFixed(1),r.title=(-2*l).toFixed(1),r.color="#673AB7",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r),re.value.classList.remove("selected")}else r.point="A",r.title="0",r.color="#FF9800",e.pattern1[r.point]=e.series.price.createPriceLine(r),a.set("pattern1",r)}function be(){h.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),h.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X1),e.series.price.removePriceLine(e.pattern1.X2),e.series.price.removePriceLine(e.pattern1.Y1),e.series.price.removePriceLine(e.pattern1.Y2)),e.pattern1={A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},a.clear("pattern1"))}function xt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r?Pe():t.target.classList.add("selected"),t.stopPropagation()}function Ct(t){ke(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Pe(){let t,r;h.isSet(e.uplps.P1)?(t=+e.uplps.P1.options().startTime,r=e.crosshair.time,ke()):t=e.crosshair.time;const{price1:i,price2:l,cash1:n,cash2:d}=bt(t,r);let o={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1};o.startTime=t,o.price=i,o.title="P1",e.uplps[o.title]=e.series.price.createPriceLine(o),a.set("uplps",o),o.price=l,o.title="P2",e.uplps[o.title]=e.series.price.createPriceLine(o),a.set("uplps",o),o.price=n,o.title="C1",e.uplps[o.title]=e.series.cash.createPriceLine(o),a.set("uplps",o),o.price=d,o.title="C2",e.uplps[o.title]=e.series.cash.createPriceLine(o),a.set("uplps",o),ie.value.classList.remove("selected")}function bt(t,r){let i,l,n,d=0,o=0,s,p,u=0,c=0;for(let m=0;m<e.data.price.length;m++){const b=e.data.price[m].time;if(b<t)continue;if(r&&b>r)break;const y=e.data.price[m].value,x=e.data.cash[m].value;if(i==null&&(i=y,l=y,n=y,s=x,p=x),y>n)d>o&&(l=n,o=d),n=y,d=0;else if(y<n){const P=+(n-y).toFixed(1);P>d&&(d=P)}if(y<i&&o>0)break;if(x>p)u>c&&(s=p,c=u),p=x,u=0;else if(x<p){const P=+(p-x).toFixed(1);P>u&&(u=P)}}return{price1:+(l-o).toFixed(1),price2:+(n-o).toFixed(1),cash1:+(s-c).toFixed(1),cash2:+(p-c).toFixed(1)}}function ke(){h.isSet(e.uplps.P1)&&(e.series.price.removePriceLine(e.uplps.P1),e.series.price.removePriceLine(e.uplps.P2)),h.isSet(e.uplps.C1)&&(e.series.cash.removePriceLine(e.uplps.C1),e.series.cash.removePriceLine(e.uplps.C2)),e.uplps={P1:{},P2:{},C1:{},C2:{}},a.clear("uplps")}function Pt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r?Oe():t.target.classList.add("selected"),t.stopPropagation()}function kt(t){Le(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Oe(){let t,r;h.isSet(e.downlps.P1)?(t=+e.downlps.P1.options().startTime,r=e.crosshair.time,Le()):t=e.crosshair.time;const{price1:i,price2:l,cash1:n,cash2:d}=Ot(t,r);let o={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1};o.startTime=t,o.price=i,o.title="P1",e.downlps[o.title]=e.series.price.createPriceLine(o),a.set("downlps",o),o.price=l,o.title="P2",e.downlps[o.title]=e.series.price.createPriceLine(o),a.set("downlps",o),o.price=n,o.title="C1",e.downlps[o.title]=e.series.cash.createPriceLine(o),a.set("downlps",o),o.price=d,o.title="C2",e.downlps[o.title]=e.series.cash.createPriceLine(o),a.set("downlps",o),se.value.classList.remove("selected")}function Ot(t,r){let i,l,n,d=0,o=0,s,p,u=0,c=0;for(let m=0;m<e.data.price.length;m++){const b=e.data.price[m].time;if(b<t)continue;if(r&&b>r)break;const y=e.data.price[m].value,x=e.data.cash[m].value;if(i==null&&(i=y,l=y,n=y,s=x,p=x),y<n)d<o&&(l=n,o=d),n=y,d=0;else if(y>n){const P=+(n-y).toFixed(1);P<d&&(d=P)}if(y>i&&o<0)break;if(x<p)u<c&&(s=p,c=u),p=x,u=0;else if(x>p){const P=+(p-x).toFixed(1);P<u&&(u=P)}}return{price1:+(l-o).toFixed(1),price2:+(n-o).toFixed(1),cash1:+(s-c).toFixed(1),cash2:+(p-c).toFixed(1)}}function Le(){h.isSet(e.downlps.P1)&&(e.series.price.removePriceLine(e.downlps.P1),e.series.price.removePriceLine(e.downlps.P2)),h.isSet(e.downlps.C1)&&(e.series.cash.removePriceLine(e.downlps.C1),e.series.cash.removePriceLine(e.downlps.C2)),e.downlps={P1:{},P2:{},C1:{},C2:{}},a.clear("downlps")}function Lt(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),we(!0)),t.stopPropagation()}function wt(t){Te(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function we(t=!1){let r={};if(h.isSet(e.pattern2.O)){const s=e.pattern2.O.options();r={time:s.time0,value:s.price0},Te()}else{if(t)return!1;r={time:e.crosshair.time,value:z(e.crosshair.y)}}const{price2:i,price3:l,price4:n,isAcc:d}=Tt(r);let o={lineType:"pattern2",lineWidth:1,lineStyle:1};console.log("isAcc",d),I(r.value,!d,d),o.time0=r.time,o.price0=r.value,o.point="O",o.price=n,o.title="O",o.color="#2196F3",o.draggable=!1,e.pattern2[o.point]=e.series.price.createPriceLine(o),a.set("pattern2",o),oe.value.classList.remove("selected")}function Tt(t){let r=t.value,i=t.value,l=t.value,n=!1;for(let d of e.data.price)if(d.time>=t.time){d.value<t.value?(r<=t.value&&d.value<r&&(r=d.value),i<=t.value&&r>t.value&&d.value<i&&(i=d.value)):d.value>t.value&&(r>=t.value&&d.value>r&&(r=d.value),i>=t.value&&r<t.value&&d.value>i&&(i=d.value));const o=d.value-i,s=t.value-i,p=r-i,u=Math.abs(s*2)>Math.abs(p/2)?s*2:p/2;if(l=+(i+u).toFixed(1),r!=t.value&&i!=t.value){if(Math.abs(o)>Math.abs(u)){n=!0;break}if(Math.abs(o)>Math.abs(s)*3)break}}return{price2:r,price3:i,price4:l,isAcc:n}}function Te(){h.isSet(e.pattern2.O)&&(e.series.price.removePriceLine(e.pattern2.O),e.pattern2={O:{}},a.clear("pattern2"))}function Ft(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function St(t){At(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Dt(){const t="alert",r=G(z(e.crosshair.y)),i=e.alerts.length;if(e.alerts=e.alerts.filter(l=>{const n=l.options(),d=n.type=r==+n.price;return d&&(e.series.price.removePriceLine(l),a.set("alert",{price:r,removed:!0})),!d}),e.alerts.length==i){const l={lineType:t,price:r,title:r>=e.data.price.slice(-1)[0].value?">":"<",color:"red",lineWidth:1,lineStyle:1,draggable:!0};e.alerts.push(e.series.price.createPriceLine(l)),a.set("alert",l)}K.value.classList.remove("selected")}function At(){e.alerts.forEach(t=>e.series.price.removePriceLine(t)),e.alerts=[],a.clear("alert")}function Et(t){f.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),ce(!0)),t.stopPropagation()}function _t(t){Fe(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ce(t=!1){let r={};if(t){if(e.box.length==0)return!1;r={time:+e.box[0].x.time,cash:+e.box[0].y.options().price,price:+e.box[0].z.options().price},Fe()}else{if(!e.crosshair.price)return!1;r={time:e.crosshair.time,cash:z(e.crosshair.y,"cash"),price:e.crosshair.price}}const{point1:i,point2:l,point3:n,point4:d,point5:o}=Rt(r);let s={};const p={x:{value:1},y:{lineWidth:1,lineStyle:0,draggable:!1,axisLabelVisible:!1},z:{lineType:"box",lineWidth:1,lineStyle:1,draggable:!1}};s=h.cloneDeep(p),s.point=1,s.x.time=i.time,s.y.price=i.cash,s.y.color="#6a3c07",s.z.point=1,s.z.price=i.price,s.z.title="⬤",s.z.color="#ff9966",s.z.draggable=!0,R(s),s=h.cloneDeep(p),s.point=2,delete s.x,delete s.y,delete s.z,R(s),s=h.cloneDeep(p),s.point=3,s.x.time=n.time,delete s.y,s.z.price=n.price,s.z.title="0",s.z.color="#ff9966",R(s),s=h.cloneDeep(p),s.point=4,s.x.time=d.time,s.y.price=d.cash,s.y.color="#600844",s.z.price=d.price,s.z.title="◀",s.z.color="#600844",R(s),s=h.cloneDeep(p),s.point=5,s.x.time=o.time,delete s.y,s.z.point=5,s.z.price=o.price,s.z.title="⬛",s.z.color="#ff9966",s.z.draggable=!0,R(s);const u=n.price-o.price;s=h.cloneDeep(p),s.point=6,delete s.x,delete s.y,s.z.price=+(n.price+.375*u).toFixed(1),s.z.title=(.375*u).toFixed(1),s.z.color="#009688",R(s),s=h.cloneDeep(p),s.point=7,delete s.x,delete s.y,s.z.price=+(n.price+u).toFixed(1),s.z.title=u.toFixed(1),s.z.color="#00BCD4",R(s),s=h.cloneDeep(p),s.point=8,delete s.x,delete s.y,s.z.price=+(n.price+2*u).toFixed(1),s.z.title=(2*u).toFixed(1),s.z.color="#2196F3",R(s),ae.value.classList.remove("selected")}function Rt(t){const r=h.cloneDeep(t);let i={...r},l={...r},n={...r},d={...r},o={...r};for(let s=0;s<e.data.price.length;s++){const p=e.data.price[s].time;if(p<=i.time)continue;const u=e.data.price[s].value,c=e.data.cash[s].value;if(c<i.cash?(l.cash<=i.cash&&c<l.cash&&(l.time=p,l.cash=c,n.time=p,d.time=p,o.time=p),l.cash>i.cash&&(n.cash<=i.cash&&c<n.cash&&(n.time=p,n.cash=c),c<l.cash&&n.cash==i.cash&&(n.time=p,d.time=p,o.time=p))):c>i.cash&&(l.cash>=i.cash&&c>l.cash&&(l.time=p,l.cash=c,n.time=p,d.time=p,o.time=p),l.cash<i.cash&&(n.cash>=i.cash&&c>n.cash&&(n.time=p,n.cash=c),c>l.cash&&n.cash==i.cash&&(n.time=p,d.time=p,o.time=p))),l.cash<n.cash?(l.price<=o.price&&u<l.price&&(l.price=u),u>n.price&&(n.price=u,o.price=u),u<o.price&&(o.price=u)):l.cash>n.cash&&(l.price>=o.price&&u>l.price&&(l.price=u),u<n.price&&(n.price=u,o.price=u),u>o.price&&(o.price=u)),n.cash!=i.cash){const m=e.data.whitespace.findIndex(k=>k.time===i.time),b=e.data.whitespace.findIndex(k=>k.time===n.time),y=e.data.whitespace.findIndex(k=>k.time===p),x=2*b-m,P=3*b-2*m;if(x<e.data.whitespace.length&&(d.time=e.data.whitespace[x].time,d.cash=+(n.cash+l.cash-i.cash).toFixed(1),d.price=+(n.price+l.price-i.price).toFixed(1)),P<e.data.whitespace.length&&(o.time=e.data.whitespace[P].time,o.cash=+(n.cash+l.cash-i.cash).toFixed(1)),y>x)break}}return{point1:i,point2:l,point3:n,point4:d,point5:o}}function R(t){a.set("box",t),h.isSet(t.x)&&e.series.box.update(t.x),h.isSet(t.y)&&(t.y=e.series.cash.createPriceLine(t.y)),h.isSet(t.z)&&(t.z=e.series.price.createPriceLine(t.z)),e.box.push(t)}function Fe(){e.box.forEach(t=>{h.isSet(t.y)&&e.series.cash.removePriceLine(t.y),h.isSet(t.z)&&e.series.price.removePriceLine(t.z)}),e.series.box.setData([]),e.box=[],a.clear("box")}async function zt(){e.order.entry.hasOwnProperty("line")&&(e.order.tp.hasOwnProperty("line")?v.dispatch("tradingOrder/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(F("entry"),F("tp"),F("sl"),_(!1),a.clear("order"),L.success(C("trading.orderChart.exitSuccess"))):(_(!0),S(t.message))}):v.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"delete"}}).then(t=>{t.isOk?(F("entry"),_(!1),a.clear("order"),L.success(C("trading.orderChart.deleteEntrySuccess"))):(_(!0),S(t.message))}))}function $t(){const t=moment().unix();j(t)&&(t<w.ATO?Re(C("trading.orderChart.atoOrder"),C("titles.confirm")).then(i=>{i&&v.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(l=>{l.isOk?L.success(C("trading.orderChart.atoOrderSuccess")):S(l.message)})}):t<w.ATC?v.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"new",side:e.order.side,price:e.order.entry.price}}).then(r=>{r.isOk?(E("entry"),_(!0),L.success(C("trading.orderChart.newEntrySuccess"))):S(r.message)}):Re(C("trading.orderChart.atcOrder"),C("titles.confirm")).then(i=>{i&&v.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(l=>{l.isOk?L.success(C("trading.orderChart.atcOrderSuccess")):S(l.message)})}))}function Bt(){e.order.tp.price=e.order.entry.price+e.order.side*ze,e.order.sl.price=e.order.entry.price-e.order.side*$e,v.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(t=>{t.isOk?(E("entry"),E("tp"),E("sl"),e.order.entry.line.applyOptions({draggable:!1}),L.success(C("trading.orderChart.newTpSlSuccess"))):S(t.message)})}function Mt(){if(e.order.entry.hasOwnProperty("line")){const t=e.data.price.slice(-1)[0].value;e.order.tp.hasOwnProperty("line")?((e.order.side>0&&t>=e.order.tp.price||e.order.side<0&&t<=e.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,v.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"delete"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),_(!1),a.clear("order"),L.success(C("trading.orderChart.deleteTpSuccess")),ne(),J()):S(r.message),e.isAutoOrdering=!1}))),(e.order.side>0&&t<=e.order.sl.price||e.order.side<0&&t>=e.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,v.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"cancel"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),_(!1),a.clear("order"),L.success(C("trading.orderChart.deleteSlSuccess")),ne(),J()):S(r.message),e.isAutoOrdering=!1})))):(e.order.side>0&&t>=e.order.entry.price||e.order.side<0&&t<=e.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.order.tp.price=e.order.entry.price+e.order.side*ze,e.order.sl.price=e.order.entry.price-e.order.side*$e,v.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(r=>{r.isOk?(E("tp"),E("sl"),e.order.entry.line.applyOptions({draggable:!1}),L.success(C("trading.orderChart.autoNewTpSlSuccess")),J()):S(r.message),e.isAutoOrdering=!1})},1e3)))}}function Vt(){if(T.value.position&&h.isSet(e.target.X)){const t=e.data.cash.slice(-1)[0].value,r=+e.target.B.options().price,i=+e.target.X.options().price,l=i-r;(l>0&&t>=i||l<0&&t<=i)&&W.value.click()}}function It(){e.chart.timeScale().scrollToRealTime()}function j(t=null){return t||(t=moment().unix()),t>=w.START&&t<=w.END}function z(t,r="price"){return G(e.series[r].coordinateToPrice(t))}function G(t){return t?+ +t.toFixed(1):0}function S(t){t||(t="unknown"),L.error(C(`trading.orderChart.${t}`))}function Nt(){e.loadWhitespace=!0,v.dispatch("tradingOrder/getChartData",f.chartDate)}function pe(){e.socketRefreshTime=moment(),e.loadWhitespace=!0,v.dispatch("tradingOrder/getChartData",f.chartDate)}function qt(){e.data.original=[],e.data.price=[],e.data.cash=[],e.data.whitespace=[],pe()}function J(){let t=new Audio(nr);t.crossOrigin="anonymous",t.addEventListener("canplaythrough",function(){t.play()})}function Yt(){v.dispatch("tradingOrder/getAccountInfo").then(t=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${C("trading.orderChart.nav")}</div><div>: ${U.currency(t.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${C("trading.orderChart.maxVol")}</div><div>: ${U.numberVnFormat(t.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${C("trading.orderChart.vm")}</div><div>: ${U.currency(t.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${C("trading.orderChart.fee")}</div><div>: ${U.currency(t.fee)}</div></div>`,r+="</div>",ar(r,C("trading.orderChart.accountInfo"))})}function Wt(){ue.emit("checkPin",()=>v.dispatch("tradingOrder/report"))}function Xt(){ue.emit("checkPin",()=>v.dispatch("tradingOrder/export"))}function Ut(t){if(f.symbol=="")return!1;f.symbol=f.symbol.toUpperCase(),v.dispatch("tradingStock/getChartData",f.symbol).then(r=>{e.series.price.setData(r.price),e.series.avg.setData(r.avg),e.series.cash.setData(r.cash),e.chart.applyOptions({watermark:{text:f.symbol}}),t.target.blur()})}function Ht(t){t.target.select()}return(t,r)=>{const i=ir("DxToolbar");return lr(),sr("div",ur,[Ae(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-flag-checkered small",hint:t.$t("trading.orderChart.buttons.report"),onClick:Wt}},{location:"before",widget:"dxButton",options:{icon:"far fa-file-export small",hint:t.$t("trading.orderChart.buttons.export"),onClick:Xt}},{location:"before",widget:"dxButton",options:{icon:"far fa-chart-line small",hint:t.$t("trading.orderChart.buttons.cashflow"),onClick:()=>t.$refs.dailyCashFlowPopupRef.show()}}]},null,8,["items"]),g("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:D},[g("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:fe},[g("div",fr,[g("div",{ref_key:"connectionRef",ref:q,class:de(`command far fa-${T.value.connection?"link":"unlink"}`),title:t.$t("trading.orderChart.connection"),onClick:r[0]||(r[0]=()=>t.$store.dispatch("tradingOrder/getStatus"))},null,10,hr),$(g("input",{type:"text",class:"command symbol-input",title:t.$t("trading.stock.symbol"),"onUpdate:modelValue":r[1]||(r[1]=l=>f.symbol=l),onChange:Ut,onFocus:Ht},null,40,mr),[[Ee,f.symbol]]),g("div",{class:de(["command status",{green:T.value.position>0,red:T.value.position<0,pending:T.value.pending}]),title:t.$t("trading.orderChart.position"),onClick:Yt},_e(T.value.position),11,gr),g("div",{class:"command clock",onClick:pe},_e(f.clock),1),$(g("input",{type:"date",class:"chart-date command",title:t.$t("trading.orderChart.date"),"onUpdate:modelValue":r[2]||(r[2]=l=>f.chartDate=l),onChange:Nt},null,40,vr),[[Ee,f.chartDate]]),g("img",{ref_key:"spinnerRef",ref:he,class:"command spinner",src:cr},null,512)]),g("div",yr,[g("div",{ref_key:"fullscreenToolRef",ref:me,class:de(`command far fa-${f.isFullscreen?"compress":"expand"}`),title:t.$t("trading.orderChart.fullscreen"),onClick:Ge},null,10,xr),g("div",{ref_key:"reloadToolRef",ref:ge,class:"command far fa-sync-alt",title:t.$t("trading.orderChart.reload"),onClick:qt},null,8,Cr),g("div",{ref_key:"tradingviewRef",ref:ve,class:"command far fa-chart-bar",title:t.$t("trading.orderChart.tradingview"),onClick:st},null,8,br),g("div",{ref_key:"colorToolRef",ref:Ie,class:"color command far fa-palette",style:or({color:f.color}),title:t.$t("trading.orderChart.colorTool"),onClick:ot,onContextmenu:at},[$(Ae(pr,{class:"color-picker",modelValue:f.color,"onUpdate:modelValue":r[3]||(r[3]=l=>f.color=l)},null,8,["modelValue"]),[[N,f.showColorPicker]])],44,Pr),g("div",{ref_key:"lineToolRef",ref:Y,class:"command far fa-horizontal-rule",title:t.$t("trading.orderChart.lineTool"),onClick:lt,onContextmenu:nt},null,40,kr),g("div",{ref_key:"pattern1ToolRef",ref:re,class:"command far fa-dot-circle",title:t.$t("trading.orderChart.pattern1Tool"),onClick:gt,onContextmenu:vt},null,40,Or),g("div",{ref_key:"uplpsToolRef",ref:ie,class:"command far fa-arrow-up",title:t.$t("trading.orderChart.uplpsTool"),onClick:xt,onContextmenu:Ct},null,40,Lr),g("div",{ref_key:"downlpsToolRef",ref:se,class:"command far fa-arrow-down",title:t.$t("trading.orderChart.downlpsTool"),onClick:Pt,onContextmenu:kt},null,40,wr),$(g("div",{ref_key:"pattern2ToolRef",ref:oe,class:"command far fa-heart",title:t.$t("trading.orderChart.pattern2Tool"),onClick:Lt,onContextmenu:wt},null,40,Tr),[[N,!1]]),g("div",{ref_key:"rulerToolRef",ref:H,class:"command far fa-line-height",title:t.$t("trading.orderChart.rulerTool"),onClick:pt,onContextmenu:dt},null,40,Fr),$(g("div",{ref_key:"targetToolRef",ref:te,class:"command far fa-grip-lines",title:t.$t("trading.orderChart.targetTool"),onClick:ft,onContextmenu:ht},null,40,Sr),[[N,!1]]),g("div",{ref_key:"boxToolRef",ref:ae,class:"command far fa-expand-alt",title:t.$t("trading.orderChart.boxTool"),onClick:Et,onContextmenu:_t},null,40,Dr),$(g("div",{ref_key:"alertToolRef",ref:K,class:"command far fa-alarm-exclamation",title:t.$t("trading.orderChart.alertTool"),onClick:Ft,onContextmenu:St},null,40,Ar),[[N,!1]]),$(g("div",{class:"command far fa-info-circle",title:t.$t("trading.orderChart.copyistStatusPopup.title"),onClick:r[4]||(r[4]=()=>t.$refs.copyistStatusPopupRef.show())},null,8,Er),[[N,!1]]),g("div",{ref_key:"cancelOrderRef",ref:W,class:"cancel-order command far fa-trash-alt",title:t.$t("trading.orderChart.cancelTool"),onClick:zt},null,8,_r)]),g("div",null,[g("div",{ref_key:"entryOrderRef",ref:B,class:"order-button entry",onClick:$t}," Entry ",512),g("div",{ref_key:"tpslOrderRef",ref:X,class:"order-button tpsl",onClick:Bt}," TP/SL ",512),g("div",{class:"chart-top command far fa-angle-double-right",onClick:It})]),$(g("iframe",{ref_key:"tradingviewChartRef",ref:Ne,class:"tradingview-chart",src:qe.value},null,8,Rr),[[N,f.showTradingView]])],512)],512)])}}},Yr=Gt(Br,[["__scopeId","data-v-b8c97230"]]);export{Yr as default};
