import{_ as C,m as $,c as I,r as l,g as m,w as c,o as u,f as d,e,t as n,i as p,h as v,j as _}from"./app-9b98c2f0.js";import{_ as y}from"./accordion-eac2b0ad.js";import{_ as b}from"./load-indicator-a1d2265f.js";const k={components:{DxAccordion:y,DxLoadIndicator:b},data(){return{formData:{},backupDocuments:[],contract:{},qrSrc:null}},mounted(){this.initFormData()},computed:{...$("User.contract",["transferInfo"]),popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance}},methods:{...I("User.contract",["payingContract"]),show(t){this.popup.option("title",this.$t(`components.payingContract.${t.status==0?"title":"changeReceiptTitle"}`)+" #"+t.code),this.contract=t,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",t.status),0),this.backupDocuments=t.url_paid_docs.map(a=>({file:a,isUpload:!1})),this.formData.documents=this.backupDocuments;let o=`https://img.vietqr.io/image/${this.transferInfo.bank_name}-${this.transferInfo.account_number}-KRnx1D.jpg?accountName=${this.transferInfo.account_name}&amount=${this.contract.principal}&addInfo=${this.$t("models.contract.transfer.contentValue").replace("{contractCode}",this.contract.code)}`;this.$mf.fetchImage(o).then(a=>this.qrSrc=a),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},downloadQR(){let t=document.createElement("a");t.href=this.qrSrc,t.download=`vietQR_${this.contract.code}`,t.click()},onUploadImageChange(t){this.formData.documents=this.formData.documents.filter(o=>!o.isUpload),[...t.target.files].forEach(o=>this.formData.documents.push({file:URL.createObjectURL(o),isUpload:!0}))},onCheckBoxDeleteChange(t){t.value?this.formData.documents=this.formData.documents.filter(o=>o.isUpload):this.formData.documents=this.backupDocuments.concat(this.formData.documents)},saveClick(){this.formData.documents.findIndex(t=>t.isUpload)!=-1?this.$refs.submit.click():this.$toasted.show(this.$t("messages.info.noUploadImage"))},onSubmit(){this.$bus.emit("checkPin",async()=>{let t=new FormData;t.append("contractId",this.contract.id),t.append("type",this.type),t.append("isDelete",this.formData.isDelete);for(var o=0;o<this.$refs.receiptImage.files.length;o++){let a=await this.$mf.resizeImage({file:this.$refs.receiptImage.files[o],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${o}]`,a)}this.payingContract(t).then(a=>{a&&this.popup.hide()})})},initFormData(){this.formData={isDelete:!1,documents:[]},this.qrSrc=null},onHiding(){this.$mf.popRouteHistoryState(),this.initFormData()}}},S={ref:"submit",class:"display-none"},w={class:"caution"},U={class:"step1"},V={class:"description text-darker"},B={class:"method"},T=e("div",{class:"method1"},null,-1),P={class:"method2"},A={class:"text-darker"},N={class:"upload"},R={class:"upload-browser"},q={for:"receiptImage"},x=e("i",{class:"far fa-file-upload"},null,-1);function H(t,o,a,L,s,r){const f=l("DxCheckBox"),h=l("DxAccordion"),g=l("DxScrollView"),D=l("DxPopup");return u(),m(D,{ref:"popup",showCloseButton:!0,fullScreen:!!t.$screen.getScreenSizeInfo.isXSmall,"show-title":!0,wrapperAttr:{class:"paying-contract-popup"},toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t(`components.payingContract.${s.contract.status==0?"paidButton":"changeReceiptButton"}`),onClick:r.saveClick}}],onHiding:r.onHiding},{content:c(()=>[d(g,null,{default:c(()=>[e("form",{onSubmit:o[5]||(o[5]=_((...i)=>r.onSubmit&&r.onSubmit(...i),["prevent"]))},[e("button",S,null,512),e("div",w,[e("div",null,n(t.$t("titles.caution"))+":",1),e("div",null,"  - "+n(t.$t("components.payingContract.paidDateCaution")),1),e("div",null,"  - "+n(t.$t("components.payingContract.timeCaution")),1)]),d(h,{ref:"accordion",collapsible:!0,items:[{title:t.$t("components.payingContract.step1"),template:"step1Template"},{title:t.$t("components.payingContract.step2"),template:"step2Template"}]},{step1Template:c(()=>[e("div",U,[e("div",V,n(t.$t("models.contract.transfer.qrCode")),1),e("div",B,[T,e("div",P,[e("div",null,[e("span",null,n(t.$t("models.user.bankName"))+":",1),e("span",null,n(t.transferInfo.bank_name),1)]),e("div",null,[e("span",null,n(t.$t("models.user.accountName"))+":",1),e("span",null,n(t.transferInfo.account_name),1)]),e("div",null,[e("span",null,n(t.$t("models.user.accountNumber"))+":",1),e("span",null,[p(n(t.transferInfo.account_number)+" ",1),e("i",{class:"far fa-copy",onClick:o[0]||(o[0]=i=>t.$mf.copyText(t.transferInfo.account_number))})])]),e("div",null,[e("span",null,n(t.$t("models.contract.transfer.amount"))+":",1),e("span",null,[p(n(s.contract.principal|t.currency())+" ",1),e("i",{class:"far fa-copy",onClick:o[1]||(o[1]=i=>t.$mf.copyText(s.contract.principal))})])]),e("div",null,[e("span",null,n(t.$t("models.contract.transfer.content"))+":",1),e("span",null,[p(n(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",s.contract.code))+" ",1),e("i",{class:"far fa-copy",onClick:o[2]||(o[2]=i=>t.$mf.copyText(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",s.contract.code)))})])]),e("div",A,n(t.$t("models.contract.transfer.note")),1)])])])]),step2Template:c(()=>[e("div",N,[e("div",R,[e("input",{ref:"receiptImage",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:o[3]||(o[3]=(...i)=>r.onUploadImageChange&&r.onUploadImageChange(...i))},null,544),e("label",q,[x,p(" "+n(t.$t("titles.chooseImage")),1)]),s.contract.status==1?(u(),m(f,{key:0,id:"contractDelete",modelValue:s.formData.isDelete,"onUpdate:modelValue":o[4]||(o[4]=i=>s.formData.isDelete=i),text:t.$t("titles.deleteOldImage"),onValueChanged:r.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])):v("",!0)])])]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"])}const z=C(k,[["render",H]]);export{z as default};
