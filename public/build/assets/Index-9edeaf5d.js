import{u as je,b as Me,c as ze,i as Z,r as L,d as We,e as H,x as Ke,w as G,f as Ne,g as Ie,h as C,j as R,l as Xe,z as J,C as Ye,A as W,E as K,F as Ue,o as Ze}from"./app-beaef441.js";import{_ as He}from"./spinner-40be0a1e.js";import Ge from"./ColorPicker-8ee2ebd0.js";import{_ as Je,a as Qe}from"./FilterPopup-7008ccec.js";import{c as et}from"./lightweight-charts.esm.development-03366bac.js";class tt{constructor(){this.create()}create(){return new Promise((b,d)=>{const v=indexedDB.open("stockChart",1);v.onupgradeneeded=F=>{this.store=F.target.result,this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("uplps",{keyPath:"title"}),this.store.createObjectStore("downlps",{keyPath:"title"}),b()},v.onsuccess=F=>{this.store=F.target.result,b()},v.onerror=()=>{location.reload(),d()}})}get(b){var d=this.store;return new Promise(function(F,u){var x=d.transaction(b,"readonly");if(Array.isArray(b)){var S=b.map(T=>x.objectStore(T)),O=S.map(v);Promise.all(O).then(T=>F(T))}else{var D=x.objectStore(b);v(D).then(T=>F(T))}});function v(F){return new Promise(function(u,x){const S=F.getAll();S.onsuccess=O=>u(O.target.result),S.onerror=()=>x()})}}set(b,d){const v=this.store.transaction(b,"readwrite").objectStore(b);Array.isArray(d)?d.length>0&&d.forEach(F=>v.put(F)):v.put(d)}clear(b){var d=this.store;return new Promise(function(v,F){const u=d.transaction(b,"readwrite").objectStore(b).clear();u.onsuccess=()=>{v()},u.onerror=x=>{console.error(`Error to empty Object Store: ${b}`),F()}})}}const p=new tt;const ot={class:"content-block dx-card responsive-paddings"},st={class:"area data-area"},it=["title"],rt={class:"area tool-area"},lt=["title"],nt=["title"],at=["title"],ct=["title"],pt=["title"],dt=["title"],ut=["title"],ft=["title"],mt=["src"],Pt={__name:"Index",setup(Q){const b={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},d=je();Me();const{t:v}=ze(),F=Z("devices"),u=Z("mf"),x=L(null),S=L(null),O=L(null),D=L(null),T=L(null),ee=L(null),_=L(null),E=L(null),A=L(null),V=L(null),B=L(null),te=L(null);let e={chart:{},series:{},data:{original:[],price:[],cash:[]},tools:{lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}}},crosshair:{}};const c=We({symbol:"VNINDEX",symbols:[],symbolsKind:null,symbolsKinds:[{text:v("trading.stock.hoseList"),value:"hose"},{text:v("trading.stock.indexList"),value:"index"},{text:v("trading.stock.filterCash"),value:"fcash"},{text:v("trading.stock.filterIndex"),value:"findex"},{text:v("trading.stock.filterMix"),value:"fmix"},{text:v("trading.stock.watchList"),value:"watch"}],isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1});c.symbolsKind=c.symbolsKinds[1];const oe=H(()=>`https://chart.vps.com.vn/tv/?symbol=${c.symbol}`),N=H(()=>d.state.tradingStock.symbols.watch.includes(c.symbol));d.dispatch("tradingStock/getSymbols"),p.create(),Ke(()=>{e.chart=et(S.value,b),x.value.addEventListener("click",ie),x.value.addEventListener("contextmenu",se),e.chart.subscribeCrosshairMove(re),e.chart.subscribeCustomPriceLineDragged(le),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(ne).observe(x.value),document.addEventListener("fullscreenchange",ae),d.dispatch("tradingStock/getChartData",c.symbol)}),G(()=>d.state.tradingStock.chart,()=>{de(),ue()}),G(()=>d.state.tradingStock.isChartLoading,t=>{O.value.style.display=t?"block":"none"});function se(t){t.preventDefault()}function ie(){_.value.classList.contains("selected")?ve():E.value.classList.contains("selected")?be():A.value.classList.contains("selected")?Fe():V.value.classList.contains("selected")?Y():B.value.classList.contains("selected")&&U()}function re(t){if(t.time){let s=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=s}else F.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function le(t){let s=t.customPriceLine,i=s.options();i.price=z(i.price);const r=+t.fromPriceString,l=i.price;switch(i.lineType){case"line":p.set("line",{price:r,removed:!0}),d.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:c.symbol,name:i.lineType,points:[r],data:[i]}),_.value.classList.remove("selected");break;case"ruler":switch(i.point){case"l0":if(p.set("ruler",i),e.ruler.pointCount==2){const P=+e.ruler.l1.options().title,Ae=+(l-P).toFixed(1);e.ruler.ln1.applyOptions({price:Ae}),p.set("ruler",e.ruler.ln1.options());const Ve=+(l+P).toFixed(1);e.ruler.l1.applyOptions({price:Ve}),p.set("ruler",e.ruler.l1.options());const Be=+(l+P*2).toFixed(1);e.ruler.l2.applyOptions({price:Be}),p.set("ruler",e.ruler.l2.options());const qe=+(l+P*3).toFixed(1);e.ruler.l3.applyOptions({price:qe}),p.set("ruler",e.ruler.l3.options());const $e=+(l+P*4).toFixed(1);e.ruler.l4.applyOptions({price:$e}),p.set("ruler",e.ruler.l4.options())}break;case"ln1":const n=+e.ruler.l0.options().price,o=l-n;s.applyOptions({title:o.toFixed(1)}),p.set("ruler",s.options()),e.ruler.l1.applyOptions({title:(-o).toFixed(1),price:+(n-o).toFixed(1)}),p.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-o*2).toFixed(1),price:+(n-o*2).toFixed(1)}),p.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-o*3).toFixed(1),price:+(n-o*3).toFixed(1)}),p.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-o*4).toFixed(1),price:+(n-o*4).toFixed(1)}),p.set("ruler",e.ruler.l4.options());break;case"l1":const a=+e.ruler.l0.options().price,f=l-a;s.applyOptions({title:f.toFixed(1)}),p.set("ruler",s.options()),e.ruler.ln1.applyOptions({title:(-f).toFixed(1),price:+(a-f).toFixed(1)}),p.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(f*2).toFixed(1),price:+(a+f*2).toFixed(1)}),p.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(f*3).toFixed(1),price:+(a+f*3).toFixed(1)}),p.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(f*4).toFixed(1),price:+(a+f*4).toFixed(1)}),p.set("ruler",e.ruler.l4.options());break;case"l2":const m=+e.ruler.l0.options().price,y=l-m;s.applyOptions({title:y.toFixed(1)}),p.set("ruler",s.options()),e.ruler.ln1.applyOptions({title:(-y*.5).toFixed(1),price:+(m-y*.5).toFixed(1)}),p.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(y*.5).toFixed(1),price:+(m+y*.5).toFixed(1)}),p.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(y*1.5).toFixed(1),price:+(m+y*1.5).toFixed(1)}),p.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(y*2).toFixed(1),price:+(m+y*2).toFixed(1)}),p.set("ruler",e.ruler.l4.options());break;case"l3":const k=+e.ruler.l0.options().price,w=l-k;s.applyOptions({title:w.toFixed(1)}),p.set("ruler",s.options()),e.ruler.ln1.applyOptions({title:(-w/3).toFixed(1),price:+(k-w/3).toFixed(1)}),p.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(w/3).toFixed(1),price:+(k+w/3).toFixed(1)}),p.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(w*2/3).toFixed(1),price:+(k+w*2/3).toFixed(1)}),p.set("ruler",e.ruler.l2.options());break;case"l4":const h=+e.ruler.l0.options().price,g=l-h;s.applyOptions({title:g.toFixed(1)}),p.set("ruler",s.options()),e.ruler.ln1.applyOptions({title:(-g/4).toFixed(1),price:+(h-g/4).toFixed(1)}),p.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(g/4).toFixed(1),price:+(h+g/4).toFixed(1)}),p.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(g/2).toFixed(1),price:+(h+g/2).toFixed(1)}),p.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(g*3/4).toFixed(1),price:+(h+g*3/4).toFixed(1)}),p.set("ruler",e.ruler.l3.options());break}break;case"target":if(u.isSet(e.tools.target.B)){let n={isRemove:!1,symbol:c.symbol,name:"target",points:[],data:[]},o;const a=+e.tools.target.A.options().price,m=+e.tools.target.B.options().price-a;o="B",e.tools.target[o].applyOptions({title:(100*m/a).toFixed(1)+"%"}),n.points.push(o),n.data.push(e.tools.target[o].options()),o="X",e.tools.target[o].applyOptions({price:+(a-.5*m).toFixed(1),title:(100*-.5*m/a).toFixed(1)+"%"}),n.points.push(o),n.data.push(e.tools.target[o].options()),o="Y",e.tools.target[o].applyOptions({price:+(a-m).toFixed(1),title:(100*-m/a).toFixed(1)+"%"}),n.points.push(o),n.data.push(e.tools.target[o].options()),o="Z",e.tools.target[o].applyOptions({price:+(a-2*m).toFixed(1),title:(100*-2*m/a).toFixed(1)+"%"}),n.points.push(o),n.data.push(e.tools.target[o].options()),d.dispatch("tradingStock/drawTools",n)}break}}function ne(){x.value&&(e.chart.resize(x.value.offsetWidth,x.value.offsetHeight),x.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function ae(){x.value&&(document.fullscreenElement?(c.isFullscreen=!0,x.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(c.isFullscreen=!1,x.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function ce(){const t={symbol:c.symbol,add:!N.value};d.dispatch("tradingStock/addWatchlist",t)}function pe(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function de(){I(!1),$(!1),j(!1),q(!1);const t=d.state.tradingStock.chart.tools;for(const[s,i]of Object.entries(t))switch(s){case"line":Object.values(i).forEach(r=>e.tools.lines.push(e.series.price.createPriceLine(r)));break;case"uplps":Object.entries(i).forEach(([r,l])=>e.tools.uplps[r]=e.series[r.includes("P")?"price":"cash"].createPriceLine(l));break;case"downlps":Object.entries(i).forEach(([r,l])=>e.tools.downlps[r]=e.series[r.includes("P")?"price":"cash"].createPriceLine(l));break;case"target":Object.entries(i).forEach(([r,l])=>e.tools.target[r]=e.series.price.createPriceLine(l));break}}function ue(){e.data=d.state.tradingStock.chart.data,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:c.symbol}})}function fe(t){c.showTradingView=!c.showTradingView,t.stopPropagation()}function me(t){c.showColorPicker=!c.showColorPicker,t.stopPropagation()}function he(t){t.preventDefault(),t.stopPropagation()}function ge(t){c.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),s||t.target.classList.add("selected"),t.stopPropagation()}function ye(t){I(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ve(t=null,s=!1,i=!1){const r="line";t||(t=z(M(e.crosshair.y)));const l=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(n=>{const o=n.options(),a=o.type=t==+o.price;return a&&(e.series.price.removePriceLine(n),d.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:r,point:t})),!a}),e.tools.lines.length==l&&!i||s){const n={lineType:r,price:t,color:c.color,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(n)),d.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:c.symbol,name:r,points:[t],data:[n]})}_.value.classList.remove("selected")}function I(t=!0){e.tools.lines.length>0&&(console.log("removeLineTool"),e.tools.lines.forEach(s=>e.series.price.removePriceLine(s)),e.tools.lines=[],t&&d.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"line",point:null}))}function xe(t){c.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),s||(t.target.classList.add("selected"),X()),t.stopPropagation()}function Pe(t){X(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function be(){const t=M(e.crosshair.y);let s={lineType:"ruler",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)s.point="l0",s.color="#F44336",s.title="0",e.ruler[s.point]=e.series.price.createPriceLine(s),e.ruler.pointCount++,p.set("ruler",s);else{const i=+e.ruler.l0.options().price,r=t-i;s.point="l1",s.color="#FF9800",s.title=r.toFixed(1),e.ruler[s.point]=e.series.price.createPriceLine(s),p.set("ruler",s);const l=-r;s.point="ln1",s.color="#FF9800",s.title=l.toFixed(1),s.price=+(i+l).toFixed(1),e.ruler[s.point]=e.series.price.createPriceLine(s),p.set("ruler",s);const n=2*r;s.point="l2",s.color="#FFEB3B",s.title=n.toFixed(1),s.price=+(i+n).toFixed(1),e.ruler[s.point]=e.series.price.createPriceLine(s),p.set("ruler",s);const o=3*r;s.point="l3",s.color="#4CAF50",s.title=o.toFixed(1),s.price=+(i+o).toFixed(1),e.ruler[s.point]=e.series.price.createPriceLine(s),p.set("ruler",s);const a=4*r;s.point="l4",s.color="#009688",s.title=a.toFixed(1),s.price=+(i+a).toFixed(1),e.ruler[s.point]=e.series.price.createPriceLine(s),p.set("ruler",s),e.ruler.pointCount++,E.value.classList.remove("selected")}}function X(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},p.clear("ruler"))}function ke(t){c.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),s||(t.target.classList.add("selected"),q()),t.stopPropagation()}function Ce(t){q(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Fe(){const t="target",s=M(e.crosshair.y);let i={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},r={isRemove:!1,symbol:c.symbol,name:t,points:[],data:[]};if(u.isSet(e.tools.target.A)){const l=+e.tools.target.A.options().price,n=s-l;i.point="B",i.title=(100*n/l).toFixed(1)+"%",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),r.points.push(i.point),r.data.push(u.cloneDeep(i)),i.point="X",i.price=+(l-.5*n).toFixed(1),i.title=(100*-.5*n/l).toFixed(1)+"%",i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),r.points.push(i.point),r.data.push(u.cloneDeep(i)),i.point="Y",i.price=+(l-n).toFixed(1),i.title=(100*-n/l).toFixed(1)+"%",i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),r.points.push(i.point),r.data.push(u.cloneDeep(i)),i.point="Z",i.price=+(l-2*n).toFixed(1),i.title=(100*-2*n/l).toFixed(1)+"%",i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),r.points.push(i.point),r.data.push(u.cloneDeep(i)),A.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),r.points.push(i.point),r.data.push(u.cloneDeep(i));d.dispatch("tradingStock/drawTools",r)}function q(t=!0){u.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),u.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z)),e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t&&d.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"target"})}function we(t){c.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),s?Y():t.target.classList.add("selected"),t.stopPropagation()}function Le(t){$(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Y(){let t,s;u.isSet(e.tools.uplps.P1)?(t=+e.tools.uplps.P1.options().startTime,s=e.crosshair.time,$(!1)):t=e.crosshair.time;const{price1:i,price2:r,cash1:l,cash2:n}=Se(t,s);let o={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},a={isRemove:!1,symbol:c.symbol,name:"uplps",points:[],data:[]};o.startTime=t,o.price=i,o.title="P1",e.tools.uplps[o.title]=e.series.price.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=r,o.title="P2",e.tools.uplps[o.title]=e.series.price.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=l,o.title="C1",e.tools.uplps[o.title]=e.series.cash.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=n,o.title="C2",e.tools.uplps[o.title]=e.series.cash.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),d.dispatch("tradingStock/drawTools",a),V.value.classList.remove("selected")}function Se(t,s){let i,r,l,n=0,o=0,a,f,m=0,y=0;for(let k=0;k<e.data.price.length;k++){const w=e.data.price[k].time;if(w<t)continue;if(s&&w>s)break;const h=e.data.price[k].value,g=e.data.cash[k].value;if(i==null&&(i=h,r=h,l=h,a=g,f=g),h>l)n>o&&(r=l,o=n),l=h,n=0;else if(h<l){const P=+(l-h).toFixed(1);P>n&&(n=P)}if(h<i&&o>0)break;if(g>f)m>y&&(a=f,y=m),f=g,m=0;else if(g<f){const P=+(f-g).toFixed(1);P>m&&(m=P)}}return{price1:+(r-o).toFixed(2),price2:+(l-o).toFixed(2),cash1:+(a-y).toFixed(0),cash2:+(f-y).toFixed(0)}}function $(t=!0){u.isSet(e.tools.uplps.P1)&&(e.series.price.removePriceLine(e.tools.uplps.P1),e.series.price.removePriceLine(e.tools.uplps.P2)),u.isSet(e.tools.uplps.C1)&&(e.series.cash.removePriceLine(e.tools.uplps.C1),e.series.cash.removePriceLine(e.tools.uplps.C2)),e.tools.uplps={P1:{},P2:{},C1:{},C2:{}},t&&d.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"uplps"})}function Te(t){c.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),s?U():t.target.classList.add("selected"),t.stopPropagation()}function Oe(t){j(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function U(){let t,s;u.isSet(e.tools.downlps.P1)?(t=+e.tools.downlps.P1.options().startTime,s=e.crosshair.time,j()):t=e.crosshair.time;const{price1:i,price2:r,cash1:l,cash2:n}=_e(t,s);let o={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},a={isRemove:!1,symbol:c.symbol,name:"uplps",points:[],data:[]};o.startTime=t,o.price=i,o.title="P1",e.tools.downlps[o.title]=e.series.price.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=r,o.title="P2",e.tools.downlps[o.title]=e.series.price.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=l,o.title="C1",e.tools.downlps[o.title]=e.series.cash.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),o.price=n,o.title="C2",e.tools.downlps[o.title]=e.series.cash.createPriceLine(o),a.points.push(o.title),a.data.push(u.cloneDeep(o)),d.dispatch("tradingStock/drawTools",a),B.value.classList.remove("selected")}function _e(t,s){let i,r,l,n=0,o=0,a,f,m=0,y=0;for(let k=0;k<e.data.price.length;k++){const w=e.data.price[k].time;if(w<t)continue;if(s&&w>s)break;const h=e.data.price[k].value,g=e.data.cash[k].value;if(i==null&&(i=h,r=h,l=h,a=g,f=g),h<l)n<o&&(r=l,o=n),l=h,n=0;else if(h>l){const P=+(l-h).toFixed(1);P<n&&(n=P)}if(h>i&&o<0)break;if(g<f)m<y&&(a=f,y=m),f=g,m=0;else if(g>f){const P=+(f-g).toFixed(1);P<m&&(m=P)}}return{price1:+(r-o).toFixed(1),price2:+(l-o).toFixed(1),cash1:+(a-y).toFixed(1),cash2:+(f-y).toFixed(1)}}function j(t=!0){u.isSet(e.tools.downlps.P1)&&(e.series.price.removePriceLine(e.tools.downlps.P1),e.series.price.removePriceLine(e.tools.downlps.P2)),u.isSet(e.tools.downlps.C1)&&(e.series.cash.removePriceLine(e.tools.downlps.C1),e.series.cash.removePriceLine(e.tools.downlps.C2)),e.tools.downlps={P1:{},P2:{},C1:{},C2:{}},t&&d.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"downlps"})}function M(t,s="price"){return z(e.series[s].coordinateToPrice(t))}function z(t){return t?+ +t.toFixed(1):0}function Re(t){if(!c.symbol)return!1;d.dispatch("tradingStock/getChartData",c.symbol)}function De(t){c.symbolsKind=t.value}function Ee(){d.dispatch("tradingStock/cloneSymbols")}return(t,s)=>{const i=Ne("DxToolbar");return Ze(),Ie(Ue,null,[C("div",ot,[R(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-list small",hint:t.$t("trading.stock.cloneSymbols"),onClick:Ee}},{location:"before",widget:"dxButton",options:{icon:"far fa-filter small",hint:t.$t("trading.stock.filterPopup.title"),onClick:()=>t.$refs.filterPopupRef.show()}},{location:"before",widget:"dxSelectBox",options:{width:"170px",dataSource:c.symbolsKinds,keyExpr:"value",displayExpr:"text",value:c.symbolsKind,hint:t.$t("trading.stock.symbolsKind"),onValueChanged:De}}]},null,8,["items"]),C("div",{class:"stock-container",ref_key:"chartContainerRef",ref:x},[C("div",{class:"chart-wrapper",ref_key:"chartRef",ref:S},[C("div",st,[R(Xe(Je),{width:t.$screen.getScreenSizeInfo.isXSmall?"140px":"130px",height:"30px","data-source":t.$store.state.tradingStock.symbols[c.symbolsKind.value],"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:"symbol-select"},modelValue:c.symbol,"onUpdate:modelValue":s[0]||(s[0]=r=>c.symbol=r),onValueChanged:Re},null,8,["width","data-source","modelValue"]),C("div",{ref:"addWatchlistToolRef",class:J(`command far fa-${N.value?"minus-circle":"plus-circle"}`),title:t.$t("trading.stock.addWatchlist"),onClick:ce},null,10,it),C("img",{ref_key:"spinnerRef",ref:O,class:"command spinner",src:He},null,512)]),C("div",rt,[C("div",{ref_key:"fullscreenToolRef",ref:D,class:J(`command far fa-${c.isFullscreen?"compress":"expand"}`),title:t.$t("trading.stock.fullscreen"),onClick:pe},null,10,lt),C("div",{ref_key:"tradingviewRef",ref:T,class:"command far fa-chart-bar",title:t.$t("trading.stock.tradingview"),onClick:fe},null,8,nt),C("div",{ref_key:"colorToolRef",ref:ee,class:"color command far fa-palette",style:Ye({color:c.color}),title:t.$t("trading.stock.colorTool"),onClick:me,onContextmenu:he},[W(R(Ge,{class:"color-picker",modelValue:c.color,"onUpdate:modelValue":s[1]||(s[1]=r=>c.color=r)},null,8,["modelValue"]),[[K,c.showColorPicker]])],44,at),C("div",{ref_key:"lineToolRef",ref:_,class:"command far fa-horizontal-rule",title:t.$t("trading.stock.lineTool"),onClick:ge,onContextmenu:ye},null,40,ct),C("div",{ref_key:"uplpsToolRef",ref:V,class:"command far fa-arrow-up",title:t.$t("trading.stock.uplpsTool"),onClick:we,onContextmenu:Le},null,40,pt),C("div",{ref_key:"targetToolRef",ref:A,class:"command far fa-dot-circle",title:t.$t("trading.stock.targetTool"),onClick:ke,onContextmenu:Ce},null,40,dt),C("div",{ref_key:"downlpsToolRef",ref:B,class:"command far fa-arrow-down",title:t.$t("trading.stock.downlpsTool"),onClick:Te,onContextmenu:Oe},null,40,ut),W(C("div",{ref_key:"rulerToolRef",ref:E,class:"command far fa-line-height",title:t.$t("trading.stock.rulerTool"),onClick:xe,onContextmenu:Pe},null,40,ft),[[K,!1]])]),W(C("iframe",{ref_key:"tradingviewChartRef",ref:te,class:"tradingview-chart",src:oe.value},null,8,mt),[[K,c.showTradingView]])],512)],512)]),R(Qe,{ref:"filterPopupRef"},null,512)],64)}}};export{Pt as default};
