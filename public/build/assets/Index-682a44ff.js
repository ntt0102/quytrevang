import{A as di,B as pi,C as ui,E as lt,r as b,w as de,y as ct,o as I,b as J,m as Ye,d as m,t as se,e as ee,f as ot,F as Be,G as rt,g as Oe,c as ie,a as dt,q as he,H as q,p as _e,I as fi,J as vi,l as De,u as mi,K as hi,x as $,L as re,M as gi,N as ce,h as yi,j as xi,k as Fe,z as st,O as Si}from"./app-85dafd98.js";import Ci from"./LineContextMenu-46c0d9c2.js";import{_ as Ti,g as V}from"./select-box-4314cbaf.js";import wi from"./VpsOtpPopup-d8c15496.js";import{c as ki}from"./lightweight-charts.esm.development-03366bac.js";import"./text-box-a105ed57.js";function bi(D,Z,y){return di((y==null?void 0:y.in)||D,+pi(D)+Z)}function Ee(D,Z,y){return bi(D,Z*ui,y)}const Di=[{price:[[0,100],[50,30],[120,90],[170,50],[200,70],[300,0]],volume:[[0,180],[50,160],[120,200],[170,140],[200,170],[300,100]],et:[[217,50],[237,50]],sl:[[190,70],[210,70]],tp1:[[160,50],[180,50],2],time:170},{price:[[0,100],[50,30],[90,60],[110,40],[140,90],[170,60],[200,80],[300,0]],volume:[[0,200],[50,140],[90,180],[110,160],[140,190],[170,150],[200,170],[300,100]],et:[[215,60],[235,60]],sl:[[190,80],[210,80]],tp1:[[160,60],[180,60],2],time:170},{price:[[0,100],[50,30],[90,90],[130,40],[170,80],[200,50],[230,70],[300,0]],volume:[[0,200],[50,140],[90,180],[130,160],[170,190],[200,150],[230,170],[300,100]],et:[[240,50],[260,50]],sl:[[220,70],[240,70]],tp1:[[120,40],[140,40],2],time:200},{price:[[0,100],[70,20],[110,90],[170,35],[185,70],[200,50],[215,80],[230,40],[245,60],[300,0]],volume:[[0,140],[40,180],[70,120],[110,190],[170,150],[215,170],[300,100]],et:[[255,40],[275,40]],sl:[[235,60],[255,60]],tp1:[[160,35],[180,35],1],time:70},{price:[[0,100],[40,40],[70,60],[110,20],[150,70],[200,50],[240,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,40],[70,60],[110,20],[150,80],[180,40],[200,60],[220,50],[250,70],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[180,150],[250,180],[300,100]]},{price:[[0,100],[40,70],[70,80],[110,20],[150,70],[160,40],[180,60],[200,30],[250,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,60],[70,85],[110,45],[150,65],[200,30],[240,45],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]}],Fi=[{price:[[0,30],[50,0],[100,100],[130,60],[150,75],[170,60],[190,80],[220,40],[250,60],[300,0]],volume:[[0,190],[50,170],[100,200],[130,130],[190,160],[220,120],[250,140],[300,100]],et:[[257,40],[277,40]],sl:[[240,60],[260,60]],tp1:[[210,40],[230,40],2],time:130},{price:[[0,40],[50,10],[100,90],[120,60],[140,80],[170,40],[200,100],[230,60],[250,90],[300,0]],volume:[[0,190],[50,170],[100,200],[170,130],[200,160],[230,140],[250,150],[300,100]],et:[[257,60],[277,60]],sl:[[240,90],[260,90]],tp1:[[160,40],[180,40],.5],tp2:[[40,10],[60,10]],time:170},{price:[[0,80],[40,20],[70,60],[110,0],[140,50],[180,10],[210,40],[250,20],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,0],[70,60],[110,10],[140,50],[180,20],[210,40],[250,30],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,20],[70,60],[110,10],[140,60],[180,0],[210,70],[250,50],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]}],Me={continueData:Di,reversalData:Fi};const _i={__name:"Pattern",props:["pattern"],setup(D){const Z=D,y=b(null),C=b(Z.pattern);de(()=>Z.pattern,L=>{C.value=L,u(!0)}),ct(()=>setTimeout(()=>{u()},0));function u(L=!1){if(!C.value)return!1;const d=y.value,f=d.getContext("2d");L&&f.clearRect(0,0,d.width,d.height);const x=C.value.price,E=C.value.volume,S=C.value.et,w=C.value.sl,P=C.value.tp1,Y=C.value.tp2,pe=C.value.time;f.beginPath(),f.strokeStyle="white",f.lineWidth=2,f.setLineDash([1,0]),f.moveTo(x[0][0],x[0][1]);for(let N=1;N<x.length;N++)f.lineTo(x[N][0],x[N][1]);f.stroke(),f.beginPath(),f.strokeStyle="orange",f.moveTo(E[0][0],E[0][1]);for(let N=1;N<E.length;N++)f.lineTo(E[N][0],E[N][1]);f.stroke(),S&&(f.beginPath(),f.strokeStyle="yellow",f.moveTo(S[0][0],S[0][1]),f.lineTo(S[1][0],S[1][1]),f.stroke()),w&&(f.beginPath(),f.strokeStyle="red",f.moveTo(w[0][0],w[0][1]),f.lineTo(w[1][0],w[1][1]),f.stroke()),P&&(f.beginPath(),f.strokeStyle="lime",f.moveTo(P[0][0],P[0][1]),f.lineTo(P[1][0],P[1][1]),f.stroke(),f.font="15px Arial",f.fillStyle="lime",f.fillText(P[2],P[1][0]+5,P[1][1]+5)),Y&&(f.beginPath(),f.strokeStyle="lime",f.moveTo(Y[0][0],Y[0][1]),f.lineTo(Y[1][0],Y[1][1]),f.stroke()),pe&&(f.beginPath(),f.strokeStyle="red",f.setLineDash([5,10]),f.moveTo(pe,0),f.lineTo(pe,200),f.stroke())}return(L,d)=>(I(),J("canvas",{ref_key:"canvasRef",ref:y,width:"300",height:"200"},null,512))}},We=lt(_i,[["__scopeId","data-v-251fbed0"]]);const Oi=m("div",{class:"triangle-shadow"},null,-1),Ri=m("div",{class:"triangle"},null,-1),Li={class:"container"},Pi={class:"continue"},Ai={class:"title"},$i={class:"name"},Vi={class:"reversal"},Ii={class:"title"},Zi={class:"name"},Ei={__name:"Index",setup(D){function Z(y){y.stopPropagation()}return(y,C)=>{const u=Ye("DxScrollView");return I(),J("div",{class:"pattern-popup",onClick:Z,title:""},[Oi,Ri,m("div",Li,[m("div",Pi,[m("div",Ai,se(y.$t("trading.derivative.patternContextMenu.continue")),1),ee(u,{class:"items"},{default:ot(()=>[(I(!0),J(Be,null,rt(Oe(Me).continueData,(L,d)=>(I(),J("div",{key:d},[m("div",$i,se(d+1)+".",1),ee(We,{pattern:L},null,8,["pattern"])]))),128))]),_:1})]),m("div",Vi,[m("div",Ii,se(y.$t("trading.derivative.patternContextMenu.reversal")),1),ee(u,{class:"items"},{default:ot(()=>[(I(!0),J(Be,null,rt(Oe(Me).reversalData,(L,d)=>(I(),J("div",{key:d},[m("div",Zi,se(d+1)+".",1),ee(We,{pattern:L},null,8,["pattern"])]))),128))]),_:1})])])])}}};const Bi={key:0,class:"tree-node"},Mi={key:0,class:"text"},Wi={key:2},Yi=["innerHTML"],Ni={__name:"TreeNode",props:["node","index","modelValue"],emits:["update:modelValue"],setup(D,{emit:Z}){const y=D,C=Z,u=ie(()=>Array.isArray(y.node.items)),L=ie(()=>Array.isArray(y.node.items)&&y.node.items.length>1),d=dt({selectedChild:y.node.items[y.modelValue[y.index]],childValue:y.modelValue,hasChild:!1});d.hasChild=!!d.selectedChild;let f=!1;de(()=>y.modelValue,S=>{f=!0,d.selectedChild=y.node.items[S[y.index]],d.childValue=S,d.hasChild=!!d.selectedChild,setTimeout(()=>f=!1,1e3)}),de(()=>y.node,S=>{f=!0,d.selectedChild=S.items[d.childValue[y.index]],d.hasChild=!!d.selectedChild,setTimeout(()=>f=!1,1e3)});function x(){if(f)return!1;d.hasChild=!1,setTimeout(()=>{d.selectedChild&&(d.hasChild=!0)},0);const S=y.node.items.findIndex(w=>w===d.selectedChild);S==-1?d.childValue=d.childValue.slice(0,y.index):(d.childValue=d.childValue.slice(0,y.index+1),d.childValue[y.index]=S),C("update:modelValue",d.childValue)}function E(S){C("update:modelValue",S)}return(S,w)=>{const P=Ye("TreeNode",!0);return D.node.items?(I(),J("div",Bi,[D.index==0?(I(),J("div",Mi,se(S.$t("trading.derivative.progressContextMenu.start")),1)):he("",!0),m("i",{class:q(`arrow far fa-chevron-${L.value?"double-":""}down`)},null,2),u.value?(I(),_e(Oe(Ti),{key:1,items:D.node.items,modelValue:d.selectedChild,"onUpdate:modelValue":w[0]||(w[0]=Y=>d.selectedChild=Y),displayExpr:"name",stylingMode:"outlined","show-clear-button":!0,showDropDownButton:!1,placeholder:S.$t("titles.dxSelectPlacehoder"),onValueChanged:x},null,8,["items","modelValue","placeholder"])):(I(),J("div",Wi,[m("span",{class:"text",innerHTML:D.node.items},null,8,Yi),D.node.pattern?(I(),_e(We,{key:0,pattern:Oe(Me)[D.node.pattern[0]][D.node.pattern[1]-1]},null,8,["pattern"])):he("",!0)])),d.hasChild?(I(),_e(P,{key:3,node:d.selectedChild,index:D.index+1,modelValue:d.childValue,"onUpdate:modelValue":[w[1]||(w[1]=Y=>d.childValue=Y),E]},null,8,["node","index","modelValue"])):he("",!0)])):he("",!0)}}},Xi=lt(Ni,[["__scopeId","data-v-d485f979"]]);const Ji=m("div",{class:"triangle-shadow"},null,-1),zi=m("div",{class:"triangle"},null,-1),Hi={__name:"Index",props:["modelValue"],emits:["update:modelValue","change"],setup(D,{emit:Z}){const y=D,C=Z,u=b(null),L=b(!1),d=b({});fi(Object.assign({"../../../../lang/vi/derivative.js":()=>vi(()=>import("./derivative-60bb42b4.js"),[])}),`../../../../lang/${window.lang}/derivative.js`).then(S=>{d.value=S.default,L.value=!0});const f=b(y.modelValue);de(()=>y.modelValue,S=>f.value=S);function x(S){C("update:modelValue",S),C("change",S),setTimeout(()=>{u.value.scrollTop=u.value.scrollHeight},0)}function E(S){S.stopPropagation()}return(S,w)=>(I(),J("div",{class:"progress-popup",onClick:E,title:""},[Ji,zi,m("div",{ref_key:"scrollContainer",ref:u,class:"container"},[L.value?(I(),_e(Xi,{key:0,node:d.value,index:0,modelValue:f.value,"onUpdate:modelValue":[w[0]||(w[0]=P=>f.value=P),x]},null,8,["node","modelValue"])):he("",!0)],512)]))}};const ji={class:"content-block dx-card responsive-paddings"},qi=["title"],Qi=["title"],Ui=["title"],Gi=["title"],Ki=["title"],eo=["title"],to=["title"],io=["title"],oo=["title"],ro=m("i",{class:"far fa-heart-rate"},null,-1),so=[ro],no=["title"],ao=m("i",{class:"far fa-grip-lines-vertical"},null,-1),lo=[ao],co=["title"],po=m("i",{class:"far fa-horizontal-rule"},null,-1),uo=["title"],fo=m("i",{class:"far fa-line-height"},null,-1),vo=[fo],mo=["title"],ho=m("i",{class:"far fa-heart-rate"},null,-1),go=["title"],yo=["src"],nt=3,at=2,xo="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",Do={__name:"Index",setup(D){const Z={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},y=De(new Date,"yyyy-MM-dd"),C={START:V(new Date(`${y}T08:45:00Z`)),ATO:V(new Date(`${y}T09:00:00Z`)),ATC:V(new Date(`${y}T14:30:00Z`)),END:V(new Date(`${y}T14:45:00Z`))},u=yi(),L=xi(),{t:d}=mi(),f=Fe("devices"),x=Fe("mf"),E=Fe("bus"),S=Fe("filters"),w=b(null),P=b(null),Y=b(null),pe=b(null),N=b(null),pt=b(null),ut=b(null),ge=b(null),Re=b(null),Le=b(null),ye=b(null),Pe=b(null),ft=b(null),oe=b(null),ue=b(null),Ne=b(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:V(Ee(new Date,7))};me();const p=dt({chartDate:L.query.date??y,clock:De(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,isAutoScan:!1,lineColor:"#F44336",lineTitle:"",progress:[],showLineContext:!1,showSampleContext:!1,showProgressContext:!1,showTradingView:!1}),B=ie(()=>u.state.tradingDerivative.status),Q=ie(()=>u.state.tradingDerivative.config),Xe=ie(()=>u.state.tradingDerivative.tools),vt=ie(()=>u.state.tradingDerivative.isChartLoading),mt=ie(()=>B.value.position!=0||!!B.value.pending||!!Xe.value.order),ht=ie(()=>`https://chart.vps.com.vn/tv/?u=${Q.value.vpsUser}&s=${Q.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);u.dispatch("tradingDerivative/initChart").then(()=>{console.log("inSession()",U()),U()&&Ae(),!L.query.date&&Q.value.lastOpeningDate&&(p.chartDate=Q.value.lastOpeningDate),u.dispatch("tradingDerivative/getChartData",p.chartDate).then(t=>{t&&ve()})}),e.interval=setInterval(Dt,1e3),e.interval60=setInterval(()=>{U()?(et(),Q.value.autoScan&&ve()):clearInterval(e.interval60)},6e4),ct(()=>{e.chart=ki(P.value,Z),e.chart.subscribeCrosshairMove(xt),e.chart.subscribeCustomPriceLineDragged(St),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(Ct).observe(w.value),document.addEventListener("keydown",He),document.addEventListener("fullscreenchange",je)}),hi(()=>{document.removeEventListener("keydown",He),document.removeEventListener("fullscreenchange",je),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),de(()=>u.state.tradingDerivative.chartData,kt),de(()=>Xe.value,wt);function gt(t){p.showLineContext=!1,p.showSampleContext=!1,ke(!1),ge.value.classList.contains("selected")?Xt():Le.value.classList.contains("selected")?jt():ye.value.classList.contains("selected")?Mt():Pe.value.classList.contains("selected")?Lt():Re.value.classList.contains("selected")&&It()}function yt(t){ke(!0),t.preventDefault()}function Je(t){t.stopPropagation()}function ze(t){t.preventDefault(),t.stopPropagation()}function xt(t){if(t.time){let r=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=r}else f.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function St(t){let r=t.customPriceLine,i=r.options();i.price=parseFloat(i.price.toFixed(1));const o=+t.fromPriceString,n=i.price;switch(i.lineType){case"order":if(n!=o){let s=!1;i.kind=="entry"?B.value.position||(s=!0,e.tools.order[i.kind].price=n,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(l=>{l.isOk?(ne([i.kind]),$.success(d("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:o}),M(l.message))})):(s=!0,e.tools.order[i.kind].price=n,i.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(l=>{l.isOk?(ne([i.kind]),$.success(d("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:o}),M(l.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(l=>{l.isOk?(ne([i.kind]),$.success(d("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:o}),M(l.message))})),s||(r.applyOptions({price:o}),$.show(d("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o});const a=i.color,c=i.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[n],data:[{color:a,title:c}]}),ge.value.classList.remove("selected");break;case"target":if(x.isSet(e.tools.target.B)){let s={isRemove:!1,name:"target",points:[],data:[]},l,v,g=+e.tools.target.A.options().price,k=+e.tools.target.B.options().price,h=k-g;if(l="A",i.point=="A")h=+e.tools.target.B.options().title,k=g+h;else if(i.point!="B"){let T=0;switch(i.point){case"X":T=1.5;break;case"Y":T=2;break;case"Z":T=3;break}h=parseFloat(((k-n)/T).toFixed(1)),g=k-h,v={price:g},e.tools.target[l].applyOptions(v)}s.points.push(l),s.data.push(g),l="B",v={price:k,title:h.toFixed(1)},i.point==l&&delete v.price,e.tools.target[l].applyOptions(v),s.points.push(l),s.data.push(k),l="X",v={price:parseFloat((g-.5*h).toFixed(1)),title:(-.5*h).toFixed(1)},i.point==l&&delete v.price,e.tools.target[l].applyOptions(v),l="Y",v={price:parseFloat((g-h).toFixed(1)),title:(-h).toFixed(1)},i.point==l&&delete v.price,e.tools.target[l].applyOptions(v),l="Z",v={price:parseFloat((g-2*h).toFixed(1)),title:(-2*h).toFixed(1)},i.point==l&&delete v.price,e.tools.target[l].applyOptions(v),u.dispatch("tradingDerivative/drawTools",s)}break;case"pattern":if(x.isSet(e.tools.pattern.B)){let s,l;const v=e.tools.pattern.A.options(),g=e.tools.pattern.B.options(),k=e.tools.pattern.C.options(),h={A:{time:+v.time,price:+v.price},B:{price:+g.price},C:{price:+k.price}},T=i.point=="D"?+e.tools.pattern.D.options().price:null,{pattern:O,timeRange:_,info:{tr1:R,tr2:X,tr3:H,pr1:A,pr2:te,pr3:W,fibo:j,sp:G,X:K,Y:tt,Z:it}}=Se(h,T);Ve([O]),Te(_),fe(h),s="A",l={title:`A ${R} ${A}`},e.tools.pattern[s].applyOptions(l),s="B",l={title:`B ${X} ${te}`},e.tools.pattern[s].applyOptions(l),s="C",l={title:`C ${H} ${W}`},e.tools.pattern[s].applyOptions(l),s="D",l={price:G,title:"F "+j},i.point==s&&delete l.price,e.tools.pattern[s].applyOptions(l),s="X",l={price:parseFloat((G+K).toFixed(1)),title:"T "+parseFloat(K.toFixed(1))},e.tools.pattern[s].applyOptions(l),s="Y",l={price:parseFloat((G+tt).toFixed(1)),title:"T "+parseFloat(tt.toFixed(1))},e.tools.pattern[s].applyOptions(l),s="Z",l={price:parseFloat((G+it).toFixed(1)),title:"T "+parseFloat(it.toFixed(1))},e.tools.pattern[s].applyOptions(l)}break}}function Ct(){w.value&&(e.chart.resize(w.value.offsetWidth,w.value.offsetHeight),w.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function He(t){if(t.ctrlKey)switch(t.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(t.altKey)switch(t.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function je(){w.value&&(document.fullscreenElement?(p.isFullscreen=!0,w.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(p.isFullscreen=!1,w.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Tt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function wt(t){Ut(),Object.entries(t).forEach(([r,i])=>{switch(r){case"order":Ft(i);break;case"pattern":Ue(t.pattern,!("tr"in t));break;case"tr":Te(Object.values(i));break;case"line":Jt(i);break;case"target":qt(i);break}})}function kt(t){p.chartDate==y&&U()||(t.length>0&&(e.data.whitespace=xe(e.data.whitespace,Qe(p.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=xe(e.data.price,t),e.series.price.setData(e.data.price))}function qe(t){let r=[];t.forEach(i=>{const o=V(Ee(new Date(i.date),7));r.push({time:o,value:i.price})}),r.length>1?(e.data.price=xe(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function Qe(t){const r=V(new Date(`${t}T09:00:00Z`)),i=V(new Date(`${t}T11:30:00Z`)),o=V(new Date(`${t}T13:00:00Z`)),n=V(new Date(`${t}T14:30:00Z`)),a=V(new Date(`${t}T14:00:00Z`));let c=[];for(let s=r;s<=n;s++){if(s>i&&s<o)continue;let l={time:s};(s==a||s==n)&&(l.value=1),c.push(l)}return c}function xe(t,r){return Array.from(new Map([...t,...r].sort((i,o)=>i.time-o.time).map(i=>[i.time,i])).values())}function Ae(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(xo),e.websocket.onopen=t=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=t=>{!e.socketStop&&U()&&(p.isSocketWarning=!0,Ae())},e.websocket.onmessage=t=>{p.isSocketWarning=!1,bt(t.data).forEach(i=>{if(!i)return!1;i.type==3?(ve(),e.data.whitespace=xe(e.data.whitespace,Qe(y)),e.series.whitespace.setData(e.data.whitespace),qe(i.result),u.dispatch("tradingDerivative/setChartLoading",!1)):i.type==1&&i.target=="UpdateTrades"&&i.arguments[0]=="VN30F1M"&&(ti(i.arguments[1].at(-1).price),qe(i.arguments[1]))})}}function bt(t){let r=[];return t.split("").forEach(i=>{const o=i.indexOf("{"),n=i.lastIndexOf("}");let a=null;if(o!==-1&&n!==-1&&n>o){const c=i.substring(o,n+1);c!="{}"&&(a=JSON.parse(c))}r.push(a)}),r}function Dt(){e.currentSeconds=V(Ee(new Date,7)),U()&&(B.value.position&&e.currentSeconds>C.ATC-5*60&&(p.isOrderWarning=!0,e.currentSeconds>C.ATC-15&&x.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(t=>{t.isOk?(ae(["entry","tp","sl"]),$.success(d("trading.derivative.autoCancelTpSlSuccess"))):M(t.message)})),Q.value.openingMarket&&e.currentSeconds==C.START&&Ae()),p.clock=De(new Date,"HH:mm:ss")}function ne(t){const r="order";let i={isRemove:!1,name:r,points:[],data:[]},o,n;t.forEach(a=>{switch(a){case"entry":o="yellow",n=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",n=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",n=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(i.points.push(a),x.isSet(e.tools.order[a].line))e.tools.order[a].line.applyOptions({price:e.tools.order[a].price,title:n}),i.data.push(e.tools.order[a].line.options());else{const c={lineType:r,kind:a,side:e.tools.order.side,price:e.tools.order[a].price,color:o,lineWidth:1,lineStyle:0,title:n,draggable:!0};e.tools.order[a].line=e.series.price.createPriceLine(c),i.data.push(c)}}),u.dispatch("tradingDerivative/drawTools",i)}function Ft(t){Object.entries(t).forEach(([r,i])=>{e.tools.order.side=i.side,e.tools.order[r].price=i.price,e.tools.order[r].line=e.series.price.createPriceLine(i)})}function ae(t,r=!0){r&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),t.forEach(i=>{x.isSet(e.tools.order[i].line)&&(e.series.price.removePriceLine(e.tools.order[i].line),delete e.tools.order[i].line)})}function _t(t){p.showTradingView=!p.showTradingView,t.stopPropagation()}function Ot(t){p.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||(Ce(),we(!1),Ie(),fe(),t.target.classList.add("selected"))}function Rt(t){u.dispatch("tradingDerivative/setAutoScan",!Q.value.autoScan),t.target.classList.remove("selected")}function Lt(){const t=e.crosshair.time?e.data.price.filter(i=>i.time<=e.crosshair.time):e.data.price,r=Pt(t);x.isSet(r)&&(Ce(),Ue(r),fe(r)),Pe.value.classList.remove("selected")}function Pt(t){let r,[i,o,n,a,c]=Array(5).fill({});for(let s=t.length-1;s>=0;s--){const l=t[s].value,v=t[s].time,g=z(v);if(g==-1)break;if(s==t.length-1&&(a={index:g,time:v,price:l},[n,o,i,c]=Array(4).fill(null).map(()=>x.cloneDeep(a))),r==null){if(l==a.price)continue;r=a.price>l}if(!F(o.price,r,a.price)&&F(l,!r,n.price)&&(n={index:g,time:v,price:l}),F(l,r,o.price)&&(F(i.price,!r,n.price)?([a,n,o]=[n,o,i].map(k=>x.cloneDeep(k)),i={index:g,time:v,price:l},c=x.cloneDeep(i),r=!r):a.index-n.index<=20?(a=x.cloneDeep(n),o=x.cloneDeep(n),n={index:g,time:v,price:l},r=!r):o={index:g,time:v,price:l}),F(l,!r,i.price)?(i={index:g,time:v,price:l},c=x.cloneDeep(i)):c.index=g,F(l,r,c.price)&&(c={index:g,time:v,price:l}),n.index>i.index){const k=Math.abs(o.price-n.price);if(k>=1.5&&(i.index-c.index>n.index-o.index||Math.abs(i.price-c.price)>k))break}}return At({A:i,B:o,C:n,D:a})}function At(t){const r={};return Object.entries(t).forEach(([i,o])=>{const{index:n,...a}=o;r[i]=a}),r}function $t(t){p.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function Vt(t){t.target.classList.remove("selected"),Ce(),we(!0),Ie(),fe()}function It(){const t="pattern",r=be(e.crosshair.y),i=e.crosshair.time;let o={lineType:t,price:r,lineWidth:1,lineStyle:1,draggable:!0};if(x.isSet(e.tools.pattern.A)){const n=e.tools.pattern.A.options();if(x.isSet(e.tools.pattern.B)){const a=e.tools.pattern.B.options();let c,s,l;if(x.isSet(e.tools.pattern.C)){let v,g;const k=e.tools.pattern.C.options();c={A:{time:i,price:r},B:{price:+a.price},C:{price:+k.price}};const{pattern:h,timeRange:T,info:{tr1:O,tr2:_,tr3:R,pr1:X,pr2:H,pr3:A,fibo:te,sp:W,X:j,Y:G,Z:K}}=Se(c);s=T,l=h,v="A",g={price:r,time:i,title:`A ${O} ${X}`},e.tools.pattern[v].applyOptions(g),v="B",g={title:`B ${_} ${H}`},e.tools.pattern[v].applyOptions(g),v="C",g={title:`C ${R} ${A}`},e.tools.pattern[v].applyOptions(g),v="D",g={price:W,title:"F "+te},e.tools.pattern[v].applyOptions(g),v="X",g={price:parseFloat((W+j).toFixed(1)),title:"T "+parseFloat(j.toFixed(1))},e.tools.pattern[v].applyOptions(g),v="Y",g={price:parseFloat((W+G).toFixed(1)),title:"T "+parseFloat(G.toFixed(1))},e.tools.pattern[v].applyOptions(g),v="Z",g={price:parseFloat((W+K).toFixed(1)),title:"T "+parseFloat(K.toFixed(1))},e.tools.pattern[v].applyOptions(g)}else{c={A:{time:+n.time,price:+n.price},B:{price:+a.price},C:{price:r}};const{pattern:v,timeRange:g,info:{tr1:k,tr2:h,tr3:T,pr1:O,pr2:_,pr3:R,fibo:X,sp:H,X:A,Y:te,Z:W}}=Se(c);s=g,l=v;let j="A";e.tools.pattern[j].applyOptions({title:`A ${k} ${O}`}),j="B",e.tools.pattern[j].applyOptions({title:`B ${h} ${_}`}),o.point="C",o.title=`C ${T} ${R}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=H,o.title="F "+X,o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat((H+A).toFixed(1)),o.title="T "+parseFloat(A.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat((H+te).toFixed(1)),o.title="T "+parseFloat(te.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Z",o.price=parseFloat((H+W).toFixed(1)),o.title="T "+parseFloat(W.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}Ve([l]),Te(s),fe(c),Re.value.classList.remove("selected")}else o.point="B",o.title="B 0 0",o.color="#009688",e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}else o.point="A",o.title="A 0 0",o.color="#F44336",o.time=i,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function Ue(t,r=!0){let o={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{pattern:n,timeRange:a,info:{tr1:c,tr2:s,tr3:l,pr1:v,pr2:g,pr3:k,fibo:h,sp:T,X:O,Y:_,Z:R}}=Se(t);Ve([n]),r&&Te(a),o.point="A",o.title=`A ${c} ${v}`,o.color="#F44336",o.price=t.A.price,o.time=t.A.time,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="B",o.title=`B ${s} ${g}`,o.color="#009688",o.price=t.B.price,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="C",o.price=t.C.price,o.title=`C ${l} ${k}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=T,o.title="F "+h,o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat((T+O).toFixed(1)),o.title="T "+parseFloat(O.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat((T+_).toFixed(1)),o.title="T "+parseFloat(_.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Z",o.price=parseFloat((T+R).toFixed(1)),o.title="T "+parseFloat(R.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function Se(t,r=null){const i=$e(t.A,t.B),o=$e(i.R,t.C,i.tr),n=$e(o.R,o.S,i.tr),a=t.C.price-t.B.price,c=t.A.price-t.B.price,s=a>0,l=i.S1.price-i.R1.price,v=o.R1.price-o.S1.price,g=n.S1.price-n.R1.price;let[k,h,T,O,_,R]=Array(6).fill(0);O=parseInt(l/c*100),F(i.R1.price,s,t.B.price)&&F(i.S1.price,!s,t.C.price)&&(k=1),Math.abs(a)>1.5&&F(a,s,l)&&(_=parseInt(v/a*100),_>50&&(o.count==1?h=1:a/c<.5&&(o.count>1||o.over)?h=2:k==1&&F(o.S1.price,!s,i.R1.price)&&F(o.R1.price,s,i.S1.price)&&(h=3)),R=parseInt(g/a*100),R>40&&(n.count==1?T=1:a/c<.5&&(n.count>1||n.over)&&(T=2)),h==0&&_>50&&T==0&&R>50&&o.tr>.5*i.tr&&o.pr>.5*i.pr&&n.R.index-n.S.index>=i.tr&&(F(n.R1.price,!s,o.S1.price)?h=4:h=5));let X=[];T>0?X=[i.R1.time,le(i.S1.index),n.R1.time]:h>0&&h<=3?X=[o.R1.time,le(o.S1.index),o.S1.time]:h>3?X=[i.R1.time,le(i.S1.index),o.R.time]:X=[i.R1.time,le(i.S1.index)];const H=Zt(h,T);let A=r;if(!A){let K=0;A=t.B.price,h>0&&F(v,s,K)&&(K=v,A=h<5?o.S1.price:n.S1.price),T>0&&F(g,s,K)&&(A=n.R1.price)}const te=parseInt((h<5?(t.C.price-A)/a:(A-n.R1.price)/(t.C.price-n.R1.price))*100),W=A-(h<5?t.C.price:n.R1.price),j=.5*W,G=2*W;return{pattern:H,timeRange:X,info:{tr1:k,tr2:h,tr3:T,pr1:O,pr2:_,pr3:R,fibo:te,sp:A,X:j,Y:W,Z:G}}}function $e(t,r,i=0){let o=x.cloneDeep(t),n=x.cloneDeep(r);const a=n.price>o.price;let c={},s={};e.data.price.filter(g=>g.time>=o.time).every((g,k)=>{const h=g.value,T=g.time,O=z(T);if(O==-1)return!1;if((k==0||h==o.price)&&(c={R:{index:O,time:T,price:h},S:{index:O,time:T,price:h}},s={R:c.R,S:c.S,pr:0,tr:0,count:0,over:!1}),F(h,a,c.R.price)){const _=c.S.index-c.R.index,R=Math.abs(c.S.price-c.R.price);_>=s.tr&&R>=.5*s.pr&&(s.tr=_,s.pr=R,s.R=c.R,s.S=c.S,i>0&&_>=i&&(s.count++,_>=3*i&&(s.over=!0))),_>=.5*s.tr&&!F(c.S.price,!a,s.S.price)&&Math.abs(c.R.price-s.R.price)<=.2&&(s.S.index=c.S.index,s.tr=c.S.index-s.R.index),c={R:{index:O,time:T,price:h},S:{index:O,time:T,price:h}},R>=2*s.pr&&(s={R:c.R,S:c.S,pr:0,tr:0,count:0,over:!1})}else c.S.index=O,F(h,!a,c.S.price)&&(c.S.time=T,c.S.price=h);return F(h,!a,o.price)?(c.S.price=o.price,!1):!!F(h,!a,n.price)});const l=c.S.index-c.R.index,v=Math.abs(c.S.price-c.R.price);return l>=s.tr&&v>=.5*s.pr&&(s.tr=l,s.pr=v,s.R=c.R,s.S=c.S,i>0&&l>=i&&(s.count++,l>=3*i&&(s.over=!0))),n.time=c.S.time,o.index=z(o.time),n.index=z(n.time),{tr:s.tr,pr:s.pr,count:s.count,over:s.over,S1:s.S,R1:s.R,S:o,R:n}}function Zt(t,r){return r>0?r:t>0?t+2:0}function fe(t={}){let r=!x.isSet(t),i={isRemove:r,name:"pattern",points:[],data:[]};r||Object.entries(t).forEach(([o,n])=>{i.points.push(o),i.data.push(n)}),u.dispatch("tradingDerivative/drawTools",i)}function Ce(){x.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),x.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),x.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y),e.series.price.removePriceLine(e.tools.pattern.Z)))),me(["pattern"])}function Et(t){p.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function Bt(t){we(),t.target.classList.remove("selected")}function Mt(){let t={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let i={time:r,value:1};switch(e.tools.timeRange.length){case 0:i.color="OrangeRed",e.tools.timeRange[0]=i,t.points.push(0),t.data.push(r);break;case 1:i.color="lime",e.tools.timeRange[1]=i,t.points.push(1),t.data.push(r),ye.value.classList.remove("selected");break;default:const o=z(e.tools.timeRange[0].time),n=z(e.tools.timeRange[1].time),c=z(r)+(n-o),s=le(c);i.color="OrangeRed",e.tools.timeRange[0]=x.cloneDeep(i),t.points.push(0),t.data.push(r),i.time=s,i.color="lime",e.tools.timeRange[1]=i,t.points.push(1),t.data.push(s),ye.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",t)}function Te(t){let r,i;if(t.length==2)r=t[0],i=t[1];else if(t.length==3){const n=z(t[0]),a=z(t[1]),s=z(t[2])+(a-n);r=t[2],i=le(s)}else return!1;let o=[{time:r,value:1,color:"OrangeRed"},{time:i,value:1,color:"lime"}];e.tools.timeRange=o,e.series.timeRange.setData(o)}function we(t=!0,r=!1){t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),r||(e.series.timeRange.setData([]),me(["tr"]))}function Wt(){p.showProgressContext=!p.showProgressContext,p.showSampleContext=!1,p.showLineContext=!1}function Ve(t){p.progress=t}function Ie(){p.progress=[]}function Yt(t){p.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function Nt(t){p.showLineContext=!p.showLineContext,p.showSampleContext=!1,p.showProgressContext=!1}function Xt(){const t="line",r=be(e.crosshair.y),i=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const n=o.options(),a=n.type=r==+n.price;return a&&(e.series.price.removePriceLine(o),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:t,point:r})),!a}),e.tools.lines.length==i){const o=p.lineColor,n=p.lineTitle,a={lineType:t,price:r,color:o,title:n,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(a)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:t,points:[r],data:[{color:o,title:n}]})}ge.value.classList.remove("selected")}function Jt(t){const i={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(t).forEach(([o,{color:n,title:a}])=>{i.price=+o,i.color=n,i.title=a,e.tools.lines.push(e.series.price.createPriceLine(i))})}function Ge(t=!0){e.tools.lines.length>0&&(t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),me(["lines"]))}function zt(t){p.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Ze())}function Ht(t){Ze(),t.target.classList.remove("selected")}function jt(){const t="target",r=be(e.crosshair.y);let i={lineType:t,price:r,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:t,points:[],data:[r]};if(x.isSet(e.tools.target.A)){const n=+e.tools.target.A.options().price,a=r-n;i.point="B",i.title=parseFloat(a.toFixed(1)),i.color="#F44336",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),i.point="X",i.price=parseFloat((n-.5*a).toFixed(1)),i.title=parseFloat((-.5*a).toFixed(1)),i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Y",i.price=parseFloat((n-a).toFixed(1)),i.title=parseFloat(-a.toFixed(1)),i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Z",i.price=parseFloat((n-2*a).toFixed(1)),i.title=parseFloat((-2*a).toFixed(1)),i.color="#9C27B0",e.tools.target[i.point]=e.series.price.createPriceLine(i),Le.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point);u.dispatch("tradingDerivative/drawTools",o)}function qt(t){let i={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const o=t.A,n=t.B,a=n-o;i.point="A",i.price=o,i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="B",i.price=n,i.title=parseFloat(a.toFixed(1)),i.color="#F44336",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="X",i.price=parseFloat((o-.5*a).toFixed(1)),i.title=parseFloat((-.5*a).toFixed(1)),i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Y",i.price=parseFloat((o-a).toFixed(1)),i.title=parseFloat(-a.toFixed(1)),i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Z",i.price=parseFloat((o-2*a).toFixed(1)),i.title=parseFloat((-2*a).toFixed(1)),i.color="#9C27B0",e.tools.target[i.point]=e.series.price.createPriceLine(i)}function Ze(t=!0){t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),x.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),x.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z))),me(["target"])}function Qt(){p.showSampleContext=!p.showSampleContext,p.showProgressContext=!1,p.showLineContext=!1}function Ut(){ae(["entry","tp","sl"],!1),Ge(!1),Ze(!1),we(!1),Ie(),Ce()}function ke(t){if(t){if(U()&&(x.isSet(e.tools.order.tp.line)||B.value.position&&e.currentSeconds>C.ATO&&e.currentSeconds<C.ATC&&(ue.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",ue.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",ue.value.style.display="block"),!x.isSet(e.tools.order.entry.line))){let r=null,i=0;B.value.position?(e.currentSeconds<C.ATO?r="ATO":e.currentSeconds>C.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,i=-B.value.position)):e.currentSeconds>C.ATO&&e.currentSeconds<C.ATC&&(r=be(e.crosshair.y),i=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=i,e.tools.order.entry.price=r),i&&(oe.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",oe.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",oe.value.style.background=i>0?"green":"red",oe.value.innerText=`${i>0?"LONG":"SHORT"} ${r}`,oe.value.style.display="block")}}else oe.value.style.display="none",ue.value.style.display="none"}function Gt(){U()&&(e.currentSeconds<C.ATO?st(d("trading.derivative.atoOrder"),d("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(i=>{i.isOk?$.success(d("trading.derivative.atoOrderSuccess")):M(i.message)})}):e.currentSeconds<C.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(t=>{t.isOk?(ne(["entry"]),$.success(d("trading.derivative.newEntrySuccess"))):M(t.message)}):st(d("trading.derivative.atcOrder"),d("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(i=>{i.isOk?$.success(d("trading.derivative.atcOrderSuccess")):M(i.message)})}))}function Kt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*nt,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*at,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(t=>{t.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),ne(["entry","tp","sl"]),$.success(d("trading.derivative.newTpSlSuccess"))):M(t.message)})}function ei(){x.isSet(e.tools.order.entry.line)?x.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(ae(["entry","tp","sl"]),$.success(d("trading.derivative.exitSuccess"))):M(t.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(t=>{t.isOk?(ae(["entry"]),$.success(d("trading.derivative.deleteEntrySuccess"))):M(t.message)}):ve()}function ti(t){x.isSet(e.tools.order.entry.line)&&(x.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&t>=e.tools.order.tp.price||e.tools.order.side<0&&t<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(ae(["entry","tp","sl"]),$.success(d("trading.derivative.deleteTpSuccess")),ke(!1)):M(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&t<=e.tools.order.sl.price||e.tools.order.side<0&&t>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(ae(["entry","tp","sl"]),$.success(d("trading.derivative.deleteSlSuccess")),ke(!1)):M(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&t>=e.tools.order.entry.price||e.tools.order.side<0&&t<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*nt,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*at,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),ne(["entry","tp","sl"]),$.success(d("trading.derivative.autoNewTpSlSuccess"))):M(r.message),e.isAutoOrdering=!1})},1e3))))}function ii(){e.chart.timeScale().scrollToRealTime()}function U(){return Q.value.openingMarket&&e.currentSeconds>=C.START&&e.currentSeconds<=C.END}function be(t){return parseFloat(e.series.price.coordinateToPrice(t).toFixed(1))}function M(t){t||(t="unknown"),$.error(d(`trading.derivative.${t}`))}function oi(){if(!p.chartDate)return!1;u.dispatch("tradingDerivative/getChartData",p.chartDate)}function Ke(){U()&&e.websocket.send(e.socketSendData)}function ri(){e.data.whitespace=[],e.data.price=[],Ke(),u.dispatch("tradingDerivative/getChartData",p.chartDate)}function et(){u.dispatch("tradingDerivative/getStatus")}function ve(){u.dispatch("tradingDerivative/getTools")}function me(t){t==null&&(t=["order","lines","tr","pattern","target"]),t.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),t.includes("lines")&&(e.tools.lines=[]),t.includes("target")&&(e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t.includes("tr")&&(e.tools.timeRange=[]),t.includes("pattern")&&(e.tools.pattern={A:{},B:{},C:{},D:{},X:{},Y:{},Z:{}})}function si(){u.dispatch("tradingDerivative/getAccountInfo").then(t=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${d("trading.derivative.nav")}</div><div>: ${S.currency(t.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${d("trading.derivative.maxVol")}</div><div>: ${S.numberVnFormat(t.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${d("trading.derivative.vm")}</div><div>: ${S.currency(t.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${d("trading.derivative.fee")}</div><div>: ${S.currency(t.fee)}</div></div>`,r+="</div>",Si(r,d("trading.derivative.accountInfo"))})}function ni(){E.emit("checkPin",()=>u.dispatch("tradingDerivative/report"))}function ai(){E.emit("checkPin",()=>u.dispatch("tradingDerivative/export",p.chartDate))}function li(){Ne.value.show()}function ci(){E.emit("checkPin",()=>u.dispatch("tradingDerivative/loginDnse"))}function F(t,r,i,o=!1){return r?o?t>=i:t>i:o?t<=i:t<i}function z(t){let r=e.data.whitespace.findIndex(i=>i.time==t);if(r==-1){const i=De(new Date(t*1e3),"yyyy-MM-dd"),o=V(new Date(`${i}T11:30:00Z`)),n=V(new Date(`${i}T13:00:00Z`)),a=V(new Date(`${i}T14:30:00Z`));t>o&&t<n?t=o:t>a&&(t=a),r=e.data.whitespace.findIndex(c=>c.time==t)}return r}function le(t){return e.data.whitespace[t].time}return(t,r)=>{const i=Ye("DxToolbar");return I(),J(Be,null,[m("div",ji,[ee(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:t.$t("trading.derivative.buttons.report"),onClick:ni}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:t.$t("trading.derivative.buttons.export"),onClick:ai}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:t.$t("trading.derivative.buttons.loginVps"),onClick:li}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:t.$t("trading.derivative.buttons.loginDnse"),onClick:ci}}]},null,8,["items"]),m("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:w,onClick:gt,onContextmenu:yt},[m("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:P},[m("div",{class:"area data-area",onClick:Je,onContextmenu:ze},[m("div",{ref_key:"connectionRef",ref:Y,class:q(["command",{yellow:B.value.pending}]),title:t.$t("trading.derivative.connection"),onClick:et},[m("i",{class:q(["far",{"fa-link-simple":B.value.connection,"fa-link-simple-slash":!B.value.connection,blink:p.isSocketWarning}])},null,2)],10,qi),m("div",{class:q(["command status",{green:B.value.position>0,red:B.value.position<0}]),title:t.$t("trading.derivative.position"),onClick:si},se(B.value.position),11,Qi),m("div",{class:"command clock",onClick:Ke},se(p.clock),1),re(m("input",{type:"date",class:"chart-date command",title:t.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=o=>p.chartDate=o),onChange:oi},null,40,Ui),[[gi,p.chartDate]]),m("div",{ref_key:"reloadToolRef",ref:pt,class:"command",title:t.$t("trading.derivative.reload"),onClick:ri},[m("i",{class:q(["far fa-sync-alt",{"fa-spin":vt.value}])},null,2)],8,Gi)],32),m("div",{class:"area tool-area",onClick:Je,onContextmenu:ze},[m("div",{ref_key:"fullscreenToolRef",ref:pe,class:"command",title:t.$t("trading.derivative.fullscreen"),onClick:Tt},[m("i",{class:q(["far",{"fa-compress":p.isFullscreen,"fa-expand":!p.isFullscreen}])},null,2)],8,Ki),m("div",{ref_key:"tradingviewRef",ref:ut,class:"command far fa-chart-candlestick",title:t.$t("trading.derivative.tradingview"),onClick:_t,onContextmenu:ve},null,40,eo),m("div",{class:q(["popup command",{green:p.progress[0]>0,red:p.progress[0]==0}]),title:t.$t("trading.derivative.progressTool"),onClick:Wt},[m("i",{class:q(["far",{"fa-badge-check":!p.progress[0],[`fa-circle-${p.progress[0]}`]:p.progress[0]}])},null,2),re(ee(Hi,{class:"contextmenu",modelValue:p.progress,"onUpdate:modelValue":r[1]||(r[1]=o=>p.progress=o)},null,8,["modelValue"]),[[ce,p.showProgressContext]])],10,to),m("div",{ref_key:"scanToolRef",ref:Pe,class:"command",title:t.$t("trading.derivative.scanTool"),onClick:Ot,onContextmenu:Rt},[m("i",{class:q(["far fa-bolt-auto",{blink:Q.value.autoScan}])},null,2)],40,io),m("div",{ref_key:"patternToolRef",ref:Re,class:"command",title:t.$t("trading.derivative.patternTool"),onClick:$t,onContextmenu:Vt},so,40,oo),m("div",{ref_key:"timeRangeToolRef",ref:ye,class:"command",title:t.$t("trading.derivative.timeRangeTool"),onClick:Et,onContextmenu:Bt},lo,40,no),m("div",{ref_key:"lineToolRef",ref:ge,class:"popup command",title:t.$t("trading.derivative.lineTool"),onClick:Yt,onContextmenu:Nt},[po,re(ee(Ci,{class:"contextmenu",enable:p.showLineContext,title:p.lineTitle,"onUpdate:title":r[2]||(r[2]=o=>p.lineTitle=o),color:p.lineColor,"onUpdate:color":r[3]||(r[3]=o=>p.lineColor=o),onDeleteAllLine:Ge},null,8,["enable","title","color"]),[[ce,p.showLineContext]])],40,co),m("div",{ref_key:"targetToolRef",ref:Le,class:"command",title:t.$t("trading.derivative.targetTool"),onClick:zt,onContextmenu:Ht},vo,40,uo),re(m("div",{class:"popup command",title:t.$t("trading.derivative.sampleTool"),onClick:Qt},[ho,re(ee(Ei,{class:"contextmenu"},null,512),[[ce,p.showSampleContext]])],8,mo),[[ce,!1]]),re(m("div",{ref_key:"cancelOrderRef",ref:ft,class:"cancel-order command",title:t.$t("trading.derivative.cancelTool"),onClick:ei},[m("i",{class:q(["far fa-trash-alt",{blink:p.isOrderWarning}])},null,2)],8,go),[[ce,mt.value]])],32),m("div",null,[m("div",{ref_key:"entryOrderRef",ref:oe,class:"order-button entry",onClick:Gt}," Entry ",512),m("div",{ref_key:"tpslOrderRef",ref:ue,class:"order-button tpsl",onClick:Kt}," TP/SL ",512),m("div",{class:"chart-top command far fa-angle-double-right",onClick:ii})]),re(m("iframe",{ref_key:"tradingviewChartRef",ref:N,class:"tradingview-chart",src:ht.value},null,8,yo),[[ce,p.showTradingView]])],512)],544)]),ee(wi,{ref_key:"vpsOtpPopupRef",ref:Ne},null,512)],64)}}};export{Do as default};
