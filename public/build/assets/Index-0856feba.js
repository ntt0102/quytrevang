import{A as ni,B as ai,C as li,E as it,r as D,w as ae,y as ot,o as j,b as ne,c as ee,a as rt,m as st,t as Ze,q as me,d as y,G as H,p as Fe,g as Ge,H as ci,I as di,l as be,u as pi,J as ui,x as P,e as fe,K as se,L as fi,M as ve,N as vi,F as mi,h as hi,j as gi,k as De,z as Ke,O as yi}from"./app-3b420414.js";import xi from"./LineContext-3e72a333.js";import Si from"./ScanContext-5fbaa970.js";import{_ as Ci,g as A}from"./select-box-7f140524.js";import Ti from"./VpsOtpPopup-28139c13.js";import{c as wi}from"./lightweight-charts.esm.development-03366bac.js";import"./text-box-95b4188e.js";function ki(F,B,x){return ni((x==null?void 0:x.in)||F,+ai(F)+B)}function Ie(F,B,x){return ki(F,B*li,x)}const bi=[{price:[[0,100],[50,30],[120,90],[170,50],[200,70],[300,0]],volume:[[0,180],[50,160],[120,200],[170,140],[200,170],[300,100]],et:[[217,50],[237,50]],sl:[[190,70],[210,70]],tp1:[[160,50],[180,50],2],time:170},{price:[[0,100],[50,30],[90,60],[110,40],[140,90],[170,60],[200,80],[300,0]],volume:[[0,200],[50,140],[90,180],[110,160],[140,190],[170,150],[200,170],[300,100]],et:[[215,60],[235,60]],sl:[[190,80],[210,80]],tp1:[[160,60],[180,60],2],time:170},{price:[[0,100],[50,30],[90,90],[130,40],[170,80],[200,50],[230,70],[300,0]],volume:[[0,200],[50,140],[90,180],[130,160],[170,190],[200,150],[230,170],[300,100]],et:[[240,50],[260,50]],sl:[[220,70],[240,70]],tp1:[[120,40],[140,40],2],time:200},{price:[[0,100],[70,20],[110,90],[170,35],[185,70],[200,50],[215,80],[230,40],[245,60],[300,0]],volume:[[0,140],[40,180],[70,120],[110,190],[170,150],[215,170],[300,100]],et:[[255,40],[275,40]],sl:[[235,60],[255,60]],tp1:[[160,35],[180,35],1],time:70},{price:[[0,100],[40,40],[70,60],[110,20],[150,70],[200,50],[240,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,40],[70,60],[110,20],[150,80],[180,40],[200,60],[220,50],[250,70],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[180,150],[250,180],[300,100]]},{price:[[0,100],[40,70],[70,80],[110,20],[150,70],[160,40],[180,60],[200,30],[250,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,60],[70,85],[110,45],[150,65],[200,30],[240,45],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]}],Di=[{price:[[0,30],[50,0],[100,100],[130,60],[150,75],[170,60],[190,80],[220,40],[250,60],[300,0]],volume:[[0,190],[50,170],[100,200],[130,130],[190,160],[220,120],[250,140],[300,100]],et:[[257,40],[277,40]],sl:[[240,60],[260,60]],tp1:[[210,40],[230,40],2],time:130},{price:[[0,40],[50,10],[100,90],[120,60],[140,80],[170,40],[200,100],[230,60],[250,90],[300,0]],volume:[[0,190],[50,170],[100,200],[170,130],[200,160],[230,140],[250,150],[300,100]],et:[[257,60],[277,60]],sl:[[240,90],[260,90]],tp1:[[160,40],[180,40],.5],tp2:[[40,10],[60,10]],time:170},{price:[[0,80],[40,20],[70,60],[110,0],[140,50],[180,10],[210,40],[250,20],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,0],[70,60],[110,10],[140,50],[180,20],[210,40],[250,30],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,20],[70,60],[110,10],[140,60],[180,0],[210,70],[250,50],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]}],Fi={continueData:bi,reversalData:Di};const Oi={__name:"Pattern",props:["pattern"],setup(F){const B=F,x=D(null),w=D(B.pattern);ae(()=>B.pattern,W=>{w.value=W,v(!0)}),ot(()=>setTimeout(()=>{v()},0));function v(W=!1){if(!w.value)return!1;const p=x.value,f=p.getContext("2d");W&&f.clearRect(0,0,p.width,p.height);const m=w.value.price,V=w.value.volume,S=w.value.et,k=w.value.sl,R=w.value.tp1,M=w.value.tp2,le=w.value.time;f.beginPath(),f.strokeStyle="white",f.lineWidth=2,f.setLineDash([1,0]),f.moveTo(m[0][0],m[0][1]);for(let Y=1;Y<m.length;Y++)f.lineTo(m[Y][0],m[Y][1]);f.stroke(),f.beginPath(),f.strokeStyle="orange",f.moveTo(V[0][0],V[0][1]);for(let Y=1;Y<V.length;Y++)f.lineTo(V[Y][0],V[Y][1]);f.stroke(),S&&(f.beginPath(),f.strokeStyle="yellow",f.moveTo(S[0][0],S[0][1]),f.lineTo(S[1][0],S[1][1]),f.stroke()),k&&(f.beginPath(),f.strokeStyle="red",f.moveTo(k[0][0],k[0][1]),f.lineTo(k[1][0],k[1][1]),f.stroke()),R&&(f.beginPath(),f.strokeStyle="lime",f.moveTo(R[0][0],R[0][1]),f.lineTo(R[1][0],R[1][1]),f.stroke(),f.font="15px Arial",f.fillStyle="lime",f.fillText(R[2],R[1][0]+5,R[1][1]+5)),M&&(f.beginPath(),f.strokeStyle="lime",f.moveTo(M[0][0],M[0][1]),f.lineTo(M[1][0],M[1][1]),f.stroke()),le&&(f.beginPath(),f.strokeStyle="red",f.setLineDash([5,10]),f.moveTo(le,0),f.lineTo(le,200),f.stroke())}return(W,p)=>(j(),ne("canvas",{ref_key:"canvasRef",ref:x,width:"300",height:"200"},null,512))}},Ri=it(Oi,[["__scopeId","data-v-4098e78d"]]);const Li={key:0,class:"tree-node"},_i={key:0,class:"text"},Pi={key:2},Ai=["innerHTML"],Vi={__name:"TreeNode",props:["node","index","modelValue"],emits:["update:modelValue"],setup(F,{emit:B}){const x=F,w=B,v=ee(()=>Array.isArray(x.node.items)),W=ee(()=>Array.isArray(x.node.items)&&x.node.items.length>1),p=rt({selectedChild:x.node.items[x.modelValue[x.index]],childValue:x.modelValue,hasChild:!1});p.hasChild=!!p.selectedChild;let f=!1;ae(()=>x.modelValue,S=>{f=!0,p.selectedChild=x.node.items[S[x.index]],p.childValue=S,p.hasChild=!!p.selectedChild,setTimeout(()=>f=!1,1e3)}),ae(()=>x.node,S=>{f=!0,p.selectedChild=S.items[p.childValue[x.index]],p.hasChild=!!p.selectedChild,setTimeout(()=>f=!1,1e3)});function m(){if(f)return!1;p.hasChild=!1,setTimeout(()=>{p.selectedChild&&(p.hasChild=!0)},0);const S=x.node.items.findIndex(k=>k===p.selectedChild);S==-1?p.childValue=p.childValue.slice(0,x.index):(p.childValue=p.childValue.slice(0,x.index+1),p.childValue[x.index]=S),w("update:modelValue",p.childValue)}function V(S){w("update:modelValue",S)}return(S,k)=>{const R=st("TreeNode",!0);return F.node.items?(j(),ne("div",Li,[F.index==0?(j(),ne("div",_i,Ze(S.$t("trading.derivative.progressContext.start")),1)):me("",!0),y("i",{class:H(`arrow far fa-chevron-${W.value?"double-":""}down`)},null,2),v.value?(j(),Fe(Ge(Ci),{key:1,items:F.node.items,modelValue:p.selectedChild,"onUpdate:modelValue":k[0]||(k[0]=M=>p.selectedChild=M),displayExpr:"name",stylingMode:"outlined","show-clear-button":!0,showDropDownButton:!1,placeholder:S.$t("titles.dxSelectPlacehoder"),onValueChanged:m},null,8,["items","modelValue","placeholder"])):(j(),ne("div",Pi,[y("span",{class:"text",innerHTML:F.node.items},null,8,Ai),F.node.pattern?(j(),Fe(Ri,{key:0,pattern:Ge(Fi)[F.node.pattern[0]][F.node.pattern[1]-1]},null,8,["pattern"])):me("",!0)])),p.hasChild?(j(),Fe(R,{key:3,node:p.selectedChild,index:F.index+1,modelValue:p.childValue,"onUpdate:modelValue":[k[1]||(k[1]=M=>p.childValue=M),V]},null,8,["node","index","modelValue"])):me("",!0)])):me("",!0)}}},$i=it(Vi,[["__scopeId","data-v-70cfc098"]]);const Ii=y("div",{class:"triangle-shadow"},null,-1),Zi=y("div",{class:"triangle"},null,-1),Ei={__name:"Index",props:["modelValue"],emits:["update:modelValue","change"],setup(F,{emit:B}){const x=F,w=B,v=D(null),W=D(!1),p=D({});ci(Object.assign({"../../../../lang/vi/derivative.js":()=>di(()=>import("./derivative-60bb42b4.js"),[])}),`../../../../lang/${window.lang}/derivative.js`).then(S=>{p.value=S.default,W.value=!0});const f=D(x.modelValue);ae(()=>x.modelValue,S=>f.value=S);function m(S){w("update:modelValue",S),w("change",S),setTimeout(()=>{v.value.scrollTop=v.value.scrollHeight},0)}function V(S){S.stopPropagation()}return(S,k)=>(j(),ne("div",{class:"progress-context",onClick:V,title:""},[Ii,Zi,y("div",{ref_key:"scrollContainer",ref:v,class:"container"},[W.value?(j(),Fe($i,{key:0,node:p.value,index:0,modelValue:f.value,"onUpdate:modelValue":[k[0]||(k[0]=R=>f.value=R),m]},null,8,["node","modelValue"])):me("",!0)],512)]))}};const Bi={class:"content-block dx-card responsive-paddings"},Wi=["title"],Mi=["title"],Yi=["title"],Ni=["title"],Xi=["title"],zi=["title"],Ji=["title"],Hi=["title"],ji=["title"],qi=y("i",{class:"far fa-heart-rate"},null,-1),Qi=[qi],Ui=["title"],Gi=y("i",{class:"far fa-grip-lines-vertical"},null,-1),Ki=[Gi],eo=["title"],to=y("i",{class:"far fa-horizontal-rule"},null,-1),io=["title"],oo=y("i",{class:"far fa-line-height"},null,-1),ro=[oo],so=["title"],no=["src"],et=3,tt=2,ao="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",ho={__name:"Index",setup(F){const B={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},x=be(new Date,"yyyy-MM-dd"),w={START:A(new Date(`${x}T08:45:00Z`)),ATO:A(new Date(`${x}T09:00:00Z`)),ATC:A(new Date(`${x}T14:30:00Z`)),END:A(new Date(`${x}T14:45:00Z`))},v=hi(),W=gi(),{t:p}=pi(),f=De("devices"),m=De("mf"),V=De("bus"),S=De("filters"),k=D(null),R=D(null),M=D(null),le=D(null),Y=D(null),nt=D(null),at=D(null),he=D(null),Oe=D(null),Re=D(null),ge=D(null),Le=D(null),lt=D(null),te=D(null),ce=D(null),Ee=D(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:A(Ie(new Date,7))};ue();const l=rt({chartDate:W.query.date??x,clock:be(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,isAutoScan:!1,lineColor:"#F44336",lineTitle:"",progress:[],showProgressContext:!1,scanSide:"left",showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),$=ee(()=>v.state.tradingDerivative.status),q=ee(()=>v.state.tradingDerivative.config),Be=ee(()=>v.state.tradingDerivative.tools),ct=ee(()=>v.state.tradingDerivative.isChartLoading),dt=ee(()=>$.value.position!=0||!!$.value.pending||!!Be.value.order),pt=ee(()=>`https://chart.vps.com.vn/tv/?u=${q.value.vpsUser}&s=${q.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);v.dispatch("tradingDerivative/initChart").then(()=>{console.log("inSession()",Q()),Q()&&_e(),!W.query.date&&q.value.lastOpeningDate&&(l.chartDate=q.value.lastOpeningDate),v.dispatch("tradingDerivative/getChartData",l.chartDate).then(i=>{i&&pe()})}),e.interval=setInterval(Ct,1e3),e.interval60=setInterval(()=>{Q()?(qe(),q.value.autoScan&&pe()):clearInterval(e.interval60)},6e4),ot(()=>{e.chart=wi(R.value,B),e.chart.subscribeCrosshairMove(vt),e.chart.subscribeCustomPriceLineDragged(mt),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(ht).observe(k.value),document.addEventListener("keydown",Ye),document.addEventListener("fullscreenchange",Ne)}),ui(()=>{document.removeEventListener("keydown",Ye),document.removeEventListener("fullscreenchange",Ne),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),ae(()=>v.state.tradingDerivative.chartData,xt),ae(()=>Be.value,yt);function ut(i){l.showProgressContext=!1,l.showScanContext=!1,l.showLineContext=!1,we(!1),he.value.classList.contains("selected")?Mt():Re.value.classList.contains("selected")?zt():ge.value.classList.contains("selected")?Et():Le.value.classList.contains("selected")?Ot():Oe.value.classList.contains("selected")&&Vt()}function ft(i){we(!0),i.preventDefault()}function We(i){i.stopPropagation()}function Me(i){i.preventDefault(),i.stopPropagation()}function vt(i){if(i.time){let r=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=r}else f.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function mt(i){let r=i.customPriceLine,t=r.options();t.price=parseFloat(t.price.toFixed(1));const o=+i.fromPriceString,n=t.price;switch(t.lineType){case"order":if(n!=o){let s=!1;t.kind=="entry"?$.value.position||(s=!0,e.tools.order[t.kind].price=n,v.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(d=>{d.isOk?(oe([t.kind]),P.success(p("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:o}),I(d.message))})):(s=!0,e.tools.order[t.kind].price=n,t.kind=="tp"?v.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(d=>{d.isOk?(oe([t.kind]),P.success(p("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:o}),I(d.message))}):v.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(d=>{d.isOk?(oe([t.kind]),P.success(p("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:o}),I(d.message))})),s||(r.applyOptions({price:o}),P.show(p("trading.derivative.noChangeOrderLine")))}break;case"line":v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o});const a=t.color,c=t.title;v.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[n],data:[{color:a,title:c}]}),he.value.classList.remove("selected");break;case"target":if(m.isSet(e.tools.target.B)){let s={isRemove:!1,name:"target",points:[],data:[]},d,u,g=+e.tools.target.A.options().price,C=+e.tools.target.B.options().price,h=C-g;if(d="A",t.point=="A")h=+e.tools.target.B.options().title,C=g+h;else if(t.point!="B"){let T=0;switch(t.point){case"X":T=1.5;break;case"Y":T=2;break;case"Z":T=3;break}h=parseFloat(((C-n)/T).toFixed(1)),g=C-h,u={price:g},e.tools.target[d].applyOptions(u)}s.points.push(d),s.data.push(g),d="B",u={price:C,title:h.toFixed(1)},t.point==d&&delete u.price,e.tools.target[d].applyOptions(u),s.points.push(d),s.data.push(C),d="X",u={price:parseFloat((g-.5*h).toFixed(1)),title:(-.5*h).toFixed(1)},t.point==d&&delete u.price,e.tools.target[d].applyOptions(u),d="Y",u={price:parseFloat((g-h).toFixed(1)),title:(-h).toFixed(1)},t.point==d&&delete u.price,e.tools.target[d].applyOptions(u),d="Z",u={price:parseFloat((g-2*h).toFixed(1)),title:(-2*h).toFixed(1)},t.point==d&&delete u.price,e.tools.target[d].applyOptions(u),v.dispatch("tradingDerivative/drawTools",s)}break;case"pattern":if(m.isSet(e.tools.pattern.B)){let s,d;const u=e.tools.pattern.A.options(),g=e.tools.pattern.B.options(),C=e.tools.pattern.C.options(),h={A:{time:+u.time,price:+u.price},B:{price:+g.price},C:{price:+C.price}},T=t.point=="D"?+e.tools.pattern.D.options().price:null,{pattern:O,timeRange:L,info:{tr1:Z,tr2:X,tr3:z,pr1:_,pr2:K,pr3:E,fibo:J,sp:U,X:G,Y:Qe,Z:Ue}}=xe(h,T);Pe([O]),Ce(L),de(h),s="A",d={title:`A ${Z} ${_}`},e.tools.pattern[s].applyOptions(d),s="B",d={title:`B ${X} ${K}`},e.tools.pattern[s].applyOptions(d),s="C",d={title:`C ${z} ${E}`},e.tools.pattern[s].applyOptions(d),s="D",d={price:U,title:"F "+J},t.point==s&&delete d.price,e.tools.pattern[s].applyOptions(d),s="X",d={price:parseFloat((U+G).toFixed(1)),title:"T "+parseFloat(G.toFixed(1))},e.tools.pattern[s].applyOptions(d),s="Y",d={price:parseFloat((U+Qe).toFixed(1)),title:"T "+parseFloat(Qe.toFixed(1))},e.tools.pattern[s].applyOptions(d),s="Z",d={price:parseFloat((U+Ue).toFixed(1)),title:"T "+parseFloat(Ue.toFixed(1))},e.tools.pattern[s].applyOptions(d)}break}}function ht(){k.value&&(e.chart.resize(k.value.offsetWidth,k.value.offsetHeight),k.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ye(i){if(i.ctrlKey)switch(i.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(i.altKey)switch(i.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function Ne(){k.value&&(document.fullscreenElement?(l.isFullscreen=!0,k.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(l.isFullscreen=!1,k.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function gt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function yt(i){Ht(),Object.entries(i).forEach(([r,t])=>{switch(r){case"order":Tt(t);break;case"pattern":Je(i.pattern,!("tr"in i));break;case"tr":Ce(Object.values(t));break;case"line":Yt(t);break;case"target":Jt(t);break}})}function xt(i){l.chartDate==x&&Q()||(i.price.length>0&&(e.data.whitespace=ye(e.data.whitespace,ze(l.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=ye(e.data.price,i.price),e.series.price.setData(e.data.price))}function Xe(i){let r=[];i.forEach(t=>{const o=A(Ie(new Date(t.date),7));r.push({time:o,value:t.price})}),r.length>1?(e.data.price=ye(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function ze(i){const r=A(new Date(`${i}T09:00:00Z`)),t=A(new Date(`${i}T11:30:00Z`)),o=A(new Date(`${i}T13:00:00Z`)),n=A(new Date(`${i}T14:30:00Z`)),a=A(new Date(`${i}T14:00:00Z`));let c=[];for(let s=r;s<=n;s++){if(s>t&&s<o)continue;let d={time:s};(s==a||s==n)&&(d.value=1),c.push(d)}return c}function ye(i,r){return Array.from(new Map([...i,...r].sort((t,o)=>t.time-o.time).map(t=>[t.time,t])).values())}function _e(){v.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(ao),e.websocket.onopen=i=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=i=>{!e.socketStop&&Q()&&(l.isSocketWarning=!0,_e())},e.websocket.onmessage=i=>{l.isSocketWarning=!1,St(i.data).forEach(t=>{if(!t)return!1;t.type==3?(pe(),e.data.whitespace=ye(e.data.whitespace,ze(x)),e.series.whitespace.setData(e.data.whitespace),Xe(t.result),v.dispatch("tradingDerivative/setChartLoading",!1)):t.type==1&&t.target=="UpdateTrades"&&t.arguments[0]=="VN30F1M"&&(Ut(t.arguments[1].at(-1).price),Xe(t.arguments[1]))})}}function St(i){let r=[];return i.split("").forEach(t=>{const o=t.indexOf("{"),n=t.lastIndexOf("}");let a=null;if(o!==-1&&n!==-1&&n>o){const c=t.substring(o,n+1);c!="{}"&&(a=JSON.parse(c))}r.push(a)}),r}function Ct(){e.currentSeconds=A(Ie(new Date,7)),Q()&&($.value.position&&e.currentSeconds>w.ATC-5*60&&(l.isOrderWarning=!0,e.currentSeconds>w.ATC-15&&m.isSet(e.tools.order.tp.line)&&v.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(i=>{i.isOk?(re(["entry","tp","sl"]),P.success(p("trading.derivative.autoCancelTpSlSuccess"))):I(i.message)})),q.value.openingMarket&&e.currentSeconds==w.START&&_e()),l.clock=be(new Date,"HH:mm:ss")}function oe(i){const r="order";let t={isRemove:!1,name:r,points:[],data:[]},o,n;i.forEach(a=>{switch(a){case"entry":o="yellow",n=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",n=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",n=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(t.points.push(a),m.isSet(e.tools.order[a].line))e.tools.order[a].line.applyOptions({price:e.tools.order[a].price,title:n}),t.data.push(e.tools.order[a].line.options());else{const c={lineType:r,kind:a,side:e.tools.order.side,price:e.tools.order[a].price,color:o,lineWidth:1,lineStyle:0,title:n,draggable:!0};e.tools.order[a].line=e.series.price.createPriceLine(c),t.data.push(c)}}),v.dispatch("tradingDerivative/drawTools",t)}function Tt(i){Object.entries(i).forEach(([r,t])=>{e.tools.order.side=t.side,e.tools.order[r].price=t.price,e.tools.order[r].line=e.series.price.createPriceLine(t)})}function re(i,r=!0){r&&v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),i.forEach(t=>{m.isSet(e.tools.order[t].line)&&(e.series.price.removePriceLine(e.tools.order[t].line),delete e.tools.order[t].line)})}function wt(i){l.showTradingView=!l.showTradingView,i.stopPropagation()}function kt(){v.dispatch("tradingDerivative/setAutoScan",!q.value.autoScan)}function bt(){l.showProgressContext=!l.showProgressContext,l.showScanContext=!1,l.showLineContext=!1}function Pe(i){l.progress=i}function Ae(){l.progress=[]}function Dt(i){l.showScanContext=!1,l.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(Se(),Te(!1),Ae(),de(),i.target.classList.add("selected"))}function Ft(){l.showScanContext=!l.showScanContext,l.showProgressContext=!1,l.showLineContext=!1}function Ot(){const i=l.scanSide=="left",r=e.crosshair.time?e.data.price.filter(o=>!b(o.time,i,e.crosshair.time)):e.data.price;let t=i?Rt(r):Lt(r);t=_t(t),m.isSet(t)&&(Se(),Je(t),de(t)),Le.value.classList.remove("selected")}function Rt(i){let r,[t,o,n,a]=Array(4).fill({});for(let c=i.length-1;c>=0;c--){const s=i[c].value,d=i[c].time,u=N(d);if(u==-1)break;if(c==i.length-1&&(n={index:u,time:d,price:s},[o,t,a]=Array(3).fill(null).map(()=>m.cloneDeep(n))),r==null){if(s==n.price)continue;r=s>n.price}if(b(s,r,o.price)&&(b(t.price,!r,n.price)?([n,o]=[o,t].map(g=>m.cloneDeep(g)),t={index:u,time:d,price:s},a=m.cloneDeep(t),r=!r):o={index:u,time:d,price:s}),b(s,!r,t.price)?(t={index:u,time:d,price:s},a=m.cloneDeep(t)):a.index=u,b(s,r,a.price)&&(a={index:u,time:d,price:s}),n.index>t.index){const g=Math.abs(o.price-n.price);if(g>=1.5&&(t.index-a.index>n.index-o.index||Math.abs(t.price-a.price)>g))break}}return{A:t,B:o,C:n}}function Lt(i){let r,[t,o,n]=Array(3).fill({});for(let a=0;a<i.length;a++){const c=i[a].value,s=i[a].time,d=N(s);if(d==-1)break;if(a==0&&(t={index:d,time:s,price:c},o=m.cloneDeep(t),n=m.cloneDeep(t)),r==null){if(c==t.price)continue;r=c>t.price}b(c,r,o.price)&&(o={index:d,time:s,price:c},n=m.cloneDeep(o)),b(o.price,r,t.price)&&b(c,!r,n.price)&&(b(c,r,t.price)?n={index:d,time:s,price:c}:(t=m.cloneDeep(o),o={index:d,time:s,price:c},n=m.cloneDeep(o),r=!r))}return{A:t,B:o,C:n}}function _t(i){const r={};return Object.entries(i).forEach(([t,o])=>{const{index:n,...a}=o;r[t]=a}),r}function Pt(i){l.showScanContext=!1,l.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function At(i){i.target.classList.remove("selected"),Se(),Te(!0),Ae(),de()}function Vt(){const i="pattern",r=ke(e.crosshair.y),t=e.crosshair.time;let o={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0};if(m.isSet(e.tools.pattern.A)){const n=e.tools.pattern.A.options();if(m.isSet(e.tools.pattern.B)){const a=e.tools.pattern.B.options();let c,s,d;if(m.isSet(e.tools.pattern.C)){let u,g;const C=e.tools.pattern.C.options();c={A:{time:t,price:r},B:{price:+a.price},C:{price:+C.price}};const{pattern:h,timeRange:T,info:{tr1:O,tr2:L,tr3:Z,pr1:X,pr2:z,pr3:_,fibo:K,sp:E,X:J,Y:U,Z:G}}=xe(c);s=T,d=h,u="A",g={price:r,time:t,title:`A ${O} ${X}`},e.tools.pattern[u].applyOptions(g),u="B",g={title:`B ${L} ${z}`},e.tools.pattern[u].applyOptions(g),u="C",g={title:`C ${Z} ${_}`},e.tools.pattern[u].applyOptions(g),u="D",g={price:E,title:"F "+K},e.tools.pattern[u].applyOptions(g),u="X",g={price:parseFloat((E+J).toFixed(1)),title:"T "+parseFloat(J.toFixed(1))},e.tools.pattern[u].applyOptions(g),u="Y",g={price:parseFloat((E+U).toFixed(1)),title:"T "+parseFloat(U.toFixed(1))},e.tools.pattern[u].applyOptions(g),u="Z",g={price:parseFloat((E+G).toFixed(1)),title:"T "+parseFloat(G.toFixed(1))},e.tools.pattern[u].applyOptions(g)}else{c={A:{time:+n.time,price:+n.price},B:{price:+a.price},C:{price:r}};const{pattern:u,timeRange:g,info:{tr1:C,tr2:h,tr3:T,pr1:O,pr2:L,pr3:Z,fibo:X,sp:z,X:_,Y:K,Z:E}}=xe(c);s=g,d=u;let J="A";e.tools.pattern[J].applyOptions({title:`A ${C} ${O}`}),J="B",e.tools.pattern[J].applyOptions({title:`B ${h} ${L}`}),o.point="C",o.title=`C ${T} ${Z}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=z,o.title="F "+X,o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat((z+_).toFixed(1)),o.title="T "+parseFloat(_.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat((z+K).toFixed(1)),o.title="T "+parseFloat(K.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Z",o.price=parseFloat((z+E).toFixed(1)),o.title="T "+parseFloat(E.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}Pe([d]),Ce(s),de(c),Oe.value.classList.remove("selected")}else o.point="B",o.title="B 0 0",o.color="#009688",e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}else o.point="A",o.title="A 0 0",o.color="#F44336",o.time=t,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function Je(i,r=!0){let o={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{pattern:n,timeRange:a,info:{tr1:c,tr2:s,tr3:d,pr1:u,pr2:g,pr3:C,fibo:h,sp:T,X:O,Y:L,Z}}=xe(i);Pe([n]),r&&Ce(a),o.point="A",o.title=`A ${c} ${u}`,o.color="#F44336",o.price=i.A.price,o.time=i.A.time,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="B",o.title=`B ${s} ${g}`,o.color="#009688",o.price=i.B.price,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="C",o.price=i.C.price,o.title=`C ${d} ${C}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=T,o.title="F "+h,o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat((T+O).toFixed(1)),o.title="T "+parseFloat(O.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat((T+L).toFixed(1)),o.title="T "+parseFloat(L.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Z",o.price=parseFloat((T+Z).toFixed(1)),o.title="T "+parseFloat(Z.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function xe(i,r=null){const t=Ve(i.A,i.B),o=Ve(t.R,i.C,t.tr),n=Ve(o.R,o.S,t.tr),a=i.C.price-i.B.price,c=i.A.price-i.B.price,s=a>0,d=t.S1.price-t.R1.price,u=o.R1.price-o.S1.price,g=n.S1.price-n.R1.price;let[C,h,T,O,L,Z]=Array(6).fill(0);O=parseInt(d/c*100),b(t.R1.price,s,i.B.price)&&b(t.S1.price,!s,i.C.price)&&(C=1),Math.abs(a)>1.5&&b(a,s,d)&&(L=parseInt(u/a*100),L>50&&(o.count==1?h=1:a/c<.5&&(o.count>1||o.over)?h=2:C==1&&b(o.S1.price,!s,t.R1.price)&&b(o.R1.price,s,t.S1.price)&&(h=3)),Z=parseInt(g/a*100),Z>40&&(n.count==1?T=1:a/c<.5&&(n.count>1||n.over)&&(T=2)),h==0&&L>50&&T==0&&Z>50&&o.tr>.5*t.tr&&o.pr>.5*t.pr&&n.R.index-n.S.index>=t.tr&&(b(n.R1.price,!s,o.S1.price)?h=4:h=5));let X=[];T>0?X=[t.R1.time,ie(t.S1.index),n.R1.time]:h>0&&h<=3?X=[o.R1.time,ie(o.S1.index),o.S1.time]:h>3?X=[t.R1.time,ie(t.S1.index),o.R.time]:X=[t.R1.time,ie(t.S1.index)];const z=$t(h,T);let _=r;if(!_){let G=0;_=i.B.price,h>0&&b(u,s,G)&&(G=u,_=h<5?o.S1.price:n.S1.price),T>0&&b(g,s,G)&&(_=n.R1.price)}const K=parseInt((h<5?(i.C.price-_)/a:(_-n.R1.price)/(i.C.price-n.R1.price))*100),E=_-(h<5?i.C.price:n.R1.price),J=.5*E,U=2*E;return{pattern:z,timeRange:X,info:{tr1:C,tr2:h,tr3:T,pr1:O,pr2:L,pr3:Z,fibo:K,sp:_,X:J,Y:E,Z:U}}}function Ve(i,r,t=0){let o=m.cloneDeep(i),n=m.cloneDeep(r);const a=n.price>o.price;let c={},s={};e.data.price.filter(u=>u.time>=o.time).every((u,g)=>{const C=u.value,h=u.time,T=N(h);if(T==-1)return!1;if((g==0||C==o.price)&&(c={R:{index:T,time:h,price:C},S:{index:T,time:h,price:C}},s={R:c.R,S:c.S,pr:0,tr:0,count:0,over:!1}),b(C,a,c.R.price)){const O=c.S.index-c.R.index,L=Math.abs(c.S.price-c.R.price);O>=s.tr&&(s.tr=O,s.pr=L,s.R=c.R,s.S=c.S,t>0&&O>=t&&(s.count++,O>=3*t&&(s.over=!0))),O>=.5*s.tr&&!b(c.S.price,!a,s.S.price)&&Math.abs(c.R.price-s.R.price)/s.pr<.1&&(s.S.index=c.S.index,s.tr=c.S.index-s.R.index),c={R:{index:T,time:h,price:C},S:{index:T,time:h,price:C}}}else c.S.index=T,b(C,!a,c.S.price)&&(c.S.time=h,c.S.price=C);return b(C,!a,o.price)?(c.S.price=o.price,!1):!!b(C,!a,n.price)});const d=c.S.index-c.R.index;if(d>=s.tr){const u=Math.abs(c.S.price-c.R.price);s.tr=d,s.pr=u,s.R=c.R,s.S=c.S,t>0&&d>=t&&(s.count++,d>=3*t&&(s.over=!0))}return n.time=ie(c.S.index),o.index=N(o.time),n.index=N(n.time),{tr:s.tr,pr:s.pr,count:s.count,over:s.over,S1:s.S,R1:s.R,S:o,R:n}}function $t(i,r){return r>0?r:i>0?i+2:0}function de(i={}){let r=!m.isSet(i),t={isRemove:r,name:"pattern",points:[],data:[]};r||Object.entries(i).forEach(([o,n])=>{t.points.push(o),t.data.push(n)}),v.dispatch("tradingDerivative/drawTools",t)}function Se(){m.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),m.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),m.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y),e.series.price.removePriceLine(e.tools.pattern.Z)))),ue(["pattern"])}function It(i){l.showScanContext=!1,l.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Zt(i){Te(),i.target.classList.remove("selected")}function Et(){let i={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let t={time:r,value:1};switch(e.tools.timeRange.length){case 0:t.color="OrangeRed",e.tools.timeRange[0]=t,i.points.push(0),i.data.push(r);break;case 1:t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(r),ge.value.classList.remove("selected");break;default:const o=N(e.tools.timeRange[0].time),n=N(e.tools.timeRange[1].time),c=N(r)+(n-o),s=ie(c);t.color="OrangeRed",e.tools.timeRange[0]=m.cloneDeep(t),i.points.push(0),i.data.push(r),t.time=s,t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(s),ge.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),v.dispatch("tradingDerivative/drawTools",i)}function Ce(i){let r,t;if(i.length==2)r=i[0],t=i[1];else if(i.length==3){const n=N(i[0]),a=N(i[1]),s=N(i[2])+(a-n);r=i[2],t=ie(s)}else return!1;let o=[{time:r,value:1,color:"OrangeRed"},{time:t,value:1,color:"lime"}];e.tools.timeRange=o,e.series.timeRange.setData(o)}function Te(i=!0,r=!1){i&&v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),r||(e.series.timeRange.setData([]),ue(["tr"]))}function Bt(i){l.showScanContext=!1,l.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Wt(i){l.showLineContext=!l.showLineContext,l.showProgressContext=!1,l.showScanContext=!1}function Mt(){const i="line",r=ke(e.crosshair.y),t=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const n=o.options(),a=n.type=r==+n.price;return a&&(e.series.price.removePriceLine(o),v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:i,point:r})),!a}),e.tools.lines.length==t){const o=l.lineColor,n=l.lineTitle,a={lineType:i,price:r,color:o,title:n,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(a)),v.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:i,points:[r],data:[{color:o,title:n}]})}he.value.classList.remove("selected")}function Yt(i){const t={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(i).forEach(([o,{color:n,title:a}])=>{t.price=+o,t.color=n,t.title=a,e.tools.lines.push(e.series.price.createPriceLine(t))})}function He(i=!0){e.tools.lines.length>0&&(i&&v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),ue(["lines"]))}function Nt(i){l.showScanContext=!1,l.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(i.target.classList.add("selected"),$e())}function Xt(i){$e(),i.target.classList.remove("selected")}function zt(){const i="target",r=ke(e.crosshair.y);let t={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:i,points:[],data:[r]};if(m.isSet(e.tools.target.A)){const n=+e.tools.target.A.options().price,a=r-n;t.point="B",t.title=parseFloat(a.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point),t.point="X",t.price=parseFloat((n-.5*a).toFixed(1)),t.title=parseFloat((-.5*a).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((n-a).toFixed(1)),t.title=parseFloat(-a.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((n-2*a).toFixed(1)),t.title=parseFloat((-2*a).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),Re.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point);v.dispatch("tradingDerivative/drawTools",o)}function Jt(i){let t={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const o=i.A,n=i.B,a=n-o;t.point="A",t.price=o,t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="B",t.price=n,t.title=parseFloat(a.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="X",t.price=parseFloat((o-.5*a).toFixed(1)),t.title=parseFloat((-.5*a).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((o-a).toFixed(1)),t.title=parseFloat(-a.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((o-2*a).toFixed(1)),t.title=parseFloat((-2*a).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t)}function $e(i=!0){i&&v.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),m.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),m.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z))),ue(["target"])}function Ht(){re(["entry","tp","sl"],!1),He(!1),$e(!1),Te(!1),Ae(),Se()}function we(i){if(i){if(Q()&&(m.isSet(e.tools.order.tp.line)||$.value.position&&e.currentSeconds>w.ATO&&e.currentSeconds<w.ATC&&(ce.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",ce.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",ce.value.style.display="block"),!m.isSet(e.tools.order.entry.line))){let r=null,t=0;$.value.position?(e.currentSeconds<w.ATO?r="ATO":e.currentSeconds>w.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,t=-$.value.position)):e.currentSeconds>w.ATO&&e.currentSeconds<w.ATC&&(r=ke(e.crosshair.y),t=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=t,e.tools.order.entry.price=r),t&&(te.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",te.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",te.value.style.background=t>0?"green":"red",te.value.innerText=`${t>0?"LONG":"SHORT"} ${r}`,te.value.style.display="block")}}else te.value.style.display="none",ce.value.style.display="none"}function jt(){Q()&&(e.currentSeconds<w.ATO?Ke(p("trading.derivative.atoOrder"),p("titles.confirm")).then(r=>{r&&v.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(t=>{t.isOk?P.success(p("trading.derivative.atoOrderSuccess")):I(t.message)})}):e.currentSeconds<w.ATC?v.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(i=>{i.isOk?(oe(["entry"]),P.success(p("trading.derivative.newEntrySuccess"))):I(i.message)}):Ke(p("trading.derivative.atcOrder"),p("titles.confirm")).then(r=>{r&&v.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(t=>{t.isOk?P.success(p("trading.derivative.atcOrderSuccess")):I(t.message)})}))}function qt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*et,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*tt,v.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(i=>{i.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),oe(["entry","tp","sl"]),P.success(p("trading.derivative.newTpSlSuccess"))):I(i.message)})}function Qt(){m.isSet(e.tools.order.entry.line)?m.isSet(e.tools.order.tp.line)?v.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(i=>{i.isOk?(re(["entry","tp","sl"]),P.success(p("trading.derivative.exitSuccess"))):I(i.message)}):v.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(i=>{i.isOk?(re(["entry"]),P.success(p("trading.derivative.deleteEntrySuccess"))):I(i.message)}):pe()}function Ut(i){m.isSet(e.tools.order.entry.line)&&(m.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&i>=e.tools.order.tp.price||e.tools.order.side<0&&i<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,v.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(re(["entry","tp","sl"]),P.success(p("trading.derivative.deleteTpSuccess")),we(!1)):I(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&i<=e.tools.order.sl.price||e.tools.order.side<0&&i>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,v.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(re(["entry","tp","sl"]),P.success(p("trading.derivative.deleteSlSuccess")),we(!1)):I(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&i>=e.tools.order.entry.price||e.tools.order.side<0&&i<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*et,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*tt,v.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),oe(["entry","tp","sl"]),P.success(p("trading.derivative.autoNewTpSlSuccess"))):I(r.message),e.isAutoOrdering=!1})},1e3))))}function Gt(){e.chart.timeScale().scrollToRealTime()}function Q(){return q.value.openingMarket&&e.currentSeconds>=w.START&&e.currentSeconds<=w.END}function ke(i){return parseFloat(e.series.price.coordinateToPrice(i).toFixed(1))}function I(i){i||(i="unknown"),P.error(p(`trading.derivative.${i}`))}function Kt(){if(!l.chartDate)return!1;v.dispatch("tradingDerivative/getChartData",l.chartDate)}function je(){Q()&&e.websocket.send(e.socketSendData)}function ei(){e.data.whitespace=[],e.data.price=[],je(),v.dispatch("tradingDerivative/getChartData",l.chartDate)}function qe(){v.dispatch("tradingDerivative/getStatus")}function pe(){v.dispatch("tradingDerivative/getTools")}function ue(i){i==null&&(i=["order","lines","tr","pattern","target"]),i.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),i.includes("lines")&&(e.tools.lines=[]),i.includes("target")&&(e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),i.includes("tr")&&(e.tools.timeRange=[]),i.includes("pattern")&&(e.tools.pattern={A:{},B:{},C:{},D:{},X:{},Y:{},Z:{}})}function ti(){v.dispatch("tradingDerivative/getAccountInfo").then(i=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${p("trading.derivative.nav")}</div><div>: ${S.currency(i.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${p("trading.derivative.maxVol")}</div><div>: ${S.numberVnFormat(i.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${p("trading.derivative.vm")}</div><div>: ${S.currency(i.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${p("trading.derivative.fee")}</div><div>: ${S.currency(i.fee)}</div></div>`,r+="</div>",yi(r,p("trading.derivative.accountInfo"))})}function ii(){V.emit("checkPin",()=>v.dispatch("tradingDerivative/report"))}function oi(){V.emit("checkPin",()=>v.dispatch("tradingDerivative/export",l.chartDate))}function ri(){Ee.value.show()}function si(){V.emit("checkPin",()=>v.dispatch("tradingDerivative/loginDnse"))}function b(i,r,t,o=!1){return r?o?i>=t:i>t:o?i<=t:i<t}function N(i){let r=e.data.whitespace.findIndex(t=>t.time==i);if(r==-1){const t=be(new Date(i*1e3),"yyyy-MM-dd"),o=A(new Date(`${t}T11:30:00Z`)),n=A(new Date(`${t}T13:00:00Z`)),a=A(new Date(`${t}T14:30:00Z`));i>o&&i<n?i=o:i>a&&(i=a),r=e.data.whitespace.findIndex(c=>c.time==i)}return r}function ie(i){return e.data.whitespace[i].time}return(i,r)=>{const t=st("DxToolbar");return j(),ne(mi,null,[y("div",Bi,[fe(t,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:i.$t("trading.derivative.buttons.report"),onClick:ii}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:i.$t("trading.derivative.buttons.export"),onClick:oi}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:i.$t("trading.derivative.buttons.loginVps"),onClick:ri}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:i.$t("trading.derivative.buttons.loginDnse"),onClick:si}}]},null,8,["items"]),y("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:k,onClick:ut,onContextmenu:ft},[y("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:R},[y("div",{class:"area data-area",onClick:We,onContextmenu:Me},[y("div",{ref_key:"connectionRef",ref:M,class:H(["command",{yellow:$.value.pending}]),title:i.$t("trading.derivative.connection"),onClick:qe},[y("i",{class:H(["far",{"fa-link-simple":$.value.connection,"fa-link-simple-slash":!$.value.connection,blink:l.isSocketWarning}])},null,2)],10,Wi),y("div",{class:H(["command status",{green:$.value.position>0,red:$.value.position<0}]),title:i.$t("trading.derivative.position"),onClick:ti},Ze($.value.position),11,Mi),y("div",{class:"command clock",onClick:je},Ze(l.clock),1),se(y("input",{type:"date",class:"chart-date command",title:i.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=o=>l.chartDate=o),onChange:Kt},null,40,Yi),[[fi,l.chartDate]]),y("div",{ref_key:"reloadToolRef",ref:nt,class:"command",title:i.$t("trading.derivative.reload"),onClick:ei,onContextmenu:pe},[y("i",{class:H(["far fa-sync-alt",{"fa-spin":ct.value}])},null,2)],40,Ni)],32),y("div",{class:"area tool-area",onClick:We,onContextmenu:Me},[y("div",{ref_key:"fullscreenToolRef",ref:le,class:"command",title:i.$t("trading.derivative.fullscreen"),onClick:gt},[y("i",{class:H(["far",{"fa-compress":l.isFullscreen,"fa-expand":!l.isFullscreen}])},null,2)],8,Xi),y("div",{ref_key:"tradingviewRef",ref:at,class:"command far fa-chart-candlestick",title:i.$t("trading.derivative.tradingview"),onClick:wt},null,8,zi),y("div",{class:H(["context command",{green:l.progress[0]>0,red:l.progress[0]==0}]),title:i.$t("trading.derivative.progressTool"),onClick:kt,onContextmenu:bt},[y("i",{class:H(["far",{"fa-badge-check":!l.progress[0],[`fa-circle-${l.progress[0]}`]:l.progress[0],blink:q.value.autoScan}])},null,2),se(fe(Ei,{class:"contextmenu",modelValue:l.progress,"onUpdate:modelValue":r[1]||(r[1]=o=>l.progress=o)},null,8,["modelValue"]),[[ve,l.showProgressContext]])],42,Ji),y("div",{ref_key:"scanToolRef",ref:Le,class:"context command",title:i.$t("trading.derivative.scanTool"),onClick:Dt,onContextmenu:Ft},[y("i",{class:H(["far",{[`fa-angles-${l.scanSide}`]:!0}])},null,2),se(fe(Si,{class:"contextmenu",modelValue:l.scanSide,"onUpdate:modelValue":r[2]||(r[2]=o=>l.scanSide=o)},null,8,["modelValue"]),[[ve,l.showScanContext]])],40,Hi),y("div",{ref_key:"patternToolRef",ref:Oe,class:"command",title:i.$t("trading.derivative.patternTool"),onClick:Pt,onContextmenu:At},Qi,40,ji),y("div",{ref_key:"timeRangeToolRef",ref:ge,class:"command",title:i.$t("trading.derivative.timeRangeTool"),onClick:It,onContextmenu:Zt},Ki,40,Ui),y("div",{ref_key:"lineToolRef",ref:he,class:"context command",title:i.$t("trading.derivative.lineTool"),onClick:Bt,onContextmenu:Wt},[to,se(fe(xi,{class:"contextmenu",enable:l.showLineContext,title:l.lineTitle,"onUpdate:title":r[3]||(r[3]=o=>l.lineTitle=o),color:l.lineColor,"onUpdate:color":r[4]||(r[4]=o=>l.lineColor=o),onDeleteAllLine:He},null,8,["enable","title","color"]),[[ve,l.showLineContext]])],40,eo),y("div",{ref_key:"targetToolRef",ref:Re,class:"command",title:i.$t("trading.derivative.targetTool"),onClick:Nt,onContextmenu:Xt},ro,40,io),se(y("div",{ref_key:"cancelOrderRef",ref:lt,class:"cancel-order command",title:i.$t("trading.derivative.cancelTool"),onClick:Qt},[y("i",{class:H(["far fa-trash-alt",{blink:l.isOrderWarning}])},null,2)],8,so),[[ve,dt.value]])],32),y("div",null,[y("div",{ref_key:"entryOrderRef",ref:te,class:"order-button entry",onClick:jt}," Entry ",512),y("div",{ref_key:"tpslOrderRef",ref:ce,class:"order-button tpsl",onClick:qt}," TP/SL ",512),y("div",{class:"chart-top command far fa-angle-double-right",onClick:Gt})]),se(y("iframe",{ref_key:"tradingviewChartRef",ref:Y,class:"tradingview-chart",style:vi(l.tradingViewStyle),src:pt.value},null,12,no),[[ve,l.showTradingView]])],512)],544)]),fe(Ti,{ref_key:"vpsOtpPopupRef",ref:Ee},null,512)],64)}}};export{ho as default};
