import{u as at,b as nt,c as ct,i as G,r as g,d as dt,e as w,x as pt,w as ut,f as mt,g as ft,j as D,h,l as J,z as E,A as $,E as R,C as ht,G as F,o as gt,H as vt,v as yt}from"./app-9e3ce16d.js";import bt from"./ColorPicker-7978fd84.js";import{c as kt}from"./lightweight-charts.esm.development-03366bac.js";import{_ as Q}from"./select-box-76f413db.js";const wt={class:"stock-page content-block dx-card responsive-paddings"},Ct=["title"],St=["title"],Lt=["title"],Tt=["title"],Pt=["title"],xt=["title"],Dt=["title"],Et=["title"],$t=["title"],Rt=["title"],Ft=["title"],_t=["title"],Vt=["title"],Ot=["title"],Bt=["src"],Wt={__name:"Index",setup(At){const ee={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.35}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},c=at(),S=nt(),{t:m}=ct(),te=G("devices"),p=G("mf"),y=g(null),N=g(null),oe=g(null),se=g(null),ie=g(null),L=g(null),_=g(null),V=g(null),O=g(null),B=g(null),A=g(null),le=g(null);let e={chart:{},series:{},data:{ohlc:[],price:[],cash:[],foreign:[]},tools:{lines:[],target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},rr:{EP:{},SL:{},TP:{}},range:[]},fundSize:0,losePerOrder:0,crosshair:{},isCashDraw:!1,isOnlyLoadData:!1,showNewsInfo:!1,foreignEnable:!0};const l=dt({symbol:S.query.symbol??"VNINDEX",timeframe:"D",symbolKind:null,chartShift:0,symbolKinds:[{text:m("trading.stock.symbolList.hose"),value:"hose"},{text:m("trading.stock.symbolList.filterTop"),value:"f_top"},{text:m("trading.stock.symbolList.filterBottom"),value:"f_bottom"},{text:m("trading.stock.symbolList.watch"),value:"watch"},{text:m("trading.stock.symbolList.hold"),value:"hold"},{text:m("trading.stock.symbolList.nh"),value:"nh"},{text:m("trading.stock.symbolList.ck"),value:"ck"},{text:m("trading.stock.symbolList.hnx"),value:"hnx"}],filterItems:[{text:m("trading.stock.symbolList.filterTop"),value:"f_top"},{text:m("trading.stock.symbolList.filterBottom"),value:"f_bottom"}],color:"#F44336",showColorPicker:!1,isFullscreen:!1,showTradingView:!1,dividendEnable:!1,trainEnable:!1,totalEpochs:10,currentEpoch:0});l.symbolKind=S.query.list??"hose";const re=w(()=>`https://sbboard.sbsi.vn/chart/?language=vi&theme=dark&symbol=${l.symbol}`),M=w(()=>S.query.from??moment().subtract(l.chartShift+3,"years").unix()),q=w(()=>S.query.to??moment().subtract(l.chartShift,"years").unix()),Y=w(()=>c.state.tradingStock.symbols.watch.includes(l.symbol)),ae=w(()=>c.state.tradingStock.symbols[l.symbolKind]),ne=w(()=>c.state.tradingStock.chart.dividend?" dividend":"");c.dispatch("tradingStock/getSymbols"),pt(()=>{e.chart=kt(N.value,ee),e.chart.subscribeCrosshairMove(de),e.chart.subscribeCustomPriceLineDragged(pe),e.series.range=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.events=e.chart.addHistogramSeries({priceScaleId:"events",scaleMargins:{top:.96,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.vnindex=e.chart.addLineSeries({priceScaleId:"vnindex",scaleMargins:{top:.05,bottom:.76},color:"aqua",priceFormat:{minMove:.01},lastValueVisible:!1}),e.series.foreign=e.chart.addLineSeries({priceScaleId:"foreign",scaleMargins:{top:.66,bottom:.05},color:"blue",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.66,bottom:.05},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#42946C",downColor:"#BC3E4A",borderVisible:!1,wickUpColor:"#42946C",wickDownColor:"#BC3E4A",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(ue).observe(y.value),document.addEventListener("keydown",me),document.addEventListener("fullscreenchange",fe),c.dispatch("tradingStock/initChart",{symbol:l.symbol,from:M.value,to:q.value,timeframe:l.timeframe,vnindex:!0,dividend:l.dividendEnable,foreign:e.foreignEnable}).then(t=>{e.series.vnindex.setData(t.chart.vnindex),e.tools.range=t.range,e.series.range.setData(t.range),e.fundSize=t.fundSize,e.losePerOrder=t.losePerOrder})}),ut(()=>c.state.tradingStock.chart,()=>{e.isOnlyLoadData||(ve(),be()),ke()});function T(t){t.preventDefault(),t.stopPropagation()}function ce(t){L.value.classList.contains("selected")?Te():_.value.classList.contains("selected")?De():V.value.classList.contains("selected")?X():O.value.classList.contains("selected")?H():B.value.classList.contains("selected")?qe():A.value.classList.contains("selected")?We():je(),T(t)}function de(t){if(t.time){let s=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=s}else te.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function pe(t){let s=t.customPriceLine,o=s.options();o.price=K(o.price);const i=+t.fromPriceString;switch(+o.price,o.lineType){case"line":c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:l.symbol,name:o.lineType,points:[i],data:[o]}),L.value.classList.remove("selected");break;case"target":if(p.isSet(e.tools.target.B)){let r={isRemove:!1,symbol:l.symbol,name:"target",points:[],data:[]},a;const n=+e.tools.target.A.options().price,f=+e.tools.target.B.options().price-n;o.point=="A"&&(a="A",r.points.push(a),r.data.push(e.tools.target[a].options())),a="B",e.tools.target[a].applyOptions({title:(100*f/n).toFixed(1)+"%"}),r.points.push(a),r.data.push(e.tools.target[a].options()),a="X",e.tools.target[a].applyOptions({price:+(n-.5*f).toFixed(2),title:(100*-.5*f/n).toFixed(1)+"%"}),r.points.push(a),r.data.push(e.tools.target[a].options()),a="Y",e.tools.target[a].applyOptions({price:+(n-f).toFixed(2),title:(100*-f/n).toFixed(1)+"%"}),r.points.push(a),r.data.push(e.tools.target[a].options()),a="Z",e.tools.target[a].applyOptions({price:+(n-2*f).toFixed(2),title:(100*-2*f/n).toFixed(1)+"%"}),r.points.push(a),r.data.push(e.tools.target[a].options()),c.dispatch("tradingStock/drawTools",r)}break;case"rr":if(p.isSet(e.tools.rr.TP)){let r={isRemove:!1,symbol:l.symbol,name:"rr",points:[],data:[]},a;const n=+e.tools.rr.EP.options().price,d=+e.tools.rr.SL.options().price,f=+e.tools.rr.TP.options().price,v=d-n,u=f-n;if(u/v>0)return s.applyOptions({price:i}),!1;const b=Math.abs(u)/Math.abs(v),k=v/n*100,lt=u/n*100,rt=(e.fundSize*e.losePerOrder/Math.abs(k)/(n*1e3)).toFixed(0);a="EP",e.tools.rr[a].applyOptions({title:`[V=${rt}] RR=${b.toFixed(1)}`}),r.points.push(a),r.data.push(e.tools.rr[a].options()),a="SL",e.tools.rr[a].applyOptions({title:`SL=${k.toFixed(1)}%`}),r.points.push(a),r.data.push(e.tools.rr[a].options()),a="TP",e.tools.rr[a].applyOptions({title:`TP=${lt.toFixed(1)}%`}),r.points.push(a),r.data.push(e.tools.rr[a].options()),c.dispatch("tradingStock/drawTools",r)}break}}function ue(){y.value&&(e.chart.resize(y.value.offsetWidth,y.value.offsetHeight),y.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function me(t){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 96:Z();break;case 110:j();break}}function fe(){y.value&&(document.fullscreenElement?(l.isFullscreen=!0,y.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(l.isFullscreen=!1,y.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function he(){F(`${m("trading.stock.removeFilterList")}?`,m("titles.confirm")).then(t=>{if(t){const s=c.state.tradingStock.symbols[l.symbolKind];let o=s.findIndex(r=>r==l.symbol);o=o==s.length-1?0:o+1;const i={symbol:l.symbol,name:l.symbolKind};c.dispatch("tradingStock/removeFilterList",i).then(()=>l.symbol=s[o])}})}function j(){if(!l.symbol)return!1;const t={symbol:l.symbol,add:!Y.value};c.dispatch("tradingStock/addWatchlist",t)}function ge(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function ve(){U(!1),I(!1),P(!1),P(!1,!0),x(!1),x(!1,!0),z(!1),ye()}function ye(){const t=c.state.tradingStock.chart.tools;for(const[s,o]of Object.entries(t))switch(s){case"line":Object.values(o).forEach(i=>e.tools.lines.push(e.series.price.createPriceLine(i)));break;case"target":Object.entries(o).forEach(([i,r])=>e.tools.target[i]=e.series.price.createPriceLine(r));break;case"rr":Object.entries(o).forEach(([i,r])=>e.tools.rr[i]=e.series.price.createPriceLine(r));break;default:s.includes("uplps")?Object.entries(o).forEach(([i,r])=>e.tools.uplps[i]=e.series[i.includes("P")?"price":"cash"].createPriceLine(r)):s.includes("downlps")&&Object.entries(o).forEach(([i,r])=>e.tools.downlps[i]=e.series[i.includes("P")?"price":"cash"].createPriceLine(r));break}}function be(){e.series.events.setData(c.state.tradingStock.chart.events)}function ke(){e.data=c.state.tradingStock.chart.data,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.series.foreign.setData(e.data.foreign),e.chart.applyOptions({watermark:{text:l.symbol}})}function we(t){l.showTradingView=!l.showTradingView}function Ce(t){l.showColorPicker=!l.showColorPicker}function Se(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s||t.target.classList.add("selected")}function Le(t){U(),t.target.classList.remove("selected")}function Te(t=null,s=!1,o=!1){const i="line";t||(t=K(W(e.crosshair.y)));const r=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(a=>{const n=a.options(),d=n.type=t==+n.price;return d&&(e.series.price.removePriceLine(a),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:i,point:t})),!d}),e.tools.lines.length==r&&!o||s){const a={lineType:i,price:t,color:l.color,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(a)),c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:l.symbol,name:i,points:[t],data:[a]})}L.value.classList.remove("selected")}function U(t=!0){e.tools.lines.length>0&&(console.log("removeLineTool"),e.tools.lines.forEach(s=>e.series.price.removePriceLine(s)),e.tools.lines=[],t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"line",point:null}))}function Pe(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s||(t.target.classList.add("selected"),I())}function xe(t){I(),t.target.classList.remove("selected")}function De(){const t="target",s=W(e.crosshair.y);let o={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},i={isRemove:!1,symbol:l.symbol,name:t,points:[],data:[]};if(p.isSet(e.tools.target.A)){const r=+e.tools.target.A.options().price,a=s-r;o.point="B",o.title=(100*a/r).toFixed(1)+"%",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o)),o.point="X",o.price=+(r-.5*a).toFixed(2),o.title=(100*-.5*a/r).toFixed(1)+"%",o.color="#2196F3",e.tools.target[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o)),o.point="Y",o.price=+(r-a).toFixed(2),o.title=(100*-a/r).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o)),o.point="Z",o.price=+(r-2*a).toFixed(2),o.title=(100*-2*a/r).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o)),_.value.classList.remove("selected")}else o.point="A",o.title="0",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o));c.dispatch("tradingStock/drawTools",i)}function I(t=!0){p.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),p.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z)),e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"target"})}function Ee(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s?X():t.target.classList.add("selected")}function $e(t){P(),t.target.classList.remove("selected")}function X(){let t,s;const o=e.isCashDraw?"cash":"price",i=e.isCashDraw?"C":"P";p.isSet(e.tools.uplps[`${i}1`])?(t=+e.tools.uplps[`${i}1`].options().startTime,s=e.crosshair.time,P(!1)):t=e.crosshair.time;const{value1:r,value2:a}=Re(t,s);let n={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},d={isRemove:!1,symbol:l.symbol,name:`${o}uplps`,points:[],data:[]};n.startTime=t,n.price=r,n.title=`${i}1`,e.tools.uplps[n.title]=e.series[o].createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=a,n.title=`${i}2`,e.tools.uplps[n.title]=e.series[o].createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),c.dispatch("tradingStock/drawTools",d),V.value.classList.remove("selected")}function Re(t,s){let o,i,r,a=0,n=0;const d=e.data[e.isCashDraw?"cash":"price"];for(let f=0;f<d.length;f++){const v=d[f].time;if(v<t)continue;if(s&&v>s)break;const u=d[f].value;if(o==null&&(o=u,i=u,r=u),u>r)a>n&&(i=r,n=a),r=u,a=0;else if(u<r){const b=+(r-u).toFixed(2);b>a&&(a=b)}if(u<o&&n>0)break}return{value1:+(i-n).toFixed(2),value2:+(r-n).toFixed(2)}}function P(t=!0,s=!1){const o=e.isCashDraw||s,i=o?"cash":"price",r=o?"C":"P",a=`${r}1`,n=`${r}2`;p.isSet(e.tools.uplps[a])&&(e.series[i].removePriceLine(e.tools.uplps[a]),e.series[i].removePriceLine(e.tools.uplps[n])),e.tools.uplps[a]={},e.tools.uplps[n]={},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:`${i}uplps`})}function Fe(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s?H():t.target.classList.add("selected")}function _e(t){x(),t.target.classList.remove("selected")}function H(){let t,s;const o=e.isCashDraw?"cash":"price",i=e.isCashDraw?"C":"P";p.isSet(e.tools.downlps[`${i}1`])?(t=+e.tools.downlps[`${i}1`].options().startTime,s=e.crosshair.time,x()):t=e.crosshair.time;const{value1:r,value2:a}=Ve(t,s);let n={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},d={isRemove:!1,symbol:l.symbol,name:`${o}downlps`,points:[],data:[]};n.startTime=t,n.price=r,n.title=`${i}1`,e.tools.downlps[n.title]=e.series[o].createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=a,n.title=`${i}2`,e.tools.downlps[n.title]=e.series[o].createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),c.dispatch("tradingStock/drawTools",d),O.value.classList.remove("selected")}function Ve(t,s){let o,i,r,a=0,n=0;const d=e.data[e.isCashDraw?"cash":"price"];for(let f=0;f<d.length;f++){const v=d[f].time;if(v<t)continue;if(s&&v>s)break;const u=d[f].value;if(o==null&&(o=u,i=u,r=u),u<r)a<n&&(i=r,n=a),r=u,a=0;else if(u>r){const b=+(r-u).toFixed(2);b<a&&(a=b)}if(u>o&&n<0)break}return{value1:+(i-n).toFixed(2),value2:+(r-n).toFixed(2)}}function x(t=!0,s=!1){const o=e.isCashDraw||s,i=o?"cash":"price",r=o?"C":"P",a=`${r}1`,n=`${r}2`;p.isSet(e.tools.downlps[a])&&(e.series[i].removePriceLine(e.tools.downlps[a]),e.series[i].removePriceLine(e.tools.downlps[n])),e.tools.downlps[a]={},e.tools.downlps[n]={},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:`${i}downlps`})}function Oe(t){t.target.classList.contains("selected")?(t.target.classList.remove("selected"),e.isCashDraw=!1):(t.target.classList.add("selected"),e.isCashDraw=!0)}function Be(t){e.isCashDraw=!1,t.target.classList.remove("selected")}function Ae(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s||(t.target.classList.add("selected"),z())}function Me(t){z(),t.target.classList.remove("selected")}function qe(){const t="rr",s=W(e.crosshair.y);let o={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},i={isRemove:!1,symbol:l.symbol,name:t,points:[],data:[]};if(p.isSet(e.tools.rr.EP)){const r=+e.tools.rr.EP.options().price;if(p.isSet(e.tools.rr.SL)){const n=+e.tools.rr.SL.options().price-r,d=s-r;if(d/n>0)return!1;const f=d/r*100;o.point="TP",o.title=`TP=${f.toFixed(1)}%`,o.color="lime",e.tools.rr[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o));const v=n/r*100,u=(e.fundSize*e.losePerOrder/Math.abs(v)/(r*1e3)).toFixed(0),b=Math.abs(d)/Math.abs(n),k="EP";e.tools.rr[k].applyOptions({title:`[V=${u}] RR=${b.toFixed(1)}`}),i.points.push(k),i.data.push(e.tools.rr[k].options()),B.value.classList.remove("selected")}else{const a=(s-r)/r*100;o.point="SL",o.title=`SL=${a.toFixed(1)}%`,o.color="red",e.tools.rr[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o))}}else o.point="EP",o.title="RR=",o.color="yellow",e.tools.rr[o.point]=e.series.price.createPriceLine(o),i.points.push(o.point),i.data.push(p.cloneDeep(o));c.dispatch("tradingStock/drawTools",i)}function z(t=!0){p.isSet(e.tools.rr.EP)&&(e.series.price.removePriceLine(e.tools.rr.EP),p.isSet(e.tools.rr.SL)&&(e.series.price.removePriceLine(e.tools.rr.SL),p.isSet(e.tools.rr.TP)&&e.series.price.removePriceLine(e.tools.rr.TP))),e.tools.rr={EP:{},SL:{},TP:{}},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"rr"})}function Ie(t){l.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),s||t.target.classList.add("selected")}function ze(t){Ke(),t.target.classList.remove("selected")}function We(){let t={isRemove:!1,symbol:"ALL",name:"range",points:[],data:[]},s={time:e.crosshair.time,value:1};e.tools.range.length>0?(s.color="red",e.tools.range[1]=s,t.points.push(1),A.value.classList.remove("selected")):(s.color="aqua",e.tools.range[0]=s,t.points.push(0)),e.series.range.setData(e.tools.range),t.data.push(s),c.dispatch("tradingStock/drawTools",t)}function Ke(){e.tools.range=[],e.series.range.setData([]),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:"ALL",name:"range"})}function Ne(t){t.target.classList.contains("selected")?(t.target.classList.remove("selected"),e.showNewsInfo=!1):(t.target.classList.add("selected"),e.showNewsInfo=!0)}function Ye(t){e.showNewsInfo=!1,t.target.classList.remove("selected")}function je(){if(e.showNewsInfo){const t=c.state.tradingStock.chart.events.find(s=>s.time==e.crosshair.time);if(p.isSet(t)){const s=t.title.split("|");let o=`
                <div>${m("trading.stock.date")} ${moment.unix(t.time).format("DD/MM/YYYY")}:</div>
                <div>&nbsp;</div>
                `;s.forEach(i=>{o+=`<div>${i}</div>`}),vt(o,m("trading.stock.event"))}}}function W(t,s="price"){return K(e.series[s].coordinateToPrice(t))}function K(t){return t?+ +t.toFixed(2):0}function Ue(t){if(!l.symbol)return!1;C()}function Xe(){l.dividendEnable=!l.dividendEnable,Je()}function He(){e.foreignEnable=!e.foreignEnable,C(!0)}function Ze(){C(!0,!0)}function Ge(){C(!0)}function Je(){c.dispatch("tradingStock/initChart",{symbol:l.symbol,from:M.value,to:q.value,timeframe:l.timeframe,vnindex:!0,dividend:l.dividendEnable,foreign:e.foreignEnable}).then(t=>{e.series.vnindex.setData(t.chart.vnindex),e.tools.range=t.range,e.series.range.setData(t.range),e.fundSize=t.fundSize,e.losePerOrder=t.losePerOrder})}function C(t=!1,s=!1){e.isOnlyLoadData=t,c.dispatch("tradingStock/getChartData",{symbol:l.symbol,from:M.value,to:q.value,timeframe:l.timeframe,vnindex:s,dividend:l.dividendEnable,foreign:e.foreignEnable}).then(o=>{s&&e.series.vnindex.setData(o)})}function Z(t){const s=c.state.tradingStock.symbols[l.symbolKind];let o=s.findIndex(i=>i==l.symbol);o=o==s.length-1?0:o+1,l.symbol=s[o]}function Qe(t){l.symbolKind=t.value}function et(t){l.chartShift=t.value,C(!1,!0)}function tt(){F(`${m("trading.stock.cloneSymbols")}?`,m("titles.confirm")).then(t=>{t&&c.dispatch("tradingStock/cloneSymbols")})}function ot(){F(`${m("trading.stock.deleteWatchList")}?`,m("titles.confirm")).then(t=>{t&&c.dispatch("tradingStock/deleteWatchlist")})}function st(t){e.tools.range.length==2?F(`${m("trading.stock.filterSymbols")}?`,m("titles.confirm")).then(s=>{if(s){const o={from:e.tools.range[0].time,to:e.tools.range[1].time,timeframe:l.timeframe,name:l.symbolKind,kind:t};c.dispatch("tradingStock/filterSymbols",o)}}):yt.error(m("trading.stock.rangeWarning"))}function it({itemData:t}){st(t.value)}return(t,s)=>{const o=mt("DxToolbar");return gt(),ft("div",wt,[D(o,{items:[{visible:t.$mf.isSet(t.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:t.$t("buttons.back"),onClick:()=>t.$router.go(-1)}},{location:"before",widget:"dxSelectBox",options:{width:"110px",showDropDownButton:!1,dataSource:l.symbolKinds,valueExpr:"value",displayExpr:"text",value:l.symbolKind,hint:t.$t("trading.stock.symbolKind"),onValueChanged:Qe}},{location:"before",widget:"dxSelectBox",options:{width:"30px",showDropDownButton:!1,dataSource:[0,1,2,3,4,5],value:l.chartShift,dropDownOptions:{wrapperAttr:{class:"stock-min-select-dropdown"}},hint:t.$t("trading.stock.chartShift"),onValueChanged:et}},{location:"after",widget:"dxButton",options:{icon:"far fa-list small",hint:t.$t("trading.stock.cloneSymbols"),onClick:tt}},{location:"after",widget:"dxButton",options:{icon:"far fa-folder-times small",hint:t.$t("trading.stock.deleteWatchList"),onClick:ot}},{location:"after",widget:"dxDropDownButton",options:{showArrowIcon:!1,items:l.filterItems,displayExpr:"text",keyExpr:"value",icon:"far fa-filter small",hint:t.$t("trading.stock.filterSymbols"),dropDownOptions:{width:"130px"},onItemClick:it}}]},null,8,["items"]),h("div",{class:"stock-container",ref_key:"chartContainerRef",ref:y,onClick:ce,onContextmenu:T},[h("div",{class:"chart-wrapper",ref_key:"chartRef",ref:N},[h("div",{class:"area data-area",onClick:T},[D(J(Q),{"data-source":ae.value,showDropDownButton:!1,"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:`command symbol-select ${ne.value} ${l.dividendEnable?"dividend-enable":""}`},modelValue:l.symbol,"onUpdate:modelValue":s[0]||(s[0]=i=>l.symbol=i),onValueChanged:Ue},null,8,["data-source","element-attr","modelValue"]),D(J(Q),{"data-source":["D","W","M"],showDropDownButton:!1,"element-attr":{class:"command"},dropDownOptions:{wrapperAttr:{class:"stock-min-select-dropdown"}},modelValue:l.timeframe,"onUpdate:modelValue":s[1]||(s[1]=i=>l.timeframe=i),onValueChanged:Ze},null,8,["modelValue"]),h("div",{class:"command",title:t.$t("trading.stock.reload"),onClick:Ge,onContextmenu:Z},[h("i",{class:E(`far fa-sync-alt ${t.$store.state.tradingStock.isChartLoading?"fa-spin":""}`)},null,2)],40,Ct),$(h("div",{class:E("command far fa-times"),title:t.$t("trading.stock.removeFilterList"),onClick:he},null,8,St),[[R,l.symbolKind.includes("f_")]]),$(h("div",{ref:"addWatchlistToolRef",class:E(`command far fa-${Y.value?"minus-circle":"plus-circle"}`),title:t.$t("trading.stock.addWatchlist"),onClick:j},null,10,Lt),[[R,!!l.symbol]])]),h("div",{class:"area tool-area",onClick:T},[h("div",{ref_key:"fullscreenToolRef",ref:oe,class:E(`command far fa-${l.isFullscreen?"compress":"expand"}`),title:t.$t("trading.stock.fullscreen"),onClick:ge,onContextmenu:Xe},null,42,Tt),h("div",{ref_key:"tradingviewRef",ref:se,class:"command far fa-chart-bar",title:t.$t("trading.stock.tradingview"),onClick:we,onContextmenu:He},null,40,Pt),h("div",{ref_key:"colorToolRef",ref:ie,class:"color command far fa-palette",style:ht({color:l.color}),title:t.$t("trading.stock.tools.color"),onClick:Ce},[$(D(bt,{class:"color-picker",modelValue:l.color,"onUpdate:modelValue":s[2]||(s[2]=i=>l.color=i)},null,8,["modelValue"]),[[R,l.showColorPicker]])],12,xt),h("div",{ref_key:"lineToolRef",ref:L,class:"command far fa-horizontal-rule",title:t.$t("trading.stock.tools.line"),onClick:Se,onContextmenu:Le},null,40,Dt),h("div",{ref_key:"uplpsToolRef",ref:V,class:"command far fa-arrow-up",title:t.$t("trading.stock.tools.uplps"),onClick:Ee,onContextmenu:$e},null,40,Et),h("div",{ref:"cashToolRef",class:"command drawless far fa-dot-circle",title:t.$t("trading.stock.tools.cash"),onClick:Oe,onContextmenu:Be},null,40,$t),h("div",{ref_key:"downlpsToolRef",ref:O,class:"command far fa-arrow-down",title:t.$t("trading.stock.tools.downlps"),onClick:Fe,onContextmenu:_e},null,40,Rt),h("div",{ref_key:"targetToolRef",ref:_,class:"command far fa-flag-checkered",title:t.$t("trading.stock.tools.target"),onClick:Pe,onContextmenu:xe},null,40,Ft),h("div",{ref_key:"rrToolRef",ref:B,class:"command far fa-line-height",title:t.$t("trading.stock.tools.rr"),onClick:Ae,onContextmenu:Me},null,40,_t),h("div",{ref_key:"rangeToolRef",ref:A,class:"command far fa-grip-lines-vertical",title:t.$t("trading.stock.tools.range"),onClick:Ie,onContextmenu:ze},null,40,Vt),h("div",{ref:"eventsToolRef",class:"command drawless far fa-map-marker-exclamation",title:t.$t("trading.stock.tools.events"),onClick:Ne,onContextmenu:Ye},null,40,Ot)]),$(h("iframe",{ref_key:"tradingviewChartRef",ref:le,class:"tradingview-chart",src:re.value},null,8,Bt),[[R,l.showTradingView]])],512)],544)])}}};export{Wt as default};
