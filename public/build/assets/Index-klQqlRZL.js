import{a3 as x,u as B,r as m,a as E,w as q,b as z,d as A,e as o,f as $,g as n,F as H,h as G,j as N,k as s,l as F,m as V,o as X,n as i}from"./app-D7isdMUg.js";import O from"./ContractConditionsPopup-IsudSPxq.js";import j from"./PayingContractPopup-DbjGI28K.js";import L from"./WithdrawingContractPopup-BABVEaTD.js";import{_ as U}from"./ContractDetailPopup-Bs2HLz1v.js";/* empty css            */import"./accordion-B7gp2s6S.js";import"./load-indicator-DNw4xHkM.js";import"./radio-group-PqqUfEt3.js";const _={class:"content-block dx-card responsive-paddings"},J={__name:"Index",setup(K){const r=G(),p=N(),{t:l}=B(),v=s("bus"),b=s("mt"),S=s("mc"),c=s("mf"),w=s("routeHistoryState"),a=m(null),h=m(null),g=m(null),d=E({gridData:null,validationRules:[{type:"required",message:l("models.contract.principal")+b.validations.required},{type:"custom",validationCallback:D,message:l("models.contract.validations.principal")}]});r.dispatch("userContract/getContracts").then(()=>{p.hash=="#conditions"&&showConditions()}),q(()=>r.state.userContract.contracts,t=>P(t));function y(t){v.emit("checkPin",()=>{r.dispatch("userContract/save",{changes:t.changes}).then(({isOk:u,type:f,contract:e})=>{u&&f=="insert"&&h.value.show(e)})})}function C(t){return t.row.data.status==1}function D(t){return t.value>=r.state.userContract.principalMin}function R(t){t.data.status=1,t.data.interest_rate=r.state.userContract.interestRate,t.data.paid_at=F(new Date,S.SERVER_DATE_FORMAT),a.value.instance.option("editing.popup.title",l("models.contract.popup.create"))}function k(t){a.value.instance.option("editing.popup.title",`${l("models.contract.popup.edit")} #${t.data.code}`)}function P(t){d.gridData=c.cloneDeep(t),p.query.code&&a.value.instance.columnOption("code","filterValues",[+p.query.code])}function I(t){c.checkPinDataGrid(t,a.value.instance),c.pushPopupToHistoryState(w,()=>a.value.instance.cancelEditData())}function T(){c.popRouteHistoryState(w)}function M(t){t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{icon:"help",type:"normal",hint:l("components.contractConditions.title"),onClick:()=>g.value.show()}})}return(t,u)=>{const f=V("DxToolbar");return X(),z(H,null,[A("div",_,[o(n(i.DxDataGrid),{ref_key:"dataGridRef",ref:a,"column-min-width":40,"data-source":d.gridData,"key-expr":"code","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:C,allowDeleting:C,confirmDelete:!1,mode:"popup",popup:{width:300,height:t.$screen.getScreenSizeInfo.isXSmall?250:210,fullScreen:!1,showTitle:!0,onShown:I,onHiding:T},form:{labelLocation:t.$screen.getScreenSizeInfo.isXSmall?"top":"left",items:[{dataField:"principal",colSpan:2}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:u[0]||(u[0]=e=>t.$mf.dataGridPreload(d.gridData,a.value.instance)),onInitNewRow:R,onEditingStart:k,onToolbarPreparing:M,onSaved:y},{commandCellTemplate:$(({data:e})=>[o(f,{items:[{visible:e.data.status<=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==0?"arrow-square-up":"receipt"}`,hint:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),text:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),onClick:()=>t.$refs.payingContractPopupRef.show(e.data)}},{visible:e.data.status==2,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"far fa-arrow-square-down",hint:t.$t("user.contract.withdrawContract"),text:t.$t("user.contract.withdrawContract"),onClick:()=>t.$refs.withdrawingContractPopupRef.show(e.data)}},{visible:e.data.status==3,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"undo",hint:t.$t("user.contract.unwithdrawContract"),text:t.$t("user.contract.unwithdrawContract"),onClick:()=>t.$bus.emit("checkPin",()=>t.$store.dispatch("userContract/withdrawingContract",{id:e.data.id,advance:0}))}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>a.value.instance.editRow(e.rowIndex)}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>a.value.instance.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key)&&e.data.status>=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopupRef.show(e.data)}}]},null,8,["items"])]),default:$(()=>[o(n(i.DxColumn),{fixed:!0,width:t.$screen.getScreenSizeInfo.isXSmall?35:98,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$screen.getScreenSizeInfo.isXSmall?"Short":""}`)},null,8,["width","caption"]),o(n(i.DxColumn),{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),o(n(i.DxColumn),{"allow-editing":!1,"data-field":"status",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),o(n(i.DxColumn),{name:"principal","data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":d.validationRules},null,8,["caption","validation-rules"]),o(n(i.DxColumn),{"allow-editing":!1,"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),caption:t.$t("models.contract.interestRate")},null,8,["format","caption"]),o(n(i.DxColumn),{"allow-editing":!1,name:"paidAt","data-field":"paid_at","data-type":"date",caption:t.$t("models.contract.paidAt")},null,8,["caption"]),o(n(i.DxColumn),{"allow-editing":!1,name:"withdrawnAt","data-field":"withdrawn_at","data-type":"date",caption:t.$t("models.contract.withdrawnAt")},null,8,["caption"])]),_:1},8,["data-source","editing","onCellPrepared"])]),o(O,{ref_key:"contractConditionsPopupRef",ref:g},null,512),o(j,{ref_key:"payingContractPopupRef",ref:h},null,512),o(L,{ref:"withdrawingContractPopupRef"},null,512),o(U,{ref:"contractDetailPopupRef"},null,512)],64)}}},it=x(J,[["__scopeId","data-v-a23cf6f6"]]);export{it as default};
