import{_ as c,a3 as h,R as b,bb as v,m as f,b as $,r as l,c as y,e as t,w as s,o as g,d as r,i as x}from"./app-9de7dadb.js";const k={components:{DxForm:h,DxItem:b,DxTextArea:v},data(){return{isLoading:!1,formData:null,banks:[],validationRules:{name:[{type:"required",message:this.$t("models.user.name")+this.$mt.validations.required},{type:"stringLength",max:50,message:this.$t("models.user.validations.name")}],sex:[{type:"required",message:this.$t("models.user.sex")+this.$mt.validations.required}],birthday:[{type:"required",message:this.$t("models.user.birthday")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateBirthday,message:this.$t("models.user.validations.birthday")}],idNumber:[{type:"required",message:this.$t("models.user.idNumber")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateIdNumber,message:this.$t("models.user.idNumber")+this.$mt.validations.duplicate}],idIssuedOn:[{type:"required",message:this.$t("models.user.idIssuedOn")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateIdIssuedOn,message:this.$t("models.user.validations.idIssuedOn")}],phone:[{type:"required",message:this.$t("models.user.phone")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicatePhone,message:this.$t("models.user.phone")+this.$mt.validations.duplicate}],email:[{type:"required",message:this.$t("models.user.email")+this.$mt.validations.required},{type:"email",message:this.$t("models.user.email")+this.$mt.validations.email},{type:"async",validationCallback:this.validateDuplicateEmail,message:this.$t("models.user.email")+this.$mt.validations.duplicate}],address:[{type:"required",message:this.$t("models.user.address")+this.$mt.validations.required},{type:"stringLength",max:100,message:this.$t("models.user.validations.address")}],bankAccount:{bankName:[{type:"required",message:this.$t("models.user.bankName")+this.$mt.validations.required}],accountName:[{type:"required",message:this.$t("models.user.accountName")+this.$mt.validations.required}],accountNumber:[{type:"required",message:this.$t("models.user.accountNumber")+this.$mt.validations.required},{type:"numeric",message:this.$t("models.user.accountNumber")+this.$mt.validations.numeric}]}}}},computed:{...f("User.profile",["profile"]),popup(){return this.$refs.popup.instance},form(){return this.$refs.form.instance}},methods:{...$("User.profile",["fetch","save","validateDuplicateEmail","validateDuplicateIdNumber","validateDuplicatePhone"]),show(){this.isLoading=!0,this.popup.show(),this.fetch().then(()=>{this.formData=this.$mf.cloneDeep(this.profile),setTimeout(()=>this.form.getEditor("name").focus(),500),this.$mf.getBanks().then(e=>this.banks=e),this.isLoading=!1}),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onSubmit(){this.$bus.emit("checkPin",()=>{this.save(this.formData).then(e=>{e&&this.popup.hide()})})},validateBirthday(e){return moment(e.value).isBefore(moment().subtract(18,"years"))},validateIdIssuedOn(e){return moment(e.value).isBefore(moment().subtract(1,"day"))},saveClick(){this.form.getButton("submit").element().click()}}},D={ref:"submit",class:"display-none"};function I(e,n,S,B,i,o){const a=l("DxItem"),d=l("DxForm"),u=l("DxLoadPanel"),m=l("DxPopup");return g(),y("div",null,[t(m,{ref:"popup",showCloseButton:!0,fullScreen:!!e.$screen.getScreenSizeInfo.isXSmall,"show-title":!0,title:e.$t("components.editProfile.title"),toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:()=>o.form.getButton("submit").element().click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>o.popup.hide()}}],onHiding:e.$mf.popRouteHistoryState},{content:s(()=>[r("form",{onSubmit:n[0]||(n[0]=x((...p)=>o.onSubmit&&o.onSubmit(...p),["prevent"]))},[r("button",D,null,512),t(d,{ref:"form",class:"profile-form","form-data":i.formData,labelMode:"floating","col-count":2,"label-location":e.$screen.getScreenSizeInfo.isXSmall?"top":"left","scrolling-enabled":!0},{default:s(()=>[t(a,{"item-type":"group",caption:e.$t("models.user.groups.personalInfo")},{default:s(()=>[t(a,{"data-field":"name","validation-rules":i.validationRules.name,label:{text:e.$t("models.user.name")}},null,8,["validation-rules","label"]),t(a,{"data-field":"sex","editor-type":"dxSelectBox","editor-options":{searchEnabled:!1,items:e.$mf.getSexList(),displayExpr:"name",valueExpr:"value",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":i.validationRules.sex,label:{text:e.$t("models.user.sex")}},null,8,["editor-options","validation-rules","label"]),t(a,{"data-field":"birthday","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":i.validationRules.birthday,label:{text:e.$t("models.user.birthday")}},null,8,["editor-options","validation-rules","label"])]),_:1},8,["caption"]),t(a,{"item-type":"group",caption:e.$t("models.user.groups.idInfo")},{default:s(()=>[t(a,{"data-field":"identity.number",editorOptions:{mask:"000000000000"},"validation-rules":i.validationRules.idNumber,label:{text:e.$t("models.user.idNumber")}},null,8,["validation-rules","label"]),t(a,{"data-field":"identity.issued_on","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":i.validationRules.idIssuedOn,label:{text:e.$t("models.user.idIssuedOn")}},null,8,["editor-options","validation-rules","label"]),t(a,{"data-field":"",editorOptions:{value:e.$mt.idIssuedAtValue,readOnly:!0},label:{text:e.$t("models.user.idIssuedAt")}},null,8,["editorOptions","label"])]),_:1},8,["caption"]),t(a,{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.contactInfo")},{default:s(()=>[t(a,{"data-field":"phone",editorOptions:{mask:"0000.000.000"},"validation-rules":i.validationRules.phone,label:{text:e.$t("models.user.phone")}},null,8,["validation-rules","label"]),t(a,{"data-field":"email","validation-rules":i.validationRules.email,label:{text:e.$t("models.user.email")}},null,8,["validation-rules","label"]),t(a,{"col-span":2,"data-field":"address","editor-type":"dxTextArea","validation-rules":i.validationRules.address,label:{text:e.$t("models.user.address")}},null,8,["validation-rules","label"])]),_:1},8,["caption"]),t(a,{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.bankInfo")},{default:s(()=>[t(a,{"data-field":"bank_account.bank_name","editor-type":"dxSelectBox","editor-options":{searchEnabled:!0,items:i.banks,displayExpr:"short_name",searchExpr:"short_name",valueExpr:"short_name",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":i.validationRules.bankAccount.bankName,label:{text:e.$t("models.user.bankName")}},null,8,["editor-options","validation-rules","label"]),t(a,{"data-field":"bank_account.account_number","validation-rules":i.validationRules.bankAccount.accountNumber,label:{text:e.$t("models.user.accountNumber")}},null,8,["validation-rules","label"]),t(a,{"data-field":"bank_account.account_name","editor-type":"dxTextBox","editor-options":{inputAttr:{style:"text-transform: uppercase"}},"validation-rules":i.validationRules.bankAccount.accountName,label:{text:e.$t("models.user.accountName")}},null,8,["validation-rules","label"])]),_:1},8,["caption"]),t(a,{name:"submit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}})]),_:1},8,["form-data","label-location"]),t(u,{position:{of:".profile-form"},visible:i.isLoading,shading:!1},null,8,["position","visible"])],32)]),_:1},8,["fullScreen","title","toolbarItems","onHiding"])])}const N=c(k,[["render",I]]);export{N as default};
