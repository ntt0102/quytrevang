import{g as x,aD as v,d as m,f as p,D as y,k as g,a as D,n as k}from"./app-f37d1114.js";import{m as c}from"./moment-53db9517.js";var i={};const F=x(v);/*!
 * devextreme-vue
 * Version: 21.2.13
 * Build date: Fri Apr 07 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var I=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0});i.DxItem=f=i.DxTabPanel=void 0;var _=I(F),S=p,$=p,b=S.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,animationEnabled:Boolean,dataSource:{},deferRendering:Boolean,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,itemHoldTimeout:Number,items:Array,itemTemplate:{},itemTitleTemplate:{},loop:Boolean,noDataText:String,onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onItemContextMenu:Function,onItemHold:Function,onItemRendered:Function,onOptionChanged:Function,onSelectionChanged:Function,onTitleClick:Function,onTitleHold:Function,onTitleRendered:Function,repaintChangesOnly:Boolean,rtlEnabled:Boolean,scrollByContent:Boolean,scrollingEnabled:Boolean,selectedIndex:Number,selectedItem:{},showNavButtons:Boolean,swipeEnabled:Boolean,tabIndex:Number,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animationEnabled":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:itemHoldTimeout":null,"update:items":null,"update:itemTemplate":null,"update:itemTitleTemplate":null,"update:loop":null,"update:noDataText":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onItemContextMenu":null,"update:onItemHold":null,"update:onItemRendered":null,"update:onOptionChanged":null,"update:onSelectionChanged":null,"update:onTitleClick":null,"update:onTitleHold":null,"update:onTitleRendered":null,"update:repaintChangesOnly":null,"update:rtlEnabled":null,"update:scrollByContent":null,"update:scrollingEnabled":null,"update:selectedIndex":null,"update:selectedItem":null,"update:showNavButtons":null,"update:swipeEnabled":null,"update:tabIndex":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=_.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}}}}),f=i.DxTabPanel=b,d=$.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:badge":null,"update:disabled":null,"update:html":null,"update:icon":null,"update:tabTemplate":null,"update:template":null,"update:text":null,"update:title":null,"update:visible":null},props:{badge:String,disabled:Boolean,html:String,icon:String,tabTemplate:{},template:{},text:String,title:String,visible:Boolean}});i.DxItem=d;d.$_optionName="items";d.$_isCollectionItem=!0;i.default=b;const T={components:{DxTabPanel:f,DxItem:y,DxForm:g},data(){return{finbooksName:[],formData:{type:"deposit"},validationRules:{money:[{type:"required",message:this.$t("components.transactionFinbook.money")+this.$mt.validations.required}],content:[{type:"required",message:this.$t("components.transactionFinbook.content")+this.$mt.validations.required}],receiverId:[{type:"required",message:this.$t("components.transactionFinbook.receiverId")+this.$mt.validations.required}]}}},created(){this.getFinbooksName().then(e=>this.finbooksName=e),this.initFormData()},destroyed(){},computed:{popup(){return this.$refs.popup.instance}},methods:{...D("Trading.finbooks",["updateBalance","getFinbooksName"]),show(e){this.popup.option("title",e.name),this.formData.id=e.id,this.popup.show(),this.setFocus(),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onSubmit(){console.log(this.formData),this.$bus.emit("checkPin",()=>this.updateBalance(this.formData).then(e=>{e&&this.popup.hide()}))},saveClick(){this.$refs[`${this.formData.type}Form`].instance.getButton(`${this.formData.type}Submit`).element().click()},setFocus(){setTimeout(()=>this.$refs[`${this.formData.type}Form`].instance.getEditor(`${this.formData.type}.${this.formData.type=="transfer"?"receiverId":"money"}`).focus(),500)},onHiding(){this.initFormData(),this.$mf.popRouteHistoryState()},tabPanelItem(e){return{title:this.$t(`components.transactionFinbook.${e}`),text:e,template:`${e}Template`}},initFormData(){let e={money:null,content:null};this.formData={...this.formData,deposit:{...e},withdraw:{...e},transfer:{...e,receiverId:null},adjustment:{...e}}},onTitleClick({itemData:{text:e}}){this.formData.type=e,this.setFocus()}}};var B=function(){var t=this,n=t._self._c;return n("DxPopup",{ref:"popup",attrs:{showCloseButton:!0,fullScreen:!!t.$devices.phone,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:()=>t.saveClick()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>t.popup.hide()}}]},on:{hiding:t.onHiding},scopedSlots:t._u([{key:"content",fn:function(){return[n("form",{staticClass:"transaction-finbook-popup",on:{submit:function(a){return a.preventDefault(),t.onSubmit.apply(null,arguments)}}},[n("DxTabPanel",{ref:"tabPanel",attrs:{loop:!1,"animation-enabled":!0,"swipe-enabled":!1,showNavButtons:!0,items:[t.tabPanelItem("deposit"),t.tabPanelItem("withdraw"),t.tabPanelItem("transfer"),t.tabPanelItem("adjustment")]},on:{titleClick:t.onTitleClick},scopedSlots:t._u([{key:"depositTemplate",fn:function(){return[n("DxForm",{ref:"depositForm",attrs:{"form-data":t.formData,"label-location":t.$devices.phone?"top":"left","scrolling-enabled":!0}},[n("DxItem",{attrs:{"data-field":"deposit.money","editor-type":"dxNumberBox","editor-options":{format:"#,##0 ₫"},"validation-rules":t.validationRules.money,label:{text:t.$t("components.transactionFinbook.money")}}}),n("DxItem",{attrs:{"data-field":"deposit.content","editor-type":"dxTextBox","validation-rules":t.validationRules.content,label:{text:t.$t("components.transactionFinbook.content")}}}),n("DxItem",{attrs:{name:"depositSubmit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}}})],1)]},proxy:!0},{key:"withdrawTemplate",fn:function(){return[n("DxForm",{ref:"withdrawForm",attrs:{"form-data":t.formData,"label-location":t.$devices.phone?"top":"left","scrolling-enabled":!0}},[n("DxItem",{attrs:{"data-field":"withdraw.money","editor-type":"dxNumberBox","editor-options":{format:"#,##0 ₫"},"validation-rules":t.validationRules.money,label:{text:t.$t("components.transactionFinbook.money")}}}),n("DxItem",{attrs:{"data-field":"withdraw.content","editor-type":"dxTextBox","validation-rules":t.validationRules.content,label:{text:t.$t("components.transactionFinbook.content")}}}),n("DxItem",{attrs:{name:"withdrawSubmit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}}})],1)]},proxy:!0},{key:"transferTemplate",fn:function(){return[n("DxForm",{ref:"transferForm",attrs:{"form-data":t.formData,"label-location":t.$devices.phone?"top":"left","scrolling-enabled":!0}},[n("DxItem",{attrs:{"data-field":"transfer.receiverId","editor-type":"dxSelectBox","editor-options":{searchEnabled:!0,items:t.finbooksName,displayExpr:"name",valueExpr:"id"},"validation-rules":t.validationRules.receiverId,label:{text:t.$t("components.transactionFinbook.receiverId")}}}),n("DxItem",{attrs:{"data-field":"transfer.money","editor-type":"dxNumberBox","editor-options":{format:"#,##0 ₫"},"validation-rules":t.validationRules.money,label:{text:t.$t("components.transactionFinbook.money")}}}),n("DxItem",{attrs:{"data-field":"transfer.content","editor-type":"dxTextBox","validation-rules":t.validationRules.content,label:{text:t.$t("components.transactionFinbook.content")}}}),n("DxItem",{attrs:{name:"transferSubmit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}}})],1)]},proxy:!0},{key:"adjustmentTemplate",fn:function(){return[n("DxForm",{ref:"adjustmentForm",attrs:{"form-data":t.formData,"label-location":t.$devices.phone?"top":"left","scrolling-enabled":!0}},[n("DxItem",{attrs:{"data-field":"adjustment.money","editor-type":"dxNumberBox","editor-options":{format:"#,##0 ₫"},"validation-rules":t.validationRules.money,label:{text:t.$t("components.transactionFinbook.money")}}}),n("DxItem",{attrs:{"data-field":"adjustment.content","editor-type":"dxTextBox","validation-rules":t.validationRules.content,label:{text:t.$t("components.transactionFinbook.content")}}}),n("DxItem",{attrs:{name:"adjustmentSubmit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}}})],1)]},proxy:!0}])})],1)]},proxy:!0}])})},C=[],w=k(T,B,C,!1,null,null,null,null);const A=w.exports;function h(){return{finbooks:[],updatedAt:null}}const P={finbooks:e=>e.finbooks},N={fetch({commit:e,dispatch:t,getters:n,state:a,rootGetters:u}){return c().diff(a.updatedAt,"seconds")<3?!1:new Promise((o,l)=>{axios.get("finbooks").then(s=>{e("setState",s.data),o()})})},save({commit:e,dispatch:t,getters:n,state:a,rootGetters:u},o){return new Promise((l,s)=>{axios.post("finbooks",o).then(r=>{l(),r.data.isOk&&t("fetch")})})},getFinbooksName({commit:e,dispatch:t,getters:n,state:a,rootGetters:u}){return new Promise((o,l)=>{axios.post("finbooks/name",null,{noLoading:!0}).then(s=>{o(s.data)})})},updateBalance({commit:e,dispatch:t,getters:n,state:a,rootGetters:u},o){return new Promise((l,s)=>{axios.post("finbooks/update-balance",o).then(r=>{l(r.data.isOk),r.data.isOk&&t("fetch")})})},resetState({commit:e}){e("resetState")}},E={setState(e,t){e.finbooks=t,e.updatedAt=c()},resetState(e){e=Object.assign(e,h())}},H={namespaced:!0,state:h,getters:P,actions:N,mutations:E};export{A as T,H as a};
