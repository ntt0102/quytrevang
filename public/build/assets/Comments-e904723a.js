import{m as c,a as l,n as u}from"./app-089c7b72.js";import{D as p,a as _}from"./data-grid-9e4dd793.js";import"./ui.data_grid.row_dragging-13991560.js";import"./dialog-e8748e84.js";function m(){return{comments:[],updatedAt:null}}const h={comments:t=>t.comments},f={fetch({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},o){return moment().diff(a.updatedAt,"seconds")<3?!1:new Promise((n,d)=>{axios.get("comments").then(r=>{t("setState",r.data),n()})})},markAsRead({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},o){return new Promise((n,d)=>{axios.post("comments",{id:o},{noLoading:!0}).then(r=>{n(),e("User.layout/initLayout",["comments"],{root:!0})})})},delete({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},o){return new Promise((n,d)=>{axios.post("comments/delete",{ids:o}).then(r=>{t("setState",r.data),n(),e("User.layout/initLayout",["comments"],{root:!0})})})},resetState({commit:t}){t("resetState")}},v={setState(t,e){t.comments=e,t.updatedAt=moment()},resetState(t){t=Object.assign(t,m())}},g={namespaced:!0,state:m,getters:h,actions:f,mutations:v};const C={components:{DxDataGrid:p,DxColumn:_},data(){return{gridData:null,selectedId:null}},beforeCreate(){this.$store.registerModule("Admin.comments",g)},created(){this.fetch()},destroyed(){this.$store.unregisterModule("Admin.comments")},computed:{...c("Admin.comments",["comments"]),dataGrid:function(){return this.$refs.dataGrid.instance}},watch:{comments(){this.cloneDeepData()}},methods:{...l("Admin.comments",["fetch","markAsRead","delete","resetState"]),onCellClick(t){t.columnIndex==0&&(this.selectedId=this.selectedId!=t.data.id?t.data.id:null,console.log(t),t.data.read!=1&&(t.data.read=1,this.markAsRead(t.data.id)))},onSave(t){this.delete(t.changes.map(({key:e})=>e)).then(()=>{this.$toasted.success(this.$mt.messages.success.saved)})},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.comments)}}};var D=function(){var e=this,s=e._self._c;return s("div",{staticClass:"comments-page"},[s("h2",{staticClass:"content-block"},[e._v(" "+e._s(e.$t("admin.comments.title"))+" ")]),s("div",{staticClass:"content-block dx-card responsive-paddings"},[s("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":e.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,mode:"batch"},showColumnHeaders:!1,showColumnLines:!0},on:{contentReady:function(a){return e.$mf.dataGridPreload(e.gridData,e.dataGrid)},cellClick:e.onCellClick,saved:e.onSave},scopedSlots:e._u([{key:"dataCellTemplate",fn:function({data:a}){return[s("div",{staticClass:"comment"},[s("div",{staticClass:"subject"},[s("span",{class:a.data.read?"mark":"unread"},[e._v(e._s(a.data.subject))]),a.data.url_images.length>0?s("i",{staticClass:"far fa-paperclip"}):e._e()]),s("div",{directives:[{name:"show",rawName:"v-show",value:a.data.id==e.selectedId,expression:"data.data.id == selectedId"}]},[s("div",{staticClass:"info"},[s("div",[s("em",[e._v(e._s(a.data.sent_at))])]),s("div",[s("b",[e._v(e._s(a.data.name))])]),s("div",[s("i",{staticClass:"dx-icon-tel"}),e._v(" "+e._s(e._f("phone")(a.data.phone))+" ")]),a.data.user_code?s("RouterLink",{attrs:{to:{name:"users",query:{code:a.data.user_code}}}},[e._v(e._s(e.$t("admin.comments.viewUser").replace("{code}",a.data.user_code)))]):e._e()],1),s("div",{staticClass:"content"},[e._v(" "+e._s(a.data.content)+" ")])])])]}}])},[s("DxColumn",{attrs:{"cell-template":"dataCellTemplate"}}),s("DxColumn",{attrs:{width:50,type:"buttons",buttons:[{name:"delete"}],alignment:"center"}})],1)],1)])},w=[],x=u(C,D,w,!1,null,null,null,null);const A=x.exports;export{A as default};
