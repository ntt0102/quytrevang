import{u as F,c as K,i as $,r as m,d as z,e as A,f as D,g as f,j as s,k as i,_ as O,n as p,p as w,F as Q,v as X,o as l,h as n,l as _,t as o,P as T,q as h,s as G}from"./app-a3cb7aa9.js";import{_ as P}from"./accordion-ca7dc3b3.js";import{D as Z}from"./load-indicator-149f38df.js";import{_ as J}from"./Index-74f24d3e.js";const Y=["onSubmit"],tt={class:"amount"},et=["innerHTML"],nt=["innerHTML"],at={class:"way1"},ot={class:"description text-darker"},st={class:"method"},lt={class:"method1"},ct={key:0},rt={class:"method2"},it={class:"text-darker"},dt={class:"download way2"},ut={class:"upload-browser"},mt={for:"receiptImage"},ft=n("i",{class:"far fa-file-upload"},null,-1),$t={__name:"WithdrawnContractPopup",setup(pt,{expose:R}){const V=F(),{t:v}=K(),q=$("bus"),B=$("mc"),y=$("mf"),d=m(null),g=m(null),b=m(null),u=m(null),e=z({refreshKey:0,contract:{},formData:{},qrSrc:null});let k=[];const C=A(()=>new Set(e.formData.documents.map(t=>t.file)));S();function U(t){d.value.setTitle(v(`components.withdrawnContract.${t.status==4?"withdrawnTitle":"title"}`)+" #"+t.code),d.value.show(),e.contract=t}function L(t){e.formData.documents=e.formData.documents.filter(a=>!a.isUpload),[...t.target.files].forEach(a=>e.formData.documents.push({file:URL.createObjectURL(a),isUpload:!0}))}function N(t){t.value?e.formData.documents=e.formData.documents.filter(a=>a.isUpload):e.formData.documents=k.concat(e.formData.documents)}function x(){!e.formData.isDelete&&u.value.files.length==0?X.info(v("messages.info.noChangedData")):b.value.click()}function M(){q.emit("checkPin",async()=>{let t=new FormData;t.append("contractId",e.contract.id),t.append("isDelete",e.formData.isDelete);for(var a=0;a<u.value.files.length;a++){let c=await y.resizeImage({file:u.value.files[a],maxSize:B.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${a}]`,c)}V.dispatch("adminContract/withdrawnContract",t).then(c=>{c&&d.value.hide()})})}function H(){let t=document.createElement("a");t.href=e.qrSrc,t.download=`vietQR_${e.contract.code}`,t.click()}function S(){e.formData={isPdfPreview:!1,isDelete:!1,documents:[]},e.qrSrc=null}function E(){setTimeout(()=>g.value.instance.option("selectedIndex",e.contract.status==3?0:1),500),k=e.contract.url_withdrawn_docs.map(a=>({file:a,isUpload:!1})),e.formData.documents=k;let t=`https://img.vietqr.io/image/${e.contract.bank_account.bank_name}-${e.contract.bank_account.account_number}-KRnx1D.jpg?accountName=${e.contract.bank_account.account_name}&amount=${e.contract.advance}&addInfo=${v("models.contract.transfer.contentValue",[e.contract.code])}`;y.fetchImage(t).then(a=>e.qrSrc=a)}function W(){S(),e.refreshKey++}return R({show:U}),(t,a)=>{const c=D("DxButton"),I=D("DxCheckBox"),j=D("DxScrollView");return l(),f(Q,null,[s(O,{ref_key:"popupRef",ref:d,class:"withdrawn-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:x}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>d.value.hide()}}],onShown:E,onHidden:W},{default:i(()=>[s(j,null,{default:i(()=>[n("form",{onSubmit:G(M,["prevent"])},[n("button",{ref_key:"submitRef",ref:b,class:"display-none"},null,512),n("div",tt,[n("div",{class:"text-dark",innerHTML:t.$t("components.withdrawnContract.amount",[t.$filters.currency(e.contract.advance),t.$filters.currency(e.contract.total)])},null,8,et),e.contract.advance<e.contract.total?(l(),f("div",{key:0,class:"text-dark",innerHTML:t.$t("components.withdrawnContract.surplus",[t.$filters.currency(e.contract.total-e.contract.advance)])},null,8,nt)):w("",!0)]),s(_(P),{ref_key:"accordionRef",ref:g,collapsible:!0,items:[{title:t.$t("components.withdrawnContract.step1"),template:"step1Template"},{title:t.$t("components.withdrawnContract.step2"),template:"step2Template"}]},{step1Template:i(()=>[s(_(P),{collapsible:!0,items:[{title:t.$t("components.withdrawnContract.withdrawnWay1"),template:"way1Template"},{title:t.$t("components.withdrawnContract.withdrawnWay2"),template:"way2Template"}]},{way1Template:i(()=>[n("div",at,[n("div",ot,o(t.$t("models.contract.transfer.qrCode")),1),n("div",st,[n("div",lt,[e.qrSrc?(l(),f("div",ct,[s(T,{images:[e.qrSrc]},null,8,["images"]),s(c,{class:"download-qr",text:t.$t("buttons.qrDownload"),icon:"download",type:"default","styling-mode":"text",onClick:H},null,8,["text"])])):(l(),p(_(Z),{key:1,height:40,width:40}))]),n("div",rt,[n("div",null,[n("span",null,o(t.$t("models.user.bankName"))+":",1),n("span",null,o(e.contract.bank_account.bank_name),1)]),n("div",null,[n("span",null,o(t.$t("models.user.accountName"))+":",1),n("span",null,o(e.contract.bank_account.account_name),1)]),n("div",null,[n("span",null,o(t.$t("models.user.accountNumber"))+":",1),n("span",null,[h(o(e.contract.bank_account.account_number)+" ",1),n("i",{class:"far fa-copy",onClick:a[0]||(a[0]=r=>t.$mf.copyText(e.contract.bank_account.account_number))})])]),n("div",null,[n("span",null,o(t.$t("models.contract.transfer.amount"))+":",1),n("span",null,[h(o(t.$filters.currency(e.contract.advance))+" ",1),n("i",{class:"far fa-copy",onClick:a[1]||(a[1]=r=>t.$mf.copyText(e.contract.advance))})])]),n("div",null,[n("span",null,o(t.$t("models.contract.transfer.content"))+":",1),n("span",null,[h(o(t.$t("models.contract.transfer.contentValue",[e.contract.code]))+" ",1),n("i",{class:"far fa-copy",onClick:a[2]||(a[2]=r=>t.$mf.copyText(t.$t("models.contract.transfer.contentValue",[e.contract.code])))})])]),n("div",it,o(t.$t("models.contract.transfer.note")),1)])])])]),way2Template:i(()=>[n("div",dt,[s(c,{text:t.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:a[3]||(a[3]=()=>t.$refs.pdfRef.download({component:"WithdrawReceiptPdf",contract:e.contract,isPreview:e.formData.isPdfPreview}))},null,8,["text"]),t.$screen.getScreenSizeInfo.isXSmall?w("",!0):(l(),p(I,{key:0,modelValue:e.formData.isPdfPreview,"onUpdate:modelValue":a[4]||(a[4]=r=>e.formData.isPdfPreview=r),text:t.$t("components.withdrawnContract.preview")},null,8,["modelValue","text"]))])]),_:1},8,["items"])]),step2Template:i(()=>[(l(),f("div",{class:"upload",key:e.refreshKey},[n("div",ut,[n("input",{ref_key:"receiptImageRef",ref:u,type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:L},null,544),n("label",mt,[ft,h(" "+o(t.$t("titles.chooseImage")),1)]),s(I,{id:"contractDelete",modelValue:e.formData.isDelete,"onUpdate:modelValue":a[5]||(a[5]=r=>e.formData.isDelete=r),text:t.$t("titles.deleteOldImage"),onValueChanged:N},null,8,["modelValue","text"])]),C.value.length?(l(),p(T,{key:0,images:C.value},null,8,["images"])):w("",!0)]))]),_:1},8,["items"])],40,Y)]),_:1})]),_:1},8,["toolbarItems"]),t.$mf.isSet(e.contract)?(l(),p(J,{key:0,ref:"pdfRef"},null,512)):w("",!0)],64)}}};export{$t as default};
