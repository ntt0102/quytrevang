import{A as Kt,B as ei,C as ti,l as ve,u as ii,r as C,a as ri,c as H,y as oi,E as si,w as Ne,x as w,b as ni,d as m,e as me,G as I,t as Xe,H as te,I as ai,J as ge,K as li,F as ci,h as di,j as pi,k as he,z as ze,L as ui,m as fi,o as vi}from"./app-f1e7f9da.js";import mi from"./LineContext-fe03c456.js";import gi from"./ScanContext-2b55b64d.js";import hi from"./VpsOtpPopup-4c7603ba.js";import{c as yi}from"./lightweight-charts.esm.development-03366bac.js";import{g as T}from"./getUnixTime-48368e5e.js";import"./text-box-2114bc63.js";function xi(q,Q,k){return Kt((k==null?void 0:k.in)||q,+ei(q)+Q)}function Fe(q,Q,k){return xi(q,Q*ti,k)}const Si={class:"content-block dx-card responsive-paddings"},Ci=["title"],wi=["title"],Ti=["title"],ki=["title"],Fi=["title"],bi=["title"],Di=["title"],Oi=["title"],Li=["title"],Ri=m("i",{class:"far fa-heart-rate"},null,-1),Ai=[Ri],Pi=["title"],Ei=m("i",{class:"far fa-horizontal-rule"},null,-1),Vi=["title"],_i=m("i",{class:"far fa-grip-lines-vertical"},null,-1),$i=[_i],Ii=["title"],Mi=m("i",{class:"far fa-line-height"},null,-1),Bi=[Mi],Wi=["title"],Zi=["src"],Je=3,je=2,Yi="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",Qi={__name:"Index",setup(q){const Q={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},k=ve(new Date,"yyyy-MM-dd"),F={START:T(new Date(`${k}T08:45:00Z`)),ATO:T(new Date(`${k}T09:00:00Z`)),ATC:T(new Date(`${k}T14:30:00Z`)),END:T(new Date(`${k}T14:45:00Z`))},u=di(),be=pi(),{t:y}=ii(),He=he("devices"),v=he("mf"),ye=he("bus"),ie=he("filters"),R=C(null),De=C(null),qe=C(null),Qe=C(null),Ue=C(null),Ge=C(null),Ke=C(null),re=C(null),xe=C(null),Se=C(null),oe=C(null),Ce=C(null),et=C(null),B=C(null),U=C(null),Oe=C(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:T(Fe(new Date,7))};G();const d=ri({chartDate:be.query.date??k,clock:ve(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,isAutoScan:!1,lineColor:"#F44336",lineTitle:"",progress:0,scanSide:"left",showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),b=H(()=>u.state.tradingDerivative.status),A=H(()=>u.state.tradingDerivative.config),Le=H(()=>u.state.tradingDerivative.tools),tt=H(()=>u.state.tradingDerivative.isChartLoading),it=H(()=>b.value.position!=0||!!b.value.pending||!!Le.value.order),rt=H(()=>`https://chart.vps.com.vn/tv/?u=${A.value.vpsUser}&s=${A.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);u.dispatch("tradingDerivative/initChart").then(()=>{M()&&we(),!be.query.date&&A.value.lastOpeningDate&&(d.chartDate=A.value.lastOpeningDate),u.dispatch("tradingDerivative/getChartData",d.chartDate).then(i=>{i&&j()})}),e.interval=setInterval(ft,1e3),e.interval60=setInterval(()=>{M()?(Ze(),A.value.autoScan&&j()):clearInterval(e.interval60)},6e4),oi(()=>{e.chart=yi(De.value,Q),e.chart.subscribeCrosshairMove(nt),e.chart.subscribeCustomPriceLineDragged(at),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(lt).observe(R.value),document.addEventListener("keydown",Pe),document.addEventListener("fullscreenchange",Ee)}),si(()=>{e.chart&&(e.chart.remove(),e.chart=null),document.removeEventListener("keydown",Pe),document.removeEventListener("fullscreenchange",Ee),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),Ne(()=>u.state.tradingDerivative.chartData,pt),Ne(()=>Le.value,dt);function ot(i){d.showPatternContext=!1,d.showScanContext=!1,d.showLineContext=!1,de(!1),re.value.classList.contains("selected")?Et():Se.value.classList.contains("selected")?It():oe.value.classList.contains("selected")?Lt():Ce.value.classList.contains("selected")?xt():xe.value.classList.contains("selected")&&Ft()}function st(i){de(!0),i.preventDefault()}function Re(i){i.stopPropagation()}function Ae(i){i.preventDefault(),i.stopPropagation()}function nt(i){if(i.time){let r=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=r}else He.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function at(i){let r=i.customPriceLine,t=r.options();t.price=parseFloat(t.price.toFixed(1));const o=+i.fromPriceString,s=t.price;switch(t.lineType){case"order":if(s!=o){let l=!1;t.kind=="entry"?b.value.position||(l=!0,e.tools.order[t.kind].price=s,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(c=>{c.isOk?(X([t.kind]),w.success(y("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:o}),D(c.message))})):(l=!0,e.tools.order[t.kind].price=s,t.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(c=>{c.isOk?(X([t.kind]),w.success(y("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:o}),D(c.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(c=>{c.isOk?(X([t.kind]),w.success(y("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:o}),D(c.message))})),l||(r.applyOptions({price:o}),w.show(y("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o});const n=t.color,a=t.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[s],data:[{color:n,title:a}]}),re.value.classList.remove("selected");break;case"target":if(v.isSet(e.tools.target.B)){let l={isRemove:!1,name:"target",points:[],data:[]},c,p,f=+e.tools.target.A.options().price,h=+e.tools.target.B.options().price,g=h-f;if(c="A",t.point=="A")g=+e.tools.target.B.options().title,h=f+g;else if(t.point!="B"){let x=0;switch(t.point){case"X":x=1.5;break;case"Y":x=2;break;case"Z":x=3;break;case"W":x=5;break}g=parseFloat(((h-s)/x).toFixed(1)),f=h-g,p={price:f},e.tools.target[c].applyOptions(p)}l.points.push(c),l.data.push(f),c="B",p={price:h,title:g.toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),l.points.push(c),l.data.push(h),c="X",p={price:parseFloat((f-.5*g).toFixed(1)),title:(-.5*g).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="Y",p={price:parseFloat((f-g).toFixed(1)),title:(-g).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="Z",p={price:parseFloat((f-2*g).toFixed(1)),title:(-2*g).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="W",p={price:parseFloat((f-4*g).toFixed(1)),title:(-4*g).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),u.dispatch("tradingDerivative/drawTools",l)}break;case"pattern":if(v.isSet(e.tools.pattern.B)){let l,c;const p=e.tools.pattern.A.options(),f=e.tools.pattern.B.options(),h=e.tools.pattern.C.options(),g={A:{time:+p.time,price:+p.price},B:{price:+f.price},C:{price:+h.price}},{progress:x,timeMark:E,info:{et1:V,et2:O,et3:L,ep1:_,ep2:W,ep3:Z,entry:Y,prValid:N,x:$,X:K,y:ee,Y:fe}}=ne(g);ce(x),le(E),J(g),l="A",c={title:`A ${V}/${_}`},e.tools.pattern[l].applyOptions(c),l="B",c={title:`B ${O}/${W}`},e.tools.pattern[l].applyOptions(c),l="C",c={title:`C ${L}/${Z}`},e.tools.pattern[l].applyOptions(c),l="D",c={price:Y,title:"Entry "+N},t.point==l&&delete c.price,e.tools.pattern[l].applyOptions(c),l="X",c={price:parseFloat($.toFixed(1)),title:"X "+parseFloat(K.toFixed(1))},e.tools.pattern[l].applyOptions(c),l="Y",c={price:parseFloat(ee.toFixed(1)),title:"Y "+parseFloat(fe.toFixed(1))},e.tools.pattern[l].applyOptions(c)}break}}function lt(){R.value&&(e.chart.resize(R.value.offsetWidth,R.value.offsetHeight),R.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Pe(i){if(i.ctrlKey)switch(i.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(i.altKey)switch(i.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function Ee(){R.value&&(document.fullscreenElement?(d.isFullscreen=!0,R.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(d.isFullscreen=!1,R.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function ct(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function dt(i){Bt(),Object.entries(i).forEach(([r,t])=>{switch(r){case"order":vt(t);break;case"pattern":$e(i.pattern,!0);break;case"tr":Rt(Object.values(t));break;case"line":Vt(t);break;case"target":Mt(t);break}})}function pt(i){d.chartDate==k&&M()||(i.price.length>0&&(e.data.whitespace=se(e.data.whitespace,_e(d.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=se(e.data.price,i.price),e.series.price.setData(e.data.price))}function Ve(i){let r=[];i.forEach(t=>{const o=T(Fe(new Date(t.date),7));r.push({time:o,value:t.price})}),r.length>1?(e.data.price=se(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function _e(i){const r=T(new Date(`${i}T09:00:00Z`)),t=T(new Date(`${i}T11:30:00Z`)),o=T(new Date(`${i}T13:00:00Z`)),s=T(new Date(`${i}T14:30:00Z`)),n=T(new Date(`${i}T14:00:00Z`));let a=[];for(let l=r;l<=s;l++){if(l>t&&l<o)continue;let c={time:l};(l==n||l==s)&&(c.value=1),a.push(c)}return a}function se(i,r){return Array.from(new Map([...i,...r].sort((t,o)=>t.time-o.time).map(t=>[t.time,t])).values())}function we(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(Yi),e.websocket.onopen=i=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=i=>{!e.socketStop&&M()&&(d.isSocketWarning=!0,we())},e.websocket.onmessage=i=>{d.isSocketWarning=!1,ut(i.data).forEach(t=>{if(!t)return!1;t.type==3?(j(),e.data.whitespace=se(e.data.whitespace,_e(k)),e.series.whitespace.setData(e.data.whitespace),Ve(t.result),u.dispatch("tradingDerivative/setChartLoading",!1)):t.type==1&&t.target=="UpdateTrades"&&t.arguments[0]=="VN30F1M"&&(Nt(t.arguments[1].at(-1).price),Ve(t.arguments[1]))})}}function ut(i){let r=[];return i.split("").forEach(t=>{const o=t.indexOf("{"),s=t.lastIndexOf("}");let n=null;if(o!==-1&&s!==-1&&s>o){const a=t.substring(o,s+1);a!="{}"&&(n=JSON.parse(a))}r.push(n)}),r}function ft(){e.currentSeconds=T(Fe(new Date,7)),M()&&(b.value.position&&e.currentSeconds>F.ATC-5*60&&(d.isOrderWarning=!0,e.currentSeconds>F.ATC-15&&v.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(i=>{i.isOk?(z(["entry","tp","sl"]),w.success(y("trading.derivative.autoCancelTpSlSuccess"))):D(i.message)})),A.value.openingMarket&&e.currentSeconds==F.START&&we()),d.clock=ve(new Date,"HH:mm:ss")}function X(i){const r="order";let t={isRemove:!1,name:r,points:[],data:[]},o,s;i.forEach(n=>{switch(n){case"entry":o="yellow",s=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",s=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",s=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(t.points.push(n),v.isSet(e.tools.order[n].line))e.tools.order[n].line.applyOptions({price:e.tools.order[n].price,title:s}),t.data.push(e.tools.order[n].line.options());else{const a={lineType:r,kind:n,side:e.tools.order.side,price:e.tools.order[n].price,color:o,lineWidth:1,lineStyle:0,title:s,draggable:!0};e.tools.order[n].line=e.series.price.createPriceLine(a),t.data.push(a)}}),u.dispatch("tradingDerivative/drawTools",t)}function vt(i){Object.entries(i).forEach(([r,t])=>{e.tools.order.side=t.side,e.tools.order[r].price=t.price,e.tools.order[r].line=e.series.price.createPriceLine(t)})}function z(i,r=!0){r&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),i.forEach(t=>{v.isSet(e.tools.order[t].line)&&(e.series.price.removePriceLine(e.tools.order[t].line),delete e.tools.order[t].line)})}function mt(i){d.showTradingView=!d.showTradingView,i.stopPropagation()}function gt(i){d.showScanContext=!1,d.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(ae(),J(),i.target.classList.add("selected"))}function ht(){d.showScanContext=!d.showScanContext,d.showLineContext=!1}function yt(){u.dispatch("tradingDerivative/setAutoScan",!A.value.autoScan)}function xt(){const i=d.scanSide=="left",r=e.crosshair.time?e.data.price.filter(o=>!S(o.time,i,e.crosshair.time)):e.data.price;let t=i?St(r):Ct(r);t=wt(t),v.isSet(t)&&(ae(),$e(t),J(t)),Ce.value.classList.remove("selected")}function St(i){let r,[t,o,s,n]=Array(4).fill({});for(let a=i.length-1;a>=0;a--){const l=i[a].value,c=i[a].time,p=P(c);if(p==-1)break;if(a==i.length-1&&(s={index:p,time:c,price:l},[o,t,n]=Array(3).fill(null).map(()=>v.cloneDeep(s))),r==null){if(l==s.price)continue;r=l>s.price}if(S(l,r,o.price)&&(S(t.price,!r,s.price)?([s,o]=[o,t].map(f=>v.cloneDeep(f)),t={index:p,time:c,price:l},n=v.cloneDeep(t),r=!r):o={index:p,time:c,price:l}),S(l,!r,t.price)?(t={index:p,time:c,price:l},n=v.cloneDeep(t)):n.index=p,S(l,r,n.price)&&(n={index:p,time:c,price:l}),s.index>t.index){const f=Math.abs(o.price-s.price);if(f>=1.5&&(t.index-n.index>s.index-o.index||Math.abs(t.price-n.price)>f))break}}return{A:t,B:o,C:s}}function Ct(i){let r,[t,o,s]=Array(3).fill({});for(let n=0;n<i.length;n++){const a=i[n].value,l=i[n].time,c=P(l);if(c==-1)break;if(n==0&&(t={index:c,time:l,price:a},o=v.cloneDeep(t),s=v.cloneDeep(t)),r==null){if(a==t.price)continue;r=a>t.price}S(a,r,o.price)&&(o={index:c,time:l,price:a},s=v.cloneDeep(o)),S(o.price,r,t.price)&&S(a,!r,s.price)&&(S(a,r,t.price)?s={index:c,time:l,price:a}:(t=v.cloneDeep(o),o={index:c,time:l,price:a},s=v.cloneDeep(o),r=!r))}return{A:t,B:o,C:s}}function wt(i){const r={};return Object.entries(i).forEach(([t,o])=>{const{index:s,...n}=o;r[t]=n}),r}function Tt(i){d.showScanContext=!1,d.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function kt(i){i.target.classList.remove("selected"),ae(),J()}function Ft(){const i="pattern",r=pe(e.crosshair.y),t=e.crosshair.time;let o={lineType:i,price:r,lineWidth:1,lineStyle:0,draggable:!0};if(v.isSet(e.tools.pattern.A)){const s=e.tools.pattern.A.options();if(v.isSet(e.tools.pattern.B)){const n=e.tools.pattern.B.options();let a,l,c;if(v.isSet(e.tools.pattern.C)){let p,f;const h=e.tools.pattern.C.options();a={A:{time:t,price:r},B:{price:+n.price},C:{price:+h.price}};const{progress:g,timeMark:x,info:{et1:E,et2:V,et3:O,ep1:L,ep2:_,ep3:W,entry:Z,prValid:Y,x:N,X:$,y:K,Y:ee}}=ne(a);c=g,l=x,p="A",f={price:r,time:t,title:`A ${E}/${L}`},e.tools.pattern[p].applyOptions(f),p="B",f={title:`B ${V}/${_}`},e.tools.pattern[p].applyOptions(f),p="C",f={title:`C ${O}/${W}`},e.tools.pattern[p].applyOptions(f),p="D",f={price:Z,title:"Entry "+Y},e.tools.pattern[p].applyOptions(f),p="X",f={price:parseFloat(N.toFixed(1)),title:"X "+parseFloat($.toFixed(1))},e.tools.pattern[p].applyOptions(f),p="Y",f={price:parseFloat(K.toFixed(1)),title:"Y "+parseFloat(ee.toFixed(1))},e.tools.pattern[p].applyOptions(f)}else{a={A:{time:+s.time,price:+s.price},B:{price:+n.price},C:{price:r}};const{progress:p,timeMark:f,info:{et1:h,et2:g,et3:x,ep1:E,ep2:V,ep3:O,entry:L,prValid:_,x:W,X:Z,y:Y,Y:N}}=ne(a);c=p,l=f;let $="A";e.tools.pattern[$].applyOptions({title:`A ${h}/${E}`}),$="B",e.tools.pattern[$].applyOptions({title:`B ${g}/${V}`}),o.point="C",o.title=`C ${x}/${O}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=L,o.title="Entry "+_,o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat(Y.toFixed(1)),o.title="Y "+parseFloat(N.toFixed(1)),o.color="#E91E63",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat(W.toFixed(1)),o.title="X "+parseFloat(Z.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}ce(c),le(l),J(a),xe.value.classList.remove("selected")}else o.point="B",o.title="B 0",o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}else o.point="A",o.title="A 0",o.color="#F44336",o.time=t,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function $e(i,r=!1){const t=r?bt(v.cloneDeep(i)):i;let s={lineType:"pattern",lineWidth:1,lineStyle:0,draggable:!0};const{progress:n,timeMark:a,info:{et1:l,et2:c,et3:p,ep1:f,ep2:h,ep3:g,entry:x,prValid:E,x:V,X:O,y:L,Y:_}}=ne(t);ce(n),le(a),s.point="A",s.title=`A ${l}/${f}`,s.color="#F44336",s.price=t.A.price,s.time=t.A.time,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="B",s.title=`B ${c}/${h}`,s.color="#4CAF50",s.price=t.B.price,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="C",s.price=t.C.price,s.title=`C ${p}/${g}`,s.color="#FF9800",e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="D",s.price=x,s.title="Entry "+E,s.color="#9C27B0",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="Y",s.price=parseFloat(L.toFixed(1)),s.title="Y "+parseFloat(_.toFixed(1)),s.color="#E91E63",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="X",s.price=parseFloat(V.toFixed(1)),s.title="X "+parseFloat(O.toFixed(1)),s.color="#2196F3",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s)}function ne(i){const r=Te(i.A,i.B),t=Te(r.R,i.C),o=r.R1.price,s=i.B.price,n=s-o,a=Te(t.R,{price:s+n},i.B.price),l=i.B.price-i.C.price,c=l>0,p=Math.abs(l)>r.pr,f=Math.abs(i.C.price-a.R2.price)>t.pr,h=Math.abs(a.R2.price-a.S2.price)>a.pr,g=(p?"1":"0")+(f?"1":"0")+(h?"1":"0"),x=a.S2.index-r.R.index>r.tr,E=a.S2.index-t.R.index>t.tr,V=a.S2.index-a.R2.index>a.tr;let O=r.R1.price,L=0;Math.abs(n)>=1.5&&r.et<1&&p&&x&&S(i.C.price,c,r.S1.price)&&(E?f&&h&&V&&S(a.S2.price,c,a.S1.price)&&(O=a.R2.price,L=2):(O=t.S1.price,L=1));const _=[r.R.index+r.tr,t.R.index+t.tr,a.R2.index+a.tr],W=parseFloat(r.et.toFixed(1)),Z=parseFloat(t.et.toFixed(1)),Y=parseFloat(a.et.toFixed(1)),N=parseFloat(r.ep.toFixed(1)),$=parseFloat(t.ep.toFixed(1)),K=parseFloat(a.ep.toFixed(1)),ee=Ie(s+n,c),fe=parseInt((a.breakIndex-r.R.index)/r.tr),Ye=fe>1?n*fe:n,Gt=Ie(s+Ye,c);return{progress:L,timeMark:_,info:{et1:W,et2:Z,et3:Y,ep1:N,ep2:$,ep3:K,entry:O,prValid:g,x:ee,X:n,y:Gt,Y:Ye}}}function Te(i,r,t=null){let o=v.cloneDeep(i),s=v.cloneDeep(r);const n=s.price>o.price;let a={},l={},c=0;return e.data.price.filter(p=>p.time>=o.time).every((p,f)=>{const h=p.value,g=p.time,x=P(g);return x==-1?!1:((f==0||h==o.price)&&(a={R:{index:x,time:g,price:h},S:{index:x,time:g,price:h},pr:0,tr:0},l=a),S(h,n,a.R.price)?(Math.abs(a.R.price-l.R.price)==.1&&(l.S.index=a.S.index,l.tr=l.S.index-l.R.index),a.tr>=l.tr&&a.pr>=l.pr&&(l=a),a={R:{index:x,time:g,price:h},S:{index:x,time:g,price:h},pr:0,tr:0},t&&!S(h,n,t)&&(c=x)):(a.S.index=x,a.tr=a.S.index-a.R.index,S(h,!n,a.S.price)&&(a.S.time=g,a.S.price=h,a.pr=Math.abs(a.S.price-a.R.price))),S(h,!n,o.price)?(a.S.price=o.price,!1):!!S(h,!n,s.price))}),s.index=a.S.index,s.time=ue(a.S.index),{tr:l.tr,pr:l.pr,et:(s.index-l.S.index)/l.tr,ep:Math.abs(s.price-l.R.price)/l.pr,S1:l.S,R1:l.R,S2:a.S,R2:a.R,S:o,R:s,breakIndex:c}}function Ie(i,r){let t=parseFloat((i%1).toFixed(1));if(r){if(t>=.1&&t<=.2)return Math.floor(i);if(t>=.6&&t<=.7)return Math.floor(i)+.5}else{if(t>=.8&&t<=.9)return Math.ceil(i);if(t>=.3&&t<=.4)return Math.floor(i)+.5}return i}function bt(i){const r=i.B.price-i.A.price,t=e.data.price.at(-1).price;if(S(t,!r,i.C.price)){let o=t;for(let s=e.data.price.length-1;s>=0;s--){const{price:n}=array[s];if(n===i.C.price)break;o=r?Math.min(o,n):Math.max(o,n)}i.C.price=o}return J(i),i}function J(i={}){let r=!v.isSet(i),t={isRemove:r,name:"pattern",points:[],data:[]};r||Object.entries(i).forEach(([o,s])=>{t.points.push(o),t.data.push(s)}),u.dispatch("tradingDerivative/drawTools",t)}function ae(){v.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),v.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),v.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y)))),G(["pattern"]),le([]),ce(0)}function le(i){const r=["#F44336","#4CAF50","#FF9800"];let t=[];for(let o=0;o<i.length;o++)t.push({time:ue(i[o]),value:1,color:r[o]});t.length&&t.sort((o,s)=>o.time-s.time),e.series.timeMark.setData(t)}function ce(i){d.progress=i}function Dt(i){d.showScanContext=!1,d.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Ot(i){Me(),i.target.classList.remove("selected")}function Lt(){let i={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let t={time:r,value:1};switch(e.tools.timeRange.length){case 0:t.color="OrangeRed",e.tools.timeRange[0]=t,i.points.push(0),i.data.push(r);break;case 1:t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(r),oe.value.classList.remove("selected");break;default:const o=P(e.tools.timeRange[0].time),s=P(e.tools.timeRange[1].time),a=P(r)+(s-o),l=ue(a);t.color="OrangeRed",e.tools.timeRange[0]=v.cloneDeep(t),i.points.push(0),i.data.push(r),t.time=l,t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(l),oe.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",i)}function Rt(i){let r,t;if(i.length==2)r=i[0],t=i[1];else if(i.length==3){const s=P(i[0]),n=P(i[1]),l=P(i[2])+(n-s);r=i[2],t=ue(l)}else return!1;let o=[{time:r,value:1,color:"OrangeRed"},{time:t,value:1,color:"lime"}];e.tools.timeRange=o,e.series.timeRange.setData(o)}function Me(i=!0,r=!1){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),r||(e.series.timeRange.setData([]),G(["tr"]))}function At(i){d.showScanContext=!1,d.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Pt(i){d.showLineContext=!d.showLineContext,d.showScanContext=!1}function Et(){const i="line",r=pe(e.crosshair.y),t=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const s=o.options(),n=s.type=r==+s.price;return n&&(e.series.price.removePriceLine(o),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:i,point:r})),!n}),e.tools.lines.length==t){const o=d.lineColor,s=d.lineTitle,n={lineType:i,price:r,color:o,title:s,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(n)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:i,points:[r],data:[{color:o,title:s}]})}re.value.classList.remove("selected")}function Vt(i){const t={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(i).forEach(([o,{color:s,title:n}])=>{t.price=+o,t.color=s,t.title=n,e.tools.lines.push(e.series.price.createPriceLine(t))})}function Be(i=!0){e.tools.lines.length>0&&(i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),G(["lines"]))}function _t(i){d.showScanContext=!1,d.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(i.target.classList.add("selected"),ke())}function $t(i){ke(),i.target.classList.remove("selected")}function It(){const i="target",r=pe(e.crosshair.y);let t={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:i,points:[],data:[r]};if(v.isSet(e.tools.target.A)){const s=+e.tools.target.A.options().price,n=r-s;t.point="B",t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point),t.point="X",t.price=parseFloat((s-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((s-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((s-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((s-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t),Se.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point);u.dispatch("tradingDerivative/drawTools",o)}function Mt(i){let t={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const o=i.A,s=i.B,n=s-o;t.point="A",t.price=o,t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="B",t.price=s,t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="X",t.price=parseFloat((o-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((o-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((o-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((o-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t)}function ke(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),v.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),v.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z),e.series.price.removePriceLine(e.tools.target.W))),G(["target"])}function Bt(){z(["entry","tp","sl"],!1),Be(!1),ke(!1),Me(!1),ae()}function de(i){if(i){if(M()&&(v.isSet(e.tools.order.tp.line)||b.value.position&&e.currentSeconds>F.ATO&&e.currentSeconds<F.ATC&&(U.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",U.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",U.value.style.display="block"),!v.isSet(e.tools.order.entry.line))){let r=null,t=0;b.value.position?(e.currentSeconds<F.ATO?r="ATO":e.currentSeconds>F.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,t=-b.value.position)):e.currentSeconds>F.ATO&&e.currentSeconds<F.ATC&&(r=pe(e.crosshair.y),t=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=t,e.tools.order.entry.price=r),t&&(B.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",B.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",B.value.style.background=t>0?"green":"red",B.value.innerText=`${t>0?"LONG":"SHORT"} ${r}`,B.value.style.display="block")}}else B.value.style.display="none",U.value.style.display="none"}function Wt(){M()&&(e.currentSeconds<F.ATO?ze(y("trading.derivative.atoOrder"),y("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(t=>{t.isOk?w.success(y("trading.derivative.atoOrderSuccess")):D(t.message)})}):e.currentSeconds<F.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(i=>{i.isOk?(X(["entry"]),w.success(y("trading.derivative.newEntrySuccess"))):D(i.message)}):ze(y("trading.derivative.atcOrder"),y("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(t=>{t.isOk?w.success(y("trading.derivative.atcOrderSuccess")):D(t.message)})}))}function Zt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Je,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*je,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(i=>{i.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),X(["entry","tp","sl"]),w.success(y("trading.derivative.newTpSlSuccess"))):D(i.message)})}function Yt(){v.isSet(e.tools.order.entry.line)?v.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(i=>{i.isOk?(z(["entry","tp","sl"]),w.success(y("trading.derivative.exitSuccess"))):D(i.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(i=>{i.isOk?(z(["entry"]),w.success(y("trading.derivative.deleteEntrySuccess"))):D(i.message)}):j()}function Nt(i){v.isSet(e.tools.order.entry.line)&&(v.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&i>=e.tools.order.tp.price||e.tools.order.side<0&&i<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(z(["entry","tp","sl"]),w.success(y("trading.derivative.deleteTpSuccess")),de(!1)):D(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&i<=e.tools.order.sl.price||e.tools.order.side<0&&i>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(z(["entry","tp","sl"]),w.success(y("trading.derivative.deleteSlSuccess")),de(!1)):D(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&i>=e.tools.order.entry.price||e.tools.order.side<0&&i<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Je,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*je,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),X(["entry","tp","sl"]),w.success(y("trading.derivative.autoNewTpSlSuccess"))):D(r.message),e.isAutoOrdering=!1})},1e3))))}function Xt(){e.chart.timeScale().scrollToRealTime()}function M(){return A.value.openingMarket&&e.currentSeconds>=F.START&&e.currentSeconds<=F.END}function pe(i){return parseFloat(e.series.price.coordinateToPrice(i).toFixed(1))}function D(i){i||(i="unknown"),w.error(y(`trading.derivative.${i}`))}function zt(){if(!d.chartDate)return!1;u.dispatch("tradingDerivative/getChartData",d.chartDate)}function We(){M()&&e.websocket.send(e.socketSendData)}function Jt(){e.data.whitespace=[],e.data.price=[],We(),u.dispatch("tradingDerivative/getChartData",d.chartDate)}function Ze(){u.dispatch("tradingDerivative/getStatus")}function j(){u.dispatch("tradingDerivative/getTools")}function G(i){i==null&&(i=["order","lines","tr","pattern","target"]),i.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),i.includes("lines")&&(e.tools.lines=[]),i.includes("target")&&(e.tools.target={}),i.includes("tr")&&(e.tools.timeRange=[]),i.includes("pattern")&&(e.tools.pattern={})}function jt(){u.dispatch("tradingDerivative/getAccountInfo").then(i=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${y("trading.derivative.nav")}</div><div>: ${ie.currency(i.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${y("trading.derivative.maxVol")}</div><div>: ${ie.numberVnFormat(i.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${y("trading.derivative.vm")}</div><div>: ${ie.currency(i.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${y("trading.derivative.fee")}</div><div>: ${ie.currency(i.fee)}</div></div>`,r+="</div>",ui(r,y("trading.derivative.accountInfo"))})}function Ht(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/report"))}function qt(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/export",d.chartDate))}function Qt(){Oe.value.show()}function Ut(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/loginDnse"))}function S(i,r,t,o=!1){return r?o?i>=t:i>t:o?i<=t:i<t}function P(i){let r=e.data.whitespace.findIndex(t=>t.time==i);if(r==-1){const t=ve(new Date(i*1e3),"yyyy-MM-dd"),o=T(new Date(`${t}T11:30:00Z`)),s=T(new Date(`${t}T13:00:00Z`)),n=T(new Date(`${t}T14:30:00Z`));i>o&&i<s?i=o:i>n&&(i=n),r=e.data.whitespace.findIndex(a=>a.time==i)}return r}function ue(i){return e.data.whitespace[i].time}return(i,r)=>{const t=fi("DxToolbar");return vi(),ni(ci,null,[m("div",Si,[me(t,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:i.$t("trading.derivative.buttons.report"),onClick:Ht}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:i.$t("trading.derivative.buttons.export"),onClick:qt}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:i.$t("trading.derivative.buttons.loginVps"),onClick:Qt}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:i.$t("trading.derivative.buttons.loginDnse"),onClick:Ut}}]},null,8,["items"]),m("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:R,onClick:ot,onContextmenu:st},[m("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:De},[m("div",{class:"area data-area",onClick:Re,onContextmenu:Ae},[m("div",{ref_key:"connectionRef",ref:qe,class:I(["command",{yellow:b.value.pending}]),title:i.$t("trading.derivative.connection"),onClick:Ze},[m("i",{class:I(["far",{"fa-link-simple":b.value.connection,"fa-link-simple-slash":!b.value.connection,blink:d.isSocketWarning}])},null,2)],10,Ci),m("div",{class:I(["command status",{green:b.value.position>0,red:b.value.position<0}]),title:i.$t("trading.derivative.position"),onClick:jt},Xe(b.value.position),11,wi),m("div",{class:"command clock",onClick:We},Xe(d.clock),1),te(m("input",{type:"date",class:"chart-date command",title:i.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=o=>d.chartDate=o),onChange:zt},null,40,Ti),[[ai,d.chartDate]]),m("div",{ref_key:"reloadToolRef",ref:Ge,class:"command",title:i.$t("trading.derivative.reload"),onClick:Jt,onContextmenu:j},[m("i",{class:I(["far fa-sync-alt",{"fa-spin":tt.value}])},null,2)],40,ki)],32),m("div",{class:"area tool-area",onClick:Re,onContextmenu:Ae},[m("div",{ref_key:"fullscreenToolRef",ref:Qe,class:"command",title:i.$t("trading.derivative.fullscreen"),onClick:ct},[m("i",{class:I(["far",{"fa-compress":d.isFullscreen,"fa-expand":!d.isFullscreen}])},null,2)],8,Fi),m("div",{ref_key:"tradingviewRef",ref:Ke,class:"command far fa-chart-candlestick",title:i.$t("trading.derivative.tradingview"),onClick:mt},null,8,bi),m("div",{class:I(["context command",{green:d.progress}]),title:i.$t("trading.derivative.progressTool"),onClick:j,onContextmenu:yt},[m("i",{class:I(["far",{"fa-badge-check":!d.progress,[`fa-circle-${d.progress}`]:d.progress,blink:A.value.autoScan}])},null,2)],42,Di),m("div",{ref_key:"scanToolRef",ref:Ce,class:"context command",title:i.$t("trading.derivative.scanTool"),onClick:gt,onContextmenu:ht},[m("i",{class:I(["far",{[`fa-angles-${d.scanSide}`]:!0}])},null,2),te(me(gi,{class:"contextmenu",modelValue:d.scanSide,"onUpdate:modelValue":r[1]||(r[1]=o=>d.scanSide=o)},null,8,["modelValue"]),[[ge,d.showScanContext]])],40,Oi),m("div",{ref_key:"patternToolRef",ref:xe,class:"command",title:i.$t("trading.derivative.patternTool"),onClick:Tt,onContextmenu:kt},Ai,40,Li),m("div",{ref_key:"lineToolRef",ref:re,class:"context command",title:i.$t("trading.derivative.lineTool"),onClick:At,onContextmenu:Pt},[Ei,te(me(mi,{class:"contextmenu",enable:d.showLineContext,title:d.lineTitle,"onUpdate:title":r[2]||(r[2]=o=>d.lineTitle=o),color:d.lineColor,"onUpdate:color":r[3]||(r[3]=o=>d.lineColor=o),onDeleteAllLine:Be},null,8,["enable","title","color"]),[[ge,d.showLineContext]])],40,Pi),m("div",{ref_key:"timeRangeToolRef",ref:oe,class:"command",title:i.$t("trading.derivative.timeRangeTool"),onClick:Dt,onContextmenu:Ot},$i,40,Vi),m("div",{ref_key:"targetToolRef",ref:Se,class:"command",title:i.$t("trading.derivative.targetTool"),onClick:_t,onContextmenu:$t},Bi,40,Ii),te(m("div",{ref_key:"cancelOrderRef",ref:et,class:"cancel-order command",title:i.$t("trading.derivative.cancelTool"),onClick:Yt},[m("i",{class:I(["far fa-trash-alt",{blink:d.isOrderWarning}])},null,2)],8,Wi),[[ge,it.value]])],32),m("div",null,[m("div",{ref_key:"entryOrderRef",ref:B,class:"order-button entry",onClick:Wt}," Entry ",512),m("div",{ref_key:"tpslOrderRef",ref:U,class:"order-button tpsl",onClick:Zt}," TP/SL ",512),m("div",{class:"chart-top command far fa-angle-double-right",onClick:Xt})]),te(m("iframe",{ref_key:"tradingviewChartRef",ref:Ue,class:"tradingview-chart",style:li(d.tradingViewStyle),src:rt.value},null,12,Zi),[[ge,d.showTradingView]])],512)],544)]),me(hi,{ref_key:"vpsOtpPopupRef",ref:Oe},null,512)],64)}}};export{Qi as default};
