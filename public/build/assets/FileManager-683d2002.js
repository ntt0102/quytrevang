import{bD as kt,Y as c,a0 as l,ae as Fe,al as Z,ai as pe,aX as x,ao as d,Z as J,$ as ke,ac as v,ad as w,aF as Ut,c8 as se,a4 as p,b7 as z,ce as H,cf as U,aa as R,cg as Qe,bz as et,a5 as ue,ch as he,ci as ye,a8 as _,b4 as V,ab as Ci,cj as Si,b9 as Ee,ck as Ei,an as O,az as $,a2 as be,cl as $t,a7 as E,c5 as N,ba as yi,cm as Vt,aw as A,cn as Ai,co as tt,cp as Di,cq as it,at as Mi,bc as Kt,ay as Gt,av as xi,cr as F,c4 as Fi,cs as bi,a3 as Ae,ct as Ti,cu as Pi,cv as wi,cw as Oi,bE as Ri,a1 as Li,bX as Ue,ap as rt,cx as Bi,am as Ni,af as ki,cy as Ui,cz as zt,cA as $i,bZ as Vi,cB as Ki,cC as Ht,cD as Wt,bS as Gi,ag as zi,cE as Hi,bu as Y,cF as Wi,aY as qi,cG as Zi,cH as ji,K as Xi,L as at,M as qt,c as Yi,i as ot,r as Se,w as Ji,o as Qi,g as er,j as st,l as tr,P as ir,F as rr,v as ne}from"./app-234e9187.js";var ar="dx-trackbar",or="dx-trackbar-container",sr="dx-trackbar-range",nr="dx-trackbar-wrapper",Zt=kt.inherit({_getDefaultOptions:function(){return c(this.callBase(),{min:0,max:100,value:0})},_initMarkup:function(){this.$element().addClass(ar),this._renderWrapper(),this._renderContainer(),this._renderRange(),this._renderValue(),this._setRangeStyles(),this.callBase()},_render:function(){this.callBase(),this._setRangeStyles(this._rangeStylesConfig())},_renderWrapper:function(){this._$wrapper=l("<div>").addClass(nr).appendTo(this.$element())},_renderContainer:function(){this._$bar=l("<div>").addClass(or).appendTo(this._$wrapper)},_renderRange:function(){this._$range=l("<div>").addClass(sr).appendTo(this._$bar)},_renderValue:function(){var s=this.option("value"),e=this.option("min"),t=this.option("max");if(!(e>t)){if(s<e){this.option("value",e),this._currentRatio=0;return}if(s>t){this.option("value",t),this._currentRatio=1;return}var i=e===t?0:(s-e)/(t-e);!this._needPreventAnimation&&this._setRangeStyles({width:100*i+"%"}),this.setAria({valuemin:this.option("min"),valuemax:t,valuenow:s}),this._currentRatio=i}},_rangeStylesConfig:function(){return{width:100*this._currentRatio+"%"}},_setRangeStyles:function(s){if(Fe.stop(this._$range),!s){this._$range.css({width:0});return}this._needPreventAnimation||!Z()||Fe.animate(this._$range,{type:"custom",duration:100,to:s})},_optionChanged:function(s){switch(s.name){case"value":this._renderValue(),this.callBase(s);break;case"max":case"min":this._renderValue();break;default:this.callBase(s)}},_dispose:function(){Fe.stop(this._$range),this.callBase()}});pe("dxTrackBar",Zt);var lr="dx-progressbar",dr="dx-progressbar-container",hr="dx-progressbar-range-container",cr="dx-progressbar-range",ur="dx-progressbar-wrapper",_r="dx-progressbar-status",pr="dx-progressbar-animating-container",nt="dx-progressbar-animating-segment",$e=Zt.inherit({_getDefaultOptions:function(){return c(this.callBase(),{value:0,statusFormat:function(s){return"Progress: "+Math.round(100*s)+"%"},showStatus:!0,onComplete:null,activeStateEnabled:!1,statusPosition:"bottom left",_animatingSegmentCount:0})},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(s){return s.platform==="android"},options:{_animatingSegmentCount:2}}])},_initMarkup:function(){this._renderStatus(),this._createCompleteAction(),this.callBase(),this.$element().addClass(lr),this._$wrapper.addClass(ur),this._$bar.addClass(dr),this.setAria("role","progressbar"),l("<div>").addClass(hr).appendTo(this._$wrapper).append(this._$bar),this._$range.addClass(cr),this._toggleStatus(this.option("showStatus"))},_useTemplates:function(){return!1},_createCompleteAction:function(){this._completeAction=this._createActionByOption("onComplete")},_renderStatus:function(){this._$status=l("<div>").addClass(_r)},_renderIndeterminateState:function(){this._$segmentContainer=l("<div>").addClass(pr);for(var s=this.option("_animatingSegmentCount"),e=0;e<s;e++)l("<div>").addClass(nt).addClass(nt+"-"+(e+1)).appendTo(this._$segmentContainer);this._$segmentContainer.appendTo(this._$wrapper)},_toggleStatus:function(s){var e=this.option("statusPosition").split(" ");s?e[0]==="top"||e[0]==="left"?this._$status.prependTo(this._$wrapper):this._$status.appendTo(this._$wrapper):this._$status.detach(),this._togglePositionClass()},_togglePositionClass:function(){var s=this.option("statusPosition"),e=s.split(" ");this._$wrapper.removeClass("dx-position-top-left dx-position-top-right dx-position-bottom-left dx-position-bottom-right dx-position-left dx-position-right");var t="dx-position-"+e[0];e[1]&&(t+="-"+e[1]),this._$wrapper.addClass(t)},_toggleIndeterminateState:function(s){s?(this._renderIndeterminateState(),this._$bar.toggle(!1)):(this._$bar.toggle(!0),this._$segmentContainer.remove(),delete this._$segmentContainer)},_renderValue:function(){var s=this.option("value"),e=this.option("max");if(!s&&s!==0){this._toggleIndeterminateState(!0);return}this._$segmentContainer&&this._toggleIndeterminateState(!1),s===e&&this._completeAction(),this.callBase(),this._setStatus()},_setStatus:function(){var s=this.option("statusFormat");x(s)?s=s.bind(this):s=function(t){return t};var e=s(this._currentRatio,this.option("value"));this._$status.text(e)},_dispose:function(){this._$status.remove(),this.callBase()},_optionChanged:function(s){switch(s.name){case"statusFormat":this._setStatus();break;case"showStatus":this._toggleStatus(s.value);break;case"statusPosition":this._toggleStatus(this.option("showStatus"));break;case"onComplete":this._createCompleteAction();break;case"_animatingSegmentCount":break;default:this.callBase(s)}}});pe("dxProgressBar",$e);var _e=V(),mr="dx-fileuploader",gr="dx-fileuploader-empty",fr="dx-fileuploader-show-file-list",lt="dx-fileuploader-dragover",vr="dx-fileuploader-wrapper",Ir="dx-fileuploader-container",Cr="dx-fileuploader-content",Sr="dx-fileuploader-input-wrapper",Er="dx-fileuploader-input-container",yr="dx-fileuploader-input-label",Ar="dx-fileuploader-input",Dr="dx-fileuploader-files-container",dt="dx-fileuploader-file-container",Mr="dx-fileuploader-file-info",xr="dx-fileuploader-file-status-message",Fr="dx-fileuploader-file",ht="dx-fileuploader-file-name",ct="dx-fileuploader-file-size",le="dx-fileuploader-button",Te="dx-fileuploader-button-container",br="dx-fileuploader-cancel-button",ut="dx-fileuploader-upload-button",Tr="dx-fileuploader-invalid",_t=400,Pr="chunkMetadata",pt=1,wr=()=>l("<input>").attr("type","file"),Pe=()=>!!_e.FormData;class jt extends kt{_supportedKeys(){var e=t=>{t.preventDefault();var i=this._selectButton.$element();v.trigger(i,Ci)};return c(super._supportedKeys(),{space:e,enter:e})}_setOptionsByReference(){super._setOptionsByReference(),c(this._optionsByReference,{value:!0})}_getDefaultOptions(){return c(super._getDefaultOptions(),{chunkSize:0,value:[],selectButtonText:d.format("dxFileUploader-selectFile"),uploadButtonText:d.format("dxFileUploader-upload"),labelText:d.format("dxFileUploader-dropFile"),name:"files[]",multiple:!1,accept:"",uploadUrl:"/",allowCanceling:!0,showFileList:!0,progress:0,dialogTrigger:void 0,dropZone:void 0,readyToUploadMessage:d.format("dxFileUploader-readyToUpload"),uploadedMessage:d.format("dxFileUploader-uploaded"),uploadFailedMessage:d.format("dxFileUploader-uploadFailedMessage"),uploadAbortedMessage:d.format("dxFileUploader-uploadAbortedMessage"),uploadMode:"instantly",uploadMethod:"POST",uploadHeaders:{},uploadCustomData:{},onBeforeSend:null,onUploadStarted:null,onUploaded:null,onFilesUploaded:null,onProgress:null,onUploadError:null,onUploadAborted:null,onDropZoneEnter:null,onDropZoneLeave:null,allowedFileExtensions:[],maxFileSize:0,minFileSize:0,inputAttr:{},invalidFileExtensionMessage:d.format("dxFileUploader-invalidFileExtension"),invalidMaxFileSizeMessage:d.format("dxFileUploader-invalidMaxFileSize"),invalidMinFileSizeMessage:d.format("dxFileUploader-invalidMinFileSize"),extendSelection:!0,validationMessageMode:"always",uploadFile:null,uploadChunk:null,abortUpload:null,validationMessageOffset:{h:0,v:0},hoverStateEnabled:!0,useNativeInputClick:!1,useDragOver:!0,nativeDropSupported:!0,_uploadButtonType:"normal"})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:()=>J.real().deviceType==="desktop"&&!J.isSimulator(),options:{focusStateEnabled:!0}},{device:[{platform:"android"}],options:{validationMessageOffset:{v:0}}},{device:()=>J.real().deviceType!=="desktop",options:{useDragOver:!1}},{device:()=>!Pe(),options:{uploadMode:"useForm"}},{device:()=>J.real().deviceType!=="desktop",options:{nativeDropSupported:!1}},{device:()=>ke(),options:{_uploadButtonType:"default"}}])}_initOptions(e){var t="labelText"in e;super._initOptions(e),!t&&!this._shouldDragOverBeRendered()&&this.option("labelText","")}_init(){super._init(),this._initFileInput(),this._initLabel(),this._setUploadStrategy(),this._createFiles(),this._createBeforeSendAction(),this._createUploadStartedAction(),this._createUploadedAction(),this._createFilesUploadedAction(),this._createProgressAction(),this._createUploadErrorAction(),this._createUploadAbortedAction(),this._createDropZoneEnterAction(),this._createDropZoneLeaveAction()}_setUploadStrategy(){var e=null;if(this.option("chunkSize")>0){var t=this.option("uploadChunk");e=t&&x(t)?new Lr(this):new Rr(this)}else{var i=this.option("uploadFile");e=i&&x(i)?new Nr(this):new Br(this)}this._uploadStrategy=e}_initFileInput(){this._isCustomClickEvent=!1,this._$fileInput||(this._$fileInput=wr(),v.on(this._$fileInput,"change",this._inputChangeHandler.bind(this)),v.on(this._$fileInput,"click",e=>(e.stopPropagation(),this._resetInputValue(),this.option("useNativeInputClick")||this._isCustomClickEvent))),this._$fileInput.prop({multiple:this.option("multiple"),accept:this.option("accept"),title:this.option("hint")||null,tabIndex:-1})}_inputChangeHandler(){if(!this._doPreventInputChange){var e=this._$fileInput.val().replace(/^.*\\/,""),t=this._$fileInput.prop("files");if(!(t&&!t.length&&this.option("uploadMode")!=="useForm")){var i=t?this._getFiles(t):[{name:e}];this._changeValue(i),this.option("uploadMode")==="instantly"&&this._uploadFiles()}}}_shouldFileListBeExtended(){return this.option("uploadMode")!=="useForm"&&this.option("extendSelection")&&this.option("multiple")}_changeValue(e){var t=this._shouldFileListBeExtended()?this.option("value").slice():[];this.option("value",t.concat(e))}_getFiles(e){var t=[];return w(e,(i,r)=>t.push(r)),t}_getFile(e){var t=Ut(e)?this.option("value")[e]:e;return this._files.filter(i=>i.value===t)[0]}_initLabel(){this._$inputLabel||(this._$inputLabel=l("<div>")),this._updateInputLabelText()}_updateInputLabelText(){var e=this._isInteractionDisabled()?"":this.option("labelText");this._$inputLabel.text(e)}_focusTarget(){return this.$element().find("."+le)}_getSubmitElement(){return this._$fileInput}_initMarkup(){super._initMarkup(),this.$element().addClass(mr),this._renderWrapper(),this._renderInputWrapper(),this._renderSelectButton(),this._renderInputContainer(),this._renderUploadButton(),this._preventRecreatingFiles=!0,this._activeDropZone=null}_render(){this._preventRecreatingFiles=!1,this._attachDragEventHandlers(this._$inputWrapper),this._attachDragEventHandlers(this.option("dropZone")),this._renderFiles(),super._render()}_createFileProgressBar(e){e.progressBar=this._createProgressBar(e.value.size),e.progressBar.$element().appendTo(e.$file),this._initStatusMessage(e),this._ensureCancelButtonInitialized(e)}_setStatusMessage(e,t){setTimeout(()=>{this.option("showFileList")&&e.$statusMessage&&(e.$statusMessage.text(t),e.$statusMessage.css("display",""),e.progressBar.$element().remove())},_t)}_getUploadAbortedStatusMessage(){return this.option("uploadMode")==="instantly"?this.option("uploadAbortedMessage"):this.option("readyToUploadMessage")}_createFiles(){var e=this.option("value");this._files&&(e.length===0||!this._shouldFileListBeExtended())&&(this._preventFilesUploading(this._files),this._files=null),this._files||(this._files=[]),w(e.slice(this._files.length),(t,i)=>{var r=this._createFile(i);this._validateFile(r),this._files.push(r)})}_preventFilesUploading(e){e.forEach(t=>this._uploadStrategy.abortUpload(t))}_validateFile(e){e.isValidFileExtension=this._validateFileExtension(e),e.isValidMinSize=this._validateMinFileSize(e),e.isValidMaxSize=this._validateMaxFileSize(e)}_validateFileExtension(e){var t=this.option("allowedFileExtensions"),i=this.option("accept"),r=this._getAllowedFileTypes(i),a=e.value.name.substring(e.value.name.lastIndexOf(".")).toLowerCase();if(i.length!==0&&!this._isFileTypeAllowed(e.value,r))return!1;if(t.length===0)return!0;for(var o=0;o<t.length;o++)if(a===t[o].toLowerCase())return!0;return!1}_validateMaxFileSize(e){var t=e.value.size,i=this.option("maxFileSize");return i>0?t<=i:!0}_validateMinFileSize(e){var t=e.value.size,i=this.option("minFileSize");return i>0?t>=i:!0}_createBeforeSendAction(){this._beforeSendAction=this._createActionByOption("onBeforeSend",{excludeValidators:["readOnly"]})}_createUploadStartedAction(){this._uploadStartedAction=this._createActionByOption("onUploadStarted",{excludeValidators:["readOnly"]})}_createUploadedAction(){this._uploadedAction=this._createActionByOption("onUploaded",{excludeValidators:["readOnly"]})}_createFilesUploadedAction(){this._filesUploadedAction=this._createActionByOption("onFilesUploaded",{excludeValidators:["readOnly"]})}_createProgressAction(){this._progressAction=this._createActionByOption("onProgress",{excludeValidators:["readOnly"]})}_createUploadAbortedAction(){this._uploadAbortedAction=this._createActionByOption("onUploadAborted",{excludeValidators:["readOnly"]})}_createUploadErrorAction(){this._uploadErrorAction=this._createActionByOption("onUploadError",{excludeValidators:["readOnly"]})}_createDropZoneEnterAction(){this._dropZoneEnterAction=this._createActionByOption("onDropZoneEnter")}_createDropZoneLeaveAction(){this._dropZoneLeaveAction=this._createActionByOption("onDropZoneLeave")}_createFile(e){return{value:e,loadedSize:0,onProgress:se(),onAbort:se(),onLoad:se(),onError:se(),onLoadStart:se(),isValidFileExtension:!0,isValidMaxSize:!0,isValidMinSize:!0,isValid(){return this.isValidFileExtension&&this.isValidMaxSize&&this.isValidMinSize},isInitialized:!1}}_resetFileState(e){e.isAborted=!1,e.uploadStarted=!1,e.isStartLoad=!1,e.loadedSize=0,e.chunksData=void 0,e.request=void 0}_renderFiles(){var e,t=this.option("value");this._$filesContainer?(!this._shouldFileListBeExtended()||t.length===0)&&this._$filesContainer.empty():this._$filesContainer=l("<div>").addClass(Dr).appendTo(this._$content);var i=this.option("showFileList");i&&w(this._files,(r,a)=>{a.$file||this._renderFile(a)}),this.$element().toggleClass(fr,i),this._toggleFileUploaderEmptyClassName(),this._updateFileNameMaxWidth(),(e=this._validationMessage)===null||e===void 0||e.repaint()}_renderFile(e){var t=e.value,i=l("<div>").addClass(dt).appendTo(this._$filesContainer);this._renderFileButtons(e,i),e.$file=l("<div>").addClass(Fr).appendTo(i);var r=l("<div>").addClass(Mr).appendTo(e.$file);e.$statusMessage=l("<div>").addClass(xr).appendTo(e.$file),l("<div>").addClass(ht).text(t.name).appendTo(r),p(t.size)&&l("<div>").addClass(ct).text(this._getFileSize(t.size)).appendTo(r),e.isValid()?e.$statusMessage.text(this.option("readyToUploadMessage")):(e.isValidFileExtension||e.$statusMessage.append(this._createValidationElement("invalidFileExtensionMessage")),e.isValidMaxSize||e.$statusMessage.append(this._createValidationElement("invalidMaxFileSizeMessage")),e.isValidMinSize||e.$statusMessage.append(this._createValidationElement("invalidMinFileSizeMessage")),i.addClass(Tr))}_createValidationElement(e){return l("<span>").text(this.option(e))}_updateFileNameMaxWidth(){var e=this.option("allowCanceling")&&this.option("uploadMode")!=="useForm"?1:0,t=this.option("uploadMode")==="useButtons"?1:0,i=z(this._$filesContainer.find("."+dt).first())||z(this._$filesContainer),r=this._$filesContainer.find("."+Te).eq(0),a=z(r)*(e+t),o=this._$filesContainer.find("."+ct).eq(0),n=o.text();o.text("1000 Mb");var h=z(o);o.text(n),this._$filesContainer.find("."+ht).css("maxWidth",i-a-h)}_renderFileButtons(e,t){var i=this._getCancelButton(e);i&&t.append(i);var r=this._getUploadButton(e);r&&t.append(r)}_getCancelButton(e){return this.option("uploadMode")==="useForm"?null:(e.cancelButton=this._createComponent(l("<div>").addClass(le+" "+br),H,{onClick:()=>this._removeFile(e),icon:"close",visible:this.option("allowCanceling"),disabled:this.option("readOnly"),integrationOptions:{},hoverStateEnabled:this.option("hoverStateEnabled")}),l("<div>").addClass(Te).append(e.cancelButton.$element()))}_getUploadButton(e){return!e.isValid()||this.option("uploadMode")!=="useButtons"?null:(e.uploadButton=this._createComponent(l("<div>").addClass(le+" "+ut),H,{onClick:()=>this._uploadFile(e),icon:"upload",hoverStateEnabled:this.option("hoverStateEnabled")}),e.onLoadStart.add(()=>e.uploadButton.option({visible:!1,disabled:!0})),e.onAbort.add(()=>e.uploadButton.option({visible:!0,disabled:!1})),l("<div>").addClass(Te).append(e.uploadButton.$element()))}_removeFile(e){var t;(t=e.$file)===null||t===void 0||t.parent().remove(),this._files.splice(this._files.indexOf(e),1);var i=this.option("value").slice();i.splice(i.indexOf(e.value),1),this._preventRecreatingFiles=!0,this.option("value",i),this._preventRecreatingFiles=!1,this._toggleFileUploaderEmptyClassName(),this._resetInputValue(!0)}removeFile(e){if(!(this.option("uploadMode")==="useForm"||!p(e))){var t=this._getFile(e);t&&(t.uploadStarted&&this._preventFilesUploading([t]),this._removeFile(t))}}_toggleFileUploaderEmptyClassName(){this.$element().toggleClass(gr,!this._files.length||this._hasInvalidFile(this._files))}_hasInvalidFile(e){for(var t=0;t<e.length;t++)if(!e[t].isValid())return!0;return!1}_getFileSize(e){for(var t=0,i=[d.format("dxFileUploader-bytes"),d.format("dxFileUploader-kb"),d.format("dxFileUploader-Mb"),d.format("dxFileUploader-Gb")],r=i.length-1;t<r&&e>=1024;)e/=1024,t++;return Math.round(e)+" "+i[t]}_renderSelectButton(){var e=l("<div>").addClass(le).appendTo(this._$inputWrapper);this._selectButton=this._createComponent(e,H,{text:this.option("selectButtonText"),focusStateEnabled:!1,integrationOptions:{},disabled:this.option("readOnly"),hoverStateEnabled:this.option("hoverStateEnabled")}),this._selectFileDialogHandler=this._selectButtonClickHandler.bind(this),J.real().deviceType==="desktop"?this._selectButton.option("onClick",this._selectFileDialogHandler):this._attachSelectFileDialogHandler(this._selectButton.$element()),this._attachSelectFileDialogHandler(this.option("dialogTrigger"))}_selectButtonClickHandler(){if(!this.option("useNativeInputClick")){if(this._isInteractionDisabled())return!1;this._isCustomClickEvent=!0,v.trigger(this._$fileInput,"click"),this._isCustomClickEvent=!1}}_attachSelectFileDialogHandler(e){p(e)&&(this._detachSelectFileDialogHandler(e),v.on(l(e),"click",this._selectFileDialogHandler))}_detachSelectFileDialogHandler(e){p(e)&&v.off(l(e),"click",this._selectFileDialogHandler)}_renderUploadButton(){if(this.option("uploadMode")==="useButtons"){var e=l("<div>").addClass(le).addClass(ut).appendTo(this._$content);this._uploadButton=this._createComponent(e,H,{text:this.option("uploadButtonText"),onClick:this._uploadButtonClickHandler.bind(this),type:this.option("_uploadButtonType"),integrationOptions:{},hoverStateEnabled:this.option("hoverStateEnabled")})}}_uploadButtonClickHandler(){this._uploadFiles()}_shouldDragOverBeRendered(){return!this.option("readOnly")&&(this.option("uploadMode")!=="useForm"||this.option("nativeDropSupported"))}_isInteractionDisabled(){return this.option("readOnly")||this.option("disabled")}_renderInputContainer(){this._$inputContainer=l("<div>").addClass(Er).appendTo(this._$inputWrapper),this._$fileInput.addClass(Ar),this._renderInput();var e="dx-fileuploader-input-label-".concat(new U);this._$inputLabel.attr("id",e).addClass(yr).appendTo(this._$inputContainer),this.setAria("labelledby",e,this._$fileInput)}_renderInput(){this.option("useNativeInputClick")?this._selectButton.option("template",this._selectButtonInputTemplate.bind(this)):(this._$fileInput.appendTo(this._$inputContainer),this._selectButton.option("template","content")),this._applyInputAttributes(this.option("inputAttr"))}_selectButtonInputTemplate(e,t){var i=l(t),r=l("<span>").addClass("dx-button-text").text(e.text);return i.append(r).append(this._$fileInput),i}_renderInputWrapper(){this._$inputWrapper=l("<div>").addClass(Sr).appendTo(this._$content)}_detachDragEventHandlers(e){p(e)&&v.off(l(e),R("",this.NAME))}_attachDragEventHandlers(e){var t=e!==this._$inputWrapper;!p(e)||!this._shouldDragOverBeRendered()||(this._detachDragEventHandlers(e),e=l(e),v.on(e,R("dragenter",this.NAME),this._dragEnterHandler.bind(this,t)),v.on(e,R("dragover",this.NAME),this._dragOverHandler.bind(this,t)),v.on(e,R("dragleave",this.NAME),this._dragLeaveHandler.bind(this,t)),v.on(e,R("drop",this.NAME),this._dropHandler.bind(this,t)))}_applyInputAttributes(e){this._$fileInput.attr(e)}_useInputForDrop(){return this.option("nativeDropSupported")&&this.option("uploadMode")==="useForm"}_getDropZoneElement(e,t){var i=e?Array.from(l(this.option("dropZone"))):[this._$inputWrapper];return i=i.map(r=>l(r).get(0)),i[i.indexOf(t.currentTarget)]}_dragEnterHandler(e,t){if(this.option("disabled"))return!1;this._useInputForDrop()||t.preventDefault();var i=this._getDropZoneElement(e,t);p(i)&&this._shouldRaiseDragOver(t,i)&&(this._activeDropZone=i,this._tryToggleDropZoneActive(!0,e,t))}_shouldRaiseDragOver(e,t){return this._activeDropZone===null&&this.isMouseOverElement(e,t,!1)&&e.originalEvent.dataTransfer.types.find(i=>i==="Files")}_dragOverHandler(e,t){if(this._useInputForDrop()||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",!e){var i=this._getDropZoneElement(!1,t);this._shouldRaiseDragOver(t,i)&&this._dragEnterHandler(!1,t),this._shouldRaiseDragLeave(t,!1)&&this._dragLeaveHandler(!1,t)}}_dragLeaveHandler(e,t){this._useInputForDrop()||t.preventDefault(),this._shouldRaiseDragLeave(t,e)&&(this._tryToggleDropZoneActive(!1,e,t),this._activeDropZone=null)}_shouldRaiseDragLeave(e,t){return this._activeDropZone!==null&&!this.isMouseOverElement(e,this._activeDropZone,!t,-pt)}_tryToggleDropZoneActive(e,t,i){var r=e?"addClass":"removeClass",a=e?"_dropZoneEnterAction":"_dropZoneLeaveAction";this[a]({event:i,dropZoneElement:this._activeDropZone}),t||this.$element()[r](lt)}_dropHandler(e,t){if(this._activeDropZone=null,e||this.$element().removeClass(lt),!(this._useInputForDrop()||e&&this._isInteractionDisabled())){t.preventDefault();var i=t.originalEvent.dataTransfer.files,r=this._getFiles(i);!this.option("multiple")&&r.length>1||r.length===0||(this._changeValue(r),this.option("uploadMode")==="instantly"&&this._uploadFiles())}}_areAllFilesLoaded(){return this._files.every(e=>!e.isValid()||e._isError||e._isLoaded||e.isAborted)}_handleAllFilesUploaded(){this._recalculateProgress(),this._areAllFilesLoaded()&&this._filesUploadedAction()}_getAllowedFileTypes(e){return e.length?e.split(",").map(t=>t.trim()):[]}_isFileTypeAllowed(e,t){for(var i=0,r=t.length;i<r;i++){var a=t[i];if(a[0]==="."){if(a=a.replace(".","\\."),e.name.match(new RegExp(a+"$","i")))return!0}else if(a=a.replace(new RegExp("\\*","g"),""),e.type.match(new RegExp(a,"i")))return!0}return!1}_renderWrapper(){var e=l("<div>").addClass(vr).appendTo(this.$element()),t=l("<div>").addClass(Ir).appendTo(e);this._$content=l("<div>").addClass(Cr).appendTo(t)}_clean(){this._$fileInput.detach(),delete this._$filesContainer,this._detachSelectFileDialogHandler(this.option("dialogTrigger")),this._detachDragEventHandlers(this.option("dropZone")),this._files&&this._files.forEach(e=>{e.$file=null,e.$statusMessage=null}),super._clean()}abortUpload(e){if(this.option("uploadMode")!=="useForm")if(p(e)){var t=this._getFile(e);t&&this._preventFilesUploading([t])}else this._preventFilesUploading(this._files)}upload(e){if(this.option("uploadMode")!=="useForm")if(p(e)){var t=this._getFile(e);t&&Pe()&&this._uploadFile(t)}else this._uploadFiles()}_uploadFiles(){Pe()&&w(this._files,(e,t)=>this._uploadFile(t))}_uploadFile(e){this._uploadStrategy.upload(e)}_updateProgressBar(e,t){e.progressBar&&e.progressBar.option({value:t.loaded,showStatus:!0}),this._progressAction({file:e.value,segmentSize:t.currentSegmentSize,bytesLoaded:t.loaded,bytesTotal:t.total,event:t.event,request:e.request})}_updateTotalProgress(e,t){var i=0;p(e)&&(this._files.length>0&&this._areAllFilesLoaded()&&e===0&&t===0?i=this._getProgressValue(1):e&&(i=this._getProgressValue(t/e))),this.option("progress",i),this._setLoadedSize(t)}_getProgressValue(e){return Math.floor(100*e)}_initStatusMessage(e){e.$statusMessage.css("display","none")}_ensureCancelButtonInitialized(e){if(!e.isInitialized){e.cancelButton.option("onClick",()=>{this._preventFilesUploading([e]),this._removeFile(e)});var t=()=>{setTimeout(()=>{e.cancelButton.option({visible:!1})},_t)};e.onLoad.add(t),e.onError.add(t)}}_createProgressBar(e){return this._createComponent(l("<div>"),$e,{value:void 0,min:0,max:e,statusFormat:t=>this._getProgressValue(t)+"%",showStatus:!1,statusPosition:"right"})}_getTotalFilesSize(){return this._totalFilesSize||(this._totalFilesSize=0,w(this._files,(e,t)=>{this._totalFilesSize+=t.value.size})),this._totalFilesSize}_getTotalLoadedFilesSize(){return this._totalLoadedFilesSize||(this._totalLoadedFilesSize=0,w(this._files,(e,t)=>{this._totalLoadedFilesSize+=t.loadedSize})),this._totalLoadedFilesSize}_setLoadedSize(e){this._totalLoadedFilesSize=e}_recalculateProgress(){this._totalFilesSize=0,this._totalLoadedFilesSize=0,this._updateTotalProgress(this._getTotalFilesSize(),this._getTotalLoadedFilesSize())}isMouseOverElement(e,t,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:pt;if(!t)return!1;var a=i?parseFloat(_e.getComputedStyle(t,":before").height):0,o=i?parseFloat(_e.getComputedStyle(t,":after").height):0,n=Qe(t).left,h=Qe(t).top+a,u=t.offsetWidth,g=t.offsetHeight-a-o,D=this._getEventX(e),b=this._getEventY(e);return D+r>=n&&D-r<n+u&&b+r>=h&&b-r<h+g}_getEventX(e){return et(e)?this._getTouchEventX(e):e.clientX+this._getDocumentScrollLeft()}_getEventY(e){return et(e)?this._getTouchEventY(e):e.clientY+this._getDocumentScrollTop()}_getTouchEventX(e){var t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageX:0}_getTouchEventY(e){var t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageY:0}_getDocumentScrollTop(){var e=ue.getDocument();return e.documentElement.scrollTop||e.body.scrollTop}_getDocumentScrollLeft(){var e=ue.getDocument();return e.documentElement.scrollLeft||e.body.scrollLeft}_updateReadOnlyState(){var e=this.option("readOnly");this._selectButton.option("disabled",e),this._files.forEach(t=>{var i;return(i=t.cancelButton)===null||i===void 0?void 0:i.option("disabled",e)}),this._updateInputLabelText(),this._attachDragEventHandlers(this._$inputWrapper)}_updateHoverState(){var e,t,i=this.option("hoverStateEnabled");(e=this._selectButton)===null||e===void 0||e.option("hoverStateEnabled",i),(t=this._uploadButton)===null||t===void 0||t.option("hoverStateEnabled",i),this._files.forEach(r=>{var a,o;(a=r.uploadButton)===null||a===void 0||a.option("hoverStateEnabled",i),(o=r.cancelButton)===null||o===void 0||o.option("hoverStateEnabled",i)})}_optionChanged(e){var{name:t,value:i,previousValue:r}=e;switch(t){case"height":case"width":this._updateFileNameMaxWidth(),super._optionChanged(e);break;case"value":!i.length&&this._$fileInput.val(""),this._preventRecreatingFiles||(this._createFiles(),this._renderFiles()),this._recalculateProgress(),super._optionChanged(e);break;case"name":this._initFileInput(),super._optionChanged(e);break;case"accept":this._initFileInput();break;case"multiple":this._initFileInput(),e.value||this.reset();break;case"readOnly":this._updateReadOnlyState(),super._optionChanged(e);break;case"disabled":this._updateInputLabelText(),super._optionChanged(e);break;case"selectButtonText":this._selectButton.option("text",i);break;case"uploadButtonText":this._uploadButton&&this._uploadButton.option("text",i);break;case"_uploadButtonType":this._uploadButton&&this._uploadButton.option("type",i);break;case"dialogTrigger":this._detachSelectFileDialogHandler(r),this._attachSelectFileDialogHandler(i);break;case"dropZone":this._detachDragEventHandlers(r),this._attachDragEventHandlers(i);break;case"maxFileSize":case"minFileSize":case"allowedFileExtensions":case"invalidFileExtensionMessage":case"invalidMaxFileSizeMessage":case"invalidMinFileSizeMessage":case"readyToUploadMessage":case"uploadedMessage":case"uploadFailedMessage":case"uploadAbortedMessage":this._invalidate();break;case"labelText":this._updateInputLabelText();break;case"showFileList":this._preventRecreatingFiles||this._renderFiles();break;case"uploadFile":case"uploadChunk":case"chunkSize":this._setUploadStrategy();break;case"abortUpload":case"uploadUrl":case"progress":case"uploadMethod":case"uploadHeaders":case"uploadCustomData":case"extendSelection":break;case"hoverStateEnabled":this._updateHoverState(),super._optionChanged(e);break;case"allowCanceling":case"uploadMode":this.reset(),this._invalidate();break;case"onBeforeSend":this._createBeforeSendAction();break;case"onUploadStarted":this._createUploadStartedAction();break;case"onUploaded":this._createUploadedAction();break;case"onFilesUploaded":this._createFilesUploadedAction();break;case"onProgress":this._createProgressAction();break;case"onUploadError":this._createUploadErrorAction();break;case"onUploadAborted":this._createUploadAbortedAction();break;case"onDropZoneEnter":this._createDropZoneEnterAction();break;case"onDropZoneLeave":this._createDropZoneLeaveAction();break;case"useNativeInputClick":this._renderInput();break;case"useDragOver":this._attachDragEventHandlers(this._$inputWrapper);break;case"nativeDropSupported":this._invalidate();break;case"inputAttr":this._applyInputAttributes(this.option(t));break;case"hint":this._initFileInput(),super._optionChanged(e);break;default:super._optionChanged(e)}}_resetInputValue(e){this.option("uploadMode")==="useForm"&&!e||(this._doPreventInputChange=!0,this._$fileInput.val(""),this._doPreventInputChange=!1)}reset(){this.option("value",[])}}class Or{constructor(e,t){this.file=e,this.chunkSize=t,this.index=0}read(){if(!this.file)return null;var e=this.createBlobResult(this.file,this.index,this.chunkSize);return e.isCompleted&&(this.file=null),this.index++,e}createBlobResult(e,t,i){var r=t*i;return{blob:this.sliceFile(e,r,i),index:t,isCompleted:r+i>=e.size}}sliceFile(e,t,i){return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):null}}class Xt{constructor(e){this.fileUploader=e}upload(e){e.isInitialized&&e.isAborted&&this.fileUploader._resetFileState(e),e.isValid()&&!e.uploadStarted&&(this._prepareFileBeforeUpload(e),this._uploadCore(e))}abortUpload(e){if(!(e._isError||e._isLoaded||e.isAborted||!e.uploadStarted)&&(e.isAborted=!0,e.request&&e.request.abort(),this._isCustomCallback("abortUpload"))){var t=this.fileUploader.option("abortUpload"),i=this._createUploadArgument(e),r=null;try{var a=t(e.value,i);r=ye(a)}catch(o){r=new _().reject(o).promise()}r.done(()=>e.onAbort.fire()).fail(o=>this._handleFileError(e,o))}}_beforeSend(e,t){var i=this._createUploadArgument(t);this.fileUploader._beforeSendAction({request:e,file:t.value,uploadInfo:i}),t.request=e}_createUploadArgument(e){}_uploadCore(e){}_isCustomCallback(e){var t=this.fileUploader.option(e);return t&&x(t)}_handleProgress(e,t){e._isError||(e._isProgressStarted=!0,this._handleProgressCore(e,t))}_handleProgressCore(e,t){}_handleFileError(e,t){e._isError=!0,e.onError.fire(t)}_prepareFileBeforeUpload(e){if(e.$file){var t;(t=e.progressBar)===null||t===void 0||t.dispose(),this.fileUploader._createFileProgressBar(e)}e.isInitialized||(e.onLoadStart.add(this._onUploadStarted.bind(this,e)),e.onLoad.add(this._onLoadedHandler.bind(this,e)),e.onError.add(this._onErrorHandler.bind(this,e)),e.onAbort.add(this._onAbortHandler.bind(this,e)),e.onProgress.add(this._onProgressHandler.bind(this,e)),e.isInitialized=!0)}_shouldHandleError(e,t){return(this._isStatusError(t.status)||!e._isProgressStarted)&&!e.isAborted}_isStatusError(e){return 400<=e&&e<500||500<=e&&e<600}_onUploadStarted(e,t){e.uploadStarted=!0,this.fileUploader._uploadStartedAction({file:e.value,event:t,request:e.request})}_onAbortHandler(e,t){var i={file:e.value,event:t,request:e.request,message:this.fileUploader._getUploadAbortedStatusMessage()};this.fileUploader._uploadAbortedAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onErrorHandler(e,t){var i={file:e.value,event:void 0,request:e.request,error:t,message:this.fileUploader.option("uploadFailedMessage")};this.fileUploader._uploadErrorAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onLoadedHandler(e,t){var i={file:e.value,event:t,request:e.request,message:this.fileUploader.option("uploadedMessage")};e._isLoaded=!0,this.fileUploader._uploadedAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onProgressHandler(e,t){if(e){var i=this.fileUploader._getTotalFilesSize(),r=this.fileUploader._getTotalLoadedFilesSize(),a=Math.min(t.loaded,e.value.size),o=a-e.loadedSize;e.loadedSize=a,this.fileUploader._updateTotalProgress(i,r+o),this.fileUploader._updateProgressBar(e,this._getLoadedData(a,t.total,o,t))}}_getLoadedData(e,t,i,r){return{loaded:e,total:t,currentSegmentSize:i}}_extendFormData(e){var t=this.fileUploader.option("uploadCustomData");for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&p(t[i])&&e.append(i,t[i])}}class Yt extends Xt{constructor(e){super(e),this.chunkSize=this.fileUploader.option("chunkSize")}_uploadCore(e){var t=e.value,i={name:t.name,loadedBytes:0,type:t.type,blobReader:new Or(t,this.chunkSize),guid:new U,fileSize:t.size,count:this._getFileChunksCount(t),customData:{}};e.chunksData=i,this._sendChunk(e,i)}_getFileChunksCount(e){return e.size===0?1:Math.ceil(e.size/this.chunkSize)}_sendChunk(e,t){var i=t.blobReader.read();t.currentChunk=i,i&&this._sendChunkCore(e,t,i).done(()=>{e.isAborted||(t.loadedBytes+=i.blob.size,e.onProgress.fire({loaded:t.loadedBytes,total:e.value.size}),i.isCompleted&&e.onLoad.fire(),setTimeout(()=>this._sendChunk(e,t)))}).fail(r=>{this._shouldHandleError(e,r)&&this._handleFileError(e,r)})}_sendChunkCore(e,t,i){}_tryRaiseStartLoad(e){e.isStartLoad||(e.isStartLoad=!0,e.onLoadStart.fire())}_getEvent(e){return null}_createUploadArgument(e){return this._createChunksInfo(e.chunksData)}_createChunksInfo(e){return{bytesUploaded:e.loadedBytes,chunkCount:e.count,customData:e.customData,chunkBlob:e.currentChunk.blob,chunkIndex:e.currentChunk.index}}}class Rr extends Yt{_sendChunkCore(e,t,i){return he.sendRequest({url:this.fileUploader.option("uploadUrl"),method:this.fileUploader.option("uploadMethod"),headers:this.fileUploader.option("uploadHeaders"),beforeSend:r=>this._beforeSend(r,e),upload:{onprogress:r=>this._handleProgress(e,r),onloadstart:()=>this._tryRaiseStartLoad(e),onabort:()=>e.onAbort.fire()},data:this._createFormData({fileName:t.name,blobName:this.fileUploader.option("name"),blob:i.blob,index:i.index,count:t.count,type:t.type,guid:t.guid,size:t.fileSize})})}_createFormData(e){var t=new _e.FormData;return t.append(e.blobName,e.blob),t.append(Pr,JSON.stringify({FileName:e.fileName,Index:e.index,TotalCount:e.count,FileSize:e.size,FileType:e.type,FileGuid:e.guid})),this._extendFormData(t),t}}class Lr extends Yt{_sendChunkCore(e,t){this._tryRaiseStartLoad(e);var i=this._createChunksInfo(t),r=this.fileUploader.option("uploadChunk");try{var a=r(e.value,i);return ye(a)}catch(o){return new _().reject(o).promise()}}_shouldHandleError(e,t){return!0}}class Jt extends Xt{_uploadCore(e){e.loadedSize=0,this._uploadFile(e).done(()=>{e.isAborted||e.onLoad.fire()}).fail(t=>{this._shouldHandleError(e,t)&&this._handleFileError(e,t)})}_uploadFile(e){}_handleProgressCore(e,t){e.onProgress.fire(t)}_getLoadedData(e,t,i,r){var a=super._getLoadedData(e,t,i,r);return a.event=r,a}}class Br extends Jt{_uploadFile(e){return he.sendRequest({url:this.fileUploader.option("uploadUrl"),method:this.fileUploader.option("uploadMethod"),headers:this.fileUploader.option("uploadHeaders"),beforeSend:t=>this._beforeSend(t,e),upload:{onprogress:t=>this._handleProgress(e,t),onloadstart:()=>e.onLoadStart.fire(),onabort:()=>e.onAbort.fire()},data:this._createFormData(this.fileUploader.option("name"),e.value)})}_createFormData(e,t){var i=new _e.FormData;return i.append(e,t,t.name),this._extendFormData(i),i}}class Nr extends Jt{_uploadFile(e){e.onLoadStart.fire();var t=this.fileUploader.option("uploadFile");try{var i=t(e.value,r=>{var a={loaded:r,total:e.value.size};this._handleProgress(e,a)});return ye(i)}catch(r){return new _().reject(r).promise()}}_shouldHandleError(e,t){return!0}}pe("dxFileUploader",jt);var f={},mt=V(),kr=Si.add,Qt="dx-toast",W=Qt+"-",Ur=W+"wrapper",$r=W+"content",Vr=W+"message",Kr=W+"icon",Gr="dxToast",zr=["info","warning","error","success"],Be=[],Hr=8e3,Wr={top:{my:"top",at:"top",of:null,offset:"0 0"},bottom:{my:"bottom",at:"bottom",of:null,offset:"0 -20"},center:{my:"center",at:"center",of:null,offset:"0 0"},right:{my:"center right",at:"center right",of:null,offset:"0 0"},left:{my:"center left",at:"center left",of:null,offset:"0 0"}},qr={h:0,v:0};kr(function(){v.subscribeGlobal(ue.getDocument(),Ee.down,function(s){for(var e=Be.length-1;e>=0;e--)if(!Be[e]._proxiedDocumentDownHandler(s))return})});var ei=Ei.inherit({_getDefaultOptions:function(){return c(this.callBase(),{message:"",type:"info",displayTime:2e3,position:"bottom center",animation:{show:{type:"fade",duration:400,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}},shading:!1,height:"auto",hideTopOverlayHandler:null,closeOnSwipe:!0,closeOnClick:!1})},_defaultOptionsRules:function(){return this.callBase().concat([{device:{platform:"android"},options:{hideOnOutsideClick:!0,width:"auto",animation:{show:{type:"slide",duration:200,from:{position:{my:"top",at:"bottom",of:mt}}},hide:{type:"slide",duration:200,to:{position:{my:"top",at:"bottom",of:mt}}}}}},{device:function(s){var e=s.deviceType==="phone",t=s.platform==="android";return e&&t},options:{width:"100vw",position:{at:"bottom center",my:"bottom center",offset:"0 0"}}},{device:function(s){return s.deviceType==="phone"},options:{width:"100vw"}},{device:function(){return ke()},options:{minWidth:344,maxWidth:568,displayTime:4e3}}])},_init:function(){this.callBase(),this._posStringToObject()},_renderContentImpl:function(){this._message=l("<div>").addClass(Vr).text(this.option("message")).appendTo(this.$content()),this.setAria("role","alert",this._message),zr.includes(this.option("type").toLowerCase())&&this.$content().prepend(l("<div>").addClass(Kr)),this.callBase()},_render:function(){this.callBase(),this.$element().addClass(Qt),this.$wrapper().addClass(Ur),this.$content().addClass(W+String(this.option("type")).toLowerCase()),this.$content().addClass($r),this._toggleCloseEvents("Swipe"),this._toggleCloseEvents("Click")},_renderScrollTerminator:O,_toggleCloseEvents:function(s){var e="dx"+s.toLowerCase();v.off(this.$content(),e),this.option("closeOn"+s)&&v.on(this.$content(),e,this.hide.bind(this))},_posStringToObject:function(){if($(this.option("position"))){var s=this.option("position").split(" ")[0],e=this.option("position").split(" ")[1];switch(this.option("position",c({boundaryOffset:qr},Wr[s])),e){case"center":case"left":case"right":this.option("position").at+=" "+e,this.option("position").my+=" "+e}}},_show:function(){return this.callBase.apply(this,arguments).always((function(){clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(this.hide.bind(this),this.option("displayTime"))}).bind(this))},_overlayStack:function(){return Be},_zIndexInitValue:function(){return this.callBase()+Hr},_dispose:function(){clearTimeout(this._hideTimeout),this.callBase()},_optionChanged:function(s){switch(s.name){case"type":this.$content().removeClass(W+s.previousValue),this.$content().addClass(W+String(s.value).toLowerCase());break;case"message":this._message&&this._message.text(s.value);break;case"closeOnSwipe":this._toggleCloseEvents("Swipe");break;case"closeOnClick":this._toggleCloseEvents("Click");break;case"displayTime":break;default:this.callBase(s)}}});pe(Gr,ei);var gt=V(),ft=null,ti={};function Zr(s,e,t){var i=be(s)?s:{message:s},r=be(e)?e:void 0,a=be(e)?void 0:e,{onHidden:o}=i;if(r!=null&&r.position){var{position:n}=r,h=r.direction||jr(n),u=$(n)?n:"".concat(n.top,"-").concat(n.left,"-").concat(n.bottom,"-").concat(n.right),{onShowing:g}=i,D=Yr(u);Jr(D,h),c(i,{container:D,onShowing:function(b){Qr(D,h,n),g==null||g(b)}})}c(i,{type:a,displayTime:t,onHidden:function(b){l(b.element).remove(),o==null||o(b)}}),ft=l("<div>").appendTo($t()),new ei(ft,i).show()}var jr=s=>$(s)&&s.includes("top")?"down-push":"up-push",Xr=s=>{var e=l("<div>").appendTo($t());return ti[s]=e,e},Yr=s=>{var e=ti[s];return e||Xr(s)},Jr=(s,e)=>{var t="dx-toast-stack dx-toast-stack-".concat(e,"-direction");s.removeAttr("class").addClass(t)},Qr=(s,e,t)=>{var{offsetWidth:i,offsetHeight:r}=s.children().first().get(0),a={toastWidth:i,toastHeight:r,windowHeight:gt.innerHeight,windowWidth:gt.innerWidth},o=$(t)?ea(t,a):t,n=ta(e,o,a);s.css(n)},ea=(s,e)=>{var{toastWidth:t,toastHeight:i,windowHeight:r,windowWidth:a}=e;switch(s){case"top left":return{top:10,left:10};case"top right":return{top:10,right:10};case"bottom left":return{bottom:10,left:10};case"bottom right":return{bottom:10,right:10};case"top center":return{top:10,left:Math.round(a/2-t/2)};case"left center":return{top:Math.round(r/2-i/2),left:10};case"right center":return{top:Math.round(r/2-i/2),right:10};case"center":return{top:Math.round(r/2-i/2),left:Math.round(a/2-t/2)};case"bottom center":default:return{bottom:10,left:Math.round(a/2-t/2)}}},ta=(s,e,t)=>{var i,r,a,o,n,h,u,g,D,b,ie,re,{toastWidth:fe,toastHeight:ve,windowHeight:Ie,windowWidth:Ce}=t;switch(s.replace(/-push|-stack/g,"")){case"up":return{bottom:(i=e.bottom)!==null&&i!==void 0?i:Ie-ve-e.top,top:"",left:(r=e.left)!==null&&r!==void 0?r:"",right:(a=e.right)!==null&&a!==void 0?a:""};case"down":return{top:(o=e.top)!==null&&o!==void 0?o:Ie-ve-e.bottom,bottom:"",left:(n=e.left)!==null&&n!==void 0?n:"",right:(h=e.right)!==null&&h!==void 0?h:""};case"left":return{right:(u=e.right)!==null&&u!==void 0?u:Ce-fe-e.left,left:"",top:(g=e.top)!==null&&g!==void 0?g:"",bottom:(D=e.bottom)!==null&&D!==void 0?D:""};case"right":return{left:(b=e.left)!==null&&b!==void 0?b:Ce-fe-e.right,right:"",top:(ie=e.top)!==null&&ie!==void 0?ie:"",bottom:(re=e.bottom)!==null&&re!==void 0?re:""}}},Ne=function(s,e,t){e=e||O,t=t||O,Array.isArray(s)||(s=[s]);var i=s.map((r,a)=>E(r).then(o=>(x(e)&&e({item:r,index:a,result:o}),o),o=>(o||(o={}),o.index=a,x(t)&&t(o),new _().resolve().promise())));return E.apply(null,i)},ii=function(s){for(var e=["B","KB","MB","GB","TB"],t=0,i=s;i>=1024&&t<=e.length-1;)i/=1024,t++;return i=Math.round(10*i)/10,"".concat(i," ").concat(e[t])},q=function(s,e,t){return t.forEach(i=>{c(!0,s,p(e[i])?{[i]:e[i]}:{})}),s},ia=(s,e)=>{var t={};e.forEach(r=>{t[r]=null}),s.forEach(r=>{var a=r.fileItem.key;Object.prototype.hasOwnProperty.call(t,a)&&(t[a]=r)});var i=[];return e.forEach(r=>{var a=t[r];a&&i.push(a)}),i},vt=function(s){var e=Object.keys(s),t=[];return e.forEach(i=>t.push(s[i])),{keys:e,values:t}},te="/",ri=s=>{var e=s.lastIndexOf(".");return e!==-1?s.substr(e):""},It=s=>{var e=s.lastIndexOf(te);return e!==-1?s.substr(e+te.length):s},ai=(s,e)=>{if(!s||s==="/")return[];for(var t=[],i="",r=0;r<s.length;r++){var a=s.charAt(r);if(a===te){var o=s.charAt(r+1);o!==te&&(i&&(t.push(i),i=""),a=o),r++}i+=a}if(i&&t.push(i),e)for(var n=0;n<t.length;n++)t[n]=k(n===0?"":t[n-1],Ve(t[n]));return t},Ve=function(s){return s.replace(/\/{1,1}/g,"//")},k=function(){var s="";return w(arguments,(e,t)=>{t&&(s&&(s+=te),s+=t)}),s};class Q{constructor(){var e=$(arguments[0])?this._publicCtor:this._internalCtor;e.apply(this,arguments)}_internalCtor(e,t,i,r){this.name=t||"",this.pathInfo=e&&[...e]||[],this.parentPath=this._getPathByPathInfo(this.pathInfo),this.relativeName=k(this.parentPath,t),this.key=r||this._getPathByPathInfo(this.getFullPathInfo(),!0),this.path=k(this.parentPath,t),this.pathKeys=this.pathInfo.map(a=>{var{key:o}=a;return o}),this.isRoot()||this.pathKeys.push(this.key),this._initialize(i)}_publicCtor(e,t,i){this.path=e||"",this.pathKeys=i||[];for(var r=[],a=ai(e,!0),o=0;o<a.length-1;o++){var n=a[o],h={key:this.pathKeys[o]||n,name:It(n)};r.push(h)}this.pathInfo=r,this.relativeName=e,this.name=It(e),this.key=this.pathKeys.length?this.pathKeys[this.pathKeys.length-1]:e,this.parentPath=a.length>1?a[a.length-2]:"",this._initialize(t)}_initialize(e){this.isDirectory=!!e,this.size=0,this.dateModified=new Date,this.thumbnail="",this.tooltipText=""}getFullPathInfo(){var e=[...this.pathInfo];return this.isRoot()||e.push({key:this.key,name:this.name}),e}isRoot(){return this.path===""}getFileExtension(){return this.isDirectory?"":ri(this.name)}equals(e){return e&&this.key===e.key}createClone(){var e=new Q(this.pathInfo,this.name,this.isDirectory,this.key);return e.key=this.key,e.size=this.size,e.dateModified=this.dateModified,e.thumbnail=this.thumbnail,e.tooltipText=this.tooltipText,e.hasSubDirectories=this.hasSubDirectories,e.dataItem=this.dataItem,e}_getPathByPathInfo(e,t){return e.map(i=>t?Ve(i.name):i.name).join(te)}}var ra=2e5;class De{constructor(e){e=A(e,{}),this._keyGetter=N(this._getKeyExpr(e)),this._nameGetter=N(this._getNameExpr(e)),this._isDirGetter=N(this._getIsDirExpr(e)),this._sizeGetter=N(this._getSizeExpr(e)),this._dateModifiedGetter=N(this._getDateModifiedExpr(e)),this._thumbnailGetter=N(e.thumbnailExpr||"thumbnail")}getItems(e){return[]}renameItem(e,t){}createDirectory(e,t){}deleteItems(e){}moveItems(e,t){}copyItems(e,t){}uploadFileChunk(e,t,i){}abortFileUpload(e,t,i){}downloadItems(e){}getItemsContent(e){}getFileUploadChunkSize(){return ra}_convertDataObjectsToFileItems(e,t){var i=[];return w(e,(r,a)=>{var o=this._createFileItem(a,t);i.push(o)}),i}_createFileItem(e,t){var i=this._keyGetter(e),r=new Q(t,this._nameGetter(e),!!this._isDirGetter(e),i);return r.size=this._sizeGetter(e),r.size===void 0&&(r.size=0),r.dateModified=yi.deserializeDate(this._dateModifiedGetter(e)),r.dateModified===void 0&&(r.dateModified=new Date),r.isDirectory&&(r.hasSubDirectories=this._hasSubDirs(e)),i||(r.key=r.relativeName),r.thumbnail=this._thumbnailGetter(e)||"",r.dataItem=e,r}_hasSubDirs(e){return!0}_getKeyExpr(e){return e.keyExpr||this._defaultKeyExpr}_defaultKeyExpr(e){if(arguments.length===2){e.__KEY__=arguments[1];return}return Object.prototype.hasOwnProperty.call(e,"__KEY__")?e.__KEY__:null}_getNameExpr(e){return e.nameExpr||"name"}_getIsDirExpr(e){return e.isDirectoryExpr||"isDirectory"}_getSizeExpr(e){return e.sizeExpr||"size"}_getDateModifiedExpr(e){return e.dateModifiedExpr||"dateModified"}_executeActionAsDeferred(e,t){var i=new _;try{var r=e();Vt(r)?ye(r).done(a=>i.resolve(t&&a||void 0)).fail(a=>i.reject(a)):i.resolve(t&&r||void 0)}catch(a){return i.reject(a)}return i.promise()}}class ce{constructor(e,t,i){this.errorCode=e,this.fileSystemItem=t,this.errorText=i}}var y={NoAccess:0,FileExists:1,FileNotFound:2,DirectoryExists:3,DirectoryNotFound:4,WrongFileExtension:5,MaxFileSizeExceeded:6,InvalidSymbols:7,Other:32767},we=V();class Ct extends De{constructor(e){e=A(e,{}),super(e);var t=e.data;if(t&&!Array.isArray(t))throw Ai.Error("E4006");var i=e.itemsExpr||"items";this._subFileItemsGetter=N(i),this._subFileItemsSetter=this._getSetter(i);var r=e.contentExpr||"content";this._contentGetter=N(r),this._contentSetter=this._getSetter(r);var a=this._getNameExpr(e);this._nameSetter=this._getSetter(a);var o=this._getIsDirExpr(e);this._getIsDirSetter=this._getSetter(o);var n=this._getKeyExpr(e);this._keySetter=this._getSetter(n);var h=this._getSizeExpr(e);this._sizeSetter=this._getSetter(h);var u=this._getDateModifiedExpr(e);this._dateModifiedSetter=this._getSetter(u),this._data=t||[]}getItems(e){return this._executeActionAsDeferred(()=>this._getItems(e),!0)}renameItem(e,t){return this._executeActionAsDeferred(()=>this._renameItemCore(e,t))}_renameItemCore(e,t){if(e){var i=this._findDataObject(e);this._nameSetter(i,t),e.name=t,e.key=this._ensureDataObjectKey(i)}}createDirectory(e,t){return this._executeActionAsDeferred(()=>{this._validateDirectoryExists(e),this._createDataObject(e,t,!0)})}deleteItems(e){return e.map(t=>this._executeActionAsDeferred(()=>this._deleteItem(t)))}moveItems(e,t){var i=this._findDataObject(t),r=this._getDirectoryDataItems(i),a=e.map(o=>this._executeActionAsDeferred(()=>{this._checkAbilityToMoveOrCopyItem(o,t);var n=this._findDataObject(o);this._deleteItem(o),r.push(n)}));return a}copyItems(e,t){var i=this._findDataObject(t),r=this._getDirectoryDataItems(i),a=e.map(o=>this._executeActionAsDeferred(()=>{this._checkAbilityToMoveOrCopyItem(o,t);var n=this._findDataObject(o),h=this._createCopy(n);r.push(h)}));return a}uploadFileChunk(e,t,i){if(t.chunkIndex>0)return t.customData.deferred;this._validateDirectoryExists(i);var r=t.customData.deferred=new _,a=this._createFileReader();return a.readAsDataURL(e),a.onload=()=>{var o=a.result.split(",")[1],n=this._createDataObject(i,e.name,!1);this._sizeSetter(n,e.size),this._dateModifiedSetter(n,e.lastModifiedDate),this._contentSetter(n,o),r.resolve()},a.onerror=o=>r.reject(o),r}downloadItems(e){e.length===1?this._downloadSingleFile(e[0]):this._downloadMultipleFiles(e)}_downloadSingleFile(e){for(var t=this._getFileContent(e),i=we.atob(t),r=new ArrayBuffer(i.length),a=new Uint8Array(r),o=0;o<i.length;o++)a[o]=i.charCodeAt(o);var n=new we.Blob([r],{type:"application/octet-stream"});tt.saveAs(e.name,null,n)}_downloadMultipleFiles(e){var t=aa(),i=new t;e.forEach(o=>i.file(o.name,this._getFileContent(o),{base64:!0}));var r={type:"blob",compression:"DEFLATE",mimeType:"application/zip"},a=new _;i.generateAsync?i.generateAsync(r).then(a.resolve):a.resolve(i.generate(r)),a.done(o=>tt.saveAs("files.zip",null,o))}_getFileContent(e){var t=this._findDataObject(e);return this._contentGetter(t)||""}_validateDirectoryExists(e){if(!this._isFileItemExists(e)||this._isDirGetter(e.fileItem))throw new ce(y.DirectoryNotFound,e)}_checkAbilityToMoveOrCopyItem(e,t){var i=this._findDataObject(e),r=this._getKeyFromDataObject(i,e.parentPath),a=t.getFullPathInfo(),o="";a.forEach(n=>{o=k(o,n.name);var h=this._getDataObjectKey(n.key,o);if(h===r)throw new ce(y.Other,e)})}_createDataObject(e,t,i){var r={};this._nameSetter(r,t),this._getIsDirSetter(r,i),this._keySetter(r,String(new U));var a=this._findDataObject(e),o=this._getDirectoryDataItems(a);return o.push(r),r}_createCopy(e){var t={};this._nameSetter(t,this._nameGetter(e)),this._getIsDirSetter(t,this._isDirGetter(e));var i=this._subFileItemsGetter(e);if(Array.isArray(i)){var r=[];i.forEach(a=>{var o=this._createCopy(a);r.push(o)}),this._subFileItemsSetter(t,r)}return t}_deleteItem(e){var t=this._findDataObject(e),i=this._findFileItemObj(e.pathInfo),r=this._getDirectoryDataItems(i),a=r.indexOf(t);r.splice(a,1)}_getDirectoryDataItems(e){if(!e)return this._data;var t=this._subFileItemsGetter(e);return Array.isArray(t)||(t=[],this._subFileItemsSetter(e,t)),t}_getItems(e){this._validateDirectoryExists(e);var t=e.getFullPathInfo(),i=t&&t.length>0?t[t.length-1].key:null,r=this._data;if(i){var a=this._findFileItemObj(t);r=a&&this._subFileItemsGetter(a)||[]}return this._ensureKeysForDuplicateNameItems(r),this._convertDataObjectsToFileItems(r,t)}_ensureKeysForDuplicateNameItems(e){var t={};e.forEach(i=>{var r=this._nameGetter(i);t[r]?this._ensureDataObjectKey(i):t[r]=!0})}_findDataObject(e){if(e.isRoot())return null;var t=this._findFileItemObj(e.getFullPathInfo());if(!t){var i=e.isDirectory?y.DirectoryNotFound:y.FileNotFound;throw new ce(i,e)}return t}_findFileItemObj(e){var t=this;Array.isArray(e)||(e=[]);for(var i="",r=null,a=this._data,o=function(h){r=a.find(u=>{var g=t._isDirGetter(u)||h===e.length-1;return t._getKeyFromDataObject(u,i)===e[h].key&&t._nameGetter(u)===e[h].name&&g}),r&&(i=k(i,t._nameGetter(r)),a=t._subFileItemsGetter(r))},n=0;n<e.length&&(n===0||r);n++)o(n);return r}_getKeyFromDataObject(e,t){var i=this._keyGetter(e),r=k(t,this._nameGetter(e));return this._getDataObjectKey(i,r)}_getDataObjectKey(e,t){return e||t}_ensureDataObjectKey(e){var t=this._keyGetter(e);return t||(t=String(new U),this._keySetter(e,t)),t}_hasSubDirs(e){var t=A(this._subFileItemsGetter(e),[]);if(!Array.isArray(t))return!0;for(var i=0;i<t.length;i++)if(this._isDirGetter(t[i])===!0)return!0;return!1}_getSetter(e){return x(e)?e:Di(e)}_isFileItemExists(e){return e.isDirectory&&e.isRoot()||!!this._findFileItemObj(e.getFullPathInfo())}_createFileReader(){return new we.FileReader}}function aa(){if(!it)throw Mi.Error("E1041","JSZip");return it}var oa=V(),sa="chunk",B={GET_DIR_CONTENTS:"GetDirContents",CREATE_DIR:"CreateDir",RENAME:"Rename",MOVE:"Move",COPY:"Copy",REMOVE:"Remove",UPLOAD_CHUNK:"UploadChunk",ABORT_UPLOAD:"AbortUpload",DOWLOAD:"Download"},de={GET:"GET",POST:"POST"};class na extends De{constructor(e){e=A(e,{}),super(e),this._endpointUrl=e.endpointUrl,this._beforeAjaxSend=e.beforeAjaxSend,this._beforeSubmit=e.beforeSubmit,this._requestHeaders=e.requestHeaders,this._hasSubDirsGetter=N(e.hasSubDirectoriesExpr||"hasSubDirectories")}getItems(e){var t=e.getFullPathInfo();return this._executeRequest(B.GET_DIR_CONTENTS,{pathInfo:t}).then(i=>this._convertDataObjectsToFileItems(i.result,t))}renameItem(e,t){return this._executeRequest(B.RENAME,{pathInfo:e.getFullPathInfo(),isDirectory:e.isDirectory,name:t})}createDirectory(e,t){return this._executeRequest(B.CREATE_DIR,{pathInfo:e.getFullPathInfo(),name:t})}deleteItems(e){return e.map(t=>this._executeRequest(B.REMOVE,{pathInfo:t.getFullPathInfo(),isDirectory:t.isDirectory}))}moveItems(e,t){return e.map(i=>this._executeRequest(B.MOVE,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()}))}copyItems(e,t){return e.map(i=>this._executeRequest(B.COPY,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()}))}uploadFileChunk(e,t,i){t.chunkIndex===0&&(t.customData.uploadId=new U);var r={destinationPathInfo:i.getFullPathInfo(),chunkMetadata:JSON.stringify({UploadId:t.customData.uploadId,FileName:e.name,Index:t.chunkIndex,TotalCount:t.chunkCount,FileSize:e.size})},a={url:this._endpointUrl,headers:this._requestHeaders||{},method:de.POST,dataType:"json",data:{[sa]:t.chunkBlob,arguments:JSON.stringify(r),command:B.UPLOAD_CHUNK},upload:{onprogress:O,onloadstart:O,onabort:O},xhrFields:{},cache:!1},o=new _;return this._beforeSendInternal(a),he.sendRequest(a).done(n=>{!n.success&&o.reject(n)||o.resolve()}).fail(o.reject),o.promise()}abortFileUpload(e,t,i){return this._executeRequest(B.ABORT_UPLOAD,{uploadId:t.customData.uploadId})}downloadItems(e){var t=this._getDownloadArgs(e),i=l("<form>").css({display:"none"}).attr({method:de.POST,action:t.url}),r={command:t.command,arguments:t.arguments};this._beforeSubmitInternal(r),this._appendFormDataInputsToForm(r,i),i.appendTo("body"),v.trigger(i,"submit"),setTimeout(()=>i.remove())}getItemsContent(e){var t=this._getDownloadArgs(e),i={url:t.url,headers:this._requestHeaders||{},method:de.POST,responseType:"arraybuffer",data:{command:t.command,arguments:t.arguments},upload:{onprogress:O,onloadstart:O,onabort:O},xhrFields:{},cache:!1};return this._beforeSendInternal(i),he.sendRequest(i)}_getDownloadArgs(e){var t=e.map(a=>a.getFullPathInfo()),i={pathInfoList:t},r=JSON.stringify(i);return{url:this._endpointUrl,arguments:r,command:B.DOWLOAD}}_getItemsIds(e){return e.map(t=>t.relativeName)}_executeRequest(e,t){var i=e===B.GET_DIR_CONTENTS?de.GET:de.POST,r=new _,a={url:this._getEndpointUrl(e,t),headers:this._requestHeaders||{},method:i,dataType:"json",data:{},xhrFields:{},cache:!1};return this._beforeSendInternal(a),he.sendRequest(a).then(o=>{!o.success&&r.reject(o)||r.resolve(o)},o=>r.reject(o)),r.promise()}_beforeSubmitInternal(e){x(this._beforeSubmit)&&this._beforeSubmit({formData:e})}_beforeSendInternal(e){if(x(this._beforeAjaxSend)){var t={headers:e.headers,formData:e.data,xhrFields:e.xhrFields};this._beforeAjaxSend(t),e.headers=t.headers,e.data=t.formData,e.xhrFields=t.xhrFields}Kt(e.data)?delete e.data:(e.responseType||e.upload)&&(e.data=this._createFormData(e.data))}_createFormData(e){var t=new oa.FormData;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&p(e[i])&&t.append(i,e[i]);return t}_appendFormDataInputsToForm(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&p(e[i])&&l("<input>").attr({type:"hidden",name:i,value:e[i]}).appendTo(t)}_getEndpointUrl(e,t){var i=this._getQueryString({command:e,arguments:JSON.stringify(t)}),r=this._endpointUrl&&this._endpointUrl.indexOf("?")>0?"&":"?";return this._endpointUrl+r+i}_getQueryString(e){for(var t=[],i=Object.keys(e),r=0;r<i.length;r++){var a=i[r],o=e[a];if(o!==void 0)if(o===null&&(o=""),Array.isArray(o))this._processQueryStringArrayParam(a,o,t);else{var n=this._getQueryStringPair(a,o);t.push(n)}}return t.join("&")}_processQueryStringArrayParam(e,t,i){w(t,(r,a)=>{var o=this._getQueryStringPair(e,a);i.push(o)})}_getQueryStringPair(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}_hasSubDirs(e){var t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}}class oi extends De{constructor(e){e=A(e,{}),super(e),this._hasSubDirsGetter=N(e.hasSubDirectoriesExpr||"hasSubDirectories"),this._getItemsFunction=this._ensureFunction(e.getItems,()=>[]),this._renameItemFunction=this._ensureFunction(e.renameItem),this._createDirectoryFunction=this._ensureFunction(e.createDirectory),this._deleteItemFunction=this._ensureFunction(e.deleteItem),this._moveItemFunction=this._ensureFunction(e.moveItem),this._copyItemFunction=this._ensureFunction(e.copyItem),this._uploadFileChunkFunction=this._ensureFunction(e.uploadFileChunk),this._abortFileUploadFunction=this._ensureFunction(e.abortFileUpload),this._downloadItemsFunction=this._ensureFunction(e.downloadItems),this._getItemsContentFunction=this._ensureFunction(e.getItemsContent)}getItems(e){var t=e.getFullPathInfo();return this._executeActionAsDeferred(()=>this._getItemsFunction(e),!0).then(i=>this._convertDataObjectsToFileItems(i,t))}renameItem(e,t){return this._executeActionAsDeferred(()=>this._renameItemFunction(e,t))}createDirectory(e,t){return this._executeActionAsDeferred(()=>this._createDirectoryFunction(e,t))}deleteItems(e){return e.map(t=>this._executeActionAsDeferred(()=>this._deleteItemFunction(t)))}moveItems(e,t){return e.map(i=>this._executeActionAsDeferred(()=>this._moveItemFunction(i,t)))}copyItems(e,t){return e.map(i=>this._executeActionAsDeferred(()=>this._copyItemFunction(i,t)))}uploadFileChunk(e,t,i){return this._executeActionAsDeferred(()=>this._uploadFileChunkFunction(e,t,i))}abortFileUpload(e,t,i){return this._executeActionAsDeferred(()=>this._abortFileUploadFunction(e,t,i))}downloadItems(e){return this._executeActionAsDeferred(()=>this._downloadItemsFunction(e))}getItemsContent(e){return this._executeActionAsDeferred(()=>this._getItemsContentFunction(e))}_hasSubDirs(e){var t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}_ensureFunction(e,t){return t=t||O,x(e)?e:t}}var St="Files",ee={NAVIGATION:"navigation",REFRESH:"refresh"};class la{constructor(e){e=e||{},this._options=c({},e),this._isInitialized=!1,this._dataLoading=!1,this._dataLoadingDeferred=null,this._rootDirectoryInfo=this._createRootDirectoryInfo(e.rootText),this._currentDirectoryInfo=this._rootDirectoryInfo,this._defaultIconMap=this._createDefaultIconMap(),this.startSingleLoad(),this._setSecurityController(),this._setProvider(e.fileProvider),this._initialize()}_initialize(){var e=this._options.currentPathKeys&&this._options.currentPathKeys.length?this.setCurrentPathByKeys(this._options.currentPathKeys):this.setCurrentPath(this._options.currentPath),t=()=>{this._isInitialized=!0,this._raiseInitialized()};e?E(e).always(t):t()}_setSecurityController(){this._securityController=new da({allowedFileExtensions:this._options.allowedFileExtensions,maxFileSize:this._options.uploadMaxFileSize}),this._resetState()}setAllowedFileExtensions(e){p(e)&&(this._options.allowedFileExtensions=e),this._setSecurityController(),this.refresh()}setUploadOptions(e){var{maxFileSize:t,chunkSize:i}=e;p(i)&&(this._options.uploadChunkSize=i),p(t)&&(this._options.uploadMaxFileSize=t,this._setSecurityController(),this.refresh())}_setProvider(e){this._fileProvider=this._createFileProvider(e),this._resetState()}updateProvider(e,t){return p(t)?E(this._getDirectoryByPathParts(this._rootDirectoryInfo,t,!0)).then(i=>{i!==this._rootDirectoryInfo&&this._resetCurrentDirectory(),this._setProvider(e)}).then(()=>this.setCurrentPathByKeys(t)):this._updateProviderOnly(e)}_updateProviderOnly(e){return this._resetCurrentDirectory(),this._setProvider(e),E(this.refresh())}_createFileProvider(e){if(e||(e=[]),Array.isArray(e))return new Ct({data:e});if(e instanceof De)return e;switch(e.type){case"remote":return new na(e);case"custom":return new oi(e)}return new Ct(e)}setCurrentPath(e){var t=ai(e),i=k(...t);return this.getCurrentDirectory().fileItem.relativeName===i?new _().resolve().promise():this._setCurrentDirectoryByPathParts(t)}setCurrentPathByKeys(e){return Gt(this.getCurrentDirectory().fileItem.pathKeys,e)?new _().resolve().promise():this._setCurrentDirectoryByPathParts(e,!0)}getCurrentPath(){for(var e="",t=this.getCurrentDirectory();t&&!t.fileItem.isRoot();){var i=Ve(t.fileItem.name);e=k(i,e),t=t.parentDirectory}return e}getCurrentPathKeys(){return this.getCurrentDirectory().fileItem.pathKeys}getCurrentDirectory(){return this._currentDirectoryInfo}setCurrentDirectory(e,t){if(e){if(t&&(e=this._getActualDirectoryInfo(e)),this._currentDirectoryInfo&&this._currentDirectoryInfo===e){this._raisePathPotentiallyChanged();return}var i=this._currentDirectoryInfo.fileItem.key!==e.fileItem.key;this._currentDirectoryInfo=e,i&&this._isInitialized&&(this._dataLoading||this._raiseDataLoading(ee.NAVIGATION),this._raiseSelectedDirectoryChanged(e))}}_resetCurrentDirectory(){this._currentDirectoryInfo=this._rootDirectoryInfo}getCurrentItems(e){return this._dataLoadingDeferred?this._dataLoadingDeferred.then(()=>this._getCurrentItemsInternal(e)):this._getCurrentItemsInternal(e)}_getCurrentItemsInternal(e){var t=this.getCurrentDirectory(),i=this.getDirectoryContents(t);return i.then(r=>{var a=this._separateItemsByType(r);return t.fileItem.hasSubDirectories=!!a.folders.length,e?a.files:r})}getDirectories(e,t){return this.getDirectoryContents(e,t).then(i=>i.filter(r=>r.fileItem.isDirectory))}_separateItemsByType(e){var t=[],i=[];return e.forEach(r=>r.fileItem.isDirectory?t.push(r):i.push(r)),{folders:t,files:i}}getDirectoryContents(e,t){if(!e)return new _().resolve([this._rootDirectoryInfo]).promise();if(e.itemsLoaded)return new _().resolve(e.items).promise();if(this._singleOperationLockId&&e.itemsSingleLoadErrorId===this._singleOperationLockId)return this._changeDirectoryOnError(e,t,!0),new _().reject().promise();var i=e.getInternalKey(),r=this._loadedItems[i];return r||(r=this._getFileItems(e,t).then(a=>(a=a||[],e.items=a.map(o=>o.isDirectory&&this._createDirectoryInfo(o,e)||this._createFileInfo(o,e)),e.itemsLoaded=!0,e.items),()=>(this._singleOperationLockId&&e.itemsSingleLoadErrorId!==this._singleOperationLockId&&(e.itemsSingleLoadErrorId=this._singleOperationLockId),[])),this._loadedItems[i]=r,r.always(()=>{delete this._loadedItems[i]}),r)}_getFileItems(e,t){var i=null;try{i=this._fileProvider.getItems(e.fileItem)}catch(r){return this._handleItemLoadError(e,r,t)}return E(i).then(r=>this._securityController.getAllowedItems(r),r=>this._handleItemLoadError(e,r,t))}createDirectory(e,t){var i=e.fileItem,r=this._createDirInfoByName(t,e),a=this._createEditActionInfo("create",r,e);return this._processEditAction(a,o=>{o.parentDirectory=i,o.name=t,this._editingEvents.onDirectoryCreating(o)},()=>this._fileProvider.createDirectory(i,t).done(o=>(i.isRoot()||(i.hasSubDirectories=!0),o)),()=>{var o={parentDirectory:i,name:t};this._editingEvents.onDirectoryCreated(o)},()=>this._resetDirectoryState(e,!0))}renameItem(e,t){var i=e.fileItem.createClone(),r=this._createEditActionInfo("rename",e,e.parentDirectory,{itemNewName:t});return this._processEditAction(r,(a,o)=>{o.fileItem.isDirectory||this._securityController.validateExtension(t),a.item=i,a.newName=t,this._editingEvents.onItemRenaming(a)},a=>this._fileProvider.renameItem(a,t),()=>{var a={sourceItem:i,itemName:t};this._editingEvents.onItemRenamed(a)},()=>{var a=this._getActualDirectoryInfo(e.parentDirectory);this._resetDirectoryState(a),this.setCurrentDirectory(a)})}moveItems(e,t){var i=this._createEditActionInfo("move",e,t);return this._processEditAction(i,(r,a)=>{r.item=a.fileItem,r.destinationDirectory=t.fileItem,this._editingEvents.onItemMoving(r)},r=>this._fileProvider.moveItems([r],t.fileItem),r=>{var a={sourceItem:r.fileItem,parentDirectory:t.fileItem,itemName:r.fileItem.name,itemPath:k(t.fileItem.path,r.fileItem.name)};this._editingEvents.onItemMoved(a)},r=>{e.forEach(a=>this._resetDirectoryState(a.parentDirectory,!0)),r&&(this._resetDirectoryState(t),this.setCurrentPathByKeys(t.fileItem.pathKeys),t.expanded=!0)})}copyItems(e,t){var i=this._createEditActionInfo("copy",e,t);return this._processEditAction(i,(r,a)=>{r.item=a.fileItem,r.destinationDirectory=t.fileItem,this._editingEvents.onItemCopying(r)},r=>this._fileProvider.copyItems([r],t.fileItem),r=>{var a={sourceItem:r.fileItem,parentDirectory:t.fileItem,itemName:r.fileItem.name,itemPath:k(t.fileItem.path,r.fileItem.name)};this._editingEvents.onItemCopied(a)},r=>{r&&(t=this._getActualDirectoryInfo(t),this._resetDirectoryState(t),this.setCurrentDirectory(t),t.expanded=!0)})}deleteItems(e){var t=e.length>0?e[0].parentDirectory:null,i=this._createEditActionInfo("delete",e,t);return this._processEditAction(i,(r,a)=>{r.item=a.fileItem,this._editingEvents.onItemDeleting(r)},r=>this._fileProvider.deleteItems([r]),r=>this._editingEvents.onItemDeleted({item:r.fileItem}),()=>{e.forEach(r=>{var a=this._getActualDirectoryInfo(r.parentDirectory);this._resetDirectoryState(a),this.setCurrentDirectory(a)})})}processUploadSession(e,t){var i=this._getItemInfosForUploaderFiles(e.files,t),r=this._createEditActionInfo("upload",i,t,{sessionInfo:e});return this._processEditAction(r,()=>{},(a,o)=>e.deferreds[o],()=>{},()=>this._resetDirectoryState(t,!0))}uploadFileChunk(e,t,i){var r=null;t.chunkIndex===0?(this._securityController.validateMaxFileSize(e.size),this._securityController.validateExtension(e.name),r=this._processBeforeItemEditAction(o=>{o.fileData=e,o.destinationDirectory=i,this._editingEvents.onFileUploading(o)})):r=new _().resolve().promise();var a=r.then(()=>this._fileProvider.uploadFileChunk(e,t,i));return t.chunkIndex===t.chunkCount-1&&(a=a.done(()=>{var o={fileData:e,parentDirectory:i};this._editingEvents.onFileUploaded(o)})),a}abortFileUpload(e,t,i){return E(this._fileProvider.abortFileUpload(e,t,i))}getFileUploadChunkSize(){var e=this._options.uploadChunkSize;return e&&e>0?e:this._fileProvider.getFileUploadChunkSize()}downloadItems(e){var t=e.map(i=>this._processBeforeItemEditAction(r=>{r.item=i.fileItem,this._editingEvents.onItemDownloading(r)},i));return E(...t).then(()=>{var i=e.map(r=>r.fileItem);return E(this._getItemActionResult(this._fileProvider.downloadItems(i))).then(()=>{},r=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,r)})},i=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,i)})}getItemContent(e){var t=e.map(i=>i.fileItem);return E(this._fileProvider.getItemsContent(t))}_handleItemLoadError(e,t,i){return e=this._getActualDirectoryInfo(e),this._raiseGetItemsError(e,t),this._changeDirectoryOnError(e,i),new _().reject().promise()}_raiseGetItemsError(e,t){var i=this._createEditActionInfo("getItems",e,e);this._raiseEditActionStarting(i),this._raiseEditActionResultAcquired(i),this._raiseEditActionError(i,{errorCode:t.errorCode,errorText:t.errorText,fileItem:e.fileItem,index:0})}_raiseDownloadItemsError(e,t,i){var r=this._createEditActionInfo("download",e,t),a=e.length;r.singleRequest=a===1,this._raiseEditActionStarting(r),this._raiseEditActionResultAcquired(r);for(var o=0;o<a-1;o++)this._raiseEditActionItemError(r,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[o].fileItem,index:o});this._raiseEditActionError(r,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[a-1].fileItem,index:a-1})}_changeDirectoryOnError(e,t,i){i&&(e=this._getActualDirectoryInfo(e)),this._resetDirectoryState(e),e.expanded=!1,t||this.setCurrentDirectory(e.parentDirectory)}_getItemActionResult(e){return Array.isArray(e)?e[0]:e}_processEditAction(e,t,i,r,a){var o=!1;this._raiseEditActionStarting(e);var n=e.itemInfos.map((h,u)=>this._processBeforeItemEditAction(t,h).then(()=>{var g=this._getItemActionResult(i(h.fileItem,u));return g.done(()=>r(h))}));return e.singleRequest=n.length===1,this._raiseEditActionResultAcquired(e),Ne(n,h=>{o=!0,this._raiseCompleteEditActionItem(e,h)},h=>this._raiseEditActionItemError(e,h)).then(()=>{a(o),this._raiseCompleteEditAction(e)})}_createEditActionInfo(e,t,i,r){t=Array.isArray(t)?t:[t],r=r||{};var a=t.map(o=>o.fileItem);return{name:e,itemInfos:t,items:a,directory:i,customData:r,singleRequest:!0}}_processBeforeItemEditAction(e,t){var i=new _,r=this._createBeforeActionArgs();try{e(r,t)}catch(a){return i.reject(a).promise()}if(!r.cancel)i.resolve();else{if(r.cancel===!0)return i.reject({errorText:r.errorText,errorCode:r.errorCode});Vt(r.cancel)&&E(r.cancel).then(a=>{a===!0?i.reject():xi(a)&&a.cancel===!0&&i.reject({errorText:a.errorText,errorCode:a.errorCode}),i.resolve()},i.resolve)}return i.promise()}_createBeforeActionArgs(){return{errorCode:void 0,errorText:"",cancel:!1}}_getItemInfosForUploaderFiles(e,t){for(var i=this._getPathInfo(t),r=[],a=0;a<e.length;a++){var o=e[a],n=new Q(i,o.name,!1),h=this._createFileInfo(n,t);r.push(h)}return r}refresh(){return this._lockRefresh?this._refreshDeferred:(this._lockRefresh=!0,this._executeDataLoad(()=>this._refreshDeferred=this._refreshInternal(),ee.REFRESH))}startSingleLoad(){this._singleOperationLockId=new U().toString()}endSingleLoad(){delete this._singleOperationLockId}_refreshInternal(){var e={items:this._rootDirectoryInfo.items},t=this._getDirectoryPathKeyParts(this.getCurrentDirectory());return this._resetDirectoryState(this._rootDirectoryInfo),this._loadItemsRecursive(this._rootDirectoryInfo,e).then(()=>{var i=this._findDirectoryByPathKeyParts(t);this.setCurrentDirectory(i),delete this._lockRefresh})}_loadItemsRecursive(e,t){var i=this;return this.getDirectories(e).then(r=>{for(var a=[],o=function(u){var g=t.items.find(D=>r[u].fileItem.key===D.fileItem.key);if(!g)return"continue";r[u].expanded=g.expanded,r[u].expanded&&a.push(i._loadItemsRecursive(r[u],g))},n=0;n<r.length;n++)var h=o(n);return Ne(a)},()=>null)}_setCurrentDirectoryByPathParts(e,t){return this._executeDataLoad(()=>this._setCurrentDirectoryByPathPartsInternal(e,t),ee.NAVIGATION)}_setCurrentDirectoryByPathPartsInternal(e,t){return this._getDirectoryByPathParts(this._rootDirectoryInfo,e,t).then(i=>{for(var r=i.parentDirectory;r;r=r.parentDirectory)r.expanded=!0;this.setCurrentDirectory(i)},()=>{this._raisePathPotentiallyChanged()})}_executeDataLoad(e,t){return this._dataLoadingDeferred?this._dataLoadingDeferred.then(()=>this._executeDataLoad(e,t)):(this._dataLoading=!0,this._dataLoadingDeferred=new _,this._isInitialized&&this._raiseDataLoading(t),e().always(()=>{var i=this._dataLoadingDeferred;this._dataLoadingDeferred=null,this._dataLoading=!1,i.resolve()}))}_getDirectoryByPathParts(e,t,i){if(t.length<1)return new _().resolve(e).promise();var r=i?"key":"name";return this.getDirectories(e).then(a=>{var o=a.find(h=>h.fileItem[r]===t[0]);if(!o)return new _().reject().promise();var n=[...t].splice(1);return this._getDirectoryByPathParts(o,n,i)})}_getDirectoryPathKeyParts(e){for(var t=[];e&&e.parentDirectory;)t.unshift(e.fileItem.key),e=e.parentDirectory;return t}_findDirectoryByPathKeyParts(e){var t=this._rootDirectoryInfo;if(e.length===0)return t;for(var i=0,r=t;r&&i<e.length;)r=t.items.find(a=>a.fileItem.key===e[i]),r&&(t=r),i++;return t}_getActualDirectoryInfo(e){var t=this._getDirectoryPathKeyParts(e);return this._findDirectoryByPathKeyParts(t)}_createDirInfoByName(e,t){var i=this._getPathInfo(t),r=new Q(i,e,!0);return this._createDirectoryInfo(r,t)}_createDirectoryInfo(e,t){return c(this._createFileInfo(e,t),{icon:"folder",expanded:e.isRoot(),items:[]})}_createFileInfo(e,t){return{fileItem:e,parentDirectory:t,icon:this._getFileItemDefaultIcon(e),getInternalKey(){return"FIK_".concat(this.fileItem.key)},getDisplayName(){return this.displayName||this.fileItem.name}}}_resetDirectoryState(e,t){t&&(e=this._getActualDirectoryInfo(e)),e.itemsLoaded=!1,e.items=[]}_getFileItemDefaultIcon(e){if(e.isDirectory)return"folder";var t=e.getFileExtension(),i=this._defaultIconMap[t];return i||"doc"}_createDefaultIconMap(){var e={".txt":"txtfile",".rtf":"rtffile",".doc":"docfile",".docx":"docxfile",".xls":"xlsfile",".xlsx":"xlsxfile",".ppt":"pptfile",".pptx":"pptxfile",".pdf":"pdffile"};return[".png",".gif",".jpg",".jpeg",".ico",".bmp"].forEach(t=>{e[t]="image"}),e}_createRootDirectoryInfo(e){var t=new Q(null,"",!0),i=this._createDirectoryInfo(t,null);return i.displayName=e||St,i}setRootText(e){this._rootDirectoryInfo.displayName=e||St}_raiseInitialized(){this._tryCallAction("onInitialized",{controller:this})}_raiseDataLoading(e){this._tryCallAction("onDataLoading",{operation:e})}_raiseSelectedDirectoryChanged(e){this._tryCallAction("onSelectedDirectoryChanged",{selectedDirectoryInfo:e})}_raiseEditActionStarting(e){this._tryCallAction("onEditActionStarting",e)}_raiseEditActionResultAcquired(e){this._tryCallAction("onEditActionResultAcquired",e)}_raiseEditActionError(e,t){this._tryCallAction("onEditActionError",e,t)}_raiseEditActionItemError(e,t){this._tryCallAction("onEditActionItemError",e,t)}_raiseCompleteEditActionItem(e,t){this._tryCallAction("onCompleteEditActionItem",e,t)}_raiseCompleteEditAction(e){this._tryCallAction("onCompleteEditAction",e)}_raisePathPotentiallyChanged(){this._tryCallAction("onPathPotentiallyChanged")}_tryCallAction(e){var t=Array.prototype.slice.call(arguments,1);this._isInitialized&&this._options[e]&&this._options[e](...t)}_resetState(){this._selectedDirectory=null,this._rootDirectoryInfo.items=[],this._rootDirectoryInfo.itemsLoaded=!1,this._loadedItems={}}_getPathInfo(e){for(var t=[],i=e;i&&!i.fileItem.isRoot();i=i.parentDirectory)t.unshift({key:i.fileItem.key,name:i.fileItem.name});return t}on(e,t){var i="on".concat(e);this._options[i]=t}get _editingEvents(){return this._options.editingEvents}}class da{constructor(e){this._options=c({allowedFileExtensions:[],maxFileSize:0},e),this._extensionsMap={},this._allowedFileExtensions.forEach(t=>{this._extensionsMap[t.toUpperCase()]=!0})}getAllowedItems(e){return this._allowedFileExtensions.length===0?e:e.filter(t=>t.isDirectory||this._isValidExtension(t.name))}validateExtension(e){if(!this._isValidExtension(e))throw new ce(y.WrongFileExtension,null)}validateMaxFileSize(e){if(this._maxFileSize&&e>this._maxFileSize)throw new ce(y.MaxFileSizeExceeded,null)}_isValidExtension(e){if(this._allowedFileExtensions.length===0)return!0;var t=ri(e).toUpperCase();return this._extensionsMap[t]}get _allowedFileExtensions(){return this._options.allowedFileExtensions}get _maxFileSize(){return this._options.maxFileSize}}var si={create:!1,copy:!1,move:!1,delete:!1,rename:!1,upload:!1,download:!1};class ha{constructor(e){this._actions={},this._permissions=e||{},this._initCommands()}_initCommands(){this._commands=[{name:"create",text:d.format("dxFileManager-commandCreate"),icon:"newfolder",enabled:this._permissions.create,noFileItemRequired:!0},{name:"rename",text:d.format("dxFileManager-commandRename"),icon:"rename",enabled:this._permissions.rename,isSingleFileItemCommand:!0},{name:"move",text:d.format("dxFileManager-commandMove"),icon:"movetofolder",enabled:this._permissions.move},{name:"copy",text:d.format("dxFileManager-commandCopy"),icon:"copy",enabled:this._permissions.copy},{name:"delete",text:d.format("dxFileManager-commandDelete"),icon:"trash",enabled:this._permissions.delete},{name:"download",text:d.format("dxFileManager-commandDownload"),icon:"download",enabled:this._permissions.download},{name:"upload",text:d.format("dxFileManager-commandUpload"),icon:"upload",enabled:this._permissions.upload,noFileItemRequired:!0},{name:"refresh",text:d.format("dxFileManager-commandRefresh"),icon:"dx-filemanager-i dx-filemanager-i-refresh",enabled:!0,noFileItemRequired:!0},{name:"thumbnails",text:d.format("dxFileManager-commandThumbnails"),icon:"mediumiconslayout",enabled:!0,noFileItemRequired:!0},{name:"details",text:d.format("dxFileManager-commandDetails"),icon:"detailslayout",enabled:!0,noFileItemRequired:!0},{name:"clearSelection",text:d.format("dxFileManager-commandClearSelection"),icon:"remove",enabled:!0},{name:"showNavPane",hint:d.format("dxFileManager-commandShowNavPane"),icon:"menu",enabled:!1,noFileItemRequired:!0}],this._commandMap={},this._commands.forEach(e=>{this._commandMap[e.name]=e})}registerActions(e){this._actions=c(this._actions,e)}executeCommand(e,t){var i=$(e)?e:e.name,r=this._actions[i];if(r)return r(t)}updatePermissions(e){var t=c({},si,e);this._permissions=t,w(this._permissions,i=>{this._commandMap[i].enabled=this._permissions[i]})}setCommandEnabled(e,t){var i=this.getCommandByName(e);i&&(i.enabled=t)}getCommandByName(e){return this._commandMap[e]}isCommandAvailable(e,t){var i=this.getCommandByName(e);if(!i||!i.enabled)return!1;if(i.noFileItemRequired)return!0;var r=t&&t.length||0;return r===0||t.some(a=>a.fileItem.isRoot()||a.fileItem.isParentFolder)?!1:e==="download"?t.every(a=>!a.fileItem.isDirectory):!i.isSingleFileItemCommand||r===1}}var ca="dx-filemanager-context-menu",Et={create:{},upload:{},download:{},rename:{},move:{},copy:{},delete:{},refresh:{beginGroup:!0}},ua=["beginGroup","closeMenuOnClick","disabled","icon","selectable","selected","text","visible"];class _a extends F{_initMarkup(){this._initActions(),this._isVisible=!1;var e=l("<div>").appendTo(this.$element());this._contextMenu=this._createComponent(e,Fi,{cssClass:ca,showEvent:"",onItemClick:t=>this._onContextMenuItemClick(t.itemData.name,t),onShowing:t=>this._onContextMenuShowing(t),onShown:()=>this._onContextMenuShown(),onHidden:()=>this._onContextMenuHidden()}),super._initMarkup()}showAt(e,t,i,r){var{itemData:a,itemElement:o,isActionButton:n=!1}=r;this._isVisible&&this._onContextMenuHidden(),this._menuShowingContext={targetElement:o,itemData:a,fileItems:e,event:i,isActionButton:n};var h={of:t,at:"top left",my:"top left",offset:""};i?h.offset=i.offsetX+" "+i.offsetY:(h.my="left top",h.at="left bottom",h.boundaryOffset="1"),this._contextMenu.option({target:t,position:h}),this._contextMenu.show()}createContextMenuItems(e,t,i){this._targetFileItems=e,this._targetFileItem=p(i)?i:e==null?void 0:e[0];var r=[],a=t||this.option("items");return a.forEach(o=>{var n=$(o)?o:o.name,h=this._configureItemByCommandName(n,o,e,this._targetFileItem);this._isContextMenuItemAvailable(h,e)&&r.push(h)}),r}_isContextMenuItemAvailable(e,t){return!this._isDefaultItem(e.name)||!e._autoHide?A(e.visible,!0):this._isIsolatedCreationItemCommand(e.name)&&t&&t.length?!1:this._commandManager.isCommandAvailable(e.name,t)}_isIsolatedCreationItemCommand(e){return(e==="create"||e==="upload")&&this.option("isolateCreationItemCommands")}_isDefaultItem(e){return!!Et[e]}_configureItemByCommandName(e,t,i,r){if(!this._isDefaultItem(e)){var a=c(!0,{},t);return a.originalItemData=t,this._addItemClickHandler(e,a),Array.isArray(t.items)&&(a.items=this.createContextMenuItems(i,t.items,r)),a}var o=this._createMenuItemByCommandName(e),n=Et[e];return c(o,n),o.originalItemData=t,q(o,t,ua),p(o.visible)||(o._autoHide=!0),e&&!o.name&&c(o,{name:e}),o}_createMenuItemByCommandName(e){var{text:t,icon:i}=this._commandManager.getCommandByName(e),r={name:e,text:t,icon:i};return this._addItemClickHandler(e,r),r}_addItemClickHandler(e,t){t.onItemClick=i=>this._onContextMenuItemClick(e,i)}_onContextMenuItemClick(e,t){var i,r=c(!0,{},t);if(r.itemData=t.itemData.originalItemData,r.fileSystemItem=(i=this._targetFileItem)===null||i===void 0?void 0:i.fileItem,r.viewArea=this.option("viewArea"),this._actions.onItemClick(r),this._isDefaultItem(e)){var a=this._isIsolatedCreationItemCommand(e)?null:this._targetFileItems;this._commandManager.executeCommand(e,a)}}_initActions(){this._actions={onContextMenuHidden:this._createActionByOption("onContextMenuHidden"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemClick:this._createActionByOption("onItemClick")}}_onContextMenuShowing(e){if(this._isVisible&&this._onContextMenuHidden(!0),e=c(e,this._menuShowingContext,{options:this.option(),cancel:!1}),this._actions.onContextMenuShowing(e),!e.cancel){var t=this.createContextMenuItems(this._menuShowingContext.fileItems,null,this._menuShowingContext.fileSystemItem);this._contextMenu.option("dataSource",t)}}tryUpdateVisibleContextMenu(){if(this._isVisible){var e=this.createContextMenuItems(this._targetFileItems);this._contextMenu.option("dataSource",e)}}_onContextMenuShown(){this._isVisible=!0}_onContextMenuHidden(e){this._isVisible=!1,e||(this._menuShowingContext={}),this._contextMenu.option("visible",!1),this._raiseContextMenuHidden()}_raiseContextMenuHidden(){this._actions.onContextMenuHidden()}_getDefaultOptions(){return c(super._getDefaultOptions(),{commandManager:null,onContextMenuHidden:null,onItemClick:null})}_optionChanged(e){var t=e.name;switch(t){case"commandManager":this.repaint();break;case"items":this.tryUpdateVisibleContextMenu();break;case"onItemClick":case"onContextMenuShowing":case"onContextMenuHidden":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _commandManager(){return this.option("commandManager")}}var pa="dx-filemanager-file-actions-button",ma="dx-filemanager-file-actions-button-activated",ga="dx-state-active";class ni extends F{_initMarkup(){this._createClickAction();var e=l("<div>");this.$element().append(e).addClass(pa),this._button=this._createComponent(e,H,{icon:"overflow",stylingMode:"text",onClick:t=>this._raiseClick(t)}),super._initMarkup()}_createClickAction(){this._clickAction=this._createActionByOption("onClick")}_raiseClick(e){this._clickAction(e)}_getDefaultOptions(){return c(super._getDefaultOptions(),{cssClass:"",onClick:null})}_optionChanged(e){var t=e.name;switch(t){case"cssClass":this.repaint();break;case"onClick":this._createClickAction();break;default:super._optionChanged(e)}}setActive(e){this.$element().toggleClass(ma,e),setTimeout(()=>this._button.$element().toggleClass(ga,e))}}var fa="dx-filemanager-dirs-tree",yt="dx-filemanager-focused-item",va="dx-filemanager-dirs-tree-item-text",Ia="dx-treeview-item";class li extends F{_initMarkup(){this._initActions(),this._getCurrentDirectory=this.option("getCurrentDirectory"),this._createFileActionsButton=O,this._storeExpandedState=this.option("storeExpandedState")||!1;var e=l("<div>").addClass(fa).appendTo(this.$element()),t={dataStructure:"plain",rootValue:"",createChildren:this._onFilesTreeViewCreateSubDirectories.bind(this),itemTemplate:this._createFilesTreeViewItemTemplate.bind(this),keyExpr:"getInternalKey",parentIdExpr:"parentDirectory.getInternalKey",displayExpr:i=>i.getDisplayName(),hasItemsExpr:"fileItem.hasSubDirectories",onItemClick:i=>this._actions.onDirectoryClick(i),onItemExpanded:i=>this._onFilesTreeViewItemExpanded(i),onItemCollapsed:i=>this._onFilesTreeViewItemCollapsed(i),onItemRendered:i=>this._onFilesTreeViewItemRendered(i),onContentReady:()=>this._actions.onFilesTreeViewContentReady()};this._contextMenu&&(this._contextMenu.option("onContextMenuHidden",()=>this._onContextMenuHidden()),t.onItemContextMenu=i=>this._onFilesTreeViewItemContextMenu(i),this._createFileActionsButton=(i,r)=>this._createComponent(i,ni,r)),this._filesTreeView=this._createComponent(e,bi,t)}_initActions(){this._actions={onDirectoryClick:this._createActionByOption("onDirectoryClick"),onFilesTreeViewContentReady:this._createActionByOption("onFilesTreeViewContentReady")}}_render(){super._render();var e=this;setTimeout(()=>{e._updateFocusedElement()})}_onFilesTreeViewCreateSubDirectories(e){var t=this.option("getDirectories"),i=e&&e.itemData||null;return t&&t(i,!0)}_onFilesTreeViewItemRendered(e){var{itemData:t}=e,i=this._getCurrentDirectory();i&&i.fileItem.equals(t.fileItem)&&(this._updateFocusedElement(),this._restoreScrollTopPosition())}_onFilesTreeViewItemExpanded(e){var{itemData:t}=e;this._storeExpandedState&&(t.expanded=!0)}_onFilesTreeViewItemCollapsed(e){var{itemData:t}=e;this._storeExpandedState&&(t.expanded=!1)}_createFilesTreeViewItemTemplate(e,t,i){var r=l(i),a=r.closest(this._filesTreeViewItemSelector);a.data("item",e);var o=Ae(e.icon),n=l("<span>").text(e.getDisplayName()).addClass(va),h=l("<div>");r.append(o,n,h),this._createFileActionsButton(h,{onClick:u=>this._onFileItemActionButtonClick(u)})}_onFilesTreeViewItemContextMenu(e){var{itemElement:t,event:i}=e;i.preventDefault(),i.stopPropagation();var r=l(t).data("item");this._contextMenu.showAt([r],t,i,{itemData:r,itemElement:t})}_onFileItemActionButtonClick(e){var{component:t,element:i,event:r}=e;r.stopPropagation();var a=t.$element().closest(this._filesTreeViewItemSelector),o=a.data("item"),n={itemData:o,itemElement:a,isActionButton:!0};this._contextMenu.showAt([o],i,r,n),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}toggleNodeDisabledState(e,t){var i=this._getNodeByKey(e);if(i){var r=this._filesTreeView.option("items"),a=r.map(o=>o.getInternalKey()).indexOf(i.getInternalKey());a!==-1&&this._filesTreeView.option("items[".concat(a,"].disabled"),t)}}_saveScrollTopPosition(){Z()&&(this._scrollTopPosition=this._filesTreeView.getScrollable().scrollTop())}_restoreScrollTopPosition(){!Z()||!Ut(this._scrollTopPosition)||setTimeout(()=>this._filesTreeView.getScrollable().scrollTo(this._scrollTopPosition))}_updateFocusedElement(){var e=this._getCurrentDirectory(),t=this._getItemElementByKey(e==null?void 0:e.getInternalKey());this._$focusedElement&&this._$focusedElement.toggleClass(yt,!1),this._$focusedElement=t||l(),this._$focusedElement.toggleClass(yt,!0)}_getNodeByKey(e){var t;return(t=this._filesTreeView)===null||t===void 0?void 0:t._getNode(e)}_getPublicNode(e){for(var t,i=[...(t=this._filesTreeView)===null||t===void 0?void 0:t.getNodes()];i.length;){var r=i.shift();if(r.itemData.getInternalKey()===e)return r;r.children.length&&i.push(...r.children)}}_getItemElementByKey(e){var t=this._getNodeByKey(e);if(t){var i=this._filesTreeView._getNodeElement(t);if(i)return i.children(this._filesTreeViewItemSelector)}return null}_getDefaultOptions(){return c(super._getDefaultOptions(),{storeExpandedState:!1,initialFolder:null,contextMenu:null,getItems:null,getCurrentDirectory:null,onDirectoryClick:null})}_optionChanged(e){var t=e.name;switch(t){case"storeExpandedState":this._storeExpandedState=this.option(t);break;case"getItems":case"rootFolderDisplayName":case"initialFolder":case"contextMenu":this.repaint();break;case"getCurrentDirectory":this.getCurrentDirectory=this.option(t);break;case"onDirectoryClick":case"onFilesTreeViewContentReady":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _filesTreeViewItemSelector(){return".".concat(Ia)}get _contextMenu(){return this.option("contextMenu")}toggleDirectoryExpandedState(e,t){var i=new _,r=this._getPublicNode(e==null?void 0:e.getInternalKey());if(!r)return i.reject().promise();if(r.expanded===t||r.itemsLoaded&&!r.itemData.fileItem.hasSubDirectories)return i.resolve().promise();var a=t?"expandItem":"collapseItem";return this._filesTreeView[a](e.getInternalKey())}refresh(){this._$focusedElement=null,this._saveScrollTopPosition(),this._filesTreeView.option("dataSource",[])}updateCurrentDirectory(){this._disposed||(this._updateFocusedElement(),this._storeExpandedState&&this._updateExpandedStateToCurrentDirectory())}_updateExpandedStateToCurrentDirectory(){return this.toggleDirectoryExpandedStateRecursive(this._getCurrentDirectory().parentDirectory,!0)}toggleDirectoryExpandedStateRecursive(e,t){for(var i=[],r=e;r;r=r.parentDirectory)i.unshift(r);return this.toggleDirectoryLineExpandedState(i,t)}toggleDirectoryLineExpandedState(e,t){return e.length?this.toggleDirectoryExpandedState(e.shift(),t).then(()=>this.toggleDirectoryLineExpandedState(e,t)):new _().resolve().promise()}}var Ca="dx-filemanager-files-view",Sa="dxFileManager_open";class di extends F{_init(){this._initActions(),this._lockFocusedItemProcessing=!1,this._focusedItemKey=this.option("focusedItemKey"),super._init()}_initMarkup(){this._needResetScrollPosition=!1,this.$element().addClass(Ca);var e=R(Ti,Sa);v.on(this.$element(),e,this._getItemSelector(),this._onItemDblClick.bind(this)),super._initMarkup()}_initActions(){this._actions={onError:this._createActionByOption("onError"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onSelectedItemOpened:this._createActionByOption("onSelectedItemOpened"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemListDataLoaded:this._createActionByOption("onItemListDataLoaded")}}_getDefaultOptions(){return c(super._getDefaultOptions(),{selectionMode:"single",selectedItemKeys:[],focusedItemKey:void 0,contextMenu:null,getItems:null,getItemThumbnail:null,onError:null,onSelectionChanged:null,onFocusedItemChanged:null,onSelectedItemOpened:null,onContextMenuShowing:null})}_optionChanged(e){var t=e.name;switch(t){case"selectionMode":case"contextMenu":case"getItems":case"getItemThumbnail":this.repaint();break;case"selectedItemKeys":this._setSelectedItemKeys(e.value);break;case"focusedItemKey":this._lockFocusedItemProcessing||this._setFocusedItemKey(e.value);break;case"onError":case"onSelectedItemOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onContextMenuShowing":case"onItemListDataLoaded":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_getItems(){return this._getItemsInternal().done(e=>{this._itemCount=e.length,this._itemCount===0&&this._resetFocus();var t=this._findParentDirectoryItem(e);this._hasParentDirectoryItem=!!t,this._parentDirectoryItemKey=t?t.fileItem.key:null}).always(()=>{this._onDataLoaded()})}_getItemsInternal(){var e=this.option("getItems"),t=e?e():[];return E(t)}_raiseOnError(e){this._actions.onError({error:e})}_raiseSelectionChanged(e){this._actions.onSelectionChanged(e)}_raiseFocusedItemChanged(e){this._actions.onFocusedItemChanged(e)}_raiseSelectedItemOpened(e){this._actions.onSelectedItemOpened({fileItemInfo:e})}_raiseContextMenuShowing(e){this._actions.onContextMenuShowing(e)}_raiseItemListDataLoaded(){this._actions.onItemListDataLoaded()}_onDataLoaded(){var e;this._raiseItemListDataLoaded(),(e=this._refreshDeferred)===null||e===void 0||e.resolve()}_onContentReady(){this._needResetScrollPosition&&(this._resetScrollTopPosition(),this._needResetScrollPosition=!1)}_tryRaiseSelectionChanged(e){var{selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:a,currentDeselectedItemKeys:o}=e,n=this._findParentDirectoryItem(this.getSelectedItems());n&&this._deselectItem(n);var h=!this._hasParentDirectoryItem;h=h||this._hasValidKeys(a)||this._hasValidKeys(o),h&&(t=this._filterOutItemByPredicate(t,u=>u.fileItem.key===this._parentDirectoryItemKey),i=this._filterOutParentDirectory(i),r=this._filterOutParentDirectoryKey(r,!0),a=this._filterOutParentDirectoryKey(a,!0),o=this._filterOutParentDirectoryKey(o,!0),this._raiseSelectionChanged({selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:a,currentDeselectedItemKeys:o}))}_onFocusedItemChanged(e){this._focusedItemKey!==e.itemKey&&(this._focusedItemKey=e.itemKey,this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_resetFocus(){}_resetScrollTopPosition(){Z()&&setTimeout(()=>{var e;return(e=this._getScrollable())===null||e===void 0?void 0:e.scrollTo(0)})}_getScrollable(){}_getItemThumbnail(e){var t=this.option("getItemThumbnail");return t?t(e):{thumbnail:""}}_getItemThumbnailContainer(e){var{thumbnail:t,cssClass:i}=this._getItemThumbnail(e),r=Ae(t).addClass(this._getItemThumbnailCssClass());return i&&r.addClass(i),r}_getItemThumbnailCssClass(){return""}_getItemSelector(){}_onItemDblClick(e){}_isDesktop(){return J.real().deviceType==="desktop"}_showContextMenu(e,t,i,r){this._contextMenu.showAt(e,t,i,r)}get _contextMenu(){return this.option("contextMenu")}_findParentDirectoryItem(e){for(var t=0;t<e.length;t++){var i=e[t];if(this._isParentDirectoryItem(i))return i}return null}_getFileItemsForContextMenu(e){var t=this.getSelectedItems();return this._isParentDirectoryItem(e)&&t.push(e),t}_isParentDirectoryItem(e){return e.fileItem.isParentFolder}_hasValidKeys(e){return e.length>1||e.length===1&&e[0]!==this._parentDirectoryItemKey}_filterOutParentDirectory(e,t){return this._filterOutItemByPredicate(e,i=>i.key===this._parentDirectoryItemKey,t)}_filterOutParentDirectoryKey(e,t){return this._filterOutItemByPredicate(e,i=>i===this._parentDirectoryItemKey,t)}_filterOutItemByPredicate(e,t,i){for(var r=e,a=-1,o=0;o<e.length;o++)if(t(e[o])){a=o;break}return a!==-1&&(i&&(r=[...e]),r.splice(a,1)),r}_isMultipleSelectionMode(){return this.option("selectionMode")==="multiple"}_deselectItem(e){}_setSelectedItemKeys(e){}_setFocusedItemKey(e){}_createDataSource(){return{store:new Pi({key:"fileItem.key",load:this._getItems.bind(this)})}}getSelectedItems(){}clearSelection(){}selectItem(){}refresh(e,t){}}var Ea="dx-filemanager-details",ya="dx-filemanager-details-item-thumbnail",Aa="dx-filemanager-details-item-name",Da="dx-filemanager-details-item-name-wrapper",Ma="dx-filemanager-details-item-is-directory",xa="dx-filemanager-parent-directory-item",Fa="dx-data-row",At={thumbnail:{caption:"",calculateSortValue:"isDirectory",width:36,alignment:"center",cssClass:Ma},name:{caption:d.format("dxFileManager-listDetailsColumnCaptionName")},dateModified:{caption:d.format("dxFileManager-listDetailsColumnCaptionDateModified"),width:110,hidingPriority:1},size:{caption:d.format("dxFileManager-listDetailsColumnCaptionFileSize"),width:90,alignment:"right",hidingPriority:0},isParentFolder:{caption:"isParentFolder",visible:!1,sortIndex:0,sortOrder:"asc"}};class ba extends di{_initMarkup(){this._itemCount=0,this._focusedItem=null,this._hasParentDirectoryItem=!1,this._parentDirectoryItemKey=null,this._selectAllCheckBox=null,this._selectAllCheckBoxUpdating=!1,this.$element().addClass(Ea),this._createFilesView(),this._contextMenu.option("onContextMenuHidden",()=>this._onContextMenuHidden()),super._initMarkup()}_createFilesView(){var e=l("<div>").appendTo(this.$element()),t=this._isMultipleSelectionMode()?"multiple":"none";this._filesView=this._createComponent(e,wi,{dataSource:this._createDataSource(),hoverStateEnabled:!0,selection:{mode:t,showCheckBoxesMode:this._isDesktop()?"onClick":"none"},selectedRowKeys:this.option("selectedItemKeys"),focusedRowKey:this.option("focusedItemKey"),focusedRowEnabled:!0,allowColumnResizing:!0,scrolling:{mode:"virtual"},sorting:{mode:"single",showSortIndexes:!1},loadPanel:{shading:!0},showColumnLines:!1,showRowLines:!1,columnHidingEnabled:!1,columns:this._createColumns(),onEditorPreparing:this._onEditorPreparing.bind(this),onRowPrepared:this._onRowPrepared.bind(this),onContextMenuPreparing:this._onContextMenuPreparing.bind(this),onSelectionChanged:this._onFilesViewSelectionChanged.bind(this),onFocusedRowChanged:this._onFilesViewFocusedRowChanged.bind(this),onOptionChanged:this._onFilesViewOptionChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_createColumns(){var e=this.option("detailColumns");e=e.slice(0),e=e.map(i=>{var r=i;return $(i)&&(r={dataField:i}),this._getPreparedColumn(r)});var t=this.option("customizeDetailColumns");return x(t)&&(e=t(e)),e.push(this._getPreparedColumn({dataField:"isParentFolder"})),e.forEach(i=>this._updateColumnDataField(i)),e}_getPreparedColumn(e){var t={},i="";if(this._isDefaultColumn(e.dataField)){var r=c(!0,{},At[e.dataField]);switch(i=r.cssClass||"",e.dataField){case"thumbnail":r.cellTemplate=this._createThumbnailColumnCell.bind(this),r.calculateSortValue="fileItem.".concat(r.calculateSortValue);break;case"name":r.cellTemplate=this._createNameColumnCell.bind(this),r.caption=d.format("dxFileManager-listDetailsColumnCaptionName");break;case"size":r.calculateCellValue=this._calculateSizeColumnCellValue.bind(this),r.caption=d.format("dxFileManager-listDetailsColumnCaptionFileSize"),r.calculateSortValue=a=>a.fileItem.isDirectory?-1:a.fileItem.size;break;case"dateModified":r.caption=d.format("dxFileManager-listDetailsColumnCaptionDateModified")}c(!0,t,r)}return q(t,e,["alignment","caption","dataField","dataType","hidingPriority","sortIndex","sortOrder","visible","visibleIndex","width"]),e.cssClass&&(i="".concat(i," ").concat(e.cssClass)),i&&(t.cssClass=i),t}_updateColumnDataField(e){var t=this._isDefaultColumn(e.dataField)?"":"dataItem.";return e.dataField="fileItem."+t+e.dataField,e}_isDefaultColumn(e){return!!At[e]}_onFileItemActionButtonClick(e){var{component:t,element:i,event:r}=e;r.stopPropagation();var a=t.$element().closest(this._getItemSelector()),o=a.data("item");this._selectItem(o);var n={itemData:o,itemElement:a,isActionButton:!0},h=this._getFileItemsForContextMenu(o);this._showContextMenu(h,i,r,n),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}_getItemThumbnailCssClass(){return ya}_getItemSelector(){return".".concat(Fa)}_onItemDblClick(e){var t=l(e.currentTarget),i=t.data("item");this._raiseSelectedItemOpened(i)}_isAllItemsSelected(){var e=this._hasParentDirectoryItem?this._itemCount-1:this._itemCount,t=this._filesView.option("selectedRowKeys");return t.length?t.length>=e?!0:void 0:!1}_onEditorPreparing(e){var{component:t,command:i,row:r,parentType:a,editorOptions:o}=e;this._filesView||(this._filesView=t),i==="select"&&r?this._isParentDirectoryItem(r.data)&&(o.disabled=!0):a==="headerRow"&&(o.onInitialized=n=>{var{component:h}=n;this._selectAllCheckBox=h},o.value=this._isAllItemsSelected(),o.onValueChanged=n=>this._onSelectAllCheckBoxValueChanged(n))}_onSelectAllCheckBoxValueChanged(e){var{event:t,previousValue:i,value:r}=e;if(!t){i&&!this._selectAllCheckBoxUpdating&&this._selectAllCheckBox&&this._selectAllCheckBox.option("value",i);return}this._isAllItemsSelected()!==r&&(r?this._filesView.selectAll():this._filesView.deselectAll(),t.preventDefault())}_onRowPrepared(e){var{rowType:t,rowElement:i,data:r}=e;if(t==="data"){var a=l(i);a.data("item",r),this._isParentDirectoryItem(r)&&a.addClass(xa)}}_onContextMenuPreparing(e){if(this._isDesktop()){var t=null,i={};e.row&&e.row.rowType==="data"&&(i=e.row.data,this._selectItem(i),t=this._getFileItemsForContextMenu(i));var r=c({},{targetElement:e.target==="content"&&p(e.row)?this._filesView.getRowElement(e.rowIndex):void 0,itemData:i,options:this._contextMenu.option(),event:e.event,isActionButton:!1,cancel:!1});this._raiseContextMenuShowing(r),e.items=r.cancel?[]:this._contextMenu.createContextMenuItems(t,null,i)}}_onFilesViewSelectionChanged(e){var{component:t,selectedRowsData:i,selectedRowKeys:r,currentSelectedRowKeys:a,currentDeselectedRowKeys:o}=e;this._filesView=this._filesView||t,this._selectAllCheckBox&&(this._selectAllCheckBoxUpdating=!0,this._selectAllCheckBox.option("value",this._isAllItemsSelected()),this._selectAllCheckBoxUpdating=!1);var n=i.map(h=>h.fileItem);this._tryRaiseSelectionChanged({selectedItemInfos:i,selectedItems:n,selectedItemKeys:r,currentSelectedItemKeys:a,currentDeselectedItemKeys:o})}_onFilesViewFocusedRowChanged(e){var t;if(!this._isMultipleSelectionMode()){var i;this._selectItemSingleSelection((i=e.row)===null||i===void 0?void 0:i.data)}var r=((t=e.row)===null||t===void 0?void 0:t.data.fileItem)||null;this._onFocusedItemChanged({item:r,itemKey:r==null?void 0:r.key,itemElement:e.rowElement})}_onFilesViewOptionChanged(e){var{fullName:t}=e;t.indexOf("sortOrder")>-1&&this._filesView.columnOption("isParentFolder",{sortOrder:"asc",sortIndex:0})}_resetFocus(){this._setFocusedItemKey(void 0)}_createThumbnailColumnCell(e,t){this._getItemThumbnailContainer(t.data).appendTo(e)}_createNameColumnCell(e,t){var i=l("<div>"),r=l("<span>").text(t.data.fileItem.name).addClass(Aa),a=l("<div>").append(r,i).addClass(Da);l(e).append(a),this._createComponent(i,ni,{onClick:o=>this._onFileItemActionButtonClick(o)})}_calculateSizeColumnCellValue(e){return e.fileItem.isDirectory?"":ii(e.fileItem.size)}_selectItem(e){var t=this._isMultipleSelectionMode()?this._selectItemMultipleSelection:this._selectItemSingleSelection;t.call(this,e)}_deselectItem(e){this._filesView.deselectRows([e.fileItem.key])}_selectItemSingleSelection(e){if(!this._focusedItem||!e||this._focusedItem.fileItem.key!==e.fileItem.key){var t=this._focusedItem;this._focusedItem=e;var i=[];t&&i.push(t.fileItem.key);var r=[],a=[];e&&!this._isParentDirectoryItem(e)&&(r.push(e.fileItem),a.push(e.fileItem.key)),this._raiseSelectionChanged({selectedItems:r,selectedItemKeys:a,currentSelectedItemKeys:[...a],currentDeselectedItemKeys:i})}}_selectItemMultipleSelection(e){var{fileItem:t}=e;if(!this._filesView.isRowSelected(t.key)){var i=this._filesView.getController("selection"),r=i.isSelectionWithCheckboxes();this._filesView.selectRows([t.key],r)}}_setSelectedItemKeys(e){this._filesView.option("selectedRowKeys",e)}_setFocusedItemKey(e){var t;(t=this._filesView)===null||t===void 0||t.option("focusedRowKey",e)}clearSelection(){this._isMultipleSelectionMode()?this._filesView.clearSelection():this._filesView.option("focusedRowIndex",-1)}refresh(e,t){var i={dataSource:this._createDataSource()};e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(p(e.focusedItemKey)?i.focusedRowKey=e.focusedItemKey:i.focusedRowIndex=-1);var r=!p(i.focusedRowKey)&&i.focusedRowIndex===-1;return r&&t===ee.NAVIGATION&&(i.paging={pageIndex:0},this._needResetScrollPosition=!0),this._filesView.option(i),this._refreshDeferred=new _,this._refreshDeferred.promise()}_getScrollable(){return this._filesView.getScrollable()}getSelectedItems(){return this._isMultipleSelectionMode()?this._filesView.getSelectedRowsData():this._focusedItem&&!this._isParentDirectoryItem(this._focusedItem)?[this._focusedItem]:[]}}var Ta="dx-filemanager-thumbnails-view-port",Pa="dx-filemanager-thumbnails-container",wa="dx-filemanager-thumbnails-item",Oa="dx-filemanager-thumbnails-item-name",Ra="dx-filemanager-thumbnails-item-spacer",La="dxFileManagerItemData",Ba="dxFileManagerThumbnailsListBox",Dt=R(Oi.name,Ba);class Na extends Ri{_initMarkup(){this._initActions(),this._lockFocusedItemProcessing=!1,this.$element().addClass(Ta),this._renderScrollView(),this._renderItemsContainer(),this._createScrollViewControl(),super._initMarkup(),this.onFocusedItemChanged=this._onFocusedItemChanged.bind(this),this._layoutUtils=new ka(this._scrollView,this.$element(),this._$itemContainer,this.itemElements().first()),this._syncFocusedItemKey()}_initActions(){this._actions={onItemEnterKeyPressed:this._createActionByOption("onItemEnterKeyPressed"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged")}}_initTemplates(){super._initTemplates(),this._itemThumbnailTemplate=this.option("itemThumbnailTemplate"),this._getTooltipText=this.option("getTooltipText"),this._templateManager.addDefaultTemplates({item:new Li((function(e,t,i){var r=this._getDefaultItemTemplate(i,e);e.append(r)}).bind(this),["fileItem"],this.option("integrationOptions.watchMethod"))})}_createScrollViewControl(){this._scrollView||(this._scrollView=this._createComponent(this._$scrollView,Ue,{scrollByContent:!0,scrollByThumb:!0,useKeyboard:!1,showScrollbar:"onHover"}))}_renderScrollView(){this._$scrollView||(this._$scrollView=l("<div>").appendTo(this.$element()))}getScrollable(){return this._scrollView}_renderItemsContainer(){this._$itemContainer||(this._$itemContainer=l("<div>").addClass(Pa).appendTo(this._$scrollView))}_render(){super._render(),this._detachEventHandlers(),this._attachEventHandlers()}_clean(){this._detachEventHandlers(),super._clean()}_supportedKeys(){return c(super._supportedKeys(),{upArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(-1,!1,e)},downArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(1,!1,e)},home(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(0,!0,e)},end(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(this._getItemsLength()-1,!0,e)},pageUp(e){this._beforeKeyProcessing(e),this._processPageChange(!0,e)},pageDown(e){this._beforeKeyProcessing(e),this._processPageChange(!1,e)},enter(e){this._beforeKeyProcessing(e),this._actions.onItemEnterKeyPressed(this._getFocusedItem())},A(e){this._beforeKeyProcessing(e),rt(e)&&this.selectAll()}})}_beforeKeyProcessing(e){e.preventDefault(),this._layoutUtils.reset()}_processArrowKeys(e,t,i){var r=this._getFocusedItem();if(r){if(!t){var a=this._layoutUtils.getLayoutModel();if(!a)return;e*=a.itemPerRowCount}var o=this._getIndexByItem(r)+e;this._focusItemByIndex(o,!0,i)}}_processHomeEndKeys(e,t,i){this._focusItemByIndex(e,t,i)}_processPageChange(e,t){var i=this._getFocusedItem();if(i){var r=this._layoutUtils.getLayoutModel();if(r){var a=this._layoutUtils.createItemLayoutModel(this._getIndexByItem(i)),o=e?r.rowPerPageRate:-r.rowPerPageRate,n=a.itemRowIndex-o,h=e?Math.ceil:Math.floor,u=h(n),g=u*r.itemPerRowCount+a.itemColumnIndex;g<0?g=0:g>=this._getItemsLength()&&(g=this._getItemsLength()-1),this._focusItemByIndex(g,!0,t)}}}_processLongTap(e){var t=this._closestItemElement(l(e.target)),i=this._getIndexByItemElement(t);this._selection.changeItemSelection(i,{control:!0})}_attachEventHandlers(){this.option("selectionMode")==="multiple"&&v.on(this._itemContainer(),Dt,".".concat(this._itemContentClass()),e=>{this._processLongTap(e),e.stopPropagation()}),v.on(this._itemContainer(),"mousedown selectstart",e=>{e.shiftKey&&e.preventDefault()})}_detachEventHandlers(){v.off(this._itemContainer(),Dt),v.off(this._itemContainer(),"mousedown selectstart")}_itemContainer(){return this._$itemContainer}_itemClass(){return wa}_itemDataKey(){return La}_getDefaultItemTemplate(e,t){t.attr("title",this._getTooltipText(e));var i=this._itemThumbnailTemplate(e),r=l("<div>").addClass(Ra),a=l("<div>").addClass(Oa).text(e.fileItem.name);t.append(i,r,a)}_itemSelectHandler(e){var t={};this.option("selectionMode")==="multiple"&&(this._isPreserveSelectionMode||(this._isPreserveSelectionMode=rt(e)||e.shiftKey),t={control:this._isPreserveSelectionMode,shift:e.shiftKey});var i=this._getIndexByItemElement(e.currentTarget);this._selection.changeItemSelection(i,t)}_initSelectionModule(){super._initSelectionModule();var e=c(this._selection.options,{selectedKeys:this.option("selectedItemKeys"),onSelectionChanged:t=>{this.option("selectedItems",this._getItemsByKeys(t.selectedItemKeys,t.selectedItems)),this._updateSelectedItems(t)}});this._selection=new Bi(e)}_updateSelectedItems(e){var t=e.addedItemKeys,i=e.removedItemKeys;if(this._rendered&&(t.length||i.length)){var r=this._selectionChangePromise;if(!this._rendering){var a=[],o,n=[];this._editStrategy.beginCache();for(var h=0;h<i.length;h++)o=this._getIndexByKey(i[h]),n.push(o),this._removeSelection(o);for(var u=0;u<t.length;u++)o=this._getIndexByKey(t[u]),a.push(o),this._addSelection(o);this._editStrategy.endCache(),this._updateSelection(a,n)}E(r).done(()=>this._fireSelectionChangeEvent(e))}}_fireSelectionChangeEvent(e){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})(e)}_updateSelection(e,t){var i=this.getSelectedItems().length;i===0&&(this._isPreserveSelectionMode=!1)}_normalizeSelectedItems(){var e=this._getKeysByItems(this.option("selectedItems")),t=this._selection.getSelectedItemKeys();return this._compareKeys(t,e)||this._selection.setSelection(e),new _().resolve().promise()}_focusOutHandler(){}_getItems(){return this.option("items")||[]}_getItemsLength(){return this._getItems().length}_getIndexByItemElement(e){return this._editStrategy.getNormalizedIndex(e)}_getItemByIndex(e){return this._getItems()[e]}_getFocusedItem(){return this.getItemByItemElement(this.option("focusedElement"))}_focusItem(e,t){this.option("focusedElement",this.getItemElementByItem(e)),t&&this._layoutUtils.scrollToItem(this._getIndexByItem(e))}_focusItemByIndex(e,t,i){if(e>=0&&e<this._getItemsLength()){var r=this._getItemByIndex(e);this._focusItem(r,t,i)}}_syncFocusedItemKey(){this._syncFocusedItemKeyDeferred||(this._syncFocusedItemKeyDeferred=new _);var e=this._syncFocusedItemKeyDeferred;if(this._dataSource&&this._dataSource.isLoading())return e.promise();var t=this.option("focusedItemKey");if(p(t)){var i=this.option("items"),r=i.find(a=>this.keyOf(a)===t);r?(this._focusItem(r,!0),e.resolve()):(this.option("focusedItemKey",void 0),e.reject())}else e.resolve();return this._syncFocusedItemKeyDeferred=null,e.promise()}_onFocusedItemChanged(){var e=this._getFocusedItem(),t=this.keyOf(e),i=this.option("focusedItemKey");t!==i&&(this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",t),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_raiseFocusedItemChanged(e){var t={item:e,itemElement:this.option("focusedElement")};this._actions.onFocusedItemChanged(t)}_changeItemSelection(e,t){if(this.isItemSelected(e)!==t){var i=this.getItemElementByItem(e),r=this._getIndexByItemElement(i);this._selection.changeItemSelection(r,{control:this._isPreserveSelectionMode})}}_chooseSelectOption(){return"selectedItemKeys"}getSelectedItems(){return this._selection.getSelectedItems()}getItemElementByItem(e){return this._editStrategy.getItemElement(e)}getItemByItemElement(e){return this._getItemByIndex(this._getIndexByItemElement(e))}selectAll(){this.option("selectionMode")==="multiple"&&(this._selection.selectAll(),this._isPreserveSelectionMode=!0)}selectItem(e){this._changeItemSelection(e,!0)}deselectItem(e){this._changeItemSelection(e,!1)}clearSelection(){this._selection.deselectAll()}_optionChanged(e){switch(e.name){case"items":this._layoutUtils&&this._layoutUtils.updateItems(this.itemElements().first()),super._optionChanged(e);break;case"focusedItemKey":if(this._lockFocusedItemProcessing)break;p(e.value)?this._syncFocusedItemKey().done(()=>{var t=this._getFocusedItem();this._raiseFocusedItemChanged(t)}):(this.option("focusedElement",null),this._raiseFocusedItemChanged(null));break;case"onItemEnterKeyPressed":case"onFocusedItemChanged":this._actions[e.name]=this._createActionByOption(e.name);break;default:super._optionChanged(e)}}}class ka{constructor(e,t,i,r){this._layoutModel=null,this._scrollView=e,this._$viewPort=t,this._$itemContainer=i,this._$item=r}updateItems(e){this._$item=e}reset(){this._layoutModel=null}getLayoutModel(){return this._layoutModel||(this._layoutModel=this._createLayoutModel()),this._layoutModel}_createLayoutModel(){if(!this._$item)return null;var e=Ni(this._$item,!0);if(e===0)return null;var t=ki(this._$item,!0),i=Ui(this._$itemContainer),r=zt(this._$viewPort),a=this._scrollView.scrollTop(),o=a+r,n=Math.floor(i/e),h=r/t;return{itemWidth:e,itemHeight:t,viewPortWidth:i,viewPortHeight:r,viewPortScrollTop:a,viewPortScrollBottom:o,itemPerRowCount:n,rowPerPageRate:h}}createItemLayoutModel(e){var t=this.getLayoutModel();if(!t)return null;var i=Math.floor(e/t.itemPerRowCount),r=e%t.itemPerRowCount,a=i*t.itemHeight,o=a+t.itemHeight;return{itemRowIndex:i,itemColumnIndex:r,itemTop:a,itemBottom:o}}scrollToItem(e){var t=this.getLayoutModel();if(t){var i=Math.floor(e/t.itemPerRowCount),r=i*t.itemHeight,a=r+t.itemHeight,o=t.viewPortScrollTop;r<t.viewPortScrollTop?o=r:a>t.viewPortScrollBottom&&(o=a-t.viewPortHeight),this._scrollView.scrollTo(o)}}}var Ua="dx-filemanager-thumbnails",$a="dx-filemanager-thumbnails-item",Va="dx-filemanager-thumbnails-item-thumbnail",Ka="dxFileManager_thumbnails";class Ga extends di{_initMarkup(){super._initMarkup(),this.$element().addClass(Ua);var e=R($i,Ka);v.on(this.$element(),e,this._onContextMenu.bind(this)),this._createItemList()}_createItemList(){var e=this._isMultipleSelectionMode()?"multiple":"single",t=l("<div>").appendTo(this.$element());this._itemList=this._createComponent(t,Na,{dataSource:this._createDataSource(),selectionMode:e,selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),activeStateEnabled:!0,hoverStateEnabled:!0,loopItemFocus:!1,focusStateEnabled:!0,onItemEnterKeyPressed:this._tryOpen.bind(this),itemThumbnailTemplate:this._getItemThumbnailContainer.bind(this),getTooltipText:this._getTooltipText.bind(this),onSelectionChanged:this._onItemListSelectionChanged.bind(this),onFocusedItemChanged:this._onItemListFocusedItemChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_onContextMenu(e){if(e.preventDefault(),e.stopPropagation(),!!this._isDesktop()){var t=null,i=l(e.target).closest(this._getItemSelector()),r=null;i.length>0&&(r=this._itemList.getItemByItemElement(i),this._itemList.selectItem(r),t=this._getFileItemsForContextMenu(r));var a={itemData:r,itemElement:i.length?i:void 0};this._showContextMenu(t,e.target,e,a)}}_getItemThumbnailCssClass(){return Va}_getItemSelector(){return".".concat($a)}_getTooltipText(e){var t=e.fileItem;if(t.tooltipText)return t.tooltipText;var i="".concat(t.name,`\r
`);return t.isDirectory||(i+="".concat(d.format("dxFileManager-listThumbnailsTooltipTextSize"),": ").concat(ii(t.size),`\r
`)),i+="".concat(d.format("dxFileManager-listThumbnailsTooltipTextDateModified"),": ").concat(t.dateModified),i}_onItemDblClick(e){var t=l(e.currentTarget),i=this._itemList.getItemByItemElement(t);this._tryOpen(i)}_tryOpen(e){e&&this._raiseSelectedItemOpened(e)}_getItemsInternal(){return super._getItemsInternal().then(e=>{var t=new _;return setTimeout(()=>t.resolve(e)),t.promise()})}_disableDragging(){return!1}_getDefaultOptions(){return c(super._getDefaultOptions(),{focusStateEnabled:!0})}_onItemListSelectionChanged(e){var{addedItemKeys:t,removedItemKeys:i}=e,r=this.getSelectedItems(),a=r.map(n=>n.fileItem),o=a.map(n=>n.key);this._tryRaiseSelectionChanged({selectedItemInfos:r,selectedItems:a,selectedItemKeys:o,currentSelectedItemKeys:t,currentDeselectedItemKeys:i})}_onItemListFocusedItemChanged(e){var{item:t,itemElement:i}=e;this._isMultipleSelectionMode()||this._selectItemSingleSelection(t);var r=(t==null?void 0:t.fileItem)||null;this._onFocusedItemChanged({item:r,itemKey:r==null?void 0:r.key,itemElement:i||void 0})}_getScrollable(){return this._itemList.getScrollable()}_setSelectedItemKeys(e){this._itemList.option("selectedItemKeys",e)}_setFocusedItemKey(e){this._itemList.option("focusedItemKey",e)}refresh(e,t){var i={dataSource:this._createDataSource()};return e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(i.focusedItemKey=e.focusedItemKey),e&&Object.prototype.hasOwnProperty.call(e,"selectedItemKeys")&&(i.selectedItemKeys=e.selectedItemKeys),!p(i.focusedItemKey)&&t===ee.NAVIGATION&&(this._needResetScrollPosition=!0),this._itemList.option(i),this._refreshDeferred=new _,this._refreshDeferred.promise()}_deselectItem(e){var t=this._itemList.getItemElementByItem(e);this._itemList.unselectItem(t)}_selectItemSingleSelection(e){e?this._itemList.selectItem(e):this._itemList.clearSelection()}clearSelection(){this._itemList.clearSelection()}getSelectedItems(){return this._itemList.getSelectedItems()}}var Me="dx-filemanager-toolbar",Mt="dx-filemanager-general-toolbar",za="dx-filemanager-file-toolbar",Ha=Me+"-separator-item",Wa=Me+"-viewmode-item",qa=Me+"-has-large-icon",Za="dx-filemanager-view-switcher-popup",xt={showNavPane:{location:"before"},create:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},upload:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},refresh:{location:"after",showText:"inMenu",cssClass:qa,compactMode:{showText:"inMenu",locateInMenu:"auto"}},switchView:{location:"after"},download:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},move:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},copy:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},rename:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},delete:{location:"before",compactMode:{showText:"inMenu"}},clearSelection:{location:"after",locateInMenu:"never",compactMode:{showText:"inMenu"}},separator:{location:"before"}},ja=["visible","location","locateInMenu","disabled","showText"],Xa=["accessKey","elementAttr","height","hint","icon","stylingMode","tabIndex","text","width"],Ya=["separator","switchView"],Ft={default:"dx-filemanager-i dx-filemanager-i-refresh",progress:"dx-filemanager-i dx-filemanager-i-progress",success:"dx-filemanager-i dx-filemanager-i-done",error:"dx-filemanager-i dx-filemanager-i-danger"},Ja=500;class Qa extends F{_init(){super._init(),this._generalToolbarVisible=!0,this._refreshItemState={message:"",status:"default"}}_initMarkup(){this._createItemClickedAction(),this._$viewSwitcherPopup=l("<div>").addClass(Za),this._generalToolbar=this._createToolbar(this.option("generalItems"),!this._generalToolbarVisible),this._fileToolbar=this._createToolbar(this.option("fileItems"),this._generalToolbarVisible),this._$viewSwitcherPopup.appendTo(this.$element()),this.$element().addClass(Me+" "+Mt)}_render(){super._render();var e=this._getVisibleToolbar();this._checkCompactMode(e)}_clean(){delete this._commandManager,delete this._itemClickedAction,delete this._$viewSwitcherPopup,delete this._generalToolbar,delete this._fileToolbar,super._clean()}_dimensionChanged(e){if(!e||e!=="height"){var t=this._getVisibleToolbar();this._checkCompactMode(t)}}_getVisibleToolbar(){return this._generalToolbarVisible?this._generalToolbar:this._fileToolbar}_createToolbar(e,t){var i=this._getPreparedItems(e),r=l("<div>").appendTo(this.$element()),a=this._createComponent(r,Vi,{items:i,visible:!t,onItemClick:o=>this._raiseItemClicked(o)});return a.compactMode=!1,a}_getPreparedItems(e){return e=e.map(t=>{var i=t;$(t)&&(i={name:t});var r=i.name,a=this._configureItemByCommandName(r,i);return a.originalItemData=t,r!=="separator"&&this._setItemVisibleAvailable(a),a}),this._updateSeparatorsVisibility(e),e}_updateSeparatorsVisibility(e,t){var i=!1,r=this._getMenuItems(t),a={before:!1,center:!1,after:!1},o={before:this._getItemsInGroup(e,r,"before"),center:this._getItemsInGroup(e,r,"center"),after:this._getItemsInGroup(e,r,"after")};return e.forEach((n,h)=>{var u=n.location;if(n.name==="separator"){var g=a[u]&&this._groupHasItemsAfter(o[u]);n.visible!==g&&(i=!0,n.visible=g),a[u]=!1}else this._isItemInMenu(r,n)||(a[u]=a[u]||n.visible),o[u].shift()}),t&&i&&t.repaint(),i}_getMenuItems(e){var t=e?e._getMenuItems():[];return t.map(i=>i.originalItemData)}_isItemInMenu(e,t){return!!e.length&&A(t.locateInMenu,"never")!=="never"&&e.indexOf(t.originalItemData)!==-1}_getItemsInGroup(e,t,i){return e.filter(r=>r.location===i&&!this._isItemInMenu(t,r))}_groupHasItemsAfter(e){for(var t=0;t<e.length;t++)if(e[t].name!=="separator"&&e[t].visible)return!0;return!1}_configureItemByCommandName(e,t){var i,r={},a=this._commandManager.getCommandByName(e);switch(a&&(r=this._createCommandItem(a)),e){case"separator":r=this._createSeparatorItem();break;case"switchView":r=this._createViewModeItem()}if(this._isDefaultItem(e)){var o=xt[e];c(!0,r,o);var n=r.cssClass||"";q(r,t,ja),p(t.options)&&q(r.options,t.options,Xa),q(r.options,t,["text","icon"]),t.cssClass&&(n="".concat(n," ").concat(t.cssClass)),n&&(r.cssClass=n),p(t.visible)||(r._autoHide=!0),r.widget==="dxButton"&&(r.showText==="inMenu"&&!p(r.options.hint)&&(r.options.hint=r.options.text),r.compactMode&&!p(r.options.hint)&&this._configureHintForCompactMode(r))}else c(!0,r,t),r.widget||(r.widget="dxButton"),r.widget==="dxButton"&&!r.compactMode&&!r.showText&&r.options&&r.options.icon&&r.options.text&&(r.compactMode={showText:"inMenu"});return e&&!r.name&&c(r,{name:e}),r.location=A(r.location,"before"),p((i=r.options)===null||i===void 0?void 0:i.stylingMode)||(r.widget==="dxButton"&&c(!0,r,{options:{stylingMode:"text"}}),r.widget==="dxSelectBox"&&c(!0,r,{options:{stylingMode:"filled"}})),r}_isDefaultItem(e){return!!xt[e]}_createCommandItem(e){return{widget:"dxButton",options:{text:e.text,hint:e.hint,commandText:e.text,icon:e.icon,stylingMode:"text",onClick:t=>this._executeCommand(e)}}}_createSeparatorItem(){return{template:(e,t,i)=>{l(i).addClass(Ha)}}}_createViewModeItem(){var e=["details","thumbnails"].map(r=>{var{text:a,icon:o}=this._commandManager.getCommandByName(r);return{name:r,text:a,icon:o}}),t=this.option("itemViewMode")==="thumbnails"?1:0,i={container:this._$viewSwitcherPopup};return ke()&&(i.width=Ki()?28:36),{cssClass:Wa,widget:"dxDropDownButton",options:{items:e,keyExpr:"name",selectedItemKey:this.option("itemViewMode"),displayExpr:" ",hint:e[t].text,stylingMode:"text",showArrowIcon:!1,useSelectMode:!0,dropDownOptions:i,onItemClick:r=>this._executeCommand(r.itemData.name)}}}_configureHintForCompactMode(e){e.options.hint="",e.compactMode.options=e.compactMode.options||{},e.compactMode.options.hint=e.options.text}_checkCompactMode(e){e.compactMode&&this._toggleCompactMode(e,!1);var t=this._toolbarHasItemsOverflow(e);e.compactMode!==t?(e.compactMode||this._toggleCompactMode(e,t),e.compactMode=t):e.compactMode&&this._toggleCompactMode(e,!0)}_toolbarHasItemsOverflow(e){var t=z(e.$element()),i=e._getItemsWidth();return t<i}_toggleCompactMode(e,t){var i=!1,r=e.option("items");r.forEach(a=>{if(a.compactMode){var o=null;t?(a.saved=this._getCompactModeOptions(a,a._available),o=a.compactMode):o=a.saved;var n=this._getCompactModeOptions(o,a._available);c(!0,a,n),i=!0}}),i=this._updateSeparatorsVisibility(r)||i,i&&e.repaint(),this._updateSeparatorsVisibility(r,e)}_getCompactModeOptions(e,t){var{showText:i,locateInMenu:r,options:a}=e;return{visible:t,showText:A(i,"always"),locateInMenu:A(r,"never"),options:{hint:a==null?void 0:a.hint}}}_ensureAvailableCommandsVisible(e){var t=!1,i=e.option("items");i.forEach(r=>{if(r.name!=="separator"){var a=r._available;this._setItemVisibleAvailable(r),r._available!==a&&(t=!0)}}),t=this._updateSeparatorsVisibility(i)||t,t&&e.repaint(),this._updateSeparatorsVisibility(i,e)}_setItemVisibleAvailable(e){var t,i=(t=e.originalItemData)===null||t===void 0?void 0:t.visible;e._available=this._isToolbarItemAvailable(e),e.visible=p(i)?i:e._available}_fileToolbarHasEffectiveItems(){var e=this._fileToolbar.option("items");return e.some(t=>this._isFileToolbarItemAvailable(t))}_executeCommand(e){this._commandManager.executeCommand(e)}_isToolbarItemAvailable(e){return!this._isDefaultItem(e.name)||!e._autoHide?A(e.visible,!0):e.name==="refresh"?this._generalToolbarVisible||!!this._isRefreshVisibleInFileToolbar:Ya.indexOf(e.name)>-1?!0:this._isCommandAvailable(e.name)}_isFileToolbarItemAvailable(e){var{name:t,visible:i}=e;return!this._isDefaultItem(t)&&A(i,!0)||t!=="clearSelection"&&t!=="refresh"&&this._isCommandAvailable(t)}_isCommandAvailable(e){return this._commandManager.isCommandAvailable(e,this.option("contextItems"))}_updateItemInToolbar(e,t,i){e.beginUpdate();for(var r=e.option("items"),a=0;a<r.length;a++){var o=r[a];if(o.name===t){e.option("items[".concat(a,"]"),i);break}}e.endUpdate()}_raiseItemClicked(e){var t=c(!0,{},e);t.itemData=e.itemData.originalItemData,this._itemClickedAction(t)}_createItemClickedAction(){this._itemClickedAction=this._createActionByOption("onItemClick")}_getDefaultOptions(){return c(super._getDefaultOptions(),{commandManager:null,generalItems:[],fileItems:[],contextItems:[],itemViewMode:"details",onItemClick:null})}_optionChanged(e){var t=e.name;switch(t){case"commandManager":case"itemViewMode":case"generalItems":case"fileItems":this.repaint();break;case"contextItems":this._update();break;case"onItemClick":this._itemClickedAction=this._createActionByOption(t);break;default:super._optionChanged(e)}}updateItemPermissions(){this.repaint(),this._restoreRefreshItemState()}_restoreRefreshItemState(){this.updateRefreshItem(this._refreshItemState.message,this._refreshItemState.status)}updateRefreshItem(e,t){var i=null,r=d.format("dxFileManager-commandRefresh"),a="inMenu";this._isRefreshVisibleInFileToolbar=!1,this._refreshItemState={message:e,status:t},t==="default"?i={options:{icon:Ft.default}}:(i={options:{icon:Ft[t]}},this._isRefreshVisibleInFileToolbar=!0,r=e,a="always");var o=c({},i,{visible:this._isRefreshVisibleInFileToolbar});this._applyRefreshItemOptions(i,o),this._refreshItemTextTimeout=this._updateRefreshItemText(t==="progress",r,a)}_updateRefreshItemText(e,t,i){var r={showText:i,options:{text:t}};if(e)return setTimeout(()=>{this._applyRefreshItemOptions(r),this._refreshItemTextTimeout=void 0},Ja);this._refreshItemTextTimeout&&clearTimeout(this._refreshItemTextTimeout),this._applyRefreshItemOptions(r)}_applyRefreshItemOptions(e,t){t||(t=c({},e)),this._updateItemInToolbar(this._generalToolbar,"refresh",e),this._updateItemInToolbar(this._fileToolbar,"refresh",t)}_update(){var e=this.option("contextItems").length===0||!this._fileToolbarHasEffectiveItems();this._generalToolbarVisible!==e&&(this._generalToolbar.option("visible",e),this._fileToolbar.option("visible",!e),this._generalToolbarVisible=e,this.$element().toggleClass(Mt,e),this.$element().toggleClass(za,!e));var t=this._getVisibleToolbar();this._ensureAvailableCommandsVisible(t),this._checkCompactMode(t)}get _commandManager(){return this.option("commandManager")}}var L="dx-filemanager-progress-panel",eo="".concat(L,"-container"),to="".concat(L,"-title"),io="".concat(L,"-title-text"),ro="".concat(L,"-close-button"),ao="".concat(L,"-infos-container"),bt="".concat(L,"-separator"),oo="".concat(L,"-info"),so="".concat(L,"-common"),no="".concat(L,"-info-with-details"),lo="".concat(L,"-details"),K="dx-filemanager-progress-box",ho="".concat(K,"-error"),Tt="".concat(K,"-without-close-button"),co="".concat(K,"-image"),uo="".concat(K,"-wrapper"),_o="".concat(K,"-common"),po="".concat(K,"-progress-bar"),mo="".concat(K,"-close-button"),go="dx-card";class fo extends F{_initMarkup(){super._initMarkup(),this._initActions(),this._operationCount=0,this.$element().addClass(L);var e=l("<div>").appendTo(this.$element()),t=l("<div>").addClass(eo).appendTo(e);this._scrollView=this._createComponent(e,Ue,{scrollByContent:!0,scrollByThumb:!0,showScrollbar:"onScroll"});var i=l("<div>").addClass(to).appendTo(t);l("<div>").text(d.format("dxFileManager-notificationProgressPanelTitle")).addClass(io).appendTo(i);var r=l("<div>").addClass(ro).appendTo(i);this._createComponent(r,H,{icon:"close",stylingMode:"text",onClick:()=>this._raisePanelClosed()}),this._$infosContainer=l("<div>").addClass(ao).appendTo(t),this._renderEmptyListText()}_getDefaultOptions(){return c(super._getDefaultOptions(),{onOperationClosed:null,onOperationCanceled:null,onOperationItemCanceled:null,onPanelClosed:null})}_initActions(){this._actions={onOperationClosed:this._createActionByOption("onOperationClosed"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled"),onPanelClosed:this._createActionByOption("onPanelClosed")}}_optionChanged(e){var t=e.name;switch(t){case"test":break;case"onOperationClosed":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}addOperation(e,t,i){this._operationCount?l("<div>").addClass(bt).prependTo(this._$infosContainer):this._$infosContainer.empty(),this._operationCount++;var r={customCloseHandling:t,allowProgressAutoUpdate:A(i,!0)},a=l("<div>").addClass(oo).prependTo(this._$infosContainer);r.$info=a;var o=l("<div>").addClass(so).appendTo(a);return r.common=this._createProgressBox(o,{commonText:e,showCloseButton:!0,showCloseButtonAlways:t,onCloseButtonClick:()=>this._closeOperation(r)}),r}addOperationDetails(e,t,i){e.$info.addClass(no);var r=l("<div>").addClass(lo).appendTo(e.$info);e.details=t.map((a,o)=>(a.info=e,this._createDetailsItem(r,a,o,!1,i)))}_createDetailsItem(e,t,i,r,a){var o=l("<div>").appendTo(e);return i!==-1&&o.addClass(go),this._createProgressBox(o,{commonText:t.commonText,imageUrl:t.imageUrl,skipProgressBox:r,showCloseButton:a,showCloseButtonAlways:a,onCloseButtonClick:()=>this._cancelOperationItem(t,i)})}completeOperationItem(e,t,i){e.allowProgressAutoUpdate&&this.updateOperationItemProgress(e,t,100,i),this._setCloseButtonVisible(e.details[t],!1)}updateOperationItemProgress(e,t,i,r){if(this.updateOperationCommonProgress(e,r),e.details){var a=e.details[t];a.progressBar.option("value",i)}}updateOperationCommonProgress(e,t){var i;(i=e.common.progressBar)===null||i===void 0||i.option("value",t)}completeOperation(e,t,i,r){e.completed=!0,e.common.$commonText.text(t),i?this._removeProgressBar(e.common):e.allowProgressAutoUpdate&&this.updateOperationCommonProgress(e,100),r&&this._setProgressBarText(e.common,r),this._setCloseButtonVisible(e.common,!0)}completeSingleOperationWithError(e,t){var i,r=(i=e.details)===null||i===void 0?void 0:i[0];e.completed=!0,this._renderOperationError(r||e.common,t),this._setCloseButtonVisible(e.common,!0),r&&this._setCloseButtonVisible(r,!1)}addOperationDetailsError(e,t,i){var r=e.details[t];this._renderOperationError(r,i),this._setCloseButtonVisible(r,!1)}_renderError(e,t,i){l("<div>").text(i).addClass(ho).appendTo(e)}_renderEmptyListText(){this._$infosContainer.text(d.format("dxFileManager-notificationProgressPanelEmptyListText"))}_renderOperationError(e,t){this._removeProgressBar(e),this._renderError(e.$wrapper,e.$commonText,t)}_removeProgressBar(e){e.progressBar&&(e.progressBar.dispose(),e.progressBar.$element().remove(),e.progressBar=null)}_createProgressBox(e,t){e.addClass(K),t.showCloseButtonAlways||e.addClass(Tt),t.imageUrl&&Ae(t.imageUrl).addClass(co).appendTo(e);var i=l("<div>").addClass(uo).appendTo(e),r=l("<div>").addClass(_o).text(t.commonText).appendTo(i),a=null;if(!t.skipProgressBox){var o=l("<div>").addClass(po).appendTo(i);a=this._createComponent(o,$e,{min:0,max:100,width:"100%",validationMessageMode:"always",statusFormat:(u,g)=>this._getStatusString(u,g)})}var n=null;if(t.showCloseButton){var h=l("<div>").addClass(mo).appendTo(e);n=this._createComponent(h,H,{icon:"dx-filemanager-i dx-filemanager-i-cancel",stylingMode:"text",visible:t.showCloseButtonAlways,onClick:t.onCloseButtonClick})}return{$commonText:r,progressBar:a,$element:e,$wrapper:i,closeButton:n}}_setCloseButtonVisible(e,t){e.closeButton&&(e.$element.toggleClass(Tt,!t),e.closeButton.option("visible",t))}_setProgressBarText(e,t){e.progressBar.option("statusFormat",()=>t)}_closeOperation(e){e.customCloseHandling&&!e.completed?(this._raiseOperationCanceled(e),this._setCloseButtonVisible(e.common,!1),e.details.forEach(t=>this._displayClosedOperationItem(t))):(this._raiseOperationClosed(e),e.$info.next(".".concat(bt)).remove(),e.$info.remove(),this._operationCount--,this._operationCount||this._renderEmptyListText())}_cancelOperationItem(e,t){this._raiseOperationItemCanceled(e,t);var i=e.info.details[t];this._displayClosedOperationItem(i)}_displayClosedOperationItem(e){this._setProgressBarText(e,d.format("dxFileManager-notificationProgressPanelOperationCanceled")),this._setCloseButtonVisible(e,!1)}_getStatusString(e,t){return e===1?d.format("Done"):Math.round(100*e)+"%"}_raiseOperationClosed(e){this._actions.onOperationClosed({info:e})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_raisePanelClosed(){this._actions.onPanelClosed()}}var me="dx-filemanager-progress-box",vo="".concat(me,"-error"),Io="".concat(me,"-image"),Co="".concat(me,"-wrapper"),So="".concat(me,"-common"),Ke="__operationInfoManager",T={default:"default",progress:"progress",error:"error",success:"success"};class hi{constructor(e){var{onActionProgressStatusChanged:t,isActual:i}=e;this._id=new U().toString(),this._isActual=i||!1,this._actionProgressStatus=T.default,this._raiseActionProgress=t}getId(){return this._id}isActual(){return this._isActual}createErrorDetailsProgressBox(e,t,i){var r=this._createDetailsItem(e,t);this.renderError(r.$wrapper,i)}renderError(e,t){l("<div>").text(t).addClass(vo).appendTo(e)}isActionProgressStatusDefault(){return this._actionProgressStatus===T.default}_createDetailsItem(e,t){var i=l("<div>").appendTo(e);return this._createProgressBox(i,{commonText:t.commonText,imageUrl:t.imageUrl})}_createProgressBox(e,t){e.addClass(me),t.imageUrl&&Ae(t.imageUrl).addClass(Io).appendTo(e);var i=l("<div>").addClass(Co).appendTo(e),r=l("<div>").addClass(So).text(t.commonText).appendTo(i);return{$commonText:r,$element:e,$wrapper:i}}}class Eo extends hi{addOperation(){return{[Ke]:this._id}}addOperationDetails(){}updateOperationItemProgress(){}completeOperationItem(){}finishOperation(){}completeOperation(){}completeSingleOperationWithError(){}addOperationDetailsError(){}handleDimensionChanged(){return!1}ensureProgressPanelCreated(){}tryHideActionProgress(){this._updateActionProgress("",T.default)}updateActionProgressStatus(){this._updateActionProgress("",T.default)}_updateActionProgress(e,t){t!==T.default&&t!==T.progress||(this._actionProgressStatus=t,this._raiseActionProgress(e,t))}hasNoOperations(){return!0}get _operationInProgressCount(){return 0}set _operationInProgressCount(e){}get _failedOperationCount(){return 0}set _failedOperationCount(e){}}class yo extends hi{constructor(e){super(e),this._failedOperationCount=0,this._operationInProgressCount=0}addOperation(e,t,i){this._operationInProgressCount++;var r=this._progressPanel.addOperation(e,t,i);return r[Ke]=this._id,this._updateActionProgress(e,T.progress),r}addOperationDetails(e,t,i){this._progressPanel.addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,r){this._progressPanel.updateOperationItemProgress(e,t,i,r)}completeOperationItem(e,t,i){this._progressPanel.completeOperationItem(e,t,i)}finishOperation(e,t){this._progressPanel.updateOperationCommonProgress(e,t)}completeOperation(e,t,i,r){this._operationInProgressCount--,i&&this._failedOperationCount++,this._progressPanel.completeOperation(e,t,i,r)}completeSingleOperationWithError(e,t){this._progressPanel.completeSingleOperationWithError(e,t.detailErrorText),this._notifyError(t)}addOperationDetailsError(e,t){this._progressPanel.addOperationDetailsError(e,t.itemIndex,t.detailErrorText),this._notifyError(t)}handleDimensionChanged(){return this._progressPanel&&this._progressPanel.$element().detach(),!0}ensureProgressPanelCreated(e,t){if(this._progressPanel)this._progressPanel.$element().appendTo(e);else{var i=l("<div>").appendTo(e),r=this._getProgressPanelComponent();this._progressPanel=new r(i,c({},t,{onOperationClosed:a=>{var{info:o}=a;return this._onProgressPanelOperationClosed(o)}}))}}_getProgressPanelComponent(){return fo}_onProgressPanelOperationClosed(e){e.hasError&&(this._failedOperationCount--,this.tryHideActionProgress())}tryHideActionProgress(){this.hasNoOperations()&&this._updateActionProgress("",T.default)}updateActionProgressStatus(e){if(e){var t=this._failedOperationCount===0?T.success:T.error;this._updateActionProgress("",t)}}_notifyError(e){var t=this.hasNoOperations()?T.default:T.error;this._updateActionProgress(e.commonErrorText,t)}_updateActionProgress(e,t){this._actionProgressStatus=t,this._raiseActionProgress(e,t)}hasNoOperations(){return this._operationInProgressCount===0&&this._failedOperationCount===0}get _operationInProgressCount(){return this._operationInProgressCountInternal}set _operationInProgressCount(e){this._operationInProgressCountInternal=e}get _failedOperationCount(){return this._failedOperationCountInternal}set _failedOperationCount(e){this._failedOperationCountInternal=e}}var Ao=V(),Do=1e3,j="dx-filemanager-notification",ci="".concat(j,"-drawer"),Pt="".concat(ci,"-panel"),Mo="".concat(j,"-popup"),xo="".concat(j,"-popup-error"),Fo="".concat(j,"-common"),bo="".concat(j,"-separator"),To="".concat(j,"-details"),Po="".concat(j,"-common-no-item");class wo extends F{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=this._isSmallScreen(),this._managerMap={},this._notificationManagerStubId=null,this._setNotificationManager();var e=this.option("progressPanelContainer"),t=l("<div>").addClass(ci).appendTo(e);l("<div>").addClass(Pt).appendTo(t);var i=c({opened:!1,position:"right",template:o=>this._ensureProgressPanelCreated(o)},this._getProgressDrawerAdaptiveOptions());this._progressDrawer=this._createComponent(t,Ht,i);var r=t.find(".".concat(Pt)).first(),a=this.option("contentTemplate");x(a)&&a(r,this)}_setNotificationManager(e){if(e=c({onActionProgressStatusChanged:this._raiseActionProgress.bind(this)},e),!this._notificationManagerStubId){var t=new Eo(e);this._notificationManagerStubId=t.getId(),this._managerMap[this._notificationManagerStubId]=t}if(!this._isProgressDrawerDisabled()){var i=this._getProgressManagerComponent();e.isActual=!0;var r=new i(e);this._managerMap[r.getId()]=r}}_getNotificationManager(e){var t=(e==null?void 0:e[Ke])||this._getActualNotificationManagerId();return this._managerMap[t]||this._managerMap[this._notificationManagerStubId]}_clearManagerMap(){var e=this._managerMap[this._notificationManagerStubId];delete this._managerMap,this._managerMap={[this._notificationManagerStubId]:e}}_getActualNotificationManagerId(){return Object.keys(this._managerMap).filter(e=>this._managerMap[e].isActual())[0]}tryShowProgressPanel(){var e=new _,t=this._getNotificationManager();return t.isActionProgressStatusDefault()||this._isProgressDrawerOpened()||this._isProgressDrawerDisabled()?e.resolve().promise():(setTimeout(()=>{this._progressDrawer.show().done(e.resolve),this._hidePopup(),t.tryHideActionProgress()}),e.promise())}addOperation(e,t,i){var r=this._getNotificationManager();return r.addOperation(e,t,i)}addOperationDetails(e,t,i){var r=this._getNotificationManager(e);r.addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,r){var a=this._getNotificationManager(e);a.updateOperationItemProgress(e,t,i,r)}completeOperationItem(e,t,i){var r=this._getNotificationManager(e);r.completeOperationItem(e,t,i)}finishOperation(e,t){var i=this._getNotificationManager(e);i.finishOperation(e,t)}completeOperation(e,t,i,r){var a=this._getNotificationManager(e);i||this._showPopup(t),a.completeOperation(e,t,i,r),!this._isProgressDrawerOpened()||!a.hasNoOperations()?a.updateActionProgressStatus(e):a.tryHideActionProgress()}completeSingleOperationWithError(e,t){var i=this._getNotificationManager(e);i.completeSingleOperationWithError(e,t),this._showPopupError(t)}addOperationDetailsError(e,t){var i=this._getNotificationManager(e);i.addOperationDetailsError(e,t),this._showPopupError(t)}_hideProgressPanel(){setTimeout(()=>this._progressDrawer.hide())}_isSmallScreen(){return Z()?z(Ao)<=Do:!1}_dimensionChanged(e){e&&e==="height"||this._checkAdaptiveState()}_checkAdaptiveState(){var e=this._isInAdaptiveState;if(this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&this._progressDrawer){var t=this._getNotificationManager();if(t.handleDimensionChanged()){var i=this._getProgressDrawerAdaptiveOptions();this._progressDrawer.option(i)}}}_getProgressDrawerAdaptiveOptions(){return this._isInAdaptiveState?{openedStateMode:"overlap",shading:!0,hideOnOutsideClick:!0}:{openedStateMode:"shrink",shading:!1,hideOnOutsideClick:!1}}_ensureProgressPanelCreated(e){var t=this._getNotificationManager();t.ensureProgressPanelCreated(e,{onOperationCanceled:i=>{var{info:r}=i;return this._raiseOperationCanceled(r)},onOperationItemCanceled:i=>{var{item:r,itemIndex:a}=i;return this._raiseOperationItemCanceled(r,a)},onPanelClosed:()=>this._hideProgressPanel()})}_getProgressManagerComponent(){return yo}_isProgressDrawerDisabled(){return!this.option("showProgressPanel")}_isProgressDrawerOpened(){return this._progressDrawer.option("opened")}_hidePopup(e){!this.option("showNotificationPopup")&&!e||this._getNotificationPopup().hide()}_showPopup(e,t){this._isProgressDrawerOpened()||!this.option("showNotificationPopup")||(this._getNotificationPopup().$wrapper().toggleClass(xo,!!t),this._getNotificationPopup().option("contentTemplate",e),this._getNotificationPopup().option("visible")||this._getNotificationPopup().show())}_showPopupError(e){if(this.option("showNotificationPopup")){var t=this._getNotificationManager(),i=l("<div>"),r=l("<div>").addClass(Fo).text(e.commonErrorText),a=l("<div>").addClass(bo);l("<div>").appendTo(a);var o=l("<div>").addClass(To);e.item?t.createErrorDetailsProgressBox(o,e.item,e.detailErrorText):(r.addClass(Po),t.renderError(o,e.detailErrorText)),i.append(r,a,o),this._showPopup(i,!0)}}_getNotificationPopup(){if(!this._notificationPopup){var e=l("<div>").appendTo(this.$element());this._notificationPopup=this._createComponent(e,Wt,{container:this.$element(),width:"auto",height:"auto",showTitle:!1,dragEnabled:!1,shading:!1,visible:!1,hideOnOutsideClick:!0,animation:{duration:0},position:{my:"right top",at:"right top",of:this.option("positionTarget"),offset:"-10 -5"},_wrapperClassExternal:Mo})}return this._notificationPopup}_raiseActionProgress(e,t){this._actions.onActionProgress({message:e,status:t})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_initActions(){this._actions={onActionProgress:this._createActionByOption("onActionProgress"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled")}}_getDefaultOptions(){return c(super._getDefaultOptions(),{progressPanelContainer:null,contentTemplate:null,onActionProgress:null,onOperationCanceled:null,onOperationItemCanceled:null,showProgressPanel:!0,showNotificationPopup:!0})}_optionChanged(e){var t=e.name;switch(t){case"progressPanelContainer":case"contentTemplate":break;case"showProgressPanel":this._setNotificationManager(),this._getNotificationManager().updateActionProgressStatus(),e.value||(this._hideProgressPanel(),this._clearManagerMap()),this._progressDrawer.repaint();break;case"showNotificationPopup":e.value||this._hidePopup(!0);break;case"onActionProgress":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}var Oo="dx-filemanager-dialog",Ro="dx-filemanager-dialog-popup";class Ge extends F{_initMarkup(){var e;super._initMarkup(),this._createOnClosedAction();var t=this._getDialogOptions(),i=l("<div>").appendTo(this.$element()),r={showTitle:!0,title:t.title,visible:!1,hideOnOutsideClick:!0,contentTemplate:this._createContentTemplate.bind(this),toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:t.buttonText,onClick:this._applyDialogChanges.bind(this)}},{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:d.format("dxFileManager-dialogButtonCancel"),onClick:this._closeDialog.bind(this)}}],onInitialized:a=>{var{component:o}=a;o.registerKeyHandler("enter",this._applyDialogChanges.bind(this))},onHidden:this._onPopupHidden.bind(this),onShown:this._onPopupShown.bind(this),_wrapperClassExternal:"".concat(Ro," ").concat((e=t.popupCssClass)!==null&&e!==void 0?e:"")};p(t.height)&&(r.height=t.height),p(t.maxHeight)&&(r.maxHeight=t.maxHeight),this._popup=this._createComponent(i,Wt,r)}show(){this._dialogResult=null,this._popup.show()}_getDialogOptions(){return{title:"Title",buttonText:"ButtonText",contentCssClass:"",popupCssClass:""}}_createContentTemplate(e){this._$contentElement=l("<div>").appendTo(e).addClass(Oo);var t=this._getDialogOptions().contentCssClass;t&&this._$contentElement.addClass(t)}_getDialogResult(){return null}_applyDialogChanges(){var e=this._getDialogResult();e&&(this._dialogResult=e,this._closeDialog())}_closeDialog(){this._popup.hide()}_onPopupHidden(){this._onClosedAction({dialogResult:this._dialogResult})}_onPopupShown(){}_createOnClosedAction(){this._onClosedAction=this._createActionByOption("onClosed")}_setTitle(e){this._popup.option("title",e)}_setApplyButtonOptions(e){this._popup.option("toolbarItems[0].options",e)}_getDefaultOptions(){return c(super._getDefaultOptions(),{onClosed:null})}_optionChanged(e){var t=e.name;switch(t){case"onClosed":this._createOnPathChangedAction();break;default:super._optionChanged(e)}}}var Lo="dx-filemanager-dialog-name-editor",Bo="dx-filemanager-dialog-name-editor-popup";class wt extends Ge{show(e){e=e||"",this._nameTextBox?this._nameTextBox.option("value",e):this._initialNameValue=e,super.show()}_onPopupShown(){if(this._nameTextBox){var e=this._nameTextBox._input();e.length&&e[0].select(),this._nameTextBox.focus()}}_getDialogOptions(){return c(super._getDialogOptions(),{title:this.option("title"),buttonText:this.option("buttonText"),contentCssClass:Lo,popupCssClass:Bo})}_createContentTemplate(e){super._createContentTemplate(e),this._nameTextBox=this._createComponent(l("<div>"),Gi,{value:this._initialNameValue,onEnterKey:()=>this._hasCompositionJustEnded&&this._applyDialogChanges(),onKeyDown:t=>this._checkCompositionEnded(t)}),this._$contentElement.append(this._nameTextBox.$element())}_checkCompositionEnded(e){var{event:t}=e;this._hasCompositionJustEnded=t.which!==229}_getDialogResult(){var e=this._nameTextBox.option("value");return e?{name:e}:null}_getDefaultOptions(){return c(super._getDefaultOptions(),{title:"",buttonText:""})}}var No="dx-filemanager-dialog-folder-chooser",ko="dx-filemanager-dialog-folder-chooser-popup";class Uo extends Ge{show(){var e;this._setSelectedDirInfo(null),(e=this._filesTreeView)===null||e===void 0||e.refresh(),super.show()}switchToCopyDialog(e){this._targetItemInfos=e,this._setTitle(d.format("dxFileManager-dialogDirectoryChooserCopyTitle")),this._setApplyButtonOptions({text:d.format("dxFileManager-dialogDirectoryChooserCopyButtonText"),disabled:!0})}switchToMoveDialog(e){this._targetItemInfos=e,this._setTitle(d.format("dxFileManager-dialogDirectoryChooserMoveTitle")),this._setApplyButtonOptions({text:d.format("dxFileManager-dialogDirectoryChooserMoveButtonText"),disabled:!0})}_getDialogOptions(){return c(super._getDialogOptions(),{contentCssClass:No,popupCssClass:ko})}_createContentTemplate(e){super._createContentTemplate(e),this._filesTreeView=this._createComponent(l("<div>"),li,{getDirectories:this.option("getDirectories"),getCurrentDirectory:()=>this._getDialogSelectedDirectory(),onDirectoryClick:t=>this._onFilesTreeViewDirectoryClick(t),onFilesTreeViewContentReady:()=>this._toggleUnavailableLocationsDisabled(!0)}),this._$contentElement.append(this._filesTreeView.$element())}_getDialogResult(){var e=this._getDialogSelectedDirectory();return e&&{folder:e}}_getDefaultOptions(){return c(super._getDefaultOptions(),{getItems:null})}_getDialogSelectedDirectory(){return this._selectedDirectoryInfo}_onFilesTreeViewDirectoryClick(e){var{itemData:t}=e;this._setSelectedDirInfo(t),this._filesTreeView.updateCurrentDirectory()}_setSelectedDirInfo(e){this._selectedDirectoryInfo=e,this._setApplyButtonOptions({disabled:!e})}_onPopupShown(){this._toggleUnavailableLocationsDisabled(!0),super._onPopupShown()}_onPopupHidden(){this._toggleUnavailableLocationsDisabled(!1),super._onPopupHidden()}_toggleUnavailableLocationsDisabled(e){if(this._filesTreeView){var t=this._getLocationsToProcess(e);this._filesTreeView.toggleDirectoryExpandedStateRecursive(t.locationsToExpand[0],e).then(()=>this._filesTreeView.toggleDirectoryLineExpandedState(t.locationsToCollapse,!e).then(()=>t.locationKeysToDisable.forEach(i=>this._filesTreeView.toggleNodeDisabledState(i,e))))}}_getLocationsToProcess(e){var t={},i={};this._targetItemInfos.forEach(o=>{o.parentDirectory&&(t[o.parentDirectory.getInternalKey()]=o.parentDirectory),o.fileItem.isDirectory&&(i[o.getInternalKey()]=o)});var r=vt(t),a=vt(i);return{locationsToExpand:e?r.values:[],locationsToCollapse:e?a.values:[],locationKeysToDisable:r.keys.concat(...a.keys)}}}var $o="dx-filemanager-dialog-delete-item",Vo="dx-filemanager-dialog-delete-item-popup";class Ko extends Ge{show(e){var{itemName:t,itemCount:i}=e,r=i===1?d.format("dxFileManager-dialogDeleteItemSingleItemConfirmation",t):d.format("dxFileManager-dialogDeleteItemMultipleItemsConfirmation",i);this._$text?this._$text.text(r):this._initialText=r,super.show()}_getDialogOptions(){return c(super._getDialogOptions(),{title:d.format("dxFileManager-dialogDeleteItemTitle"),buttonText:d.format("dxFileManager-dialogDeleteItemButtonText"),contentCssClass:$o,popupCssClass:Vo,height:"auto",maxHeight:"80vh"})}_createContentTemplate(e){super._createContentTemplate(e),this._$text=l("<div>").text(this._initialText).appendTo(this._$contentElement),this._createComponent(this._$contentElement,Ue,{width:"100%",height:"100%"})}_getDialogResult(){return{}}}class Go{constructor(e,t){this._$element=e,this._options=t;var i={onClosed:this._options.onDialogClosed,rtlEnabled:this._options.rtlEnabled},r=l("<div>").appendTo(this._$element);this._chooseDirectoryDialog=new Uo(r,c(i,this._options.chooseDirectoryDialog));var a=l("<div>").appendTo(this._$element);this._renameItemDialog=new wt(a,c(i,{title:d.format("dxFileManager-dialogRenameItemTitle"),buttonText:d.format("dxFileManager-dialogRenameItemButtonText")}));var o=l("<div>").appendTo(this._$element);this._createItemDialog=new wt(o,c(i,{title:d.format("dxFileManager-dialogCreateDirectoryTitle"),buttonText:d.format("dxFileManager-dialogCreateDirectoryButtonText")}));var n=l("<div>").appendTo(this._$element);this._deleteItemDialog=new Ko(n,i)}getCopyDialog(e){return this._chooseDirectoryDialog.switchToCopyDialog(e),this._chooseDirectoryDialog}getMoveDialog(e){return this._chooseDirectoryDialog.switchToMoveDialog(e),this._chooseDirectoryDialog}getRenameItemDialog(){return this._renameItemDialog}getCreateItemDialog(){return this._createItemDialog}getDeleteItemDialog(){return this._deleteItemDialog}updateDialogRtl(e){[this._chooseDirectoryDialog,this._renameItemDialog,this._createItemDialog,this._deleteItemDialog].forEach(t=>{t.option("rtlEnabled",e)})}}var zo="dx-filemanager-fileuploader",Ho="dx-filemanager-fileuploader-dropzone-placeholder";class Wo extends F{_initMarkup(){this._initActions(),this.$element().addClass(zo),this._uploaderInfos=[],this._createInternalFileUploader(),this._createDropZonePlaceholder(),this._setDropZonePlaceholderVisible(!1),super._initMarkup()}_createInternalFileUploader(){var e=this._getController().chunkSize,t=l("<div>").appendTo(this.$element()),i=this._createComponent(t,jt,{name:"file",multiple:!0,showFileList:!1,activeStateEnabled:!1,focusStateEnabled:!1,hoverStateEnabled:!1,labelText:"",readyToUploadMessage:"",accept:"*",chunkSize:e,dropZone:this.option("dropZone"),onValueChanged:a=>this._onFileUploaderValueChanged(a),onProgress:a=>this._onFileUploaderProgress(a),onUploaded:a=>this._onFileUploaderUploaded(a),onFilesUploaded:a=>this._onFileUploaderAllFilesUploaded(a),onUploadAborted:a=>this._onFileUploaderUploadAborted(a),onUploadError:a=>this._onFileUploaderUploadError(a),onDropZoneEnter:()=>this._setDropZonePlaceholderVisible(!0),onDropZoneLeave:()=>this._setDropZonePlaceholderVisible(!1)});i.option({uploadChunk:(a,o)=>this._fileUploaderUploadChunk(i,a,o),abortUpload:(a,o)=>this._fileUploaderAbortUpload(i,a,o)}),i._shouldRaiseDragLeaveBase=i._shouldRaiseDragLeave,i._shouldRaiseDragLeave=a=>this._shouldRaiseDragLeave(a,i);var r={fileUploader:i};this._uploaderInfos.push(r)}tryUpload(){var e=this._findAndUpdateAvailableUploaderInfo();e&&e.fileUploader._selectButtonClickHandler()}cancelUpload(e){this._cancelUpload(e)}cancelFileUpload(e,t){this._cancelUpload(e,t)}_cancelUpload(e,t){var{fileUploader:i}=this._findUploaderInfoBySessionId(e);i.abortUpload(t)}_fileUploaderUploadChunk(e,t,i){var{session:r,fileIndex:a}=this._findSessionByFile(e,t),o=r.controller;return i.fileIndex=a,o.uploadFileChunk(t,i)}_fileUploaderAbortUpload(e,t,i){var{session:r,fileIndex:a}=this._findSessionByFile(e,t),o=r.controller;return i.fileIndex=a,o.abortFileUpload(t,i)}_onFileUploaderValueChanged(e){var{component:t,value:i}=e;if(i.length!==0){var r=i.slice(),a=this._findUploaderInfo(t);this._uploadFiles(a,r),setTimeout(()=>{this._findAndUpdateAvailableUploaderInfo()||this._createInternalFileUploader()})}}_onFileUploaderProgress(e){var{component:t,file:i,bytesLoaded:r,bytesTotal:a}=e,{session:o,fileIndex:n}=this._findSessionByFile(t,i),h=a!==0?r/a:1,u=t.option("progress")/100,g={sessionId:o.id,fileIndex:n,commonValue:u,fileValue:h};this._raiseUploadProgress(g)}_onFileUploaderAllFilesUploaded(e){var{component:t}=e,{session:i}=this._findSessionByFile(t,t._files[0].value);this._raiseUploadFinished({sessionId:i.id,commonValue:t.option("progress")/100})}_onFileUploaderUploaded(e){var{component:t,file:i}=e,r=this._getDeferredForFile(t,i);r.resolve()}_onFileUploaderUploadAborted(e){var{component:t,file:i}=e,r=this._getDeferredForFile(t,i);r.resolve({canceled:!0})}_onFileUploaderUploadError(e){var{component:t,file:i,error:r}=e,a=this._getDeferredForFile(t,i);a.reject(r)}_createDropZonePlaceholder(){this._$dropZonePlaceholder=l("<div>").addClass(Ho).appendTo(this.option("dropZonePlaceholderContainer"))}_adjustDropZonePlaceholder(){var e=this.option("dropZone");if(!(!Z()||e.length===0)){var t=parseFloat(this._$dropZonePlaceholder.css("borderTopWidth")),i=parseFloat(this._$dropZonePlaceholder.css("borderLeftWidth")),r=this.option("dropZonePlaceholderContainer"),a=parseFloat(r.css("borderBottomWidth")),o=parseFloat(r.css("borderLeftWidth")),n=zt(r),h=r.offset(),u=e.offset();this._$dropZonePlaceholder.css({top:u.top-h.top-n-a,left:u.left-h.left-o}),zi(this._$dropZonePlaceholder,e.get(0).offsetHeight-2*t),Hi(this._$dropZonePlaceholder,e.get(0).offsetWidth-2*i)}}_setDropZonePlaceholderVisible(e){e?(this._adjustDropZonePlaceholder(),this._$dropZonePlaceholder.css("display","")):this._$dropZonePlaceholder.css("display","none")}_shouldRaiseDragLeave(e,t){return t.isMouseOverElement(e,this.option("splitterElement"))||t._shouldRaiseDragLeaveBase(e,!0)}_uploadFiles(e,t){this._setDropZonePlaceholderVisible(!1);var i=new U().toString(),r=this._getController(),a=t.map(()=>new _),o={id:i,controller:r,files:t,deferreds:a};e.session=o;var n={sessionId:i,deferreds:a,files:t};return this._raiseUploadSessionStarted(n),Ne(a).always(()=>setTimeout(()=>{e.fileUploader.reset(),e.session=null}))}_getDeferredForFile(e,t){var{session:i,fileIndex:r}=this._findSessionByFile(e,t);return i.deferreds[r]}_findSessionByFile(e,t){var i=this._findUploaderInfo(e),r=i.session,a=r.files.indexOf(t);return{session:r,fileIndex:a}}_findUploaderInfoBySessionId(e){for(var t=0;t<this._uploaderInfos.length;t++){var i=this._uploaderInfos[t],r=i.session;if(r&&r.id===e)return i}return null}_findAndUpdateAvailableUploaderInfo(){for(var e,t=null,i=0;i<this._uploaderInfos.length;i++){var r=this._uploaderInfos[i];r.fileUploader.option("dropZone",""),!t&&!r.session&&(t=r)}return(e=t)===null||e===void 0||e.fileUploader.option("dropZone",this.option("dropZone")),t}_findUploaderInfo(e){for(var t=0;t<this._uploaderInfos.length;t++){var i=this._uploaderInfos[t];if(i.fileUploader===e)return i}return null}_getController(){var e=this.option("getController");return e()}_raiseUploadSessionStarted(e){this._actions.onUploadSessionStarted({sessionInfo:e})}_raiseUploadProgress(e){this._actions.onUploadProgress(e)}_raiseUploadFinished(e){this._actions.onUploadFinished(e)}_initActions(){this._actions={onUploadSessionStarted:this._createActionByOption("onUploadSessionStarted"),onUploadProgress:this._createActionByOption("onUploadProgress"),onUploadFinished:this._createActionByOption("onUploadFinished")}}_getDefaultOptions(){return c(super._getDefaultOptions(),{getController:null,onUploadSessionStarted:null,onUploadProgress:null,onUploadFinished:null,splitterElement:null})}_optionChanged(e){var t=e.name;switch(t){case"getController":this.repaint();break;case"onUploadSessionStarted":case"onUploadProgress":case"onUploadFinished":this._actions[t]=this._createActionByOption(t);break;case"dropZone":this._findAndUpdateAvailableUploaderInfo(),this._adjustDropZonePlaceholder();break;case"dropZonePlaceholderContainer":this._$dropZonePlaceholder.detach(),this._$dropZonePlaceholder.appendTo(e.value);break;case"splitterElement":break;default:super._optionChanged(e)}}}var qo={get:(s,e)=>{switch(s){case y.NoAccess:return d.format("dxFileManager-errorNoAccess");case y.FileExists:return d.format("dxFileManager-errorFileExistsFormat",e);case y.FileNotFound:return d.format("dxFileManager-errorFileNotFoundFormat",e);case y.DirectoryExists:return d.format("dxFileManager-errorDirectoryExistsFormat",e);case y.DirectoryNotFound:return d.format("dxFileManager-errorDirectoryNotFoundFormat",e);case y.WrongFileExtension:return d.format("dxFileManager-errorWrongFileExtension");case y.MaxFileSizeExceeded:return d.format("dxFileManager-errorMaxFileSizeExceeded");case y.InvalidSymbols:return d.format("dxFileManager-errorInvalidSymbols")}return d.format("dxFileManager-errorDefault")}};class Zo extends F{_initMarkup(){super._initMarkup(),this._initActions(),this._controller=this.option("controller"),this._controller.on("EditActionStarting",this._onEditActionStarting.bind(this)),this._controller.on("EditActionResultAcquired",this._onEditActionResultAcquired.bind(this)),this._controller.on("EditActionItemError",this._onEditActionItemError.bind(this)),this._controller.on("EditActionError",this._onEditActionError.bind(this)),this._controller.on("CompleteEditActionItem",this._onCompleteEditActionItem.bind(this)),this._controller.on("CompleteEditAction",this._onCompleteEditAction.bind(this)),this._model=this.option("model"),this._uploadOperationInfoMap={},this._dialogManager=new Go(this.$element(),{chooseDirectoryDialog:{provider:this._controller._fileProvider,getDirectories:this._controller.getDirectories.bind(this._controller),getCurrentDirectory:this._controller.getCurrentDirectory.bind(this._controller)},rtlEnabled:this.option("rtlEnabled"),onDialogClosed:this._onDialogClosed.bind(this)}),this._fileUploader=this._createFileUploader();var e=this.option("notificationControl");e&&this._initNotificationControl(e),this._createMetadataMap()}_initNotificationControl(e){this._notificationControl=e,this._notificationControl.option({onOperationCanceled:t=>{var{info:i}=t;return this._onCancelUploadSession(i)},onOperationItemCanceled:t=>{var{item:i,itemIndex:r}=t;return this._onCancelFileUpload(i,r)}})}_getFileUploaderComponent(){return Wo}_createFileUploader(){var e=l("<div>").appendTo(this.$element());return this._createComponent(e,this._getFileUploaderComponent(),{getController:this._getFileUploaderController.bind(this),dropZonePlaceholderContainer:this.option("uploadDropZonePlaceholderContainer"),onUploadSessionStarted:t=>this._onUploadSessionStarted(t),onUploadProgress:t=>this._onUploadProgress(t),onUploadFinished:t=>this._onUploadFinished(t)})}setUploaderDropZone(e){this._fileUploader.option("dropZone",e)}setUploaderSplitterElement(e){this._fileUploader.option("splitterElement",e)}_getFileUploaderController(){var e=this.uploadDirectoryInfo.fileItem;return{chunkSize:this._controller.getFileUploadChunkSize(),uploadFileChunk:(t,i)=>this._controller.uploadFileChunk(t,i,e),abortFileUpload:(t,i)=>this._controller.abortFileUpload(t,i,e)}}_createMetadataMap(){this._metadataMap={create:{action:e=>this._tryCreate(e),affectsAllItems:!0,singleItemProcessingMessage:d.format("dxFileManager-editingCreateSingleItemProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingCreateSingleItemSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingCreateSingleItemErrorMessage"),commonErrorMessage:d.format("dxFileManager-editingCreateCommonErrorMessage")},rename:{action:e=>this._tryRename(e),singleItemProcessingMessage:d.format("dxFileManager-editingRenameSingleItemProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingRenameSingleItemSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingRenameSingleItemErrorMessage"),commonErrorMessage:d.format("dxFileManager-editingRenameCommonErrorMessage")},delete:{action:e=>this._tryDelete(e),singleItemProcessingMessage:d.format("dxFileManager-editingDeleteSingleItemProcessingMessage"),multipleItemsProcessingMessage:d.format("dxFileManager-editingDeleteMultipleItemsProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingDeleteSingleItemSuccessMessage"),multipleItemsSuccessMessage:d.format("dxFileManager-editingDeleteMultipleItemsSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingDeleteSingleItemErrorMessage"),multipleItemsErrorMessage:d.format("dxFileManager-editingDeleteMultipleItemsErrorMessage"),commonErrorMessage:d.format("dxFileManager-editingDeleteCommonErrorMessage")},move:{action:e=>this._tryMove(e),singleItemProcessingMessage:d.format("dxFileManager-editingMoveSingleItemProcessingMessage"),multipleItemsProcessingMessage:d.format("dxFileManager-editingMoveMultipleItemsProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingMoveSingleItemSuccessMessage"),multipleItemsSuccessMessage:d.format("dxFileManager-editingMoveMultipleItemsSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingMoveSingleItemErrorMessage"),multipleItemsErrorMessage:d.format("dxFileManager-editingMoveMultipleItemsErrorMessage"),commonErrorMessage:d.format("dxFileManager-editingMoveCommonErrorMessage")},copy:{action:e=>this._tryCopy(e),singleItemProcessingMessage:d.format("dxFileManager-editingCopySingleItemProcessingMessage"),multipleItemsProcessingMessage:d.format("dxFileManager-editingCopyMultipleItemsProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingCopySingleItemSuccessMessage"),multipleItemsSuccessMessage:d.format("dxFileManager-editingCopyMultipleItemsSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingCopySingleItemErrorMessage"),multipleItemsErrorMessage:d.format("dxFileManager-editingCopyMultipleItemsErrorMessage"),commonErrorMessage:d.format("dxFileManager-editingCopyCommonErrorMessage")},upload:{action:e=>this._tryUpload(e),allowCancel:!0,allowItemProgress:!0,singleItemProcessingMessage:d.format("dxFileManager-editingUploadSingleItemProcessingMessage"),multipleItemsProcessingMessage:d.format("dxFileManager-editingUploadMultipleItemsProcessingMessage"),singleItemSuccessMessage:d.format("dxFileManager-editingUploadSingleItemSuccessMessage"),multipleItemsSuccessMessage:d.format("dxFileManager-editingUploadMultipleItemsSuccessMessage"),singleItemErrorMessage:d.format("dxFileManager-editingUploadSingleItemErrorMessage"),multipleItemsErrorMessage:d.format("dxFileManager-editingUploadMultipleItemsErrorMessage"),canceledMessage:d.format("dxFileManager-editingUploadCanceledMessage")},download:{action:e=>this._download(e),singleItemProcessingMessage:"",multipleItemsProcessingMessage:"",singleItemErrorMessage:d.format("dxFileManager-editingDownloadSingleItemErrorMessage"),multipleItemsErrorMessage:d.format("dxFileManager-editingDownloadMultipleItemsErrorMessage")},getItemContent:{action:e=>this._getItemContent(e)},getItems:{singleItemProcessingMessage:"",singleItemErrorMessage:d.format("dxFileManager-errorDirectoryOpenFailed"),commonErrorMessage:d.format("dxFileManager-errorDirectoryOpenFailed")}}}getCommandActions(){var e={};return w(this._metadataMap,t=>{Object.prototype.hasOwnProperty.call(this._metadataMap,t)&&(e[t]=i=>this._executeAction(t,i))}),e}_executeAction(e,t){var i=this._metadataMap[e];return i?i.action(t):null}_onCancelUploadSession(e){this._fileUploader.cancelUpload(e.uploadSessionId)}_onCancelFileUpload(e,t){this._fileUploader.cancelFileUpload(e.info.uploadSessionId,t)}_onUploadProgress(e){var{sessionId:t,fileIndex:i,commonValue:r,fileValue:a}=e,{operationInfo:o}=this._uploadOperationInfoMap[t];this._notificationControl.updateOperationItemProgress(o,i,100*a,100*r)}_onUploadFinished(e){var{sessionId:t,commonValue:i}=e,{operationInfo:r}=this._uploadOperationInfoMap[t];this._notificationControl.finishOperation(r,100*i),this._scheduleUploadSessionDisposal(t,"uploader")}_onUploadSessionStarted(e){var{sessionInfo:t}=e;this._controller.processUploadSession(t,this.uploadDirectoryInfo)}_onEditActionStarting(e){var t=this._metadataMap[e.name],i=new jo(t,e.itemInfos,e.directory),r=this._notificationControl.addOperation(i.processingMessage,t.allowCancel,!t.allowItemProgress);switch(c(e.customData,{context:i,operationInfo:r}),e.name){case"upload":var a=e.customData.sessionInfo.sessionId;r.uploadSessionId=a,this._uploadOperationInfoMap[a]={operationInfo:r};break;case"rename":e.customData.context.itemNewName=e.customData.itemNewName}}_onEditActionResultAcquired(e){var{context:t,operationInfo:i}=e.customData;t.singleRequest=e.singleRequest;var r=t.itemInfos.map(a=>this._getItemProgressDisplayInfo(a));this._notificationControl.addOperationDetails(i,r,t.actionMetadata.allowCancel)}_onEditActionError(e,t){var{context:i,operationInfo:r}=e.customData;i.singleRequest=e.singleRequest,this._handleActionError(r,i,t),this._completeAction(r,i)}_onEditActionItemError(e,t){var{context:i,operationInfo:r}=e.customData;this._handleActionError(r,i,t)}_onCompleteEditActionItem(e,t){var{context:i,operationInfo:r}=e.customData;(!t.result||!t.result.canceled)&&(i.completeOperationItem(t.index),this._notificationControl.completeOperationItem(r,t.index,i.commonProgress))}_onCompleteEditAction(e){var{context:t,operationInfo:i}=e.customData;this._completeAction(i,t),e.name==="upload"&&this._scheduleUploadSessionDisposal(e.customData.sessionInfo.sessionId,"controller")}_scheduleUploadSessionDisposal(e,t){p(this._uploadOperationInfoMap[e].requester)&&this._uploadOperationInfoMap[e].requester!==t?delete this._uploadOperationInfoMap[e]:this._uploadOperationInfoMap[e].requester=t}_tryCreate(e){var t=e&&e[0]||this._getCurrentDirectory(),i=d.format("dxFileManager-newDirectoryName");return this._showDialog(this._dialogManager.getCreateItemDialog(),i).then(r=>{var{name:a}=r;return this._controller.createDirectory(t,a)})}_tryRename(e){var t=e&&e[0]||this._model.getMultipleSelectedItems()[0];return t?this._showDialog(this._dialogManager.getRenameItemDialog(),t.fileItem.name).then(i=>{var{name:r}=i;return this._controller.renameItem(t,r)}):new _().reject().promise()}_tryDelete(e){if(e=e||this._model.getMultipleSelectedItems(),e.length===0)return new _().reject().promise();var t=e[0].fileItem.name,i=e.length;return this._showDialog(this._dialogManager.getDeleteItemDialog(),{itemName:t,itemCount:i}).then(()=>this._controller.deleteItems(e))}_tryMove(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new _().reject().promise():this._showDialog(this._dialogManager.getMoveDialog(e)).then(t=>{var{folder:i}=t;return this._controller.moveItems(e,i)})}_tryCopy(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new _().reject().promise():this._showDialog(this._dialogManager.getCopyDialog(e)).then(t=>{var{folder:i}=t;return this._controller.copyItems(e,i)})}_tryUpload(e){this._uploadDirectoryInfo=e==null?void 0:e[0],this._fileUploader.tryUpload()}_download(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new _().reject().promise():this._controller.downloadItems(e)}_getItemContent(e){return e=e||this._model.getMultipleSelectedItems(),this._controller.getItemContent(e)}_completeAction(e,t){this._notificationControl.completeOperation(e,t.completionMessage,!t.success,t.statusText),t.hasModifiedItems()&&this._raiseOnSuccess(t.onlyFiles)}_handleActionError(e,t,i){e.hasError=!0,t.singleRequest?this._handleSingleRequestActionError(e,t,i):this._handleMultipleRequestActionError(e,t,i)}_handleSingleRequestActionError(e,t,i){var r=t.getItemForSingleRequestError(),a=t.getItemName(i.errorCode),o=this._getErrorText(i,r,a);t.processSingleRequestError(o);var n=this._getOperationErrorInfo(t);this._notificationControl.completeSingleOperationWithError(e,n),t.multipleItems&&this._raiseOnSuccess(t.onlyFiles)}_handleMultipleRequestActionError(e,t,i){var r=t.getItemForMultipleRequestError(i.index),a=t.getItemName(i.errorCode,i.index),o=this._getErrorText(i,r,a);t.processMultipleRequestError(i.index,o);var n=this._getOperationErrorInfo(t);this._notificationControl.addOperationDetailsError(e,n)}_getOperationErrorInfo(e){var t=e.errorState.currentDetailError;return{commonErrorText:e.errorState.commonErrorText,item:t.itemInfo?this._getItemProgressDisplayInfo(t.itemInfo):null,itemIndex:t.itemIndex,detailErrorText:t.errorText}}_getErrorText(e,t,i){var r=e.errorText||qo.get(e.errorCode,i),a={fileSystemItem:t==null?void 0:t.fileItem,errorCode:e.errorCode,errorText:r};return this._raiseOnError(a),a.errorText}_getItemProgressDisplayInfo(e){return{commonText:e.fileItem.name,imageUrl:this._getItemThumbnail(e)}}_showDialog(e,t){return this._dialogDeferred=new _,e.show(t),this._dialogDeferred.promise()}_onDialogClosed(e){var t=e.dialogResult;t?this._dialogDeferred.resolve(t):this._dialogDeferred.reject()}updateDialogRtl(e){this._dialogManager.updateDialogRtl(e)}_getItemThumbnail(e){var t=this.option("getItemThumbnail");if(!t)return null;var i=t(e);return i?i.thumbnail:null}_initActions(){this._actions={onSuccess:this._createActionByOption("onSuccess"),onError:this._createActionByOption("onError")}}_getDefaultOptions(){return c(super._getDefaultOptions(),{model:{getMultipleSelectedItems:null},notificationControl:null,getItemThumbnail:null,onSuccess:null,onError:null})}_optionChanged(e){var t=e.name;switch(t){case"model":this.repaint();break;case"notificationControl":this._initNotificationControl(e.value);break;case"getItemThumbnail":break;case"uploadDropZonePlaceholderContainer":this._fileUploader.option("dropZonePlaceholderContainer",e.value);break;case"onSuccess":case"onError":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_raiseOnSuccess(e){this._actions.onSuccess({updatedOnlyFiles:e})}_raiseOnError(e){this._actions.onError(e)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}get uploadDirectoryInfo(){return this._uploadDirectoryInfo||this._getCurrentDirectory()}}class jo{constructor(e,t,i){this._actionMetadata=e,this._itemInfos=t,this._onlyFiles=!this._actionMetadata.affectsAllItems&&this._itemInfos.every(r=>!r.fileItem.isDirectory),this._items=this._itemInfos.map(r=>r.fileItem),this._multipleItems=this._items.length>1,this._location=i.getDisplayName(),this._singleRequest=!0,this._completedItems=[],this._commonProgress=0,this._errorState={failedCount:0},this._itemNewName=""}completeOperationItem(e){if(this._singleRequest)this._completedItems=[...this._items];else{var t=this._items[e];this._completedItems.push(t)}this._actionMetadata.allowItemProgress||(this._commonProgress=this._completedItems.length/this._items.length*100)}processSingleRequestError(e){this._errorState.failedCount=1,this._errorState.commonErrorText=this._multipleItems?this._actionMetadata.commonErrorMessage:this._actionMetadata.singleItemErrorMessage;var t=this._multipleItems?-1:1,i=this.getItemForSingleRequestError();this._setCurrentDetailError(t,i,e)}processMultipleRequestError(e,t){this._errorState.failedCount++,this._errorState.commonErrorText=this._errorState.failedCount>1?Y(this._actionMetadata.multipleItemsErrorMessage,this._errorState.failedCount):this._actionMetadata.singleItemErrorMessage;var i=this.getItemForMultipleRequestError(e);this._setCurrentDetailError(e,i,t)}hasModifiedItems(){return this._hasCompletedItems()||this._singleRequest&&!this.success&&this._multipleItems}getItemForSingleRequestError(){return this._multipleItems?null:this._itemInfos[0]}getItemForMultipleRequestError(e){return this._itemInfos[e]}getItemName(e,t){var i=this.singleRequest?this.getItemForSingleRequestError():this.getItemForMultipleRequestError(t),r=i==null?void 0:i.fileItem.name;return this.itemNewName&&this._isItemExistsErrorCode(e)&&(r=this.itemNewName),r}_isItemExistsErrorCode(e){return e===y.DirectoryExists||e===y.FileExists}_setCurrentDetailError(e,t,i){this._errorState.currentDetailError={itemIndex:e,itemInfo:t,errorText:i}}_hasCompletedItems(){return this._completedItems.length>0}get actionMetadata(){return this._actionMetadata}get itemInfos(){return this._itemInfos}get itemNewName(){return this._itemNewName}set itemNewName(e){this._itemNewName=e}get errorState(){return this._errorState}get singleRequest(){return this._singleRequest}set singleRequest(e){this._singleRequest=e}get multipleItems(){return this._multipleItems}get onlyFiles(){return this._onlyFiles}get processingMessage(){return this._multipleItems?Y(this._actionMetadata.multipleItemsProcessingMessage,this._items.length,this._location):Y(this._actionMetadata.singleItemProcessingMessage,this._location)}get successMessage(){return this._hasCompletedItems()?this._multipleItems?Y(this._actionMetadata.multipleItemsSuccessMessage,this._completedItems.length,this._location):Y(this._actionMetadata.singleItemSuccessMessage,this._location):this._multipleItems?Y(this._actionMetadata.multipleItemsErrorMessage,this._items.length):this._actionMetadata.singleItemErrorMessage}get completionMessage(){return this.success?this.successMessage:this.errorState.commonErrorText}get statusText(){return this.success&&!this._hasCompletedItems()?this._actionMetadata.canceledMessage:void 0}get commonProgress(){return this._commonProgress}get success(){return!this._errorState.failedCount}}var xe="dx-filemanager-breadcrumbs",Xo=xe+"-parent-folder-item",Yo=xe+"-separator-item",Jo=xe+"-path-separator-item";class Qo extends F{_init(){super._init(),this._currentDirectory=null}_initMarkup(){super._initMarkup(),this._initActions(),this._currentDirectory&&this._renderMenu(),this.$element().addClass(xe)}setCurrentDirectory(e){this._areDirsEqual(this._currentDirectory,e)||(this._currentDirectory=e,this.repaint())}_renderMenu(){var e=l("<div>").appendTo(this.$element());this._menu=this._createComponent(e,Wi,{dataSource:this._getMenuItems(),onItemClick:this._onItemClick.bind(this),onItemRendered:this._onItemRendered.bind(this)})}_getMenuItems(){var e=this._getParentDirsLine(),t=[{icon:"arrowup",directory:this._currentDirectory.parentDirectory,isPathItem:!0,cssClass:Xo},{text:" ",cssClass:Yo}];return e.forEach((i,r)=>{t.push({text:i.getDisplayName(),directory:i,isPathItem:!0}),r!==e.length-1&&t.push({icon:"spinnext",cssClass:Jo})}),t}_onItemClick(e){var{itemData:t}=e;if(t.isPathItem){var i=t.directory;this._areDirsEqual(i,this._currentDirectory)||this._raiseCurrentDirectoryChanged(i)}}_onItemRendered(e){var{itemElement:t,itemData:i}=e;i.cssClass&&l(t).addClass(i.cssClass)}_getParentDirsLine(){for(var e=this._currentDirectory,t=[];e;)t.unshift(e),e=e.parentDirectory;return t}_areDirsEqual(e,t){return e&&t&&e===t&&e.fileItem.key===t.fileItem.key}_initActions(){this._actions={onCurrentDirectoryChanging:this._createActionByOption("onCurrentDirectoryChanging")}}_raiseCurrentDirectoryChanged(e){this._actions.onCurrentDirectoryChanging({currentDirectory:e})}_getDefaultOptions(){return c(super._getDefaultOptions(),{rootFolderDisplayName:"Files",onCurrentDirectoryChanging:null})}_optionChanged(e){var t=e.name;switch(t){case"rootFolderDisplayName":this.repaint();break;case"onCurrentDirectoryChanging":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}var Ot=V(),ge="dx-splitter",es="".concat(ge,"-wrapper"),Oe="".concat(ge,"-inactive"),ts="".concat(ge,"-border"),Re="".concat(ge,"-initial"),Rt="dx-state-disabled",Le="dxSplitterResizing";class is extends F{_init(){super._init();var e=new U().toString();this.SPLITTER_POINTER_DOWN_EVENT_NAME=R(Ee.down,Le+e),this.SPLITTER_POINTER_MOVE_EVENT_NAME=R(Ee.move,Le+e),this.SPLITTER_POINTER_UP_EVENT_NAME=R(Ee.up,Le+e)}_initMarkup(){super._initMarkup(),this._initActions(),this._$container=this.option("container"),this._$leftElement=this.option("leftElement"),this._$rightElement=this.option("rightElement"),this.$element().addClass(es).addClass(Re),this._$splitterBorder=l("<div>").addClass(ts).appendTo(this.$element()),this._$splitter=l("<div>").addClass(ge).addClass(Oe).appendTo(this._$splitterBorder)}_initActions(){this._actions={onApplyPanelSize:this._createActionByOption("onApplyPanelSize"),onActiveStateChanged:this._createActionByOption("onActiveStateChanged")}}_render(){super._render(),this._detachEventHandlers(),this._attachEventHandlers()}_clean(){this._detachEventHandlers(),super._clean()}_attachEventHandlers(){var e=ue.getDocument();v.on(this._$splitterBorder,this.SPLITTER_POINTER_DOWN_EVENT_NAME,this._onMouseDownHandler.bind(this)),v.on(e,this.SPLITTER_POINTER_MOVE_EVENT_NAME,this._onMouseMoveHandler.bind(this)),v.on(e,this.SPLITTER_POINTER_UP_EVENT_NAME,this._onMouseUpHandler.bind(this))}_detachEventHandlers(){var e=ue.getDocument();v.off(this._$splitterBorder,this.SPLITTER_POINTER_DOWN_EVENT_NAME),v.off(e,this.SPLITTER_POINTER_MOVE_EVENT_NAME),v.off(e,this.SPLITTER_POINTER_UP_EVENT_NAME)}_dimensionChanged(e){(!e||e!=="height")&&(this._containerWidth=this._$container.get(0).clientWidth,this._setSplitterPositionLeft({needUpdatePanels:!0,usePercentagePanelsWidth:!0}))}_onMouseDownHandler(e){e.preventDefault(),this._offsetX=e.pageX-this._$splitterBorder.offset().left<=this._getSplitterBorderWidth()?e.pageX-this._$splitterBorder.offset().left:0,this._containerWidth=this._$container.get(0).clientWidth,this.$element().removeClass(Re),this._toggleActive(!0),this._setSplitterPositionLeft({needUpdatePanels:!0})}_onMouseMoveHandler(e){this._isSplitterActive&&this._setSplitterPositionLeft({splitterPositionLeft:this._getNewSplitterPositionLeft(e),needUpdatePanels:!0})}_onMouseUpHandler(){this._isSplitterActive&&(this._leftPanelPercentageWidth=null,this._toggleActive(!1),this._setSplitterPositionLeft({needUpdatePanels:!0,usePercentagePanelsWidth:!0}))}_getNewSplitterPositionLeft(e){var t=e.pageX-this._getContainerLeftOffset()-this._offsetX;return t=Math.max(0-this._getSplitterOffset(),t),t=Math.min(this._containerWidth-this._getSplitterOffset()-this._getSplitterWidth(),t),t}_getContainerLeftOffset(){var e=this._$container.offset().left;if(Ot){var t=Ot.getComputedStyle(this._$container.get(0)),i=parseFloat(t.paddingLeft)||0,r=parseFloat(t.borderLeftWidth)||0;e+=i+r}return e}_getSplitterOffset(){return(this._getSplitterBorderWidth()-this._getSplitterWidth())/2}_getSplitterWidth(){return this._$splitter.get(0).clientWidth}_getSplitterBorderWidth(){return this._$splitterBorder.get(0).clientWidth}_getLeftPanelWidth(){return this._$leftElement.get(0).clientWidth}getSplitterBorderElement(){return this._$splitterBorder}_toggleActive(e){this.$element().toggleClass(Oe,!e),this._$splitter.toggleClass(Oe,!e),this._isSplitterActive=e,this._actions.onActiveStateChanged({isActive:e})}toggleDisabled(e){this.$element().toggleClass(Rt,e),this._$splitter.toggleClass(Rt,e)}isSplitterMoved(){return!this.$element().hasClass(Re)}disableSplitterCalculation(e){this._isSplitterCalculationDisabled=e}_setSplitterPositionLeft(){var{splitterPositionLeft:e=null,needUpdatePanels:t=!1,usePercentagePanelsWidth:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=e||this._getLeftPanelWidth()-this._getSplitterOffset();var r=e+this._getSplitterOffset(),a=this._containerWidth-r;this._isSplitterCalculationDisabled||this.$element().css("left",e),this._leftPanelPercentageWidth=this._leftPanelPercentageWidth||this._convertToPercentage(r);var o=this._convertToPercentage(this._containerWidth-this._convertToPixels(this._leftPanelPercentageWidth));t&&this._actions.onApplyPanelSize({leftPanelWidth:i?"".concat(this._leftPanelPercentageWidth,"%"):r,rightPanelWidth:i?"".concat(o,"%"):a})}_optionChanged(e){switch(e.name){case"initialLeftPanelWidth":this._leftPanelPercentageWidth=this._convertToPercentage(e.value),this._dimensionChanged();break;case"leftElement":this.repaint();break;case"onActiveStateChanged":case"onApplyPanelSize":this._actions[e.name]=this._createActionByOption(e.name);break;default:super._optionChanged(e)}}_convertToPercentage(e){return e/this._$container.get(0).clientWidth*100}_convertToPixels(e){return e/100*this._$container.get(0).clientWidth}}var rs=V(),as=573,Lt="dx-filemanager-adaptivity-drawer-panel",Bt="dx-drawer-panel-content-initial",os="dx-drawer-panel-content-adaptive";class ss extends F{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=!1;var e=l("<div>").appendTo(this.$element());l("<div>").addClass(Lt).appendTo(e),this._drawer=this._createComponent(e,Ht),this._drawer.option({opened:!0,template:this._createDrawerTemplate.bind(this)}),l(this._drawer.content()).addClass(Bt);var t=e.find(".".concat(Lt)).first(),i=this.option("contentTemplate");x(i)&&i(t),this._updateDrawerMaxSize()}_createDrawerTemplate(e){this.option("drawerTemplate")(e),this._splitter=this._createComponent("<div>",is,{container:this.$element(),leftElement:l(this._drawer.content()),rightElement:l(this._drawer.viewContent()),onApplyPanelSize:this._onApplyPanelSize.bind(this),onActiveStateChanged:this._onActiveStateChanged.bind(this)}),this._splitter.$element().appendTo(e),this._splitter.disableSplitterCalculation(!0)}_render(){super._render(),this._checkAdaptiveState()}_onApplyPanelSize(e){if(Z()){if(!this._splitter.isSplitterMoved()){this._setDrawerWidth("");return}l(this._drawer.content()).removeClass(Bt),this._setDrawerWidth(e.leftPanelWidth)}}_onActiveStateChanged(e){var{isActive:t}=e;this._splitter.disableSplitterCalculation(!t),!t&&this._splitter.$element().css("left","auto")}_setDrawerWidth(e){l(this._drawer.content()).css("width",e),this._updateDrawerMaxSize(),this._drawer.resizeViewContent()}_updateDrawerMaxSize(){this._drawer.option("maxSize",this._drawer.getRealPanelWidth())}_dimensionChanged(e){(!e||e!=="height")&&this._checkAdaptiveState()}_checkAdaptiveState(){var e=this._isInAdaptiveState;this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&(this.toggleDrawer(!this._isInAdaptiveState,!0),l(this._drawer.content()).toggleClass(os,this._isInAdaptiveState),this._raiseAdaptiveStateChanged(this._isInAdaptiveState)),this._isInAdaptiveState&&this._isDrawerOpened()&&this._updateDrawerMaxSize()}_isSmallScreen(){return z(rs)<=as}_isDrawerOpened(){return this._drawer.option("opened")}_initActions(){this._actions={onAdaptiveStateChanged:this._createActionByOption("onAdaptiveStateChanged")}}_raiseAdaptiveStateChanged(e){this._actions.onAdaptiveStateChanged({enabled:e})}_getDefaultOptions(){return c(super._getDefaultOptions(),{drawerTemplate:null,contentTemplate:null,onAdaptiveStateChanged:null})}_optionChanged(e){var t=e.name;switch(t){case"drawerTemplate":case"contentTemplate":this.repaint();break;case"onAdaptiveStateChanged":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}isInAdaptiveState(){return this._isInAdaptiveState}toggleDrawer(e,t){this._updateDrawerMaxSize(),this._drawer.option("animationEnabled",!t),this._drawer.toggle(e);var i=this._isDrawerOpened()&&!this.isInAdaptiveState();this._splitter.toggleDisabled(!i)}getSplitterElement(){return this._splitter.getSplitterBorderElement().get(0)}}var X="dx-filemanager",ns=X+"-wrapper",Nt=X+"-container",ls=X+"-dirs-panel",ds=X+"-editing-container",hs=X+"-items-panel",cs=X+"-item-custom-thumbnail",us="[*DXPDK*]$40F96F03-FBD8-43DF-91BE-F55F4B8BA871$",G={folders:"navPane",items:"itemView"};class ui extends F{_initTemplates(){}_init(){super._init(),this._initActions(),this._providerUpdateDeferred=null,this._lockCurrentPathProcessing=!1,this._wasRendered=!1,this._controller=new la({currentPath:this.option("currentPath"),currentPathKeys:this.option("currentPathKeys"),rootText:this.option("rootFolderName"),fileProvider:this.option("fileSystemProvider"),allowedFileExtensions:this.option("allowedFileExtensions"),uploadMaxFileSize:this.option("upload").maxFileSize,uploadChunkSize:this.option("upload").chunkSize,onInitialized:this._onControllerInitialized.bind(this),onDataLoading:this._onDataLoading.bind(this),onSelectedDirectoryChanged:this._onSelectedDirectoryChanged.bind(this),onPathPotentiallyChanged:this._checkPathActuality.bind(this),editingEvents:this._actions.editing})}_initMarkup(){super._initMarkup(),this._firstItemViewLoad=!0,this._lockSelectionProcessing=!1,this._lockFocusedItemProcessing=!1,this._itemKeyToFocus=void 0,this._loadedWidgets=[],this._commandManager=new ha(this.option("permissions")),this.$element().addClass(X),this._wasRendered?this._prepareToLoad():this._wasRendered=!0,this._createNotificationControl(),this._initCommandManager()}_createNotificationControl(){var e=l("<div>").addClass("dx-filemanager-notification-container").appendTo(this.$element());this._notificationControl=this._createComponent(e,wo,{progressPanelContainer:this.$element(),contentTemplate:(t,i)=>this._createWrapper(t,i),onActionProgress:t=>this._onActionProgress(t),positionTarget:".".concat(Nt),showProgressPanel:this.option("notifications.showPanel"),showNotificationPopup:this.option("notifications.showPopup")})}_createWrapper(e,t){this._$wrapper=l("<div>").addClass(ns).appendTo(e),this._createEditing(t);var i=l("<div>").appendTo(this._$wrapper);this._toolbar=this._createComponent(i,Qa,{commandManager:this._commandManager,generalItems:this.option("toolbar.items"),fileItems:this.option("toolbar.fileSelectionItems"),itemViewMode:this.option("itemView").mode,onItemClick:r=>this._actions.onToolbarItemClick(r)}),this._createAdaptivityControl()}_createAdaptivityControl(){var e=l("<div>").addClass(Nt).appendTo(this._$wrapper);this._adaptivityControl=this._createComponent(e,ss,{drawerTemplate:t=>this._createFilesTreeView(t),contentTemplate:t=>this._createItemsPanel(t),onAdaptiveStateChanged:t=>this._onAdaptiveStateChanged(t)}),this._editing.setUploaderSplitterElement(this._adaptivityControl.getSplitterElement())}_createEditing(e){var t=l("<div>").addClass(ds).appendTo(this.$element());this._editing=this._createComponent(t,Zo,{controller:this._controller,model:{getMultipleSelectedItems:this._getSelectedItemInfos.bind(this)},getItemThumbnail:this._getItemThumbnailInfo.bind(this),notificationControl:e,uploadDropZonePlaceholderContainer:this.$element(),rtlEnabled:this.option("rtlEnabled"),onSuccess:i=>{var{updatedOnlyFiles:r}=i;return this._redrawComponent(r)},onError:i=>this._onEditingError(i)})}_createItemsPanel(e){this._$itemsPanel=l("<div>").addClass(hs).appendTo(e),this._createBreadcrumbs(this._$itemsPanel),this._createItemView(this._$itemsPanel),this._updateUploadDropZone()}_updateUploadDropZone(){var e=this._commandManager.isCommandAvailable("upload")?this._$itemsPanel:l();this._editing.setUploaderDropZone(e)}_createFilesTreeView(e){this._filesTreeViewContextMenu=this._createContextMenu(!1,G.folders);var t=l("<div>").addClass(ls).appendTo(e);this._filesTreeView=this._createComponent(t,li,{storeExpandedState:!0,contextMenu:this._filesTreeViewContextMenu,getDirectories:this.getDirectories.bind(this),getCurrentDirectory:this._getCurrentDirectory.bind(this),onDirectoryClick:i=>{var{itemData:r}=i;return this._setCurrentDirectory(r)},onItemListDataLoaded:()=>this._tryEndLoading(G.folders)}),this._filesTreeView.updateCurrentDirectory()}_createItemView(e,t){this._itemViewContextMenu=this._createContextMenu(!0,G.items);var i=this.option("itemView"),r={selectionMode:this.option("selectionMode"),selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),contextMenu:this._itemViewContextMenu,getItems:this._getItemViewItems.bind(this),onError:n=>{var{error:h}=n;return this._showError(h)},onSelectionChanged:this._onItemViewSelectionChanged.bind(this),onFocusedItemChanged:this._onItemViewFocusedItemChanged.bind(this),onSelectedItemOpened:this._onSelectedItemOpened.bind(this),onContextMenuShowing:n=>this._onContextMenuShowing(G.items,n),onItemListItemsLoaded:()=>this._tryEndLoading(G.items),getItemThumbnail:this._getItemThumbnailInfo.bind(this),customizeDetailColumns:this.option("customizeDetailColumns"),detailColumns:this.option("itemView.details.columns")},a=l("<div>").appendTo(e);t=t||i.mode;var o=t==="thumbnails"?Ga:ba;this._itemView=this._createComponent(a,o,r)}_createBreadcrumbs(e){var t=l("<div>").appendTo(e);this._breadcrumbs=this._createComponent(t,Qo,{rootFolderDisplayName:this.option("rootFolderName"),onCurrentDirectoryChanging:i=>{var{currentDirectory:r}=i;return this._setCurrentDirectory(r,!0)}}),this._breadcrumbs.setCurrentDirectory(this._getCurrentDirectory())}_createContextMenu(e,t){var i=l("<div>").appendTo(this._$wrapper);return this._createComponent(i,_a,{commandManager:this._commandManager,items:this.option("contextMenu.items"),onItemClick:r=>this._actions.onContextMenuItemClick(r),onContextMenuShowing:r=>this._onContextMenuShowing(t,r),isolateCreationItemCommands:e,viewArea:t})}_initCommandManager(){var e=c(this._editing.getCommandActions(),{refresh:()=>this._refreshAndShowProgress(),thumbnails:()=>this.option("itemView.mode","thumbnails"),details:()=>this.option("itemView.mode","details"),clearSelection:()=>this._clearSelection(),showNavPane:()=>this._adaptivityControl.toggleDrawer()});this._commandManager.registerActions(e)}_onItemViewSelectionChanged(e){var{selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:a,currentDeselectedItemKeys:o}=e;this._lockSelectionProcessing=!0,this.option("selectedItemKeys",r),this._lockSelectionProcessing=!1,this._actions.onSelectionChanged({selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:a,currentDeselectedItemKeys:o}),this._updateToolbar(t)}_onItemViewFocusedItemChanged(e){this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._actions.onFocusedItemChanged({item:e.item,itemElement:e.itemElement})}_onAdaptiveStateChanged(e){var{enabled:t}=e;this._commandManager.setCommandEnabled("showNavPane",t),this._updateToolbar()}_onActionProgress(e){var{message:t,status:i}=e;this._toolbar.updateRefreshItem(t,i),this._updateToolbar()}_onEditingError(e){var t=q({},e,["errorCode","errorText","fileSystemItem"]);this._actions.onErrorOccurred(t),e.errorText=t.errorText}_refreshAndShowProgress(){return this._prepareToLoad(),E(this._notificationControl.tryShowProgressPanel(),this._controller.refresh()).then(()=>this._filesTreeView.refresh())}_isAllWidgetsLoaded(){return this._loadedWidgets.length===2&&this._loadedWidgets.indexOf(G.folders)!==-1&&this._loadedWidgets.indexOf(G.items)!==-1}_tryEndLoading(e){this._loadedWidgets.push(e),this._isAllWidgetsLoaded()&&this._controller.endSingleLoad()}_prepareToLoad(){this._loadedWidgets=[],this._controller.startSingleLoad()}_updateToolbar(e){var t=e||this._getSelectedItemInfos();this._toolbar.option("contextItems",A(t,[]))}_switchView(e){this._disposeWidget(this._itemView.option("contextMenu")),this._disposeWidget(this._itemView),this._createItemView(this._$itemsPanel,e),this._toolbar.option({itemViewMode:e})}_disposeWidget(e){e.dispose(),e.$element().remove()}_clearSelection(){this._itemView.clearSelection()}_showError(e){this._showNotification(e,!1)}_showNotification(e,t){Zr({message:e,width:450},t?"success":"error",5e3)}_redrawComponent(e){this._itemView.refresh().then(()=>!e&&this._filesTreeView.refresh())}_getItemViewItems(){var e=this.option("itemView").showFolders,t=this._controller.getCurrentItems(!e);return this._updateToolbarWithSelectionOnFirstLoad(t),this.option("itemView.showParentFolder")&&(t=E(t).then(i=>this._getPreparedItemViewItems(i))),t}_updateToolbarWithSelectionOnFirstLoad(e){if(this._firstItemViewLoad){this._firstItemViewLoad=!1;var t=this.option("selectedItemKeys");t.length>0&&E(e).done(i=>{var r=ia(i,t);r.length>0&&this._updateToolbar(r)})}}_getPreparedItemViewItems(e){var t=this._getCurrentDirectory();if(t.fileItem.isRoot())return e;var i=t.fileItem.createClone();i.isParentFolder=!0,i.name="..",i.relativeName="..",i.key="".concat(us).concat(t.fileItem.key);var r=[...e];return r.unshift({fileItem:i,icon:"parentfolder"}),r}_onContextMenuShowing(e,t){var i,r=q({},t,["targetElement","cancel","event"]);r=c(r,{viewArea:e,fileSystemItem:(i=t.itemData)===null||i===void 0?void 0:i.fileItem,_isActionButton:t.isActionButton}),this._actions.onContextMenuShowing(r),t.cancel=A(r.cancel,!1)}_getItemThumbnailInfo(e){var t=this.option("customizeThumbnail"),i=x(t)?t(e.fileItem):e.fileItem.thumbnail;return i?{thumbnail:i,cssClass:cs}:{thumbnail:e.icon}}_getDefaultOptions(){return c(super._getDefaultOptions(),{fileSystemProvider:null,currentPath:"",currentPathKeys:[],rootFolderName:d.format("dxFileManager-rootDirectoryName"),selectionMode:"multiple",selectedItemKeys:[],focusedItemKey:void 0,toolbar:{items:["showNavPane","create","upload","switchView",{name:"separator",location:"after"},"refresh"],fileSelectionItems:["download","separator","move","copy","rename","separator","delete","clearSelection",{name:"separator",location:"after"},"refresh"]},contextMenu:{items:["create","upload","rename","move","copy","delete","refresh","download"]},itemView:{details:{columns:["thumbnail","name","dateModified","size"]},mode:"details",showFolders:!0,showParentFolder:!0},customizeThumbnail:null,customizeDetailColumns:null,onContextMenuItemClick:null,onContextMenuShowing:null,onCurrentDirectoryChanged:null,onSelectedFileOpened:null,onSelectionChanged:null,onFocusedItemChanged:null,onToolbarItemClick:null,onErrorOccurred:null,onDirectoryCreating:null,onDirectoryCreated:null,onItemRenaming:null,onItemRenamed:null,onItemDeleting:null,onItemDeleted:null,onItemCopying:null,onItemCopied:null,onItemMoving:null,onItemMoved:null,onFileUploading:null,onFileUploaded:null,onItemDownloading:null,allowedFileExtensions:[],upload:{maxFileSize:0,chunkSize:2e5},permissions:c({},si),notifications:{showPanel:!0,showPopup:!0}})}option(e,t){var i=ji(e,t),r=arguments.length<2&&qi(e)!=="object",a=n=>p(i[n]),o=n=>{if(!a(n))return!1;var h=this.option(n),u=i[n];return!Zi(h,u)};return!r&&a("fileSystemProvider")&&(this._providerUpdateDeferred=new _,(o("currentPath")||o("currentPathKeys"))&&(this._lockCurrentPathProcessing=!0)),super.option(...arguments)}_optionChanged(e){var t=e.name;switch(t){case"currentPath":var i=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPath(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(i):i();break;case"currentPathKeys":var r=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPathByKeys(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(r):r();break;case"selectedItemKeys":!this._lockSelectionProcessing&&this._itemView&&this._itemView.option("selectedItemKeys",e.value);break;case"focusedItemKey":!this._lockFocusedItemProcessing&&this._itemView&&this._itemView.option("focusedItemKey",e.value);break;case"rootFolderName":this._controller.setRootText(e.value),this._invalidate();break;case"fileSystemProvider":this._lockCurrentPathProcessing||(this._providerUpdateDeferred=new _);var a=this._lockCurrentPathProcessing?void 0:this.option("currentPathKeys");this._controller.updateProvider(e.value,a).then(()=>this._providerUpdateDeferred.resolve()).always(()=>{this._providerUpdateDeferred=null,this.repaint()});break;case"allowedFileExtensions":this._controller.setAllowedFileExtensions(e.value),this._invalidate();break;case"upload":this._controller.setUploadOptions(this.option("upload")),this._invalidate();break;case"permissions":this._commandManager.updatePermissions(this.option("permissions")),this._filesTreeViewContextMenu.tryUpdateVisibleContextMenu(),this._itemViewContextMenu.tryUpdateVisibleContextMenu(),this._toolbar.updateItemPermissions(),this._updateUploadDropZone();break;case"selectionMode":case"customizeThumbnail":case"customizeDetailColumns":this._invalidate();break;case"itemView":e.fullName==="itemView.mode"?this._switchView(e.value):this._invalidate();break;case"toolbar":var o={};e.fullName==="toolbar"&&(e.value.items&&(o.generalItems=e.value.items),e.value.fileSelectionItems&&(o.fileItems=e.value.fileSelectionItems)),e.fullName.indexOf("toolbar.items")===0&&(o.generalItems=this.option("toolbar.items")),e.fullName.indexOf("toolbar.fileSelectionItems")===0&&(o.fileItems=this.option("toolbar.fileSelectionItems")),this._toolbar.option(o);break;case"contextMenu":if(e.fullName==="contextMenu"&&e.value.items||e.fullName.indexOf("contextMenu.items")===0){var n=this.option("contextMenu.items");this._filesTreeViewContextMenu.option("items",n),this._itemViewContextMenu.option("items",n)}break;case"notifications":this._notificationControl.option("showProgressPanel",this.option("notifications.showPanel")),this._notificationControl.option("showNotificationPopup",this.option("notifications.showPopup"));break;case"onContextMenuItemClick":case"onContextMenuShowing":case"onCurrentDirectoryChanged":case"onSelectedFileOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onToolbarItemClick":case"onErrorOccurred":this._actions[t]=this._createActionByOption(t);break;case"onDirectoryCreating":case"onDirectoryCreated":case"onItemRenaming":case"onItemRenamed":case"onItemDeleting":case"onItemDeleted":case"onItemCopying":case"onItemCopied":case"onItemMoving":case"onItemMoved":case"onFileUploading":case"onFileUploaded":case"onItemDownloading":this._actions.editing[t]=this._createActionByOption(t);break;case"rtlEnabled":this._editing.updateDialogRtl(e.value),super._optionChanged(e);break;default:super._optionChanged(e)}}_initActions(){this._actions={onContextMenuItemClick:this._createActionByOption("onContextMenuItemClick"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onCurrentDirectoryChanged:this._createActionByOption("onCurrentDirectoryChanged"),onSelectedFileOpened:this._createActionByOption("onSelectedFileOpened"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onToolbarItemClick:this._createActionByOption("onToolbarItemClick"),onErrorOccurred:this._createActionByOption("onErrorOccurred"),editing:{onDirectoryCreating:this._createActionByOption("onDirectoryCreating"),onDirectoryCreated:this._createActionByOption("onDirectoryCreated"),onItemRenaming:this._createActionByOption("onItemRenaming"),onItemRenamed:this._createActionByOption("onItemRenamed"),onItemDeleting:this._createActionByOption("onItemDeleting"),onItemDeleted:this._createActionByOption("onItemDeleted"),onItemCopying:this._createActionByOption("onItemCopying"),onItemCopied:this._createActionByOption("onItemCopied"),onItemMoving:this._createActionByOption("onItemMoving"),onItemMoved:this._createActionByOption("onItemMoved"),onFileUploading:this._createActionByOption("onFileUploading"),onFileUploaded:this._createActionByOption("onFileUploaded"),onItemDownloading:this._createActionByOption("onItemDownloading")}}}executeCommand(e){return this._commandManager.executeCommand(e)}_setCurrentDirectory(e,t){this._controller.setCurrentDirectory(e,t)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}_onControllerInitialized(e){var{controller:t}=e;this._controller=this._controller||t,this._syncToCurrentDirectory()}_onDataLoading(e){var{operation:t}=e,i=null;t===ee.NAVIGATION&&(i={focusedItemKey:this._itemKeyToFocus,selectedItemKeys:this.option("selectedItemKeys")},this._itemKeyToFocus=void 0),this._itemView.refresh(i,t)}_onSelectedDirectoryChanged(){var e=this._getCurrentDirectory();this._syncToCurrentDirectory(),this._actions.onCurrentDirectoryChanged({directory:e.fileItem})}_syncToCurrentDirectory(){var e=this._getCurrentDirectory();this._filesTreeView&&this._filesTreeView.updateCurrentDirectory(),this._breadcrumbs&&this._breadcrumbs.setCurrentDirectory(e),this._checkPathActuality()}_checkPathActuality(){if(!this._lockCurrentPathProcessing){var e=this._controller.getCurrentPath(),t=this._controller.getCurrentPathKeys(),i={};this.option("currentPath")!==e&&(i.currentPath=e),Gt(this.option("currentPathKeys"),t)||(i.currentPathKeys=t),Kt(i)||this.option(i)}}getDirectories(e,t){return this._controller.getDirectories(e,t)}_getSelectedItemInfos(){return this._itemView?this._itemView.getSelectedItems():[]}refresh(){return this.executeCommand("refresh")}getCurrentDirectory(){var e=this._getCurrentDirectory();return e&&e.fileItem||null}getSelectedItems(){return this._getSelectedItemInfos().map(e=>e.fileItem)}_onSelectedItemOpened(e){var{fileItemInfo:t}=e,i=t.fileItem;if(!i.isDirectory){this._actions.onSelectedFileOpened({file:i});return}i.isParentFolder&&(this._itemKeyToFocus=this._getCurrentDirectory().fileItem.key);var r=i.isParentFolder?this._getCurrentDirectory().parentDirectory:t;this._setCurrentDirectory(r),r&&this._filesTreeView.toggleDirectoryExpandedState(r.parentDirectory,!0)}}pe("dxFileManager",ui);const _s=Object.freeze(Object.defineProperty({__proto__:null,default:ui},Symbol.toStringTag,{value:"Module"})),ps=Xi(_s);/*!
 * devextreme-vue
 * Version: 22.2.10
 * Build date: Mon Dec 11 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var ms=at&&at.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(f,"__esModule",{value:!0});f.DxUpload=f.DxToolbarItem=f.DxToolbar=f.DxPermissions=f.DxNotifications=f.DxItemView=f.DxItem=f.DxFileSelectionItem=f.DxDetails=f.DxContextMenuItem=f.DxContextMenu=f.DxColumn=pi=f.DxFileManager=void 0;var gs=ms(ps),fs=qt,P=qt,_i=fs.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,allowedFileExtensions:Array,contextMenu:Object,currentPath:String,currentPathKeys:Array,customizeDetailColumns:Function,customizeThumbnail:Function,disabled:Boolean,elementAttr:Object,fileSystemProvider:{},focusedItemKey:String,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,itemView:Object,notifications:Object,onContentReady:Function,onContextMenuItemClick:Function,onContextMenuShowing:Function,onCurrentDirectoryChanged:Function,onDirectoryCreated:Function,onDirectoryCreating:Function,onDisposing:Function,onErrorOccurred:Function,onFileUploaded:Function,onFileUploading:Function,onFocusedItemChanged:Function,onInitialized:Function,onItemCopied:Function,onItemCopying:Function,onItemDeleted:Function,onItemDeleting:Function,onItemDownloading:Function,onItemMoved:Function,onItemMoving:Function,onItemRenamed:Function,onItemRenaming:Function,onOptionChanged:Function,onSelectedFileOpened:Function,onSelectionChanged:Function,onToolbarItemClick:Function,permissions:Object,rootFolderName:String,rtlEnabled:Boolean,selectedItemKeys:Array,selectionMode:String,tabIndex:Number,toolbar:Object,upload:Object,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:allowedFileExtensions":null,"update:contextMenu":null,"update:currentPath":null,"update:currentPathKeys":null,"update:customizeDetailColumns":null,"update:customizeThumbnail":null,"update:disabled":null,"update:elementAttr":null,"update:fileSystemProvider":null,"update:focusedItemKey":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:itemView":null,"update:notifications":null,"update:onContentReady":null,"update:onContextMenuItemClick":null,"update:onContextMenuShowing":null,"update:onCurrentDirectoryChanged":null,"update:onDirectoryCreated":null,"update:onDirectoryCreating":null,"update:onDisposing":null,"update:onErrorOccurred":null,"update:onFileUploaded":null,"update:onFileUploading":null,"update:onFocusedItemChanged":null,"update:onInitialized":null,"update:onItemCopied":null,"update:onItemCopying":null,"update:onItemDeleted":null,"update:onItemDeleting":null,"update:onItemDownloading":null,"update:onItemMoved":null,"update:onItemMoving":null,"update:onItemRenamed":null,"update:onItemRenaming":null,"update:onOptionChanged":null,"update:onSelectedFileOpened":null,"update:onSelectionChanged":null,"update:onToolbarItemClick":null,"update:permissions":null,"update:rootFolderName":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectionMode":null,"update:tabIndex":null,"update:toolbar":null,"update:upload":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=gs.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={contextMenu:{isCollectionItem:!1,optionName:"contextMenu"},itemView:{isCollectionItem:!1,optionName:"itemView"},notifications:{isCollectionItem:!1,optionName:"notifications"},permissions:{isCollectionItem:!1,optionName:"permissions"},toolbar:{isCollectionItem:!1,optionName:"toolbar"},upload:{isCollectionItem:!1,optionName:"upload"}}}}),pi=f.DxFileManager=_i,ze=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:alignment":null,"update:caption":null,"update:cssClass":null,"update:dataField":null,"update:dataType":null,"update:hidingPriority":null,"update:sortIndex":null,"update:sortOrder":null,"update:visible":null,"update:visibleIndex":null,"update:width":null},props:{alignment:String,caption:String,cssClass:String,dataField:String,dataType:String,hidingPriority:Number,sortIndex:Number,sortOrder:String,visible:Boolean,visibleIndex:Number,width:[Number,String]}});f.DxColumn=ze;ze.$_optionName="columns";ze.$_isCollectionItem=!0;var He=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:items":null},props:{items:Array}});f.DxContextMenu=He;He.$_optionName="contextMenu";He.$_expectedChildren={contextMenuItem:{isCollectionItem:!0,optionName:"items"},item:{isCollectionItem:!0,optionName:"items"}};var We=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:disabled":null,"update:html":null,"update:icon":null,"update:items":null,"update:name":null,"update:selectable":null,"update:selected":null,"update:template":null,"update:text":null,"update:visible":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,disabled:Boolean,html:String,icon:String,items:Array,name:String,selectable:Boolean,selected:Boolean,template:{},text:String,visible:Boolean}});f.DxContextMenuItem=We;We.$_optionName="items";We.$_isCollectionItem=!0;var qe=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:columns":null},props:{columns:Array}});f.DxDetails=qe;qe.$_optionName="details";qe.$_expectedChildren={column:{isCollectionItem:!0,optionName:"columns"}};var Ze=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:name":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,icon:String,locateInMenu:String,location:String,menuItemTemplate:{},name:String,options:{},showText:String,template:{},text:String,visible:Boolean,widget:String}});f.DxFileSelectionItem=Ze;Ze.$_optionName="fileSelectionItems";Ze.$_isCollectionItem=!0;var je=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:icon":null,"update:items":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:name":null,"update:options":null,"update:selectable":null,"update:selected":null,"update:showText":null,"update:template":null,"update:text":null,"update:visible":null,"update:widget":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,cssClass:String,disabled:Boolean,html:String,icon:String,items:Array,locateInMenu:String,location:String,menuItemTemplate:{},name:String,options:{},selectable:Boolean,selected:Boolean,showText:String,template:{},text:String,visible:Boolean,widget:String}});f.DxItem=je;je.$_optionName="items";je.$_isCollectionItem=!0;var Xe=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:details":null,"update:mode":null,"update:showFolders":null,"update:showParentFolder":null},props:{details:Object,mode:String,showFolders:Boolean,showParentFolder:Boolean}});f.DxItemView=Xe;Xe.$_optionName="itemView";Xe.$_expectedChildren={details:{isCollectionItem:!1,optionName:"details"}};var mi=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:showPanel":null,"update:showPopup":null},props:{showPanel:Boolean,showPopup:Boolean}});f.DxNotifications=mi;mi.$_optionName="notifications";var gi=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:copy":null,"update:create":null,"update:delete":null,"update:download":null,"update:move":null,"update:rename":null,"update:upload":null},props:{copy:Boolean,create:Boolean,delete:Boolean,download:Boolean,move:Boolean,rename:Boolean,upload:Boolean}});f.DxPermissions=gi;gi.$_optionName="permissions";var Ye=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:fileSelectionItems":null,"update:items":null},props:{fileSelectionItems:Array,items:Array}});f.DxToolbar=Ye;Ye.$_optionName="toolbar";Ye.$_expectedChildren={fileSelectionItem:{isCollectionItem:!0,optionName:"fileSelectionItems"},item:{isCollectionItem:!0,optionName:"items"},toolbarItem:{isCollectionItem:!0,optionName:"items"}};var Je=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:name":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,icon:String,locateInMenu:String,location:String,menuItemTemplate:{},name:String,options:{},showText:String,template:{},text:String,visible:Boolean,widget:String}});f.DxToolbarItem=Je;Je.$_optionName="items";Je.$_isCollectionItem=!0;var fi=P.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:chunkSize":null,"update:maxFileSize":null},props:{chunkSize:Number,maxFileSize:Number}});f.DxUpload=fi;fi.$_optionName="upload";f.default=_i;const Is={__name:"FileManager",props:{clientPath:{type:String,default:""}},emits:["copiedUrl"],setup(s,{emit:e}){const t=s,{t:i}=Yi(),r=ot("mc"),a=ot("mf"),o=Se(null),n=Se(null),h=Se([]),u=Se(new oi({getItems:g,createDirectory:D,renameItem:b,deleteItem:ie,copyItem:re,moveItem:fe,uploadFileChunk:ve}));Ji(()=>t.clientPath,()=>{o.value.instance.refresh()});function g(m){return new Promise((C,I)=>{axios.post("settings/file/getItems",{clientPath:t.clientPath,path:m.path}).then(S=>{C(S.data),h.value=S.data.reduce((M,ae)=>(!ae.isDirectory&&ae.name.match(/.(jpg|jpeg|png|gif)$/i)&&M.push(`${window.baseURL}/storage/${t.clientPath}/${m.path}/${ae.name}`),M),[])})})}function D(m,C){return new Promise((I,S)=>{axios.post("settings/file/createDirectory",{clientPath:t.clientPath,path:m.path,name:C}).then(M=>{M.data?I():S()})})}function b(m,C){return new Promise((I,S)=>{axios.post("settings/file/renameItem",{clientPath:t.clientPath,path:m.parentPath,oldName:m.name,newName:C}).then(M=>{M.data?I():S()})})}function ie(m){return new Promise((C,I)=>{axios.post("settings/file/deleteItem",{clientPath:t.clientPath,path:m.path,isDirectory:m.isDirectory}).then(S=>{S.data?C():I()})})}function re(m,C){return new Promise((I,S)=>{axios.post("settings/file/copyItem",{clientPath:t.clientPath,fromPath:m.parentPath,toPath:C.path,name:m.name}).then(M=>{M.data?I():S()}),I()})}function fe(m,C){return new Promise((I,S)=>{axios.post("settings/file/moveItem",{clientPath:t.clientPath,fromPath:m.parentPath,toPath:C.path,name:m.name}).then(M=>{M.data?I():S()}),I()})}async function ve(m,C,I){const S=m.name;if(m.type.match(/image.*/)){const M={file:m,maxSize:r.MAX_SIZE_IMAGE_UPLOAD};m=await a.resizeImage(M)}return new Promise((M,ae)=>{let oe=new FormData;oe.append("clientPath",t.clientPath),oe.append("file",m),oe.append("name",S),oe.append("path",I.path),axios.post("settings/file/uploadFileChunk",oe,{headers:{"Content-Type":"multipart/form-data"},noCrypt:!0}).then(Ii=>{Ii.data?(S.match(/.(jpg|jpeg|png|gif)$/i)&&h.value.push(`${window.baseURL}/storage/${t.clientPath}/${I.path}/${S}`),M()):ae()})})}function Ie(){const m=o.value.instance.getSelectedItems();if(m.length>1)ne.info(i("settings.files.messages.multiFile"));else if(m[0].isDirectory)ne.info(i("settings.files.messages.notIsFile"));else{let C=`${window.baseURL}/storage/${t.clientPath}/${m[0].path}`;navigator.clipboard.writeText(C).then(()=>{ne.success(i("settings.files.messages.copiedUrl")),e("copiedUrl",C)},I=>ne.error(i("settings.files.messages.notCopiedUrl")+"<br>ERROR: "+I))}}function Ce({file:m}){m.name.match(/.(jpg|jpeg|png|gif)$/i)?n.value.openSlide(m.name):ne.info(i("settings.files.messages.notIsImage"))}function vi(m){setTimeout(()=>o.value.instance.repaint(),3e3)}return(m,C)=>(Qi(),er(rr,null,[st(tr(pi),{ref_key:"fileManagerRef",ref:o,"file-system-provider":u.value,permissions:{create:!0,copy:!0,move:!0,delete:!0,rename:!0,upload:!0},itemView:{mode:"thumbnails"},toolbar:{fileSelectionItems:[{widget:"dxButton",options:{text:m.$t("settings.files.copyUrl"),hint:m.$t("settings.files.copyUrl"),icon:"link"},location:"before",onClick:Ie},"separator","move","copy","rename","separator","delete","clearSelection"]},onErrorOccurred:vi,onSelectedFileOpened:Ce},null,8,["file-system-provider","toolbar"]),st(ir,{ref_key:"photoswipeRef",ref:n,images:h.value,style:{display:"none !important"}},null,8,["images"])],64))}};export{jt as F,Is as _};
