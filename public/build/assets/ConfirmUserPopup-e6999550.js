import{u as L,n as N,p as g,q as r,s as j,v as K,A as X,r as y,d as P,f as s,w as c,B as G,g as h,h as v,F as H,z as S,o as m,y as Z,e as n,i as $,t as V,P as q,j as J}from"./app-9b98c2f0.js";import{_ as Q}from"./accordion-eac2b0ad.js";import{P as W}from"./Index-3a97d3df.js";const Y={class:"download"},ee=["onSubmit"],te={class:"upload-browser"},oe={for:"contractImage"},ae=n("i",{class:"far fa-file-upload"},null,-1),ne={class:"upload-browser"},se={for:"identityImage"},le=n("i",{class:"far fa-file-upload"},null,-1),ue={__name:"ConfirmUserPopup",setup(ie,{expose:x}){const B=L(),{t:p}=N(),R=g("bus"),I=g("mc"),_=g("mf"),f=r(null),T=r(null),w=r(null),u=r(null),d=r(null),t=j({refreshKey:0,user:{},formData:{}});let D=[];const C=K(()=>new Set(t.formData.documents.map(e=>e.file)));X(()=>k());function A({user:e}){f.value.setTitle(p(`components.confirmUser.${e.level==4?"title":"confirmedTitle"}`)+" #"+e.code),t.user=e,f.value.show()}function b(e){let o=e.target.id.replace("Image","");t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&a.isUpload)),console.log("onUploadImageChange",e.target.files),[...e.target.files].forEach(a=>t.formData.documents.push({type:o,file:URL.createObjectURL(a),isUpload:!0}))}function U(e){let o=e.element.id.replace("Delete","");e.value?t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&!a.isUpload)):t.formData.documents=D.filter(a=>a.type==o).concat(t.formData.documents)}function E(){!t.formData.isContractDelete&&!t.formData.isIdentityDelete&&u.value.files.length==0&&d.value.files.length==0?S.info(p("messages.info.noChangedData")):t.formData.documents.length==0?S.show(p("messages.warning.imageEmpty")):w.value.instance.element().click()}function z(){R.emit("checkPin",async()=>{let e=new FormData;e.append("userId",t.user.id),e.append("isContractDelete",t.formData.isContractDelete),e.append("isIdentityDelete",t.formData.isIdentityDelete);for(var o=0;o<u.value.files.length;o++){let a=await _.resizeImage({file:u.value.files[o],maxSize:I.MAX_SIZE_IMAGE_UPLOAD});e.append(`contractImages[${o}]`,a)}for(var o=0;o<d.value.files.length;o++){let l=await _.resizeImage({file:d.value.files[o],maxSize:I.MAX_SIZE_IMAGE_UPLOAD});e.append(`identityImages[${o}]`,l)}B.dispatch("adminUser/uploadDocuments",e).then(a=>{a&&f.value.hide()})})}function k(){t.formData={isPdfPreview:!1,isContractDelete:!1,isIdentityDelete:!1,documents:[]}}function M(){setTimeout(()=>T.value.instance.option("selectedIndex",t.user.level==4?0:1),0),D=t.user.url_documents.map(e=>({...e,isUpload:!1})),t.formData.documents=D}function O(){k(),t.refreshKey++}return x({show:A}),(e,o)=>{const a=y("DxButton"),l=y("DxCheckBox"),F=y("DxScrollView");return m(),P(H,null,[s(G,{ref_key:"popupRef",ref:f,title:e.$t("admin.users.deletedUsers"),class:"confirm-user-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:E}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>e.$refs.submit.click()}}],onShown:M,onHidden:O},{default:c(()=>[s(F,null,{default:c(()=>[s(Z(Q),{ref:"accordion",collapsible:!0,items:[{title:e.$t("components.confirmUser.step1"),template:"step1Template"},{title:e.$t("components.confirmUser.step2"),template:"step2Template"}]},{step1Template:c(()=>[n("div",Y,[s(a,{text:e.$t("buttons.download"),icon:"download",type:"default","styling-mode":"contained",onClick:o[0]||(o[0]=()=>e.$refs.pdf.download({component:"ContractPdf",user:t.user,isPreview:t.formData.isPdfPreview}))},null,8,["text"]),e.$screen.getScreenSizeInfo.isXSmall?v("",!0):(m(),h(l,{key:0,modelValue:t.formData.isPdfPreview,"onUpdate:modelValue":o[1]||(o[1]=i=>t.formData.isPdfPreview=i),text:e.$t("components.confirmUser.preview")},null,8,["modelValue","text"]))])]),step2Template:c(()=>[n("form",{onSubmit:J(z,["prevent"])},[s(a,{ref_key:"submitRef",ref:w,class:"display-none",useSubmitBehavior:!0},null,512),(m(),P("div",{class:"upload",key:t.refreshKey},[n("div",te,[n("input",{ref_key:"contractImageRef",ref:u,type:"file",id:"contractImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",oe,[ae,$(" "+V(e.$t("components.confirmUser.chooseContractImage")),1)]),s(l,{id:"contractDelete",modelValue:t.formData.isContractDelete,"onUpdate:modelValue":o[2]||(o[2]=i=>t.formData.isContractDelete=i),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),n("div",ne,[n("input",{ref_key:"identityImageRef",ref:d,type:"file",id:"identityImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",se,[le,$(" "+V(e.$t("components.confirmUser.chooseIdentityImage")),1)]),s(l,{id:"identityDelete",modelValue:t.formData.isIdentityDelete,"onUpdate:modelValue":o[3]||(o[3]=i=>t.formData.isIdentityDelete=i),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),C.value.length?(m(),h(q,{key:0,images:C.value},null,8,["images"])):v("",!0)]))],40,ee)]),_:1},8,["items"])]),_:1})]),_:1},8,["title","toolbarItems"]),e.$mf.isSet(t.user)?(m(),h(W,{key:0,ref:"pdf"},null,512)):v("",!0)],64)}}};export{ue as default};
