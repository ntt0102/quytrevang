import{m as d,a as c,n as u}from"./app-f37d1114.js";import{L as m}from"./ListTagBox-d12dc9fb.js";import{D as p,a as g}from"./data-grid-ec6370c3.js";import"./ui.data_grid.row_dragging-72b50656.js";import"./dialog-42ea61b6.js";function l(){return{roles:[],permissions:[]}}const h={roles:t=>t.roles,permissions:t=>t.permissions},v={validateDuplicateName({state:t,rootGetters:e},s){const a=t.roles.find(i=>i.id===s.data.id);return a&&s.value==a.name?Promise.resolve(!0):new Promise((i,n)=>{axios.post("settings/roles/validate-duplicate-name",{name:s.value},{noLoading:!0}).then(o=>{i(o.data)})})},fetch({commit:t,dispatch:e,getters:s,state:a,rootGetters:i}){return new Promise((n,o)=>{axios.get("settings/roles").then(r=>{t("setState",r.data),n()})})},save({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},n){return new Promise((o,r)=>{axios.post("settings/roles",{changes:n.changes}).then(C=>{o(),e("fetch")})})},resetState({commit:t}){t("resetState")}},f={setState(t,e){t.roles=e.roles,t.permissions=e.permissions},resetState(t){t=Object.assign(t,l())}},x={namespaced:!0,state:l,getters:h,actions:v,mutations:f};const _={components:{ListTagBox:m,DxDataGrid:p,DxColumn:g},data(){return{gridData:null,calculateFilterExpression:function(t,e,s){return s==="search"&&typeof t=="string"?[this.dataField,"contains",t]:function(a){return(a.permissions||[]).indexOf(t)!==-1}},validationRules:{name:[{type:"required",message:this.$t("settings.roles.name")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateName,message:this.$t("settings.roles.name")+this.$mt.validations.duplicate}],permissions:[{type:"required",message:this.$t("settings.roles.permission")+this.$mt.validations.required}]}}},beforeCreate(){this.$store.registerModule("Settings.roles",x)},created(){this.fetch()},destroyed(){this.$store.unregisterModule("Settings.roles")},watch:{roles(){this.cloneDeepData()}},computed:{...d("Settings.roles",["roles","permissions"]),dataGrid:function(){return this.$refs.dataGrid.instance}},methods:{...c("Settings.roles",["fetch","save","validateDuplicateName","resetState"]),onSave(t){this.$bus.emit("checkPin",()=>this.save(t))},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.roles)},cellTemplate(t,e){var s="Â ",a=(e.value||[]).map(i=>e.column.lookup.calculateCellValue(i)).join(", ");t.textContent=a||s,t.title=a},onValueChanged(t,e){e.setValue(t),e.component.updateDimensions()}}};var D=function(){var e=this,s=e._self._c;return s("div",{staticClass:"settings-page"},[s("h2",{staticClass:"content-block"},[e._v(" "+e._s(e.$t("settings.roles.title"))+" ")]),s("div",{staticClass:"content-block dx-card responsive-paddings"},[s("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":e.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,mode:"batch",startEditAction:"dblClick"}},on:{contentReady:function(a){return e.$mf.dataGridPreload(e.gridData,e.dataGrid)},saved:e.onSave},scopedSlots:e._u([{key:"tagBoxEditor",fn:function({data:a}){return[s("ListTagBox",{attrs:{width:300,height:400,value:a.value,"on-value-changed":i=>e.onValueChanged(i,a),"data-source":e.permissions,"data-grid-component":a.component}})]}},{key:"commandCellTemplate",fn:function({data:a}){return[s("DxToolbar",{attrs:{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:e.$t("buttons.delete"),text:e.$t("buttons.delete"),onClick:()=>{e.dataGrid.deleteRow(a.rowIndex)}}}]}})]}}])},[s("DxColumn",{attrs:{fixed:!0,width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t("titles.commandHeaderTitleShort")}}),s("DxColumn",{attrs:{"data-field":"name","header-filter":{allowSearch:!0},caption:e.$t("settings.roles.name"),"validation-rules":e.validationRules.name}}),s("DxColumn",{attrs:{"allow-sorting":!1,"data-field":"permissions","cell-template":e.cellTemplate,"calculate-filter-expression":e.calculateFilterExpression,"header-filter":{allowSearch:!0},"edit-cell-template":"tagBoxEditor",caption:e.$t("settings.roles.permission"),"validation-rules":e.validationRules.permissions,lookup:{dataSource:e.permissions}}})],1)],1)])},S=[],w=u(_,D,S,!1,null,"93e13487",null,null);const R=w.exports;export{R as default};
