import{y as Va,u as Ia,c as Ba,i as st,r as Y,d as Fa,e as ui,x as Wa,z as za,w as di,v as J,f as Na,g as Ha,h as I,j as Vt,A as It,t as fi,B as ye,C as Ua,E as Ya,G as Ce,F as Xa,H as mi,I as $a,o as qa}from"./app-dcd2c724.js";import ja from"./CopyistStatusPopup-6a40ddf2.js";import Ga from"./ColorPicker-c108e54c.js";const Za="/build/assets/spinner-4da4a8c6.gif";class Ka{constructor(){this.create()}create(){return new Promise((e,t)=>{const r=indexedDB.open("orderChart",1);r.onupgradeneeded=a=>{this.store=a.target.result,this.store.createObjectStore("order",{keyPath:"kind"}),this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("box",{keyPath:"point"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("pattern2",{keyPath:"point"}),this.store.createObjectStore("volprofile",{keyPath:"time"}),this.store.createObjectStore("alert",{keyPath:"price"}),e()},r.onsuccess=a=>{this.store=a.target.result,e()},r.onerror=()=>{location.reload(),t()}})}get(e){var t=this.store;return new Promise(function(a,n){var _=t.transaction(e,"readonly");if(Array.isArray(e)){var o=e.map(c=>_.objectStore(c)),l=o.map(r);Promise.all(l).then(c=>a(c))}else{var v=_.objectStore(e);r(v).then(c=>a(c))}});function r(a){return new Promise(function(n,_){const o=a.getAll();o.onsuccess=l=>n(l.target.result),o.onerror=()=>_()})}}set(e,t){const r=this.store.transaction(e,"readwrite").objectStore(e);Array.isArray(t)?t.length>0&&t.forEach(a=>r.put(a)):r.put(t)}clear(e){var t=this.store;return new Promise(function(r,a){const n=t.transaction(e,"readwrite").objectStore(e).clear();n.onsuccess=()=>{r()},n.onerror=_=>{console.error(`Error to empty Object Store: ${e}`),a()}})}}const w=new Ka;var Ja={allowDownsampling:!0};function Qa(i,e){return e===void 0&&(e=Ja),new en(i,e)}var en=function(){function i(e,t){var r=this;this._resolutionMediaQueryList=null,this._resolutionListener=function(a){return r._onResolutionChanged()},this._canvasConfiguredListeners=[],this.canvas=e,this._canvasSize={width:this.canvas.clientWidth,height:this.canvas.clientHeight},this._options=t,this._configureCanvas(),this._installResolutionListener()}return i.prototype.destroy=function(){this._canvasConfiguredListeners.length=0,this._uninstallResolutionListener(),this.canvas=null},Object.defineProperty(i.prototype,"canvasSize",{get:function(){return{width:this._canvasSize.width,height:this._canvasSize.height}},enumerable:!0,configurable:!0}),i.prototype.resizeCanvas=function(e){this._canvasSize={width:e.width,height:e.height},this._configureCanvas()},Object.defineProperty(i.prototype,"pixelRatio",{get:function(){var e=this.canvas.ownerDocument.defaultView;if(e==null)throw new Error("No window is associated with the canvas");return e.devicePixelRatio>1||this._options.allowDownsampling?e.devicePixelRatio:1},enumerable:!0,configurable:!0}),i.prototype.subscribeCanvasConfigured=function(e){this._canvasConfiguredListeners.push(e)},i.prototype.unsubscribeCanvasConfigured=function(e){this._canvasConfiguredListeners=this._canvasConfiguredListeners.filter(function(t){return t!=e})},i.prototype._configureCanvas=function(){var e=this.pixelRatio;this.canvas.style.width=this._canvasSize.width+"px",this.canvas.style.height=this._canvasSize.height+"px",this.canvas.width=this._canvasSize.width*e,this.canvas.height=this._canvasSize.height*e,this._emitCanvasConfigured()},i.prototype._emitCanvasConfigured=function(){var e=this;this._canvasConfiguredListeners.forEach(function(t){return t.call(e)})},i.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var e=this.canvas.ownerDocument.defaultView;if(e==null)throw new Error("No window is associated with the canvas");var t=e.devicePixelRatio;this._resolutionMediaQueryList=e.matchMedia("all and (resolution: "+t+"dppx)"),this._resolutionMediaQueryList.addListener(this._resolutionListener)},i.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},i.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},i.prototype._onResolutionChanged=function(){this._configureCanvas(),this._reinstallResolutionListener()},i}();/*!
 * @license
 * TradingView Lightweight Charts v3.8.0-dev+202305090356
 * Copyright (c) 2020 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */var gi;(function(i){i[i.Simple=0]="Simple",i[i.WithSteps=1]="WithSteps"})(gi||(gi={}));var yi;(function(i){i[i.Solid=0]="Solid",i[i.Dotted=1]="Dotted",i[i.Dashed=2]="Dashed",i[i.LargeDashed=3]="LargeDashed",i[i.SparseDotted=4]="SparseDotted"})(yi||(yi={}));function xe(i,e){var t,r=(t={},t[0]=[],t[1]=[i.lineWidth,i.lineWidth],t[2]=[2*i.lineWidth,2*i.lineWidth],t[3]=[6*i.lineWidth,6*i.lineWidth],t[4]=[i.lineWidth,4*i.lineWidth],t),a=r[e];i.setLineDash(a)}function or(i,e,t,r){i.beginPath();var a=i.lineWidth%2?.5:0;i.moveTo(t,e+a),i.lineTo(r,e+a),i.stroke()}function tn(i,e,t,r){i.beginPath();var a=i.lineWidth%2?.5:0;i.moveTo(e+a,t),i.lineTo(e+a,r),i.stroke()}function rn(i,e){i.save(),i.lineWidth%2&&i.translate(.5,.5),e(),i.restore()}function re(i,e){if(!i)throw new Error("Assertion failed"+(e?": "+e:""))}function se(i){if(i===void 0)throw new Error("Value is undefined");return i}function C(i){if(i===null)throw new Error("Value is null");return i}function Ye(i){return C(se(i))}var bi={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function _e(i){return i<0?0:i>255?255:Math.round(i)||0}function lr(i){return!(i<=0)&&!(i>0)||i<0?0:i>1?1:Math.round(i*1e4)/1e4}var an=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,nn=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,_n=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,sn=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function mt(i){i=i.toLowerCase(),i in bi&&(i=bi[i]);{var e=sn.exec(i)||_n.exec(i);if(e)return[_e(parseInt(e[1],10)),_e(parseInt(e[2],10)),_e(parseInt(e[3],10)),lr(e.length<5?1:parseFloat(e[4]))]}{var e=nn.exec(i);if(e)return[_e(parseInt(e[1],16)),_e(parseInt(e[2],16)),_e(parseInt(e[3],16)),1]}{var e=an.exec(i);if(e)return[_e(parseInt(e[1],16)*17),_e(parseInt(e[2],16)*17),_e(parseInt(e[3],16)*17),1]}throw new Error("Cannot parse color: ".concat(i))}function on(i){var e=.199,t=.687,r=.114;return e*i[0]+t*i[1]+r*i[2]}function ln(i,e){if(i==="transparent")return i;var t=mt(i),r=t[3];return"rgba(".concat(t[0],", ").concat(t[1],", ").concat(t[2],", ").concat(e*r,")")}function Ct(i){var e=mt(i);return{_internal_background:"rgb(".concat(e[0],", ").concat(e[1],", ").concat(e[2],")"),_internal_foreground:on(e)>160?"black":"white"}}function pn(i,e,t){var r=mt(i),a=r[0],n=r[1],_=r[2],o=r[3],l=mt(e),v=l[0],c=l[1],u=l[2],d=l[3],m=[_e(a+t*(v-a)),_e(n+t*(c-n)),_e(_+t*(u-_)),lr(o+t*(d-o))];return"rgba(".concat(m[0],", ").concat(m[1],", ").concat(m[2],", ").concat(m[3],")")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Gt=function(i,e){return Gt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Gt(i,e)};function B(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Gt(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var F=function(){return F=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},F.apply(this,arguments)};function cn(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(i);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(i,r[a])&&(t[r[a]]=i[r[a]]);return t}function pr(i,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,n;r<a;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return i.concat(n||Array.prototype.slice.call(e))}var U=function(){function i(){this._private__listeners=[]}return i.prototype.subscribe=function(e,t,r){var a={_internal_callback:e,_internal_linkedObject:t,_internal_singleshot:r===!0};this._private__listeners.push(a)},i.prototype.unsubscribe=function(e){var t=this._private__listeners.findIndex(function(r){return e===r._internal_callback});t>-1&&this._private__listeners.splice(t,1)},i.prototype.unsubscribeAll=function(e){this._private__listeners=this._private__listeners.filter(function(t){return t._internal_linkedObject!==e})},i.prototype._internal_fire=function(e,t){var r=pr([],this._private__listeners,!0);this._private__listeners=this._private__listeners.filter(function(a){return!a._internal_singleshot}),r.forEach(function(a){return a._internal_callback(e,t)})},i.prototype._internal_hasListeners=function(){return this._private__listeners.length>0},i.prototype._internal_destroy=function(){this._private__listeners=[]},i}();function $(i){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];for(var r=0,a=e;r<a.length;r++){var n=a[r];for(var _ in n)n[_]!==void 0&&(typeof n[_]!="object"||i[_]===void 0?i[_]=n[_]:$(i[_],n[_]))}return i}function he(i){return typeof i=="number"&&isFinite(i)}function je(i){return typeof i=="number"&&i%1===0}function Jt(i){return typeof i=="string"}function Bt(i){return typeof i=="boolean"}function ee(i){var e=i;if(!e||typeof e!="object")return e;var t;Array.isArray(e)?t=[]:t={};var r,a;for(r in e)e.hasOwnProperty(r)&&(a=e[r],a&&typeof a=="object"?t[r]=ee(a):t[r]=a);return t}function vn(i){return i!==null}function gt(i){return i===null?void 0:i}var Qt="'Trebuchet MS', Roboto, Ubuntu, sans-serif";function Le(i,e,t){return t!==void 0?t="".concat(t," "):t="",e===void 0&&(e=Qt),"".concat(t).concat(i,"px ").concat(e)}var hn=function(){function i(e){this._private__rendererOptions={borderSize:1,tickLength:4,fontSize:NaN,font:"",fontFamily:"",color:"",paddingBottom:0,paddingInner:0,paddingOuter:0,paddingTop:0,baselineOffset:0},this._private__chartModel=e}return i.prototype.options=function(){var e=this._private__rendererOptions,t=this._private__fontSize(),r=this._private__fontFamily();return(e.fontSize!==t||e.fontFamily!==r)&&(e.fontSize=t,e.fontFamily=r,e.font=Le(t,r),e.paddingTop=Math.floor(t/3.5),e.paddingBottom=e.paddingTop,e.paddingInner=Math.max(Math.ceil(t/2-e.tickLength/2),0),e.paddingOuter=Math.ceil(t/2+e.tickLength/2),e.baselineOffset=Math.round(t/10)),e.color=this._private__textColor(),this._private__rendererOptions},i.prototype._private__textColor=function(){return this._private__chartModel.options().layout.textColor},i.prototype._private__fontSize=function(){return this._private__chartModel.options().layout.fontSize},i.prototype._private__fontFamily=function(){return this._private__chartModel.options().layout.fontFamily},i}(),wt=function(){function i(){this._private__renderers=[]}return i.prototype._internal_setRenderers=function(e){this._private__renderers=e},i.prototype.draw=function(e,t,r,a){this._private__renderers.forEach(function(n){e.save(),n.draw(e,t,r,a),e.restore()})},i}(),Ze=function(){function i(){}return i.prototype.draw=function(e,t,r,a){e.save(),e.scale(t,t),this._internal__drawImpl(e,r,a),e.restore()},i.prototype.drawBackground=function(e,t,r,a){e.save(),e.scale(t,t),this._internal__drawBackgroundImpl(e,r,a),e.restore()},i.prototype._internal__drawBackgroundImpl=function(e,t,r){},i}(),un=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._internal__data=null,t}return e.prototype._internal_setData=function(t){this._internal__data=t},e.prototype._internal__drawImpl=function(t){if(!(this._internal__data===null||this._internal__data._internal_visibleRange===null)){var r=this._internal__data._internal_visibleRange,a=this._internal__data,n=function(_){t.beginPath();for(var o=r.to-1;o>=r.from;--o){var l=a._internal_items[o];t.moveTo(l.x,l.y),t.arc(l.x,l.y,_,0,Math.PI*2)}t.fill()};t.fillStyle=a._internal_backColor,n(a._internal_radius+2),t.fillStyle=a._internal_lineColor,n(a._internal_radius)}},e}(Ze);function dn(){return{_internal_items:[{x:0,y:0,time:0,price:0}],_internal_lineColor:"",_internal_backColor:"",_internal_radius:0,_internal_visibleRange:null}}var fn={from:0,to:1},mn=function(){function i(e,t){this._private__compositeRenderer=new wt,this._private__markersRenderers=[],this._private__markersData=[],this._private__invalidated=!0,this._private__chartModel=e,this._private__crosshair=t,this._private__compositeRenderer._internal_setRenderers(this._private__markersRenderers)}return i.prototype.update=function(e){var t=this._private__chartModel.serieses();t.length!==this._private__markersRenderers.length&&(this._private__markersData=t.map(dn),this._private__markersRenderers=this._private__markersData.map(function(r){var a=new un;return a._internal_setData(r),a}),this._private__compositeRenderer._internal_setRenderers(this._private__markersRenderers)),this._private__invalidated=!0},i.prototype.renderer=function(e,t,r){return this._private__invalidated&&(this._private__updateImpl(e),this._private__invalidated=!1),this._private__compositeRenderer},i.prototype._private__updateImpl=function(e){var t=this,r=this._private__chartModel.serieses(),a=this._private__crosshair.appliedIndex(),n=this._private__chartModel.timeScale();r.forEach(function(_,o){var l,v=t._private__markersData[o],c=_.markerDataAtIndex(a);if(c===null||!_.visible()){v._internal_visibleRange=null;return}var u=C(_.firstValue());v._internal_lineColor=c.backgroundColor,v._internal_radius=c.radius,v._internal_items[0].price=c.price,v._internal_items[0].y=_.priceScale().priceToCoordinate(c.price,u.value),v._internal_backColor=(l=c.borderColor)!==null&&l!==void 0?l:t._private__chartModel.backgroundColorAtYPercentFromTop(v._internal_items[0].y/e),v._internal_items[0].time=a,v._internal_items[0].x=n.indexToCoordinate(a),v._internal_visibleRange=fn})},i}(),gn=function(){function i(e){this._private__data=e}return i.prototype.draw=function(e,t,r,a){if(this._private__data!==null){var n=this._private__data._internal_vertLine._internal_visible,_=this._private__data._internal_horzLine._internal_visible;if(!(!n&&!_)){e.save();var o=Math.round(this._private__data._internal_x*t),l=Math.round(this._private__data._internal_y*t),v=Math.ceil(this._private__data._internal_w*t),c=Math.ceil(this._private__data._internal_h*t);e.lineCap="butt",n&&o>=0&&(e.lineWidth=Math.floor(this._private__data._internal_vertLine._internal_lineWidth*t),e.strokeStyle=this._private__data._internal_vertLine._internal_color,e.fillStyle=this._private__data._internal_vertLine._internal_color,xe(e,this._private__data._internal_vertLine._internal_lineStyle),tn(e,o,0,c)),_&&l>=0&&(e.lineWidth=Math.floor(this._private__data._internal_horzLine._internal_lineWidth*t),e.strokeStyle=this._private__data._internal_horzLine._internal_color,e.fillStyle=this._private__data._internal_horzLine._internal_color,xe(e,this._private__data._internal_horzLine._internal_lineStyle),or(e,l,0,v)),e.restore()}}},i}(),yn=function(){function i(e){this._private__invalidated=!0,this._private__rendererData={_internal_vertLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_horzLine:{_internal_lineWidth:1,_internal_lineStyle:0,_internal_color:"",_internal_visible:!1},_internal_w:0,_internal_h:0,_internal_x:0,_internal_y:0},this._private__renderer=new gn(this._private__rendererData),this._private__source=e}return i.prototype._internal_update=function(){this._private__invalidated=!0},i.prototype.renderer=function(e,t){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer},i.prototype._private__updateImpl=function(){var e=this._private__source.visible(),t=C(this._private__source.pane()),r=t.model().options().crosshair,a=this._private__rendererData;a._internal_horzLine._internal_visible=e&&this._private__source.horzLineVisible(t),a._internal_vertLine._internal_visible=e&&this._private__source.vertLineVisible(),a._internal_horzLine._internal_lineWidth=r.horzLine.width,a._internal_horzLine._internal_lineStyle=r.horzLine.style,a._internal_horzLine._internal_color=r.horzLine.color,a._internal_vertLine._internal_lineWidth=r.vertLine.width,a._internal_vertLine._internal_lineStyle=r.vertLine.style,a._internal_vertLine._internal_color=r.vertLine.color,a._internal_w=t.width(),a._internal_h=t.height(),a._internal_x=this._private__source.appliedX(),a._internal_y=this._private__source.appliedY()},i}();function bn(i,e,t,r,a,n){i.fillRect(e+n,t,r-n*2,n),i.fillRect(e+n,t+a-n,r-n*2,n),i.fillRect(e,t,n,a),i.fillRect(e+r-n,t,n,a)}function de(i,e,t){i.save(),i.scale(e,e),t(),i.restore()}function Pt(i,e,t,r,a,n){i.save(),i.globalCompositeOperation="copy",i.fillStyle=n,i.fillRect(e,t,r,a),i.restore()}function cr(i,e,t,r,a,n,_){i.save(),i.globalCompositeOperation="copy";var o=i.createLinearGradient(0,0,0,a);o.addColorStop(0,n),o.addColorStop(1,_),i.fillStyle=o,i.fillRect(e,t,r,a),i.restore()}var Si=function(){function i(e,t){this.setData(e,t)}return i.prototype.setData=function(e,t){this._private__data=e,this._private__commonData=t},i.prototype.draw=function(e,t,r,a,n,_){if(this._private__data.visible){e.font=t.font;var o=this._private__data.tickVisible||!this._private__data.moveTextToInvisibleTick?t.tickLength:0,l=t.borderSize,v=t.paddingTop,c=t.paddingBottom,u=t.paddingInner,d=t.paddingOuter,m=this._private__data.text,g=Math.ceil(r.measureText(e,m)),S=t.baselineOffset,y=t.fontSize+v+c,b=Math.ceil(y*.5),x=l+g+u+d+o,D=this._private__commonData.coordinate;this._private__commonData.fixedCoordinate&&(D=this._private__commonData.fixedCoordinate),D=Math.round(D);var V=D-b,E=V+y,W=n==="right",H=W?a:0,G=Math.ceil(a*_),Z=H,j,fe;if(e.fillStyle=this._private__commonData.background,e.lineWidth=1,e.lineCap="butt",m){W?(Z=H-x,j=H-o,fe=Z+d):(Z=H+x,j=H+o,fe=H+l+o+u);var Qe=Math.max(1,Math.floor(_)),s=Math.max(1,Math.floor(l*_)),A=W?G:0,X=Math.round(V*_),et=Math.round(Z*_),ze=Math.round(D*_)-Math.floor(_*.5),Ne=ze+Qe+(ze-X),Lt=Math.round(j*_);e.save(),e.beginPath(),e.moveTo(A,X),e.lineTo(et,X),e.lineTo(et,Ne),e.lineTo(A,Ne),e.fill(),e.fillStyle=this._private__data.borderColor,e.fillRect(W?G-s:0,X,s,Ne-X),this._private__data.tickVisible&&(e.fillStyle=this._private__commonData.color,e.fillRect(A,ze,Lt-A,Qe)),e.textAlign="left",e.fillStyle=this._private__commonData.color,de(e,_,function(){e.fillText(m,fe,E-c-S)}),e.restore()}}},i.prototype.height=function(e,t){return this._private__data.visible?e.fontSize+e.paddingTop+e.paddingBottom:0},i}(),ei=function(){function i(e){this._private__commonRendererData={coordinate:0,color:"#FFF",background:"#000"},this._private__axisRendererData={text:"",visible:!1,tickVisible:!0,moveTextToInvisibleTick:!1,borderColor:""},this._private__paneRendererData={text:"",visible:!1,tickVisible:!1,moveTextToInvisibleTick:!0,borderColor:""},this._private__invalidated=!0,this._private__axisRenderer=new(e||Si)(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer=new(e||Si)(this._private__paneRendererData,this._private__commonRendererData)}return i.prototype.text=function(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData.text},i.prototype.coordinate=function(){return this._private__updateRendererDataIfNeeded(),this._private__commonRendererData.coordinate},i.prototype.update=function(){this._private__invalidated=!0},i.prototype.height=function(e,t){return t===void 0&&(t=!1),Math.max(this._private__axisRenderer.height(e,t),this._private__paneRenderer.height(e,t))},i.prototype.getFixedCoordinate=function(){return this._private__commonRendererData.fixedCoordinate||0},i.prototype.setFixedCoordinate=function(e){this._private__commonRendererData.fixedCoordinate=e},i.prototype.isVisible=function(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData.visible||this._private__paneRendererData.visible},i.prototype.isAxisLabelVisible=function(){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData.visible},i.prototype.renderer=function(e){return this._private__updateRendererDataIfNeeded(),this._private__axisRendererData.tickVisible=this._private__axisRendererData.tickVisible&&e.options().drawTicks,this._private__paneRendererData.tickVisible=this._private__paneRendererData.tickVisible&&e.options().drawTicks,this._private__axisRenderer.setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer.setData(this._private__paneRendererData,this._private__commonRendererData),this._private__axisRenderer},i.prototype.paneRenderer=function(){return this._private__updateRendererDataIfNeeded(),this._private__axisRenderer.setData(this._private__axisRendererData,this._private__commonRendererData),this._private__paneRenderer.setData(this._private__paneRendererData,this._private__commonRendererData),this._private__paneRenderer},i.prototype._private__updateRendererDataIfNeeded=function(){this._private__invalidated&&(this._private__axisRendererData.tickVisible=!0,this._private__paneRendererData.tickVisible=!1,this._internal__updateRendererData(this._private__axisRendererData,this._private__paneRendererData,this._private__commonRendererData))},i}(),Sn=function(i){B(e,i);function e(t,r,a){var n=i.call(this)||this;return n._private__source=t,n._private__priceScale=r,n._private__valueProvider=a,n}return e.prototype._internal__updateRendererData=function(t,r,a){t.visible=!1;var n=this._private__source.options().horzLine;if(n.labelVisible){var _=this._private__priceScale.firstValue();if(!(!this._private__source.visible()||this._private__priceScale.isEmpty()||_===null)){var o=Ct(n.labelBackgroundColor);a.background=o._internal_background,a.color=o._internal_foreground;var l=this._private__valueProvider(this._private__priceScale);a.coordinate=l._internal_coordinate,t.text=this._private__priceScale.formatPrice(l._internal_price,_),t.visible=!0}}},e}(ei),Cn=/[1-9]/g,wn=function(){function i(){this._private__data=null}return i.prototype.setData=function(e){this._private__data=e},i.prototype.draw=function(e,t,r){var a=this;if(!(this._private__data===null||this._private__data.visible===!1||this._private__data.text.length===0)){e.font=t.font;var n=Math.round(t.widthCache.measureText(e,this._private__data.text,Cn));if(!(n<=0)){e.save();var _=t.paddingHorizontal,o=n+2*_,l=o/2,v=this._private__data.width,c=this._private__data.coordinate,u=Math.floor(c-l)+.5;u<0?(c=c+Math.abs(0-u),u=Math.floor(c-l)+.5):u+o>v&&(c=c-Math.abs(v-(u+o)),u=Math.floor(c-l)+.5);var d=u+o,m=0,g=m+t.borderSize+t.paddingTop+t.fontSize+t.paddingBottom;e.fillStyle=this._private__data.background;var S=Math.round(u*r),y=Math.round(m*r),b=Math.round(d*r),x=Math.round(g*r);e.fillRect(S,y,b-S,x-y);var D=Math.round(this._private__data.coordinate*r),V=y,E=Math.round((V+t.borderSize+t.tickLength)*r);e.fillStyle=this._private__data.color;var W=Math.max(1,Math.floor(r)),H=Math.floor(r*.5);e.fillRect(D-H,V,W,E-V);var G=g-t.baselineOffset-t.paddingBottom;e.textAlign="left",e.fillStyle=this._private__data.color,de(e,r,function(){e.fillText(C(a._private__data).text,u+_,G)}),e.restore()}}},i}(),Pn=function(){function i(e,t,r){this._private__invalidated=!0,this._private__renderer=new wn,this._private__rendererData={visible:!1,background:"#4c525e",color:"white",text:"",width:0,coordinate:NaN},this._private__crosshair=e,this._private__model=t,this._private__valueProvider=r}return i.prototype._internal_update=function(){this._private__invalidated=!0},i.prototype.renderer=function(){return this._private__invalidated&&(this._private__updateImpl(),this._private__invalidated=!1),this._private__renderer.setData(this._private__rendererData),this._private__renderer},i.prototype._private__updateImpl=function(){var e=this._private__rendererData;e.visible=!1;var t=this._private__crosshair.options().vertLine;if(t.labelVisible){var r=this._private__model.timeScale();if(!r.isEmpty()){var a=r.indexToTime(this._private__crosshair.appliedIndex());e.width=r.width();var n=this._private__valueProvider();if(n._internal_time){e.coordinate=n._internal_coordinate,e.text=r.formatDateTime(C(a)),e.visible=!0;var _=Ct(t.labelBackgroundColor);e.background=_._internal_background,e.color=_._internal_foreground}}}},i}(),ti=function(){function i(){this._priceScale=null,this._private__zorder=0}return i.prototype.zorder=function(){return this._private__zorder},i.prototype.setZorder=function(e){this._private__zorder=e},i.prototype.priceScale=function(){return this._priceScale},i.prototype.setPriceScale=function(e){this._priceScale=e},i.prototype.timeAxisViews=function(){return[]},i.prototype.visible=function(){return!0},i}(),Ci;(function(i){i[i.Normal=0]="Normal",i[i.Magnet=1]="Magnet"})(Ci||(Ci={}));var Tn=function(i){B(e,i);function e(t,r){var a=i.call(this)||this;a._private__pane=null,a._private__price=NaN,a._private__index=0,a._private__visible=!0,a._private__priceAxisViews=new Map,a._private__subscribed=!1,a._private__x=NaN,a._private__y=NaN,a._private__originX=NaN,a._private__originY=NaN,a._private__model=t,a._private__options=r,a._private__markersPaneView=new mn(t,a);var n=function(l,v){return function(c){var u=v(),d=l();if(c===C(a._private__pane).defaultPriceScale())return{_internal_price:d,_internal_coordinate:u};var m=C(c.firstValue()),g=c.coordinateToPrice(u,m);return{_internal_price:g,_internal_coordinate:u}}},_=function(l,v){return function(){return{_internal_time:a._private__model.timeScale().indexToTime(l()),_internal_coordinate:v()}}};a._private__currentPosPriceProvider=n(function(){return a._private__price},function(){return a._private__y});var o=_(function(){return a._private__index},function(){return a.appliedX()});return a._private__timeAxisView=new Pn(a,t,o),a._private__paneView=new yn(a),a}return e.prototype.options=function(){return this._private__options},e.prototype.saveOriginCoord=function(t,r){this._private__originX=t,this._private__originY=r},e.prototype.clearOriginCoord=function(){this._private__originX=NaN,this._private__originY=NaN},e.prototype.originCoordX=function(){return this._private__originX},e.prototype.originCoordY=function(){return this._private__originY},e.prototype.setPosition=function(t,r,a){this._private__subscribed||(this._private__subscribed=!0),this._private__visible=!0,this._private__tryToUpdateViews(t,r,a)},e.prototype.appliedIndex=function(){return this._private__index},e.prototype.appliedX=function(){return this._private__x},e.prototype.appliedY=function(){return this._private__y},e.prototype.visible=function(){return this._private__visible},e.prototype.clearPosition=function(){this._private__visible=!1,this._private__setIndexToLastSeriesBarIndex(),this._private__price=NaN,this._private__x=NaN,this._private__y=NaN,this._private__pane=null,this.clearOriginCoord()},e.prototype.paneViews=function(t){return this._private__pane!==null?[this._private__paneView,this._private__markersPaneView]:[]},e.prototype.horzLineVisible=function(t){return t===this._private__pane&&this._private__options.horzLine.visible},e.prototype.vertLineVisible=function(){return this._private__options.vertLine.visible},e.prototype.priceAxisViews=function(t,r){(!this._private__visible||this._private__pane!==t)&&this._private__priceAxisViews.clear();var a=[];return this._private__pane===t&&a.push(this._private__createPriceAxisViewOnDemand(this._private__priceAxisViews,r,this._private__currentPosPriceProvider)),a},e.prototype.timeAxisViews=function(){return this._private__visible?[this._private__timeAxisView]:[]},e.prototype.pane=function(){return this._private__pane},e.prototype.updateAllViews=function(){this._private__paneView._internal_update(),this._private__priceAxisViews.forEach(function(t){return t.update()}),this._private__timeAxisView._internal_update(),this._private__markersPaneView.update()},e.prototype._private__priceScaleByPane=function(t){return t&&!t.defaultPriceScale().isEmpty()?t.defaultPriceScale():null},e.prototype._private__tryToUpdateViews=function(t,r,a){this._private__tryToUpdateData(t,r,a)&&this.updateAllViews()},e.prototype._private__tryToUpdateData=function(t,r,a){var n=this._private__x,_=this._private__y,o=this._private__price,l=this._private__index,v=this._private__pane,c=this._private__priceScaleByPane(a);this._private__index=t,this._private__x=isNaN(t)?NaN:this._private__model.timeScale().indexToCoordinate(t),this._private__pane=a;var u=c!==null?c.firstValue():null;return c!==null&&u!==null?(this._private__price=r,this._private__y=c.priceToCoordinate(r,u)):(this._private__price=NaN,this._private__y=NaN),n!==this._private__x||_!==this._private__y||l!==this._private__index||o!==this._private__price||v!==this._private__pane},e.prototype._private__setIndexToLastSeriesBarIndex=function(){var t=this._private__model.serieses().map(function(a){return a.bars().lastIndex()}).filter(vn),r=t.length===0?null:Math.max.apply(Math,t);this._private__index=r!==null?r:NaN},e.prototype._private__createPriceAxisViewOnDemand=function(t,r,a){var n=t.get(r);return n===void 0&&(n=new Sn(this,r,a),t.set(r,n)),n},e}(ti);function Tt(i){return i==="left"||i==="right"}function Mn(i,e){if(i===void 0)return e;var t=Math.max(i.level,e.level),r=i.autoScale||e.autoScale;return{level:t,autoScale:r}}var ne=function(){function i(e){this._private__invalidatedPanes=new Map,this._private__timeScaleInvalidations=[],this._private__globalLevel=e}return i.prototype.invalidatePane=function(e,t){var r=this._private__invalidatedPanes.get(e),a=Mn(r,t);this._private__invalidatedPanes.set(e,a)},i.prototype.fullInvalidation=function(){return this._private__globalLevel},i.prototype.invalidateForPane=function(e){var t=this._private__invalidatedPanes.get(e);return t===void 0?{level:this._private__globalLevel}:{level:Math.max(this._private__globalLevel,t.level),autoScale:t.autoScale}},i.prototype.setFitContent=function(){this._private__timeScaleInvalidations=[{type:0}]},i.prototype.applyRange=function(e){this._private__timeScaleInvalidations=[{type:1,value:e}]},i.prototype.resetTimeScale=function(){this._private__timeScaleInvalidations=[{type:4}]},i.prototype.setBarSpacing=function(e){this._private__timeScaleInvalidations.push({type:2,value:e})},i.prototype.setRightOffset=function(e){this._private__timeScaleInvalidations.push({type:3,value:e})},i.prototype.timeScaleInvalidations=function(){return this._private__timeScaleInvalidations},i.prototype.merge=function(e){for(var t=this,r=0,a=e._private__timeScaleInvalidations;r<a.length;r++){var n=a[r];this._private__applyTimeScaleInvalidation(n)}this._private__globalLevel=Math.max(this._private__globalLevel,e._private__globalLevel),e._private__invalidatedPanes.forEach(function(_,o){t.invalidatePane(o,_)})},i.prototype._private__applyTimeScaleInvalidation=function(e){switch(e.type){case 0:this.setFitContent();break;case 1:this.applyRange(e.value);break;case 2:this.setBarSpacing(e.value);break;case 3:this.setRightOffset(e.value);break;case 4:this.resetTimeScale();break}},i}(),wi={_internal_decimalSign:".",_internal_decimalSignFractional:"'"};function be(i,e){if(!he(i))return"n/a";if(!je(e))throw new TypeError("invalid length");if(e<0||e>16)throw new TypeError("invalid length");if(e===0)return i.toString();var t="0000000000000000";return(t+i.toString()).slice(-e)}var Mt=function(){function i(e,t){if(t||(t=1),(!he(e)||!je(e))&&(e=100),e<0)throw new TypeError("invalid base");this._private__priceScale=e,this._private__minMove=t,this._private__calculateDecimal()}return i.prototype.format=function(e){var t=e<0?"−":"";return e=Math.abs(e),t+this._private__formatAsDecimal(e)},i.prototype._private__calculateDecimal=function(){if(this._internal__fractionalLength=0,this._private__priceScale>0&&this._private__minMove>0)for(var e=this._private__priceScale;e>1;)e/=10,this._internal__fractionalLength++},i.prototype._private__formatAsDecimal=function(e){var t=this._private__priceScale/this._private__minMove,r=Math.floor(e),a="",n=this._internal__fractionalLength!==void 0?this._internal__fractionalLength:NaN;if(t>1){var _=+(Math.round(e*t)-r*t).toFixed(this._internal__fractionalLength);_>=t&&(_-=t,r+=1),a=wi._internal_decimalSign+be(+_.toFixed(this._internal__fractionalLength)*this._private__minMove,n)}else r=Math.round(r*t)/t,n>0&&(a=wi._internal_decimalSign+be(0,n));return r.toFixed(0)+a},i}(),vr=function(i){B(e,i);function e(t){return t===void 0&&(t=100),i.call(this,t)||this}return e.prototype.format=function(t){return"".concat(i.prototype.format.call(this,t),"%")},e}(Mt),kn=function(){function i(e){this._private__precision=e}return i.prototype.format=function(e){var t="";return e<0&&(t="-",e=-e),e<995?t+this._private__formatNumber(e):e<999995?t+this._private__formatNumber(e/1e3)+"K":e<999999995?(e=1e3*Math.round(e/1e3),t+this._private__formatNumber(e/1e6)+"M"):(e=1e6*Math.round(e/1e6),t+this._private__formatNumber(e/1e9)+"B")},i.prototype._private__formatNumber=function(e){var t,r=Math.pow(10,this._private__precision);return e=Math.round(e*r)/r,e>=1e-15&&e<1?t=e.toFixed(this._private__precision).replace(/\.?0+$/,""):t=String(e),t.replace(/(\.[1-9]*)0+$/,function(a,n){return n})},i}();function hr(i,e,t,r){if(e.length!==0){var a=e[r.from]._internal_x,n=e[r.from]._internal_y;i.moveTo(a,n);for(var _=r.from+1;_<r.to;++_){var o=e[_];if(t===1){var l=e[_-1]._internal_y,v=o._internal_x;i.lineTo(v,l)}i.lineTo(o._internal_x,o._internal_y)}}}var ur=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._internal__data=null,t}return e.prototype._internal_setData=function(t){this._internal__data=t},e.prototype._internal__drawImpl=function(t){if(!(this._internal__data===null||this._internal__data._internal_items.length===0||this._internal__data._internal_visibleRange===null)){if(t.lineCap="butt",t.lineJoin="round",t.lineWidth=this._internal__data._internal_lineWidth,xe(t,this._internal__data._internal_lineStyle),t.lineWidth=1,t.beginPath(),this._internal__data._internal_items.length===1){var r=this._internal__data._internal_items[0],a=this._internal__data._internal_barWidth/2;t.moveTo(r.x-a,this._internal__data._internal_baseLevelCoordinate),t.lineTo(r.x-a,r.y),t.lineTo(r.x+a,r.y),t.lineTo(r.x+a,this._internal__data._internal_baseLevelCoordinate)}else t.moveTo(this._internal__data._internal_items[this._internal__data._internal_visibleRange.from].x,this._internal__data._internal_baseLevelCoordinate),t.lineTo(this._internal__data._internal_items[this._internal__data._internal_visibleRange.from].x,this._internal__data._internal_items[this._internal__data._internal_visibleRange.from].y),hr(t,this._internal__data._internal_items,this._internal__data._internal_lineType,this._internal__data._internal_visibleRange),this._internal__data._internal_visibleRange.to>this._internal__data._internal_visibleRange.from&&(t.lineTo(this._internal__data._internal_items[this._internal__data._internal_visibleRange.to-1].x,this._internal__data._internal_baseLevelCoordinate),t.lineTo(this._internal__data._internal_items[this._internal__data._internal_visibleRange.from].x,this._internal__data._internal_baseLevelCoordinate));t.closePath(),t.fillStyle=this._internal__fillStyle(t),t.fill()}},e}(Ze),xn=function(i){B(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype._internal__fillStyle=function(t){var r=this._internal__data,a=t.createLinearGradient(0,0,0,r._internal_bottom);return a.addColorStop(0,r._internal_topColor),a.addColorStop(1,r._internal_bottomColor),a},e}(ur),dr=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._internal__data=null,t}return e.prototype._internal_setData=function(t){this._internal__data=t},e.prototype._internal__drawImpl=function(t){if(!(this._internal__data===null||this._internal__data._internal_items.length===0||this._internal__data._internal_visibleRange===null))if(t.lineCap="butt",t.lineWidth=this._internal__data._internal_lineWidth,xe(t,this._internal__data._internal_lineStyle),t.strokeStyle=this._internal__strokeStyle(t),t.lineJoin="round",this._internal__data._internal_items.length===1){t.beginPath();var r=this._internal__data._internal_items[0];t.moveTo(r.x-this._internal__data._internal_barWidth/2,r.y),t.lineTo(r.x+this._internal__data._internal_barWidth/2,r.y),r._internal_color!==void 0&&(t.strokeStyle=r._internal_color),t.stroke()}else this._internal__drawLine(t,this._internal__data)},e.prototype._internal__drawLine=function(t,r){t.beginPath(),hr(t,r._internal_items,r._internal_lineType,r._internal_visibleRange),t.stroke()},e}(Ze),fr=function(i){B(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype._internal__drawLine=function(t,r){var a,n,_=r._internal_items,o=r._internal_visibleRange,l=r._internal_lineType,v=r._internal_lineColor;if(!(_.length===0||o===null)){t.beginPath();var c=_[o.from];t.moveTo(c.x,c.y);var u=(a=c._internal_color)!==null&&a!==void 0?a:v;t.strokeStyle=u;for(var d=function(b){t.stroke(),t.beginPath(),t.strokeStyle=b,u=b},m=o.from+1;m<o.to;++m){var g=_[m],S=_[m-1],y=(n=g._internal_color)!==null&&n!==void 0?n:v;l===1&&(t.lineTo(g.x,S.y),y!==u&&(d(y),t.moveTo(g.x,S.y))),t.lineTo(g.x,g.y),l!==1&&y!==u&&(d(y),t.moveTo(g.x,g.y))}t.stroke()}},e.prototype._internal__strokeStyle=function(){return this._internal__data._internal_lineColor},e}(dr);function Ke(i,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=i.length);for(var n=a-r;0<n;){var _=n>>1,o=r+_;t(i[o],e)?(r=o+1,n-=_+1):n=_}return r}function mr(i,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=i.length);for(var n=a-r;0<n;){var _=n>>1,o=r+_;t(e,i[o])?n=_:(r=o+1,n-=_+1)}return r}function Ln(i,e){return i.time<e}function Rn(i,e){return i<e.time}function ii(i,e,t){var r=e.left(),a=e.right(),n=Ke(i,r,Ln),_=mr(i,a,Rn);if(!t)return{from:n,to:_};var o=n,l=_;return n>0&&n<i.length&&i[n].time>=r&&(o=n-1),_>0&&_<i.length&&i[_-1].time<=a&&(l=_+1),{from:o,to:l}}var ri=function(){function i(e,t,r){this._internal__invalidated=!0,this._internal__dataInvalidated=!0,this._internal__optionsInvalidated=!0,this._internal__items=[],this._internal__itemsVisibleRange=null,this._internal__series=e,this._internal__model=t,this._private__extendedVisibleRange=r}return i.prototype.update=function(e){this._internal__invalidated=!0,e==="data"&&(this._internal__dataInvalidated=!0),e==="options"&&(this._internal__optionsInvalidated=!0)},i.prototype._internal__makeValid=function(){this._internal__dataInvalidated&&(this._internal__fillRawPoints(),this._internal__dataInvalidated=!1),this._internal__invalidated&&(this._internal__updatePoints(),this._internal__invalidated=!1),this._internal__optionsInvalidated&&(this._internal__updateOptions(),this._internal__optionsInvalidated=!1)},i.prototype._internal__clearVisibleRange=function(){this._internal__itemsVisibleRange=null},i.prototype._internal__updatePoints=function(){var e=this._internal__series.priceScale(),t=this._internal__model.timeScale();if(this._internal__clearVisibleRange(),!(t.isEmpty()||e.isEmpty())){var r=t.visibleStrictRange();if(r!==null&&this._internal__series.bars().size()!==0){var a=this._internal__series.firstValue();a!==null&&(this._internal__itemsVisibleRange=ii(this._internal__items,r,this._private__extendedVisibleRange),this._internal__convertToCoordinates(e,t,a.value))}}},i}(),ai=function(i){B(e,i);function e(t,r){return i.call(this,t,r,!0)||this}return e.prototype._internal__convertToCoordinates=function(t,r,a){r.indexesToCoordinates(this._internal__items,gt(this._internal__itemsVisibleRange)),t.pointsArrayToCoordinates(this._internal__items,a,gt(this._internal__itemsVisibleRange))},e.prototype._internal__createRawItemBase=function(t,r){return{time:t,price:r,x:NaN,y:NaN}},e.prototype._internal__updateOptions=function(){},e.prototype._internal__fillRawPoints=function(){var t=this,r=this._internal__series.barColorer();this._internal__items=this._internal__series.bars().rows().map(function(a){var n=a.value[3];return t._internal__createRawItem(a.index,n,r)})},e}(ri),Dn=function(i){B(e,i);function e(t,r){var a=i.call(this,t,r)||this;return a._private__renderer=new wt,a._private__areaRenderer=new xn,a._private__lineRenderer=new fr,a._private__renderer._internal_setRenderers([a._private__areaRenderer,a._private__lineRenderer]),a}return e.prototype.renderer=function(t,r){if(!this._internal__series.visible())return null;var a=this._internal__series.options();return this._internal__makeValid(),this._private__areaRenderer._internal_setData({_internal_lineType:a.lineType,_internal_items:this._internal__items,_internal_lineStyle:a.lineStyle,_internal_lineWidth:a.lineWidth,_internal_topColor:a.topColor,_internal_bottomColor:a.bottomColor,_internal_baseLevelCoordinate:t,_internal_bottom:t,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:this._internal__model.timeScale().barSpacing()}),this._private__lineRenderer._internal_setData({_internal_lineType:a.lineType,_internal_items:this._internal__items,_internal_lineColor:a.lineColor,_internal_lineStyle:a.lineStyle,_internal_lineWidth:a.lineWidth,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:this._internal__model.timeScale().barSpacing()}),this._private__renderer},e.prototype._internal__createRawItem=function(t,r){return this._internal__createRawItemBase(t,r)},e}(ai);function On(i,e){return Math.floor(i*.3*e)}function An(i,e){var t=2.5,r=4,a=3;if(i>=t&&i<=r)return Math.floor(a*e);var n=.2,_=1-n*Math.atan(Math.max(r,i)-r)/(Math.PI*.5),o=Math.floor(i*_*e),l=Math.floor(i*e),v=Math.min(o,l);return Math.max(Math.floor(e),v)}var En=function(){function i(){this._private__data=null,this._private__barWidth=0,this._private__barLineWidth=0}return i.prototype._internal_setData=function(e){this._private__data=e},i.prototype.draw=function(e,t,r,a){if(!(this._private__data===null||this._private__data._internal_bars.length===0||this._private__data._internal_visibleRange===null)){if(this._private__barWidth=this._private__calcBarWidth(t),this._private__barWidth>=2){var n=Math.max(1,Math.floor(t));n%2!==this._private__barWidth%2&&this._private__barWidth--}this._private__barLineWidth=this._private__data._internal_thinBars?Math.min(this._private__barWidth,Math.floor(t)):this._private__barWidth;for(var _=null,o=this._private__barLineWidth<=this._private__barWidth&&this._private__data._internal_barSpacing>=Math.floor(1.5*t),l=this._private__data._internal_visibleRange.from;l<this._private__data._internal_visibleRange.to;++l){var v=this._private__data._internal_bars[l];_!==v._internal_color&&(e.fillStyle=v._internal_color,_=v._internal_color);var c=Math.floor(this._private__barLineWidth*.5),u=Math.round(v.x*t),d=u-c,m=this._private__barLineWidth,g=d+m-1,S=Math.min(v.highY,v.lowY),y=Math.max(v.highY,v.lowY),b=Math.round(S*t)-c,x=Math.round(y*t)+c,D=Math.max(x-b,this._private__barLineWidth);e.fillRect(d,b,m,D);var V=Math.ceil(this._private__barWidth*1.5);if(o){if(this._private__data._internal_openVisible){var E=u-V,W=Math.max(b,Math.round(v.openY*t)-c),H=W+m-1;H>b+D-1&&(H=b+D-1,W=H-m+1),e.fillRect(E,W,d-E,H-W+1)}var G=u+V,Z=Math.max(b,Math.round(v.closeY*t)-c),j=Z+m-1;j>b+D-1&&(j=b+D-1,Z=j-m+1),e.fillRect(g+1,Z,G-g,j-Z+1)}}}},i.prototype._private__calcBarWidth=function(e){var t=Math.floor(e);return Math.max(t,Math.floor(On(C(this._private__data)._internal_barSpacing,e)))},i}(),gr=function(i){B(e,i);function e(t,r){return i.call(this,t,r,!1)||this}return e.prototype._internal__convertToCoordinates=function(t,r,a){r.indexesToCoordinates(this._internal__items,gt(this._internal__itemsVisibleRange)),t.barPricesToCoordinates(this._internal__items,a,gt(this._internal__itemsVisibleRange))},e.prototype._internal__createDefaultItem=function(t,r,a){return{time:t,open:r.value[0],high:r.value[1],low:r.value[2],close:r.value[3],x:NaN,openY:NaN,highY:NaN,lowY:NaN,closeY:NaN}},e.prototype._internal__fillRawPoints=function(){var t=this,r=this._internal__series.barColorer();this._internal__items=this._internal__series.bars().rows().map(function(a){return t._internal__createRawItem(a.index,a,r)})},e}(ri),Vn=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._private__renderer=new En,t}return e.prototype.renderer=function(t,r){if(!this._internal__series.visible())return null;var a=this._internal__series.options();this._internal__makeValid();var n={_internal_bars:this._internal__items,_internal_barSpacing:this._internal__model.timeScale().barSpacing(),_internal_openVisible:a.openVisible,_internal_thinBars:a.thinBars,_internal_visibleRange:this._internal__itemsVisibleRange};return this._private__renderer._internal_setData(n),this._private__renderer},e.prototype._internal__updateOptions=function(){var t=this;this._internal__items.forEach(function(r){r._internal_color=t._internal__series.barColorer().barStyle(r.time).barColor})},e.prototype._internal__createRawItem=function(t,r,a){return F(F({},this._internal__createDefaultItem(t,r,a)),{_internal_color:a.barStyle(t).barColor})},e}(gr);function yt(i,e,t){return Math.min(Math.max(i,e),t)}function In(i){if(i<0)return!1;for(var e=i;e>1;e/=10)if(e%10!==0)return!1;return!0}function ot(i,e,t){return e-i<=t}function Bn(i,e,t){return Math.abs(i-e)<t}function yr(i){return i<=0?NaN:Math.log(i)/Math.log(10)}function Fn(i){if(i.length<1)throw Error("array is empty");for(var e=i[0],t=1;t<i.length;++t)i[t]<e&&(e=i[t]);return e}function Zt(i){var e=Math.ceil(i);return e%2!==0?e-1:e}function br(i){var e=Math.ceil(i);return e%2===0?e-1:e}var Wn=function(i){B(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype._internal__fillStyle=function(t){var r=this._internal__data,a=t.createLinearGradient(0,0,0,r._internal_bottom),n=yt(r._internal_baseLevelCoordinate/r._internal_bottom,0,1);return a.addColorStop(0,r._internal_topFillColor1),a.addColorStop(n,r._internal_topFillColor2),a.addColorStop(n,r._internal_bottomFillColor1),a.addColorStop(1,r._internal_bottomFillColor2),a},e}(ur),zn=function(i){B(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype._internal__strokeStyle=function(t){var r=this._internal__data,a=t.createLinearGradient(0,0,0,r._internal_bottom),n=yt(r._internal_baseLevelCoordinate/r._internal_bottom,0,1);return a.addColorStop(0,r._internal_topColor),a.addColorStop(n,r._internal_topColor),a.addColorStop(n,r._internal_bottomColor),a.addColorStop(1,r._internal_bottomColor),a},e}(dr),Nn=function(i){B(e,i);function e(t,r){var a=i.call(this,t,r)||this;return a._private__baselineAreaRenderer=new Wn,a._private__baselineLineRenderer=new zn,a._private__compositeRenderer=new wt,a._private__compositeRenderer._internal_setRenderers([a._private__baselineAreaRenderer,a._private__baselineLineRenderer]),a}return e.prototype.renderer=function(t,r){if(!this._internal__series.visible())return null;var a=this._internal__series.firstValue();if(a===null)return null;var n=this._internal__series.options();this._internal__makeValid();var _=this._internal__series.priceScale().priceToCoordinate(n.baseValue.price,a.value),o=this._internal__model.timeScale().barSpacing();return this._private__baselineAreaRenderer._internal_setData({_internal_items:this._internal__items,_internal_topFillColor1:n.topFillColor1,_internal_topFillColor2:n.topFillColor2,_internal_bottomFillColor1:n.bottomFillColor1,_internal_bottomFillColor2:n.bottomFillColor2,_internal_lineWidth:n.lineWidth,_internal_lineStyle:n.lineStyle,_internal_lineType:0,_internal_baseLevelCoordinate:_,_internal_bottom:t,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:o}),this._private__baselineLineRenderer._internal_setData({_internal_items:this._internal__items,_internal_topColor:n.topLineColor,_internal_bottomColor:n.bottomLineColor,_internal_lineWidth:n.lineWidth,_internal_lineStyle:n.lineStyle,_internal_lineType:0,_internal_baseLevelCoordinate:_,_internal_bottom:t,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:o}),this._private__compositeRenderer},e.prototype._internal__createRawItem=function(t,r){return this._internal__createRawItemBase(t,r)},e}(ai),Hn=function(){function i(){this._private__data=null,this._private__barWidth=0}return i.prototype._internal_setData=function(e){this._private__data=e},i.prototype.draw=function(e,t,r,a){if(!(this._private__data===null||this._private__data._internal_bars.length===0||this._private__data._internal_visibleRange===null)){if(this._private__barWidth=An(this._private__data._internal_barSpacing,t),this._private__barWidth>=2){var n=Math.floor(t);n%2!==this._private__barWidth%2&&this._private__barWidth--}var _=this._private__data._internal_bars;this._private__data._internal_wickVisible&&this._private__drawWicks(e,_,this._private__data._internal_visibleRange,t),this._private__data._internal_borderVisible&&this._private__drawBorder(e,_,this._private__data._internal_visibleRange,this._private__data._internal_barSpacing,t);var o=this._private__calculateBorderWidth(t);(!this._private__data._internal_borderVisible||this._private__barWidth>o*2)&&this._private__drawCandles(e,_,this._private__data._internal_visibleRange,t)}},i.prototype._private__drawWicks=function(e,t,r,a){if(this._private__data!==null){var n="",_=Math.min(Math.floor(a),Math.floor(this._private__data._internal_barSpacing*a));_=Math.max(Math.floor(a),Math.min(_,this._private__barWidth));for(var o=Math.floor(_*.5),l=null,v=r.from;v<r.to;v++){var c=t[v];c._internal_wickColor!==n&&(e.fillStyle=c._internal_wickColor,n=c._internal_wickColor);var u=Math.round(Math.min(c.openY,c.closeY)*a),d=Math.round(Math.max(c.openY,c.closeY)*a),m=Math.round(c.highY*a),g=Math.round(c.lowY*a),S=Math.round(a*c.x),y=S-o,b=y+_-1;l!==null&&(y=Math.max(l+1,y),y=Math.min(y,b));var x=b-y+1;e.fillRect(y,m,x,u-m),e.fillRect(y,d+1,x,g-d),l=b}}},i.prototype._private__calculateBorderWidth=function(e){var t=Math.floor(1*e);this._private__barWidth<=2*t&&(t=Math.floor((this._private__barWidth-1)*.5));var r=Math.max(Math.floor(e),t);return this._private__barWidth<=r*2?Math.max(Math.floor(e),Math.floor(1*e)):r},i.prototype._private__drawBorder=function(e,t,r,a,n){if(this._private__data!==null)for(var _="",o=this._private__calculateBorderWidth(n),l=null,v=r.from;v<r.to;v++){var c=t[v];c._internal_borderColor!==_&&(e.fillStyle=c._internal_borderColor,_=c._internal_borderColor);var u=Math.round(c.x*n)-Math.floor(this._private__barWidth*.5),d=u+this._private__barWidth-1,m=Math.round(Math.min(c.openY,c.closeY)*n),g=Math.round(Math.max(c.openY,c.closeY)*n);if(l!==null&&(u=Math.max(l+1,u),u=Math.min(u,d)),this._private__data._internal_barSpacing*n>2*o)bn(e,u,m,d-u+1,g-m+1,o);else{var S=d-u+1;e.fillRect(u,m,S,g-m+1)}l=d}},i.prototype._private__drawCandles=function(e,t,r,a){if(this._private__data!==null)for(var n="",_=this._private__calculateBorderWidth(a),o=r.from;o<r.to;o++){var l=t[o],v=Math.round(Math.min(l.openY,l.closeY)*a),c=Math.round(Math.max(l.openY,l.closeY)*a),u=Math.round(l.x*a)-Math.floor(this._private__barWidth*.5),d=u+this._private__barWidth-1;if(l._internal_color!==n){var m=l._internal_color;e.fillStyle=m,n=m}this._private__data._internal_borderVisible&&(u+=_,v+=_,d-=_,c-=_),!(v>c)&&e.fillRect(u,v,d-u+1,c-v+1)}},i}(),Un=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._private__renderer=new Hn,t}return e.prototype.renderer=function(t,r){if(!this._internal__series.visible())return null;var a=this._internal__series.options();this._internal__makeValid();var n={_internal_bars:this._internal__items,_internal_barSpacing:this._internal__model.timeScale().barSpacing(),_internal_wickVisible:a.wickVisible,_internal_borderVisible:a.borderVisible,_internal_visibleRange:this._internal__itemsVisibleRange};return this._private__renderer._internal_setData(n),this._private__renderer},e.prototype._internal__updateOptions=function(){var t=this;this._internal__items.forEach(function(r){var a=t._internal__series.barColorer().barStyle(r.time);r._internal_color=a.barColor,r._internal_wickColor=a.barWickColor,r._internal_borderColor=a.barBorderColor})},e.prototype._internal__createRawItem=function(t,r,a){var n=a.barStyle(t);return F(F({},this._internal__createDefaultItem(t,r,a)),{_internal_color:n.barColor,_internal_wickColor:n.barWickColor,_internal_borderColor:n.barBorderColor})},e}(gr),Yn=1,Xn=4,$n=function(){function i(){this._private__data=null,this._private__precalculatedCache=[]}return i.prototype._internal_setData=function(e){this._private__data=e,this._private__precalculatedCache=[]},i.prototype.draw=function(e,t,r,a){if(!(this._private__data===null||this._private__data._internal_items.length===0||this._private__data._internal_visibleRange===null)){this._private__precalculatedCache.length||this._private__fillPrecalculatedCache(t);for(var n=Math.max(1,Math.floor(t)),_=Math.round(this._private__data._internal_histogramBase*t),o=_-Math.floor(n/2),l=o+n,v=this._private__data._internal_visibleRange.from;v<this._private__data._internal_visibleRange.to;v++){var c=this._private__data._internal_items[v],u=this._private__precalculatedCache[v-this._private__data._internal_visibleRange.from],d=Math.round(c.y*t);e.fillStyle=c._internal_color;var m=void 0,g=void 0;d<=o?(m=d,g=l):(m=o,g=d-Math.floor(n/2)+n),e.fillRect(u._internal_left,m,u._internal_right-u._internal_left+1,g-m)}}},i.prototype._private__fillPrecalculatedCache=function(e){if(this._private__data===null||this._private__data._internal_items.length===0||this._private__data._internal_visibleRange===null){this._private__precalculatedCache=[];return}var t=Math.ceil(this._private__data._internal_barSpacing*e)<=Yn?0:Math.max(1,Math.floor(e)),r=Math.round(this._private__data._internal_barSpacing*e)-t;this._private__precalculatedCache=new Array(this._private__data._internal_visibleRange.to-this._private__data._internal_visibleRange.from);for(var a=this._private__data._internal_visibleRange.from;a<this._private__data._internal_visibleRange.to;a++){var n=this._private__data._internal_items[a],_=Math.round(n.x*e),o=void 0,l=void 0;if(r%2){var v=(r-1)/2;o=_-v,l=_+v}else{var v=r/2;o=_-v,l=_+v-1}this._private__precalculatedCache[a-this._private__data._internal_visibleRange.from]={_internal_left:o,_internal_right:l,_internal_roundedCenter:_,_internal_center:n.x*e,_internal_time:n.time}}for(var a=this._private__data._internal_visibleRange.from+1;a<this._private__data._internal_visibleRange.to;a++){var c=this._private__precalculatedCache[a-this._private__data._internal_visibleRange.from],u=this._private__precalculatedCache[a-this._private__data._internal_visibleRange.from-1];c._internal_time===u._internal_time+1&&c._internal_left-u._internal_right!==t+1&&(u._internal_roundedCenter>u._internal_center?u._internal_right=c._internal_left-t-1:c._internal_left=u._internal_right+t+1)}for(var d=Math.ceil(this._private__data._internal_barSpacing*e),a=this._private__data._internal_visibleRange.from;a<this._private__data._internal_visibleRange.to;a++){var c=this._private__precalculatedCache[a-this._private__data._internal_visibleRange.from];c._internal_right<c._internal_left&&(c._internal_right=c._internal_left);var m=c._internal_right-c._internal_left+1;d=Math.min(m,d)}if(t>0&&d<Xn)for(var a=this._private__data._internal_visibleRange.from;a<this._private__data._internal_visibleRange.to;a++){var c=this._private__precalculatedCache[a-this._private__data._internal_visibleRange.from],m=c._internal_right-c._internal_left+1;m>d&&(c._internal_roundedCenter>c._internal_center?c._internal_right-=1:c._internal_left+=1)}},i}();function Pi(i){return{_internal_items:[],_internal_barSpacing:i,_internal_histogramBase:NaN,_internal_visibleRange:null}}function qn(i,e,t){return{time:i,price:e,x:NaN,y:NaN,_internal_color:t}}var jn=function(i){B(e,i);function e(t,r){var a=i.call(this,t,r,!1)||this;return a._private__compositeRenderer=new wt,a._private__histogramData=Pi(0),a._private__renderer=new $n,a}return e.prototype.renderer=function(t,r){return this._internal__series.visible()?(this._internal__makeValid(),this._private__compositeRenderer):null},e.prototype._internal__fillRawPoints=function(){var t=this._internal__model.timeScale().barSpacing();this._private__histogramData=Pi(t);for(var r=0,a=0,n=this._internal__series.options().color,_=0,o=this._internal__series.bars().rows();_<o.length;_++){var l=o[_],v=l.value[3],c=l.color!==void 0?l.color:n,u=qn(l.index,v,c);r++,r<this._private__histogramData._internal_items.length?this._private__histogramData._internal_items[r]=u:this._private__histogramData._internal_items.push(u),this._internal__items[a++]={time:l.index,x:0}}this._private__renderer._internal_setData(this._private__histogramData),this._private__compositeRenderer._internal_setRenderers([this._private__renderer])},e.prototype._internal__updateOptions=function(){},e.prototype._internal__clearVisibleRange=function(){i.prototype._internal__clearVisibleRange.call(this),this._private__histogramData._internal_visibleRange=null},e.prototype._internal__convertToCoordinates=function(t,r,a){if(this._internal__itemsVisibleRange!==null){var n=r.barSpacing(),_=C(r.visibleStrictRange()),o=t.priceToCoordinate(this._internal__series.options().base,a);r.indexesToCoordinates(this._private__histogramData._internal_items),t.pointsArrayToCoordinates(this._private__histogramData._internal_items,a),this._private__histogramData._internal_histogramBase=o,this._private__histogramData._internal_visibleRange=ii(this._private__histogramData._internal_items,_,!1),this._private__histogramData._internal_barSpacing=n,this._private__renderer._internal_setData(this._private__histogramData)}},e}(ri),Gn=function(i){B(e,i);function e(t,r){var a=i.call(this,t,r)||this;return a._private__lineRenderer=new fr,a}return e.prototype.renderer=function(t,r){if(!this._internal__series.visible())return null;var a=this._internal__series.options();this._internal__makeValid();var n={_internal_items:this._internal__items,_internal_lineColor:a.color,_internal_lineStyle:a.lineStyle,_internal_lineType:a.lineType,_internal_lineWidth:a.lineWidth,_internal_visibleRange:this._internal__itemsVisibleRange,_internal_barWidth:this._internal__model.timeScale().barSpacing()};return this._private__lineRenderer._internal_setData(n),this._private__lineRenderer},e.prototype._internal__updateOptions=function(){var t=this;this._internal__items.forEach(function(r){r._internal_color=t._internal__series.barColorer().barStyle(r.time).barColor})},e.prototype._internal__createRawItem=function(t,r,a){var n=this._internal__createRawItemBase(t,r);return n._internal_color=a.barStyle(t).barColor,n},e}(ai),Zn=/[2-9]/g,We=function(){function i(e){e===void 0&&(e=50),this._private__cache=new Map,this._private__keysIndex=0,this._private__keys=Array.from(new Array(e))}return i.prototype.reset=function(){this._private__cache.clear(),this._private__keys.fill(void 0)},i.prototype.measureText=function(e,t,r){var a=r||Zn,n=String(t).replace(a,"0"),_=this._private__cache.get(n);if(_===void 0){if(_=e.measureText(n).width,_===0&&t.length!==0)return 0;var o=this._private__keys[this._private__keysIndex];o!==void 0&&this._private__cache.delete(o),this._private__keys[this._private__keysIndex]=n,this._private__keysIndex=(this._private__keysIndex+1)%this._private__keys.length,this._private__cache.set(n,_)}return _},i}(),Kn=function(){function i(e){this._private__priceAxisViewRenderer=null,this._private__rendererOptions=null,this._private__align="right",this._private__width=0,this._private__textWidthCache=e}return i.prototype._internal_setParams=function(e,t,r,a){this._private__priceAxisViewRenderer=e,this._private__rendererOptions=t,this._private__width=r,this._private__align=a},i.prototype.draw=function(e,t){this._private__rendererOptions===null||this._private__priceAxisViewRenderer===null||this._private__priceAxisViewRenderer.draw(e,this._private__rendererOptions,this._private__textWidthCache,this._private__width,this._private__align,t)},i}(),Sr=function(){function i(e,t,r){this._private__priceAxisView=e,this._private__textWidthCache=new We(50),this._private__dataSource=t,this._private__chartModel=r,this._private__fontSize=-1,this._private__renderer=new Kn(this._private__textWidthCache)}return i.prototype.renderer=function(e,t){var r=this._private__chartModel.paneForSource(this._private__dataSource);if(r===null)return null;var a=r.isOverlay(this._private__dataSource)?r.defaultVisiblePriceScale():this._private__dataSource.priceScale();if(a===null)return null;var n=r.priceScalePosition(a);if(n==="overlay")return null;var _=this._private__chartModel.priceAxisRendererOptions();return _.fontSize!==this._private__fontSize&&(this._private__fontSize=_.fontSize,this._private__textWidthCache.reset()),this._private__renderer._internal_setParams(this._private__priceAxisView.paneRenderer(),_,t,n),this._private__renderer},i}(),Jn=function(){function i(){this._private__data=null}return i.prototype._internal_setData=function(e){this._private__data=e},i.prototype.draw=function(e,t,r,a){if(this._private__data!==null&&this._private__data._internal_visible!==!1){var n=Math.round(this._private__data._internal_y*t);if(!(n<0||n>Math.ceil(this._private__data._internal_height*t))){var _=Math.ceil(this._private__data._internal_width*t);e.lineCap="butt",e.strokeStyle=this._private__data._internal_color,e.lineWidth=Math.floor(this._private__data._internal_lineWidth*t),xe(e,this._private__data._internal_lineStyle),or(e,n,0,_)}}},i}(),ni=function(){function i(e){this._internal__lineRendererData={_internal_width:0,_internal_height:0,_internal_y:0,_internal_color:"rgba(0, 0, 0, 0)",_internal_lineWidth:1,_internal_lineStyle:0,_internal_visible:!1},this._internal__lineRenderer=new Jn,this._private__invalidated=!0,this._internal__series=e,this._internal__model=e.model(),this._internal__lineRenderer._internal_setData(this._internal__lineRendererData)}return i.prototype._internal_update=function(){this._private__invalidated=!0},i.prototype.renderer=function(e,t){return this._internal__series.visible()?(this._private__invalidated&&(this._internal__updateImpl(e,t),this._private__invalidated=!1),this._internal__lineRenderer):null},i}(),Qn=function(i){B(e,i);function e(t){return i.call(this,t)||this}return e.prototype._internal__updateImpl=function(t,r){this._internal__lineRendererData._internal_visible=!1;var a=this._internal__series.priceScale(),n=a.mode().mode;if(!(n!==2&&n!==3)){var _=this._internal__series.options();if(!(!_.baseLineVisible||!this._internal__series.visible())){var o=this._internal__series.firstValue();o!==null&&(this._internal__lineRendererData._internal_visible=!0,this._internal__lineRendererData._internal_y=a.priceToCoordinate(o.value,o.value),this._internal__lineRendererData._internal_width=r,this._internal__lineRendererData._internal_height=t,this._internal__lineRendererData._internal_color=_.baseLineColor,this._internal__lineRendererData._internal_lineWidth=_.baseLineWidth,this._internal__lineRendererData._internal_lineStyle=_.baseLineStyle)}}},e}(ni),e_=function(){function i(){this._private__data=null}return i.prototype._internal_setData=function(e){this._private__data=e},i.prototype._internal_data=function(){return this._private__data},i.prototype.draw=function(e,t,r,a){var n=this._private__data;if(n!==null){e.save();var _=Math.max(1,Math.floor(t)),o=_%2/2,l=Math.round(n._internal_center.x*t)+o,v=n._internal_center.y*t;e.fillStyle=n._internal_seriesLineColor,e.beginPath();var c=Math.max(2,n._internal_seriesLineWidth*1.5)*t;e.arc(l,v,c,0,2*Math.PI,!1),e.fill(),e.fillStyle=n._internal_fillColor,e.beginPath(),e.arc(l,v,n._internal_radius*t,0,2*Math.PI,!1),e.fill(),e.lineWidth=_,e.strokeStyle=n._internal_strokeColor,e.beginPath(),e.arc(l,v,n._internal_radius*t+_/2,0,2*Math.PI,!1),e.stroke(),e.restore()}},i}(),t_=[{_internal_start:0,_internal_end:.25,_internal_startRadius:4,_internal_endRadius:10,_internal_startFillAlpha:.25,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.4,_internal_endStrokeAlpha:.8},{_internal_start:.25,_internal_end:.25+.275,_internal_startRadius:10,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:.8,_internal_endStrokeAlpha:0},{_internal_start:.25+.275,_internal_end:.25+.275+.475,_internal_startRadius:14,_internal_endRadius:14,_internal_startFillAlpha:0,_internal_endFillAlpha:0,_internal_startStrokeAlpha:0,_internal_endStrokeAlpha:0}];function Ti(i,e,t,r){var a=t+(r-t)*e;return ln(i,a)}function i_(i,e,t){return e+(t-e)*i}function Mi(i,e){for(var t=i%2600/2600,r,a=0,n=t_;a<n.length;a++){var _=n[a];if(t>=_._internal_start&&t<=_._internal_end){r=_;break}}re(r!==void 0,"Last price animation internal logic error");var o=(t-r._internal_start)/(r._internal_end-r._internal_start);return{_internal_fillColor:Ti(e,o,r._internal_startFillAlpha,r._internal_endFillAlpha),_internal_strokeColor:Ti(e,o,r._internal_startStrokeAlpha,r._internal_endStrokeAlpha),_internal_radius:i_(o,r._internal_startRadius,r._internal_endRadius)}}var r_=function(){function i(e){this._private__renderer=new e_,this._private__invalidated=!0,this._private__stageInvalidated=!0,this._private__startTime=performance.now(),this._private__endTime=this._private__startTime-1,this._private__series=e}return i.prototype._internal_onDataCleared=function(){this._private__endTime=this._private__startTime-1,this.update()},i.prototype._internal_onNewRealtimeDataReceived=function(){if(this.update(),this._private__series.options().lastPriceAnimation===2){var e=performance.now(),t=this._private__endTime-e;if(t>0){t<2600/4&&(this._private__endTime+=2600);return}this._private__startTime=e,this._private__endTime=e+2600}},i.prototype.update=function(){this._private__invalidated=!0},i.prototype._internal_invalidateStage=function(){this._private__stageInvalidated=!0},i.prototype._internal_visible=function(){return this._private__series.options().lastPriceAnimation!==0},i.prototype._internal_animationActive=function(){switch(this._private__series.options().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this._private__endTime}},i.prototype.renderer=function(e,t){return this._private__invalidated?(this._private__updateImpl(e,t),this._private__invalidated=!1,this._private__stageInvalidated=!1):this._private__stageInvalidated&&(this._private__updateRendererDataStage(),this._private__stageInvalidated=!1),this._private__renderer},i.prototype._private__updateImpl=function(e,t){this._private__renderer._internal_setData(null);var r=this._private__series.model().timeScale(),a=r.visibleStrictRange(),n=this._private__series.firstValue();if(!(a===null||n===null)){var _=this._private__series.lastValueData(!0);if(!(_.noData||!a.contains(_.index))){var o={x:r.indexToCoordinate(_.index),y:this._private__series.priceScale().priceToCoordinate(_.price,n.value)},l=_.color,v=this._private__series.options().lineWidth,c=Mi(this._private__duration(),l);this._private__renderer._internal_setData({_internal_seriesLineColor:l,_internal_seriesLineWidth:v,_internal_fillColor:c._internal_fillColor,_internal_strokeColor:c._internal_strokeColor,_internal_radius:c._internal_radius,_internal_center:o})}}},i.prototype._private__updateRendererDataStage=function(){var e=this._private__renderer._internal_data();if(e!==null){var t=Mi(this._private__duration(),e._internal_seriesLineColor);e._internal_fillColor=t._internal_fillColor,e._internal_strokeColor=t._internal_strokeColor,e._internal_radius=t._internal_radius}},i.prototype._private__duration=function(){return this._internal_animationActive()?performance.now()-this._private__startTime:2600-1},i}();function Xe(i,e){var t=Math.min(Math.max(i,12),30)*e;return br(t)}function Je(i,e){switch(i){case"arrowDown":case"arrowUp":return Xe(e,1);case"circle":return Xe(e,.8);case"square":return Xe(e,.7)}}function Cr(i){return Zt(Xe(i,1))}function ki(i){return Math.max(Xe(i,.1),3)}function a_(i,e,t,r){var a=Je("square",r),n=(a-1)/2,_=e-n,o=t-n;i.fillRect(_,o,a,a)}function wr(i,e,t,r,a){var n=Je("square",t),_=(n-1)/2,o=i-_,l=e-_;return r>=o&&r<=o+n&&a>=l&&a<=l+n}function xi(i,e,t,r,a){var n=Je("arrowUp",a),_=(n-1)/2,o=br(a/2),l=(o-1)/2;e.beginPath(),i?(e.moveTo(t-_,r),e.lineTo(t,r-_),e.lineTo(t+_,r),e.lineTo(t+l,r),e.lineTo(t+l,r+_),e.lineTo(t-l,r+_),e.lineTo(t-l,r)):(e.moveTo(t-_,r),e.lineTo(t,r+_),e.lineTo(t+_,r),e.lineTo(t+l,r),e.lineTo(t+l,r-_),e.lineTo(t-l,r-_),e.lineTo(t-l,r)),e.fill()}function Li(i,e,t,r,a,n){return wr(e,t,r,a,n)}function n_(i,e,t,r){var a=Je("circle",r),n=(a-1)/2;i.beginPath(),i.arc(e,t,n,0,2*Math.PI,!1),i.fill()}function __(i,e,t,r,a){var n=Je("circle",t),_=2+n/2,o=i-r,l=e-a,v=Math.sqrt(o*o+l*l);return v<=_}function s_(i,e,t,r){i.fillText(e,t,r)}function o_(i,e,t,r,a,n){var _=r/2;return a>=i&&a<=i+t&&n>=e-_&&n<=e+_}var l_=function(i){B(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t._private__data=null,t._private__textWidthCache=new We,t._private__fontSize=-1,t._private__fontFamily="",t._private__font="",t}return e.prototype._internal_setData=function(t){this._private__data=t},e.prototype._internal_setParams=function(t,r){(this._private__fontSize!==t||this._private__fontFamily!==r)&&(this._private__fontSize=t,this._private__fontFamily=r,this._private__font=Le(t,r),this._private__textWidthCache.reset())},e.prototype.hitTest=function(t,r){if(this._private__data===null||this._private__data._internal_visibleRange===null)return null;for(var a=this._private__data._internal_visibleRange.from;a<this._private__data._internal_visibleRange.to;a++){var n=this._private__data._internal_items[a];if(v_(n,t,r))return{hitTestData:n._internal_internalId,externalId:n._internal_externalId}}return null},e.prototype._internal__drawImpl=function(t,r,a){if(!(this._private__data===null||this._private__data._internal_visibleRange===null)){t.textBaseline="middle",t.font=this._private__font;for(var n=this._private__data._internal_visibleRange.from;n<this._private__data._internal_visibleRange.to;n++){var _=this._private__data._internal_items[n];_._internal_text!==void 0&&(_._internal_text._internal_width=this._private__textWidthCache.measureText(t,_._internal_text._internal_content),_._internal_text._internal_height=this._private__fontSize),p_(_,t)}}},e}(Ze);function p_(i,e){e.fillStyle=i._internal_color,i._internal_text!==void 0&&s_(e,i._internal_text._internal_content,i.x-i._internal_text._internal_width/2,i._internal_text._internal_y),c_(i,e)}function c_(i,e){if(i._internal_size!==0){switch(i._internal_shape){case"arrowDown":xi(!1,e,i.x,i._internal_y,i._internal_size);return;case"arrowUp":xi(!0,e,i.x,i._internal_y,i._internal_size);return;case"circle":n_(e,i.x,i._internal_y,i._internal_size);return;case"square":a_(e,i.x,i._internal_y,i._internal_size);return}i._internal_shape}}function v_(i,e,t){return i._internal_text!==void 0&&o_(i.x,i._internal_text._internal_y,i._internal_text._internal_width,i._internal_text._internal_height,e,t)?!0:h_(i,e,t)}function h_(i,e,t){if(i._internal_size===0)return!1;switch(i._internal_shape){case"arrowDown":return Li(!0,i.x,i._internal_y,i._internal_size,e,t);case"arrowUp":return Li(!1,i.x,i._internal_y,i._internal_size,e,t);case"circle":return __(i.x,i._internal_y,i._internal_size,e,t);case"square":return wr(i.x,i._internal_y,i._internal_size,e,t)}}function u_(i,e,t,r,a,n,_,o,l){var v=he(t)?t:t.close,c=he(t)?t:t.high,u=he(t)?t:t.low,d=he(e.size)?Math.max(e.size,0):1,m=Cr(o.barSpacing())*d,g=m/2;switch(i._internal_size=m,e.position){case"inBar":{i._internal_y=_.priceToCoordinate(v,l),i._internal_text!==void 0&&(i._internal_text._internal_y=i._internal_y+g+n+a*(.5+.1));return}case"aboveBar":{i._internal_y=_.priceToCoordinate(c,l)-g-r._internal_aboveBar,i._internal_text!==void 0&&(i._internal_text._internal_y=i._internal_y-g-a*(.5+.1),r._internal_aboveBar+=a*(1+2*.1)),r._internal_aboveBar+=m+n;return}case"belowBar":{i._internal_y=_.priceToCoordinate(u,l)+g+r._internal_belowBar,i._internal_text!==void 0&&(i._internal_text._internal_y=i._internal_y+g+n+a*(.5+.1),r._internal_belowBar+=a*(1+2*.1)),r._internal_belowBar+=m+n;return}}e.position}var d_=function(){function i(e,t){this._private__invalidated=!0,this._private__dataInvalidated=!0,this._private__autoScaleMarginsInvalidated=!0,this._private__autoScaleMargins=null,this._private__renderer=new l_,this._private__series=e,this._private__model=t,this._private__data={_internal_items:[],_internal_visibleRange:null}}return i.prototype.update=function(e){this._private__invalidated=!0,this._private__autoScaleMarginsInvalidated=!0,e==="data"&&(this._private__dataInvalidated=!0)},i.prototype.renderer=function(e,t,r){if(!this._private__series.visible())return null;this._private__invalidated&&this._internal__makeValid();var a=this._private__model.options().layout;return this._private__renderer._internal_setParams(a.fontSize,a.fontFamily),this._private__renderer._internal_setData(this._private__data),this._private__renderer},i.prototype._internal_autoScaleMargins=function(){if(this._private__autoScaleMarginsInvalidated){if(this._private__series.indexedMarkers().length>0){var e=this._private__model.timeScale().barSpacing(),t=ki(e),r=Cr(e)*1.5+t*2;this._private__autoScaleMargins={above:r,below:r}}else this._private__autoScaleMargins=null;this._private__autoScaleMarginsInvalidated=!1}return this._private__autoScaleMargins},i.prototype._internal__makeValid=function(){var e=this._private__series.priceScale(),t=this._private__model.timeScale(),r=this._private__series.indexedMarkers();this._private__dataInvalidated&&(this._private__data._internal_items=r.map(function(g){return{time:g.time,x:0,_internal_y:0,_internal_size:0,_internal_shape:g.shape,_internal_color:g.color,_internal_internalId:g.internalId,_internal_externalId:g.id,_internal_text:void 0}}),this._private__dataInvalidated=!1);var a=this._private__model.options().layout;this._private__data._internal_visibleRange=null;var n=t.visibleStrictRange();if(n!==null){var _=this._private__series.firstValue();if(_!==null&&this._private__data._internal_items.length!==0){var o=NaN,l=ki(t.barSpacing()),v={_internal_aboveBar:l,_internal_belowBar:l};this._private__data._internal_visibleRange=ii(this._private__data._internal_items,n,!0);for(var c=this._private__data._internal_visibleRange.from;c<this._private__data._internal_visibleRange.to;c++){var u=r[c];u.time!==o&&(v._internal_aboveBar=l,v._internal_belowBar=l,o=u.time);var d=this._private__data._internal_items[c];d.x=t.indexToCoordinate(u.time),u.text!==void 0&&u.text.length>0&&(d._internal_text={_internal_content:u.text,_internal_y:0,_internal_width:0,_internal_height:0});var m=this._private__series.dataAt(u.time);m!==null&&u_(d,u,m,v,a.fontSize,l,e,t,_.value)}this._private__invalidated=!1}}},i}(),f_=function(i){B(e,i);function e(t){return i.call(this,t)||this}return e.prototype._internal__updateImpl=function(t,r){var a=this._internal__lineRendererData;a._internal_visible=!1;var n=this._internal__series.options();if(!(!n.priceLineVisible||!this._internal__series.visible())){var _=this._internal__series.lastValueData(n.priceLineSource===0);_.noData||(a._internal_visible=!0,a._internal_y=_.coordinate,a._internal_color=this._internal__series.priceLineColor(_.color),a._internal_width=r,a._internal_height=t,a._internal_lineWidth=n.priceLineWidth,a._internal_lineStyle=n.priceLineStyle)}},e}(ni),m_=function(i){B(e,i);function e(t){var r=i.call(this)||this;return r._private__source=t,r}return e.prototype._internal__updateRendererData=function(t,r,a){t.visible=!1,r.visible=!1;var n=this._private__source;if(n.visible()){var _=n.options(),o=_.lastValueVisible,l=n.title()!=="",v=_.seriesLastValueMode===0,c=n.lastValueData(!1);if(!c.noData){o&&(t.text=this._internal__axisText(c,o,v),t.visible=t.text.length!==0),(l||v)&&(r.text=this._internal__paneText(c,o,l,v),r.visible=r.text.length>0);var u=n.priceLineColor(c.color),d=Ct(u);a.background=d._internal_background,a.color=d._internal_foreground,a.coordinate=c.coordinate,r.borderColor=n.model().backgroundColorAtYPercentFromTop(c.coordinate/n.priceScale().height()),t.borderColor=u}}},e.prototype._internal__paneText=function(t,r,a,n){var _="",o=this._private__source.title();return a&&o.length!==0&&(_+="".concat(o," ")),r&&n&&(_+=this._private__source.priceScale().isPercentage()?t.formattedPriceAbsolute:t.formattedPricePercentage),_.trim()},e.prototype._internal__axisText=function(t,r,a){return r?a?this._private__source.priceScale().isPercentage()?t.formattedPricePercentage:t.formattedPriceAbsolute:t.text:""},e}(ei),Se=function(){function i(e,t){this._private__minValue=e,this._private__maxValue=t}return i.prototype.equals=function(e){return e===null?!1:this._private__minValue===e._private__minValue&&this._private__maxValue===e._private__maxValue},i.prototype.clone=function(){return new i(this._private__minValue,this._private__maxValue)},i.prototype.minValue=function(){return this._private__minValue},i.prototype.maxValue=function(){return this._private__maxValue},i.prototype.length=function(){return this._private__maxValue-this._private__minValue},i.prototype.isEmpty=function(){return this._private__maxValue===this._private__minValue||Number.isNaN(this._private__maxValue)||Number.isNaN(this._private__minValue)},i.prototype.merge=function(e){return e===null?this:new i(Math.min(this.minValue(),e.minValue()),Math.max(this.maxValue(),e.maxValue()))},i.prototype.scaleAroundCenter=function(e){if(he(e)){var t=this._private__maxValue-this._private__minValue;if(t!==0){var r=(this._private__maxValue+this._private__minValue)*.5,a=this._private__maxValue-r,n=this._private__minValue-r;a*=e,n*=e,this._private__maxValue=r+a,this._private__minValue=r+n}}},i.prototype.shift=function(e){he(e)&&(this._private__maxValue+=e,this._private__minValue+=e)},i.prototype.toRaw=function(){return{minValue:this._private__minValue,maxValue:this._private__maxValue}},i.fromRaw=function(e){return e===null?null:new i(e.minValue,e.maxValue)},i}(),Ri=function(){function i(e,t){this._private__priceRange=e,this._private__margins=t||null}return i.prototype.priceRange=function(){return this._private__priceRange},i.prototype.margins=function(){return this._private__margins},i.prototype.toRaw=function(){return this._private__priceRange===null?null:{priceRange:this._private__priceRange.toRaw(),margins:this._private__margins||void 0}},i.fromRaw=function(e){return e===null?null:new i(Se.fromRaw(e.priceRange),e.margins)},i}(),g_=function(i){B(e,i);function e(t,r){var a=i.call(this,t)||this;return a._private__priceLine=r,a}return e.prototype._internal__updateImpl=function(t,r){var a=this._internal__lineRendererData;a._internal_visible=!1;var n=this._private__priceLine.options();if(!(!this._internal__series.visible()||!n.lineVisible)){var _=this._private__priceLine.yCoord();_!==null&&(a._internal_visible=!0,a._internal_y=_,a._internal_color=n.color,a._internal_width=r,a._internal_height=t,a._internal_lineWidth=n.lineWidth,a._internal_lineStyle=n.lineStyle)}},e}(ni),y_=function(i){B(e,i);function e(t,r){var a=i.call(this)||this;return a._private__series=t,a._private__priceLine=r,a}return e.prototype._internal__updateRendererData=function(t,r,a){t.visible=!1,r.visible=!1;var n=this._private__priceLine.options(),_=n.axisLabelVisible,o=n.title!=="",l=this._private__series;if(!(!_||!l.visible())){var v=this._private__priceLine.yCoord();if(v!==null){o&&(r.text=n.title,r.visible=!0),r.borderColor=l.model().backgroundColorAtYPercentFromTop(v/l.priceScale().height()),t.text=l.priceScale().formatPriceAbsolute(n.price),t.visible=!0;var c=Ct(n.color);a.background=c._internal_background,a.color=c._internal_foreground,a.coordinate=v}}},e}(ei),b_=function(){function i(e,t){this._private__series=e,this._private__options=t,this._private__priceLineView=new g_(e,this),this._private__priceAxisView=new y_(e,this),this._private__panePriceAxisView=new Sr(this._private__priceAxisView,e,e.model())}return i.prototype.applyOptions=function(e){$(this._private__options,e),this.update(),this._private__series.model().lightUpdate()},i.prototype.options=function(){return this._private__options},i.prototype.paneViews=function(){return[this._private__priceLineView,this._private__panePriceAxisView]},i.prototype.priceAxisView=function(){return this._private__priceAxisView},i.prototype.update=function(){this._private__priceLineView._internal_update(),this._private__priceAxisView.update()},i.prototype.yCoord=function(){var e=this._private__series,t=e.priceScale(),r=e.model().timeScale();if(r.isEmpty()||t.isEmpty())return null;var a=e.firstValue();return a===null?null:t.priceToCoordinate(this._private__options.price,a.value)},i}(),S_=function(i){B(e,i);function e(t){var r=i.call(this)||this;return r._private__model=t,r}return e.prototype.model=function(){return this._private__model},e}(ti),De={barColor:"",barBorderColor:"",barWickColor:""},C_=function(){function i(e){this._private__series=e}return i.prototype.barStyle=function(e,t){var r=this._private__series.seriesType(),a=this._private__series.options();switch(r){case"Line":return this._private__lineStyle(a,e,t);case"Area":return this._private__areaStyle(a);case"Baseline":return this._private__baselineStyle(a,e,t);case"Bar":return this._private__barStyle(a,e,t);case"Candlestick":return this._private__candleStyle(a,e,t);case"Histogram":return this._private__histogramStyle(a,e,t)}throw new Error("Unknown chart style")},i.prototype._private__barStyle=function(e,t,r){var a=F({},De),n=e.upColor,_=e.downColor,o=n,l=_,v=C(this._private__findBar(t,r)),c=Ye(v.value[0])<=Ye(v.value[3]);return v.color!==void 0?(a.barColor=v.color,a.barBorderColor=v.color):(a.barColor=c?n:_,a.barBorderColor=c?o:l),a},i.prototype._private__candleStyle=function(e,t,r){var a,n,_,o=F({},De),l=e.upColor,v=e.downColor,c=e.borderUpColor,u=e.borderDownColor,d=e.wickUpColor,m=e.wickDownColor,g=C(this._private__findBar(t,r)),S=Ye(g.value[0])<=Ye(g.value[3]);return o.barColor=(a=g.color)!==null&&a!==void 0?a:S?l:v,o.barBorderColor=(n=g.borderColor)!==null&&n!==void 0?n:S?c:u,o.barWickColor=(_=g.wickColor)!==null&&_!==void 0?_:S?d:m,o},i.prototype._private__areaStyle=function(e){return F(F({},De),{barColor:e.lineColor})},i.prototype._private__baselineStyle=function(e,t,r){var a=C(this._private__findBar(t,r)),n=a.value[3]>=e.baseValue.price;return F(F({},De),{barColor:n?e.topLineColor:e.bottomLineColor})},i.prototype._private__lineStyle=function(e,t,r){var a,n=C(this._private__findBar(t,r));return F(F({},De),{barColor:(a=n.color)!==null&&a!==void 0?a:e.color})},i.prototype._private__histogramStyle=function(e,t,r){var a=F({},De),n=C(this._private__findBar(t,r));return a.barColor=n.color!==void 0?n.color:e.color,a},i.prototype._private__findBar=function(e,t){return t!==void 0?t.value:this._private__series.bars().valueAt(e)},i}(),we=30,w_=function(){function i(){this._private__items=[],this._private__minMaxCache=new Map,this._private__rowSearchCache=new Map}return i.prototype.last=function(){return this.size()>0?this._private__items[this._private__items.length-1]:null},i.prototype.firstIndex=function(){return this.size()>0?this._private__indexAt(0):null},i.prototype.lastIndex=function(){return this.size()>0?this._private__indexAt(this._private__items.length-1):null},i.prototype.size=function(){return this._private__items.length},i.prototype.isEmpty=function(){return this.size()===0},i.prototype.contains=function(e){return this._private__search(e,0)!==null},i.prototype.valueAt=function(e){return this.search(e)},i.prototype.search=function(e,t){t===void 0&&(t=0);var r=this._private__search(e,t);return r===null?null:F(F({},this._private__valueAt(r)),{index:this._private__indexAt(r)})},i.prototype.rows=function(){return this._private__items},i.prototype.minMaxOnRangeCached=function(e,t,r){if(this.isEmpty())return null;for(var a=null,n=0,_=r;n<_.length;n++){var o=_[n],l=this._private__minMaxOnRangeCachedImpl(e,t,o);a=lt(a,l)}return a},i.prototype.setData=function(e){this._private__rowSearchCache.clear(),this._private__minMaxCache.clear(),this._private__items=e},i.prototype._private__indexAt=function(e){return this._private__items[e].index},i.prototype._private__valueAt=function(e){return this._private__items[e]},i.prototype._private__search=function(e,t){var r=this._private__bsearch(e);if(r===null&&t!==0)switch(t){case-1:return this._private__searchNearestLeft(e);case 1:return this._private__searchNearestRight(e);default:throw new TypeError("Unknown search mode")}return r},i.prototype._private__searchNearestLeft=function(e){var t=this._private__lowerbound(e);return t>0&&(t=t-1),t!==this._private__items.length&&this._private__indexAt(t)<e?t:null},i.prototype._private__searchNearestRight=function(e){var t=this._private__upperbound(e);return t!==this._private__items.length&&e<this._private__indexAt(t)?t:null},i.prototype._private__bsearch=function(e){var t=this._private__lowerbound(e);return t!==this._private__items.length&&!(e<this._private__items[t].index)?t:null},i.prototype._private__lowerbound=function(e){return Ke(this._private__items,e,function(t,r){return t.index<r})},i.prototype._private__upperbound=function(e){return mr(this._private__items,e,function(t,r){return r.index>t})},i.prototype._private__plotMinMax=function(e,t,r){for(var a=null,n=e;n<t;n++){var _=this._private__items[n].value,o=_[r];Number.isNaN(o)||(a===null?a={min:o,max:o}:(o<a.min&&(a.min=o),o>a.max&&(a.max=o)))}return a},i.prototype._private__minMaxOnRangeCachedImpl=function(e,t,r){if(this.isEmpty())return null;var a=null,n=C(this.firstIndex()),_=C(this.lastIndex()),o=Math.max(e,n),l=Math.min(t,_),v=Math.ceil(o/we)*we,c=Math.max(v,Math.floor(l/we)*we);{var u=this._private__lowerbound(o),d=this._private__upperbound(Math.min(l,v,t)),m=this._private__plotMinMax(u,d,r);a=lt(a,m)}var g=this._private__minMaxCache.get(r);g===void 0&&(g=new Map,this._private__minMaxCache.set(r,g));for(var S=Math.max(v+1,o);S<c;S+=we){var y=Math.floor(S/we),b=g.get(y);if(b===void 0){var x=this._private__lowerbound(y*we),D=this._private__upperbound((y+1)*we-1);b=this._private__plotMinMax(x,D,r),g.set(y,b)}a=lt(a,b)}{var u=this._private__lowerbound(c),d=this._private__upperbound(l),m=this._private__plotMinMax(u,d,r);a=lt(a,m)}return a},i}();function lt(i,e){if(i===null)return e;if(e===null)return i;var t=Math.min(i.min,e.min),r=Math.max(i.max,e.max);return{min:t,max:r}}function P_(){return new w_}var kt=function(i){B(e,i);function e(t,r,a){var n=i.call(this,t)||this;n._private__data=P_(),n._private__priceLineView=new f_(n),n._private__customPriceLines=[],n._private__baseHorizontalLineView=new Qn(n),n._private__lastPriceAnimationPaneView=null,n._private__barColorerCache=null,n._private__markers=[],n._private__indexedMarkers=[],n._private__animationTimeoutId=null,n._private__options=r,n._private__seriesType=a;var _=new m_(n);return n._private__priceAxisViews=[_],n._private__panePriceAxisView=new Sr(_,n,t),(a==="Area"||a==="Line"||a==="Baseline")&&(n._private__lastPriceAnimationPaneView=new r_(n)),n._private__recreateFormatter(),n._private__recreatePaneViews(),n}return e.prototype.destroy=function(){this._private__animationTimeoutId!==null&&clearTimeout(this._private__animationTimeoutId)},e.prototype.priceLineColor=function(t){return this._private__options.priceLineColor||t},e.prototype.lastValueData=function(t){var r={noData:!0},a=this.priceScale();if(this.model().timeScale().isEmpty()||a.isEmpty()||this._private__data.isEmpty())return r;var n=this.model().timeScale().visibleStrictRange(),_=this.firstValue();if(n===null||_===null)return r;var o,l;if(t){var v=this._private__data.last();if(v===null)return r;o=v,l=v.index}else{var c=this._private__data.search(n.right(),-1);if(c===null||(o=this._private__data.valueAt(c.index),o===null))return r;l=c.index}var u=o.value[3],d=this.barColorer(),m=d.barStyle(l,{value:o}),g=a.priceToCoordinate(u,_.value);return{noData:!1,price:u,text:a.formatPrice(u,_.value),formattedPriceAbsolute:a.formatPriceAbsolute(u),formattedPricePercentage:a.formatPricePercentage(u,_.value),color:m.barColor,coordinate:g,index:l}},e.prototype.barColorer=function(){return this._private__barColorerCache!==null?this._private__barColorerCache:(this._private__barColorerCache=new C_(this),this._private__barColorerCache)},e.prototype.options=function(){return this._private__options},e.prototype.applyOptions=function(t){var r=t.priceScaleId;r!==void 0&&r!==this._private__options.priceScaleId&&this.model().moveSeriesToScale(this,r),$(this._private__options,t),this._priceScale!==null&&t.scaleMargins!==void 0&&this._priceScale.applyOptions({scaleMargins:t.scaleMargins}),t.priceFormat!==void 0&&(this._private__recreateFormatter(),this.model().fullUpdate()),this.model().updateSource(this),this.model().updateCrosshair(),this._private__paneView.update("options")},e.prototype.setData=function(t,r){this._private__data.setData(t),this._private__recalculateMarkers(),this._private__paneView.update("data"),this._private__markersPaneView.update("data"),this._private__lastPriceAnimationPaneView!==null&&(r&&r.lastBarUpdatedOrNewBarsAddedToTheRight?this._private__lastPriceAnimationPaneView._internal_onNewRealtimeDataReceived():t.length===0&&this._private__lastPriceAnimationPaneView._internal_onDataCleared());var a=this.model().paneForSource(this);this.model().recalculatePane(a),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.setMarkers=function(t){this._private__markers=t.map(function(a){return F({},a)}),this._private__recalculateMarkers();var r=this.model().paneForSource(this);this._private__markersPaneView.update("data"),this.model().recalculatePane(r),this.model().updateSource(this),this.model().updateCrosshair(),this.model().lightUpdate()},e.prototype.indexedMarkers=function(){return this._private__indexedMarkers},e.prototype.createPriceLine=function(t){var r=new b_(this,t);return this._private__customPriceLines.push(r),this.model().updateSource(this),r},e.prototype.removePriceLine=function(t){var r=this._private__customPriceLines.indexOf(t);r!==-1&&this._private__customPriceLines.splice(r,1),this.model().updateSource(this)},e.prototype.customPriceLines=function(){return this._private__customPriceLines},e.prototype.seriesType=function(){return this._private__seriesType},e.prototype.firstValue=function(){var t=this.firstBar();return t===null?null:{value:t.value[3],timePoint:t.time}},e.prototype.firstBar=function(){var t=this.model().timeScale().visibleStrictRange();if(t===null)return null;var r=t.left();return this._private__data.search(r,1)},e.prototype.bars=function(){return this._private__data},e.prototype.dataAt=function(t){var r=this._private__data.valueAt(t);return r===null?null:this._private__seriesType==="Bar"||this._private__seriesType==="Candlestick"?{open:r.value[0],high:r.value[1],low:r.value[2],close:r.value[3]}:r.value[3]},e.prototype.topPaneViews=function(t){var r=this,a=this._private__lastPriceAnimationPaneView;return a===null||!a._internal_visible()?[]:(this._private__animationTimeoutId===null&&a._internal_animationActive()&&(this._private__animationTimeoutId=setTimeout(function(){r._private__animationTimeoutId=null,r.model().cursorUpdate()},0)),a._internal_invalidateStage(),[a])},e.prototype.paneViews=function(){var t=[];this._private__isOverlay()||t.push(this._private__baseHorizontalLineView);for(var r=0,a=this._private__customPriceLines;r<a.length;r++){var n=a[r];t.push.apply(t,n.paneViews())}return t.push(this._private__paneView,this._private__priceLineView,this._private__panePriceAxisView,this._private__markersPaneView),t},e.prototype.priceAxisViews=function(t,r){if(r!==this._priceScale&&!this._private__isOverlay())return[];for(var a=pr([],this._private__priceAxisViews,!0),n=0,_=this._private__customPriceLines;n<_.length;n++){var o=_[n];a.push(o.priceAxisView())}return a},e.prototype.autoscaleInfo=function(t,r){var a=this;if(this._private__options.autoscaleInfoProvider!==void 0){var n=this._private__options.autoscaleInfoProvider(function(){var _=a._private__autoscaleInfoImpl(t,r);return _===null?null:_.toRaw()});return Ri.fromRaw(n)}return this._private__autoscaleInfoImpl(t,r)},e.prototype.minMove=function(){return this._private__options.priceFormat.minMove},e.prototype.formatter=function(){return this._private__formatter},e.prototype.updateAllViews=function(){var t;this._private__paneView.update(),this._private__markersPaneView.update();for(var r=0,a=this._private__priceAxisViews;r<a.length;r++){var n=a[r];n.update()}for(var _=0,o=this._private__customPriceLines;_<o.length;_++){var l=o[_];l.update()}this._private__priceLineView._internal_update(),this._private__baseHorizontalLineView._internal_update(),(t=this._private__lastPriceAnimationPaneView)===null||t===void 0||t.update()},e.prototype.priceScale=function(){return C(i.prototype.priceScale.call(this))},e.prototype.markerDataAtIndex=function(t){var r=(this._private__seriesType==="Line"||this._private__seriesType==="Area"||this._private__seriesType==="Baseline")&&this._private__options.crosshairMarkerVisible;if(!r)return null;var a=this._private__data.valueAt(t);if(a===null)return null;var n=a.value[3],_=this._private__markerRadius(),o=this._private__markerBorderColor(),l=this._private__markerBackgroundColor(t);return{price:n,radius:_,borderColor:o,backgroundColor:l}},e.prototype.title=function(){return this._private__options.title},e.prototype.visible=function(){return this._private__options.visible},e.prototype._private__isOverlay=function(){var t=this.priceScale();return!Tt(t.id())},e.prototype._private__autoscaleInfoImpl=function(t,r){if(!je(t)||!je(r)||this._private__data.isEmpty())return null;var a=this._private__seriesType==="Line"||this._private__seriesType==="Area"||this._private__seriesType==="Baseline"||this._private__seriesType==="Histogram"?[3]:[2,1],n=this._private__data.minMaxOnRangeCached(t,r,a),_=n!==null?new Se(n.min,n.max):null;if(this.seriesType()==="Histogram"){var o=this._private__options.base,l=new Se(o,o);_=_!==null?_.merge(l):l}return new Ri(_,this._private__markersPaneView._internal_autoScaleMargins())},e.prototype._private__markerRadius=function(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":return this._private__options.crosshairMarkerRadius}return 0},e.prototype._private__markerBorderColor=function(){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{var t=this._private__options.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null},e.prototype._private__markerBackgroundColor=function(t){switch(this._private__seriesType){case"Line":case"Area":case"Baseline":{var r=this._private__options.crosshairMarkerBackgroundColor;if(r.length!==0)return r}}return this.barColorer().barStyle(t).barColor},e.prototype._private__recreateFormatter=function(){switch(this._private__options.priceFormat.type){case"custom":{this._private__formatter={format:this._private__options.priceFormat.formatter};break}case"volume":{this._private__formatter=new kn(this._private__options.priceFormat.precision);break}case"percent":{this._private__formatter=new vr(this._private__options.priceFormat.precision);break}default:{var t=Math.pow(10,this._private__options.priceFormat.precision);this._private__formatter=new Mt(t,this._private__options.priceFormat.minMove*t)}}this._priceScale!==null&&this._priceScale.updateFormatter()},e.prototype._private__recalculateMarkers=function(){var t=this,r=this.model().timeScale();if(r.isEmpty()||this._private__data.size()===0){this._private__indexedMarkers=[];return}var a=C(this._private__data.firstIndex());this._private__indexedMarkers=this._private__markers.map(function(n,_){var o=C(r.timeToIndex(n.time,!0)),l=o<a?1:-1,v=C(t._private__data.search(o,l)).index;return{time:v,position:n.position,shape:n.shape,color:n.color,id:n.id,internalId:_,text:n.text,size:n.size}})},e.prototype._private__recreatePaneViews=function(){switch(this._private__markersPaneView=new d_(this,this.model()),this._private__seriesType){case"Bar":{this._private__paneView=new Vn(this,this.model());break}case"Candlestick":{this._private__paneView=new Un(this,this.model());break}case"Line":{this._private__paneView=new Gn(this,this.model());break}case"Area":{this._private__paneView=new Dn(this,this.model());break}case"Baseline":{this._private__paneView=new Nn(this,this.model());break}case"Histogram":{this._private__paneView=new jn(this,this.model());break}default:throw Error("Unknown chart style assigned: "+this._private__seriesType)}},e}(S_),T_=function(){function i(e){this._private__options=e}return i.prototype._internal_align=function(e,t,r){var a=e;if(this._private__options.mode===0)return a;var n=r.defaultPriceScale(),_=n.firstValue();if(_===null)return a;var o=n.priceToCoordinate(e,_),l=r.dataSources().filter(function(u){return u instanceof kt}),v=l.reduce(function(u,d){if(r.isOverlay(d)||!d.visible())return u;var m=d.priceScale(),g=d.bars();if(m.isEmpty()||!g.contains(t))return u;var S=g.valueAt(t);if(S===null)return u;var y=Ye(d.firstValue());return u.concat([m.priceToCoordinate(S.value[3],y.value)])},[]);if(v.length===0)return a;v.sort(function(u,d){return Math.abs(u-o)-Math.abs(d-o)});var c=v[0];return a=n.coordinateToPrice(c,_),a},i}(),M_=function(){function i(){this._private__data=null}return i.prototype._internal_setData=function(e){this._private__data=e},i.prototype.draw=function(e,t,r,a){var n=this;if(this._private__data!==null){var _=Math.max(1,Math.floor(t));e.lineWidth=_;var o=Math.ceil(this._private__data._internal_h*t),l=Math.ceil(this._private__data._internal_w*t);rn(e,function(){var v=C(n._private__data);if(v._internal_vertLinesVisible){e.strokeStyle=v._internal_vertLinesColor,xe(e,v._internal_vertLineStyle),e.beginPath();for(var c=0,u=v._internal_timeMarks;c<u.length;c++){var d=u[c],m=Math.round(d._internal_coord*t);e.moveTo(m,-_),e.lineTo(m,o+_)}e.stroke()}if(v._internal_horzLinesVisible){e.strokeStyle=v._internal_horzLinesColor,xe(e,v._internal_horzLineStyle),e.beginPath();for(var g=0,S=v._internal_priceMarks;g<S.length;g++){var y=S[g],b=Math.round(y.coord*t);e.moveTo(-_,b),e.lineTo(l+_,b)}e.stroke()}})}},i}(),k_=function(){function i(e){this._private__renderer=new M_,this._private__invalidated=!0,this._private__pane=e}return i.prototype.update=function(){this._private__invalidated=!0},i.prototype.renderer=function(e,t){if(this._private__invalidated){var r=this._private__pane.model().options().grid,a={_internal_h:e,_internal_w:t,_internal_horzLinesVisible:r.horzLines.visible,_internal_vertLinesVisible:r.vertLines.visible,_internal_horzLinesColor:r.horzLines.color,_internal_vertLinesColor:r.vertLines.color,_internal_horzLineStyle:r.horzLines.style,_internal_vertLineStyle:r.vertLines.style,_internal_priceMarks:this._private__pane.defaultPriceScale().marks(),_internal_timeMarks:this._private__pane.model().timeScale().marks()||[]};this._private__renderer._internal_setData(a),this._private__invalidated=!1}return this._private__renderer},i}(),x_=function(){function i(e){this._private__paneView=new k_(e)}return i.prototype.paneView=function(){return this._private__paneView},i}(),Ft={_internal_logicalOffset:4,_internal_coordOffset:1e-4};function L_(i,e){return e<0&&(i=-i),i/100*e+e}function Be(i,e){var t=100*(i-e)/e;return e<0?-t:t}function R_(i,e){var t=Be(i.minValue(),e),r=Be(i.maxValue(),e);return new Se(t,r)}function D_(i,e){return i-=100,e<0&&(i=-i),i/100*e+e}function $e(i,e){var t=100*(i-e)/e+100;return e<0?-t:t}function O_(i,e){var t=$e(i.minValue(),e),r=$e(i.maxValue(),e);return new Se(t,r)}function bt(i,e){var t=Math.abs(i);if(t<1e-15)return 0;var r=yr(t+e._internal_coordOffset)+e._internal_logicalOffset;return i<0?-r:r}function Ge(i,e){var t=Math.abs(i);if(t<1e-15)return 0;var r=Math.pow(10,t-e._internal_logicalOffset)-e._internal_coordOffset;return i<0?-r:r}function Ue(i,e){if(i===null)return null;var t=bt(i.minValue(),e),r=bt(i.maxValue(),e);return new Se(t,r)}function A_(i,e){if(i===null)return!1;var t=Ge(i.minValue(),e),r=Ge(i.maxValue(),e);return isFinite(t)&&isFinite(r)}function pt(i,e){if(i===null)return null;var t=Ge(i.minValue(),e),r=Ge(i.maxValue(),e);return new Se(t,r)}function Wt(i){if(i===null)return Ft;var e=Math.abs(i.maxValue()-i.minValue());if(e>=1||e<1e-15)return Ft;var t=Math.ceil(Math.abs(Math.log10(e))),r=Ft._internal_logicalOffset+t,a=1/Math.pow(10,r);return{_internal_logicalOffset:r,_internal_coordOffset:a}}function E_(i,e){return i._internal_logicalOffset===e._internal_logicalOffset&&i._internal_coordOffset===e._internal_coordOffset}var zt=function(){function i(e,t){if(this._private__base=e,this._private__integralDividers=t,In(this._private__base))this._private__fractionalDividers=[2,2.5,2];else{this._private__fractionalDividers=[];for(var r=this._private__base;r!==1;){if(r%2===0)this._private__fractionalDividers.push(2),r/=2;else if(r%5===0)this._private__fractionalDividers.push(2,2.5),r/=5;else throw new Error("unexpected base");if(this._private__fractionalDividers.length>100)throw new Error("something wrong with base")}}}return i.prototype._internal_tickSpan=function(e,t,r){for(var a=this._private__base===0?0:1/this._private__base,n=Math.pow(10,Math.max(0,Math.ceil(yr(e-t)))),_=0,o=this._private__integralDividers[0];;){var l=ot(n,a,1e-14)&&n>a+1e-14,v=ot(n,r*o,1e-14),c=ot(n,1,1e-14),u=l&&v&&c;if(!u)break;n/=o,o=this._private__integralDividers[++_%this._private__integralDividers.length]}if(n<=a+1e-14&&(n=a),n=Math.max(1,n),this._private__fractionalDividers.length>0&&Bn(n,1,1e-14))for(_=0,o=this._private__fractionalDividers[0];ot(n,r*o,1e-14)&&n>a+1e-14;)n/=o,o=this._private__fractionalDividers[++_%this._private__fractionalDividers.length];return n},i}(),V_=2.5,Di=function(){function i(e,t,r,a){this._private__marks=[],this._private__priceScale=e,this._private__base=t,this._private__coordinateToLogicalFunc=r,this._private__logicalToCoordinateFunc=a}return i.prototype._internal_tickSpan=function(e,t){if(e<t)throw new Error("high < low");var r=this._private__priceScale.height(),a=this._private__tickMarkHeight(),n=(e-t)*a/r,_=new zt(this._private__base,[2,2.5,2]),o=new zt(this._private__base,[2,2,2.5]),l=new zt(this._private__base,[2.5,2,2]),v=[];return v.push(_._internal_tickSpan(e,t,n),o._internal_tickSpan(e,t,n),l._internal_tickSpan(e,t,n)),Fn(v)},i.prototype._internal_rebuildTickMarks=function(){var e=this._private__priceScale,t=e.firstValue();if(t===null){this._private__marks=[];return}var r=e.height(),a=this._private__coordinateToLogicalFunc(r-1,t),n=this._private__coordinateToLogicalFunc(0,t),_=this._private__priceScale.options().entireTextOnly?this._private__fontHeight()/2:0,o=_,l=r-1-_,v=Math.max(a,n),c=Math.min(a,n);if(v===c){this._private__marks=[];return}var u=this._internal_tickSpan(v,c),d=v%u;d+=d<0?u:0;for(var m=v>=c?1:-1,g=null,S=0,y=v-d;y>c;y-=u){var b=this._private__logicalToCoordinateFunc(y,t,!0);g!==null&&Math.abs(b-g)<this._private__tickMarkHeight()||b<o||b>l||(S<this._private__marks.length?(this._private__marks[S].coord=b,this._private__marks[S].label=e.formatLogical(y)):this._private__marks.push({coord:b,label:e.formatLogical(y)}),S++,g=b,e.isLog()&&(u=this._internal_tickSpan(y*m,c)))}this._private__marks.length=S},i.prototype._internal_marks=function(){return this._private__marks},i.prototype._private__fontHeight=function(){return this._private__priceScale.fontSize()},i.prototype._private__tickMarkHeight=function(){return Math.ceil(this._private__fontHeight()*V_)},i}();function Pr(i){return i.slice().sort(function(e,t){return C(e.zorder())-C(t.zorder())})}var Oi;(function(i){i[i.Normal=0]="Normal",i[i.Logarithmic=1]="Logarithmic",i[i.Percentage=2]="Percentage",i[i.IndexedTo100=3]="IndexedTo100"})(Oi||(Oi={}));var Ai=new vr,Ei=new Mt(100,1),I_=function(){function i(e,t,r,a){this._private__height=0,this._private__internalHeightCache=null,this._private__priceRange=null,this._private__priceRangeSnapshot=null,this._private__invalidatedForRange={_internal_isValid:!1,_internal_visibleBars:null},this._private__marginAbove=0,this._private__marginBelow=0,this._private__onMarksChanged=new U,this._private__modeChanged=new U,this._private__dataSources=[],this._private__cachedOrderedSources=null,this._private__marksCache=null,this._private__scaleStartPoint=null,this._private__scrollStartPoint=null,this._private__formatter=Ei,this._private__logFormula=Wt(null),this._private__id=e,this._private__options=t,this._private__layoutOptions=r,this._private__localizationOptions=a,this._private__markBuilder=new Di(this,100,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this))}return i.prototype.id=function(){return this._private__id},i.prototype.options=function(){return this._private__options},i.prototype.applyOptions=function(e){if($(this._private__options,e),this.updateFormatter(),e.mode!==void 0&&this.setMode({mode:e.mode}),e.scaleMargins!==void 0){var t=se(e.scaleMargins.top),r=se(e.scaleMargins.bottom);if(t<0||t>1)throw new Error("Invalid top margin - expect value between 0 and 1, given=".concat(t));if(r<0||r>1||t+r>1)throw new Error("Invalid bottom margin - expect value between 0 and 1, given=".concat(r));if(t+r>1)throw new Error("Invalid margins - sum of margins must be less than 1, given=".concat(t+r));this._private__invalidateInternalHeightCache(),this._private__marksCache=null}},i.prototype.isAutoScale=function(){return this._private__options.autoScale},i.prototype.isLog=function(){return this._private__options.mode===1},i.prototype.isPercentage=function(){return this._private__options.mode===2},i.prototype.isIndexedTo100=function(){return this._private__options.mode===3},i.prototype.mode=function(){return{autoScale:this._private__options.autoScale,isInverted:this._private__options.invertScale,mode:this._private__options.mode}},i.prototype.setMode=function(e){var t=this.mode(),r=null;e.autoScale!==void 0&&(this._private__options.autoScale=e.autoScale),e.mode!==void 0&&(this._private__options.mode=e.mode,(e.mode===2||e.mode===3)&&(this._private__options.autoScale=!0),this._private__invalidatedForRange._internal_isValid=!1),t.mode===1&&e.mode!==t.mode&&(A_(this._private__priceRange,this._private__logFormula)?(r=pt(this._private__priceRange,this._private__logFormula),r!==null&&this.setPriceRange(r)):this._private__options.autoScale=!0),e.mode===1&&e.mode!==t.mode&&(r=Ue(this._private__priceRange,this._private__logFormula),r!==null&&this.setPriceRange(r));var a=t.mode!==this._private__options.mode;a&&(t.mode===2||this.isPercentage())&&this.updateFormatter(),a&&(t.mode===3||this.isIndexedTo100())&&this.updateFormatter(),e.isInverted!==void 0&&t.isInverted!==e.isInverted&&(this._private__options.invertScale=e.isInverted,this._private__onIsInvertedChanged()),this._private__modeChanged._internal_fire(t,this.mode())},i.prototype.modeChanged=function(){return this._private__modeChanged},i.prototype.fontSize=function(){return this._private__layoutOptions.fontSize},i.prototype.height=function(){return this._private__height},i.prototype.setHeight=function(e){this._private__height!==e&&(this._private__height=e,this._private__invalidateInternalHeightCache(),this._private__marksCache=null)},i.prototype.internalHeight=function(){if(this._private__internalHeightCache)return this._private__internalHeightCache;var e=this.height()-this._private__topMarginPx()-this._private__bottomMarginPx();return this._private__internalHeightCache=e,e},i.prototype.priceRange=function(){return this._private__makeSureItIsValid(),this._private__priceRange},i.prototype.setPriceRange=function(e,t){var r=this._private__priceRange;!t&&!(r===null&&e!==null)&&(r===null||r.equals(e))||(this._private__marksCache=null,this._private__priceRange=e)},i.prototype.isEmpty=function(){return this._private__makeSureItIsValid(),this._private__height===0||!this._private__priceRange||this._private__priceRange.isEmpty()},i.prototype.invertedCoordinate=function(e){return this.isInverted()?e:this.height()-1-e},i.prototype.priceToCoordinate=function(e,t){return this.isPercentage()?e=Be(e,t):this.isIndexedTo100()&&(e=$e(e,t)),this._private__logicalToCoordinate(e,t)},i.prototype.pointsArrayToCoordinates=function(e,t,r){this._private__makeSureItIsValid();for(var a=this._private__bottomMarginPx(),n=C(this.priceRange()),_=n.minValue(),o=n.maxValue(),l=this.internalHeight()-1,v=this.isInverted(),c=l/(o-_),u=r===void 0?0:r.from,d=r===void 0?e.length:r.to,m=this._private__getCoordinateTransformer(),g=u;g<d;g++){var S=e[g],y=S.price;if(!isNaN(y)){var b=y;m!==null&&(b=m(S.price,t));var x=a+c*(b-_),D=v?x:this._private__height-1-x;S.y=D}}},i.prototype.barPricesToCoordinates=function(e,t,r){this._private__makeSureItIsValid();for(var a=this._private__bottomMarginPx(),n=C(this.priceRange()),_=n.minValue(),o=n.maxValue(),l=this.internalHeight()-1,v=this.isInverted(),c=l/(o-_),u=r===void 0?0:r.from,d=r===void 0?e.length:r.to,m=this._private__getCoordinateTransformer(),g=u;g<d;g++){var S=e[g],y=S.open,b=S.high,x=S.low,D=S.close;m!==null&&(y=m(S.open,t),b=m(S.high,t),x=m(S.low,t),D=m(S.close,t));var V=a+c*(y-_),E=v?V:this._private__height-1-V;S.openY=E,V=a+c*(b-_),E=v?V:this._private__height-1-V,S.highY=E,V=a+c*(x-_),E=v?V:this._private__height-1-V,S.lowY=E,V=a+c*(D-_),E=v?V:this._private__height-1-V,S.closeY=E}},i.prototype.coordinateToPrice=function(e,t){var r=this._private__coordinateToLogical(e,t);return this.logicalToPrice(r,t)},i.prototype.logicalToPrice=function(e,t){var r=e;return this.isPercentage()?r=L_(r,t):this.isIndexedTo100()&&(r=D_(r,t)),r},i.prototype.dataSources=function(){return this._private__dataSources},i.prototype.orderedSources=function(){if(this._private__cachedOrderedSources)return this._private__cachedOrderedSources;for(var e=[],t=0;t<this._private__dataSources.length;t++){var r=this._private__dataSources[t];r.zorder()===null&&r.setZorder(t+1),e.push(r)}return e=Pr(e),this._private__cachedOrderedSources=e,this._private__cachedOrderedSources},i.prototype.addDataSource=function(e){this._private__dataSources.indexOf(e)===-1&&(this._private__dataSources.push(e),this.updateFormatter(),this.invalidateSourcesCache())},i.prototype.removeDataSource=function(e){var t=this._private__dataSources.indexOf(e);if(t===-1)throw new Error("source is not attached to scale");this._private__dataSources.splice(t,1),this._private__dataSources.length===0&&(this.setMode({autoScale:!0}),this.setPriceRange(null)),this.updateFormatter(),this.invalidateSourcesCache()},i.prototype.firstValue=function(){for(var e=null,t=0,r=this._private__dataSources;t<r.length;t++){var a=r[t],n=a.firstValue();n!==null&&(e===null||n.timePoint<e.timePoint)&&(e=n)}return e===null?null:e.value},i.prototype.isInverted=function(){return this._private__options.invertScale},i.prototype.marks=function(){var e=this.firstValue()===null;if(this._private__marksCache!==null&&(e||this._private__marksCache._internal_firstValueIsNull===e))return this._private__marksCache._internal_marks;this._private__markBuilder._internal_rebuildTickMarks();var t=this._private__markBuilder._internal_marks();return this._private__marksCache={_internal_marks:t,_internal_firstValueIsNull:e},this._private__onMarksChanged._internal_fire(),t},i.prototype.onMarksChanged=function(){return this._private__onMarksChanged},i.prototype.startScale=function(e){this.isPercentage()||this.isIndexedTo100()||this._private__scaleStartPoint!==null||this._private__priceRangeSnapshot!==null||this.isEmpty()||(this._private__scaleStartPoint=this._private__height-e,this._private__priceRangeSnapshot=C(this.priceRange()).clone())},i.prototype.scaleTo=function(e){if(!(this.isPercentage()||this.isIndexedTo100())&&this._private__scaleStartPoint!==null){this.setMode({autoScale:!1}),e=this._private__height-e,e<0&&(e=0);var t=(this._private__scaleStartPoint+(this._private__height-1)*.2)/(e+(this._private__height-1)*.2),r=C(this._private__priceRangeSnapshot).clone();t=Math.max(t,.1),r.scaleAroundCenter(t),this.setPriceRange(r)}},i.prototype.endScale=function(){this.isPercentage()||this.isIndexedTo100()||(this._private__scaleStartPoint=null,this._private__priceRangeSnapshot=null)},i.prototype.startScroll=function(e){this.isAutoScale()||this._private__scrollStartPoint!==null||this._private__priceRangeSnapshot!==null||this.isEmpty()||(this._private__scrollStartPoint=e,this._private__priceRangeSnapshot=C(this.priceRange()).clone())},i.prototype.scrollTo=function(e){if(!this.isAutoScale()&&this._private__scrollStartPoint!==null){var t=C(this.priceRange()).length()/(this.internalHeight()-1),r=e-this._private__scrollStartPoint;this.isInverted()&&(r*=-1);var a=r*t,n=C(this._private__priceRangeSnapshot).clone();n.shift(a),this.setPriceRange(n,!0),this._private__marksCache=null}},i.prototype.endScroll=function(){this.isAutoScale()||this._private__scrollStartPoint!==null&&(this._private__scrollStartPoint=null,this._private__priceRangeSnapshot=null)},i.prototype.formatter=function(){return this._private__formatter||this.updateFormatter(),this._private__formatter},i.prototype.formatPrice=function(e,t){switch(this._private__options.mode){case 2:return this.formatter().format(Be(e,t));case 3:return this.formatter().format($e(e,t));default:return this._private__formatPrice(e)}},i.prototype.formatLogical=function(e){switch(this._private__options.mode){case 2:case 3:return this.formatter().format(e);default:return this._private__formatPrice(e)}},i.prototype.formatPriceAbsolute=function(e){return this._private__formatPrice(e,C(this._private__formatterSource()).formatter())},i.prototype.formatPricePercentage=function(e,t){return e=Be(e,t),Ai.format(e)},i.prototype.sourcesForAutoScale=function(){return this._private__dataSources},i.prototype.recalculatePriceRange=function(e){this._private__invalidatedForRange={_internal_visibleBars:e,_internal_isValid:!1}},i.prototype.updateAllViews=function(){this._private__dataSources.forEach(function(e){return e.updateAllViews()})},i.prototype.updateFormatter=function(){this._private__marksCache=null;var e=this._private__formatterSource(),t=100;e!==null&&(t=Math.round(1/e.minMove())),this._private__formatter=Ei,this.isPercentage()?(this._private__formatter=Ai,t=100):this.isIndexedTo100()?(this._private__formatter=new Mt(100,1),t=100):e!==null&&(this._private__formatter=e.formatter()),this._private__markBuilder=new Di(this,t,this._private__coordinateToLogical.bind(this),this._private__logicalToCoordinate.bind(this)),this._private__markBuilder._internal_rebuildTickMarks()},i.prototype.invalidateSourcesCache=function(){this._private__cachedOrderedSources=null},i.prototype._private__formatterSource=function(){return this._private__dataSources[0]||null},i.prototype._private__topMarginPx=function(){return this.isInverted()?this._private__options.scaleMargins.bottom*this.height()+this._private__marginBelow:this._private__options.scaleMargins.top*this.height()+this._private__marginAbove},i.prototype._private__bottomMarginPx=function(){return this.isInverted()?this._private__options.scaleMargins.top*this.height()+this._private__marginAbove:this._private__options.scaleMargins.bottom*this.height()+this._private__marginBelow},i.prototype._private__makeSureItIsValid=function(){this._private__invalidatedForRange._internal_isValid||(this._private__invalidatedForRange._internal_isValid=!0,this._private__recalculatePriceRangeImpl())},i.prototype._private__invalidateInternalHeightCache=function(){this._private__internalHeightCache=null},i.prototype._private__logicalToCoordinate=function(e,t){if(this._private__makeSureItIsValid(),this.isEmpty())return 0;e=this.isLog()&&e?bt(e,this._private__logFormula):e;var r=C(this.priceRange()),a=this._private__bottomMarginPx()+(this.internalHeight()-1)*(e-r.minValue())/r.length(),n=this.invertedCoordinate(a);return n},i.prototype._private__coordinateToLogical=function(e,t){if(this._private__makeSureItIsValid(),this.isEmpty())return 0;var r=this.invertedCoordinate(e),a=C(this.priceRange()),n=a.minValue()+a.length()*((r-this._private__bottomMarginPx())/(this.internalHeight()-1));return this.isLog()?Ge(n,this._private__logFormula):n},i.prototype._private__onIsInvertedChanged=function(){this._private__marksCache=null,this._private__markBuilder._internal_rebuildTickMarks()},i.prototype._private__recalculatePriceRangeImpl=function(){var e=this._private__invalidatedForRange._internal_visibleBars;if(e!==null){for(var t=null,r=this.sourcesForAutoScale(),a=0,n=0,_=0,o=r;_<o.length;_++){var l=o[_];if(l.visible()){var v=l.firstValue();if(v!==null){var c=l.autoscaleInfo(e.left(),e.right()),u=c&&c.priceRange();if(u!==null){switch(this._private__options.mode){case 1:u=Ue(u,this._private__logFormula);break;case 2:u=R_(u,v.value);break;case 3:u=O_(u,v.value);break}if(t===null?t=u:t=t.merge(C(u)),c!==null){var d=c.margins();d!==null&&(a=Math.max(a,d.above),n=Math.max(a,d.below))}}}}}if((a!==this._private__marginAbove||n!==this._private__marginBelow)&&(this._private__marginAbove=a,this._private__marginBelow=n,this._private__marksCache=null,this._private__invalidateInternalHeightCache()),t!==null){if(t.minValue()===t.maxValue()){var m=this._private__formatterSource(),g=m===null||this.isPercentage()||this.isIndexedTo100()?1:m.minMove(),S=5*g;this.isLog()&&(t=pt(t,this._private__logFormula)),t=new Se(t.minValue()-S,t.maxValue()+S),this.isLog()&&(t=Ue(t,this._private__logFormula))}if(this.isLog()){var y=pt(t,this._private__logFormula),b=Wt(y);if(!E_(b,this._private__logFormula)){var x=this._private__priceRangeSnapshot!==null?pt(this._private__priceRangeSnapshot,this._private__logFormula):null;this._private__logFormula=b,t=Ue(y,b),x!==null&&(this._private__priceRangeSnapshot=Ue(x,b))}}this.setPriceRange(t)}else this._private__priceRange===null&&(this.setPriceRange(new Se(-.5,.5)),this._private__logFormula=Wt(null));this._private__invalidatedForRange._internal_isValid=!0}},i.prototype._private__getCoordinateTransformer=function(){var e=this;return this.isPercentage()?Be:this.isIndexedTo100()?$e:this.isLog()?function(t){return bt(t,e._private__logFormula)}:null},i.prototype._private__formatPrice=function(e,t){return this._private__localizationOptions.priceFormatter===void 0?(t===void 0&&(t=this.formatter()),t.format(e)):this._private__localizationOptions.priceFormatter(e)},i}(),Tr=1e3,B_=function(){function i(e,t){this._private__dataSources=[],this._private__overlaySourcesByScaleId=new Map,this._private__height=0,this._private__width=0,this._private__stretchFactor=Tr,this._private__cachedOrderedSources=null,this._private__destroyed=new U,this._private__timeScale=e,this._private__model=t,this._private__grid=new x_(this);var r=t.options();this._private__leftPriceScale=this._private__createPriceScale("left",r.leftPriceScale),this._private__rightPriceScale=this._private__createPriceScale("right",r.rightPriceScale),this._private__leftPriceScale.modeChanged().subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__leftPriceScale),this),this._private__rightPriceScale.modeChanged().subscribe(this._private__onPriceScaleModeChanged.bind(this,this._private__leftPriceScale),this),this.applyScaleOptions(r)}return i.prototype.applyScaleOptions=function(e){if(e.leftPriceScale&&this._private__leftPriceScale.applyOptions(e.leftPriceScale),e.rightPriceScale&&this._private__rightPriceScale.applyOptions(e.rightPriceScale),e.localization&&(this._private__leftPriceScale.updateFormatter(),this._private__rightPriceScale.updateFormatter()),e.overlayPriceScales)for(var t=Array.from(this._private__overlaySourcesByScaleId.values()),r=0,a=t;r<a.length;r++){var n=a[r],_=C(n[0].priceScale());_.applyOptions(e.overlayPriceScales),e.localization&&_.updateFormatter()}},i.prototype.priceScaleById=function(e){switch(e){case"left":return this._private__leftPriceScale;case"right":return this._private__rightPriceScale}return this._private__overlaySourcesByScaleId.has(e)?se(this._private__overlaySourcesByScaleId.get(e))[0].priceScale():null},i.prototype.destroy=function(){this.model().priceScalesOptionsChanged().unsubscribeAll(this),this._private__leftPriceScale.modeChanged().unsubscribeAll(this),this._private__rightPriceScale.modeChanged().unsubscribeAll(this),this._private__dataSources.forEach(function(e){e.destroy&&e.destroy()}),this._private__destroyed._internal_fire()},i.prototype.stretchFactor=function(){return this._private__stretchFactor},i.prototype.setStretchFactor=function(e){this._private__stretchFactor=e},i.prototype.model=function(){return this._private__model},i.prototype.width=function(){return this._private__width},i.prototype.height=function(){return this._private__height},i.prototype.setWidth=function(e){this._private__width=e,this.updateAllSources()},i.prototype.setHeight=function(e){var t=this;this._private__height=e,this._private__leftPriceScale.setHeight(e),this._private__rightPriceScale.setHeight(e),this._private__dataSources.forEach(function(r){if(t.isOverlay(r)){var a=r.priceScale();a!==null&&a.setHeight(e)}}),this.updateAllSources()},i.prototype.dataSources=function(){return this._private__dataSources},i.prototype.isOverlay=function(e){var t=e.priceScale();return t===null?!0:this._private__leftPriceScale!==t&&this._private__rightPriceScale!==t},i.prototype.addDataSource=function(e,t,r){var a=r!==void 0?r:this._private__getZOrderMinMax()._internal_maxZOrder+1;this._private__insertDataSource(e,t,a)},i.prototype.removeDataSource=function(e){var t=this._private__dataSources.indexOf(e);re(t!==-1,"removeDataSource: invalid data source"),this._private__dataSources.splice(t,1);var r=C(e.priceScale()).id();if(this._private__overlaySourcesByScaleId.has(r)){var a=se(this._private__overlaySourcesByScaleId.get(r)),n=a.indexOf(e);n!==-1&&(a.splice(n,1),a.length===0&&this._private__overlaySourcesByScaleId.delete(r))}var _=e.priceScale();_&&_.dataSources().indexOf(e)>=0&&_.removeDataSource(e),_!==null&&(_.invalidateSourcesCache(),this.recalculatePriceScale(_)),this._private__cachedOrderedSources=null},i.prototype.priceScalePosition=function(e){return e===this._private__leftPriceScale?"left":e===this._private__rightPriceScale?"right":"overlay"},i.prototype.leftPriceScale=function(){return this._private__leftPriceScale},i.prototype.rightPriceScale=function(){return this._private__rightPriceScale},i.prototype.startScalePrice=function(e,t){e.startScale(t)},i.prototype.scalePriceTo=function(e,t){e.scaleTo(t),this.updateAllSources()},i.prototype.endScalePrice=function(e){e.endScale()},i.prototype.startScrollPrice=function(e,t){e.startScroll(t)},i.prototype.scrollPriceTo=function(e,t){e.scrollTo(t),this.updateAllSources()},i.prototype.endScrollPrice=function(e){e.endScroll()},i.prototype.updateAllSources=function(){this._private__dataSources.forEach(function(e){e.updateAllViews()})},i.prototype.defaultPriceScale=function(){var e=null;return this._private__model.options().rightPriceScale.visible&&this._private__rightPriceScale.dataSources().length!==0?e=this._private__rightPriceScale:this._private__model.options().leftPriceScale.visible&&this._private__leftPriceScale.dataSources().length!==0?e=this._private__leftPriceScale:this._private__dataSources.length!==0&&(e=this._private__dataSources[0].priceScale()),e===null&&(e=this._private__rightPriceScale),e},i.prototype.defaultVisiblePriceScale=function(){var e=null;return this._private__model.options().rightPriceScale.visible?e=this._private__rightPriceScale:this._private__model.options().leftPriceScale.visible&&(e=this._private__leftPriceScale),e},i.prototype.recalculatePriceScale=function(e){e===null||!e.isAutoScale()||this._private__recalculatePriceScaleImpl(e)},i.prototype.resetPriceScale=function(e){var t=this._private__timeScale.visibleStrictRange();e.setMode({autoScale:!0}),t!==null&&e.recalculatePriceRange(t),this.updateAllSources()},i.prototype.momentaryAutoScale=function(){this._private__recalculatePriceScaleImpl(this._private__leftPriceScale),this._private__recalculatePriceScaleImpl(this._private__rightPriceScale)},i.prototype.recalculate=function(){var e=this;this.recalculatePriceScale(this._private__leftPriceScale),this.recalculatePriceScale(this._private__rightPriceScale),this._private__dataSources.forEach(function(t){e.isOverlay(t)&&e.recalculatePriceScale(t.priceScale())}),this.updateAllSources(),this._private__model.lightUpdate()},i.prototype.orderedSources=function(){return this._private__cachedOrderedSources===null&&(this._private__cachedOrderedSources=Pr(this._private__dataSources)),this._private__cachedOrderedSources},i.prototype.onDestroyed=function(){return this._private__destroyed},i.prototype.grid=function(){return this._private__grid},i.prototype._private__recalculatePriceScaleImpl=function(e){var t=e.sourcesForAutoScale();if(t&&t.length>0&&!this._private__timeScale.isEmpty()){var r=this._private__timeScale.visibleStrictRange();r!==null&&e.recalculatePriceRange(r)}e.updateAllViews()},i.prototype._private__getZOrderMinMax=function(){var e=this.orderedSources();if(e.length===0)return{_internal_minZOrder:0,_internal_maxZOrder:0};for(var t=0,r=0,a=0;a<e.length;a++){var n=e[a],_=n.zorder();_!==null&&(_<t&&(t=_),_>r&&(r=_))}return{_internal_minZOrder:t,_internal_maxZOrder:r}},i.prototype._private__insertDataSource=function(e,t,r){var a=this.priceScaleById(t);if(a===null&&(a=this._private__createPriceScale(t,this._private__model.options().overlayPriceScales)),this._private__dataSources.push(e),!Tt(t)){var n=this._private__overlaySourcesByScaleId.get(t)||[];n.push(e),this._private__overlaySourcesByScaleId.set(t,n)}a.addDataSource(e),e.setPriceScale(a),e.setZorder(r),this.recalculatePriceScale(a),this._private__cachedOrderedSources=null},i.prototype._private__onPriceScaleModeChanged=function(e,t,r){t.mode!==r.mode&&this._private__recalculatePriceScaleImpl(e)},i.prototype._private__createPriceScale=function(e,t){var r=F({visible:!0,autoScale:!0},ee(t)),a=new I_(e,r,this._private__model.options().layout,this._private__model.options().localization);return a.setHeight(this.height()),a},i}(),F_=function(i){return i.getUTCMonth()+1},W_=function(i){return i.getUTCDate()},Mr=function(i){return i.getUTCFullYear()},z_=function(i){return be(W_(i),2)},N_=function(i,e){return new Date(i.getUTCFullYear(),i.getUTCMonth(),1).toLocaleString(e,{month:"long"})},H_=function(i,e){return new Date(i.getUTCFullYear(),i.getUTCMonth(),1).toLocaleString(e,{month:"short"})},U_=function(i){return be(F_(i),2)},Y_=function(i){return be(Mr(i)%100,2)},X_=function(i){return be(Mr(i),4)};function $_(i,e,t){return e.replace(/yyyy/g,X_(i)).replace(/yy/g,Y_(i)).replace(/MMMM/g,N_(i,t)).replace(/MMM/g,H_(i,t)).replace(/MM/g,U_(i)).replace(/dd/g,z_(i))}var kr=function(){function i(e,t){e===void 0&&(e="yyyy-MM-dd"),t===void 0&&(t="default"),this._private__dateFormat=e,this._private__locale=t}return i.prototype._internal_format=function(e){return $_(e,this._private__dateFormat,this._private__locale)},i}(),q_=function(){function i(e){this._private__formatStr=e||"%h:%m:%s"}return i.prototype._internal_format=function(e){return this._private__formatStr.replace("%h",be(e.getUTCHours(),2)).replace("%m",be(e.getUTCMinutes(),2)).replace("%s",be(e.getUTCSeconds(),2))},i}(),j_={_internal_dateFormat:"yyyy-MM-dd",_internal_timeFormat:"%h:%m:%s",_internal_dateTimeSeparator:" ",_internal_locale:"default"},G_=function(){function i(e){e===void 0&&(e={});var t=F(F({},j_),e);this._private__dateFormatter=new kr(t._internal_dateFormat,t._internal_locale),this._private__timeFormatter=new q_(t._internal_timeFormat),this._private__separator=t._internal_dateTimeSeparator}return i.prototype._internal_format=function(e){return"".concat(this._private__dateFormatter._internal_format(e)).concat(this._private__separator).concat(this._private__timeFormatter._internal_format(e))},i}();function Z_(i,e,t){var r={};switch(e){case 0:r.year="numeric";break;case 1:r.month="short";break;case 2:r.day="numeric";break;case 3:r.hour12=!1,r.hour="2-digit",r.minute="2-digit";break;case 4:r.hour12=!1,r.hour="2-digit",r.minute="2-digit",r.second="2-digit";break}var a=i.businessDay===void 0?new Date(i.timestamp*1e3):new Date(Date.UTC(i.businessDay.year,i.businessDay.month-1,i.businessDay.day)),n=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());return n.toLocaleString(t,r)}var K_=function(){function i(e,t){t===void 0&&(t=50),this._private__actualSize=0,this._private__usageTick=1,this._private__oldestTick=1,this._private__cache=new Map,this._private__tick2Labels=new Map,this._private__format=e,this._private__maxSize=t}return i.prototype._internal_format=function(e){var t=e.businessDay===void 0?new Date(e.timestamp*1e3).getTime():new Date(Date.UTC(e.businessDay.year,e.businessDay.month-1,e.businessDay.day)).getTime(),r=this._private__cache.get(t);if(r!==void 0)return r._internal_string;if(this._private__actualSize===this._private__maxSize){var a=this._private__tick2Labels.get(this._private__oldestTick);this._private__tick2Labels.delete(this._private__oldestTick),this._private__cache.delete(se(a)),this._private__oldestTick++,this._private__actualSize--}var n=this._private__format(e);return this._private__cache.set(t,{_internal_string:n,_internal_tick:this._private__usageTick}),this._private__tick2Labels.set(this._private__usageTick,t),this._private__actualSize++,this._private__usageTick++,n},i}(),qe=function(){function i(e,t){re(e<=t,"right should be >= left"),this._private__left=e,this._private__right=t}return i.prototype.left=function(){return this._private__left},i.prototype.right=function(){return this._private__right},i.prototype.count=function(){return this._private__right-this._private__left+1},i.prototype.contains=function(e){return this._private__left<=e&&e<=this._private__right},i.prototype.equals=function(e){return this._private__left===e.left()&&this._private__right===e.right()},i}();function Vi(i,e){return i===null||e===null?i===e:i.equals(e)}var J_=function(){function i(){this._private__marksByWeight=new Map,this._private__cache=null}return i.prototype._internal_setTimeScalePoints=function(e,t){this._private__removeMarksSinceIndex(t),this._private__cache=null;for(var r=t;r<e.length;++r){var a=e[r],n=this._private__marksByWeight.get(a.timeWeight);n===void 0&&(n=[],this._private__marksByWeight.set(a.timeWeight,n)),n.push({_internal_index:r,_internal_time:a.time,_internal_weight:a.timeWeight})}},i.prototype._internal_build=function(e,t){var r=Math.ceil(t/e);return(this._private__cache===null||this._private__cache._internal_maxIndexesPerMark!==r)&&(this._private__cache={_internal_marks:this._private__buildMarksImpl(r),_internal_maxIndexesPerMark:r}),this._private__cache._internal_marks},i.prototype._private__removeMarksSinceIndex=function(e){if(e===0){this._private__marksByWeight.clear();return}var t=[];this._private__marksByWeight.forEach(function(_,o){e<=_[0]._internal_index?t.push(o):_.splice(Ke(_,e,function(l){return l._internal_index<e}),1/0)});for(var r=0,a=t;r<a.length;r++){var n=a[r];this._private__marksByWeight.delete(n)}},i.prototype._private__buildMarksImpl=function(e){for(var t=[],r=0,a=Array.from(this._private__marksByWeight.keys()).sort(function(x,D){return D-x});r<a.length;r++){var n=a[r];if(this._private__marksByWeight.get(n)){var _=t;t=[];for(var o=_.length,l=0,v=se(this._private__marksByWeight.get(n)),c=v.length,u=1/0,d=-1/0,m=0;m<c;m++){for(var g=v[m],S=g._internal_index;l<o;){var y=_[l],b=y._internal_index;if(b<S)l++,t.push(y),d=b,u=1/0;else{u=b;break}}u-S>=e&&S-d>=e&&(t.push(g),d=S)}for(;l<o;l++)t.push(_[l])}}return t},i}(),ft=function(){function i(e){this._private__logicalRange=e}return i.prototype._internal_strictRange=function(){return this._private__logicalRange===null?null:new qe(Math.floor(this._private__logicalRange.left()),Math.ceil(this._private__logicalRange.right()))},i.prototype._internal_logicalRange=function(){return this._private__logicalRange},i._internal_invalid=function(){return new i(null)},i}(),Ii;(function(i){i[i.Year=0]="Year",i[i.Month=1]="Month",i[i.DayOfMonth=2]="DayOfMonth",i[i.Time=3]="Time",i[i.TimeWithSeconds=4]="TimeWithSeconds"})(Ii||(Ii={}));var Q_=function(){function i(e,t,r){this._private__width=0,this._private__baseIndexOrNull=null,this._private__points=[],this._private__scrollStartPoint=null,this._private__scaleStartPoint=null,this._private__tickMarks=new J_,this._private__formattedByWeight=new Map,this._private__visibleRange=ft._internal_invalid(),this._private__visibleRangeInvalidated=!0,this._private__visibleBarsChanged=new U,this._private__logicalRangeChanged=new U,this._private__optionsApplied=new U,this._private__commonTransitionStartState=null,this._private__timeMarksCache=null,this._private__labels=[],this._private__options=t,this._private__localizationOptions=r,this._private__rightOffset=t.rightOffset,this._private__barSpacing=t.barSpacing,this._private__model=e,this._private__updateDateTimeFormatter()}return i.prototype.options=function(){return this._private__options},i.prototype.applyLocalizationOptions=function(e){$(this._private__localizationOptions,e),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter()},i.prototype.applyOptions=function(e,t){var r;$(this._private__options,e),this._private__options.fixLeftEdge&&this._private__doFixLeftEdge(),this._private__options.fixRightEdge&&this._private__doFixRightEdge(),e.barSpacing!==void 0&&this._private__model.setBarSpacing(e.barSpacing),e.rightOffset!==void 0&&this._private__model.setRightOffset(e.rightOffset),e.minBarSpacing!==void 0&&this._private__model.setBarSpacing((r=e.barSpacing)!==null&&r!==void 0?r:this._private__barSpacing),this._private__invalidateTickMarks(),this._private__updateDateTimeFormatter(),this._private__optionsApplied._internal_fire()},i.prototype.indexToTime=function(e){var t;return((t=this._private__points[e])===null||t===void 0?void 0:t.time)||null},i.prototype.timeToIndex=function(e,t){if(this._private__points.length<1)return null;if(e.timestamp>this._private__points[this._private__points.length-1].time.timestamp)return t?this._private__points.length-1:null;var r=Ke(this._private__points,e.timestamp,function(a,n){return a.time.timestamp<n});return e.timestamp<this._private__points[r].time.timestamp?t?r:null:r},i.prototype.isEmpty=function(){return this._private__width===0||this._private__points.length===0||this._private__baseIndexOrNull===null},i.prototype.visibleStrictRange=function(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_strictRange()},i.prototype.visibleLogicalRange=function(){return this._private__updateVisibleRange(),this._private__visibleRange._internal_logicalRange()},i.prototype.visibleTimeRange=function(){var e=this.visibleStrictRange();if(e===null)return null;var t={from:e.left(),to:e.right()};return this.timeRangeForLogicalRange(t)},i.prototype.timeRangeForLogicalRange=function(e){var t=Math.round(e.from),r=Math.round(e.to),a=C(this._private__firstIndex()),n=C(this._private__lastIndex());return{from:C(this.indexToTime(Math.max(a,t))),to:C(this.indexToTime(Math.min(n,r)))}},i.prototype.logicalRangeForTimeRange=function(e){return{from:C(this.timeToIndex(e.from,!0)),to:C(this.timeToIndex(e.to,!0))}},i.prototype.width=function(){return this._private__width},i.prototype.setWidth=function(e){if(!(!isFinite(e)||e<=0)&&this._private__width!==e){if(this._private__options.lockVisibleTimeRangeOnResize&&this._private__width){var t=this._private__barSpacing*e/this._private__width;this._private__barSpacing=t}if(this._private__options.fixLeftEdge){var r=this.visibleStrictRange();if(r!==null){var a=r.left();if(a<=0){var n=this._private__width-e;this._private__rightOffset-=Math.round(n/this._private__barSpacing)+1}}}this._private__width=e,this._private__visibleRangeInvalidated=!0,this._private__correctBarSpacing(),this._private__correctOffset()}},i.prototype.indexToCoordinate=function(e){if(this.isEmpty()||!je(e))return 0;var t=this.baseIndex(),r=t+this._private__rightOffset-e,a=this._private__width-(r+.5)*this._private__barSpacing-1;return a},i.prototype.indexesToCoordinates=function(e,t){for(var r=this.baseIndex(),a=t===void 0?0:t.from,n=t===void 0?e.length:t.to,_=a;_<n;_++){var o=e[_].time,l=r+this._private__rightOffset-o,v=this._private__width-(l+.5)*this._private__barSpacing-1;e[_].x=v}},i.prototype.coordinateToIndex=function(e){return Math.ceil(this._private__coordinateToFloatIndex(e))},i.prototype.setRightOffset=function(e){this._private__visibleRangeInvalidated=!0,this._private__rightOffset=e,this._private__correctOffset(),this._private__model.recalculateAllPanes(),this._private__model.lightUpdate()},i.prototype.barSpacing=function(){return this._private__barSpacing},i.prototype.setBarSpacing=function(e){this._private__setBarSpacing(e),this._private__correctOffset(),this._private__model.recalculateAllPanes(),this._private__model.lightUpdate()},i.prototype.rightOffset=function(){return this._private__rightOffset},i.prototype.marks=function(){if(this.isEmpty())return null;if(this._private__timeMarksCache!==null)return this._private__timeMarksCache;for(var e=this._private__barSpacing,t=this._private__model.options().layout.fontSize,r=(t+4)*5,a=Math.round(r/e),n=C(this.visibleStrictRange()),_=Math.max(n.left(),n.left()-a),o=Math.max(n.right(),n.right()-a),l=this._private__tickMarks._internal_build(e,r),v=this._private__firstIndex()+a,c=this._private__lastIndex()-a,u=this._private__isAllScalingAndScrollingDisabled(),d=this._private__options.fixLeftEdge||u,m=this._private__options.fixRightEdge||u,g=0,S=0,y=l;S<y.length;S++){var b=y[S];if(_<=b._internal_index&&b._internal_index<=o){var x=void 0;g<this._private__labels.length?(x=this._private__labels[g],x.coord=this.indexToCoordinate(b._internal_index),x.label=this._private__formatLabel(b._internal_time,b._internal_weight),x.weight=b._internal_weight):(x={needAlignCoordinate:!1,coord:this.indexToCoordinate(b._internal_index),label:this._private__formatLabel(b._internal_time,b._internal_weight),weight:b._internal_weight},this._private__labels.push(x)),this._private__barSpacing>r/2&&!u?x.needAlignCoordinate=!1:x.needAlignCoordinate=d&&b._internal_index<=v||m&&b._internal_index>=c,g++}}return this._private__labels.length=g,this._private__timeMarksCache=this._private__labels,this._private__labels},i.prototype.restoreDefault=function(){this._private__visibleRangeInvalidated=!0,this.setBarSpacing(this._private__options.barSpacing),this.setRightOffset(this._private__options.rightOffset)},i.prototype.setBaseIndex=function(e){this._private__visibleRangeInvalidated=!0,this._private__baseIndexOrNull=e,this._private__correctOffset(),this._private__doFixLeftEdge()},i.prototype.zoom=function(e,t){var r=this._private__coordinateToFloatIndex(e),a=this.barSpacing(),n=a+t*(a/10);this.setBarSpacing(n),this._private__options.rightBarStaysOnScroll||this.setRightOffset(this.rightOffset()+(r-this._private__coordinateToFloatIndex(e)))},i.prototype.startScale=function(e){this._private__scrollStartPoint&&this.endScroll(),!(this._private__scaleStartPoint!==null||this._private__commonTransitionStartState!==null)&&(this.isEmpty()||(this._private__scaleStartPoint=e,this._private__saveCommonTransitionsStartState()))},i.prototype.scaleTo=function(e){if(this._private__commonTransitionStartState!==null){var t=yt(this._private__width-e,0,this._private__width),r=yt(this._private__width-C(this._private__scaleStartPoint),0,this._private__width);t===0||r===0||this.setBarSpacing(this._private__commonTransitionStartState._internal_barSpacing*t/r)}},i.prototype.endScale=function(){this._private__scaleStartPoint!==null&&(this._private__scaleStartPoint=null,this._private__clearCommonTransitionsStartState())},i.prototype.startScroll=function(e){this._private__scrollStartPoint!==null||this._private__commonTransitionStartState!==null||this.isEmpty()||(this._private__scrollStartPoint=e,this._private__saveCommonTransitionsStartState())},i.prototype.scrollTo=function(e){if(this._private__scrollStartPoint!==null){var t=(this._private__scrollStartPoint-e)/this.barSpacing();this._private__rightOffset=C(this._private__commonTransitionStartState)._internal_rightOffset+t,this._private__visibleRangeInvalidated=!0,this._private__correctOffset()}},i.prototype.endScroll=function(){this._private__scrollStartPoint!==null&&(this._private__scrollStartPoint=null,this._private__clearCommonTransitionsStartState())},i.prototype.scrollToRealTime=function(){this.scrollToOffsetAnimated(this._private__options.rightOffset)},i.prototype.scrollToOffsetAnimated=function(e,t){var r=this;if(t===void 0&&(t=400),!isFinite(e))throw new RangeError("offset is required and must be finite number");if(!isFinite(t)||t<=0)throw new RangeError("animationDuration (optional) must be finite positive number");var a=this._private__rightOffset,n=performance.now(),_=function(){var o=(performance.now()-n)/t,l=o>=1,v=l?e:a+(e-a)*o;r.setRightOffset(v),l||setTimeout(_,20)};_()},i.prototype.update=function(e,t){this._private__visibleRangeInvalidated=!0,this._private__points=e,this._private__tickMarks._internal_setTimeScalePoints(e,t),this._private__correctOffset()},i.prototype.visibleBarsChanged=function(){return this._private__visibleBarsChanged},i.prototype.logicalRangeChanged=function(){return this._private__logicalRangeChanged},i.prototype.optionsApplied=function(){return this._private__optionsApplied},i.prototype.baseIndex=function(){return this._private__baseIndexOrNull||0},i.prototype.setVisibleRange=function(e){var t=e.count();this._private__setBarSpacing(this._private__width/t),this._private__rightOffset=e.right()-this.baseIndex(),this._private__correctOffset(),this._private__visibleRangeInvalidated=!0,this._private__model.recalculateAllPanes(),this._private__model.lightUpdate()},i.prototype.fitContent=function(){var e=this._private__firstIndex(),t=this._private__lastIndex();e===null||t===null||this.setVisibleRange(new qe(e,t+this._private__options.rightOffset))},i.prototype.setLogicalRange=function(e){var t=new qe(e.from,e.to);this.setVisibleRange(t)},i.prototype.formatDateTime=function(e){return this._private__localizationOptions.timeFormatter!==void 0?this._private__localizationOptions.timeFormatter(e.businessDay||e.timestamp):this._private__dateTimeFormatter._internal_format(new Date(e.timestamp*1e3))},i.prototype._private__isAllScalingAndScrollingDisabled=function(){var e=this._private__model.options(),t=e.handleScroll,r=e.handleScale;return!t.horzTouchDrag&&!t.mouseWheel&&!t.pressedMouseMove&&!t.vertTouchDrag&&!r.axisDoubleClickReset&&!r.axisPressedMouseMove.time&&!r.mouseWheel&&!r.pinch},i.prototype._private__firstIndex=function(){return this._private__points.length===0?null:0},i.prototype._private__lastIndex=function(){return this._private__points.length===0?null:this._private__points.length-1},i.prototype._private__rightOffsetForCoordinate=function(e){return(this._private__width-1-e)/this._private__barSpacing},i.prototype._private__coordinateToFloatIndex=function(e){var t=this._private__rightOffsetForCoordinate(e),r=this.baseIndex(),a=r+this._private__rightOffset-t;return Math.round(a*1e6)/1e6},i.prototype._private__setBarSpacing=function(e){var t=this._private__barSpacing;this._private__barSpacing=e,this._private__correctBarSpacing(),t!==this._private__barSpacing&&(this._private__visibleRangeInvalidated=!0,this._private__resetTimeMarksCache())},i.prototype._private__updateVisibleRange=function(){if(this._private__visibleRangeInvalidated){if(this._private__visibleRangeInvalidated=!1,this.isEmpty()){this._private__setVisibleRange(ft._internal_invalid());return}var e=this.baseIndex(),t=this._private__width/this._private__barSpacing,r=this._private__rightOffset+e,a=r-t+1,n=new qe(a,r);this._private__setVisibleRange(new ft(n))}},i.prototype._private__correctBarSpacing=function(){var e=this._private__minBarSpacing();if(this._private__barSpacing<e&&(this._private__barSpacing=e,this._private__visibleRangeInvalidated=!0),this._private__width!==0){var t=this._private__width*.5;this._private__barSpacing>t&&(this._private__barSpacing=t,this._private__visibleRangeInvalidated=!0)}},i.prototype._private__minBarSpacing=function(){return this._private__options.fixLeftEdge&&this._private__options.fixRightEdge&&this._private__points.length!==0?this._private__width/this._private__points.length:this._private__options.minBarSpacing},i.prototype._private__correctOffset=function(){var e=this._private__maxRightOffset();this._private__rightOffset>e&&(this._private__rightOffset=e,this._private__visibleRangeInvalidated=!0);var t=this._private__minRightOffset();t!==null&&this._private__rightOffset<t&&(this._private__rightOffset=t,this._private__visibleRangeInvalidated=!0)},i.prototype._private__minRightOffset=function(){var e=this._private__firstIndex(),t=this._private__baseIndexOrNull;if(e===null||t===null)return null;var r=this._private__options.fixLeftEdge?this._private__width/this._private__barSpacing:Math.min(2,this._private__points.length);return e-t-1+r},i.prototype._private__maxRightOffset=function(){return this._private__options.fixRightEdge?0:this._private__width/this._private__barSpacing-Math.min(2,this._private__points.length)},i.prototype._private__saveCommonTransitionsStartState=function(){this._private__commonTransitionStartState={_internal_barSpacing:this.barSpacing(),_internal_rightOffset:this.rightOffset()}},i.prototype._private__clearCommonTransitionsStartState=function(){this._private__commonTransitionStartState=null},i.prototype._private__formatLabel=function(e,t){var r=this,a=this._private__formattedByWeight.get(t);return a===void 0&&(a=new K_(function(n){return r._private__formatLabelImpl(n,t)}),this._private__formattedByWeight.set(t,a)),a._internal_format(e)},i.prototype._private__formatLabelImpl=function(e,t){var r,a=es(t,this._private__options.timeVisible,this._private__options.secondsVisible);return this._private__options.tickMarkFormatter!==void 0?this._private__options.tickMarkFormatter((r=e.businessDay)!==null&&r!==void 0?r:e.timestamp,a,this._private__localizationOptions.locale):Z_(e,a,this._private__localizationOptions.locale)},i.prototype._private__setVisibleRange=function(e){var t=this._private__visibleRange;this._private__visibleRange=e,Vi(t._internal_strictRange(),this._private__visibleRange._internal_strictRange())||this._private__visibleBarsChanged._internal_fire(),Vi(t._internal_logicalRange(),this._private__visibleRange._internal_logicalRange())||this._private__logicalRangeChanged._internal_fire(),this._private__resetTimeMarksCache()},i.prototype._private__resetTimeMarksCache=function(){this._private__timeMarksCache=null},i.prototype._private__invalidateTickMarks=function(){this._private__resetTimeMarksCache(),this._private__formattedByWeight.clear()},i.prototype._private__updateDateTimeFormatter=function(){var e=this._private__localizationOptions.dateFormat;this._private__options.timeVisible?this._private__dateTimeFormatter=new G_({_internal_dateFormat:e,_internal_timeFormat:this._private__options.secondsVisible?"%h:%m:%s":"%h:%m",_internal_dateTimeSeparator:"   ",_internal_locale:this._private__localizationOptions.locale}):this._private__dateTimeFormatter=new kr(e,this._private__localizationOptions.locale)},i.prototype._private__doFixLeftEdge=function(){if(this._private__options.fixLeftEdge){var e=this._private__firstIndex();if(e!==null){var t=this.visibleStrictRange();if(t!==null){var r=t.left()-e;if(r<0){var a=this._private__rightOffset-r-1;this.setRightOffset(a)}this._private__correctBarSpacing()}}}},i.prototype._private__doFixRightEdge=function(){this._private__correctOffset(),this._private__correctBarSpacing()},i}();function es(i,e,t){switch(i){case 0:case 10:return e?t?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return e?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}var ts=function(i){B(e,i);function e(t){var r=i.call(this)||this;return r._private__metricsCache=new Map,r._private__data=t,r}return e.prototype._internal__drawImpl=function(t){},e.prototype._internal__drawBackgroundImpl=function(t){if(this._private__data._internal_visible){t.save();for(var r=0,a=0,n=this._private__data._internal_lines;a<n.length;a++){var _=n[a];if(_._internal_text.length!==0){t.font=_._internal_font;var o=this._private__metrics(t,_._internal_text);o>this._private__data._internal_width?_._internal_zoom=this._private__data._internal_width/o:_._internal_zoom=1,r+=_._internal_lineHeight*_._internal_zoom}}var l=0;switch(this._private__data._internal_vertAlign){case"top":l=0;break;case"center":l=Math.max((this._private__data._internal_height-r)/2,0);break;case"bottom":l=Math.max(this._private__data._internal_height-r,0);break}t.fillStyle=this._private__data._internal_color;for(var v=0,c=this._private__data._internal_lines;v<c.length;v++){var _=c[v];t.save();var u=0;switch(this._private__data._internal_horzAlign){case"left":t.textAlign="left",u=_._internal_lineHeight/2;break;case"center":t.textAlign="center",u=this._private__data._internal_width/2;break;case"right":t.textAlign="right",u=this._private__data._internal_width-1-_._internal_lineHeight/2;break}t.translate(u,l),t.textBaseline="top",t.font=_._internal_font,t.scale(_._internal_zoom,_._internal_zoom),t.fillText(_._internal_text,0,_._internal_vertOffset),t.restore(),l+=_._internal_lineHeight*_._internal_zoom}t.restore()}},e.prototype._private__metrics=function(t,r){var a=this._private__fontCache(t.font),n=a.get(r);return n===void 0&&(n=t.measureText(r).width,a.set(r,n)),n},e.prototype._private__fontCache=function(t){var r=this._private__metricsCache.get(t);return r===void 0&&(r=new Map,this._private__metricsCache.set(t,r)),r},e}(Ze),is=function(){function i(e){this._private__invalidated=!0,this._private__rendererData={_internal_visible:!1,_internal_color:"",_internal_height:0,_internal_width:0,_internal_lines:[],_internal_vertAlign:"center",_internal_horzAlign:"center"},this._private__renderer=new ts(this._private__rendererData),this._private__source=e}return i.prototype.update=function(){this._private__invalidated=!0},i.prototype.renderer=function(e,t){return this._private__invalidated&&(this._private__updateImpl(e,t),this._private__invalidated=!1),this._private__renderer},i.prototype._private__updateImpl=function(e,t){var r=this._private__source.options(),a=this._private__rendererData;a._internal_visible=r.visible,a._internal_visible&&(a._internal_color=r.color,a._internal_width=t,a._internal_height=e,a._internal_horzAlign=r.horzAlign,a._internal_vertAlign=r.vertAlign,a._internal_lines=[{_internal_text:r.text,_internal_font:Le(r.fontSize,r.fontFamily,r.fontStyle),_internal_lineHeight:r.fontSize*1.2,_internal_vertOffset:0,_internal_zoom:0}])},i}(),rs=function(i){B(e,i);function e(t,r){var a=i.call(this)||this;return a._private__options=r,a._private__paneView=new is(a),a}return e.prototype.priceAxisViews=function(){return[]},e.prototype.paneViews=function(){return[this._private__paneView]},e.prototype.options=function(){return this._private__options},e.prototype.updateAllViews=function(){this._private__paneView.update()},e}(ti),Bi;(function(i){i[i.OnTouchEnd=0]="OnTouchEnd",i[i.OnNextTap=1]="OnNextTap"})(Bi||(Bi={}));var as=function(){function i(e,t){this._private__panes=[],this._private__serieses=[],this._private__width=0,this._private__initialTimeScrollPos=null,this._private__hoveredSource=null,this._private__priceScalesOptionsChanged=new U,this._private__crosshairMoved=new U,this._private__customPriceLineDragged=new U,this._private__gradientColorsCache=null,this._private__invalidateHandler=e,this._private__options=t,this._private__rendererOptionsProvider=new hn(this),this._private__timeScale=new Q_(this,t.timeScale,this._private__options.localization),this._private__crosshair=new Tn(this,t.crosshair),this._private__magnet=new T_(t.crosshair),this._private__watermark=new rs(this,t.watermark),this.createPane(),this._private__panes[0].setStretchFactor(Tr*2),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1)}return i.prototype.fullUpdate=function(){this._private__invalidate(new ne(3))},i.prototype.lightUpdate=function(){this._private__invalidate(new ne(2))},i.prototype.cursorUpdate=function(){this._private__invalidate(new ne(1))},i.prototype.updateSource=function(e){var t=this._private__invalidationMaskForSource(e);this._private__invalidate(t)},i.prototype.hoveredSource=function(){return this._private__hoveredSource},i.prototype.setHoveredSource=function(e){var t=this._private__hoveredSource;this._private__hoveredSource=e,t!==null&&this.updateSource(t.source),e!==null&&this.updateSource(e.source)},i.prototype.options=function(){return this._private__options},i.prototype.applyOptions=function(e){$(this._private__options,e),this._private__panes.forEach(function(t){return t.applyScaleOptions(e)}),e.timeScale!==void 0&&this._private__timeScale.applyOptions(e.timeScale),e.localization!==void 0&&this._private__timeScale.applyLocalizationOptions(e.localization),(e.leftPriceScale||e.rightPriceScale)&&this._private__priceScalesOptionsChanged._internal_fire(),this._private__backgroundTopColor=this._private__getBackgroundColor(0),this._private__backgroundBottomColor=this._private__getBackgroundColor(1),this.fullUpdate()},i.prototype.applyPriceScaleOptions=function(e,t){if(e==="left"){this.applyOptions({leftPriceScale:t});return}else if(e==="right"){this.applyOptions({rightPriceScale:t});return}var r=this.findPriceScale(e);if(r===null)throw new Error("Trying to apply price scale options with incorrect ID: ".concat(e));r.priceScale.applyOptions(t),this._private__priceScalesOptionsChanged._internal_fire()},i.prototype.findPriceScale=function(e){for(var t=0,r=this._private__panes;t<r.length;t++){var a=r[t],n=a.priceScaleById(e);if(n!==null)return{pane:a,priceScale:n}}return null},i.prototype.timeScale=function(){return this._private__timeScale},i.prototype.panes=function(){return this._private__panes},i.prototype.watermarkSource=function(){return this._private__watermark},i.prototype.crosshairSource=function(){return this._private__crosshair},i.prototype.crosshairMoved=function(){return this._private__crosshairMoved},i.prototype.customPriceLineDragged=function(){return this._private__customPriceLineDragged},i.prototype.setPaneHeight=function(e,t){e.setHeight(t),this.recalculateAllPanes()},i.prototype.setWidth=function(e){this._private__width=e,this._private__timeScale.setWidth(this._private__width),this._private__panes.forEach(function(t){return t.setWidth(e)}),this.recalculateAllPanes()},i.prototype.createPane=function(e){var t=new B_(this._private__timeScale,this);e!==void 0?this._private__panes.splice(e,0,t):this._private__panes.push(t);var r=e===void 0?this._private__panes.length-1:e,a=new ne(3);return a.invalidatePane(r,{level:0,autoScale:!0}),this._private__invalidate(a),t},i.prototype.startScalePrice=function(e,t,r){e.startScalePrice(t,r)},i.prototype.scalePriceTo=function(e,t,r){e.scalePriceTo(t,r),this.updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(e,2))},i.prototype.endScalePrice=function(e,t){e.endScalePrice(t),this._private__invalidate(this._private__paneInvalidationMask(e,2))},i.prototype.startScrollPrice=function(e,t,r){t.isAutoScale()||e.startScrollPrice(t,r)},i.prototype.scrollPriceTo=function(e,t,r){t.isAutoScale()||(e.scrollPriceTo(t,r),this.updateCrosshair(),this._private__invalidate(this._private__paneInvalidationMask(e,2)))},i.prototype.endScrollPrice=function(e,t){t.isAutoScale()||(e.endScrollPrice(t),this._private__invalidate(this._private__paneInvalidationMask(e,2)))},i.prototype.resetPriceScale=function(e,t){e.resetPriceScale(t),this._private__invalidate(this._private__paneInvalidationMask(e,2))},i.prototype.startScaleTime=function(e){this._private__timeScale.startScale(e)},i.prototype.zoomTime=function(e,t){var r=this.timeScale();if(!(r.isEmpty()||t===0)){var a=r.width();e=Math.max(1,Math.min(e,a)),r.zoom(e,t),this.recalculateAllPanes()}},i.prototype.scrollChart=function(e){this.startScrollTime(0),this.scrollTimeTo(e),this.endScrollTime()},i.prototype.scaleTimeTo=function(e){this._private__timeScale.scaleTo(e),this.recalculateAllPanes()},i.prototype.endScaleTime=function(){this._private__timeScale.endScale(),this.lightUpdate()},i.prototype.startScrollTime=function(e){this._private__initialTimeScrollPos=e,this._private__timeScale.startScroll(e)},i.prototype.scrollTimeTo=function(e){var t=!1;return this._private__initialTimeScrollPos!==null&&Math.abs(e-this._private__initialTimeScrollPos)>20&&(this._private__initialTimeScrollPos=null,t=!0),this._private__timeScale.scrollTo(e),this.recalculateAllPanes(),t},i.prototype.endScrollTime=function(){this._private__timeScale.endScroll(),this.lightUpdate(),this._private__initialTimeScrollPos=null},i.prototype.serieses=function(){return this._private__serieses},i.prototype.setAndSaveCurrentPosition=function(e,t,r){this._private__crosshair.saveOriginCoord(e,t);var a=NaN,n=this._private__timeScale.coordinateToIndex(e),_=this._private__timeScale.visibleStrictRange();_!==null&&(n=Math.min(Math.max(_.left(),n),_.right()));var o=r.defaultPriceScale(),l=o.firstValue();l!==null&&(a=o.coordinateToPrice(t,l)),a=this._private__magnet._internal_align(a,n,r),this._private__crosshair.setPosition(n,a,r),this.cursorUpdate(),this._private__crosshairMoved._internal_fire(this._private__crosshair.appliedIndex(),{x:e,y:t})},i.prototype.clearCurrentPosition=function(){var e=this.crosshairSource();e.clearPosition(),this.cursorUpdate(),this._private__crosshairMoved._internal_fire(null,null)},i.prototype.updateCrosshair=function(){var e=this._private__crosshair.pane();if(e!==null){var t=this._private__crosshair.originCoordX(),r=this._private__crosshair.originCoordY();this.setAndSaveCurrentPosition(t,r,e)}this._private__crosshair.updateAllViews()},i.prototype.updateTimeScale=function(e,t,r){var a=this._private__timeScale.indexToTime(0);t!==void 0&&r!==void 0&&this._private__timeScale.update(t,r);var n=this._private__timeScale.indexToTime(0),_=this._private__timeScale.baseIndex(),o=this._private__timeScale.visibleStrictRange();if(o!==null&&a!==null&&n!==null){var l=o.contains(_),v=a.timestamp>n.timestamp,c=e!==null&&e>_,u=c&&!v,d=l&&this._private__timeScale.options().shiftVisibleRangeOnNewBar;if(u&&!d){var m=e-_;this._private__timeScale.setRightOffset(this._private__timeScale.rightOffset()-m)}}this._private__timeScale.setBaseIndex(e)},i.prototype.recalculatePane=function(e){e!==null&&e.recalculate()},i.prototype.paneForSource=function(e){var t=this._private__panes.find(function(r){return r.orderedSources().includes(e)});return t===void 0?null:t},i.prototype.recalculateAllPanes=function(){this._private__watermark.updateAllViews(),this._private__panes.forEach(function(e){return e.recalculate()}),this.updateCrosshair()},i.prototype.fireCustomPriceLineDragged=function(e,t){this._private__customPriceLineDragged._internal_fire(e,t)},i.prototype.destroy=function(){this._private__panes.forEach(function(e){return e.destroy()}),this._private__panes.length=0,this._private__options.localization.priceFormatter=void 0,this._private__options.localization.timeFormatter=void 0},i.prototype.rendererOptionsProvider=function(){return this._private__rendererOptionsProvider},i.prototype.priceAxisRendererOptions=function(){return this._private__rendererOptionsProvider.options()},i.prototype.priceScalesOptionsChanged=function(){return this._private__priceScalesOptionsChanged},i.prototype.createSeries=function(e,t){var r=this._private__panes[0],a=this._private__createSeries(t,e,r);return this._private__serieses.push(a),this._private__serieses.length===1?this.fullUpdate():this.lightUpdate(),a},i.prototype.removeSeries=function(e){var t=this.paneForSource(e),r=this._private__serieses.indexOf(e);re(r!==-1,"Series not found"),this._private__serieses.splice(r,1),C(t).removeDataSource(e),e.destroy&&e.destroy()},i.prototype.moveSeriesToScale=function(e,t){var r=C(this.paneForSource(e));r.removeDataSource(e);var a=this.findPriceScale(t);if(a===null){var n=e.zorder();r.addDataSource(e,t,n)}else{var n=a.pane===r?e.zorder():void 0;a.pane.addDataSource(e,t,n)}},i.prototype.fitContent=function(){var e=new ne(2);e.setFitContent(),this._private__invalidate(e)},i.prototype.setTargetLogicalRange=function(e){var t=new ne(2);t.applyRange(e),this._private__invalidate(t)},i.prototype.resetTimeScale=function(){var e=new ne(2);e.resetTimeScale(),this._private__invalidate(e)},i.prototype.setBarSpacing=function(e){var t=new ne(2);t.setBarSpacing(e),this._private__invalidate(t)},i.prototype.setRightOffset=function(e){var t=new ne(2);t.setRightOffset(e),this._private__invalidate(t)},i.prototype.defaultVisiblePriceScaleId=function(){return this._private__options.rightPriceScale.visible?"right":"left"},i.prototype.backgroundBottomColor=function(){return this._private__backgroundBottomColor},i.prototype.backgroundTopColor=function(){return this._private__backgroundTopColor},i.prototype.backgroundColorAtYPercentFromTop=function(e){var t=this._private__backgroundBottomColor,r=this._private__backgroundTopColor;if(t===r)return t;if(e=Math.max(0,Math.min(100,Math.round(e*100))),this._private__gradientColorsCache===null||this._private__gradientColorsCache._internal_topColor!==r||this._private__gradientColorsCache._internal_bottomColor!==t)this._private__gradientColorsCache={_internal_topColor:r,_internal_bottomColor:t,_internal_colors:new Map};else{var a=this._private__gradientColorsCache._internal_colors.get(e);if(a!==void 0)return a}var n=pn(r,t,e/100);return this._private__gradientColorsCache._internal_colors.set(e,n),n},i.prototype._private__paneInvalidationMask=function(e,t){var r=new ne(t);if(e!==null){var a=this._private__panes.indexOf(e);r.invalidatePane(a,{level:t})}return r},i.prototype._private__invalidationMaskForSource=function(e,t){return t===void 0&&(t=2),this._private__paneInvalidationMask(this.paneForSource(e),t)},i.prototype._private__invalidate=function(e){this._private__invalidateHandler&&this._private__invalidateHandler(e),this._private__panes.forEach(function(t){return t.grid().paneView().update()})},i.prototype._private__createSeries=function(e,t,r){var a=new kt(this,e,t),n=e.priceScaleId!==void 0?e.priceScaleId:this.defaultVisiblePriceScaleId();return r.addDataSource(a,n),Tt(n)||a.applyOptions(e),a},i.prototype._private__getBackgroundColor=function(e){var t=this._private__options.layout;return t.background.type==="gradient"?e===0?t.background.topColor:t.background.bottomColor:t.background.color},i}();function xr(i){i.borderColor!==void 0&&(i.borderUpColor=i.borderColor,i.borderDownColor=i.borderColor),i.wickColor!==void 0&&(i.wickUpColor=i.wickColor,i.wickDownColor=i.wickColor)}var Fi;(function(i){i[i.Disabled=0]="Disabled",i[i.Continuous=1]="Continuous",i[i.OnDataUpdate=2]="OnDataUpdate"})(Fi||(Fi={}));function ns(i){if(i>=1)return 0;for(var e=0;e<8;e++){var t=Math.round(i),r=Math.abs(t-i);if(r<1e-8)return e;i=i*10}return e}var Wi;(function(i){i[i.LastBar=0]="LastBar",i[i.LastVisible=1]="LastVisible"})(Wi||(Wi={}));var zi;(function(i){i.Solid="solid",i.VerticalGradient="gradient"})(zi||(zi={}));function _i(i){return!he(i)&&!Jt(i)}function Lr(i){return he(i)}function _s(i){return i.open===void 0&&i.value===void 0}function Rr(i){return i.open!==void 0||i.value!==void 0}var q=function(){function i(e,t){this._internal_w=e,this._internal_h=t}return i.prototype._internal_equals=function(e){return this._internal_w===e._internal_w&&this._internal_h===e._internal_h},i}();function St(i){return i.ownerDocument&&i.ownerDocument.defaultView&&i.ownerDocument.defaultView.devicePixelRatio||1}function ue(i){var e=C(i.getContext("2d"));return e.setTransform(1,0,0,1,0,0),e}function Dr(i,e){var t=i.createElement("canvas"),r=St(t);return t.style.width="".concat(e._internal_w,"px"),t.style.height="".concat(e._internal_h,"px"),t.width=e._internal_w*r,t.height=e._internal_h*r,t}function Re(i,e){var t=C(i.ownerDocument),r=t.createElement("canvas");i.appendChild(r);var a=Qa(r,{allowDownsampling:!1});return a.resizeCanvas({width:e._internal_w,height:e._internal_h}),a}function Nt(i,e){return i._internal_position-e._internal_position}function Ht(i,e,t){var r=(i._internal_position-e._internal_position)/(i._internal_time-e._internal_time);return Math.sign(r)*Math.min(Math.abs(r),t)}function ss(i,e){var t=Math.log(e);return Math.log(1*t/-i)/t}var os=function(){function i(e,t,r,a){this._private__position1=null,this._private__position2=null,this._private__position3=null,this._private__position4=null,this._private__animationStartPosition=null,this._private__durationMsecs=0,this._private__speedPxPerMsec=0,this._private__terminated=!1,this._private__minSpeed=e,this._private__maxSpeed=t,this._private__dumpingCoeff=r,this._private__minMove=a}return i.prototype._internal_addPosition=function(e,t){if(this._private__position1!==null){if(this._private__position1._internal_time===t){this._private__position1._internal_position=e;return}if(Math.abs(this._private__position1._internal_position-e)<this._private__minMove)return}this._private__position4=this._private__position3,this._private__position3=this._private__position2,this._private__position2=this._private__position1,this._private__position1={_internal_time:t,_internal_position:e}},i.prototype._internal_start=function(e,t){if(!(this._private__position1===null||this._private__position2===null)&&!(t-this._private__position1._internal_time>50)){var r=0,a=Ht(this._private__position1,this._private__position2,this._private__maxSpeed),n=Nt(this._private__position1,this._private__position2),_=[a],o=[n];if(r+=n,this._private__position3!==null){var l=Ht(this._private__position2,this._private__position3,this._private__maxSpeed);if(Math.sign(l)===Math.sign(a)){var v=Nt(this._private__position2,this._private__position3);if(_.push(l),o.push(v),r+=v,this._private__position4!==null){var c=Ht(this._private__position3,this._private__position4,this._private__maxSpeed);if(Math.sign(c)===Math.sign(a)){var u=Nt(this._private__position3,this._private__position4);_.push(c),o.push(u),r+=u}}}}for(var d=0,m=0;m<_.length;++m)d+=o[m]/r*_[m];Math.abs(d)<this._private__minSpeed||(this._private__animationStartPosition={_internal_position:e,_internal_time:t},this._private__speedPxPerMsec=d,this._private__durationMsecs=ss(Math.abs(d),this._private__dumpingCoeff))}},i.prototype._internal_getPosition=function(e){var t=C(this._private__animationStartPosition),r=e-t._internal_time;return t._internal_position+this._private__speedPxPerMsec*(Math.pow(this._private__dumpingCoeff,r)-1)/Math.log(this._private__dumpingCoeff)},i.prototype._internal_finished=function(e){return this._private__animationStartPosition===null||this._private__progressDuration(e)===this._private__durationMsecs},i.prototype._internal_terminated=function(){return this._private__terminated},i.prototype._internal_terminate=function(){this._private__terminated=!0},i.prototype._private__progressDuration=function(e){var t=C(this._private__animationStartPosition),r=e-t._internal_time;return Math.min(r,this._private__durationMsecs)},i}(),xt=typeof window<"u";function Ni(){return xt?window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1:!1}function Ut(){return xt?/iPhone|iPad|iPod/.test(window.navigator.platform):!1}function ls(){return xt?window.chrome!==void 0:!1}function ps(i){ls()&&i.addEventListener("mousedown",function(e){if(e.button===1)return e.preventDefault(),!1})}var si=function(){function i(e,t,r){var a=this;this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY},this._private__longTapTimeoutId=null,this._private__longTapActive=!1,this._private__mouseMoveStartPosition=null,this._private__touchMoveStartPosition=null,this._private__touchMoveExceededManhattanDistance=!1,this._private__cancelClick=!1,this._private__cancelTap=!1,this._private__unsubscribeOutsideMouseEvents=null,this._private__unsubscribeOutsideTouchEvents=null,this._private__unsubscribeMobileSafariEvents=null,this._private__unsubscribeMousemove=null,this._private__unsubscribeRootMouseEvents=null,this._private__unsubscribeRootTouchEvents=null,this._private__startPinchMiddlePoint=null,this._private__startPinchDistance=0,this._private__pinchPrevented=!1,this._private__preventTouchDragProcess=!1,this._private__mousePressed=!1,this._private__lastTouchEventTimeStamp=0,this._private__activeTouchId=null,this._private__acceptMouseLeave=!Ut(),this._private__onFirefoxOutsideMouseUp=function(n){a._private__mouseUpHandler(n)},this._private__onMobileSafariDoubleClick=function(n){if(a._private__firesTouchEvents(n)){var _=a._private__makeCompatEvent(n);if(++a._private__tapCount,a._private__tapTimeoutId&&a._private__tapCount>1){var o=a._private__touchMouseMoveWithDownInfo(ve(n),a._private__tapPosition)._internal_manhattanDistance;o<30&&!a._private__cancelTap&&a._private__processTouchEvent(_,a._private__handler._internal_doubleTapEvent),a._private__resetTapTimeout()}}else{var _=a._private__makeCompatEvent(n);if(++a._private__clickCount,a._private__clickTimeoutId&&a._private__clickCount>1){var o=a._private__touchMouseMoveWithDownInfo(ve(n),a._private__clickPosition)._internal_manhattanDistance;o<5&&!a._private__cancelClick&&a._private__processMouseEvent(_,a._private__handler._internal_mouseDoubleClickEvent),a._private__resetClickTimeout()}}},this._private__target=e,this._private__handler=t,this._private__options=r,this._private__init()}return i.prototype.destroy=function(){this._private__unsubscribeOutsideMouseEvents!==null&&(this._private__unsubscribeOutsideMouseEvents(),this._private__unsubscribeOutsideMouseEvents=null),this._private__unsubscribeOutsideTouchEvents!==null&&(this._private__unsubscribeOutsideTouchEvents(),this._private__unsubscribeOutsideTouchEvents=null),this._private__unsubscribeMousemove!==null&&(this._private__unsubscribeMousemove(),this._private__unsubscribeMousemove=null),this._private__unsubscribeRootMouseEvents!==null&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),this._private__unsubscribeRootTouchEvents!==null&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null),this._private__unsubscribeMobileSafariEvents!==null&&(this._private__unsubscribeMobileSafariEvents(),this._private__unsubscribeMobileSafariEvents=null),this._private__clearLongTapTimeout(),this._private__resetClickTimeout()},i.prototype._private__mouseEnterHandler=function(e){var t=this;this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove();var r=this._private__mouseMoveHandler.bind(this);if(this._private__unsubscribeMousemove=function(){t._private__target.removeEventListener("mousemove",r)},this._private__target.addEventListener("mousemove",r),!this._private__firesTouchEvents(e)){var a=this._private__makeCompatEvent(e);this._private__processMouseEvent(a,this._private__handler._internal_mouseEnterEvent),this._private__acceptMouseLeave=!0}},i.prototype._private__resetClickTimeout=function(){this._private__clickTimeoutId!==null&&clearTimeout(this._private__clickTimeoutId),this._private__clickCount=0,this._private__clickTimeoutId=null,this._private__clickPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}},i.prototype._private__resetTapTimeout=function(){this._private__tapTimeoutId!==null&&clearTimeout(this._private__tapTimeoutId),this._private__tapCount=0,this._private__tapTimeoutId=null,this._private__tapPosition={_internal_x:Number.NEGATIVE_INFINITY,_internal_y:Number.POSITIVE_INFINITY}},i.prototype._private__mouseMoveHandler=function(e){if(!(this._private__mousePressed||this._private__touchMoveStartPosition!==null)&&!this._private__firesTouchEvents(e)){var t=this._private__makeCompatEvent(e);this._private__processMouseEvent(t,this._private__handler._internal_mouseMoveEvent),this._private__acceptMouseLeave=!0}},i.prototype._private__touchMoveHandler=function(e){var t=Yt(e.changedTouches,C(this._private__activeTouchId));if(t!==null&&(this._private__lastTouchEventTimeStamp=ct(e),this._private__startPinchMiddlePoint===null&&!this._private__preventTouchDragProcess)){this._private__pinchPrevented=!0;var r=this._private__touchMouseMoveWithDownInfo(ve(t),C(this._private__touchMoveStartPosition)),a=r._internal_xOffset,n=r._internal_yOffset,_=r._internal_manhattanDistance;if(!(!this._private__touchMoveExceededManhattanDistance&&_<5)){if(!this._private__touchMoveExceededManhattanDistance){var o=a*.5,l=n>=o&&!this._private__options._internal_treatVertTouchDragAsPageScroll(),v=o>n&&!this._private__options._internal_treatHorzTouchDragAsPageScroll();!l&&!v&&(this._private__preventTouchDragProcess=!0),this._private__touchMoveExceededManhattanDistance=!0,this._private__cancelTap=!0,this._private__clearLongTapTimeout(),this._private__resetTapTimeout()}if(!this._private__preventTouchDragProcess){var c=this._private__makeCompatEvent(e,t);this._private__processTouchEvent(c,this._private__handler._internal_touchMoveEvent),Oe(e)}}}},i.prototype._private__mouseMoveWithDownHandler=function(e){if(e.button===0){var t=this._private__touchMouseMoveWithDownInfo(ve(e),C(this._private__mouseMoveStartPosition)),r=t._internal_manhattanDistance;if(r>=5&&(this._private__cancelClick=!0,this._private__resetClickTimeout()),this._private__cancelClick){var a=this._private__makeCompatEvent(e);this._private__processMouseEvent(a,this._private__handler._internal_pressedMouseMoveEvent)}}},i.prototype._private__touchMouseMoveWithDownInfo=function(e,t){var r=Math.abs(t._internal_x-e._internal_x),a=Math.abs(t._internal_y-e._internal_y),n=r+a;return{_internal_xOffset:r,_internal_yOffset:a,_internal_manhattanDistance:n}},i.prototype._private__touchEndHandler=function(e){var t=Yt(e.changedTouches,C(this._private__activeTouchId));if(t===null&&e.touches.length===0&&(t=e.changedTouches[0]),t!==null){this._private__activeTouchId=null,this._private__lastTouchEventTimeStamp=ct(e),this._private__clearLongTapTimeout(),this._private__touchMoveStartPosition=null,this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);var r=this._private__makeCompatEvent(e,t);if(this._private__processTouchEvent(r,this._private__handler._internal_touchEndEvent),++this._private__tapCount,this._private__tapTimeoutId&&this._private__tapCount>1){var a=this._private__touchMouseMoveWithDownInfo(ve(t),this._private__tapPosition)._internal_manhattanDistance;a<30&&!this._private__cancelTap&&this._private__processTouchEvent(r,this._private__handler._internal_doubleTapEvent),this._private__resetTapTimeout()}else this._private__cancelTap||(this._private__processTouchEvent(r,this._private__handler._internal_tapEvent),this._private__handler._internal_tapEvent&&Oe(e));this._private__tapCount===0&&Oe(e),e.touches.length===0&&this._private__longTapActive&&(this._private__longTapActive=!1,Oe(e))}},i.prototype._private__mouseUpHandler=function(e){if(e.button===0){var t=this._private__makeCompatEvent(e);if(this._private__mouseMoveStartPosition=null,this._private__mousePressed=!1,this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null),Ni()){var r=this._private__target.ownerDocument.documentElement;r.removeEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp)}if(!this._private__firesTouchEvents(e))if(this._private__processMouseEvent(t,this._private__handler._internal_mouseUpEvent),++this._private__clickCount,this._private__clickTimeoutId&&this._private__clickCount>1){var a=this._private__touchMouseMoveWithDownInfo(ve(e),this._private__clickPosition)._internal_manhattanDistance;a<5&&!this._private__cancelClick&&this._private__processMouseEvent(t,this._private__handler._internal_mouseDoubleClickEvent),this._private__resetClickTimeout()}else this._private__cancelClick||this._private__processMouseEvent(t,this._private__handler._internal_mouseClickEvent)}},i.prototype._private__clearLongTapTimeout=function(){this._private__longTapTimeoutId!==null&&(clearTimeout(this._private__longTapTimeoutId),this._private__longTapTimeoutId=null)},i.prototype._private__touchStartHandler=function(e){if(this._private__activeTouchId===null){var t=e.changedTouches[0];this._private__activeTouchId=t.identifier,this._private__lastTouchEventTimeStamp=ct(e);var r=this._private__target.ownerDocument.documentElement;this._private__cancelTap=!1,this._private__touchMoveExceededManhattanDistance=!1,this._private__preventTouchDragProcess=!1,this._private__touchMoveStartPosition=ve(t),this._private__unsubscribeRootTouchEvents&&(this._private__unsubscribeRootTouchEvents(),this._private__unsubscribeRootTouchEvents=null);{var a=this._private__touchMoveHandler.bind(this),n=this._private__touchEndHandler.bind(this);this._private__unsubscribeRootTouchEvents=function(){r.removeEventListener("touchmove",a),r.removeEventListener("touchend",n)},r.addEventListener("touchmove",a,{passive:!1}),r.addEventListener("touchend",n,{passive:!1}),this._private__clearLongTapTimeout(),this._private__longTapTimeoutId=setTimeout(this._private__longTapHandler.bind(this,e),240)}var _=this._private__makeCompatEvent(e,t);this._private__processTouchEvent(_,this._private__handler._internal_touchStartEvent),this._private__tapTimeoutId||(this._private__tapCount=0,this._private__tapTimeoutId=setTimeout(this._private__resetTapTimeout.bind(this),500),this._private__tapPosition=ve(t))}},i.prototype._private__mouseDownHandler=function(e){if(e.button===0){var t=this._private__target.ownerDocument.documentElement;Ni()&&t.addEventListener("mouseleave",this._private__onFirefoxOutsideMouseUp),this._private__cancelClick=!1,this._private__mouseMoveStartPosition=ve(e),this._private__unsubscribeRootMouseEvents&&(this._private__unsubscribeRootMouseEvents(),this._private__unsubscribeRootMouseEvents=null);{var r=this._private__mouseMoveWithDownHandler.bind(this),a=this._private__mouseUpHandler.bind(this);this._private__unsubscribeRootMouseEvents=function(){t.removeEventListener("mousemove",r),t.removeEventListener("mouseup",a)},t.addEventListener("mousemove",r),t.addEventListener("mouseup",a)}if(this._private__mousePressed=!0,!this._private__firesTouchEvents(e)){var n=this._private__makeCompatEvent(e);this._private__processMouseEvent(n,this._private__handler._internal_mouseDownEvent),this._private__clickTimeoutId||(this._private__clickCount=0,this._private__clickTimeoutId=setTimeout(this._private__resetClickTimeout.bind(this),500),this._private__clickPosition=ve(e))}}},i.prototype._private__init=function(){var e=this;this._private__target.addEventListener("mouseenter",this._private__mouseEnterHandler.bind(this)),this._private__target.addEventListener("touchcancel",this._private__clearLongTapTimeout.bind(this));{var t=this._private__target.ownerDocument,r=function(a){e._private__handler._internal_mouseDownOutsideEvent&&(a.target&&e._private__target.contains(a.target)||e._private__handler._internal_mouseDownOutsideEvent())};this._private__unsubscribeOutsideTouchEvents=function(){t.removeEventListener("touchstart",r)},this._private__unsubscribeOutsideMouseEvents=function(){t.removeEventListener("mousedown",r)},t.addEventListener("mousedown",r),t.addEventListener("touchstart",r,{passive:!0})}Ut()&&(this._private__unsubscribeMobileSafariEvents=function(){e._private__target.removeEventListener("dblclick",e._private__onMobileSafariDoubleClick)},this._private__target.addEventListener("dblclick",this._private__onMobileSafariDoubleClick)),this._private__target.addEventListener("mouseleave",this._private__mouseLeaveHandler.bind(this)),this._private__target.addEventListener("touchstart",this._private__touchStartHandler.bind(this),{passive:!0}),ps(this._private__target),this._private__target.addEventListener("mousedown",this._private__mouseDownHandler.bind(this)),this._private__initPinch(),this._private__target.addEventListener("touchmove",function(){},{passive:!1})},i.prototype._private__initPinch=function(){var e=this;this._private__handler._internal_pinchStartEvent===void 0&&this._private__handler._internal_pinchEvent===void 0&&this._private__handler._internal_pinchEndEvent===void 0||(this._private__target.addEventListener("touchstart",function(t){return e._private__checkPinchState(t.touches)},{passive:!0}),this._private__target.addEventListener("touchmove",function(t){if(!(t.touches.length!==2||e._private__startPinchMiddlePoint===null)&&e._private__handler._internal_pinchEvent!==void 0){var r=Hi(t.touches[0],t.touches[1]),a=r/e._private__startPinchDistance;e._private__handler._internal_pinchEvent(e._private__startPinchMiddlePoint,a),Oe(t)}},{passive:!1}),this._private__target.addEventListener("touchend",function(t){e._private__checkPinchState(t.touches)}))},i.prototype._private__checkPinchState=function(e){e.length===1&&(this._private__pinchPrevented=!1),e.length!==2||this._private__pinchPrevented||this._private__longTapActive?this._private__stopPinch():this._private__startPinch(e)},i.prototype._private__startPinch=function(e){var t=cs(this._private__target);this._private__startPinchMiddlePoint={_internal_x:(e[0].clientX-t.left+(e[1].clientX-t.left))/2,_internal_y:(e[0].clientY-t.top+(e[1].clientY-t.top))/2},this._private__startPinchDistance=Hi(e[0],e[1]),this._private__handler._internal_pinchStartEvent!==void 0&&this._private__handler._internal_pinchStartEvent(),this._private__clearLongTapTimeout()},i.prototype._private__stopPinch=function(){this._private__startPinchMiddlePoint!==null&&(this._private__startPinchMiddlePoint=null,this._private__handler._internal_pinchEndEvent!==void 0&&this._private__handler._internal_pinchEndEvent())},i.prototype._private__mouseLeaveHandler=function(e){if(this._private__unsubscribeMousemove&&this._private__unsubscribeMousemove(),!this._private__firesTouchEvents(e)&&this._private__acceptMouseLeave){var t=this._private__makeCompatEvent(e);this._private__processMouseEvent(t,this._private__handler._internal_mouseLeaveEvent),this._private__acceptMouseLeave=!Ut()}},i.prototype._private__longTapHandler=function(e){var t=Yt(e.touches,C(this._private__activeTouchId));if(t!==null){var r=this._private__makeCompatEvent(e,t);this._private__processTouchEvent(r,this._private__handler._internal_longTapEvent),this._private__cancelTap=!0,this._private__longTapActive=!0}},i.prototype._private__firesTouchEvents=function(e){return e.sourceCapabilities&&e.sourceCapabilities.firesTouchEvents!==void 0?e.sourceCapabilities.firesTouchEvents:ct(e)<this._private__lastTouchEventTimeStamp+500},i.prototype._private__processTouchEvent=function(e,t){t&&t.call(this._private__handler,e)},i.prototype._private__processMouseEvent=function(e,t){t&&t.call(this._private__handler,e)},i.prototype._private__makeCompatEvent=function(e,t){var r=t||e,a=this._private__target.getBoundingClientRect()||{left:0,top:0};return{_internal_clientX:r.clientX,_internal_clientY:r.clientY,_internal_pageX:r.pageX,_internal_pageY:r.pageY,_internal_screenX:r.screenX,_internal_screenY:r.screenY,_internal_localX:r.clientX-a.left,_internal_localY:r.clientY-a.top,_internal_ctrlKey:e.ctrlKey,_internal_altKey:e.altKey,_internal_shiftKey:e.shiftKey,_internal_metaKey:e.metaKey,_internal_isTouch:!e.type.startsWith("mouse")&&e.type!=="contextmenu"&&e.type!=="click",_internal_srcType:e.type,_internal_target:r.target,_internal_view:e.view,_internal_preventDefault:function(){e.type!=="touchstart"&&Oe(e)}}},i}();function cs(i){return i.getBoundingClientRect()||{left:0,top:0}}function Hi(i,e){var t=i.clientX-e.clientX,r=i.clientY-e.clientY;return Math.sqrt(t*t+r*r)}function Oe(i){i.cancelable&&i.preventDefault()}function ve(i){return{_internal_x:i.pageX,_internal_y:i.pageY}}function ct(i){return i.timeStamp||performance.now()}function Yt(i,e){for(var t=0;t<i.length;++t)if(i[t].identifier===e)return i[t];return null}var Ui=200,Yi=function(){function i(e,t,r,a){this._private__textWidthCache=new We(Ui),this._private__fontSize=0,this._private__color="",this._private__font="",this._private__keys=[],this._private__hash=new Map,this._private__fontSize=e,this._private__color=t,this._private__font=Le(e,r,a)}return i.prototype.destroy=function(){this._private__textWidthCache.reset(),this._private__keys=[],this._private__hash.clear()},i.prototype._internal_paintTo=function(e,t,r,a,n){var _=this._private__getLabelImage(e,t);if(n!=="left"){var o=St(e.canvas);r-=Math.floor(_._internal_textWidth*o)}a-=Math.floor(_._internal_height/2),e.drawImage(_._internal_canvas,r,a,_._internal_width,_._internal_height)},i.prototype._private__getLabelImage=function(e,t){var r=this,a;if(this._private__hash.has(t))a=se(this._private__hash.get(t));else{if(this._private__keys.length>=Ui){var n=se(this._private__keys.shift());this._private__hash.delete(n)}var _=St(e.canvas),o=Math.ceil(this._private__fontSize/4.5),l=Math.round(this._private__fontSize/10),v=Math.ceil(this._private__textWidthCache.measureText(e,t)),c=Zt(Math.round(v+o*2)),u=Zt(this._private__fontSize+o*2),d=Dr(document,new q(c,u));a={_internal_text:t,_internal_textWidth:Math.round(Math.max(1,v)),_internal_width:Math.ceil(c*_),_internal_height:Math.ceil(u*_),_internal_canvas:d},v!==0&&(this._private__keys.push(a._internal_text),this._private__hash.set(a._internal_text,a)),e=ue(a._internal_canvas),de(e,_,function(){e.font=r._private__font,e.fillStyle=r._private__color,e.fillText(t,0,u-o-l)})}return a},i}(),Xi=function(){function i(e,t,r,a){var n=this;this._private__priceScale=null,this._private__size=null,this._private__mousedown=!1,this._private__mouseDraggingCustomPriceLine=null,this._private__mouseDragFromPriceString="",this._private__widthCache=new We(50),this._private__tickMarksCache=new Yi(11,"#000"),this._private__color=null,this._private__font=null,this._private__prevOptimalWidth=0,this._private__isSettingSize=!1,this._private__canvasConfiguredHandler=function(){n._private__recreateTickMarksCache(n._private__rendererOptionsProvider.options()),n._private__isSettingSize||n._private__pane._internal_chart()._internal_model().lightUpdate()},this._private__topCanvasConfiguredHandler=function(){n._private__isSettingSize||n._private__pane._internal_chart()._internal_model().lightUpdate()},this._private__pane=e,this._private__options=t,this._private__rendererOptionsProvider=r,this._private__isLeft=a==="left",this._private__cell=document.createElement("div"),this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__cell.style.width="25px",this._private__cell.style.left="0",this._private__cell.style.position="relative",this._private__canvasBinding=Re(this._private__cell,new q(16,16)),this._private__canvasBinding.subscribeCanvasConfigured(this._private__canvasConfiguredHandler);var _=this._private__canvasBinding.canvas;_.style.position="absolute",_.style.zIndex="1",_.style.left="0",_.style.top="0",this._private__topCanvasBinding=Re(this._private__cell,new q(16,16)),this._private__topCanvasBinding.subscribeCanvasConfigured(this._private__topCanvasConfiguredHandler);var o=this._private__topCanvasBinding.canvas;o.style.position="absolute",o.style.zIndex="2",o.style.left="0",o.style.top="0";var l={_internal_mouseMoveEvent:this._private__mouseMoveEvent.bind(this),_internal_mouseDownEvent:this._private__mouseDownEvent.bind(this),_internal_touchStartEvent:this._private__mouseDownEvent.bind(this),_internal_pressedMouseMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_touchMoveEvent:this._private__pressedMouseMoveEvent.bind(this),_internal_mouseDownOutsideEvent:this._private__mouseDownOutsideEvent.bind(this),_internal_mouseUpEvent:this._private__mouseUpEvent.bind(this),_internal_touchEndEvent:this._private__mouseUpEvent.bind(this),_internal_mouseDoubleClickEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_doubleTapEvent:this._private__mouseDoubleClickEvent.bind(this),_internal_mouseEnterEvent:this._private__mouseEnterEvent.bind(this),_internal_mouseLeaveEvent:this._private__mouseLeaveEvent.bind(this)};this._private__mouseEventHandler=new si(this._private__topCanvasBinding.canvas,l,{_internal_treatVertTouchDragAsPageScroll:function(){return!1},_internal_treatHorzTouchDragAsPageScroll:function(){return!0}})}return i.prototype.destroy=function(){this._private__mouseEventHandler.destroy(),this._private__topCanvasBinding.unsubscribeCanvasConfigured(this._private__topCanvasConfiguredHandler),this._private__topCanvasBinding.destroy(),this._private__canvasBinding.unsubscribeCanvasConfigured(this._private__canvasConfiguredHandler),this._private__canvasBinding.destroy(),this._private__priceScale!==null&&this._private__priceScale.onMarksChanged().unsubscribeAll(this),this._private__priceScale=null,this._private__tickMarksCache.destroy()},i.prototype._internal_getElement=function(){return this._private__cell},i.prototype._internal_lineColor=function(){return C(this._private__priceScale).options().borderColor},i.prototype._internal_textColor=function(){return this._private__options.textColor},i.prototype._internal_fontSize=function(){return this._private__options.fontSize},i.prototype._internal_baseFont=function(){return Le(this._internal_fontSize(),this._private__options.fontFamily)},i.prototype._internal_rendererOptions=function(){var e=this._private__rendererOptionsProvider.options(),t=this._private__color!==e.color,r=this._private__font!==e.font;return(t||r)&&(this._private__recreateTickMarksCache(e),this._private__color=e.color),r&&(this._private__widthCache.reset(),this._private__font=e.font),e},i.prototype._internal_optimalWidth=function(){if(this._private__priceScale===null)return 0;var e=0,t=this._internal_rendererOptions(),r=ue(this._private__canvasBinding.canvas),a=this._private__priceScale.marks();r.font=this._internal_baseFont(),a.length>0&&(e=Math.max(this._private__widthCache.measureText(r,a[0].label),this._private__widthCache.measureText(r,a[a.length-1].label)));for(var n=this._private__backLabels(),_=n.length;_--;){var o=this._private__widthCache.measureText(r,n[_].text());o>e&&(e=o)}var l=this._private__priceScale.firstValue();if(l!==null&&this._private__size!==null){var v=this._private__priceScale.coordinateToPrice(1,l),c=this._private__priceScale.coordinateToPrice(this._private__size._internal_h-2,l);e=Math.max(e,this._private__widthCache.measureText(r,this._private__priceScale.formatPrice(Math.floor(Math.min(v,c))+.11111111111111,l)),this._private__widthCache.measureText(r,this._private__priceScale.formatPrice(Math.ceil(Math.max(v,c))-.11111111111111,l)))}var u=e||34,d=Math.ceil(t.borderSize+t.tickLength+t.paddingInner+t.paddingOuter+u);return d+=d%2,d},i.prototype._internal_setSize=function(e){if(e._internal_w<0||e._internal_h<0)throw new Error("Try to set invalid size to PriceAxisWidget "+JSON.stringify(e));(this._private__size===null||!this._private__size._internal_equals(e))&&(this._private__size=e,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__topCanvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__isSettingSize=!1,this._private__cell.style.width=e._internal_w+"px",this._private__cell.style.height=e._internal_h+"px",this._private__cell.style.minWidth=e._internal_w+"px")},i.prototype._internal_getWidth=function(){return C(this._private__size)._internal_w},i.prototype._internal_setPriceScale=function(e){this._private__priceScale!==e&&(this._private__priceScale!==null&&this._private__priceScale.onMarksChanged().unsubscribeAll(this),this._private__priceScale=e,e.onMarksChanged().subscribe(this._private__onMarksChanged.bind(this),this))},i.prototype._internal_priceScale=function(){return this._private__priceScale},i.prototype._internal_reset=function(){var e=this._private__pane._internal_state(),t=this._private__pane._internal_chart()._internal_model();t.resetPriceScale(e,C(this._internal_priceScale()))},i.prototype._internal_paint=function(e){if(this._private__size!==null){if(e!==1){var t=ue(this._private__canvasBinding.canvas);this._private__alignLabels(),this._private__drawBackground(t,this._private__canvasBinding.pixelRatio),this._private__drawBorder(t,this._private__canvasBinding.pixelRatio),this._private__drawTickMarks(t,this._private__canvasBinding.pixelRatio),this._private__drawBackLabels(t,this._private__canvasBinding.pixelRatio)}var r=ue(this._private__topCanvasBinding.canvas),a=this._private__size._internal_w,n=this._private__size._internal_h;de(r,this._private__topCanvasBinding.pixelRatio,function(){r.clearRect(0,0,a,n)}),this._private__drawCrosshairLabel(r,this._private__topCanvasBinding.pixelRatio)}},i.prototype._internal_getImage=function(){return this._private__canvasBinding.canvas},i.prototype._internal_update=function(){var e;(e=this._private__priceScale)===null||e===void 0||e.marks()},i.prototype._private__getDraggableCustomPriceLines=function(){for(var e=[],t=0,r=this._private__pane._internal_state().orderedSources();t<r.length;t++){var a=r[t];a instanceof kt&&e.push.apply(e,a.customPriceLines().filter(function(n){return n.options().draggable&&n.priceAxisView().isAxisLabelVisible()}))}return e},i.prototype._private__mouseHoveredCustomPriceLine=function(e){for(var t=this._internal_rendererOptions(),r=0,a=this._private__getDraggableCustomPriceLines();r<a.length;r++){var n=a[r],_=n.priceAxisView(),o=_.height(t,!1),l=_.getFixedCoordinate();if(l-o/2<=e&&e<=l+o/2)return n}return null},i.prototype._private__mouseMoveEvent=function(e){this._private__mouseHoveredCustomPriceLine(e._internal_localY)!==null?this._private__setCursor(2):this._private__setCursor(1)},i.prototype._private__mouseDownEvent=function(e){if(!(this._private__priceScale===null||this._private__priceScale.isEmpty())){this._private__mousedown=!0;var t=this._private__mouseHoveredCustomPriceLine(e._internal_localY);if(t){this._private__mouseDraggingCustomPriceLine=t;var r=t.options().price,a=C(this._private__priceScale.firstValue());this._private__mouseDragFromPriceString=this._private__priceScale.formatPrice(r,a),this._private__setCursor(3);return}if(this._private__pane._internal_chart()._internal_options().handleScale.axisPressedMouseMove.price){var n=this._private__pane._internal_chart()._internal_model(),_=this._private__pane._internal_state();n.startScalePrice(_,this._private__priceScale,e._internal_localY)}}},i.prototype._private__pressedMouseMoveEvent=function(e){if(this._private__priceScale!==null){var t=this._private__priceScale;if(this._private__mouseDraggingCustomPriceLine){var r=C(t.firstValue()),a=t.coordinateToPrice(e._internal_localY,r);this._private__mouseDraggingCustomPriceLine.applyOptions({price:a});return}if(this._private__pane._internal_chart()._internal_options().handleScale.axisPressedMouseMove.price){var n=this._private__pane._internal_chart()._internal_model(),_=this._private__pane._internal_state();n.scalePriceTo(_,t,e._internal_localY)}}},i.prototype._private__mouseDownOutsideEvent=function(){if(this._private__priceScale!==null&&this._private__mousedown){if(this._private__mousedown=!1,this._private__mouseDraggingCustomPriceLine=null,this._private__mouseDragFromPriceString="",!this._private__pane._internal_chart()._internal_options().handleScale.axisPressedMouseMove.price)return;var e=this._private__pane._internal_chart()._internal_model(),t=this._private__pane._internal_state(),r=this._private__priceScale;e.endScalePrice(t,r)}},i.prototype._private__mouseUpEvent=function(e){if(this._private__priceScale!==null){var t=this._private__pane._internal_chart()._internal_model();if(this._private__mousedown=!1,this._private__mouseDraggingCustomPriceLine){t.fireCustomPriceLineDragged(this._private__mouseDraggingCustomPriceLine,this._private__mouseDragFromPriceString),this._private__mouseDraggingCustomPriceLine=null,this._private__mouseDragFromPriceString="",this._private__setCursor(2);return}if(this._private__pane._internal_chart()._internal_options().handleScale.axisPressedMouseMove.price){var r=this._private__pane._internal_state();t.endScalePrice(r,this._private__priceScale)}}},i.prototype._private__mouseDoubleClickEvent=function(e){this._private__mouseHoveredCustomPriceLine(e._internal_localY)===null&&this._private__pane._internal_chart()._internal_options().handleScale.axisDoubleClickReset&&this._internal_reset()},i.prototype._private__mouseEnterEvent=function(e){if(this._private__priceScale!==null){if(this._private__mouseDraggingCustomPriceLine!==null){this._private__setCursor(3);return}if(this._private__mouseHoveredCustomPriceLine(e._internal_localY)!==null){this._private__setCursor(2);return}var t=this._private__pane._internal_chart()._internal_model();t.options().handleScale.axisPressedMouseMove.price&&!this._private__priceScale.isPercentage()&&!this._private__priceScale.isIndexedTo100()&&this._private__setCursor(1)}},i.prototype._private__mouseLeaveEvent=function(e){this._private__setCursor(0)},i.prototype._private__backLabels=function(){var e=this,t=[],r=this._private__priceScale===null?void 0:this._private__priceScale,a=function(n){for(var _=0;_<n.length;++_)for(var o=n[_],l=o.priceAxisViews(e._private__pane._internal_state(),r),v=0;v<l.length;v++)t.push(l[v])};return a(this._private__pane._internal_state().orderedSources()),t},i.prototype._private__drawBackground=function(e,t){var r=this;if(this._private__size!==null){var a=this._private__size._internal_w,n=this._private__size._internal_h;de(e,t,function(){var _=r._private__pane._internal_state().model(),o=_.backgroundTopColor(),l=_.backgroundBottomColor();o===l?Pt(e,0,0,a,n,o):cr(e,0,0,a,n,o,l)})}},i.prototype._private__drawBorder=function(e,t){if(!(this._private__size===null||this._private__priceScale===null||!this._private__priceScale.options().borderVisible)){e.save(),e.fillStyle=this._internal_lineColor();var r=Math.max(1,Math.floor(this._internal_rendererOptions().borderSize*t)),a;this._private__isLeft?a=Math.floor(this._private__size._internal_w*t)-r:a=0,e.fillRect(a,0,r,Math.ceil(this._private__size._internal_h*t)),e.restore()}},i.prototype._private__drawTickMarks=function(e,t){if(!(this._private__size===null||this._private__priceScale===null)){var r=this._private__priceScale.marks();e.save(),e.strokeStyle=this._internal_lineColor(),e.font=this._internal_baseFont(),e.fillStyle=this._internal_lineColor();var a=this._internal_rendererOptions(),n=this._private__priceScale.options().borderVisible&&this._private__priceScale.options().drawTicks,_=this._private__isLeft?Math.floor((this._private__size._internal_w-a.tickLength)*t-a.borderSize*t):Math.floor(a.borderSize*t),o=this._private__isLeft?Math.round(_-a.paddingInner*t):Math.round(_+a.tickLength*t+a.paddingInner*t),l=this._private__isLeft?"right":"left",v=Math.max(1,Math.floor(t)),c=Math.floor(t*.5);if(n){var u=Math.round(a.tickLength*t);e.beginPath();for(var d=0,m=r;d<m.length;d++){var g=m[d];e.rect(_,Math.round(g.coord*t)-c,u,v)}e.fill()}e.fillStyle=this._internal_textColor();for(var S=0,y=r;S<y.length;S++){var g=y[S];this._private__tickMarksCache._internal_paintTo(e,g.label,o,Math.round(g.coord*t),l)}e.restore()}},i.prototype._private__alignLabels=function(){if(!(this._private__size===null||this._private__priceScale===null)){var e=this._private__size._internal_h/2,t=[],r=this._private__priceScale.orderedSources().slice(),a=this._private__pane,n=a._internal_state(),_=this._internal_rendererOptions(),o=this._private__priceScale===n.defaultVisiblePriceScale();o&&this._private__pane._internal_state().orderedSources().forEach(function(E){n.isOverlay(E)&&r.push(E)});var l=this._private__priceScale.dataSources()[0],v=this._private__priceScale,c=function(E){E.forEach(function(W){var H=W.priceAxisViews(n,v);H.forEach(function(G){G.setFixedCoordinate(null),G.isVisible()&&t.push(G)}),l===W&&H.length>0&&(e=H[0].coordinate())})};c(r);var u=t.filter(function(E){return E.coordinate()<=e}),d=t.filter(function(E){return E.coordinate()>e});u.sort(function(E,W){return W.coordinate()-E.coordinate()}),u.length&&d.length&&d.push(u[0]),d.sort(function(E,W){return E.coordinate()-W.coordinate()}),t.forEach(function(E){return E.setFixedCoordinate(E.coordinate())});var m=this._private__priceScale.options();if(m.alignLabels){for(var g=1;g<u.length;g++){var S=u[g],y=u[g-1],b=y.height(_,!1),x=S.coordinate(),D=y.getFixedCoordinate();x>D-b&&S.setFixedCoordinate(D-b)}for(var V=1;V<d.length;V++){var S=d[V],y=d[V-1],b=y.height(_,!0),x=S.coordinate(),D=y.getFixedCoordinate();x<D+b&&S.setFixedCoordinate(D+b)}}}},i.prototype._private__drawBackLabels=function(e,t){var r=this;if(this._private__size!==null){e.save();var a=this._private__size,n=this._private__backLabels(),_=this._internal_rendererOptions(),o=this._private__isLeft?"right":"left";n.forEach(function(l){if(l.isAxisLabelVisible()){var v=l.renderer(C(r._private__priceScale));e.save(),v.draw(e,_,r._private__widthCache,a._internal_w,o,t),e.restore()}}),e.restore()}},i.prototype._private__drawCrosshairLabel=function(e,t){var r=this;if(!(this._private__size===null||this._private__priceScale===null)){e.save();var a=this._private__size,n=this._private__pane._internal_chart()._internal_model(),_=[],o=this._private__pane._internal_state(),l=n.crosshairSource().priceAxisViews(o,this._private__priceScale);l.length&&_.push(l);var v=this._internal_rendererOptions(),c=this._private__isLeft?"right":"left";_.forEach(function(u){u.forEach(function(d){e.save(),d.renderer(C(r._private__priceScale)).draw(e,v,r._private__widthCache,a._internal_w,c,t),e.restore()})}),e.restore()}},i.prototype._private__setCursor=function(e){var t="default";e===1?t="ns-resize":e===2?t="grab":e===3&&(t="grabbing"),this._private__cell.style.cursor=t},i.prototype._private__onMarksChanged=function(){var e=this._internal_optimalWidth();this._private__prevOptimalWidth<e&&this._private__pane._internal_chart()._internal_model().fullUpdate(),this._private__prevOptimalWidth=e},i.prototype._private__recreateTickMarksCache=function(e){this._private__tickMarksCache.destroy(),this._private__tickMarksCache=new Yi(e.fontSize,e.color,e.fontFamily)},i}();function $i(i,e,t,r,a){i.drawBackground&&i.drawBackground(e,t,r,a)}function Xt(i,e,t,r,a){i.draw(e,t,r,a)}function vt(i,e){return i.paneViews(e)}function vs(i,e){return i.topPaneViews!==void 0?i.topPaneViews(e):[]}var hs=function(){function i(e,t){var r=this;this._private__size=new q(0,0),this._private__leftPriceAxisWidget=null,this._private__rightPriceAxisWidget=null,this._private__startScrollingPos=null,this._private__isScrolling=!1,this._private__clicked=new U,this._private__prevPinchScale=0,this._private__longTap=!1,this._private__startTrackPoint=null,this._private__exitTrackingModeOnNextTry=!1,this._private__initCrosshairPosition=null,this._private__scrollXAnimation=null,this._private__isSettingSize=!1,this._private__canvasConfiguredHandler=function(){r._private__isSettingSize||r._private__state===null||r._private__model().lightUpdate()},this._private__topCanvasConfiguredHandler=function(){r._private__isSettingSize||r._private__state===null||r._private__model().lightUpdate()},this._private__chart=e,this._private__state=t,this._private__state.onDestroyed().subscribe(this._private__onStateDestroyed.bind(this),this,!0),this._private__paneCell=document.createElement("td"),this._private__paneCell.style.padding="0",this._private__paneCell.style.position="relative";var a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.position="relative",a.style.overflow="hidden",this._private__leftAxisCell=document.createElement("td"),this._private__leftAxisCell.style.padding="0",this._private__rightAxisCell=document.createElement("td"),this._private__rightAxisCell.style.padding="0",this._private__paneCell.appendChild(a),this._private__canvasBinding=Re(a,new q(16,16)),this._private__canvasBinding.subscribeCanvasConfigured(this._private__canvasConfiguredHandler);var n=this._private__canvasBinding.canvas;n.style.position="absolute",n.style.zIndex="1",n.style.left="0",n.style.top="0",this._private__topCanvasBinding=Re(a,new q(16,16)),this._private__topCanvasBinding.subscribeCanvasConfigured(this._private__topCanvasConfiguredHandler);var _=this._private__topCanvasBinding.canvas;_.style.position="absolute",_.style.zIndex="2",_.style.left="0",_.style.top="0",this._private__rowElement=document.createElement("tr"),this._private__rowElement.appendChild(this._private__leftAxisCell),this._private__rowElement.appendChild(this._private__paneCell),this._private__rowElement.appendChild(this._private__rightAxisCell),this._internal_updatePriceAxisWidgetsStates(),this._private__mouseEventHandler=new si(this._private__topCanvasBinding.canvas,this,{_internal_treatVertTouchDragAsPageScroll:function(){return r._private__startTrackPoint===null&&!r._private__chart._internal_options().handleScroll.vertTouchDrag},_internal_treatHorzTouchDragAsPageScroll:function(){return r._private__startTrackPoint===null&&!r._private__chart._internal_options().handleScroll.horzTouchDrag}})}return i.prototype.destroy=function(){this._private__leftPriceAxisWidget!==null&&this._private__leftPriceAxisWidget.destroy(),this._private__rightPriceAxisWidget!==null&&this._private__rightPriceAxisWidget.destroy(),this._private__topCanvasBinding.unsubscribeCanvasConfigured(this._private__topCanvasConfiguredHandler),this._private__topCanvasBinding.destroy(),this._private__canvasBinding.unsubscribeCanvasConfigured(this._private__canvasConfiguredHandler),this._private__canvasBinding.destroy(),this._private__state!==null&&this._private__state.onDestroyed().unsubscribeAll(this),this._private__mouseEventHandler.destroy()},i.prototype._internal_state=function(){return C(this._private__state)},i.prototype._internal_setState=function(e){this._private__state!==null&&this._private__state.onDestroyed().unsubscribeAll(this),this._private__state=e,this._private__state!==null&&this._private__state.onDestroyed().subscribe(i.prototype._private__onStateDestroyed.bind(this),this,!0),this._internal_updatePriceAxisWidgetsStates()},i.prototype._internal_chart=function(){return this._private__chart},i.prototype._internal_getElement=function(){return this._private__rowElement},i.prototype._internal_updatePriceAxisWidgetsStates=function(){if(this._private__state!==null&&(this._private__recreatePriceAxisWidgets(),this._private__model().serieses().length!==0)){if(this._private__leftPriceAxisWidget!==null){var e=this._private__state.leftPriceScale();this._private__leftPriceAxisWidget._internal_setPriceScale(C(e))}if(this._private__rightPriceAxisWidget!==null){var t=this._private__state.rightPriceScale();this._private__rightPriceAxisWidget._internal_setPriceScale(C(t))}}},i.prototype._internal_updatePriceAxisWidgets=function(){this._private__leftPriceAxisWidget!==null&&this._private__leftPriceAxisWidget._internal_update(),this._private__rightPriceAxisWidget!==null&&this._private__rightPriceAxisWidget._internal_update()},i.prototype._internal_stretchFactor=function(){return this._private__state!==null?this._private__state.stretchFactor():0},i.prototype._internal_setStretchFactor=function(e){this._private__state&&this._private__state.setStretchFactor(e)},i.prototype._internal_mouseEnterEvent=function(e){if(this._private__state){this._private__onMouseEvent();var t=e._internal_localX,r=e._internal_localY;this._private__setCrosshairPosition(t,r)}},i.prototype._internal_mouseDownEvent=function(e){this._private__onMouseEvent(),this._private__mouseTouchDownEvent(),this._private__setCrosshairPosition(e._internal_localX,e._internal_localY)},i.prototype._internal_mouseMoveEvent=function(e){if(this._private__state){this._private__onMouseEvent();var t=e._internal_localX,r=e._internal_localY;this._private__setCrosshairPosition(t,r);var a=this._internal_hitTest(t,r);this._private__model().setHoveredSource(a&&{source:a._internal_source,object:a._internal_object})}},i.prototype._internal_mouseClickEvent=function(e){if(this._private__state!==null){this._private__onMouseEvent();var t=e._internal_localX,r=e._internal_localY;if(this._private__clicked._internal_hasListeners()){var a=this._private__model().crosshairSource().appliedIndex();this._private__clicked._internal_fire(a,{x:t,y:r})}}},i.prototype._internal_pressedMouseMoveEvent=function(e){this._private__onMouseEvent(),this._private__pressedMouseTouchMoveEvent(e),this._private__setCrosshairPosition(e._internal_localX,e._internal_localY)},i.prototype._internal_mouseUpEvent=function(e){this._private__state!==null&&(this._private__onMouseEvent(),this._private__longTap=!1,this._private__endScroll(e))},i.prototype._internal_longTapEvent=function(e){if(this._private__longTap=!0,this._private__startTrackPoint===null){var t={x:e._internal_localX,y:e._internal_localY};this._private__startTrackingMode(t,t)}},i.prototype._internal_mouseLeaveEvent=function(e){this._private__state!==null&&(this._private__onMouseEvent(),this._private__state.model().setHoveredSource(null),this._private__clearCrosshairPosition())},i.prototype._internal_clicked=function(){return this._private__clicked},i.prototype._internal_pinchStartEvent=function(){this._private__prevPinchScale=1,this._private__terminateKineticAnimation()},i.prototype._internal_pinchEvent=function(e,t){if(this._private__chart._internal_options().handleScale.pinch){var r=(t-this._private__prevPinchScale)*5;this._private__prevPinchScale=t,this._private__model().zoomTime(e._internal_x,r)}},i.prototype._internal_touchStartEvent=function(e){if(this._private__longTap=!1,this._private__exitTrackingModeOnNextTry=this._private__startTrackPoint!==null,this._private__mouseTouchDownEvent(),this._private__startTrackPoint!==null){var t=this._private__model().crosshairSource();this._private__initCrosshairPosition={x:t.appliedX(),y:t.appliedY()},this._private__startTrackPoint={x:e._internal_localX,y:e._internal_localY}}},i.prototype._internal_touchMoveEvent=function(e){if(this._private__state!==null){var t=e._internal_localX,r=e._internal_localY;if(this._private__startTrackPoint!==null){this._private__exitTrackingModeOnNextTry=!1;var a=C(this._private__initCrosshairPosition),n=a.x+(t-this._private__startTrackPoint.x),_=a.y+(r-this._private__startTrackPoint.y);this._private__setCrosshairPosition(n,_);return}this._private__pressedMouseTouchMoveEvent(e)}},i.prototype._internal_touchEndEvent=function(e){this._internal_chart()._internal_options().trackingMode.exitMode===0&&(this._private__exitTrackingModeOnNextTry=!0),this._private__tryExitTrackingMode(),this._private__endScroll(e)},i.prototype._internal_hitTest=function(e,t){var r=this._private__state;if(r===null)return null;for(var a=r.orderedSources(),n=0,_=a;n<_.length;n++){var o=_[n],l=this._private__hitTestPaneView(o.paneViews(r),e,t);if(l!==null)return{_internal_source:o,_internal_view:l._internal_view,_internal_object:l._internal_object}}return null},i.prototype._internal_setPriceAxisSize=function(e,t){var r=t==="left"?this._private__leftPriceAxisWidget:this._private__rightPriceAxisWidget;C(r)._internal_setSize(new q(e,this._private__size._internal_h))},i.prototype._internal_getSize=function(){return this._private__size},i.prototype._internal_setSize=function(e){if(e._internal_w<0||e._internal_h<0)throw new Error("Try to set invalid size to PaneWidget "+JSON.stringify(e));this._private__size._internal_equals(e)||(this._private__size=e,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__topCanvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__isSettingSize=!1,this._private__paneCell.style.width=e._internal_w+"px",this._private__paneCell.style.height=e._internal_h+"px")},i.prototype._internal_recalculatePriceScales=function(){var e=C(this._private__state);e.recalculatePriceScale(e.leftPriceScale()),e.recalculatePriceScale(e.rightPriceScale());for(var t=0,r=e.dataSources();t<r.length;t++){var a=r[t];if(e.isOverlay(a)){var n=a.priceScale();n!==null&&e.recalculatePriceScale(n),a.updateAllViews()}}},i.prototype._internal_getImage=function(){return this._private__canvasBinding.canvas},i.prototype._internal_paint=function(e){if(e!==0&&this._private__state!==null){if(e>1&&this._internal_recalculatePriceScales(),this._private__leftPriceAxisWidget!==null&&this._private__leftPriceAxisWidget._internal_paint(e),this._private__rightPriceAxisWidget!==null&&this._private__rightPriceAxisWidget._internal_paint(e),e!==1){var t=ue(this._private__canvasBinding.canvas);t.save(),this._private__drawBackground(t,this._private__canvasBinding.pixelRatio),this._private__state&&(this._private__drawGrid(t,this._private__canvasBinding.pixelRatio),this._private__drawWatermark(t,this._private__canvasBinding.pixelRatio),this._private__drawSources(t,this._private__canvasBinding.pixelRatio,vt)),t.restore()}var r=ue(this._private__topCanvasBinding.canvas);r.clearRect(0,0,Math.ceil(this._private__size._internal_w*this._private__topCanvasBinding.pixelRatio),Math.ceil(this._private__size._internal_h*this._private__topCanvasBinding.pixelRatio)),this._private__drawSources(r,this._private__canvasBinding.pixelRatio,vs),this._private__drawCrosshair(r,this._private__topCanvasBinding.pixelRatio)}},i.prototype._internal_leftPriceAxisWidget=function(){return this._private__leftPriceAxisWidget},i.prototype._internal_rightPriceAxisWidget=function(){return this._private__rightPriceAxisWidget},i.prototype._private__onStateDestroyed=function(){this._private__state!==null&&this._private__state.onDestroyed().unsubscribeAll(this),this._private__state=null},i.prototype._private__drawBackground=function(e,t){var r=this;de(e,t,function(){var a=r._private__model(),n=a.backgroundTopColor(),_=a.backgroundBottomColor();n===_?Pt(e,0,0,r._private__size._internal_w,r._private__size._internal_h,_):cr(e,0,0,r._private__size._internal_w,r._private__size._internal_h,n,_)})},i.prototype._private__drawGrid=function(e,t){var r=C(this._private__state),a=r.grid().paneView(),n=a.renderer(r.height(),r.width());n!==null&&(e.save(),n.draw(e,t,!1),e.restore())},i.prototype._private__drawWatermark=function(e,t){var r=this._private__model().watermarkSource();this._private__drawSourceImpl(e,t,vt,$i,r),this._private__drawSourceImpl(e,t,vt,Xt,r)},i.prototype._private__drawCrosshair=function(e,t){this._private__drawSourceImpl(e,t,vt,Xt,this._private__model().crosshairSource())},i.prototype._private__drawSources=function(e,t,r){for(var a=C(this._private__state),n=a.orderedSources(),_=0,o=n;_<o.length;_++){var l=o[_];this._private__drawSourceImpl(e,t,r,$i,l)}for(var v=0,c=n;v<c.length;v++){var l=c[v];this._private__drawSourceImpl(e,t,r,Xt,l)}},i.prototype._private__drawSourceImpl=function(e,t,r,a,n){for(var _=C(this._private__state),o=r(n,_),l=_.height(),v=_.width(),c=_.model().hoveredSource(),u=c!==null&&c.source===n,d=c!==null&&u&&c.object!==void 0?c.object.hitTestData:void 0,m=0,g=o;m<g.length;m++){var S=g[m],y=S.renderer(l,v);y!==null&&(e.save(),a(y,e,t,u,d),e.restore())}},i.prototype._private__hitTestPaneView=function(e,t,r){for(var a=0,n=e;a<n.length;a++){var _=n[a],o=_.renderer(this._private__size._internal_h,this._private__size._internal_w);if(o!==null&&o.hitTest){var l=o.hitTest(t,r);if(l!==null)return{_internal_view:_,_internal_object:l}}}return null},i.prototype._private__recreatePriceAxisWidgets=function(){if(this._private__state!==null){var e=this._private__chart,t=this._private__state.leftPriceScale().options().visible,r=this._private__state.rightPriceScale().options().visible;!t&&this._private__leftPriceAxisWidget!==null&&(this._private__leftAxisCell.removeChild(this._private__leftPriceAxisWidget._internal_getElement()),this._private__leftPriceAxisWidget.destroy(),this._private__leftPriceAxisWidget=null),!r&&this._private__rightPriceAxisWidget!==null&&(this._private__rightAxisCell.removeChild(this._private__rightPriceAxisWidget._internal_getElement()),this._private__rightPriceAxisWidget.destroy(),this._private__rightPriceAxisWidget=null);var a=e._internal_model().rendererOptionsProvider();t&&this._private__leftPriceAxisWidget===null&&(this._private__leftPriceAxisWidget=new Xi(this,e._internal_options().layout,a,"left"),this._private__leftAxisCell.appendChild(this._private__leftPriceAxisWidget._internal_getElement())),r&&this._private__rightPriceAxisWidget===null&&(this._private__rightPriceAxisWidget=new Xi(this,e._internal_options().layout,a,"right"),this._private__rightAxisCell.appendChild(this._private__rightPriceAxisWidget._internal_getElement()))}},i.prototype._private__preventScroll=function(e){return e._internal_isTouch&&this._private__longTap||this._private__startTrackPoint!==null},i.prototype._private__correctXCoord=function(e){return Math.max(0,Math.min(e,this._private__size._internal_w-1))},i.prototype._private__correctYCoord=function(e){return Math.max(0,Math.min(e,this._private__size._internal_h-1))},i.prototype._private__setCrosshairPosition=function(e,t){this._private__model().setAndSaveCurrentPosition(this._private__correctXCoord(e),this._private__correctYCoord(t),C(this._private__state))},i.prototype._private__clearCrosshairPosition=function(){this._private__model().clearCurrentPosition()},i.prototype._private__tryExitTrackingMode=function(){this._private__exitTrackingModeOnNextTry&&(this._private__startTrackPoint=null,this._private__clearCrosshairPosition())},i.prototype._private__startTrackingMode=function(e,t){this._private__startTrackPoint=e,this._private__exitTrackingModeOnNextTry=!1,this._private__setCrosshairPosition(t.x,t.y);var r=this._private__model().crosshairSource();this._private__initCrosshairPosition={x:r.appliedX(),y:r.appliedY()}},i.prototype._private__model=function(){return this._private__chart._internal_model()},i.prototype._private__finishScroll=function(){var e=this._private__model(),t=this._internal_state(),r=t.defaultPriceScale();e.endScrollPrice(t,r),e.endScrollTime(),this._private__startScrollingPos=null,this._private__isScrolling=!1},i.prototype._private__endScroll=function(e){var t=this;if(this._private__isScrolling){var r=performance.now();if(this._private__scrollXAnimation!==null&&this._private__scrollXAnimation._internal_start(e._internal_localX,r),this._private__scrollXAnimation===null||this._private__scrollXAnimation._internal_finished(r)){this._private__finishScroll();return}var a=this._private__model(),n=a.timeScale(),_=this._private__scrollXAnimation,o=function(){if(!_._internal_terminated()){var l=performance.now(),v=_._internal_finished(l);if(!_._internal_terminated()){var c=n.rightOffset();a.scrollTimeTo(_._internal_getPosition(l)),c===n.rightOffset()&&(v=!0,t._private__scrollXAnimation=null)}if(v){t._private__finishScroll();return}requestAnimationFrame(o)}};requestAnimationFrame(o)}},i.prototype._private__onMouseEvent=function(){this._private__startTrackPoint=null},i.prototype._private__mouseTouchDownEvent=function(){if(this._private__state){if(this._private__terminateKineticAnimation(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)C(document.activeElement).blur();else{var e=document.getSelection();e!==null&&e.removeAllRanges()}var t=this._private__state.defaultPriceScale();t.isEmpty()||this._private__model().timeScale().isEmpty()}},i.prototype._private__pressedMouseTouchMoveEvent=function(e){if(this._private__state!==null){var t=this._private__model();if(!t.timeScale().isEmpty()){var r=this._private__chart._internal_options(),a=r.handleScroll,n=r.kineticScroll;if(!((!a.pressedMouseMove||e._internal_isTouch)&&(!a.horzTouchDrag&&!a.vertTouchDrag||!e._internal_isTouch))){var _=this._private__state.defaultPriceScale(),o=performance.now();this._private__startScrollingPos===null&&!this._private__preventScroll(e)&&(this._private__startScrollingPos={x:e._internal_clientX,y:e._internal_clientY,_internal_timestamp:o,_internal_localX:e._internal_localX,_internal_localY:e._internal_localY}),this._private__scrollXAnimation!==null&&this._private__scrollXAnimation._internal_addPosition(e._internal_localX,o),this._private__startScrollingPos!==null&&!this._private__isScrolling&&(this._private__startScrollingPos.x!==e._internal_clientX||this._private__startScrollingPos.y!==e._internal_clientY)&&(this._private__scrollXAnimation===null&&(e._internal_isTouch&&n.touch||!e._internal_isTouch&&n.mouse)&&(this._private__scrollXAnimation=new os(.2,7,.997,15),this._private__scrollXAnimation._internal_addPosition(this._private__startScrollingPos._internal_localX,this._private__startScrollingPos._internal_timestamp),this._private__scrollXAnimation._internal_addPosition(e._internal_localX,o)),_.isEmpty()||t.startScrollPrice(this._private__state,_,e._internal_localY),t.startScrollTime(e._internal_localX),this._private__isScrolling=!0),this._private__isScrolling&&(_.isEmpty()||t.scrollPriceTo(this._private__state,_,e._internal_localY),t.scrollTimeTo(e._internal_localX))}}}},i.prototype._private__terminateKineticAnimation=function(){var e=performance.now(),t=this._private__scrollXAnimation===null||this._private__scrollXAnimation._internal_finished(e);this._private__scrollXAnimation!==null&&(t||this._private__finishScroll()),this._private__scrollXAnimation!==null&&(this._private__scrollXAnimation._internal_terminate(),this._private__scrollXAnimation=null)},i}(),qi=function(){function i(e,t,r,a,n){var _=this;this._private__invalidated=!0,this._private__size=new q(0,0),this._private__canvasConfiguredHandler=function(){return _._internal_paint(3)},this._private__isLeft=e==="left",this._private__rendererOptionsProvider=r._internal_rendererOptionsProvider,this._private__options=t,this._private__borderVisible=a,this._private__bottomColor=n,this._private__cell=document.createElement("div"),this._private__cell.style.width="25px",this._private__cell.style.height="100%",this._private__cell.style.overflow="hidden",this._private__canvasBinding=Re(this._private__cell,new q(16,16)),this._private__canvasBinding.subscribeCanvasConfigured(this._private__canvasConfiguredHandler)}return i.prototype.destroy=function(){this._private__canvasBinding.unsubscribeCanvasConfigured(this._private__canvasConfiguredHandler),this._private__canvasBinding.destroy()},i.prototype._internal_getElement=function(){return this._private__cell},i.prototype._internal_getSize=function(){return this._private__size},i.prototype._internal_setSize=function(e){if(e._internal_w<0||e._internal_h<0)throw new Error("Try to set invalid size to PriceAxisStub "+JSON.stringify(e));this._private__size._internal_equals(e)||(this._private__size=e,this._private__canvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__cell.style.width="".concat(e._internal_w,"px"),this._private__cell.style.minWidth="".concat(e._internal_w,"px"),this._private__cell.style.height="".concat(e._internal_h,"px"),this._private__invalidated=!0)},i.prototype._internal_paint=function(e){if(!(e<3&&!this._private__invalidated)&&!(this._private__size._internal_w===0||this._private__size._internal_h===0)){this._private__invalidated=!1;var t=ue(this._private__canvasBinding.canvas);this._private__drawBackground(t,this._private__canvasBinding.pixelRatio),this._private__drawBorder(t,this._private__canvasBinding.pixelRatio)}},i.prototype._internal_getImage=function(){return this._private__canvasBinding.canvas},i.prototype._private__drawBorder=function(e,t){if(this._private__borderVisible()){var r=this._private__size._internal_w;e.save(),e.fillStyle=this._private__options.timeScale.borderColor;var a=Math.floor(this._private__rendererOptionsProvider.options().borderSize*t),n=this._private__isLeft?Math.round(r*t)-a:0;e.fillRect(n,0,a,a),e.restore()}},i.prototype._private__drawBackground=function(e,t){var r=this;de(e,t,function(){Pt(e,0,0,r._private__size._internal_w,r._private__size._internal_h,r._private__bottomColor())})},i}();function us(i,e){return i.weight>e.weight?i:e}var ds=function(){function i(e){var t=this;this._private__leftStub=null,this._private__rightStub=null,this._private__rendererOptions=null,this._private__mouseDown=!1,this._private__size=new q(0,0),this._private__sizeChanged=new U,this._private__widthCache=new We(5),this._private__isSettingSize=!1,this._private__canvasConfiguredHandler=function(){t._private__isSettingSize||t._private__chart._internal_model().lightUpdate()},this._private__topCanvasConfiguredHandler=function(){t._private__isSettingSize||t._private__chart._internal_model().lightUpdate()},this._private__chart=e,this._private__options=e._internal_options().layout,this._private__element=document.createElement("tr"),this._private__leftStubCell=document.createElement("td"),this._private__leftStubCell.style.padding="0",this._private__rightStubCell=document.createElement("td"),this._private__rightStubCell.style.padding="0",this._private__cell=document.createElement("td"),this._private__cell.style.height="25px",this._private__cell.style.padding="0",this._private__dv=document.createElement("div"),this._private__dv.style.width="100%",this._private__dv.style.height="100%",this._private__dv.style.position="relative",this._private__dv.style.overflow="hidden",this._private__cell.appendChild(this._private__dv),this._private__canvasBinding=Re(this._private__dv,new q(16,16)),this._private__canvasBinding.subscribeCanvasConfigured(this._private__canvasConfiguredHandler);var r=this._private__canvasBinding.canvas;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this._private__topCanvasBinding=Re(this._private__dv,new q(16,16)),this._private__topCanvasBinding.subscribeCanvasConfigured(this._private__topCanvasConfiguredHandler);var a=this._private__topCanvasBinding.canvas;a.style.position="absolute",a.style.zIndex="2",a.style.left="0",a.style.top="0",this._private__element.appendChild(this._private__leftStubCell),this._private__element.appendChild(this._private__cell),this._private__element.appendChild(this._private__rightStubCell),this._private__recreateStubs(),this._private__chart._internal_model().priceScalesOptionsChanged().subscribe(this._private__recreateStubs.bind(this),this),this._private__mouseEventHandler=new si(this._private__topCanvasBinding.canvas,this,{_internal_treatVertTouchDragAsPageScroll:function(){return!0},_internal_treatHorzTouchDragAsPageScroll:function(){return!1}})}return i.prototype.destroy=function(){this._private__mouseEventHandler.destroy(),this._private__leftStub!==null&&this._private__leftStub.destroy(),this._private__rightStub!==null&&this._private__rightStub.destroy(),this._private__topCanvasBinding.unsubscribeCanvasConfigured(this._private__topCanvasConfiguredHandler),this._private__topCanvasBinding.destroy(),this._private__canvasBinding.unsubscribeCanvasConfigured(this._private__canvasConfiguredHandler),this._private__canvasBinding.destroy()},i.prototype._internal_getElement=function(){return this._private__element},i.prototype._internal_leftStub=function(){return this._private__leftStub},i.prototype._internal_rightStub=function(){return this._private__rightStub},i.prototype._internal_mouseDownEvent=function(e){if(!this._private__mouseDown){this._private__mouseDown=!0;var t=this._private__chart._internal_model();t.timeScale().isEmpty()||!this._private__chart._internal_options().handleScale.axisPressedMouseMove.time||t.startScaleTime(e._internal_localX)}},i.prototype._internal_touchStartEvent=function(e){this._internal_mouseDownEvent(e)},i.prototype._internal_mouseDownOutsideEvent=function(){var e=this._private__chart._internal_model();!e.timeScale().isEmpty()&&this._private__mouseDown&&(this._private__mouseDown=!1,this._private__chart._internal_options().handleScale.axisPressedMouseMove.time&&e.endScaleTime())},i.prototype._internal_pressedMouseMoveEvent=function(e){var t=this._private__chart._internal_model();t.timeScale().isEmpty()||!this._private__chart._internal_options().handleScale.axisPressedMouseMove.time||t.scaleTimeTo(e._internal_localX)},i.prototype._internal_touchMoveEvent=function(e){this._internal_pressedMouseMoveEvent(e)},i.prototype._internal_mouseUpEvent=function(){this._private__mouseDown=!1;var e=this._private__chart._internal_model();e.timeScale().isEmpty()&&!this._private__chart._internal_options().handleScale.axisPressedMouseMove.time||e.endScaleTime()},i.prototype._internal_touchEndEvent=function(){this._internal_mouseUpEvent()},i.prototype._internal_mouseDoubleClickEvent=function(){this._private__chart._internal_options().handleScale.axisDoubleClickReset&&this._private__chart._internal_model().resetTimeScale()},i.prototype._internal_doubleTapEvent=function(){this._internal_mouseDoubleClickEvent()},i.prototype._internal_mouseEnterEvent=function(){this._private__chart._internal_model().options().handleScale.axisPressedMouseMove.time&&this._private__setCursor(1)},i.prototype._internal_mouseLeaveEvent=function(){this._private__setCursor(0)},i.prototype._internal_getSize=function(){return this._private__size},i.prototype._internal_sizeChanged=function(){return this._private__sizeChanged},i.prototype._internal_setSizes=function(e,t,r){(!this._private__size||!this._private__size._internal_equals(e))&&(this._private__size=e,this._private__isSettingSize=!0,this._private__canvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__topCanvasBinding.resizeCanvas({width:e._internal_w,height:e._internal_h}),this._private__isSettingSize=!1,this._private__cell.style.width=e._internal_w+"px",this._private__cell.style.height=e._internal_h+"px",this._private__sizeChanged._internal_fire(e)),this._private__leftStub!==null&&this._private__leftStub._internal_setSize(new q(t,e._internal_h)),this._private__rightStub!==null&&this._private__rightStub._internal_setSize(new q(r,e._internal_h))},i.prototype._internal_optimalHeight=function(){var e=this._private__getRendererOptions();return Math.ceil(e.borderSize+e.tickLength+e.fontSize+e.paddingTop+e.paddingBottom)},i.prototype._internal_update=function(){this._private__chart._internal_model().timeScale().marks()},i.prototype._internal_getImage=function(){return this._private__canvasBinding.canvas},i.prototype._internal_paint=function(e){if(e!==0){if(e!==1){var t=ue(this._private__canvasBinding.canvas);this._private__drawBackground(t,this._private__canvasBinding.pixelRatio),this._private__drawBorder(t,this._private__canvasBinding.pixelRatio),this._private__drawTickMarks(t,this._private__canvasBinding.pixelRatio),this._private__leftStub!==null&&this._private__leftStub._internal_paint(e),this._private__rightStub!==null&&this._private__rightStub._internal_paint(e)}var r=ue(this._private__topCanvasBinding.canvas),a=this._private__topCanvasBinding.pixelRatio;r.clearRect(0,0,Math.ceil(this._private__size._internal_w*a),Math.ceil(this._private__size._internal_h*a)),this._private__drawLabels([this._private__chart._internal_model().crosshairSource()],r,a)}},i.prototype._private__drawBackground=function(e,t){var r=this;de(e,t,function(){Pt(e,0,0,r._private__size._internal_w,r._private__size._internal_h,r._private__chart._internal_model().backgroundBottomColor())})},i.prototype._private__drawBorder=function(e,t){if(this._private__chart._internal_options().timeScale.borderVisible){e.save(),e.fillStyle=this._private__lineColor();var r=Math.max(1,Math.floor(this._private__getRendererOptions().borderSize*t));e.fillRect(0,0,Math.ceil(this._private__size._internal_w*t),r),e.restore()}},i.prototype._private__drawTickMarks=function(e,t){var r=this,a=this._private__chart._internal_model().timeScale().marks();if(!(!a||a.length===0)){var n=a.reduce(us,a[0]).weight;n>30&&n<50&&(n=30),e.save(),e.strokeStyle=this._private__lineColor();var _=this._private__getRendererOptions(),o=_.borderSize+_.tickLength+_.paddingTop+_.fontSize-_.baselineOffset;e.textAlign="center",e.fillStyle=this._private__lineColor();var l=Math.floor(this._private__getRendererOptions().borderSize*t),v=Math.max(1,Math.floor(t)),c=Math.floor(t*.5);if(this._private__chart._internal_model().timeScale().options().borderVisible){e.beginPath();for(var u=Math.round(_.tickLength*t),d=a.length;d--;){var m=Math.round(a[d].coord*t);e.rect(m-c,l,v,u)}e.fill()}e.fillStyle=this._private__textColor(),de(e,t,function(){e.font=r._private__baseFont();for(var g=0,S=a;g<S.length;g++){var y=S[g];if(y.weight<n){var b=y.needAlignCoordinate?r._private__alignTickMarkLabelCoordinate(e,y.coord,y.label):y.coord;e.fillText(y.label,b,o)}}e.font=r._private__baseBoldFont();for(var x=0,D=a;x<D.length;x++){var y=D[x];if(y.weight>=n){var b=y.needAlignCoordinate?r._private__alignTickMarkLabelCoordinate(e,y.coord,y.label):y.coord;e.fillText(y.label,b,o)}}}),e.restore()}},i.prototype._private__alignTickMarkLabelCoordinate=function(e,t,r){var a=this._private__widthCache.measureText(e,r),n=a/2,_=Math.floor(t-n)+.5;return _<0?t=t+Math.abs(0-_):_+a>this._private__size._internal_w&&(t=t-Math.abs(this._private__size._internal_w-(_+a))),t},i.prototype._private__drawLabels=function(e,t,r){for(var a=this._private__getRendererOptions(),n=0,_=e;n<_.length;n++)for(var o=_[n],l=0,v=o.timeAxisViews();l<v.length;l++){var c=v[l];t.save(),c.renderer().draw(t,a,r),t.restore()}},i.prototype._private__lineColor=function(){return this._private__chart._internal_options().timeScale.borderColor},i.prototype._private__textColor=function(){return this._private__options.textColor},i.prototype._private__fontSize=function(){return this._private__options.fontSize},i.prototype._private__baseFont=function(){return Le(this._private__fontSize(),this._private__options.fontFamily)},i.prototype._private__baseBoldFont=function(){return Le(this._private__fontSize(),this._private__options.fontFamily,"bold")},i.prototype._private__getRendererOptions=function(){this._private__rendererOptions===null&&(this._private__rendererOptions={borderSize:1,baselineOffset:NaN,paddingTop:NaN,paddingBottom:NaN,paddingHorizontal:NaN,tickLength:3,fontSize:NaN,font:"",widthCache:new We});var e=this._private__rendererOptions,t=this._private__baseFont();if(e.font!==t){var r=this._private__fontSize();e.fontSize=r,e.font=t,e.paddingTop=Math.ceil(r/2.5),e.paddingBottom=e.paddingTop,e.paddingHorizontal=Math.ceil(r/2),e.baselineOffset=Math.round(this._private__fontSize()/5),e.widthCache.reset()}return this._private__rendererOptions},i.prototype._private__setCursor=function(e){this._private__cell.style.cursor=e===1?"ew-resize":"default"},i.prototype._private__recreateStubs=function(){var e=this._private__chart._internal_model(),t=e.options();!t.leftPriceScale.visible&&this._private__leftStub!==null&&(this._private__leftStubCell.removeChild(this._private__leftStub._internal_getElement()),this._private__leftStub.destroy(),this._private__leftStub=null),!t.rightPriceScale.visible&&this._private__rightStub!==null&&(this._private__rightStubCell.removeChild(this._private__rightStub._internal_getElement()),this._private__rightStub.destroy(),this._private__rightStub=null);var r=this._private__chart._internal_model().rendererOptionsProvider(),a={_internal_rendererOptionsProvider:r},n=function(){return t.leftPriceScale.borderVisible&&e.timeScale().options().borderVisible},_=function(){return e.backgroundBottomColor()};t.leftPriceScale.visible&&this._private__leftStub===null&&(this._private__leftStub=new qi("left",t,a,n,_),this._private__leftStubCell.appendChild(this._private__leftStub._internal_getElement())),t.rightPriceScale.visible&&this._private__rightStub===null&&(this._private__rightStub=new qi("right",t,a,n,_),this._private__rightStubCell.appendChild(this._private__rightStub._internal_getElement()))},i}(),fs=function(){function i(e,t){this._private__paneWidgets=[],this._private__drawRafId=0,this._private__height=0,this._private__width=0,this._private__leftPriceAxisWidth=0,this._private__rightPriceAxisWidth=0,this._private__invalidateMask=null,this._private__drawPlanned=!1,this._private__clicked=new U,this._private__crosshairMoved=new U,this._private__customPriceLineDragged=new U,this._private__options=t,this._private__element=document.createElement("div"),this._private__element.classList.add("tv-lightweight-charts"),this._private__element.style.overflow="hidden",this._private__element.style.width="100%",this._private__element.style.height="100%",ms(this._private__element),this._private__tableElement=document.createElement("table"),this._private__tableElement.setAttribute("cellspacing","0"),this._private__element.appendChild(this._private__tableElement),this._private__onWheelBound=this._private__onMousewheel.bind(this),this._private__element.addEventListener("wheel",this._private__onWheelBound,{passive:!1}),this._private__model=new as(this._private__invalidateHandler.bind(this),this._private__options),this._internal_model().crosshairMoved().subscribe(this._private__onPaneWidgetCrosshairMoved.bind(this),this),this._internal_model().customPriceLineDragged().subscribe(this._private__onCustomPriceLineDragged.bind(this),this),this._private__timeAxisWidget=new ds(this),this._private__tableElement.appendChild(this._private__timeAxisWidget._internal_getElement());var r=this._private__options.width,a=this._private__options.height;if(r===0||a===0){var n=e.getBoundingClientRect();r===0&&(r=Math.floor(n.width),r-=r%2),a===0&&(a=Math.floor(n.height),a-=a%2)}this._internal_resize(r,a),this._private__syncGuiWithModel(),e.appendChild(this._private__element),this._private__updateTimeAxisVisibility(),this._private__model.timeScale().optionsApplied().subscribe(this._private__model.fullUpdate.bind(this._private__model),this),this._private__model.priceScalesOptionsChanged().subscribe(this._private__model.fullUpdate.bind(this._private__model),this)}return i.prototype._internal_model=function(){return this._private__model},i.prototype._internal_options=function(){return this._private__options},i.prototype._internal_paneWidgets=function(){return this._private__paneWidgets},i.prototype._internal_timeAxisWidget=function(){return this._private__timeAxisWidget},i.prototype.destroy=function(){this._private__element.removeEventListener("wheel",this._private__onWheelBound),this._private__drawRafId!==0&&window.cancelAnimationFrame(this._private__drawRafId),this._private__model.crosshairMoved().unsubscribeAll(this),this._private__model.customPriceLineDragged().unsubscribeAll(this),this._private__model.timeScale().optionsApplied().unsubscribeAll(this),this._private__model.priceScalesOptionsChanged().unsubscribeAll(this),this._private__model.destroy();for(var e=0,t=this._private__paneWidgets;e<t.length;e++){var r=t[e];this._private__tableElement.removeChild(r._internal_getElement()),r._internal_clicked().unsubscribeAll(this),r.destroy()}this._private__paneWidgets=[],C(this._private__timeAxisWidget).destroy(),this._private__element.parentElement!==null&&this._private__element.parentElement.removeChild(this._private__element),this._private__crosshairMoved._internal_destroy(),this._private__clicked._internal_destroy()},i.prototype._internal_resize=function(e,t,r){if(r===void 0&&(r=!1),!(this._private__height===t&&this._private__width===e)){this._private__height=t,this._private__width=e;var a=t+"px",n=e+"px";C(this._private__element).style.height=a,C(this._private__element).style.width=n,this._private__tableElement.style.height=a,this._private__tableElement.style.width=n,r?this._private__drawImpl(new ne(3)):this._private__model.fullUpdate()}},i.prototype._internal_paint=function(e){e===void 0&&(e=new ne(3));for(var t=0;t<this._private__paneWidgets.length;t++)this._private__paneWidgets[t]._internal_paint(e.invalidateForPane(t).level);this._private__options.timeScale.visible&&this._private__timeAxisWidget._internal_paint(e.fullInvalidation())},i.prototype._internal_applyOptions=function(e){this._private__model.applyOptions(e),this._private__updateTimeAxisVisibility();var t=e.width||this._private__width,r=e.height||this._private__height;this._internal_resize(t,r)},i.prototype._internal_clicked=function(){return this._private__clicked},i.prototype._internal_crosshairMoved=function(){return this._private__crosshairMoved},i.prototype._internal_customPriceLineDragged=function(){return this._private__customPriceLineDragged},i.prototype._internal_takeScreenshot=function(){var e=this;this._private__invalidateMask!==null&&(this._private__drawImpl(this._private__invalidateMask),this._private__invalidateMask=null);var t=this._private__paneWidgets[0],r=Dr(document,new q(this._private__width,this._private__height)),a=ue(r),n=St(r);return de(a,n,function(){var _=0,o=0,l=function(S){for(var y=0;y<e._private__paneWidgets.length;y++){var b=e._private__paneWidgets[y],x=b._internal_getSize()._internal_h,D=C(S==="left"?b._internal_leftPriceAxisWidget():b._internal_rightPriceAxisWidget()),V=D._internal_getImage();a.drawImage(V,_,o,D._internal_getWidth(),x),o+=x}};e._private__isLeftAxisVisible()&&(l("left"),_=C(t._internal_leftPriceAxisWidget())._internal_getWidth()),o=0;for(var v=0;v<e._private__paneWidgets.length;v++){var c=e._private__paneWidgets[v],u=c._internal_getSize(),d=c._internal_getImage();a.drawImage(d,_,o,u._internal_w,u._internal_h),o+=u._internal_h}_+=t._internal_getSize()._internal_w,e._private__isRightAxisVisible()&&(o=0,l("right"));var m=function(S){var y=C(S==="left"?e._private__timeAxisWidget._internal_leftStub():e._private__timeAxisWidget._internal_rightStub()),b=y._internal_getSize(),x=y._internal_getImage();a.drawImage(x,_,o,b._internal_w,b._internal_h)};if(e._private__options.timeScale.visible){_=0,e._private__isLeftAxisVisible()&&(m("left"),_=C(t._internal_leftPriceAxisWidget())._internal_getWidth());var g=e._private__timeAxisWidget._internal_getSize(),d=e._private__timeAxisWidget._internal_getImage();a.drawImage(d,_,o,g._internal_w,g._internal_h),e._private__isRightAxisVisible()&&(_+=t._internal_getSize()._internal_w,m("right"),a.restore())}}),r},i.prototype._internal_getPriceAxisWidth=function(e){if(e==="none"||e==="left"&&!this._private__isLeftAxisVisible()||e==="right"&&!this._private__isRightAxisVisible()||this._private__paneWidgets.length===0)return 0;var t=e==="left"?this._private__paneWidgets[0]._internal_leftPriceAxisWidget():this._private__paneWidgets[0]._internal_rightPriceAxisWidget();return C(t)._internal_getWidth()},i.prototype._private__adjustSizeImpl=function(){for(var e=0,t=0,r=0,a=0,n=this._private__paneWidgets;a<n.length;a++){var _=n[a];this._private__isLeftAxisVisible()&&(t=Math.max(t,C(_._internal_leftPriceAxisWidget())._internal_optimalWidth())),this._private__isRightAxisVisible()&&(r=Math.max(r,C(_._internal_rightPriceAxisWidget())._internal_optimalWidth())),e+=_._internal_stretchFactor()}var o=this._private__width,l=this._private__height,v=Math.max(o-t-r,0),c=0,u=this._private__options.timeScale.visible,d=u?this._private__timeAxisWidget._internal_optimalHeight():0;d%2&&(d+=1);for(var m=c+d,g=l<m?0:l-m,S=g/e,y=0,b=0;b<this._private__paneWidgets.length;++b){var _=this._private__paneWidgets[b];_._internal_setState(this._private__model.panes()[b]);var x=0,D=0;b===this._private__paneWidgets.length-1?D=g-y:D=Math.round(_._internal_stretchFactor()*S),x=Math.max(D,2),y+=x,_._internal_setSize(new q(v,x)),this._private__isLeftAxisVisible()&&_._internal_setPriceAxisSize(t,"left"),this._private__isRightAxisVisible()&&_._internal_setPriceAxisSize(r,"right"),_._internal_state()&&this._private__model.setPaneHeight(_._internal_state(),x)}this._private__timeAxisWidget._internal_setSizes(new q(u?v:0,d),u?t:0,u?r:0),this._private__model.setWidth(v),this._private__leftPriceAxisWidth!==t&&(this._private__leftPriceAxisWidth=t),this._private__rightPriceAxisWidth!==r&&(this._private__rightPriceAxisWidth=r)},i.prototype._private__onMousewheel=function(e){var t=e.deltaX/100,r=-(e.deltaY/100);if(!((t===0||!this._private__options.handleScroll.mouseWheel)&&(r===0||!this._private__options.handleScale.mouseWheel))){switch(e.cancelable&&e.preventDefault(),e.deltaMode){case e.DOM_DELTA_PAGE:t*=120,r*=120;break;case e.DOM_DELTA_LINE:t*=32,r*=32;break}if(r!==0&&this._private__options.handleScale.mouseWheel){var a=Math.sign(r)*Math.min(1,Math.abs(r)),n=e.clientX-this._private__element.getBoundingClientRect().left;this._internal_model().zoomTime(n,a)}t!==0&&this._private__options.handleScroll.mouseWheel&&this._internal_model().scrollChart(t*-80)}},i.prototype._private__drawImpl=function(e){var t,r=e.fullInvalidation();r===3&&this._private__updateGui(),(r===3||r===2)&&(this._private__applyMomentaryAutoScale(e),this._private__applyTimeScaleInvalidations(e),this._private__timeAxisWidget._internal_update(),this._private__paneWidgets.forEach(function(a){a._internal_updatePriceAxisWidgets()}),((t=this._private__invalidateMask)===null||t===void 0?void 0:t.fullInvalidation())===3&&(this._private__invalidateMask.merge(e),this._private__updateGui(),this._private__applyMomentaryAutoScale(this._private__invalidateMask),this._private__applyTimeScaleInvalidations(this._private__invalidateMask),e=this._private__invalidateMask,this._private__invalidateMask=null)),this._internal_paint(e)},i.prototype._private__applyTimeScaleInvalidations=function(e){for(var t=e.timeScaleInvalidations(),r=0,a=t;r<a.length;r++){var n=a[r];this._private__applyTimeScaleInvalidation(n)}},i.prototype._private__applyMomentaryAutoScale=function(e){for(var t=this._private__model.panes(),r=0;r<t.length;r++)e.invalidateForPane(r).autoScale&&t[r].momentaryAutoScale()},i.prototype._private__applyTimeScaleInvalidation=function(e){var t=this._private__model.timeScale();switch(e.type){case 0:t.fitContent();break;case 1:t.setLogicalRange(e.value);break;case 2:t.setBarSpacing(e.value);break;case 3:t.setRightOffset(e.value);break;case 4:t.restoreDefault();break}},i.prototype._private__invalidateHandler=function(e){var t=this;this._private__invalidateMask!==null?this._private__invalidateMask.merge(e):this._private__invalidateMask=e,this._private__drawPlanned||(this._private__drawPlanned=!0,this._private__drawRafId=window.requestAnimationFrame(function(){if(t._private__drawPlanned=!1,t._private__drawRafId=0,t._private__invalidateMask!==null){var r=t._private__invalidateMask;t._private__invalidateMask=null,t._private__drawImpl(r)}}))},i.prototype._private__updateGui=function(){this._private__syncGuiWithModel()},i.prototype._private__syncGuiWithModel=function(){for(var e=this._private__model.panes(),t=e.length,r=this._private__paneWidgets.length,a=t;a<r;a++){var n=se(this._private__paneWidgets.pop());this._private__tableElement.removeChild(n._internal_getElement()),n._internal_clicked().unsubscribeAll(this),n.destroy()}for(var a=r;a<t;a++){var n=new hs(this,e[a]);n._internal_clicked().subscribe(this._private__onPaneWidgetClicked.bind(this),this),this._private__paneWidgets.push(n),this._private__tableElement.insertBefore(n._internal_getElement(),this._private__timeAxisWidget._internal_getElement())}for(var a=0;a<t;a++){var _=e[a],n=this._private__paneWidgets[a];n._internal_state()!==_?n._internal_setState(_):n._internal_updatePriceAxisWidgetsStates()}this._private__updateTimeAxisVisibility(),this._private__adjustSizeImpl()},i.prototype._private__getMouseEventParamsImpl=function(e,t){var r=new Map;if(e!==null){var a=this._private__model.serieses();a.forEach(function(c){var u=c.dataAt(e);u!==null&&r.set(c,u)})}var n;if(e!==null){var _=this._private__model.timeScale().indexToTime(e);_!==null&&(n=_)}var o=this._internal_model().hoveredSource(),l=o!==null&&o.source instanceof kt?o.source:void 0,v=o!==null&&o.object!==void 0?o.object.externalId:void 0;return{_internal_time:n,_internal_point:t||void 0,_internal_hoveredSeries:l,_internal_seriesPrices:r,_internal_hoveredObject:v}},i.prototype._private__getCustomPriceLineDraggedEventParamsImpl=function(e,t){return{_internal_customPriceLine:e,_internal_fromPriceString:t}},i.prototype._private__onPaneWidgetClicked=function(e,t){var r=this;this._private__clicked._internal_fire(function(){return r._private__getMouseEventParamsImpl(e,t)})},i.prototype._private__onPaneWidgetCrosshairMoved=function(e,t){var r=this;this._private__crosshairMoved._internal_fire(function(){return r._private__getMouseEventParamsImpl(e,t)})},i.prototype._private__onCustomPriceLineDragged=function(e,t){var r=this;this._private__customPriceLineDragged._internal_fire(function(){return r._private__getCustomPriceLineDraggedEventParamsImpl(e,t)})},i.prototype._private__updateTimeAxisVisibility=function(){var e=this._private__options.timeScale.visible?"":"none";this._private__timeAxisWidget._internal_getElement().style.display=e},i.prototype._private__isLeftAxisVisible=function(){return this._private__paneWidgets[0]._internal_state().leftPriceScale().options().visible},i.prototype._private__isRightAxisVisible=function(){return this._private__paneWidgets[0]._internal_state().rightPriceScale().options().visible},i}();function ms(i){i.style.userSelect="none",i.style.webkitUserSelect="none",i.style.msUserSelect="none",i.style.MozUserSelect="none",i.style.webkitTapHighlightColor="transparent"}function Or(i){console.warn(i)}function ji(i,e,t){var r=t.value;return{index:e,time:i,value:[r,r,r,r]}}function Gi(i,e,t){var r=t.value,a={index:e,time:i,value:[r,r,r,r]};return"color"in t&&t.color!==void 0&&(a.color=t.color),a}function gs(i,e,t){var r={index:e,time:i,value:[t.open,t.high,t.low,t.close]};return"color"in t&&t.color!==void 0&&(r.color=t.color),r}function ys(i,e,t){var r={index:e,time:i,value:[t.open,t.high,t.low,t.close]};return"color"in t&&t.color!==void 0&&(r.color=t.color),"borderColor"in t&&t.borderColor!==void 0&&(r.borderColor=t.borderColor),"wickColor"in t&&t.wickColor!==void 0&&(r.wickColor=t.wickColor),r}function ht(i){return i.value!==void 0}function Ae(i){return function(e,t,r){return _s(r)?{time:e,index:t}:i(e,t,r)}}var bs={Candlestick:Ae(ys),Bar:Ae(gs),Area:Ae(ji),Baseline:Ae(ji),Histogram:Ae(Gi),Line:Ae(Gi)};function Zi(i){return bs[i]}function ut(i){return i*60*60*1e3}function $t(i){return i*60*1e3}function Ss(i){return i*1e3}var dt=[{_internal_divisor:Ss(1),_internal_weight:10},{_internal_divisor:$t(1),_internal_weight:20},{_internal_divisor:$t(5),_internal_weight:21},{_internal_divisor:$t(30),_internal_weight:22},{_internal_divisor:ut(1),_internal_weight:30},{_internal_divisor:ut(3),_internal_weight:31},{_internal_divisor:ut(6),_internal_weight:32},{_internal_divisor:ut(12),_internal_weight:33}];function Ki(i,e){if(i.getUTCFullYear()!==e.getUTCFullYear())return 70;if(i.getUTCMonth()!==e.getUTCMonth())return 60;if(i.getUTCDate()!==e.getUTCDate())return 50;for(var t=dt.length-1;t>=0;--t)if(Math.floor(e.getTime()/dt[t]._internal_divisor)!==Math.floor(i.getTime()/dt[t]._internal_divisor))return dt[t]._internal_weight;return 0}function Ji(i,e){if(e===void 0&&(e=0),i.length!==0){for(var t=e===0?null:i[e-1].time.timestamp,r=t!==null?new Date(t*1e3):null,a=0,n=e;n<i.length;++n){var _=i[n],o=new Date(_.time.timestamp*1e3);r!==null&&(_.timeWeight=Ki(o,r)),a+=_.time.timestamp-(t||_.time.timestamp),t=_.time.timestamp,r=o}if(e===0&&i.length>1){var l=Math.ceil(a/(i.length-1)),v=new Date((i[0].time.timestamp-l)*1e3);i[0].timeWeight=Ki(new Date(i[0].time.timestamp*1e3),v)}}}function Kt(i){if(!_i(i))throw new Error("time must be of type BusinessDay");var e=new Date(Date.UTC(i.year,i.month-1,i.day,0,0,0,0));return{timestamp:Math.round(e.getTime()/1e3),businessDay:i}}function Ar(i){if(!Lr(i))throw new Error("time must be of type isUTCTimestamp");return{timestamp:i}}function Qi(i){return i.length===0?null:_i(i[0].time)?Kt:Ar}function Fe(i){return Lr(i)?Ar(i):_i(i)?Kt(i):Kt(Er(i))}var Cs=/^\d\d\d\d-\d\d-\d\d$/;function Er(i){if(!Cs.test(i))throw new Error("Invalid date string=".concat(i,", expected format=yyyy-mm-dd"));var e=new Date(i);if(isNaN(e.getTime()))throw new Error("Invalid date string=".concat(i,", expected format=yyyy-mm-dd"));return{day:e.getUTCDate(),month:e.getUTCMonth()+1,year:e.getUTCFullYear()}}function Vr(i){Jt(i.time)&&(i.time=Er(i.time))}function ws(i){return i.forEach(Vr)}function er(i){return{_internal_index:0,_internal_mapping:new Map,_internal_timePoint:i}}function tr(i){if(!(i===void 0||i.length===0))return{_internal_firstTime:i[0].time.timestamp,_internal_lastTime:i[i.length-1].time.timestamp}}function Ps(i,e){var t=tr(i),r=tr(e);if(t!==void 0&&r!==void 0)return{lastBarUpdatedOrNewBarsAddedToTheRight:t._internal_lastTime>=r._internal_lastTime&&t._internal_firstTime>=r._internal_firstTime}}var Ts=function(){function i(){this._private__pointDataByTimePoint=new Map,this._private__seriesRowsBySeries=new Map,this._private__seriesLastTimePoint=new Map,this._private__sortedTimePoints=[]}return i.prototype._internal_destroy=function(){this._private__pointDataByTimePoint.clear(),this._private__seriesRowsBySeries.clear(),this._private__seriesLastTimePoint.clear(),this._private__sortedTimePoints=[]},i.prototype._internal_setSeriesData=function(e,t){var r=this,a=this._private__pointDataByTimePoint.size!==0,n=!1,_=this._private__seriesRowsBySeries.get(e);if(_!==void 0)if(this._private__seriesRowsBySeries.size===1)a=!1,n=!0,this._private__pointDataByTimePoint.clear();else for(var o=0,l=this._private__sortedTimePoints;o<l.length;o++){var v=l[o];v.pointData._internal_mapping.delete(e)&&(n=!0)}var c=[];if(t.length!==0){ws(t);var u=C(Qi(t)),d=Zi(e.seriesType());c=t.map(function(S){var y=u(S.time),b=r._private__pointDataByTimePoint.get(y.timestamp);b===void 0&&(b=er(y),r._private__pointDataByTimePoint.set(y.timestamp,b),n=!0);var x=d(y,b._internal_index,S);return b._internal_mapping.set(e,x),x})}a&&this._private__cleanupPointsData(),this._private__setRowsToSeries(e,c);var m=-1;if(n){var g=[];this._private__pointDataByTimePoint.forEach(function(S){g.push({timeWeight:0,time:S._internal_timePoint,pointData:S})}),g.sort(function(S,y){return S.time.timestamp-y.time.timestamp}),m=this._private__replaceTimeScalePoints(g)}return this._private__getUpdateResponse(e,m,Ps(this._private__seriesRowsBySeries.get(e),_))},i.prototype._internal_removeSeries=function(e){return this._internal_setSeriesData(e,[])},i.prototype._internal_updateSeriesData=function(e,t){Vr(t);var r=C(Qi([t]))(t.time),a=this._private__seriesLastTimePoint.get(e);if(a!==void 0&&r.timestamp<a.timestamp)throw new Error("Cannot update oldest data, last time=".concat(a.timestamp,", new time=").concat(r.timestamp));var n=this._private__pointDataByTimePoint.get(r.timestamp),_=n===void 0;n===void 0&&(n=er(r),this._private__pointDataByTimePoint.set(r.timestamp,n));var o=Zi(e.seriesType()),l=o(r,n._internal_index,t);n._internal_mapping.set(e,l),this._private__updateLastSeriesRow(e,l);var v={lastBarUpdatedOrNewBarsAddedToTheRight:ht(l)};if(!_)return this._private__getUpdateResponse(e,-1,v);var c={timeWeight:0,time:n._internal_timePoint,pointData:n},u=Ke(this._private__sortedTimePoints,c.time.timestamp,function(m,g){return m.time.timestamp<g});this._private__sortedTimePoints.splice(u,0,c);for(var d=u;d<this._private__sortedTimePoints.length;++d)qt(this._private__sortedTimePoints[d].pointData,d);return Ji(this._private__sortedTimePoints,u),this._private__getUpdateResponse(e,u,v)},i.prototype._private__updateLastSeriesRow=function(e,t){var r=this._private__seriesRowsBySeries.get(e);r===void 0&&(r=[],this._private__seriesRowsBySeries.set(e,r));var a=r.length!==0?r[r.length-1]:null;a===null||t.time.timestamp>a.time.timestamp?ht(t)&&r.push(t):ht(t)?r[r.length-1]=t:r.splice(-1,1),this._private__seriesLastTimePoint.set(e,t.time)},i.prototype._private__setRowsToSeries=function(e,t){t.length!==0?(this._private__seriesRowsBySeries.set(e,t.filter(ht)),this._private__seriesLastTimePoint.set(e,t[t.length-1].time)):(this._private__seriesRowsBySeries.delete(e),this._private__seriesLastTimePoint.delete(e))},i.prototype._private__cleanupPointsData=function(){for(var e=0,t=this._private__sortedTimePoints;e<t.length;e++){var r=t[e];r.pointData._internal_mapping.size===0&&this._private__pointDataByTimePoint.delete(r.time.timestamp)}},i.prototype._private__replaceTimeScalePoints=function(e){for(var t=-1,r=0;r<this._private__sortedTimePoints.length&&r<e.length;++r){var a=this._private__sortedTimePoints[r],n=e[r];if(a.time.timestamp!==n.time.timestamp){t=r;break}n.timeWeight=a.timeWeight,qt(n.pointData,r)}if(t===-1&&this._private__sortedTimePoints.length!==e.length&&(t=Math.min(this._private__sortedTimePoints.length,e.length)),t===-1)return-1;for(var r=t;r<e.length;++r)qt(e[r].pointData,r);return Ji(e,t),this._private__sortedTimePoints=e,t},i.prototype._private__getBaseIndex=function(){if(this._private__seriesRowsBySeries.size===0)return null;var e=0;return this._private__seriesRowsBySeries.forEach(function(t){t.length!==0&&(e=Math.max(e,t[t.length-1].index))}),e},i.prototype._private__getUpdateResponse=function(e,t,r){var a={_internal_series:new Map,_internal_timeScale:{_internal_baseIndex:this._private__getBaseIndex()}};if(t!==-1)this._private__seriesRowsBySeries.forEach(function(_,o){a._internal_series.set(o,{_internal_data:_,_internal_info:o===e?r:void 0})}),this._private__seriesRowsBySeries.has(e)||a._internal_series.set(e,{_internal_data:[],_internal_info:r}),a._internal_timeScale._internal_points=this._private__sortedTimePoints,a._internal_timeScale._internal_firstChangedPointIndex=t;else{var n=this._private__seriesRowsBySeries.get(e);a._internal_series.set(e,{_internal_data:n||[],_internal_info:r})}return a},i}();function qt(i,e){i._internal_index=e,i._internal_mapping.forEach(function(t){t.index=e})}function Ms(i){re(typeof i.price=="number","the type of 'price' price line's property must be a number, got '".concat(typeof i.price,"'"))}function ir(i,e){if(e===void 0&&(e=!1),i.length!==0)for(var t=Fe(i[0].time).timestamp,r=1;r<i.length;++r){var a=Fe(i[r].time).timestamp,n=e?t<=a:t<a;re(n,"data must be asc ordered by time, index=".concat(r,", time=").concat(a,", prev time=").concat(t)),t=a}}function rr(i,e){e.forEach(ks(i))}function ks(i){switch(i){case"Bar":case"Candlestick":return xs.bind(null,i);case"Area":case"Baseline":case"Line":case"Histogram":return Ls.bind(null,i)}}function xs(i,e){Rr(e)&&(re(typeof e.open=="number","".concat(i," series item data value of open must be a number, got=").concat(typeof e.open,", value=").concat(e.open)),re(typeof e.high=="number","".concat(i," series item data value of high must be a number, got=").concat(typeof e.high,", value=").concat(e.high)),re(typeof e.low=="number","".concat(i," series item data value of low must be a number, got=").concat(typeof e.low,", value=").concat(e.low)),re(typeof e.close=="number","".concat(i," series item data value of close must be a number, got=").concat(typeof e.close,", value=").concat(e.close)))}function Ls(i,e){Rr(e)&&re(typeof e.value=="number","".concat(i," series item data value must be a number, got=").concat(typeof e.value,", value=").concat(e.value))}var Rs={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",draggable:!1},Ds=function(){function i(e){this._private__priceLine=e}return i.prototype.applyOptions=function(e){this._private__priceLine.applyOptions(e)},i.prototype.options=function(){return this._private__priceLine.options()},i.prototype._internal_priceLine=function(){return this._private__priceLine},i}();function ke(i){var e=i.overlay,t=cn(i,["overlay"]);return e&&(t.priceScaleId=""),t}var Ie=function(){function i(e,t,r){this._internal__series=e,this._internal__dataUpdatesConsumer=t,this._private__priceScaleApiProvider=r}return i.prototype.priceFormatter=function(){return this._internal__series.formatter()},i.prototype.priceToCoordinate=function(e){var t=this._internal__series.firstValue();return t===null?null:this._internal__series.priceScale().priceToCoordinate(e,t.value)},i.prototype.coordinateToPrice=function(e){var t=this._internal__series.firstValue();return t===null?null:this._internal__series.priceScale().coordinateToPrice(e,t.value)},i.prototype.barsInLogicalRange=function(e){if(e===null)return null;var t=new ft(new qe(e.from,e.to))._internal_strictRange(),r=this._internal__series.bars();if(r.isEmpty())return null;var a=r.search(t.left(),1),n=r.search(t.right(),-1),_=C(r.firstIndex()),o=C(r.lastIndex());if(a!==null&&n!==null&&a.index>n.index)return{barsBefore:e.from-_,barsAfter:o-e.to};var l=a===null||a.index===_?e.from-_:a.index-_,v=n===null||n.index===o?o-e.to:o-n.index,c={barsBefore:l,barsAfter:v};return a!==null&&n!==null&&(c.from=a.time.businessDay||a.time.timestamp,c.to=n.time.businessDay||n.time.timestamp),c},i.prototype.setData=function(e){ir(e),rr(this._internal__series.seriesType(),e),this._internal__dataUpdatesConsumer._internal_applyNewData(this._internal__series,e)},i.prototype.update=function(e){rr(this._internal__series.seriesType(),[e]),this._internal__dataUpdatesConsumer._internal_updateData(this._internal__series,e)},i.prototype.setMarkers=function(e){ir(e,!0);var t=e.map(function(r){return F(F({},r),{time:Fe(r.time)})});this._internal__series.setMarkers(t)},i.prototype.applyOptions=function(e){var t=ke(e);this._internal__series.applyOptions(t)},i.prototype.options=function(){return ee(this._internal__series.options())},i.prototype.priceScale=function(){return this._private__priceScaleApiProvider.priceScale(this._internal__series.priceScale().id())},i.prototype.createPriceLine=function(e){Ms(e);var t=$(ee(Rs),e),r=this._internal__series.createPriceLine(t);return new Ds(r)},i.prototype.removePriceLine=function(e){this._internal__series.removePriceLine(e._internal_priceLine())},i.prototype.seriesType=function(){return this._internal__series.seriesType()},i}(),Os=function(i){B(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.applyOptions=function(t){xr(t),i.prototype.applyOptions.call(this,t)},e}(Ie),As={vertLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},horzLine:{color:"#758696",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#4c525e"},mode:1},Es={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},Vs={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:11,fontFamily:Qt},jt={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,drawTicks:!0,scaleMargins:{bottom:.1,top:.2}},Is={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0},Bs={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:Qt,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},ar={width:0,height:0,layout:Vs,crosshair:As,grid:Es,overlayPriceScales:F({},jt),leftPriceScale:F(F({},jt),{visible:!1}),rightPriceScale:F(F({},jt),{visible:!0}),timeScale:Is,watermark:Bs,localization:{locale:xt?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:!0,mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Fs={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Ws={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},zs={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ns={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Hs={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Us={color:"#26a69a",base:0},Ee={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},Ys=function(){function i(e,t){this._private__chartWidget=e,this._private__priceScaleId=t}return i.prototype.applyOptions=function(e){this._private__chartWidget._internal_model().applyPriceScaleOptions(this._private__priceScaleId,e)},i.prototype.options=function(){return this._private__priceScale().options()},i.prototype.width=function(){return Tt(this._private__priceScaleId)?this._private__chartWidget._internal_getPriceAxisWidth(this._private__priceScaleId==="left"?"left":"right"):0},i.prototype.formatPrice=function(e,t){return t===void 0&&(t=0),this._private__priceScale().formatPrice(e,t)},i.prototype._private__priceScale=function(){return C(this._private__chartWidget._internal_model().findPriceScale(this._private__priceScaleId)).priceScale},i}(),Xs=function(){function i(e,t){this._private__timeRangeChanged=new U,this._private__logicalRangeChanged=new U,this._private__sizeChanged=new U,this._private__model=e,this._private__timeScale=e.timeScale(),this._private__timeAxisWidget=t,this._private__timeScale.visibleBarsChanged().subscribe(this._private__onVisibleBarsChanged.bind(this)),this._private__timeScale.logicalRangeChanged().subscribe(this._private__onVisibleLogicalRangeChanged.bind(this)),this._private__timeAxisWidget._internal_sizeChanged().subscribe(this._private__onSizeChanged.bind(this))}return i.prototype.destroy=function(){this._private__timeScale.visibleBarsChanged().unsubscribeAll(this),this._private__timeScale.logicalRangeChanged().unsubscribeAll(this),this._private__timeAxisWidget._internal_sizeChanged().unsubscribeAll(this),this._private__timeRangeChanged._internal_destroy(),this._private__logicalRangeChanged._internal_destroy(),this._private__sizeChanged._internal_destroy()},i.prototype.scrollPosition=function(){return this._private__timeScale.rightOffset()},i.prototype.scrollToPosition=function(e,t){if(!t){this._private__model.setRightOffset(e);return}this._private__timeScale.scrollToOffsetAnimated(e,1e3)},i.prototype.scrollToRealTime=function(){this._private__timeScale.scrollToRealTime()},i.prototype.getVisibleRange=function(){var e,t,r=this._private__timeScale.visibleTimeRange();return r===null?null:{from:(e=r.from.businessDay)!==null&&e!==void 0?e:r.from.timestamp,to:(t=r.to.businessDay)!==null&&t!==void 0?t:r.to.timestamp}},i.prototype.setVisibleRange=function(e){var t={from:Fe(e.from),to:Fe(e.to)},r=this._private__timeScale.logicalRangeForTimeRange(t);this._private__model.setTargetLogicalRange(r)},i.prototype.getVisibleLogicalRange=function(){var e=this._private__timeScale.visibleLogicalRange();return e===null?null:{from:e.left(),to:e.right()}},i.prototype.setVisibleLogicalRange=function(e){re(e.from<=e.to,"The from index cannot be after the to index."),this._private__model.setTargetLogicalRange(e)},i.prototype.resetTimeScale=function(){this._private__model.resetTimeScale()},i.prototype.fitContent=function(){this._private__model.fitContent()},i.prototype.logicalToCoordinate=function(e){var t=this._private__model.timeScale();return t.isEmpty()?null:t.indexToCoordinate(e)},i.prototype.coordinateToLogical=function(e){return this._private__timeScale.isEmpty()?null:this._private__timeScale.coordinateToIndex(e)},i.prototype.timeToCoordinate=function(e){var t=Fe(e),r=this._private__timeScale.timeToIndex(t,!1);return r===null?null:this._private__timeScale.indexToCoordinate(r)},i.prototype.coordinateToTime=function(e){var t,r=this._private__model.timeScale(),a=r.coordinateToIndex(e),n=r.indexToTime(a);return n===null?null:(t=n.businessDay)!==null&&t!==void 0?t:n.timestamp},i.prototype.width=function(){return this._private__timeAxisWidget._internal_getSize()._internal_w},i.prototype.height=function(){return this._private__timeAxisWidget._internal_getSize()._internal_h},i.prototype.subscribeVisibleTimeRangeChange=function(e){this._private__timeRangeChanged.subscribe(e)},i.prototype.unsubscribeVisibleTimeRangeChange=function(e){this._private__timeRangeChanged.unsubscribe(e)},i.prototype.subscribeVisibleLogicalRangeChange=function(e){this._private__logicalRangeChanged.subscribe(e)},i.prototype.unsubscribeVisibleLogicalRangeChange=function(e){this._private__logicalRangeChanged.unsubscribe(e)},i.prototype.subscribeSizeChange=function(e){this._private__sizeChanged.subscribe(e)},i.prototype.unsubscribeSizeChange=function(e){this._private__sizeChanged.unsubscribe(e)},i.prototype.applyOptions=function(e){this._private__timeScale.applyOptions(e)},i.prototype.options=function(){return ee(this._private__timeScale.options())},i.prototype._private__onVisibleBarsChanged=function(){this._private__timeRangeChanged._internal_hasListeners()&&this._private__timeRangeChanged._internal_fire(this.getVisibleRange())},i.prototype._private__onVisibleLogicalRangeChanged=function(){this._private__logicalRangeChanged._internal_hasListeners()&&this._private__logicalRangeChanged._internal_fire(this.getVisibleLogicalRange())},i.prototype._private__onSizeChanged=function(e){this._private__sizeChanged._internal_fire(e._internal_w,e._internal_h)},i}();function Ve(i){if(!(i===void 0||i.type==="custom")){var e=i;e.minMove!==void 0&&e.precision===void 0&&(e.precision=ns(e.minMove))}}function $s(i){if(Bt(i.handleScale)){var e=i.handleScale;i.handleScale={axisDoubleClickReset:e,axisPressedMouseMove:{time:e,price:e},mouseWheel:e,pinch:e}}else if(i.handleScale!==void 0&&Bt(i.handleScale.axisPressedMouseMove)){var t=i.handleScale.axisPressedMouseMove;i.handleScale.axisPressedMouseMove={time:t,price:t}}var r=i.handleScroll;Bt(r)&&(i.handleScroll={horzTouchDrag:r,vertTouchDrag:r,mouseWheel:r,pressedMouseMove:r})}function qs(i){if(i.priceScale){Or('"priceScale" option has been deprecated, use "leftPriceScale", "rightPriceScale" and "overlayPriceScales" instead'),i.leftPriceScale=i.leftPriceScale||{},i.rightPriceScale=i.rightPriceScale||{};var e=i.priceScale.position;delete i.priceScale.position,i.leftPriceScale=$(i.leftPriceScale,i.priceScale),i.rightPriceScale=$(i.rightPriceScale,i.priceScale),e==="left"&&(i.leftPriceScale.visible=!0,i.rightPriceScale.visible=!1),e==="right"&&(i.leftPriceScale.visible=!1,i.rightPriceScale.visible=!0),e==="none"&&(i.leftPriceScale.visible=!1,i.rightPriceScale.visible=!1),i.overlayPriceScales=i.overlayPriceScales||{},i.priceScale.invertScale!==void 0&&(i.overlayPriceScales.invertScale=i.priceScale.invertScale),i.priceScale.scaleMargins!==void 0&&(i.overlayPriceScales.scaleMargins=i.priceScale.scaleMargins)}}function js(i){i.layout&&i.layout.backgroundColor&&!i.layout.background&&(i.layout.background={type:"solid",color:i.layout.backgroundColor})}function nr(i){return $s(i),qs(i),js(i),i}var Gs=function(){function i(e,t){var r=this;this._private__dataLayer=new Ts,this._private__seriesMap=new Map,this._private__seriesMapReversed=new Map,this._private__clickedDelegate=new U,this._private__crosshairMovedDelegate=new U,this._private__customPriceLineDraggedDelegate=new U;var a=t===void 0?ee(ar):$(ee(ar),nr(t));this._private__chartWidget=new fs(e,a),this._private__chartWidget._internal_clicked().subscribe(function(_){r._private__clickedDelegate._internal_hasListeners()&&r._private__clickedDelegate._internal_fire(r._private__convertMouseParams(_()))},this),this._private__chartWidget._internal_crosshairMoved().subscribe(function(_){r._private__crosshairMovedDelegate._internal_hasListeners()&&r._private__crosshairMovedDelegate._internal_fire(r._private__convertMouseParams(_()))},this),this._private__chartWidget._internal_customPriceLineDragged().subscribe(function(_){r._private__customPriceLineDraggedDelegate._internal_hasListeners()&&r._private__customPriceLineDraggedDelegate._internal_fire(r._private__convertCustomPriceLineDraggedParams(_()))},this);var n=this._private__chartWidget._internal_model();this._private__timeScaleApi=new Xs(n,this._private__chartWidget._internal_timeAxisWidget())}return i.prototype.remove=function(){this._private__chartWidget._internal_clicked().unsubscribeAll(this),this._private__chartWidget._internal_crosshairMoved().unsubscribeAll(this),this._private__chartWidget._internal_customPriceLineDragged().unsubscribeAll(this),this._private__timeScaleApi.destroy(),this._private__chartWidget.destroy(),this._private__seriesMap.clear(),this._private__seriesMapReversed.clear(),this._private__clickedDelegate._internal_destroy(),this._private__crosshairMovedDelegate._internal_destroy(),this._private__customPriceLineDraggedDelegate._internal_destroy(),this._private__dataLayer._internal_destroy()},i.prototype.resize=function(e,t,r){this._private__chartWidget._internal_resize(e,t,r)},i.prototype.addAreaSeries=function(e){e===void 0&&(e={}),e=ke(e),Ve(e.priceFormat);var t=$(ee(Ee),Ns,e),r=this._private__chartWidget._internal_model().createSeries("Area",t),a=new Ie(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.addBaselineSeries=function(e){e===void 0&&(e={}),e=ke(e),Ve(e.priceFormat);var t=$(ee(Ee),ee(Hs),e),r=this._private__chartWidget._internal_model().createSeries("Baseline",t),a=new Ie(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.addBarSeries=function(e){e===void 0&&(e={}),e=ke(e),Ve(e.priceFormat);var t=$(ee(Ee),Ws,e),r=this._private__chartWidget._internal_model().createSeries("Bar",t),a=new Ie(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.addCandlestickSeries=function(e){e===void 0&&(e={}),e=ke(e),xr(e),Ve(e.priceFormat);var t=$(ee(Ee),Fs,e),r=this._private__chartWidget._internal_model().createSeries("Candlestick",t),a=new Os(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.addHistogramSeries=function(e){e===void 0&&(e={}),e=ke(e),Ve(e.priceFormat);var t=$(ee(Ee),Us,e),r=this._private__chartWidget._internal_model().createSeries("Histogram",t),a=new Ie(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.addLineSeries=function(e){e===void 0&&(e={}),e=ke(e),Ve(e.priceFormat);var t=$(ee(Ee),zs,e),r=this._private__chartWidget._internal_model().createSeries("Line",t),a=new Ie(r,this,this);return this._private__seriesMap.set(a,r),this._private__seriesMapReversed.set(r,a),a},i.prototype.removeSeries=function(e){var t=se(this._private__seriesMap.get(e)),r=this._private__dataLayer._internal_removeSeries(t),a=this._private__chartWidget._internal_model();a.removeSeries(t),this._private__sendUpdateToChart(r),this._private__seriesMap.delete(e),this._private__seriesMapReversed.delete(t)},i.prototype._internal_applyNewData=function(e,t){this._private__sendUpdateToChart(this._private__dataLayer._internal_setSeriesData(e,t))},i.prototype._internal_updateData=function(e,t){this._private__sendUpdateToChart(this._private__dataLayer._internal_updateSeriesData(e,t))},i.prototype.subscribeClick=function(e){this._private__clickedDelegate.subscribe(e)},i.prototype.unsubscribeClick=function(e){this._private__clickedDelegate.unsubscribe(e)},i.prototype.subscribeCrosshairMove=function(e){this._private__crosshairMovedDelegate.subscribe(e)},i.prototype.unsubscribeCrosshairMove=function(e){this._private__crosshairMovedDelegate.unsubscribe(e)},i.prototype.subscribeCustomPriceLineDragged=function(e){this._private__customPriceLineDraggedDelegate.subscribe(e)},i.prototype.unsubscribeCustomPriceLineDragged=function(e){this._private__customPriceLineDraggedDelegate.unsubscribe(e)},i.prototype.priceScale=function(e){return e===void 0&&(Or("Using ChartApi.priceScale() method without arguments has been deprecated, pass valid price scale id instead"),e=this._private__chartWidget._internal_model().defaultVisiblePriceScaleId()),new Ys(this._private__chartWidget,e)},i.prototype.timeScale=function(){return this._private__timeScaleApi},i.prototype.applyOptions=function(e){this._private__chartWidget._internal_applyOptions(nr(e))},i.prototype.options=function(){return this._private__chartWidget._internal_options()},i.prototype.takeScreenshot=function(){return this._private__chartWidget._internal_takeScreenshot()},i.prototype._private__sendUpdateToChart=function(e){var t=this._private__chartWidget._internal_model();t.updateTimeScale(e._internal_timeScale._internal_baseIndex,e._internal_timeScale._internal_points,e._internal_timeScale._internal_firstChangedPointIndex),e._internal_series.forEach(function(r,a){return a.setData(r._internal_data,r._internal_info)}),t.recalculateAllPanes()},i.prototype._private__mapSeriesToApi=function(e){return se(this._private__seriesMapReversed.get(e))},i.prototype._private__convertMouseParams=function(e){var t=this,r=new Map;e._internal_seriesPrices.forEach(function(n,_){r.set(t._private__mapSeriesToApi(_),n)});var a=e._internal_hoveredSeries===void 0?void 0:this._private__mapSeriesToApi(e._internal_hoveredSeries);return{time:e._internal_time&&(e._internal_time.businessDay||e._internal_time.timestamp),point:e._internal_point,hoveredSeries:a,hoveredMarkerId:e._internal_hoveredObject,seriesPrices:r}},i.prototype._private__convertCustomPriceLineDraggedParams=function(e){return{customPriceLine:e._internal_customPriceLine,fromPriceString:e._internal_fromPriceString}},i}();function Zs(i,e){var t;if(Jt(i)){var r=document.getElementById(i);re(r!==null,"Cannot find element in DOM with id=".concat(i)),t=r}else t=i;return new Gs(t,e)}const Ks="/build/assets/alert-4d705e53.mp3";const Js={class:"content-block dx-card responsive-paddings"},Qs={class:"area data-area"},eo=["title"],to=["title"],io={class:"command noaction clock"},ro=["title"],ao={class:"area tool-area"},no=["title"],_o=["title"],so=["title"],oo=["title"],lo=["title"],po=["title"],co=["title"],vo=["title"],ho=["title"],uo=["title"],fo=["title"],mo=["title"],go=["title"],yo=["title"],bo=["src"],_r=3,sr=2,So=120,Co={__name:"Index",setup(i){const e={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:20,minBarSpacing:.01}},t=moment().format("YYYY-MM-DD"),r={START:moment(t+" 08:45:00").unix(),ATO:moment(t+" 09:00:00").unix(),ATC:moment(t+" 14:30:00").unix(),END:moment(t+" 14:45:00").unix()},a=Ia(),{t:n}=Ba(),_=st("devices"),o=st("mf"),l=st("bus"),v=st("filters"),c=Y(null),u=Y(null),d=Y(null),m=Y(null),g=Y(null),S=Y(null),y=Y(null),b=Y(null),x=Y(null),D=Y(null),V=Y(null),E=Y(null),W=Y(null),H=Y(null),G=Y(null),Z=Y(null),j=Y(null),fe=Y(null),Qe=Y(null);let s={chart:{},series:{},data:{whitespace:[],price:[],volume:[],spread:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},l1:{},l2:{},l3:{},l4:{},l5:{},pointCount:0},pattern1:{A:{},B:{},C:{},X:{},Y:{},Z:{}},pattern2:{E:{},S:{},T:{}},volprofile:{v1:{},v2:{},poc:{},pointCount:0},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const A=Fa({chartDate:t,clock:moment().format("HH:mm:ss"),isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),X=ui(()=>a.state.tradingOrder.status),et=ui(()=>`https://chart.vps.com.vn/tv/?loadLastChart=true&symbol=VN30F1M&u=${a.state.tradingOrder.config.vpsCode}&s=${a.state.tradingOrder.config.vpsSession}&resolution=1`);a.dispatch("tradingOrder/getConfig").then(()=>{Rt()}),a.dispatch("tradingOrder/getStatus"),s.interval=setInterval(Xr,1e3),s.interval60=setInterval(()=>a.dispatch("tradingOrder/getStatus"),6e4),w.create(),Wa(()=>{s.chart=Zs(u.value,e),c.value.addEventListener("click",Ne),c.value.addEventListener("contextmenu",ze),s.chart.subscribeCrosshairMove(Lt),s.chart.subscribeCustomPriceLineDragged(Ir),s.series.whitespace=s.chart.addLineSeries({priceScaleId:"whitespace",visible:!1}),s.series.signal=s.chart.addHistogramSeries({priceScaleId:"signal",scaleMargins:{top:0,bottom:0},color:"#673AB7",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),s.series.box=s.chart.addHistogramSeries({priceScaleId:"box",scaleMargins:{top:0,bottom:0},color:"#26a69a",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),s.series.volprofile=s.chart.addHistogramSeries({priceScaleId:"volprofile",scaleMargins:{top:0,bottom:0},color:"#673AB7",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),s.series.volume=s.chart.addHistogramSeries({priceScaleId:"volume",scaleMargins:{top:.95,bottom:0},color:"#CCCCCC",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),s.series.spread=s.chart.addHistogramSeries({priceScaleId:"spread",scaleMargins:{top:0,bottom:.95},color:"#CCCCCC",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),s.series.cash=s.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",lastValueVisible:!1}),s.series.price=s.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.1}}),new ResizeObserver(Br).observe(c.value),document.addEventListener("keydown",Fr),document.addEventListener("fullscreenchange",Wr),a.dispatch("tradingOrder/getChartData",A.chartDate).then(()=>{Nr()})}),za(()=>{clearInterval(s.interval),clearInterval(s.interval60),s.socketStop=!0,s.websocket.close(),s.websocket=null}),di(()=>a.state.tradingOrder.chartData,Hr),di(()=>a.state.tradingOrder.isChartLoading,p=>{d.value.style.display=p?"block":"none"});function ze(p){$r(),p.preventDefault()}function Ne(){Dt(),b.value.classList.contains("selected")?tt():H.value.classList.contains("selected")?ia():x.value.classList.contains("selected")?na():D.value.classList.contains("selected")?oa():V.value.classList.contains("selected")?ci():W.value.classList.contains("selected")?ua():E.value.classList.contains("selected")?(Et(),hi()):G.value.classList.contains("selected")&&Sa()}function Lt(p){if(p.time){var h=p.seriesPrices.get(s.series.price);s.crosshair.time=p.time,s.crosshair.price=h}else _.phone||(s.crosshair.time=null,s.crosshair.price=null);p.point!=null&&(s.crosshair.x=p.point.x,s.crosshair.y=p.point.y)}function Ir(p){var h=p.customPriceLine,f=h.options();f.price=at(f.price);const P=+p.fromPriceString,T=f.price;switch(f.lineType){case"order":if(T!=P){var M=!1;f.kind=="entry"?X.value.position||(M=!0,s.order[f.kind].price=T,a.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"change",price:s.order.entry.price}}).then(L=>{L.isOk?(ce(f.kind),J.success(n("trading.orderChart.changeEntrySuccess"))):(h.applyOptions({price:P}),ie(L.message))})):(M=!0,s.order[f.kind].price=T,f.kind=="tp"?a.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"change",price:s.order.tp.price}}).then(L=>{L.isOk?(ce(f.kind),J.success(n("trading.orderChart.changeTpSuccess"))):(h.applyOptions({price:P}),ie(L.message))}):a.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"change",price:s.order.sl.price}}).then(L=>{L.isOk?(ce(f.kind),J.success(n("trading.orderChart.changeSlSuccess"))):(h.applyOptions({price:P}),ie(L.message))})),M||(h.applyOptions({price:P}),J.show(n("trading.orderChart.noChangeOrderLine")))}break;case"line":w.set("line",{price:P,removed:!0}),w.set("line",f),b.value.classList.remove("selected");break;case"ruler":switch(f.point){case"l0":if(w.set("ruler",f),s.ruler.pointCount==2){const pe=+s.ruler.l1.options().title,Me=+(T+pe).toFixed(1);s.ruler.l1.applyOptions({price:Me}),w.set("ruler",s.ruler.l1.options());const nt=+(T+pe*2).toFixed(1);s.ruler.l2.applyOptions({price:nt}),w.set("ruler",s.ruler.l2.options());const _t=+(T+pe*3).toFixed(1);s.ruler.l3.applyOptions({price:_t}),w.set("ruler",s.ruler.l3.options());const Aa=+(T+pe*4).toFixed(1);s.ruler.l4.applyOptions({price:Aa}),w.set("ruler",s.ruler.l4.options());const Ea=+(T+pe*5).toFixed(1);s.ruler.l5.applyOptions({price:Ea}),w.set("ruler",s.ruler.l5.options())}break;case"l1":const L=+s.ruler.l0.options().price,z=T-L;h.applyOptions({title:z.toFixed(1)}),w.set("ruler",h.options()),s.ruler.l2.applyOptions({title:(z*2).toFixed(1),price:+(L+z*2).toFixed(1)}),w.set("ruler",s.ruler.l2.options()),s.ruler.l3.applyOptions({title:(z*3).toFixed(1),price:+(L+z*3).toFixed(1)}),w.set("ruler",s.ruler.l3.options()),s.ruler.l4.applyOptions({title:(z*4).toFixed(1),price:+(L+z*4).toFixed(1)}),w.set("ruler",s.ruler.l4.options()),s.ruler.l5.applyOptions({title:(z*5).toFixed(1),price:+(L+z*5).toFixed(1)}),w.set("ruler",s.ruler.l5.options());break;case"l2":const Q=+s.ruler.l0.options().price,N=T-Q;h.applyOptions({title:N.toFixed(1)}),w.set("ruler",h.options()),s.ruler.l1.applyOptions({title:(N*.5).toFixed(1),price:+(Q+N*.5).toFixed(1)}),w.set("ruler",s.ruler.l1.options()),s.ruler.l3.applyOptions({title:(N*1.5).toFixed(1),price:+(Q+N*1.5).toFixed(1)}),w.set("ruler",s.ruler.l3.options()),s.ruler.l4.applyOptions({title:(N*2).toFixed(1),price:+(Q+N*2).toFixed(1)}),w.set("ruler",s.ruler.l4.options()),s.ruler.l5.applyOptions({title:(N*2.5).toFixed(1),price:+(Q+N*2.5).toFixed(1)}),w.set("ruler",s.ruler.l5.options());break;case"l3":const ae=+s.ruler.l0.options().price,R=T-ae;h.applyOptions({title:R.toFixed(1)}),w.set("ruler",h.options()),s.ruler.l1.applyOptions({title:(R/3).toFixed(1),price:+(ae+R/3).toFixed(1)}),w.set("ruler",s.ruler.l1.options()),s.ruler.l2.applyOptions({title:(R*2/3).toFixed(1),price:+(ae+R*2/3).toFixed(1)}),w.set("ruler",s.ruler.l2.options()),s.ruler.l4.applyOptions({title:(R*4/3).toFixed(1),price:+(ae+R*4/3).toFixed(1)}),w.set("ruler",s.ruler.l4.options()),s.ruler.l5.applyOptions({title:(R*5/3).toFixed(1),price:+(ae+R*5/3).toFixed(1)}),w.set("ruler",s.ruler.l5.options());break;case"l4":const oe=+s.ruler.l0.options().price,le=T-oe;h.applyOptions({title:le.toFixed(1)}),w.set("ruler",h.options()),s.ruler.l1.applyOptions({title:(le/4).toFixed(1),price:+(oe+le/4).toFixed(1)}),w.set("ruler",s.ruler.l1.options()),s.ruler.l2.applyOptions({title:(le/2).toFixed(1),price:+(oe+le/2).toFixed(1)}),w.set("ruler",s.ruler.l2.options()),s.ruler.l3.applyOptions({title:(le*3/4).toFixed(1),price:+(oe+le*3/4).toFixed(1)}),w.set("ruler",s.ruler.l3.options()),s.ruler.l5.applyOptions({title:(le*5/4).toFixed(1),price:+(oe+le*5/4).toFixed(1)}),w.set("ruler",s.ruler.l5.options());break;case"l5":const Te=+s.ruler.l0.options().price,K=T-Te;h.applyOptions({title:K.toFixed(1)}),w.set("ruler",h.options()),s.ruler.l1.applyOptions({title:(K/5).toFixed(1),price:+(Te+K/5).toFixed(1)}),w.set("ruler",s.ruler.l1.options()),s.ruler.l2.applyOptions({title:(K*2/5).toFixed(1),price:+(Te+K*2/5).toFixed(1)}),w.set("ruler",s.ruler.l2.options()),s.ruler.l3.applyOptions({title:(K*3/5).toFixed(1),price:+(Te+K*3/5).toFixed(1)}),w.set("ruler",s.ruler.l3.options()),s.ruler.l4.applyOptions({title:(K*4/5).toFixed(1),price:+(Te+K*4/5).toFixed(1)}),w.set("ruler",s.ruler.l4.options());break}break;case"pattern1":if(o.isSet(s.pattern1.X)){const L=+s.pattern1.A.options().price,z=+s.pattern1.B.options().price,Q=+s.pattern1.C.options().price,N=z-L;s.pattern1.X.applyOptions({price:+(Q+N).toFixed(1),title:N.toFixed(1)}),w.set("pattern1",s.pattern1.X.options()),s.pattern1.Y.applyOptions({price:+(Q+1.5*N).toFixed(1),title:(1.5*N).toFixed(1)}),w.set("pattern1",s.pattern1.Y.options()),s.pattern1.Z.applyOptions({price:+(Q+2*N).toFixed(1),title:(2*N).toFixed(1)}),w.set("pattern1",s.pattern1.Z.options())}break;case"pattern2":if(o.isSet(s.pattern2.T)){const L=s.pattern2.E.options(),z=+L.price1,Q=+L.price2,N=+L.price3,ae=+L.price4,R=+L.price,oe=N-Q,le=z-ae,Te=N-ae,K=R-ae;let pe,Me;f.point=="S"?(Me=+s.pattern2.S.options().price,pe=R-Me):(pe=Math.abs(oe)>Math.abs(K/2)?oe:K/2,Me=R-pe,s.pattern2.S.applyOptions({price:+Me.toFixed(1)}));const nt=Me+(Math.abs(K)>Math.abs(Te)?Math.abs(K)>Math.abs(le)?1:1.5:2)*K,_t=nt-R;s.pattern2.S.applyOptions({title:`SL=${(-pe).toFixed(1)}`}),w.set("pattern2",s.pattern2.S.options()),s.pattern2.E.applyOptions({title:`RR=${(_t/pe).toFixed(1)}`}),w.set("pattern2",s.pattern2.E.options()),s.pattern2.T.applyOptions({price:+nt.toFixed(1),title:`TP=${_t.toFixed(1)}`}),w.set("pattern2",s.pattern2.T.options())}break;case"alert":w.set("alert",{price:P,removed:!0});const O=s.data.price.slice(-1)[0].value;var k=T>=O?">":"<";h.applyOptions({title:k}),w.set("alert",h.options()),G.value.classList.remove("selected");break}}function Br(){c.value&&(s.chart.resize(c.value.offsetWidth,c.value.offsetHeight),c.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Fr(p){if(p.ctrlKey||p.metaKey)switch(p.keyCode){case 38:s.chart.timeScale().applyOptions({barSpacing:s.chart.options().timeScale.barSpacing+.05});break;case 40:s.chart.timeScale().applyOptions({barSpacing:s.chart.options().timeScale.barSpacing-.05});break;case 37:s.chart.timeScale().scrollToPosition(s.chart.timeScale().scrollPosition()-10);break;case 39:s.chart.timeScale().scrollToPosition(s.chart.timeScale().scrollPosition()+10);break;case 96:x.value.click();break;case 97:b.value.click();break;case 98:g.value.click();break;case 99:m.value.click();case 100:S.value.click();break}}function Wr(){c.value&&(document.fullscreenElement?(A.isFullscreen=!0,c.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(A.isFullscreen=!1,c.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function zr(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Nr(){return new Promise(async p=>{X.value.pending&&((await w.get("order")).map(z=>{s.order.side=z.side,s.order[z.kind].price=z.price,ce(z.kind),ge(!0)}),s.order.tp.hasOwnProperty("line")&&s.order.entry.line.applyOptions({draggable:!1})),(await w.get("line")).forEach(L=>{L.removed||s.lines.push(s.series.price.createPriceLine(L))});const f=await w.get("box");f.length==2&&(s.box=f,s.series.box.setData([f[0].x,f[1].x]),s.box[0].y=s.series.price.createPriceLine(f[0].y),s.box[1].y=s.series.price.createPriceLine(f[1].y));const P=await w.get("ruler");P.length>0&&(s.ruler.pointCount=P.length>1?2:1,P.forEach(L=>{s.ruler[L.point]=s.series.price.createPriceLine(L)}));const T=await w.get("pattern1");T.length>0&&T.forEach(L=>{s.pattern1[L.point]=s.series.price.createPriceLine(L)});const M=await w.get("pattern2");M.length>0&&M.forEach(L=>{s.pattern2[L.point]=s.series.price.createPriceLine(L)});const k=await w.get("volprofile");k.length>0&&(s.volprofile.v1=k[0],s.volprofile.pointCount++,s.series.volprofile.update(s.volprofile.v1),k.length==2&&(s.volprofile.v2=k[1],s.volprofile.pointCount++,s.series.volprofile.update(s.volprofile.v2)),At()),(await w.get("alert")).forEach(L=>{L.removed||s.alerts.push(s.series.price.createPriceLine(L))}),p()})}function Hr(){s.loadWhitespace&&(a.state.tradingOrder.chartData.price.length>0&&(s.data.whitespace=me(s.data.whitespace,Yr())),s.series.whitespace.setData(s.data.whitespace),s.loadWhitespace=!1),s.data.price=me(a.state.tradingOrder.chartData.price,s.data.price),s.series.price.setData(s.data.price),s.data.cash=me(a.state.tradingOrder.chartData.cash,s.data.cash),s.series.cash.setData(s.data.cash),s.data.volume=me(a.state.tradingOrder.chartData.volume,s.data.volume),s.series.volume.setData(s.data.volume),s.data.spread=me(a.state.tradingOrder.chartData.spread,s.data.spread),s.series.spread.setData(s.data.spread),s.shark=a.state.tradingOrder.chartData.shark}function Ur(p,h,f,P){s.data.price=me([p],s.data.price);const T=s.data.price.slice(-1)[0];s.series.price.update(T),s.data.volume=me([h],s.data.volume);const M=s.data.volume.slice(-1)[0];s.series.volume.update(M),s.data.spread=me([f],s.data.spread);const k=s.data.spread.slice(-1)[0];s.series.spread.update(k),s.data.cash=me([P],s.data.cash);const O=s.data.cash.slice(-1)[0];s.series.cash.update(O)}function Yr(){const p=A.chartDate,h=moment(`${p} 09:00:00`).unix(),f=moment(`${p} 11:30:00`).unix(),P=moment(`${p} 13:00:00`).unix(),T=moment(`${p} 14:30:00`).unix();var M=[],k;for(k=h;k<=f;k++)M.push({time:k+7*60*60});for(k=P;k<=T;k++)M.push({time:k+7*60*60});return M}function me(p,h){return Array.from(new Map([...p,...h].sort((f,P)=>f.time-P.time).map(f=>[f.time,f])).values())}function Rt(){const p="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket";s.websocket=new WebSocket(p),s.websocket.onopen=h=>{var f={action:"join",list:a.state.tradingOrder.config.symbol};s.websocket.send(`42${JSON.stringify(["regs",JSON.stringify(f)])}`)},s.websocket.onclose=h=>{if(s.socketStop)return!1;rt()&&(Rt(),moment().diff(s.socketRefreshTime,"seconds")>So&&(a.dispatch("tradingOrder/getChartData",A.chartDate),s.socketRefreshTime=moment()))},s.websocket.onmessage=h=>{if(h.data.substr(0,1)==4&&h.data.substr(1,1)==2){const f=JSON.parse(h.data.substr(2));if(f[0]=="stockps"){const P=f[1].data;if(P.id==3220){const T=moment(`${t} ${P.time}`).unix()+25200,M=s.data.price.length>0?P.lastPrice-s.data.price.slice(-1)[0].value:0;Ur({time:T,value:P.lastPrice},{time:T,value:P.lastVol,color:M>0?"#00FF00":M<0?"#FF0000":"#CCCCCC"},{time:T,value:-Math.abs(M),color:M>0?"#00FF00":M<0?"#FF0000":"#CCCCCC"},{time:T,value:s.data.cash.slice(-1)[0].value+M*P.lastVol}),Ma()}}}}}function Xr(){const p=moment().unix();rt(p)&&(X.value.position&&p>r.ATC-5*60&&(qr(),p>r.ATC-15&&s.order.tp.hasOwnProperty("line")&&a.dispatch("tradingOrder/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(h=>{h.isOk?(te("entry"),te("tp"),te("sl"),ge(!1),w.clear("order"),J.success(n("trading.orderChart.autoCancelTpSlSuccess")),He()):ie(h.message)})),p==r.START&&Rt(),s.alerts.forEach(h=>{const f=h.options();if(!f.removed&&s.data.price.length){const P=s.data.price.slice(-1)[0].value;(f.title==">"&&P>=f.price||f.title=="<"&&P<=f.price)&&He()}})),A.clock=moment().format("HH:mm:ss")}function $r(){if(a.state.tradingOrder.config.openingMarket){const f=moment().unix();if(rt(f)&&(s.order.tp.hasOwnProperty("line")||X.value.position&&f>r.ATO&&f<r.ATC&&(s.order.entry.price=s.data.price.slice(-1)[0].value,s.order.side=X.value.position,fe.value.style.left=+(s.crosshair.x+(s.crosshair.x>innerWidth-61?-61:1))+"px",fe.value.style.top=+(s.crosshair.y+(s.crosshair.y>innerHeight-51?-51:1))+"px",fe.value.style.display="block"),!s.order.entry.hasOwnProperty("line"))){var p=null,h=0;X.value.position?(f<r.ATO?p="ATO":f>r.ATC&&(p="ATC"),p&&(s.order.entry.price=p,h=-X.value.position)):f>r.ATO&&f<r.ATC&&(p=Pe(s.crosshair.y),h=p>=s.data.price.slice(-1)[0].value?1:-1,s.order.side=h,s.order.entry.price=p),h&&(j.value.style.left=+(s.crosshair.x+(s.crosshair.x>innerWidth-71?-71:1))+"px",j.value.style.top=+(s.crosshair.y+(s.crosshair.y>innerHeight-61?-61:1))+"px",j.value.style.background=h>0?"green":"red",j.value.innerText=`${h>0?"LONG":"SHORT"} ${p}`,j.value.style.display="block")}}}function Dt(){j.value.style.display="none",fe.value.style.display="none"}function ge(p){Z.value.style.display=p?"block":"none"}function qr(){Z.value.classList.contains("warning")?Z.value.classList.remove("warning"):Z.value.classList.add("warning")}function ce(p){var h,f;switch(p){case"entry":h="yellow",f=s.order.side>0?"LONG":"SHORT";break;case"tp":h="lime",f=Math.abs(s.order.tp.price-s.order.entry.price).toFixed(1);break;case"sl":h="red",f=Math.abs(s.order.sl.price-s.order.entry.price).toFixed(1);break}s.order[p].hasOwnProperty("line")?s.order[p].line.applyOptions({price:s.order[p].price,title:f}):s.order[p].line=s.series.price.createPriceLine({lineType:"order",kind:p,price:s.order[p].price,color:h,lineWidth:1,lineStyle:0,title:f,draggable:!0}),w.set("order",{kind:p,price:+s.order[p].price,side:s.order.side})}function te(p){s.order[p].hasOwnProperty("line")&&(s.series.price.removePriceLine(s.order[p].line),delete s.order[p].line)}function jr(p){A.showTradingView=!A.showTradingView,p.stopPropagation()}function Gr(p){A.showColorPicker=!A.showColorPicker,p.stopPropagation()}function Zr(p){o.isSet(s.pattern1.X)&&(tt(+s.pattern1.X.options().price),tt(+s.pattern1.Y.options().price),tt(+s.pattern1.Z.options().price)),p.preventDefault(),p.stopPropagation()}function Kr(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||p.target.classList.add("selected"),p.stopPropagation()}function Jr(p){Qr(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function tt(p=null,h=null,f=null){const P="line";p||(p=at(Pe(s.crosshair.y))),h||(h=A.color);const T=s.lines.length;if(s.lines=s.lines.filter(M=>{const k=M.options(),O=k.type=p==+k.price;return O&&(s.series.price.removePriceLine(M),w.set("line",{price:p,removed:!0})),!O}),s.lines.length==T){const M={lineType:P,price:p,color:h,title:f,lineWidth:1,lineStyle:1,draggable:!0};s.lines.push(s.series.price.createPriceLine(M)),w.set("line",M)}b.value.classList.remove("selected")}function Qr(){s.lines.forEach(p=>s.series.price.removePriceLine(p)),s.lines=[],w.clear("line")}function ea(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||p.target.classList.add("selected"),p.stopPropagation()}function ta(p){oi(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function ia(){if(s.crosshair.time){const p={value:Pe(s.crosshair.y),time:s.crosshair.time};if(s.box.length==0)Ot({point2:p});else if(s.box.length==1)Ot({point3:p});else{const h={value:+s.box[0].y.options().price,time:s.box[0].x.time},f={value:+s.box[1].y.options().price,time:s.box[1].x.time};oi(),Ot({point2:h,point3:f,point4:p}),H.value.classList.remove("selected")}}}function Ot({point2:p,point3:h,point4:f}){let P={y:{color:"#26a69a",lineWidth:1,lineStyle:1,draggable:!1},x:{value:1}};if(o.isSet(f)){const T=s.data.whitespace.findIndex(L=>L.time===p.time),M=s.data.whitespace.findIndex(L=>L.time===h.time),O=s.data.whitespace.findIndex(L=>L.time===f.time)+M-T;if(O>=s.data.whitespace.length)return!1;P.y.price=f.value,P.x.time=f.time,it(0,P),P.y.price=f.value+h.value-p.value,P.x.time=s.data.whitespace[O].time,it(1,P)}else o.isSet(p)&&(P.y.price=p.value,P.x.time=p.time,it(0,P)),o.isSet(h)&&(P.y.price=h.value,P.x.time=h.time,it(1,P))}function it(p,h){h.point=p,h.y.title=`B${p+1}`,s.box.push(o.cloneDeep(h)),w.set("box",s.box[p]),s.series.box.update(s.box[p].x),s.box[p].y=s.series.price.createPriceLine(s.box[p].y)}function oi(){s.box.length>0&&(s.series.price.removePriceLine(s.box[0].y),s.box.length>1&&s.series.price.removePriceLine(s.box[1].y)),s.series.box.setData([]),s.box=[],w.clear("box")}function ra(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||(p.target.classList.add("selected"),li()),p.stopPropagation()}function aa(p){li(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function na(){const p=Pe(s.crosshair.y);var h={lineType:"ruler",price:p,lineWidth:1,lineStyle:1,draggable:!0};if(s.ruler.pointCount==0)h.point="l0",h.color="#F44336",h.title="0",s.ruler[h.point]=s.series.price.createPriceLine(h),s.ruler.pointCount++,w.set("ruler",h);else{const f=+s.ruler.l0.options().price,P=p-f;h.point="l1",h.color="#FF9800",h.title=P.toFixed(1),s.ruler[h.point]=s.series.price.createPriceLine(h),w.set("ruler",h);const T=2*P;h.point="l2",h.color="#FFEB3B",h.title=T.toFixed(1),h.price=+(f+T).toFixed(1),s.ruler[h.point]=s.series.price.createPriceLine(h),w.set("ruler",h);const M=3*P;h.point="l3",h.color="#4CAF50",h.title=M.toFixed(1),h.price=+(f+M).toFixed(1),s.ruler[h.point]=s.series.price.createPriceLine(h),w.set("ruler",h);const k=4*P;h.point="l4",h.color="#009688",h.title=k.toFixed(1),h.price=+(f+k).toFixed(1),s.ruler[h.point]=s.series.price.createPriceLine(h),w.set("ruler",h);const O=5*P;h.point="l5",h.color="#00BCD4",h.title=O.toFixed(1),h.price=+(f+O).toFixed(1),s.ruler[h.point]=s.series.price.createPriceLine(h),w.set("ruler",h),s.ruler.pointCount++,x.value.classList.remove("selected")}}function li(){s.ruler.pointCount>0&&(s.series.price.removePriceLine(s.ruler.l0),s.ruler.pointCount>1&&(s.series.price.removePriceLine(s.ruler.l1),s.series.price.removePriceLine(s.ruler.l2),s.series.price.removePriceLine(s.ruler.l3),s.series.price.removePriceLine(s.ruler.l4),s.series.price.removePriceLine(s.ruler.l5)),s.ruler={l0:{},l1:{},l2:{},l3:{},l4:{},l5:{},pointCount:0},w.clear("ruler"))}function _a(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||(p.target.classList.add("selected"),pi()),p.stopPropagation()}function sa(p){pi(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function oa(){var h={lineType:"pattern1",price:Pe(s.crosshair.y),lineWidth:1,lineStyle:1,draggable:!0};if(o.isSet(s.pattern1.A)?o.isSet(s.pattern1.B)?o.isSet(s.pattern1.C)||(h.point="C",h.title="C",h.color="#E91E63"):(h.point="B",h.title="B",h.color="#009688"):(h.point="A",h.title="A",h.color="#009688"),s.pattern1[h.point]=s.series.price.createPriceLine(h),w.set("pattern1",h),h.point=="C"){const f=+s.pattern1.A.options().price,P=+s.pattern1.B.options().price,T=+s.pattern1.C.options().price,M=P-f;h.point="X",h.price=+(T+M).toFixed(1),h.title=M.toFixed(1),h.color="#9C27B0",h.draggable=!1,s.pattern1[h.point]=s.series.price.createPriceLine(h),w.set("pattern1",h),h.point="Y",h.price=+(T+1.5*M).toFixed(1),h.title=(1.5*M).toFixed(1),h.color="#673AB7",s.pattern1[h.point]=s.series.price.createPriceLine(h),w.set("pattern1",h),h.point="Z",h.price=+(T+2*M).toFixed(1),h.title=(2*M).toFixed(1),h.color="#2196F3",s.pattern1[h.point]=s.series.price.createPriceLine(h),w.set("pattern1",h),D.value.classList.remove("selected")}}function pi(){o.isSet(s.pattern1.A)&&(s.series.price.removePriceLine(s.pattern1.A),o.isSet(s.pattern1.B)&&(s.series.price.removePriceLine(s.pattern1.B),o.isSet(s.pattern1.C)&&(s.series.price.removePriceLine(s.pattern1.C),s.series.price.removePriceLine(s.pattern1.X),s.series.price.removePriceLine(s.pattern1.Y),s.series.price.removePriceLine(s.pattern1.Z))),s.pattern1={A:{},B:{},C:{},X:{},Y:{},Z:{}},w.clear("pattern1"))}function la(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||(p.target.classList.add("selected"),ci(!0)),p.stopPropagation()}function pa(p){vi(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function ci(p=!1){let h={};if(o.isSet(s.pattern2.E)){const oe=s.pattern2.E.options();h={time:oe.time1,value:oe.price1},vi()}else{if(p)return!1;h={time:s.crosshair.time,value:Pe(s.crosshair.y)}}const{point2:f,point3:P,point4:T,point5:M}=ca(h);if(f.value==h.value)return!1;const k=P.value-f.value,O=P.value-T.value,L=M.value-T.value,z=Math.abs(k)>Math.abs(L/2)?k:L/2,Q=M.value-z,N=Q+(Math.abs(L)>Math.abs(O)?1.5:2)*L,ae=N-M.value;var R={lineType:"pattern2",lineWidth:1,lineStyle:1};R.price=M.value,R.time1=h.time,R.price1=h.value,R.price2=f.value,R.price3=P.value,R.price4=T.value,R.point="E",R.title=`RR=${(ae/z).toFixed(1)}`,R.color="#FF9800",R.draggable=!0,s.pattern2[R.point]=s.series.price.createPriceLine(R),w.set("pattern2",R),R.price=+Q.toFixed(1),R.point="S",R.title=`SL=${(-z).toFixed(1)}`,R.color="#E91E63",R.draggable=!0,s.pattern2[R.point]=s.series.price.createPriceLine(R),w.set("pattern2",R),R.point="T",R.price=+N.toFixed(1),R.title=`TP=${ae.toFixed(1)}`,R.color="#2196F3",R.draggable=!1,s.pattern2[R.point]=s.series.price.createPriceLine(R),w.set("pattern2",R),V.value.classList.remove("selected")}function ca(p){let h=0,f=0,P=p,T=p,M=p,k=p;for(let O of s.data.price)if(O.time>=p.time){if(O.value<p.value){if(P.value>T.value)break;if(O.value<M.value)h>f&&(P=M,T=k,f=h),M=O,k=O,h=0;else if(O.value>M.value){if(O.value>p.value)break;O.value>k.value&&(k=O,h=+Math.abs(k.value-M.value).toFixed(1))}}else if(O.value>p.value){if(P.value<T.value)break;if(O.value>M.value)h>f&&(P=M,T=k,f=h),M=O,k=O,h=0;else if(O.value<M.value){if(O.value<p.value)break;O.value<k.value&&(k=O,h=+Math.abs(k.value-M.value).toFixed(1))}}}return{point2:P,point3:T,point4:M,point5:k}}function vi(){o.isSet(s.pattern2.T)&&(s.series.price.removePriceLine(s.pattern2.E),s.series.price.removePriceLine(s.pattern2.S),s.series.price.removePriceLine(s.pattern2.T),s.pattern2={E:{},S:{},T:{}},w.clear("pattern2"))}function va(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h?At():p.target.classList.add("selected"),p.stopPropagation()}function ha(p){fa(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function ua(){s.crosshair.time&&(s.volprofile.pointCount==0?(s.volprofile.v1={time:s.crosshair.time,value:1},s.series.volprofile.setData([s.volprofile.v1]),s.volprofile.pointCount++,w.set("volprofile",s.volprofile.v1)):s.crosshair.time>s.volprofile.v1.time&&(s.volprofile.v2={time:s.crosshair.time,value:1},s.series.volprofile.setData([s.volprofile.v1,s.volprofile.v2]),o.isSet(s.volprofile.v2)&&(w.clear("volprofile"),w.set("volprofile",s.volprofile.v1)),w.set("volprofile",s.volprofile.v2),At(),s.volprofile.pointCount++,W.value.classList.remove("selected")))}function At(){if(o.isSet(s.volprofile.v1)){const p=s.volprofile.v1.time,h=o.isSet(s.volprofile.v2)?s.volprofile.v2.time:moment().unix()+7*60*60,f=da(p,h),P={price:f.price,buy:f.buy,sell:f.sell,title:`POC ${f.buy} - ${f.sell}`,color:f.buy>=f.sell?"#2196F3":"#9C27B0",lineWidth:1,lineStyle:1,draggable:!1};o.isSet(s.volprofile.poc)&&s.series.price.removePriceLine(s.volprofile.poc),s.volprofile.poc=s.series.price.createPriceLine(P)}}function da(p,h){const f=s.data.price.filter(k=>k.time>=p&&k.time<=h),P=s.data.volume.filter(k=>k.time>=p&&k.time<=h);let T={};for(let k=0;k<f.length;k++)T[f[k].value]||(T[f[k].value]={buy:0,sell:0,total:0}),P[k].color=="#00FF00"&&(T[f[k].value].buy+=P[k].value),P[k].color=="#FF0000"&&(T[f[k].value].sell+=P[k].value),T[f[k].value].total+=P[k].value;const M=Object.keys(T).reduce((k,O)=>T[k].total>T[O].total?k:O);return{price:+M,buy:T[M].buy,sell:T[M].sell}}function fa(){o.isSet(s.volprofile.poc)&&s.series.price.removePriceLine(s.volprofile.poc),s.volprofile={v1:{},v2:{},poc:{},pointCount:0},s.series.volprofile.setData([]),w.clear("volprofile")}function ma(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h?hi(0):(p.target.classList.add("selected"),Et()),p.stopPropagation()}function ga(p){Et(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function hi(p=-1){p==-1&&(p=s.data.volume.findIndex(h=>h.time>=s.crosshair.time),s.volumeMax=s.data.volume[p].value-1,E.value.classList.remove("selected"));for(let h=p;h<s.data.volume.length;h++)s.data.volume[h].value>s.volumeMax&&(s.volumeMax=s.data.volume[h].value,s.series.signal.update({time:s.data.volume[h].time,value:1}))}function Et(){s.volumeMax=a.state.tradingOrder.config.volLimit,s.series.signal.setData([])}function ya(p){A.showColorPicker=!1;const h=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(f=>f.classList.remove("selected")),h||p.target.classList.add("selected"),p.stopPropagation()}function ba(p){Ca(),p.target.classList.remove("selected"),p.preventDefault(),p.stopPropagation()}function Sa(){const p="alert",h=at(Pe(s.crosshair.y)),f=s.alerts.length;if(s.alerts=s.alerts.filter(P=>{const T=P.options(),M=T.type=h==+T.price;return M&&(s.series.price.removePriceLine(P),w.set("alert",{price:h,removed:!0})),!M}),s.alerts.length==f){const P={lineType:p,price:h,title:h>=s.data.price.slice(-1)[0].value?">":"<",color:"red",lineWidth:1,lineStyle:1,draggable:!0};s.alerts.push(s.series.price.createPriceLine(P)),w.set("alert",P)}G.value.classList.remove("selected")}function Ca(){s.alerts.forEach(p=>s.series.price.removePriceLine(p)),s.alerts=[],w.clear("alert")}async function wa(){s.order.entry.hasOwnProperty("line")&&(s.order.tp.hasOwnProperty("line")?a.dispatch("tradingOrder/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(p=>{p.isOk?(te("entry"),te("tp"),te("sl"),ge(!1),w.clear("order"),J.success(n("trading.orderChart.exitSuccess"))):(ge(!0),ie(p.message))}):a.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"delete"}}).then(p=>{p.isOk?(te("entry"),ge(!1),w.clear("order"),J.success(n("trading.orderChart.deleteEntrySuccess"))):(ge(!0),ie(p.message))}))}function Pa(){const p=moment().unix();rt(p)&&(p<r.ATO?mi(n("trading.orderChart.atoOrder"),n("titles.confirm")).then(f=>{f&&a.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(P=>{P.isOk?J.success(n("trading.orderChart.atoOrderSuccess")):ie(P.message)})}):p<r.ATC?a.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"new",side:s.order.side,price:s.order.entry.price}}).then(h=>{h.isOk?(ce("entry"),ge(!0),J.success(n("trading.orderChart.newEntrySuccess"))):ie(h.message)}):mi(n("trading.orderChart.atcOrder"),n("titles.confirm")).then(f=>{f&&a.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(P=>{P.isOk?J.success(n("trading.orderChart.atcOrderSuccess")):ie(P.message)})}))}function Ta(){s.order.tp.price=s.order.entry.price+s.order.side*_r,s.order.sl.price=s.order.entry.price-s.order.side*sr,a.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:s.order.tp.price},slData:{cmd:"new",price:s.order.sl.price}}).then(p=>{p.isOk?(ce("entry"),ce("tp"),ce("sl"),s.order.entry.line.applyOptions({draggable:!1}),J.success(n("trading.orderChart.newTpSlSuccess"))):ie(p.message)})}function Ma(){if(s.order.entry.hasOwnProperty("line")){const p=s.data.price.slice(-1)[0].value;s.order.tp.hasOwnProperty("line")?((s.order.side>0&&p>=s.order.tp.price||s.order.side<0&&p<=s.order.tp.price)&&(s.isAutoOrdering||(s.isAutoOrdering=!0,a.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"delete"}}).then(h=>{h.isOk?(te("entry"),te("tp"),te("sl"),ge(!1),w.clear("order"),J.success(n("trading.orderChart.deleteTpSuccess")),Dt(),He()):ie(h.message),s.isAutoOrdering=!1}))),(s.order.side>0&&p<=s.order.sl.price||s.order.side<0&&p>=s.order.sl.price)&&(s.isAutoOrdering||(s.isAutoOrdering=!0,a.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"cancel"}}).then(h=>{h.isOk?(te("entry"),te("tp"),te("sl"),ge(!1),w.clear("order"),J.success(n("trading.orderChart.deleteSlSuccess")),Dt(),He()):ie(h.message),s.isAutoOrdering=!1})))):(s.order.side>0&&p>=s.order.entry.price||s.order.side<0&&p<=s.order.entry.price)&&(s.isAutoOrdering||(s.isAutoOrdering=!0,setTimeout(()=>{s.order.tp.price=s.order.entry.price+s.order.side*_r,s.order.sl.price=s.order.entry.price-s.order.side*sr,a.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:s.order.tp.price},slData:{cmd:"new",price:s.order.sl.price}}).then(h=>{h.isOk?(ce("tp"),ce("sl"),s.order.entry.line.applyOptions({draggable:!1}),J.success(n("trading.orderChart.autoNewTpSlSuccess")),He()):ie(h.message),s.isAutoOrdering=!1})},1e3)))}}function ka(){s.chart.timeScale().scrollToRealTime()}function rt(p=null){return p||(p=moment().unix()),p>=r.START&&p<=r.END}function Pe(p){return at(s.series.price.coordinateToPrice(p))}function at(p){return p?+ +p.toFixed(1):0}function ie(p){p||(p="unknown"),J.error(n(`trading.orderChart.${p}`))}function xa(){s.loadWhitespace=!0,a.dispatch("tradingOrder/getChartData",A.chartDate)}function La(){s.data.price=[],s.data.volume=[],s.data.spread=[],s.data.cash=[],s.data.whitespace=[],s.loadWhitespace=!0,a.dispatch("tradingOrder/getChartData",A.chartDate)}function He(){let p=new Audio(Ks);p.crossOrigin="anonymous",p.addEventListener("canplaythrough",function(){p.play()})}function Ra(){a.dispatch("tradingOrder/getAccountInfo").then(p=>{let h="";h+='<div style="width: 200px;">',h+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${n("trading.orderChart.nav")}</div><div>: ${v.currency(p.nav)}</div></div>`,h+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${n("trading.orderChart.maxVol")}</div><div>: ${v.numberVnFormat(p.maxVol)}</div></div>`,h+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${n("trading.orderChart.vm")}</div><div>: ${v.currency(p.vm)}</div></div>`,h+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${n("trading.orderChart.fee")}</div><div>: ${v.currency(p.fee)}</div></div>`,h+="</div>",$a(h,n("trading.orderChart.accountInfo"))})}function Da(){l.emit("checkPin",()=>a.dispatch("tradingOrder/report"))}function Oa(){l.emit("checkPin",()=>a.dispatch("tradingOrder/export"))}return(p,h)=>{const f=Na("DxToolbar");return qa(),Ha(Xa,null,[I("div",Js,[Vt(f,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-flag-checkered small",hint:p.$t("trading.orderChart.buttons.report"),onClick:Da}},{location:"before",widget:"dxButton",options:{icon:"far fa-file-export small",hint:p.$t("trading.orderChart.buttons.export"),onClick:Oa}}]},null,8,["items"]),I("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:c},[I("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:u},[I("div",Qs,[I("div",{class:It(`command far fa-${X.value.connection?"link":"unlink"}`),title:p.$t("trading.orderChart.connection"),onClick:h[0]||(h[0]=()=>p.$store.dispatch("tradingOrder/getStatus"))},null,10,eo),I("div",{class:It(["command status",{green:X.value.position>0,red:X.value.position<0,pending:X.value.pending}]),title:p.$t("trading.orderChart.position"),onClick:Ra},fi(X.value.position),11,to),I("div",io,fi(A.clock),1),ye(I("input",{type:"date",class:"chart-date command",title:p.$t("trading.orderChart.date"),"onUpdate:modelValue":h[1]||(h[1]=P=>A.chartDate=P),onChange:xa},null,40,ro),[[Ua,A.chartDate]]),I("img",{ref_key:"spinnerRef",ref:d,class:"command spinner",src:Za},null,512)]),I("div",ao,[I("div",{ref_key:"fullscreenToolRef",ref:m,class:It(`command far fa-${A.isFullscreen?"compress":"expand"}`),title:p.$t("trading.orderChart.fullscreen"),onClick:zr},null,10,no),I("div",{ref_key:"reloadToolRef",ref:g,class:"command far fa-sync-alt",title:p.$t("trading.orderChart.reload"),onClick:La},null,8,_o),I("div",{ref_key:"tradingviewRef",ref:S,class:"command far fa-chart-bar",title:p.$t("trading.orderChart.tradingview"),onClick:jr},null,8,so),I("div",{ref_key:"colorToolRef",ref:y,class:"color command far fa-palette",style:Ya({color:A.color}),title:p.$t("trading.orderChart.colorTool"),onClick:Gr,onContextmenu:Zr},[ye(Vt(Ga,{class:"color-picker",modelValue:A.color,"onUpdate:modelValue":h[2]||(h[2]=P=>A.color=P)},null,8,["modelValue"]),[[Ce,A.showColorPicker]])],44,oo),I("div",{ref_key:"lineToolRef",ref:b,class:"command far fa-horizontal-rule",title:p.$t("trading.orderChart.lineTool"),onClick:Kr,onContextmenu:Jr},null,40,lo),ye(I("div",{ref_key:"pattern2ToolRef",ref:V,class:"command far fa-heart",title:p.$t("trading.orderChart.pattern2Tool"),onClick:la,onContextmenu:pa},null,40,po),[[Ce,!0]]),I("div",{ref_key:"pattern1ToolRef",ref:D,class:"command far fa-star",title:p.$t("trading.orderChart.pattern1Tool"),onClick:_a,onContextmenu:sa},null,40,co),I("div",{ref_key:"rulerToolRef",ref:x,class:"command far fa-line-height",title:p.$t("trading.orderChart.rulerTool"),onClick:ra,onContextmenu:aa},null,40,vo),ye(I("div",{ref_key:"scanSignalToolRef",ref:E,class:"command far fa-search-location",title:p.$t("trading.orderChart.scanSignalTool"),onClick:ma,onContextmenu:ga},null,40,ho),[[Ce,!1]]),ye(I("div",{ref_key:"boxToolRef",ref:H,class:"command far fa-expand-alt",title:p.$t("trading.orderChart.boxTool"),onClick:ea,onContextmenu:ta},null,40,uo),[[Ce,!1]]),ye(I("div",{ref_key:"volprofileToolRef",ref:W,class:"command far fa-poll-h",title:p.$t("trading.orderChart.volprofileTool"),onClick:va,onContextmenu:ha},null,40,fo),[[Ce,!1]]),ye(I("div",{ref_key:"alertToolRef",ref:G,class:"command far fa-alarm-exclamation",title:p.$t("trading.orderChart.alertTool"),onClick:ya,onContextmenu:ba},null,40,mo),[[Ce,!1]]),ye(I("div",{class:"command far fa-info-circle",title:p.$t("trading.orderChart.copyistStatusPopup.title"),onClick:h[3]||(h[3]=()=>p.$refs.copyistStatusPopupRef.show())},null,8,go),[[Ce,!1]]),I("div",{ref_key:"cancelOrderRef",ref:Z,class:"cancel-order command far fa-trash-alt",title:p.$t("trading.orderChart.cancelTool"),onClick:wa},null,8,yo)]),I("div",null,[I("div",{ref_key:"entryOrderRef",ref:j,class:"order-button entry",onClick:Pa}," Entry ",512),I("div",{ref_key:"tpslOrderRef",ref:fe,class:"order-button tpsl",onClick:Ta}," TP/SL ",512),I("div",{class:"chart-top command far fa-angle-double-right",onClick:ka})]),ye(I("iframe",{ref_key:"tradingviewChartRef",ref:Qe,class:"tradingview-chart",src:et.value},null,8,bo),[[Ce,A.showTradingView]])],512)],512)]),Vt(ja,{ref:"copyistStatusPopupRef"},null,512)],64)}}},Mo=Va(Co,[["__scopeId","data-v-252f3f4e"]]);export{Mo as default};
