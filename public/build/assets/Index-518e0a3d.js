import{J as lt,K as it,L as ae,M as ce,u as at,b as st,c as rt,i as se,r as x,d as ut,e as K,x as ct,w as re,f as dt,g as pt,j as W,h as y,l as mt,A as H,E as U,z as ue,C as ht,v as gt,G as ft,o as vt}from"./app-a91f1c6e.js";import{_ as bt}from"./spinner-40be0a1e.js";import yt from"./ColorPicker-fc108003.js";import{c as Ct}from"./lightweight-charts.esm.development-03366bac.js";class St{constructor(){this.create()}create(){return new Promise((f,c)=>{const C=indexedDB.open("stockChart",1);C.onupgradeneeded=m=>{this.store=m.target.result,this.store.createObjectStore("range",{keyPath:"color"}),f()},C.onsuccess=m=>{this.store=m.target.result,f()},C.onerror=()=>{location.reload(),c()}})}get(f){var c=this.store;return new Promise(function(m,T){var p=c.transaction(f,"readonly");if(Array.isArray(f)){var v=f.map(P=>p.objectStore(P)),B=v.map(C);Promise.all(B).then(P=>m(P))}else{var O=p.objectStore(f);C(O).then(P=>m(P))}});function C(m){return new Promise(function(T,p){const v=m.getAll();v.onsuccess=B=>T(B.target.result),v.onerror=()=>p()})}}set(f,c){const C=this.store.transaction(f,"readwrite").objectStore(f);Array.isArray(c)?c.length>0&&c.forEach(m=>C.put(m)):C.put(c)}clear(f){var c=this.store;return new Promise(function(C,m){const T=c.transaction(f,"readwrite").objectStore(f).clear();T.onsuccess=()=>{C()},T.onerror=p=>{console.error(`Error to empty Object Store: ${f}`),m()}})}}const A=new St;var u={};const xt=lt(it);/*!
 * devextreme-vue
 * Version: 22.2.10
 * Build date: Mon Dec 11 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var wt=ae&&ae.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(u,"__esModule",{value:!0});u.DxToolbarItem=u.DxTo=u.DxShow=u.DxPosition=u.DxOptions=u.DxOffset=u.DxMy=u.DxItem=u.DxHide=u.DxFrom=u.DxDropDownOptions=u.DxCollision=u.DxButton=u.DxBoundaryOffset=u.DxAt=u.DxAnimation=u.DxSelectBox=void 0;var kt=wt(xt),Dt=ce,b=ce,de=Dt.createComponent({props:{acceptCustomValue:Boolean,accessKey:String,activeStateEnabled:Boolean,buttons:Array,customItemCreateEvent:String,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayExpr:[Function,String],displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,fieldTemplate:{},focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxLength:[Number,String],minSearchLength:Number,name:String,noDataText:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCustomItemCreating:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDataBeforeSearch:Boolean,showDropDownButton:Boolean,showSelectionControls:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:{},valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:acceptCustomValue":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:customItemCreateEvent":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayExpr":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:fieldTemplate":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:noDataText":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCustomItemCreating":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDataBeforeSearch":null,"update:showDropDownButton":null,"update:showSelectionControls":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=kt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});u.DxSelectBox=de;var X=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});u.DxAnimation=X;X.$_optionName="animation";X.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var pe=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxAt=pe;pe.$_optionName="at";var me=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxBoundaryOffset=me;me.$_optionName="boundaryOffset";var I=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});u.DxButton=I;I.$_optionName="buttons";I.$_isCollectionItem=!0;I.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var he=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxCollision=he;he.$_optionName="collision";var Y=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});u.DxDropDownOptions=Y;Y.$_optionName="dropDownOptions";Y.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var Z=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxFrom=Z;Z.$_optionName="from";Z.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var G=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxHide=G;G.$_optionName="hide";G.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var J=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});u.DxItem=J;J.$_optionName="items";J.$_isCollectionItem=!0;var ge=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxMy=ge;ge.$_optionName="my";var fe=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxOffset=fe;fe.$_optionName="offset";var ve=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});u.DxOptions=ve;ve.$_optionName="options";var be=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});u.DxPosition=be;be.$_optionName="position";var ye=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxShow=ye;ye.$_optionName="show";var Ce=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxTo=Ce;Ce.$_optionName="to";var Q=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});u.DxToolbarItem=Q;Q.$_optionName="toolbarItems";Q.$_isCollectionItem=!0;var Ft=u.default=de;const Tt={class:"content-block dx-card responsive-paddings"},Pt={class:"area data-area"},Lt=["title"],Bt={class:"area tool-area"},Et=["title"],Ot=["title"],_t=["title"],At=["title"],It=["title"],Nt=["title"],Rt=["title"],$t=["title"],Mt=["src"],Kt={__name:"Index",setup(L){const f={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.35}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},c=at(),C=st(),{t:m}=rt(),T=se("devices"),p=se("mf"),v=x(null),B=x(null),O=x(null),P=x(null),Se=x(null),xe=x(null),_=x(null),N=x(null),R=x(null),$=x(null),M=x(null),we=x(null);let e={chart:{},series:{},data:{ohlc:[],price:[],cash:[]},tools:{lines:[],target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},range:[]},crosshair:{}};const a=ut({symbol:C.query.symbol??"VNINDEX",symbols:[],symbolKind:null,symbolKinds:[{text:m("trading.stock.symbolList.hose"),value:"hose"},{text:m("trading.stock.symbolList.nh"),value:"nh"},{text:m("trading.stock.symbolList.ck"),value:"ck"},{text:m("trading.stock.symbolList.filterCash"),value:"fcash"},{text:m("trading.stock.symbolList.filterMix"),value:"fmix"},{text:m("trading.stock.symbolList.watch"),value:"watch"},{text:m("trading.stock.symbolList.hold"),value:"hold"},{text:m("trading.stock.symbolList.hnx"),value:"hnx"}],isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1});a.symbolKind=C.query.list??"hose";const ke=K(()=>`https://dchart.vndirect.com.vn/?language=vi&timeframe=D&theme=dark&symbol=${a.symbol}`),ee=K(()=>c.state.tradingStock.symbols.watch.includes(a.symbol)),De=K(()=>c.state.tradingStock.chart.events?" events":"");c.dispatch("tradingStock/getSymbols"),A.create(),ct(()=>{e.chart=Ct(B.value,f),v.value.addEventListener("click",Te),v.value.addEventListener("contextmenu",Fe),e.chart.subscribeCrosshairMove(Pe),e.chart.subscribeCustomPriceLineDragged(Le),e.series.range=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},color:"#667b68",lastValueVisible:!1,priceLineVisible:!1}),e.series.vnindex=e.chart.addLineSeries({priceScaleId:"vnindex",scaleMargins:{top:.05,bottom:.76},color:"aqua",priceFormat:{minMove:.01},lastValueVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.66,bottom:.01},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#42946C",downColor:"#BC3E4A",borderVisible:!1,wickUpColor:"#42946C",wickDownColor:"#BC3E4A",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(Be).observe(v.value),document.addEventListener("fullscreenchange",Ee),c.dispatch("tradingStock/getChartData",{symbol:a.symbol,vnindex:!0}).then(async t=>{e.series.vnindex.setData(t);const s=await A.get("range");s.length==2&&(e.tools.range=s,e.series.range.setData(s))})}),re(()=>c.state.tradingStock.chart,()=>{Ae(),Ie()}),re(()=>c.state.tradingStock.isChartLoading,t=>{O.value.style.display=t?"block":"none"});function Fe(t){t.preventDefault()}function Te(){_.value.classList.contains("selected")?Ve():N.value.classList.contains("selected")?Ke():R.value.classList.contains("selected")?oe():$.value.classList.contains("selected")?ne():M.value.classList.contains("selected")&&Qe()}function Pe(t){if(t.time){let s=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=s}else T.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function Le(t){let o=t.customPriceLine.options();o.price=q(o.price);const r=+t.fromPriceString;switch(o.price,o.lineType){case"line":c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:a.symbol,name:o.lineType,points:[r],data:[o]}),_.value.classList.remove("selected");break;case"target":if(p.isSet(e.tools.target.B)){let i={isRemove:!1,symbol:a.symbol,name:"target",points:[],data:[]},l;const n=+e.tools.target.A.options().price,h=+e.tools.target.B.options().price-n;o.point=="A"&&(l="A",i.points.push(l),i.data.push(e.tools.target[l].options())),l="B",e.tools.target[l].applyOptions({title:(100*h/n).toFixed(1)+"%"}),i.points.push(l),i.data.push(e.tools.target[l].options()),l="X",e.tools.target[l].applyOptions({price:+(n-.5*h).toFixed(2),title:(100*-.5*h/n).toFixed(1)+"%"}),i.points.push(l),i.data.push(e.tools.target[l].options()),l="Y",e.tools.target[l].applyOptions({price:+(n-h).toFixed(2),title:(100*-h/n).toFixed(1)+"%"}),i.points.push(l),i.data.push(e.tools.target[l].options()),l="Z",e.tools.target[l].applyOptions({price:+(n-2*h).toFixed(2),title:(100*-2*h/n).toFixed(1)+"%"}),i.points.push(l),i.data.push(e.tools.target[l].options()),c.dispatch("tradingStock/drawTools",i)}break}}function Be(){v.value&&(e.chart.resize(v.value.offsetWidth,v.value.offsetHeight),v.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ee(){v.value&&(document.fullscreenElement?(a.isFullscreen=!0,v.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(a.isFullscreen=!1,v.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Oe(){if(!a.symbol)return!1;const t={symbol:a.symbol,add:!ee.value};c.dispatch("tradingStock/addWatchlist",t)}function _e(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Ae(){te(!1),V(!1),z(!1),j(!1);const t=c.state.tradingStock.chart.tools;for(const[s,o]of Object.entries(t))switch(s){case"line":Object.values(o).forEach(r=>e.tools.lines.push(e.series.price.createPriceLine(r)));break;case"uplps":Object.entries(o).forEach(([r,i])=>e.tools.uplps[r]=e.series[r.includes("P")?"price":"cash"].createPriceLine(i));break;case"downlps":Object.entries(o).forEach(([r,i])=>e.tools.downlps[r]=e.series[r.includes("P")?"price":"cash"].createPriceLine(i));break;case"target":Object.entries(o).forEach(([r,i])=>e.tools.target[r]=e.series.price.createPriceLine(i));break}}function Ie(){e.data=c.state.tradingStock.chart.data,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:a.symbol}})}function Ne(t){a.showTradingView=!a.showTradingView,t.stopPropagation()}function Re(t){a.showColorPicker=!a.showColorPicker,t.stopPropagation()}function $e(t){t.preventDefault(),t.stopPropagation()}function Me(t){a.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(o=>o.classList.remove("selected")),s||t.target.classList.add("selected"),t.stopPropagation()}function je(t){te(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Ve(t=null,s=!1,o=!1){const r="line";t||(t=q(ie(e.crosshair.y)));const i=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(l=>{const n=l.options(),d=n.type=t==+n.price;return d&&(e.series.price.removePriceLine(l),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:a.symbol,name:r,point:t})),!d}),e.tools.lines.length==i&&!o||s){const l={lineType:r,price:t,color:a.color,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(l)),c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:a.symbol,name:r,points:[t],data:[l]})}_.value.classList.remove("selected")}function te(t=!0){e.tools.lines.length>0&&(console.log("removeLineTool"),e.tools.lines.forEach(s=>e.series.price.removePriceLine(s)),e.tools.lines=[],t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:a.symbol,name:"line",point:null}))}function ze(t){a.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(o=>o.classList.remove("selected")),s||(t.target.classList.add("selected"),j()),t.stopPropagation()}function qe(t){j(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Ke(){const t="target",s=ie(e.crosshair.y);let o={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},r={isRemove:!1,symbol:a.symbol,name:t,points:[],data:[]};if(p.isSet(e.tools.target.A)){const i=+e.tools.target.A.options().price,l=s-i;o.point="B",o.title=(100*l/i).toFixed(1)+"%",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),r.points.push(o.point),r.data.push(p.cloneDeep(o)),o.point="X",o.price=+(i-.5*l).toFixed(2),o.title=(100*-.5*l/i).toFixed(1)+"%",o.color="#2196F3",e.tools.target[o.point]=e.series.price.createPriceLine(o),r.points.push(o.point),r.data.push(p.cloneDeep(o)),o.point="Y",o.price=+(i-l).toFixed(2),o.title=(100*-l/i).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),r.points.push(o.point),r.data.push(p.cloneDeep(o)),o.point="Z",o.price=+(i-2*l).toFixed(2),o.title=(100*-2*l/i).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),r.points.push(o.point),r.data.push(p.cloneDeep(o)),N.value.classList.remove("selected")}else o.point="A",o.title="0",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),r.points.push(o.point),r.data.push(p.cloneDeep(o));c.dispatch("tradingStock/drawTools",r)}function j(t=!0){p.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),p.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z)),e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:a.symbol,name:"target"})}function We(t){a.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(o=>o.classList.remove("selected")),s?oe():t.target.classList.add("selected"),t.stopPropagation()}function He(t){V(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function oe(){let t,s;p.isSet(e.tools.uplps.P1)?(t=+e.tools.uplps.P1.options().startTime,s=e.crosshair.time,V(!1)):t=e.crosshair.time;const{price1:o,price2:r,cash1:i,cash2:l}=Ue(t,s);let n={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},d={isRemove:!1,symbol:a.symbol,name:"uplps",points:[],data:[]};n.startTime=t,n.price=o,n.title="P1",e.tools.uplps[n.title]=e.series.price.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=r,n.title="P2",e.tools.uplps[n.title]=e.series.price.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=i,n.title="C1",e.tools.uplps[n.title]=e.series.cash.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=l,n.title="C2",e.tools.uplps[n.title]=e.series.cash.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),c.dispatch("tradingStock/drawTools",d),R.value.classList.remove("selected")}function Ue(t,s){let o,r,i,l=0,n=0,d,h,w=0,F=0;for(let k=0;k<e.data.price.length;k++){const E=e.data.price[k].time;if(E<t)continue;if(s&&E>s)break;const g=e.data.price[k].value,S=e.data.cash[k].value;if(o==null&&(o=g,r=g,i=g,d=S,h=S),g>i)l>n&&(r=i,n=l),i=g,l=0;else if(g<i){const D=+(i-g).toFixed(2);D>l&&(l=D)}if(g<o&&n>0)break;if(S>h)w>F&&(d=h,F=w),h=S,w=0;else if(S<h){const D=+(h-S).toFixed(2);D>w&&(w=D)}}return{price1:+(r-n).toFixed(2),price2:+(i-n).toFixed(2),cash1:+(d-F).toFixed(0),cash2:+(h-F).toFixed(0)}}function V(t=!0){p.isSet(e.tools.uplps.P1)&&(e.series.price.removePriceLine(e.tools.uplps.P1),e.series.price.removePriceLine(e.tools.uplps.P2)),p.isSet(e.tools.uplps.C1)&&(e.series.cash.removePriceLine(e.tools.uplps.C1),e.series.cash.removePriceLine(e.tools.uplps.C2)),e.tools.uplps={P1:{},P2:{},C1:{},C2:{}},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:a.symbol,name:"uplps"})}function Xe(t){a.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(o=>o.classList.remove("selected")),s?ne():t.target.classList.add("selected"),t.stopPropagation()}function Ye(t){z(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ne(){let t,s;p.isSet(e.tools.downlps.P1)?(t=+e.tools.downlps.P1.options().startTime,s=e.crosshair.time,z()):t=e.crosshair.time;const{price1:o,price2:r,cash1:i,cash2:l}=Ze(t,s);let n={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},d={isRemove:!1,symbol:a.symbol,name:"downlps",points:[],data:[]};n.startTime=t,n.price=o,n.title="P1",e.tools.downlps[n.title]=e.series.price.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=r,n.title="P2",e.tools.downlps[n.title]=e.series.price.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=i,n.title="C1",e.tools.downlps[n.title]=e.series.cash.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),n.price=l,n.title="C2",e.tools.downlps[n.title]=e.series.cash.createPriceLine(n),d.points.push(n.title),d.data.push(p.cloneDeep(n)),c.dispatch("tradingStock/drawTools",d),$.value.classList.remove("selected")}function Ze(t,s){let o,r,i,l=0,n=0,d,h,w=0,F=0;for(let k=0;k<e.data.price.length;k++){const E=e.data.price[k].time;if(E<t)continue;if(s&&E>s)break;const g=e.data.price[k].value,S=e.data.cash[k].value;if(o==null&&(o=g,r=g,i=g,d=S,h=S),g<i)l<n&&(r=i,n=l),i=g,l=0;else if(g>i){const D=+(i-g).toFixed(2);D<l&&(l=D)}if(g>o&&n<0)break;if(S<h)w<F&&(d=h,F=w),h=S,w=0;else if(S>h){const D=+(h-S).toFixed(2);D<w&&(w=D)}}return{price1:+(r-n).toFixed(2),price2:+(i-n).toFixed(2),cash1:+(d-F).toFixed(1),cash2:+(h-F).toFixed(1)}}function z(t=!0){p.isSet(e.tools.downlps.P1)&&(e.series.price.removePriceLine(e.tools.downlps.P1),e.series.price.removePriceLine(e.tools.downlps.P2)),p.isSet(e.tools.downlps.C1)&&(e.series.cash.removePriceLine(e.tools.downlps.C1),e.series.cash.removePriceLine(e.tools.downlps.C2)),e.tools.downlps={P1:{},P2:{},C1:{},C2:{}},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:a.symbol,name:"downlps"})}function Ge(t){a.showColorPicker=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(o=>o.classList.remove("selected")),s||(t.target.classList.add("selected"),le()),t.stopPropagation()}function Je(t){le(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Qe(){let t={time:e.crosshair.time,value:1,color:"lime"};e.tools.range.length>0&&(t.color="red",M.value.classList.remove("selected")),e.series.range.update(t),e.tools.range.push(t),A.set("range",t)}function le(){e.tools.range=[],e.series.range.setData([]),A.clear("range")}function ie(t,s="price"){return q(e.series[s].coordinateToPrice(t))}function q(t){return t?+ +t.toFixed(2):0}function et(t){if(!a.symbol)return!1;c.dispatch("tradingStock/getChartData",{symbol:a.symbol,vnindex:!1})}function tt(t){a.symbolKind=t.value}function ot(){if(e.tools.range.length==2){const t={from:e.tools.range[0].time,to:e.tools.range[1].time,name:a.symbolKind};c.dispatch("tradingStock/filterSymbols",t)}else gt.error(m("trading.stock.rangeWarning"))}function nt(){ft(`${m("trading.stock.deleteWatchList")}?`,m("titles.confirm")).then(t=>{t&&c.dispatch("tradingStock/deleteWatchlist")})}return(t,s)=>{const o=dt("DxToolbar");return vt(),pt("div",Tt,[W(o,{items:[{visible:t.$mf.isSet(t.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:t.$t("buttons.back"),onClick:()=>t.$router.go(-1)}},{location:"before",widget:"dxSelectBox",options:{width:"130px",dataSource:a.symbolKinds,valueExpr:"value",displayExpr:"text",value:a.symbolKind,hint:t.$t("trading.stock.symbolKind"),onValueChanged:tt}},{location:"after",widget:"dxButton",options:{icon:"far fa-list small",hint:t.$t("trading.stock.cloneSymbols"),onClick:()=>t.$store.dispatch("tradingStock/cloneSymbols")}},{location:"after",widget:"dxButton",options:{icon:"far fa-folder-times small",hint:t.$t("trading.stock.deleteWatchList"),onClick:nt}},{location:"after",widget:"dxButton",options:{icon:"far fa-filter small",hint:t.$t("trading.stock.filterPopup.title"),onClick:ot}}]},null,8,["items"]),y("div",{class:"stock-container",ref_key:"chartContainerRef",ref:v},[y("div",{class:"chart-wrapper",ref_key:"chartRef",ref:B},[y("div",Pt,[W(mt(Ft),{width:t.$screen.getScreenSizeInfo.isXSmall?"140px":"130px",height:"30px","data-source":t.$store.state.tradingStock.symbols[a.symbolKind],"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:`symbol-select ${De.value}`},modelValue:a.symbol,"onUpdate:modelValue":s[0]||(s[0]=r=>a.symbol=r),onValueChanged:et},null,8,["width","data-source","element-attr","modelValue"]),H(y("div",{ref:"addWatchlistToolRef",class:ue(`command far fa-${ee.value?"minus-circle":"plus-circle"}`),title:t.$t("trading.stock.addWatchlist"),onClick:Oe},null,10,Lt),[[U,!!a.symbol]]),y("img",{ref_key:"spinnerRef",ref:O,class:"command spinner",src:bt},null,512)]),y("div",Bt,[y("div",{ref_key:"fullscreenToolRef",ref:P,class:ue(`command far fa-${a.isFullscreen?"compress":"expand"}`),title:t.$t("trading.stock.fullscreen"),onClick:_e},null,10,Et),y("div",{ref_key:"tradingviewRef",ref:Se,class:"command far fa-chart-bar",title:t.$t("trading.stock.tradingview"),onClick:Ne},null,8,Ot),y("div",{ref_key:"colorToolRef",ref:xe,class:"color command far fa-palette",style:ht({color:a.color}),title:t.$t("trading.stock.colorTool"),onClick:Re,onContextmenu:$e},[H(W(yt,{class:"color-picker",modelValue:a.color,"onUpdate:modelValue":s[1]||(s[1]=r=>a.color=r)},null,8,["modelValue"]),[[U,a.showColorPicker]])],44,_t),y("div",{ref_key:"lineToolRef",ref:_,class:"command far fa-horizontal-rule",title:t.$t("trading.stock.lineTool"),onClick:Me,onContextmenu:je},null,40,At),y("div",{ref_key:"uplpsToolRef",ref:R,class:"command far fa-arrow-up",title:t.$t("trading.stock.uplpsTool"),onClick:We,onContextmenu:He},null,40,It),y("div",{ref_key:"targetToolRef",ref:N,class:"command far fa-dot-circle",title:t.$t("trading.stock.targetTool"),onClick:ze,onContextmenu:qe},null,40,Nt),y("div",{ref_key:"downlpsToolRef",ref:$,class:"command far fa-arrow-down",title:t.$t("trading.stock.downlpsTool"),onClick:Xe,onContextmenu:Ye},null,40,Rt),y("div",{ref_key:"rangeToolRef",ref:M,class:"command far fa-grip-lines-vertical",title:t.$t("trading.stock.rangeTool"),onClick:Ge,onContextmenu:Je},null,40,$t)]),H(y("iframe",{ref_key:"tradingviewChartRef",ref:we,class:"tradingview-chart",src:ke.value},null,8,Mt),[[U,a.showTradingView]])],512)],512)])}}};export{Kt as default};
