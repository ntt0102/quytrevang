import{L as b}from"./ListTagBox-f8807688.js";import{a as m,D as C}from"./data-grid-d0837af2.js";import{x as D,y as k,z as p,A as y,B as S,E as B,C as T,H as _,r as E,c as $,e as i,w as g,D as l,o as q}from"./app-9de7dadb.js";import"./row_dragging-c5b3a6db.js";import"./dialog-8a110b85.js";import"./exporter-c2e0d168.js";const z={class:"content-block dx-card responsive-paddings"},M={__name:"Roles",setup(A){const n=D(),{t:r}=k(),h=p("bus"),d=p("mt"),f=p("mf"),u=y(null),o=S({gridData:null,calculateFilterExpression:function(e,a,s){return s==="search"&&typeof e=="string"?["permissions","contains",e]:function(t){return(t.permissions||[]).indexOf(e)!==-1}},validationRules:{name:[{type:"required",message:r("settings.roles.name")+d.validations.required},{type:"async",validationCallback:e=>n.dispatch("settingRole/validateDuplicateName",e),message:r("settings.roles.name")+d.validations.duplicate}],permissions:[{type:"required",message:r("settings.roles.permission")+d.validations.required}]}}),v=B(()=>n.state.settingRole.permissions);n.dispatch("settingRole/getRoles"),T(()=>n.state.settingRole.roles,e=>{o.gridData=f.cloneDeep(e)}),_(()=>n.dispatch("settingRole/resetState"));function w(e){e.length&&h.emit("checkPin",()=>n.dispatch("settingRole/save",e))}function x(e,a){var s="Â ",t=(a.value||[]).map(c=>a.column.lookup.calculateCellValue(c)).join(", ");e.textContent=t||s,e.title=t}function R(e,a){a.setValue(e),a.component.updateDimensions()}return(e,a)=>{const s=E("DxToolbar");return q(),$("div",z,[i(l(C),{ref_key:"dataGridRef",ref:u,"data-source":o.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,mode:"batch",startEditAction:"dblClick"},onContentReady:a[0]||(a[0]=t=>e.$mf.dataGridPreload(o.gridData,u.value.instance)),onSaved:w},{tagBoxEditor:g(({data:t})=>[i(b,{width:300,height:400,value:t.value,"on-value-changed":c=>R(c,t),"data-source":v.value,"data-grid-component":t.component},null,8,["value","on-value-changed","data-source","data-grid-component"])]),commandCellTemplate:g(({data:t})=>[i(s,{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:e.$t("buttons.delete"),text:e.$t("buttons.delete"),onClick:()=>{u.value.instance.deleteRow(t.rowIndex)}}}]},null,8,["items"])]),default:g(()=>[i(l(m),{fixed:!0,width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t("titles.commandHeaderTitleShort")},null,8,["caption"]),i(l(m),{"data-field":"name","header-filter":{allowSearch:!0},caption:e.$t("settings.roles.name"),"validation-rules":o.validationRules.name},null,8,["caption","validation-rules"]),i(l(m),{"allow-sorting":!1,"data-field":"permissions","cell-template":x,"calculate-filter-expression":o.calculateFilterExpression,"header-filter":{allowSearch:!0},"edit-cell-template":"tagBoxEditor",caption:e.$t("settings.roles.permission"),"validation-rules":o.validationRules.permissions,lookup:{dataSource:v.value}},null,8,["calculate-filter-expression","caption","validation-rules","lookup"])]),_:1},8,["data-source"])])}}};export{M as default};
