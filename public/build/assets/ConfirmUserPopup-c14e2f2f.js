import{_ as v,b as U,c as f,e as l,w as m,f as h,g,r,o as d,d as a,h as D,t as I,i as _}from"./app-fcdcd579.js";import{_ as k}from"./accordion-68e82e4c.js";import{P as $}from"./Index-ee914bed.js";import"./interest-formula-45587e77.js";const x={components:{DxAccordion:k,Pdf:$},data(){return{refreshKey:0,user:{},formData:{},backupDocuments:[]}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance},submit(){return this.$refs.submit.instance}},methods:{...U("Admin.users",["uploadDocuments"]),show({user:e}){this.popup.option("title",this.$t(`components.confirmUser.${e.level==4?"title":"confirmedTitle"}`)+" #"+e.code),this.user=e,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",e.level==4?0:1),0),this.backupDocuments=e.url_documents.map(t=>({...t,isUpload:!1})),this.formData.documents=this.backupDocuments,this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(e){let t=e.target.id.replace("Image","");this.formData.documents=this.formData.documents.filter(o=>!(o.type==t&&o.isUpload)),console.log("onUploadImageChange",e.target.files),[...e.target.files].forEach(o=>this.formData.documents.push({type:t,file:URL.createObjectURL(o),isUpload:!0}))},onCheckBoxDeleteChange(e){let t=e.element.id.replace("Delete","");e.value?this.formData.documents=this.formData.documents.filter(o=>!(o.type==t&&!o.isUpload)):this.formData.documents=this.backupDocuments.filter(o=>o.type==t).concat(this.formData.documents)},saveClick(){!this.formData.isContractDelete&&!this.formData.isIdentityDelete&&this.$refs.contractImage.files.length==0&&this.$refs.identityImage.files.length==0?this.$toasted.info(this.$t("messages.info.noChangedData")):this.formData.documents.length==0?this.$toasted.show(this.$t("messages.warning.imageEmpty")):this.submit.element().click()},onSubmit(){this.$bus.emit("checkPin",async()=>{let e=new FormData;e.append("userId",this.user.id),e.append("isContractDelete",this.formData.isContractDelete),e.append("isIdentityDelete",this.formData.isIdentityDelete);for(var t=0;t<this.$refs.contractImage.files.length;t++){let o=await this.$mf.resizeImage({file:this.$refs.contractImage.files[t],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});e.append(`contractImages[${t}]`,o)}for(var t=0;t<this.$refs.identityImage.files.length;t++){let c=await this.$mf.resizeImage({file:this.$refs.identityImage.files[t],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});e.append(`identityImages[${t}]`,c)}this.uploadDocuments(e).then(o=>{o&&this.popup.hide()})})},initFormData(){this.formData={isPdfPreview:!1,isContractDelete:!1,isIdentityDelete:!1,documents:[]}},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}},P={class:"download"},V={class:"upload-browser"},S={for:"contractImage"},B=a("i",{class:"far fa-file-upload"},null,-1),A={class:"upload-browser"},T={for:"identityImage"},E=a("i",{class:"far fa-file-upload"},null,-1);function H(e,t,o,c,i,n){const u=r("DxButton"),p=r("DxCheckBox"),C=r("DxAccordion"),y=r("DxScrollView"),b=r("DxPopup"),w=r("Pdf");return d(),f("div",null,[l(b,{ref:"popup",showCloseButton:!0,fullScreen:!!e.$devices.phone,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:n.saveClick}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>e.$refs.submit.click()}}],wrapperAttr:{class:"confirm-user-popup"},onHiding:n.onHiding},{content:m(()=>[l(y,null,{default:m(()=>[l(C,{ref:"accordion",collapsible:!0,items:[{title:e.$t("components.confirmUser.step1"),template:"step1Template"},{title:e.$t("components.confirmUser.step2"),template:"step2Template"}]},{step1Template:m(()=>[a("div",P,[l(u,{text:e.$t("buttons.download"),icon:"download",type:"default","styling-mode":"contained",onClick:t[0]||(t[0]=()=>e.$refs.pdf.download({component:"ContractPdf",user:i.user,isPreview:i.formData.isPdfPreview}))},null,8,["text"]),e.$devices.phone?g("",!0):(d(),h(p,{key:0,modelValue:i.formData.isPdfPreview,"onUpdate:modelValue":t[1]||(t[1]=s=>i.formData.isPdfPreview=s),text:e.$t("components.confirmUser.preview")},null,8,["modelValue","text"]))])]),step2Template:m(()=>[a("form",{onSubmit:t[6]||(t[6]=_((...s)=>n.onSubmit&&n.onSubmit(...s),["prevent"]))},[l(u,{ref:"submit",class:"display-none",useSubmitBehavior:!0},null,512),(d(),f("div",{class:"upload",key:i.refreshKey},[a("div",V,[a("input",{ref:"contractImage",type:"file",id:"contractImage",multiple:"multiple",accept:"images/*",onChange:t[2]||(t[2]=(...s)=>n.onUploadImageChange&&n.onUploadImageChange(...s))},null,544),a("label",S,[B,D(" "+I(e.$t("components.confirmUser.chooseContractImage")),1)]),l(p,{id:"contractDelete",modelValue:i.formData.isContractDelete,"onUpdate:modelValue":t[3]||(t[3]=s=>i.formData.isContractDelete=s),text:e.$t("titles.deleteOldImage"),onValueChanged:n.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])]),a("div",A,[a("input",{ref:"identityImage",type:"file",id:"identityImage",multiple:"multiple",accept:"images/*",onChange:t[4]||(t[4]=(...s)=>n.onUploadImageChange&&n.onUploadImageChange(...s))},null,544),a("label",T,[E,D(" "+I(e.$t("components.confirmUser.chooseIdentityImage")),1)]),l(p,{id:"identityDelete",modelValue:i.formData.isIdentityDelete,"onUpdate:modelValue":t[5]||(t[5]=s=>i.formData.isIdentityDelete=s),text:e.$t("titles.deleteOldImage"),onValueChanged:n.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])])]))],32)]),_:1},8,["items"])]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"]),e.$mf.isSet(i.user)?(d(),h(w,{key:0,ref:"pdf"},null,512)):g("",!0)])}const L=v(x,[["render",H]]);export{L as default};
