import{k as fi,t as mi,m as vi,l as me,u as gi,r as C,a as hi,n as q,p as yi,q as xi,w as je,s as F,v as Si,x as v,f as ve,y as M,z as Qe,A as ee,B as Ti,C as ge,E as Ci,F as ki,d as wi,G as bi,i as he,j as Ue,H as Fi,e as Di,o as Oi}from"./app-cf16bc86.js";import Li from"./LineContext-ad013e94.js";import Ri from"./ScanContext-63745b5c.js";import Ai from"./VpsOtpPopup-0c31c7e9.js";import{c as Pi}from"./lightweight-charts.esm.development-03366bac.js";import{g as D}from"./getUnixTime-c1859344.js";/* empty css            */import"./text-box-227260bb.js";function Ei(H,j,O){return fi((O==null?void 0:O.in)||H,+mi(H)+j)}function Le(H,j,O){return Ei(H,j*vi,O)}const _i={class:"content-block dx-card responsive-paddings"},Bi=["title"],Ii=["title"],Vi=["title"],Mi=["title"],$i=["title"],Wi=["title"],Zi=["title"],Yi=["title"],Ni=["title"],Xi=v("i",{class:"far fa-heart-rate"},null,-1),zi=[Xi],Ji=["title"],qi=v("i",{class:"far fa-pipe"},null,-1),Hi=[qi],ji=["title"],Qi=v("i",{class:"far fa-horizontal-rule"},null,-1),Ui=["title"],Gi=v("i",{class:"far fa-grip-lines-vertical"},null,-1),Ki=[Gi],er=["title"],tr=v("i",{class:"far fa-line-height"},null,-1),ir=[tr],rr=["title"],or=["src"],Ge=3,Ke=2,sr="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",mr={__name:"Index",setup(H){const j={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},O=me(new Date,"yyyy-MM-dd"),L={START:D(new Date(`${O}T08:45:00Z`)),ATO:D(new Date(`${O}T09:00:00Z`)),ATC:D(new Date(`${O}T14:30:00Z`)),END:D(new Date(`${O}T14:45:00Z`))},u=wi(),Re=bi(),{t:h}=gi(),et=he("devices"),m=he("mf"),ye=he("bus"),te=he("filters"),_=C(null),Ae=C(null),tt=C(null),it=C(null),rt=C(null),ot=C(null),st=C(null),ie=C(null),xe=C(null),Se=C(null),Te=C(null),re=C(null),Ce=C(null),nt=C(null),Z=C(null),Q=C(null),Pe=C(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:D(Le(new Date,7))};z();const p=hi({chartDate:Re.query.date??O,clock:me(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,lineColor:"#F44336",lineTitle:"",progress:0,scanSide:"left",showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),R=q(()=>u.state.tradingDerivative.status),B=q(()=>u.state.tradingDerivative.config),Ee=q(()=>u.state.tradingDerivative.tools),at=q(()=>u.state.tradingDerivative.isChartLoading),lt=q(()=>R.value.position!=0||!!R.value.pending||!!Ee.value.order),ct=q(()=>`https://chart.vps.com.vn/tv/?u=${B.value.vpsUser}&s=${B.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);u.dispatch("tradingDerivative/initChart").then(()=>{$()&&ke(),!Re.query.date&&B.value.lastOpeningDate&&(p.chartDate=B.value.lastOpeningDate),u.dispatch("tradingDerivative/getChartData",p.chartDate).then(i=>{i&&de()})}),e.interval=setInterval(xt,1e3),e.interval60=setInterval(()=>{$()?(Je(),B.value.autoRefresh&&se()):clearInterval(e.interval60)},6e4),yi(()=>{e.chart=Pi(Ae.value,j),e.chart.subscribeCrosshairMove(ut),e.chart.subscribeCustomPriceLineDragged(ft),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(mt).observe(_.value),document.addEventListener("keydown",Ie),document.addEventListener("fullscreenchange",Ve)}),xi(()=>{e.chart&&(e.chart.remove(),e.chart=null),document.removeEventListener("keydown",Ie),document.removeEventListener("fullscreenchange",Ve),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),je(()=>u.state.tradingDerivative.chartData,ht),je(()=>Ee.value,gt);function pt(i){p.showPatternContext=!1,p.showScanContext=!1,p.showLineContext=!1,ce(!1),ie.value.classList.contains("selected")?Yt():Te.value.classList.contains("selected")?Jt():re.value.classList.contains("selected")?Mt():Ce.value.classList.contains("selected")?bt():xe.value.classList.contains("selected")?At():Se.value.classList.contains("selected")&&Bt()}function dt(i){ce(!0),i.preventDefault()}function _e(i){i.stopPropagation()}function Be(i){i.preventDefault(),i.stopPropagation()}function ut(i){if(i.time){let r=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=r}else et.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function ft(i){let r=i.customPriceLine,t=r.options();t.price=parseFloat(t.price.toFixed(1));const o=+i.fromPriceString,s=t.price;switch(t.lineType){case"order":if(s!=o){let l=!1;t.kind=="entry"?R.value.position||(l=!0,e.tools.order[t.kind].price=s,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(a=>{a.isOk?(Y([t.kind]),F.success(h("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:o}),A(a.message))})):(l=!0,e.tools.order[t.kind].price=s,t.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(a=>{a.isOk?(Y([t.kind]),F.success(h("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:o}),A(a.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(a=>{a.isOk?(Y([t.kind]),F.success(h("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:o}),A(a.message))})),l||(r.applyOptions({price:o}),F.show(h("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o});const n=t.color,d=t.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[s],data:[{color:n,title:d}]}),ie.value.classList.remove("selected");break;case"target":if(m.isSet(e.tools.target.B)){let l={isRemove:!1,name:"target",points:[],data:[]},a,c,f=+e.tools.target.A.options().price,S=+e.tools.target.B.options().price,g=S-f;if(a="A",t.point=="A")g=+e.tools.target.B.options().title,S=f+g;else if(t.point!="B"){let T=0;switch(t.point){case"X":T=1.5;break;case"Y":T=2;break;case"Z":T=3;break;case"W":T=5;break}g=parseFloat(((S-s)/T).toFixed(1)),f=S-g,c={price:f},e.tools.target[a].applyOptions(c)}l.points.push(a),l.data.push(f),a="B",c={price:S,title:g.toFixed(1)},t.point==a&&delete c.price,e.tools.target[a].applyOptions(c),l.points.push(a),l.data.push(S),a="X",c={price:parseFloat((f-.5*g).toFixed(1)),title:(-.5*g).toFixed(1)},t.point==a&&delete c.price,e.tools.target[a].applyOptions(c),a="Y",c={price:parseFloat((f-g).toFixed(1)),title:(-g).toFixed(1)},t.point==a&&delete c.price,e.tools.target[a].applyOptions(c),a="Z",c={price:parseFloat((f-2*g).toFixed(1)),title:(-2*g).toFixed(1)},t.point==a&&delete c.price,e.tools.target[a].applyOptions(c),a="W",c={price:parseFloat((f-4*g).toFixed(1)),title:(-4*g).toFixed(1)},t.point==a&&delete c.price,e.tools.target[a].applyOptions(c),u.dispatch("tradingDerivative/drawTools",l)}break;case"pattern":if(m.isSet(e.tools.pattern.B)){let l,a;const c=e.tools.pattern.A.options(),f=e.tools.pattern.B.options(),S=e.tools.pattern.C.options(),g={A:{time:+c.time,price:+c.price},B:{price:+f.price},C:{price:+S.price}},{progress:T,timeMark:w,info:{epr1:y,epr2:b,epr3:k,entry:P,prStatus:W,x:V,X:G,y:K,Y:De}}=ne(g);le(T),ae(w),X(g),l="A",a={title:`A ${y}`},e.tools.pattern[l].applyOptions(a),l="B",a={title:`B ${b}`},e.tools.pattern[l].applyOptions(a),l="C",a={title:`C ${k}`},e.tools.pattern[l].applyOptions(a),l="D",a={price:P,title:"Entry "+W},t.point==l&&delete a.price,e.tools.pattern[l].applyOptions(a),l="X",a={price:parseFloat(V.toFixed(1)),title:"X "+parseFloat(G.toFixed(1))},e.tools.pattern[l].applyOptions(a),l="Y",a={price:parseFloat(K.toFixed(1)),title:"Y "+parseFloat(De.toFixed(1))},e.tools.pattern[l].applyOptions(a)}break}}function mt(){_.value&&(e.chart.resize(_.value.offsetWidth,_.value.offsetHeight),_.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ie(i){if(i.ctrlKey)switch(i.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(i.altKey)switch(i.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function Ve(){_.value&&(document.fullscreenElement?(p.isFullscreen=!0,_.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(p.isFullscreen=!1,_.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function vt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function gt(i){Ht(),Object.entries(i).forEach(([r,t])=>{switch(r){case"order":St(t);break;case"pattern":we(i.pattern,!0);break;case"tr":$t(t);break;case"0_pt":Ze(t[0]);break;case"line":Nt(t);break;case"target":qt(t);break}})}function ht(i){p.chartDate==O&&$()||(i.price.length>0&&(e.data.whitespace=oe(e.data.whitespace,$e(p.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=oe(e.data.price,i.price),e.series.price.setData(e.data.price))}function Me(i){let r=[];i.forEach(t=>{const o=D(Le(new Date(t.date),7));r.push({time:o,value:t.price})}),r.length>1?(e.data.price=oe(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function $e(i){const r=D(new Date(`${i}T09:00:00Z`)),t=D(new Date(`${i}T11:30:00Z`)),o=D(new Date(`${i}T13:00:00Z`)),s=D(new Date(`${i}T14:30:00Z`)),n=D(new Date(`${i}T14:00:00Z`));let d=[];for(let l=r;l<=s;l++){if(l>t&&l<o)continue;let a={time:l};(l==n||l==s)&&(a.value=1),d.push(a)}return d}function oe(i,r){return Array.from(new Map([...i,...r].sort((t,o)=>t.time-o.time).map(t=>[t.time,t])).values())}function ke(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(sr),e.websocket.onopen=i=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=i=>{!e.socketStop&&$()&&(p.isSocketWarning=!0,ke())},e.websocket.onmessage=i=>{p.isSocketWarning=!1,yt(i.data).forEach(t=>{if(!t)return!1;t.type==3?(de(),e.data.whitespace=oe(e.data.whitespace,$e(O)),e.series.whitespace.setData(e.data.whitespace),Me(t.result),u.dispatch("tradingDerivative/setChartLoading",!1)):t.type==1&&t.target=="UpdateTrades"&&t.arguments[0]=="VN30F1M"&&(Gt(t.arguments[1].at(-1).price),Me(t.arguments[1]))})}}function yt(i){let r=[];return i.split("").forEach(t=>{const o=t.indexOf("{"),s=t.lastIndexOf("}");let n=null;if(o!==-1&&s!==-1&&s>o){const d=t.substring(o,s+1);d!="{}"&&(n=JSON.parse(d))}r.push(n)}),r}function xt(){e.currentSeconds=D(Le(new Date,7)),$()&&(R.value.position&&e.currentSeconds>L.ATC-5*60&&(p.isOrderWarning=!0,e.currentSeconds>L.ATC-15&&m.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(i=>{i.isOk?(N(["entry","tp","sl"]),F.success(h("trading.derivative.autoCancelTpSlSuccess"))):A(i.message)})),B.value.openingMarket&&e.currentSeconds==L.START&&ke()),p.clock=me(new Date,"HH:mm:ss")}function Y(i){const r="order";let t={isRemove:!1,name:r,points:[],data:[]},o,s;i.forEach(n=>{switch(n){case"entry":o="yellow",s=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",s=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",s=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(t.points.push(n),m.isSet(e.tools.order[n].line))e.tools.order[n].line.applyOptions({price:e.tools.order[n].price,title:s}),t.data.push(e.tools.order[n].line.options());else{const d={lineType:r,kind:n,side:e.tools.order.side,price:e.tools.order[n].price,color:o,lineWidth:1,lineStyle:0,title:s,draggable:!0};e.tools.order[n].line=e.series.price.createPriceLine(d),t.data.push(d)}}),u.dispatch("tradingDerivative/drawTools",t)}function St(i){Object.entries(i).forEach(([r,t])=>{e.tools.order.side=t.side,e.tools.order[r].price=t.price,e.tools.order[r].line=e.series.price.createPriceLine(t)})}function N(i,r=!0){r&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),i.forEach(t=>{m.isSet(e.tools.order[t].line)&&(e.series.price.removePriceLine(e.tools.order[t].line),delete e.tools.order[t].line)})}function Tt(i){p.showTradingView=!p.showTradingView,i.stopPropagation()}function Ct(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(U(),X(),i.target.classList.add("selected"))}function kt(){p.showScanContext=!p.showScanContext,p.showLineContext=!1}function wt(){u.dispatch("tradingDerivative/setAutoRefresh",!B.value.autoRefresh)}function bt(){const i=p.scanSide=="left",r=e.crosshair.time?e.data.price.filter(o=>!x(o.time,i,e.crosshair.time)):e.data.price;let t=i?Ft(r):Dt(r);t=Ot(t),m.isSet(t)&&(Ye(),U(),we(t),X(t)),Ce.value.classList.remove("selected")}function Ft(i){let r,[t,o,s,n]=Array(4).fill({});for(let d=i.length-1;d>=0;d--){const l=i[d].value,a=i[d].time,c=I(a);if(c==-1)break;if(d==i.length-1&&(s={index:c,time:a,price:l},[o,t,n]=Array(3).fill(null).map(()=>m.cloneDeep(s))),r==null){if(l==s.price)continue;r=l>s.price}if(x(l,r,o.price)&&(x(t.price,!r,s.price)?([s,o]=[o,t].map(f=>m.cloneDeep(f)),t={index:c,time:a,price:l},n=m.cloneDeep(t),r=!r):o={index:c,time:a,price:l}),x(l,!r,t.price)?(t={index:c,time:a,price:l},n=m.cloneDeep(t)):n.index=c,x(l,r,n.price)&&(n={index:c,time:a,price:l}),s.index>t.index){const f=Math.abs(o.price-s.price);if(f>=1.5&&(t.index-n.index>s.index-o.index||Math.abs(t.price-n.price)>f))break}}return{A:t,B:o,C:s}}function Dt(i){let r,[t,o,s]=Array(3).fill({});for(let n=0;n<i.length;n++){const d=i[n].value,l=i[n].time,a=I(l);if(a==-1)break;if(n==0&&(t={index:a,time:l,price:d},o=m.cloneDeep(t),s=m.cloneDeep(t)),r==null){if(d==t.price)continue;r=d>t.price}x(d,r,o.price)&&(o={index:a,time:l,price:d},s=m.cloneDeep(o)),x(o.price,r,t.price)&&x(d,!r,s.price)&&(x(d,r,t.price)?s={index:a,time:l,price:d}:(t=m.cloneDeep(o),o={index:a,time:l,price:d},s=m.cloneDeep(o),r=!r))}return{A:t,B:o,C:s}}function Ot(i){const r={};return Object.entries(i).forEach(([t,o])=>{const{index:s,...n}=o;r[t]=n}),r}function Lt(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Rt(i){i.target.classList.remove("selected"),U(),X()}function At(){const i="pattern",r=pe(e.crosshair.y),t=e.crosshair.time;let o={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0};if(m.isSet(e.tools.pattern.A)){const s=e.tools.pattern.A.options();if(m.isSet(e.tools.pattern.B)){const n=e.tools.pattern.B.options();let d,l,a;if(m.isSet(e.tools.pattern.C)){let c,f;const S=e.tools.pattern.C.options();d={A:{time:t,price:r},B:{price:+n.price},C:{price:+S.price}};const{progress:g,timeMark:T,info:{epr1:w,epr2:y,epr3:b,entry:k,prStatus:P,x:W,X:V,y:G,Y:K}}=ne(d);a=g,l=T,c="A",f={price:r,time:t,title:`A ${w}`},e.tools.pattern[c].applyOptions(f),c="B",f={title:`B ${y}`},e.tools.pattern[c].applyOptions(f),c="C",f={title:`C ${b}`},e.tools.pattern[c].applyOptions(f),c="D",f={price:k,title:"Entry "+P},e.tools.pattern[c].applyOptions(f),c="X",f={price:parseFloat(W.toFixed(1)),title:"X "+parseFloat(V.toFixed(1))},e.tools.pattern[c].applyOptions(f),c="Y",f={price:parseFloat(G.toFixed(1)),title:"Y "+parseFloat(K.toFixed(1))},e.tools.pattern[c].applyOptions(f)}else{d={A:{time:+s.time,price:+s.price},B:{price:+n.price},C:{price:r}};const{progress:c,timeMark:f,info:{epr1:S,epr2:g,epr3:T,entry:w,prStatus:y,x:b,X:k,y:P,Y:W}}=ne(d);a=c,l=f;let V="A";e.tools.pattern[V].applyOptions({title:`A ${S}`}),V="B",e.tools.pattern[V].applyOptions({title:`B ${g}`}),o.point="C",o.title=`C ${T}`,o.color="#FFEB3B",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=w,o.title="Entry "+y,o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat(P.toFixed(1)),o.title="Y "+parseFloat(W.toFixed(1)),o.color="#E91E63",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat(b.toFixed(1)),o.title="X "+parseFloat(k.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}le(a),ae(l),X(d),xe.value.classList.remove("selected")}else o.point="B",o.title="B 0",o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}else o.point="A",o.title="A 0",o.color="#F44336",o.time=t,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function we(i,r=!1){const t=r?Pt(i):i;let s={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{progress:n,timeMark:d,info:{epr1:l,epr2:a,epr3:c,entry:f,prStatus:S,x:g,X:T,y:w,Y:y}}=ne(t);le(n),ae(d),s.point="A",s.title=`A ${l}`,s.color="#F44336",s.price=t.A.price,s.time=t.A.time,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="B",s.title=`B ${a}`,s.color="#4CAF50",s.price=t.B.price,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="C",s.price=t.C.price,s.title=`C ${c}`,s.color="#FFEB3B",e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="D",s.price=f,s.title="Entry "+S,s.color="#9C27B0",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="Y",s.price=parseFloat(w.toFixed(1)),s.title="Y "+parseFloat(y.toFixed(1)),s.color="#E91E63",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="X",s.price=parseFloat(g.toFixed(1)),s.title="X "+parseFloat(T.toFixed(1)),s.color="#2196F3",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s)}function se(){if(m.isSet(e.tools.pattern.C)){const i=e.tools.pattern.A.options(),r=e.tools.pattern.B.options(),t=e.tools.pattern.C.options(),o={A:{time:+i.time,price:+i.price},B:{price:+r.price},C:{price:+t.price}};U(),we(o)}}function ne({A:i,B:r,C:t}){const o=be({phase:1,start:i,end:r,retracementPrice:t.price});let s=be({phase:2,start:o.R,end:t});const n=be({phase:3,start:s.R,end:{price:r.price+o.ep},breakPrices:[s.S1,r.price]});o.xBox.tr>=s.tr&&(s.tr=o.xBox.tr);const d=r.price-t.price,l=d>0,a=Math.abs(d)>o.pr,c=Math.abs(t.price-n.xBox.R.price)>s.pr,f=n.xBox.pr>n.pr,S=x(t.price,l,o.S1.price),g=x(n.xBox.R.price,!l,s.S1.price),T=x(n.xBox.S.price,l,n.S1.price),w=S?a?1:0:2,y=g?c?1:0:2,b=T?f?1:0:2,k=`${w}${y}${b}`,P=o.R.index+o.tr,W=s.R.index+s.tr,V=n.xBox.R.index+n.tr,G=[P,W,V],K=n.xBox.S.index>P,De=n.xBox.S.index>W;let J,E={};E.step=1,o.ep>1&&w==1&&s.epr<o.epr&&K==1?De==0?(E.step=2,E.result=!0,J=s.S1.price):(E.step=3,y>0?(E.step=4,b==1?(E.result=!0,J=n.xBox.R.price):(E.result=!1,J=n.R1.price)):(E.result=!1,J=n.R1.price)):(E.result=!1,J=o.S1.price);const ai=parseFloat(o.ep.toFixed(1)),li=parseFloat(s.ep.toFixed(1)),ci=parseFloat(n.ep.toFixed(1)),pi=o.R1.price,Oe=r.price,fe=Oe-pi,di=We(Oe+fe,l),qe=n.breakIndexs[1]?parseInt((n.breakIndexs[1]-o.R.index)/o.tr):1,He=qe>1?fe*qe:fe,ui=We(Oe+He,l);return{progress:E,timeMark:G,info:{epr1:ai,epr2:li,epr3:ci,entry:J,prStatus:k,x:di,X:fe,y:ui,Y:He}}}function be({phase:i,start:r,end:t,breakPrices:o,retracementPrice:s}){let n=m.cloneDeep(r),d=m.cloneDeep(t);const l=d.price>n.price;let a={},c={},f={},S=[null,null];e.data.price.filter(T=>{let w=T.time>=n.time;return e.tools.pickTime&&(w&=T.time<=e.tools.pickTime),w}).every((T,w)=>{const y=T.value,b=T.time,k=I(b);if(k==-1)return!1;if((w==0||y==n.price)&&(a={R:{index:k,time:b,price:y},S:{index:k,time:b,price:y},pr:0,tr:0},c=a,f=a),x(y,l,a.R.price)){const P=Math.abs(a.R.price-c.R.price);P<.2&&x(a.S.price,!l,c.R.price)&&(c.S.index=a.S.index,c.tr=c.S.index-c.R.index,c.pr+=P),a.tr>=c.tr&&a.pr>=c.pr&&(c=a),i==1&&s&&x(a.S.price,l,s)&&a.tr>=f.tr&&a.pr>=f.pr&&(f=a),a={R:{index:k,time:b,price:y},S:{index:k,time:b,price:y},pr:0,tr:0},i==3&&o&&(x(y,l,o[0])||(S[0]=k),x(y,l,o[1])||(S[1]=k))}else a.S.index=k,a.tr=a.S.index-a.R.index,x(y,!l,a.S.price)&&(a.S.time=b,a.S.price=y,a.pr=Math.abs(a.S.price-a.R.price));return x(y,!l,n.price)?(a.S.price=n.price,!1):!!x(y,!l,d.price)}),d.index=a.S.index,d.time=ue(a.S.index);const g=Math.abs(d.price-c.R.price);return i==3&&(f=a),{tr:c.tr,pr:c.pr,ep:g,epr:c.pr?g/c.pr:0,S1:c.S,R1:c.R,xBox:f,S:n,R:d,breakIndexs:S}}function We(i,r){let t=parseFloat((i%1).toFixed(1));if(r){if(t>=.1&&t<=.2)return Math.floor(i);if(t>=.6&&t<=.7)return Math.floor(i)+.5}else{if(t>=.8&&t<=.9)return Math.ceil(i);if(t>=.3&&t<=.4)return Math.floor(i)+.5}return i}function Pt(i){let r=m.cloneDeep(i);const t=r.B.price-r.A.price,o=e.data.price.at(-1).value;if(x(o,!t,r.C.price)){let s=o;for(let n=e.data.price.length-1;n>=0;n--){const d=e.data.price[n].value;if(d==r.C.price)break;s=t?Math.min(s,d):Math.max(s,d)}r.C.price=s,X(r)}return r}function X(i={}){let r=!m.isSet(i),t={isRemove:r,name:"pattern",points:[],data:[]};r||Object.entries(i).forEach(([o,s])=>{t.points.push(o),t.data.push(s)}),u.dispatch("tradingDerivative/drawTools",t)}function U(){m.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),m.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),m.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y)))),z(["pattern"]),ae([]),le(0)}function ae(i){const r=["#F44336","#4CAF50","#FFEB3B"];let t=[];for(let o=0;o<i.length;o++)t.push({time:ue(i[o]),value:1,color:r[o]});t.length&&t.sort((o,s)=>o.time-s.time),e.series.timeMark.setData(t)}function le(i){p.progress=i}function Et(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function _t(i){i.target.classList.remove("selected"),Ye(),se()}function Bt(){const i=e.crosshair.time;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"0_pt",points:[0],data:[i]}),Ze(i),se(),Se.value.classList.remove("selected")}function Ze(i){e.tools.pickTime=i,e.series.pickTime.setData([{time:i,value:1,color:"#9C27B0"}])}function Ye(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"0_pt"}),e.series.pickTime.setData([]),z(["pt"])}function It(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Vt(i){Ne(),i.target.classList.remove("selected")}function Mt(){let i={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let t={time:r,value:1};switch(e.tools.timeRange.length){case 0:t.color="OrangeRed",e.tools.timeRange[0]=t,i.points.push(0),i.data.push(r);break;case 1:t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(r),re.value.classList.remove("selected");break;default:const o=I(e.tools.timeRange[0].time),s=I(e.tools.timeRange[1].time),d=I(r)+(s-o),l=ue(d);t.color="OrangeRed",e.tools.timeRange[0]=m.cloneDeep(t),i.points.push(0),i.data.push(r),t.time=l,t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(l),re.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",i)}function $t(i){let r,t;if(i.length==2)r=i[0],t=i[1];else if(i.length==3){const s=I(i[0]),n=I(i[1]),l=I(i[2])+(n-s);r=i[2],t=ue(l)}else return!1;let o=[{time:r,value:1,color:"OrangeRed"},{time:t,value:1,color:"lime"}];e.tools.timeRange=o,e.series.timeRange.setData(o)}function Ne(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),e.series.timeRange.setData([]),z(["tr"])}function Wt(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Zt(i){p.showLineContext=!p.showLineContext,p.showScanContext=!1}function Yt(){const i="line",r=pe(e.crosshair.y),t=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const s=o.options(),n=s.type=r==+s.price;return n&&(e.series.price.removePriceLine(o),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:i,point:r})),!n}),e.tools.lines.length==t){const o=p.lineColor,s=p.lineTitle,n={lineType:i,price:r,color:o,title:s,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(n)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:i,points:[r],data:[{color:o,title:s}]})}ie.value.classList.remove("selected")}function Nt(i){const t={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(i).forEach(([o,{color:s,title:n}])=>{t.price=+o,t.color=s,t.title=n,e.tools.lines.push(e.series.price.createPriceLine(t))})}function Xe(i=!0){e.tools.lines.length>0&&(i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),z(["lines"]))}function Xt(i){p.showScanContext=!1,p.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(i.target.classList.add("selected"),Fe())}function zt(i){Fe(),i.target.classList.remove("selected")}function Jt(){const i="target",r=pe(e.crosshair.y);let t={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:i,points:[],data:[r]};if(m.isSet(e.tools.target.A)){const s=+e.tools.target.A.options().price,n=r-s;t.point="B",t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point),t.point="X",t.price=parseFloat((s-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((s-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((s-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((s-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t),Te.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point);u.dispatch("tradingDerivative/drawTools",o)}function qt(i){let t={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const o=i.A,s=i.B,n=s-o;t.point="A",t.price=o,t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="B",t.price=s,t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="X",t.price=parseFloat((o-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((o-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((o-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((o-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t)}function Fe(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),m.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),m.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z),e.series.price.removePriceLine(e.tools.target.W))),z(["target"])}function Ht(){N(["entry","tp","sl"],!1),Xe(!1),Fe(!1),Ne(!1),U()}function ce(i){if(i){if($()&&(m.isSet(e.tools.order.tp.line)||R.value.position&&e.currentSeconds>L.ATO&&e.currentSeconds<L.ATC&&(Q.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",Q.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",Q.value.style.display="block"),!m.isSet(e.tools.order.entry.line))){let r=null,t=0;R.value.position?(e.currentSeconds<L.ATO?r="ATO":e.currentSeconds>L.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,t=-R.value.position)):e.currentSeconds>L.ATO&&e.currentSeconds<L.ATC&&(r=pe(e.crosshair.y),t=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=t,e.tools.order.entry.price=r),t&&(Z.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",Z.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",Z.value.style.background=t>0?"green":"red",Z.value.innerText=`${t>0?"LONG":"SHORT"} ${r}`,Z.value.style.display="block")}}else Z.value.style.display="none",Q.value.style.display="none"}function jt(){$()&&(e.currentSeconds<L.ATO?Ue(h("trading.derivative.atoOrder"),h("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(t=>{t.isOk?F.success(h("trading.derivative.atoOrderSuccess")):A(t.message)})}):e.currentSeconds<L.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(i=>{i.isOk?(Y(["entry"]),F.success(h("trading.derivative.newEntrySuccess"))):A(i.message)}):Ue(h("trading.derivative.atcOrder"),h("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(t=>{t.isOk?F.success(h("trading.derivative.atcOrderSuccess")):A(t.message)})}))}function Qt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Ge,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*Ke,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(i=>{i.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),Y(["entry","tp","sl"]),F.success(h("trading.derivative.newTpSlSuccess"))):A(i.message)})}function Ut(){m.isSet(e.tools.order.entry.line)?m.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(i=>{i.isOk?(N(["entry","tp","sl"]),F.success(h("trading.derivative.exitSuccess"))):A(i.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(i=>{i.isOk?(N(["entry"]),F.success(h("trading.derivative.deleteEntrySuccess"))):A(i.message)}):de()}function Gt(i){m.isSet(e.tools.order.entry.line)&&(m.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&i>=e.tools.order.tp.price||e.tools.order.side<0&&i<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(N(["entry","tp","sl"]),F.success(h("trading.derivative.deleteTpSuccess")),ce(!1)):A(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&i<=e.tools.order.sl.price||e.tools.order.side<0&&i>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(N(["entry","tp","sl"]),F.success(h("trading.derivative.deleteSlSuccess")),ce(!1)):A(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&i>=e.tools.order.entry.price||e.tools.order.side<0&&i<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Ge,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*Ke,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),Y(["entry","tp","sl"]),F.success(h("trading.derivative.autoNewTpSlSuccess"))):A(r.message),e.isAutoOrdering=!1})},1e3))))}function Kt(){e.chart.timeScale().scrollToRealTime()}function $(){return B.value.openingMarket&&e.currentSeconds>=L.START&&e.currentSeconds<=L.END}function pe(i){return parseFloat(e.series.price.coordinateToPrice(i).toFixed(1))}function A(i){i||(i="unknown"),F.error(h(`trading.derivative.${i}`))}function ei(){if(!p.chartDate)return!1;u.dispatch("tradingDerivative/getChartData",p.chartDate)}function ze(){$()&&e.websocket.send(e.socketSendData)}function ti(){e.data.whitespace=[],e.data.price=[],ze(),u.dispatch("tradingDerivative/getChartData",p.chartDate)}function Je(){u.dispatch("tradingDerivative/getStatus")}function de(){u.dispatch("tradingDerivative/getTools")}function z(i){i==null&&(i=["order","lines","tr","pattern","target","pt"]),i.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),i.includes("lines")&&(e.tools.lines=[]),i.includes("target")&&(e.tools.target={}),i.includes("tr")&&(e.tools.timeRange=[]),i.includes("pattern")&&(e.tools.pattern={}),i.includes("pt")&&(e.tools.pickTime=null)}function ii(){u.dispatch("tradingDerivative/getAccountInfo").then(i=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.nav")}</div><div>: ${te.currency(i.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.maxVol")}</div><div>: ${te.numberVnFormat(i.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.vm")}</div><div>: ${te.currency(i.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.fee")}</div><div>: ${te.currency(i.fee)}</div></div>`,r+="</div>",Fi(r,h("trading.derivative.accountInfo"))})}function ri(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/report"))}function oi(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/export",p.chartDate))}function si(){Pe.value.show()}function ni(){ye.emit("checkPin",()=>u.dispatch("tradingDerivative/loginDnse"))}function x(i,r,t,o=!1){return r?o?i>=t:i>t:o?i<=t:i<t}function I(i){let r=e.data.whitespace.findIndex(t=>t.time==i);if(r==-1){const t=me(new Date(i*1e3),"yyyy-MM-dd"),o=D(new Date(`${t}T11:30:00Z`)),s=D(new Date(`${t}T13:00:00Z`)),n=D(new Date(`${t}T14:30:00Z`));i>o&&i<s?i=o:i>n&&(i=n),r=e.data.whitespace.findIndex(d=>d.time==i)}return r}function ue(i){return e.data.whitespace[i].time}return(i,r)=>{const t=Di("DxToolbar");return Oi(),Si(ki,null,[v("div",_i,[ve(t,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:i.$t("trading.derivative.buttons.report"),onClick:ri}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:i.$t("trading.derivative.buttons.export"),onClick:oi}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:i.$t("trading.derivative.buttons.loginVps"),onClick:si}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:i.$t("trading.derivative.buttons.loginDnse"),onClick:ni}}]},null,8,["items"]),v("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:_,onClick:pt,onContextmenu:dt},[v("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:Ae},[v("div",{class:"area data-area",onClick:_e,onContextmenu:Be},[v("div",{ref_key:"connectionRef",ref:tt,class:M(["command",{yellow:R.value.pending}]),title:i.$t("trading.derivative.connection"),onClick:Je},[v("i",{class:M(["far",{"fa-link-simple":R.value.connection,"fa-link-simple-slash":!R.value.connection,blink:p.isSocketWarning}])},null,2)],10,Bi),v("div",{class:M(["command status",{green:R.value.position>0,red:R.value.position<0}]),title:i.$t("trading.derivative.position"),onClick:ii},Qe(R.value.position),11,Ii),v("div",{class:"command clock",onClick:ze},Qe(p.clock),1),ee(v("input",{type:"date",class:"chart-date command",title:i.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=o=>p.chartDate=o),onChange:ei},null,40,Vi),[[Ti,p.chartDate]]),v("div",{ref_key:"reloadToolRef",ref:ot,class:"command",title:i.$t("trading.derivative.reload"),onClick:ti,onContextmenu:de},[v("i",{class:M(["far fa-sync-alt",{"fa-spin":at.value}])},null,2)],40,Mi)],32),v("div",{class:"area tool-area",onClick:_e,onContextmenu:Be},[v("div",{ref_key:"fullscreenToolRef",ref:it,class:"command",title:i.$t("trading.derivative.fullscreen"),onClick:vt},[v("i",{class:M(["far",{"fa-compress":p.isFullscreen,"fa-expand":!p.isFullscreen}])},null,2)],8,$i),v("div",{ref_key:"tradingviewRef",ref:st,class:"command far fa-chart-candlestick",title:i.$t("trading.derivative.tradingview"),onClick:Tt},null,8,Wi),v("div",{class:M(["context command",{green:p.progress.result==!0,red:p.progress.result==!1}]),title:i.$t("trading.derivative.progressTool"),onClick:se,onContextmenu:wt},[v("i",{class:M(["far",{"fa-badge-check":!p.progress.step,[`fa-circle-${p.progress.step}`]:p.progress.step,blink:B.value.autoRefresh}])},null,2)],42,Zi),v("div",{ref_key:"scanToolRef",ref:Ce,class:"context command",title:i.$t("trading.derivative.scanTool"),onClick:Ct,onContextmenu:kt},[v("i",{class:M(["far",{[`fa-angles-${p.scanSide}`]:!0}])},null,2),ee(ve(Ri,{class:"contextmenu",modelValue:p.scanSide,"onUpdate:modelValue":r[1]||(r[1]=o=>p.scanSide=o)},null,8,["modelValue"]),[[ge,p.showScanContext]])],40,Yi),v("div",{ref_key:"patternToolRef",ref:xe,class:"command",title:i.$t("trading.derivative.patternTool"),onClick:Lt,onContextmenu:Rt},zi,40,Ni),v("div",{ref_key:"pickTimeToolRef",ref:Se,class:"command",title:i.$t("trading.derivative.pickTimeTool"),onClick:Et,onContextmenu:_t},Hi,40,Ji),v("div",{ref_key:"lineToolRef",ref:ie,class:"context command",title:i.$t("trading.derivative.lineTool"),onClick:Wt,onContextmenu:Zt},[Qi,ee(ve(Li,{class:"contextmenu",enable:p.showLineContext,title:p.lineTitle,"onUpdate:title":r[2]||(r[2]=o=>p.lineTitle=o),color:p.lineColor,"onUpdate:color":r[3]||(r[3]=o=>p.lineColor=o),onDeleteAllLine:Xe},null,8,["enable","title","color"]),[[ge,p.showLineContext]])],40,ji),v("div",{ref_key:"timeRangeToolRef",ref:re,class:"command",title:i.$t("trading.derivative.timeRangeTool"),onClick:It,onContextmenu:Vt},Ki,40,Ui),v("div",{ref_key:"targetToolRef",ref:Te,class:"command",title:i.$t("trading.derivative.targetTool"),onClick:Xt,onContextmenu:zt},ir,40,er),ee(v("div",{ref_key:"cancelOrderRef",ref:nt,class:"cancel-order command",title:i.$t("trading.derivative.cancelTool"),onClick:Ut},[v("i",{class:M(["far fa-trash-alt",{blink:p.isOrderWarning}])},null,2)],8,rr),[[ge,lt.value]])],32),v("div",null,[v("div",{ref_key:"entryOrderRef",ref:Z,class:"order-button entry",onClick:jt}," Entry ",512),v("div",{ref_key:"tpslOrderRef",ref:Q,class:"order-button tpsl",onClick:Qt}," TP/SL ",512),v("div",{class:"chart-top command far fa-angle-double-right",onClick:Kt})]),ee(v("iframe",{ref_key:"tradingviewChartRef",ref:rt,class:"tradingview-chart",style:Ci(p.tradingViewStyle),src:ct.value},null,12,or),[[ge,p.showTradingView]])],512)],544)]),ve(Ai,{ref_key:"vpsOtpPopupRef",ref:Pe},null,512)],64)}}};export{mr as default};
