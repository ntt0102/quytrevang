import{u as q,c as N,i as u,r as p,d as S,f as I,n as B,k as n,_ as D,o as _,j as t,h as b,l,S as E,T as i,s as O}from"./app-5e2d1964.js";const w=["onSubmit"],A={ref:"submitRef",class:"display-none"},V={__name:"EditProfilePopup",setup(C,{expose:v}){const d=q(),{t:a}=N(),f=u("bus"),s=u("mt"),m=u("mf"),r=p(null),c=p(null),o=S({formData:null,banks:[],validationRules:{name:[{type:"required",message:a("models.user.name")+s.validations.required},{type:"stringLength",max:50,message:a("models.user.validations.name")}],sex:[{type:"required",message:a("models.user.sex")+s.validations.required}],birthday:[{type:"required",message:a("models.user.birthday")+s.validations.required},{type:"custom",validationCallback:g,message:a("models.user.validations.birthday")}],idNumber:[{type:"required",message:a("models.user.idNumber")+s.validations.required},{type:"async",validationCallback:e=>d.dispatch("userProfile/validateDuplicateIdNumber",e),message:a("models.user.idNumber")+s.validations.duplicate}],idIssuedOn:[{type:"required",message:a("models.user.idIssuedOn")+s.validations.required},{type:"custom",validationCallback:k,message:a("models.user.validations.idIssuedOn")}],phone:[{type:"required",message:a("models.user.phone")+s.validations.required},{type:"async",validationCallback:e=>d.dispatch("userProfile/validateDuplicatePhone",e),message:a("models.user.phone")+s.validations.duplicate}],email:[{type:"required",message:a("models.user.email")+s.validations.required},{type:"email",message:a("models.user.email")+s.validations.email},{type:"async",validationCallback:e=>d.dispatch("userProfile/validateDuplicateEmail",e),message:a("models.user.email")+s.validations.duplicate}],address:[{type:"required",message:a("models.user.address")+s.validations.required},{type:"stringLength",max:100,message:a("models.user.validations.address")}],bankAccount:{bankName:[{type:"required",message:a("models.user.bankName")+s.validations.required}],accountName:[{type:"required",message:a("models.user.accountName")+s.validations.required}],accountNumber:[{type:"required",message:a("models.user.accountNumber")+s.validations.required},{type:"numeric",message:a("models.user.accountNumber")+s.validations.numeric}]}}});function y(e){r.value.show(),o.formData=m.cloneDeep(e)}function h(){f.emit("checkPin",()=>{d.dispatch("userProfile/save",o.formData).then(e=>{e&&r.value.hide()})})}function g(e){return moment(e.value).isBefore(moment().subtract(18,"years"))}function k(e){return moment(e.value).isBefore(moment().subtract(1,"day"))}function $(){setTimeout(()=>c.value.instance.getEditor("name").focus(),500),m.getBanks().then(e=>o.banks=e)}function x(){}return v({show:y}),(e,P)=>{const R=I("DxScrollView");return _(),B(D,{ref_key:"popupRef",ref:r,title:e.$t("components.editProfile.title"),toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:()=>e.$refs.submitRef.click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>r.value.hide()}}],onShown:$,onHidden:x},{default:n(()=>[t(R,null,{default:n(()=>[b("form",{onSubmit:O(h,["prevent"])},[b("button",A,null,512),t(l(E),{ref_key:"formRef",ref:c,"form-data":o.formData,labelMode:"floating","col-count":2,"label-location":e.$screen.getScreenSizeInfo.isXSmall?"top":"left","scrolling-enabled":!0},{default:n(()=>[t(l(i),{"item-type":"group",caption:e.$t("models.user.groups.personalInfo")},{default:n(()=>[t(l(i),{"data-field":"name","validation-rules":o.validationRules.name,label:{text:e.$t("models.user.name")}},null,8,["validation-rules","label"]),t(l(i),{"data-field":"sex","editor-type":"dxSelectBox","editor-options":{searchEnabled:!1,items:e.$mf.getSexList(),displayExpr:"name",valueExpr:"value",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":o.validationRules.sex,label:{text:e.$t("models.user.sex")}},null,8,["editor-options","validation-rules","label"]),t(l(i),{"data-field":"birthday","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":o.validationRules.birthday,label:{text:e.$t("models.user.birthday")}},null,8,["editor-options","validation-rules","label"])]),_:1},8,["caption"]),t(l(i),{"item-type":"group",caption:e.$t("models.user.groups.idInfo")},{default:n(()=>[t(l(i),{"data-field":"identity.number",editorOptions:{mask:"000000000000"},"validation-rules":o.validationRules.idNumber,label:{text:e.$t("models.user.idNumber")}},null,8,["validation-rules","label"]),t(l(i),{"data-field":"identity.issued_on","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":o.validationRules.idIssuedOn,label:{text:e.$t("models.user.idIssuedOn")}},null,8,["editor-options","validation-rules","label"]),t(l(i),{"data-field":"",editorOptions:{value:e.$mt.idIssuedAtValue,readOnly:!0},label:{text:e.$t("models.user.idIssuedAt")}},null,8,["editorOptions","label"])]),_:1},8,["caption"]),t(l(i),{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.contactInfo")},{default:n(()=>[t(l(i),{"data-field":"phone",editorOptions:{mask:"0000.000.000"},"validation-rules":o.validationRules.phone,label:{text:e.$t("models.user.phone")}},null,8,["validation-rules","label"]),t(l(i),{"data-field":"email","validation-rules":o.validationRules.email,label:{text:e.$t("models.user.email")}},null,8,["validation-rules","label"]),t(l(i),{"col-span":2,"data-field":"address","editor-type":"dxTextArea","validation-rules":o.validationRules.address,label:{text:e.$t("models.user.address")}},null,8,["validation-rules","label"])]),_:1},8,["caption"]),t(l(i),{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.bankInfo")},{default:n(()=>[t(l(i),{"data-field":"bank_account.bank_name","editor-type":"dxSelectBox","editor-options":{searchEnabled:!0,items:o.banks,displayExpr:"short_name",searchExpr:"short_name",valueExpr:"short_name",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":o.validationRules.bankAccount.bankName,label:{text:e.$t("models.user.bankName")}},null,8,["editor-options","validation-rules","label"]),t(l(i),{"data-field":"bank_account.account_number","validation-rules":o.validationRules.bankAccount.accountNumber,label:{text:e.$t("models.user.accountNumber")}},null,8,["validation-rules","label"]),t(l(i),{"data-field":"bank_account.account_name","editor-type":"dxTextBox","editor-options":{inputAttr:{style:"text-transform: uppercase"}},"validation-rules":o.validationRules.bankAccount.accountName,label:{text:e.$t("models.user.accountName")}},null,8,["validation-rules","label"])]),_:1},8,["caption"])]),_:1},8,["form-data","label-location"])],40,w)]),_:1})]),_:1},8,["title","toolbarItems"])}}};export{V as default};
