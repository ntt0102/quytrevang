import{u as C,i as R,r as _,e as S,d as F,g as r,h as t,t as s,B as T,G as b,j as u,k as h,l as m,o,A as P,D as G,m as N}from"./app-d6f97dd1.js";import{_ as z}from"./ContractDetailPopup-1b7b97e6.js";const A={class:"overview-contracts"},B={class:"sum dx-card responsive-paddings content-block"},E={class:"header"},V={class:"body"},j={class:"title"},U={key:0,class:"currency"},L={key:1},O={class:"title"},q={key:0,class:"currency"},H={key:1},J={class:"title"},K={key:0,class:"currency interest"},M={key:1},Q={class:"list dx-card responsive-paddings content-block"},W={class:"header"},X=["onClick"],Y={class:"responsive-paddings",style:{position:"relative"}},Z={class:"info"},x={class:"interest-rate"},I={class:"date"},ee={class:"currency"},te={class:"principal"},se={class:"interest"},ae=100,f=4,oe={__name:"Contracts",setup(ie){const c=C(),g=R("mf"),v=_(null),p=_(null),y=S(()=>c.state.auth.user.level),i=F({gridData:null,asset:null,principal:null,interest:null});let a={sum:{},interval:{},change:{},doneFlag:!1};c.dispatch("userContract/getContracts",!1).then(()=>{i.gridData=g.cloneDeep(c.state.userContract.contracts),$()});function w(e){e.rowType=="header"&&(e.rowElement.style.display="none")}function D(e){return`status-${e}`}function $(){a.sum=i.gridData.reduce((e,l)=>([2,3].includes(l.status)&&(e.principal+=l.principal,e.interest+=l.interest,e.asset+=l.total),e),{principal:0,interest:0,asset:0}),k(),a.interval=setInterval(()=>{d("principal"),d("interest"),d("asset"),a.doneFlag&&clearInterval(a.interval)},f)}function k(){let e=ae/f;a.change={principal:a.sum.principal/e,interest:a.sum.interest/e,asset:a.sum.asset/e}}function d(e){i[e]<a.sum[e]-a.change[e]?(i[e]+=a.change[e],a.doneFlag=!1):(i[e]=a.sum[e],a.doneFlag=!0)}return(e,l)=>(o(),r("div",A,[t("div",B,[t("div",E,s(e.$t("user.overview.contract.sumTitle")),1),t("div",V,[t("div",null,[t("div",j,s(e.$t("user.overview.contract.assetSum")),1),i.asset!=null?(o(),r("div",U,s(e.$filters.currency(i.asset.toFixed(0))),1)):(o(),r("div",L,"-"))]),t("div",null,[t("div",O,s(e.$t("user.overview.contract.principalSum")),1),i.principal!=null?(o(),r("div",q,s(e.$filters.currency(i.principal.toFixed(0))),1)):(o(),r("div",H,"-"))]),t("div",null,[t("div",J,s(e.$t("user.overview.contract.interestSum")),1),i.interest!=null?(o(),r("div",K,s(e.$filters.currency(i.interest.toFixed(0),"+ ")),1)):(o(),r("div",M,"-"))])])]),T(t("div",Q,[t("div",W,s(e.$t("user.overview.contract.listTitle")),1),u(m(N),{ref_key:"dataGridRef",ref:v,"data-source":i.gridData,"key-expr":"code","show-borders":!1,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!1},"data-row-template":"dataRowTemplate",onContentReady:l[0]||(l[0]=()=>e.$mf.dataGridPreload(i.gridData,v.value.instance)),onRowPrepared:w},{dataRowTemplate:h(({data:n})=>[t("tr",{role:"cell",class:"item",onClick:ne=>p.value.show(n.data)},[t("td",null,[t("div",Y,[t("div",{class:P(["status",D(n.data.status)])},null,2),t("div",Z,[t("div",null,[t("span",null,"#"+s(n.data.code),1),t("span",x,s(e.$filters.percentInterestRate(n.data.interest_rate)),1)]),t("div",I,[t("div",null,s(e.$filters.formatDate(n.data.paid_at))+" ~ "+s(e.$filters.formatDate(n.data.withdrawn_at))+" Â  ",1),t("div",null,"("+s(n.data.duration)+")",1)])]),t("div",ee,[t("div",te,s(e.$filters.currency(n.data.principal)),1),t("div",se,s(e.$filters.currency(n.data.interest,"+ ")),1)])])])],8,X)]),default:h(()=>[u(m(G))]),_:1},8,["data-source"])],512),[[b,y.value>=6]]),u(z,{ref_key:"contractDetailPopupRef",ref:p},null,512)]))}};export{oe as default};
