import{z as at,A as ct,B as lt,r as N,y as We,C as Ge,o as H,b as J,d as B,E as ae,c as ce,G as Te,H as _e,I as pt,J as dt,F as Me,K as Ve,t as ye,h as me,u as Oe,e as ne,L as ut,M as ft,N as je,O as Ke,g as et,k as fe,w as ve,Q as mt,m as vt,R as ht,S as qe,x as re,l as Le,a as gt,T as St,U as yt,j as Tt,V as xt}from"./app-7964cd9e.js";import{_ as Ct}from"./text-box-ff175d33.js";import{g as G}from"./getUnixTime-f5bd8446.js";import{c as kt}from"./lightweight-charts.esm.development-03366bac.js";function tt(R,$,C){return at((C==null?void 0:C.in)||R,+ct(R)+$)}function ke(R,$,C){return tt(R,$*lt,C)}function _t(R,$,C){return tt(R,$*1e3,C)}function bt(R,$,C){return _t(R,-$,C)}const wt=["title"],Dt={__name:"FullscreenTool",props:["chartContainerRef"],setup(R){const $=R,C=N(!1);We(()=>{document.addEventListener("fullscreenchange",t)}),Ge(()=>{document.removeEventListener("fullscreenchange",t)});function f(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function t(){$.chartContainerRef&&(document.fullscreenElement?(C.value=!0,$.chartContainerRef.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(C.value=!1,$.chartContainerRef.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}return(s,y)=>(H(),J("div",{class:"command",title:s.$t("trading.derivative.fullscreen"),onClick:f},[B("i",{class:ae(["far",{"fa-compress":C.value,"fa-expand":!C.value}])},null,2)],8,wt))}},Rt=["title"],Et=["src"],Lt={__name:"TradingviewTool",props:["vpsUser","vpsSession","chartContainerRef"],setup(R){const $=R,C=N(null),f=N(!1),t=ce(()=>`https://chart.vps.com.vn/tv/?u=${$.vpsUser}&s=${$.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);function s(T){f.value=!f.value,y(),T.stopPropagation()}function y(){if($.chartContainerRef&&C.value){const{offsetWidth:T,offsetHeight:P}=$.chartContainerRef,{top:d,left:g}=C.value.getBoundingClientRect();C.value.style.top=`${d-2}px`,C.value.style.left=`${g+32}px`,C.value.style.width=`${T-34}px`,C.value.style.height=`${P}px`}}return(T,P)=>(H(),J("div",{class:"tradingview command far fa-chart-candlestick",title:T.$t("trading.derivative.tradingview"),onClick:s},[Te(B("iframe",{ref_key:"tradingviewRef",ref:C,class:"chart",src:t.value},null,8,Et),[[_e,f.value]])],8,Rt))}};const Ot=B("div",{class:"triangle-shadow"},null,-1),Pt=B("div",{class:"triangle"},null,-1),It={class:"container"},$t={__name:"ProgressContext",props:["progress"],setup(R){const $=N([]);We(()=>{C()});function C(){pt(Object.assign({"../../../../../lang/vi/derivative.js":()=>dt(()=>import("./derivative-0a1a41d1.js"),[])}),`../../../../../lang/${window.lang}/derivative.js`).then(t=>{$.value=t.default||[]})}function f(t){t.stopPropagation()}return(t,s)=>(H(),J("div",{class:"pattern-context",onClick:f},[Ot,Pt,B("div",It,[(H(!0),J(Me,null,Ve($.value,(y,T)=>(H(),J("div",{key:T,class:ae(["step",[R.progress.step&&R.progress.step===T+1?R.progress.result?"success":"fail":""]])},[B("div",{class:ae(["name",[R.progress.steps?R.progress.steps[T].every(Boolean)?"success":"fail":""]])},ye(T+1)+". "+ye(y.name),3),B("div",null,[(H(!0),J(Me,null,Ve(y.conds,(P,d)=>(H(),J("div",{key:d,class:ae(["condition",[R.progress.steps?R.progress.steps[T][d]?"success":"fail":""]])},ye(d+1)+". "+ye(P),3))),128))])],2))),128))])]))}},At=["title"],Nt={__name:"ProgressTool",props:["position"],emits:["refreshPattern","hideContext"],setup(R,{expose:$,emit:C}){const f=me(),{t}=Oe(),s=R,y=C,T=N({}),P=N(!1),d=ce(()=>f.state.tradingDerivative.config.autoRefresh);$({hide:u,set:M});function g(){const x=P.value;y("hideContext"),P.value=!x,P.value&&y("refreshPattern")}function u(x){P.value=x}function M(x){s.position||Z(x,T.value),T.value=x}function W(x){const m=x??!m.value;f.dispatch("tradingDerivative/setAutoRefresh",m)}function Z(x,m){if(d.value&&(x.step!==m.step||x.step===m.step&&x.result!==m.result)){let a="";x.result?[2,4].includes(x.step)?a=t("trading.derivative.progressOrder",x):a=t("trading.derivative.progressSuccess",x):a=t("trading.derivative.progressFail",x),V(a)}}function V(x){const m=new SpeechSynthesisUtterance(x);m.lang="vi-VN",speechSynthesis.speak(m)}return(x,m)=>(H(),J("div",{class:ae(["context command",{green:T.value.result===!0,red:T.value.result===!1}]),title:x.$t("trading.derivative.progressTool"),onClick:g,onContextmenu:W},[B("i",{class:ae(["far",{"fa-badge-check":!T.value.step,[`fa-circle-${T.value.step}`]:T.value.step,blink:d.value}])},null,2),Te(ne($t,{class:"contextmenu",progress:T.value},null,8,["progress"]),[[_e,P.value]])],42,At))}};var xe={};const Bt=ut(ft);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Ft=je&&je.__importDefault||function(R){return R&&R.__esModule?R:{default:R}};Object.defineProperty(xe,"__esModule",{value:!0});xe.DxItem=xe.DxButtonGroup=void 0;var Mt=Ft(Bt),Vt=Ke,Wt=Ke,it=Vt.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttonTemplate:{},disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,items:Array,keyExpr:[Function,String],onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onOptionChanged:Function,onSelectionChanged:Function,rtlEnabled:Boolean,selectedItemKeys:Array,selectedItems:Array,selectionMode:String,stylingMode:String,tabIndex:Number,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttonTemplate":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:items":null,"update:keyExpr":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onOptionChanged":null,"update:onSelectionChanged":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectedItems":null,"update:selectionMode":null,"update:stylingMode":null,"update:tabIndex":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Mt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}}}});xe.DxButtonGroup=it;var Ze=Wt.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:elementAttr":null,"update:hint":null,"update:html":null,"update:icon":null,"update:template":null,"update:text":null,"update:type":null,"update:visible":null},props:{disabled:Boolean,elementAttr:Object,hint:String,html:String,icon:String,template:{},text:String,type:String,visible:Boolean}});xe.DxItem=Ze;Ze.$_optionName="items";Ze.$_isCollectionItem=!0;var Zt=xe.default=it;const Yt=B("div",{class:"triangle-shadow"},null,-1),zt=B("div",{class:"triangle"},null,-1),Ht={__name:"ScanContext",props:["modelValue"],emits:["update:modelValue"],setup(R,{emit:$}){const{t:C}=Oe(),f=[{icon:"chevrondoubleleft",side:"left",text:C("trading.derivative.scanContext.leftScan")},{icon:"chevrondoubleright",side:"right",text:C("trading.derivative.scanContext.rightScan")}],t=R,s=$;function y({itemData:{side:P}}){s("update:modelValue",P)}function T(P){P.stopPropagation()}return(P,d)=>(H(),J("div",{class:"scan-context",onClick:T},[Yt,zt,ne(et(Zt),{items:f,"selected-item-keys":[t.modelValue],"key-expr":"side","styling-mode":"outlined",onItemClick:y},null,8,["selected-item-keys"])]))}},Jt=["title"],Xt={__name:"ScanTool",props:["prices","timeToIndex"],emits:["scaned","removePattern","hideContext"],setup(R,{expose:$,emit:C}){const f=fe("mf"),t=R,s=C,y=N(null),T=N(!1),P=N("left");$({isSelected:d,hide:g,draw:W});function d(){return y.value.classList.contains("selected")}function g(m){T.value=m}function u(m){s("hideContext");const a=m.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(S=>S.classList.remove("selected")),a||(m.target.classList.add("selected"),s("removePattern"))}function M(){const m=T.value;s("hideContext"),T.value=!m}function W({time:m}){const a=P.value==="left",S=m?t.prices.filter(c=>!f.cmp(c.time,a,m)):t.prices;let i=a?Z(S):V(S);f.isSet(i)&&s("scaned",x(i)),y.value.classList.remove("selected")}function Z(m){let a,[S,i,c,h]=Array(4).fill({});for(let v=m.length-1;v>=0;v--){const b=m[v].value,k=m[v].time,e=t.timeToIndex(k);if(e===-1)break;if(v===m.length-1&&(c={index:e,time:k,price:b},[i,S,h]=Array(3).fill(null).map(()=>f.cloneDeep(c))),a===void 0){if(b===c.price)continue;a=b>c.price}if(f.cmp(b,a,i.price)&&(f.cmp(S.price,!a,c.price)?([c,i]=[i,S].map(p=>f.cloneDeep(p)),S={index:e,time:k,price:b},h=f.cloneDeep(S),a=!a):i={index:e,time:k,price:b}),f.cmp(b,!a,S.price)?(S={index:e,time:k,price:b},h=f.cloneDeep(S)):h.index=e,f.cmp(b,a,h.price)&&(h={index:e,time:k,price:b}),c.index>S.index){const p=f.fmtNum(i.price-c.price,1,!0);if(p>=1.5&&(S.index-h.index>c.index-i.index||f.fmtNum(S.price-h.price,1,!0)>p))break}}return{A:S,B:i,C:c}}function V(m){let a,[S,i,c]=Array(3).fill({});for(let h=0;h<m.length;h++){const v=m[h].value,b=m[h].time,k=t.timeToIndex(b);if(k===-1)break;if(h===0&&(S={index:k,time:b,price:v},i=f.cloneDeep(S),c=f.cloneDeep(S)),a===void 0){if(v===S.price)continue;a=v>S.price}f.cmp(v,a,i.price)&&(i={index:k,time:b,price:v},c=f.cloneDeep(i)),f.cmp(i.price,a,S.price)&&f.cmp(v,!a,c.price)&&(f.cmp(v,a,S.price)?c={index:k,time:b,price:v}:(S=f.cloneDeep(i),i={index:k,time:b,price:v},c=f.cloneDeep(i),a=!a))}return{A:S,B:i,C:c}}function x(m){const a={};return Object.entries(m).forEach(([S,i])=>{const{index:c,...h}=i;a[S]=h}),a}return(m,a)=>(H(),J("div",{ref_key:"scanToolRef",ref:y,class:"context command",title:m.$t("trading.derivative.scanTool"),onClick:u,onContextmenu:M},[B("i",{class:ae(["far",{[`fa-angles-${P.value}`]:!0}])},null,2),Te(ne(Ht,{class:"contextmenu",modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=S=>P.value=S)},null,8,["modelValue"]),[[_e,T.value]])],40,Jt))}},jt=["title"],qt=B("i",{class:"far fa-heart-rate"},null,-1),Ut=[qt],Qt={__name:"PatternTool",props:["prices","priceSeries","timeMarkSeries","pickTimeToolRef","timeToIndex","indexToTime"],emits:["setProgress","hideContext"],setup(R,{expose:$,emit:C}){const f=me(),t=fe("mf"),s=R,y=C,T=N(null),P=ce(()=>f.state.tradingDerivative.tools.pattern);let d={},g={};$({isSelected:u,draw:Z,load:V,refresh:m,remove:b,drag:p}),ve(P,o=>{o&&V(o,{isCheck:!0})});function u(){return T.value.classList.contains("selected")}function M(o){y("hideContext");const n=o.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(_=>_.classList.remove("selected")),n||(o.target.classList.add("selected"),s.pickTimeToolRef.remove())}function W(o){o.target.classList.remove("selected"),b()}function Z({time:o,price:n}){let l={lineType:"pattern",price:n,lineWidth:1,lineStyle:1,draggable:!0};if(t.isSet(g.A))if(t.isSet(g.B)){let A,E;if(t.isSet(g.C)){let L,w;d.A={time:o,price:n};const{progress:I,timeMark:F,info:{rEpr1:X,rEpr2:U,rEpr3:se,entry:ee,pStatus:te,x:ie,X:j,y:Q,Y}}=a();E=I,A=F,L="A",w={price:n,title:`A ${X}`},g[L].applyOptions(w),L="B",w={title:`B ${U}`},g[L].applyOptions(w),L="C",w={title:`C ${se}`},g[L].applyOptions(w),L="D",w={price:ee,title:"Entry "+te},g[L].applyOptions(w),L="X",w={price:t.fmtNum(ie),title:`X ${t.fmtNum(j)}`},g[L].applyOptions(w),L="Y",w={price:t.fmtNum(Q),title:`Y ${t.fmtNum(Y)}`},g[L].applyOptions(w)}else{d.C={price:n};const{progress:L,timeMark:w,info:{rEpr1:I,rEpr2:F,rEpr3:X,entry:U,pStatus:se,x:ee,X:te,y:ie,Y:j}}=a();E=L,A=w;let Q="A";g[Q].applyOptions({title:`A ${I}`}),Q="B",g[Q].applyOptions({title:`B ${F}`}),l.point="C",l.title=`C ${X}`,l.color="#FFEB3B",g[l.point]=s.priceSeries.createPriceLine(l),l.point="D",l.price=U,l.title="Entry "+se,l.color="#9C27B0",l.draggable=!1,g[l.point]=s.priceSeries.createPriceLine(l),l.point="Y",l.price=t.fmtNum(ie),l.title=`Y ${t.fmtNum(j)}`,l.color="#E91E63",l.draggable=!1,g[l.point]=s.priceSeries.createPriceLine(l),l.point="X",l.price=t.fmtNum(ee),l.title=`X ${t.fmtNum(te)}`,l.color="#2196F3",l.draggable=!1,g[l.point]=s.priceSeries.createPriceLine(l)}v(),y("setProgress",E),e(A),T.value.classList.remove("selected")}else l.point="B",l.title="B 0",l.color="#4CAF50",g[l.point]=s.priceSeries.createPriceLine(l),d.B={price:n};else l.point="A",l.title="A 0",l.color="#F44336",g[l.point]=s.priceSeries.createPriceLine(l),d={A:{time:o,price:n}}}function V(o,{isSave:n=!1,isCheck:_=!1}){d=t.cloneDeep(o),n&&v(),(_?i(d):!0)&&(k(),x())}function x(){let n={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{A:_,B:l,C:A}=d,{progress:E,timeMark:L,info:{rEpr1:w,rEpr2:I,rEpr3:F,entry:X,pStatus:U,x:se,X:ee,y:te,Y:ie}}=a();y("setProgress",E),e(L),n.point="A",n.title=`A ${w}`,n.color="#F44336",n.price=_.price,g[n.point]=s.priceSeries.createPriceLine(n),n.point="B",n.title=`B ${I}`,n.color="#4CAF50",n.price=l.price,g[n.point]=s.priceSeries.createPriceLine(n),n.point="C",n.price=A.price,n.title=`C ${F}`,n.color="#FFEB3B",g[n.point]=s.priceSeries.createPriceLine(n),n.point="D",n.price=X,n.title="Entry "+U,n.color="#9C27B0",n.draggable=!1,g[n.point]=s.priceSeries.createPriceLine(n),n.point="Y",n.price=t.fmtNum(te),n.title=`Y ${t.fmtNum(ie)}`,n.color="#E91E63",n.draggable=!1,g[n.point]=s.priceSeries.createPriceLine(n),n.point="X",n.price=t.fmtNum(se),n.title=`X ${t.fmtNum(ee)}`,n.color="#2196F3",n.draggable=!1,g[n.point]=s.priceSeries.createPriceLine(n)}function m(o=!1){t.isSet(g.C)&&(o&&h(),k(),x())}function a(){const{A:o,B:n,C:_}=d,l=n.price-_.price,A=l>0,E=S({phase:1,start:o,end:n,retracementPrice:_.price});let L=S({phase:2,start:E.R,end:_});const w=S({phase:3,start:L.R,end:{price:n.price+(A?1:-1)*E.rEp},breakPrices:[L.S1.price,n.price]});E.xBox.tr>=L.tr&&(L.tr=E.xBox.tr),console.log("calculatePattern",[E,L,w]);const I=t.fmtNum(l,1,!0)>=E.pr,F=t.fmtNum(_.price-w.xBox.R.price,1,!0)>=L.pr,X=t.fmtNum(w.xBox.pr)>=w.pr,U=!t.cmp(_.price,!A,E.S1.price),se=!t.cmp(w.xBox.R.price,A,L.S1.price),ee=!t.cmp(w.xBox.S.price,!A,w.S1.price),te=E.R.index+E.tr,ie=E.R.index+5*E.tr,j=L.R.index+L.tr,Q=w.xBox.R.index+w.tr,Y=w.xBox.R.index+5*w.tr,oe=w.xBox.R.index+L.tr,Pe=[te,ie,j,Q,Y,oe],le=w.xBox.S.index;let he,q={};const Ce=[L.R.index>te,E.rEpr<3,L.rEpr<E.rEpr];q.steps=[[I||E.rEt<E.tr&&E.rEp>=E.sEp,U,!w.breakIndexs[1]||te<w.breakIndexs[1],le>te,le<ie],[...Ce,j>te,le<Y,le<j],[L.R.index-E.R.index>.5*E.tr,F,!w.breakIndexs[1]||j<w.breakIndexs[1],le>j],[X,ee,le>Q,Ce.every(Boolean)||le>oe]],q.step=1,q.result=q.steps[0].every(Boolean),he=E.R1.price,q.result&&(le<=j?(q.step=2,q.result=q.steps[1].every(Boolean),he=L.S1.price):(q.step=3,q.result=q.steps[2].every(Boolean),he=w.R1.price,q.result&&(q.step=4,q.result=q.steps[3].every(Boolean),q.result&&(he=w.xBox.R.price))));const Ie=`${U?I?1:0:2}${se?F?1:0:2}${ee?X?1:0:2}`,ge=E.rEp,$e=c(n.price,ge,A),Ae=w.breakIndexs[1]??le,be=parseInt((Ae-E.R.index)/E.tr),we=be>1?ge*be:ge,Ne=c(n.price,we,A);return{progress:q,timeMark:Pe,info:{rEpr1:E.rEpr,rEpr2:L.rEpr,rEpr3:w.rEpr,entry:he,pStatus:Ie,x:$e,X:ge,y:Ne,Y:we}}}function S({phase:o,start:n,end:_,breakPrices:l,retracementPrice:A}){let E=t.cloneDeep(n),L=t.cloneDeep(_);const w=L.price>E.price;let I={},F={},X={},U=[null,null],se,ee,te;const ie=s.pickTimeToolRef.get();return s.prices.filter(j=>{let Q=j.time>=E.time;return ie&&(Q&=j.time<=ie),Q}).every((j,Q)=>{const Y=j.value,oe=s.timeToIndex(j.time);return oe===-1?!1:((Q===0||Y===E.price)&&(I={R:{index:oe,price:Y},S:{index:oe,price:Y},pr:0,tr:0},F=t.cloneDeep(I),X=t.cloneDeep(I)),t.cmp(Y,w,I.R.price)?(I.pr>0&&(I.pr>=F.pr&&(F.pr=I.pr,F.R=t.cloneDeep(I.R),F.S=t.cloneDeep(I.S)),I.tr>F.tr&&(F.tr=I.tr),o===1&&A&&!t.cmp(I.S.price,!w,A)&&I.tr>=X.tr&&I.pr>=X.pr&&(X=t.cloneDeep(I))),I={R:{index:oe,price:Y},S:{index:oe,price:Y},pr:0,tr:0},o===3&&l&&(!U[0]&&t.cmp(Y,w,l[0])&&(U[0]=oe),!U[1]&&t.cmp(Y,w,l[1])&&(U[1]=oe))):(I.S.index=oe,I.tr=I.S.index-I.R.index,t.cmp(Y,!w,I.S.price)&&(I.S.price=Y,I.pr=t.fmtNum(I.S.price-I.R.price,1,!0))),t.cmp(Y,!w,E.price)?(I.S.price=E.price,!1):!!t.cmp(Y,!w,L.price))}),t.isSet(I)&&(E.index=s.timeToIndex(E.time),L.index=I.S.index,L.time=s.indexToTime(I.S.index),se=t.fmtNum(L.price-F.R.price,1,!0),ee=t.fmtNum(E.price-F.S.price,1,!0),te=L.index-F.S.index,o===3&&(X=I)),{tr:F.tr,pr:F.pr,rEp:se,sEp:ee,rEpr:F.pr?t.fmtNum(se/F.pr):0,rEt:te,S1:F.S,R1:F.R,xBox:X,S:E,R:L,breakIndexs:U}}function i({A:{time:o}}){return o>=s.prices[0].time&&o<s.prices.at(-1).time}function c(o,n,_){const l=o+(_?1:-1)*n;let A=t.fmtNum(l%1);if(_){if(A>=.1&&A<=.2)return Math.floor(l);if(A>=.6&&A<=.7)return Math.floor(l)+.5}else{if(A>=.8&&A<=.9)return Math.ceil(l);if(A>=.3&&A<=.4)return Math.floor(l)+.5}return l}function h(){if(!s.pickTime)return!1;const o=d.B.price-d.A.price>0,n=s.prices.at(-1).value;if(t.cmp(n,!o,d.C.price)){let _=n;for(let l=s.prices.length-1;l>=0;l--){const A=s.prices[l].value;if(A===d.B.price)break;_=o?Math.min(_,A):Math.max(_,A)}d.C.price=_,v()}}function v(o=!1){let n={isRemove:o,name:"pattern",points:[],data:[]};o?d={}:Object.entries(d).forEach(([_,l])=>{n.points.push(_),n.data.push(l)}),f.dispatch("tradingDerivative/drawTools",n)}function b(){v(!0),s.pickTimeToolRef.remove(),k(),y("setProgress",{})}function k(){t.isSet(g.A)&&(s.priceSeries.removePriceLine(g.A),t.isSet(g.B)&&(s.priceSeries.removePriceLine(g.B),t.isSet(g.C)&&(s.priceSeries.removePriceLine(g.C),s.priceSeries.removePriceLine(g.D),s.priceSeries.removePriceLine(g.X),s.priceSeries.removePriceLine(g.Y)))),g={},e([])}function e(o){const n=["#F44336","#F44336","#4CAF50","#FFEB3B","#FFEB3B","#2196F3"];let _=[];for(let l=0;l<o.length;l++){let A=s.indexToTime(o[l]);A&&(o.indexOf(o[l])!==o.lastIndexOf(o[l])&&(A+=l),_.push({time:A,value:1,color:n[l]}))}_.length&&_.sort((l,A)=>l.time-A.time),s.timeMarkSeries.setData(_)}function p({lineOptions:o}){if(t.isSet(g.C)){let n,_;d={A:{time:d.A.time,price:+g.A.options().price},B:{price:+g.B.options().price},C:{price:+g.C.options().price}},v();const{progress:l,timeMark:A,info:{rEpr1:E,rEpr2:L,rEpr3:w,entry:I,pStatus:F,x:X,X:U,y:se,Y:ee}}=a();y("setProgress",l),e(A),n="A",_={title:`A ${E}`},g[n].applyOptions(_),n="B",_={title:`B ${L}`},g[n].applyOptions(_),n="C",_={title:`C ${w}`},g[n].applyOptions(_),n="D",_={price:I,title:"Entry "+F},o.point===n&&delete _.price,g[n].applyOptions(_),n="X",_={price:t.fmtNum(X),title:`X ${t.fmtNum(U)}`},g[n].applyOptions(_),n="Y",_={price:t.fmtNum(se),title:`Y ${t.fmtNum(ee)}`},g[n].applyOptions(_)}}return(o,n)=>(H(),J("div",{ref_key:"patternToolRef",ref:T,class:"command",title:o.$t("trading.derivative.patternTool"),onClick:M,onContextmenu:W},Ut,40,jt))}},Gt=["title"],Kt=B("i",{class:"far fa-pipe"},null,-1),ei=[Kt],ti={__name:"PickTimeTool",props:["pickTimeSeries"],emits:["refreshPattern","hideContext"],setup(R,{expose:$,emit:C}){const f=me(),t=R,s=C,y=N(null),T=ce(()=>f.state.tradingDerivative.tools.pickTime);let P=null;$({isSelected:d,draw:W,remove:V,get:g}),ve(T,x=>{x&&Z(x[0])});function d(){return y.value.classList.contains("selected")}function g(){return P}function u(x){s("hideContext");const m=x.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(a=>a.classList.remove("selected")),m||x.target.classList.add("selected")}function M(x){x.target.classList.remove("selected"),V(),s("refreshPattern")}function W({time:x}){f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"pickTime",points:[0],data:[x]}),Z(x),s("refreshPattern"),y.value.classList.remove("selected")}function Z(x){P=x,t.pickTimeSeries.setData([{time:x,value:1,color:"#9C27B0"}])}function V(x=!0){x&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"pickTime"}),t.pickTimeSeries.setData([]),P=null}return(x,m)=>(H(),J("div",{ref_key:"pickTimeToolRef",ref:y,class:"command",title:x.$t("trading.derivative.pickTimeTool"),onClick:u,onContextmenu:M},ei,40,Gt))}};const ii=B("div",{class:"triangle-shadow"},null,-1),ni=B("div",{class:"triangle"},null,-1),si={class:"input"},ri={class:"color"},oi=["onClick"],ai={__name:"LineContext",props:["enable","title","color"],emits:["update:title","update:color"],setup(R,{emit:$}){const C=R,f=$,t=N(null),s=N(["#F44336","#FF9800","#FFEB3B","#4CAF50","#009688","#00BCD4","#2196F3","#673AB7","#9C27B0","#E91E63"]);ve(()=>C.enable,g=>{g&&mt().then(()=>t.value.instance.focus())});function y({value:g}){f("update:title",g)}function T(g){f("update:color",g)}function P(){f("deleteAllLine")}function d(g){g.stopPropagation()}return(g,u)=>{const M=vt("DxButton");return H(),J("div",{class:"line-context",onClick:d},[ii,ni,B("div",si,[ne(et(Ct),{ref_key:"titleRef",ref:t,value:C.title,"show-clear-button":!0,"input-attr":{style:`color:${C.color}`},onValueChanged:y},null,8,["value","input-attr"]),ne(M,{icon:"trash",type:"danger",onClick:u[0]||(u[0]=W=>P())})]),B("div",ri,[(H(!0),J(Me,null,Ve(s.value,(W,Z)=>(H(),J("div",{class:"color-swatch",style:ht({background:W,boxShadow:`0 0 4px ${W}`}),key:Z,onClick:V=>T(W)},null,12,oi))),128))])])}}},ci=["title"],li=B("i",{class:"far fa-horizontal-rule"},null,-1),pi={__name:"LineTool",props:["priceSeries"],emits:["hideContext"],setup(R,{expose:$,emit:C}){const f=me(),t=R,s=C,y=N(null),T=N(!1),P=ce(()=>f.state.tradingDerivative.tools.line),d=N(""),g=N("#F44336");let u=[];$({isSelected:M,hide:W,draw:x,drag:i}),ve(P,c=>{c&&m(c)});function M(){return y.value.classList.contains("selected")}function W(c){T.value=c}function Z(c){s("hideContext");const h=c.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(v=>v.classList.remove("selected")),h||c.target.classList.add("selected")}function V(c){const h=T.value;s("hideContext"),T.value=!h}function x({price:c}){const h="line",v=u.length;if(u=u.filter(b=>{const k=b.options(),e=k.type=c===+k.price;return e&&(t.priceSeries.removePriceLine(b),f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:h,point:c})),!e}),u.length===v){const b=g.value,k=d.value,e={lineType:h,price:c,color:b,title:k,lineWidth:1,lineStyle:1,draggable:!0};u.push(t.priceSeries.createPriceLine(e)),f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:h,points:[c],data:[{color:b,title:k}]})}y.value.classList.remove("selected")}function m(c){S(!1),a(c)}function a(c){const v={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(c).forEach(([b,{color:k,title:e}])=>{v.price=+b,v.color=k,v.title=e,u.push(t.priceSeries.createPriceLine(v))})}function S(c=!0){u.length>0&&(c&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),u.forEach(h=>t.priceSeries.removePriceLine(h)),u=[])}function i({lineOptions:c,oldPrice:h,newPrice:v}){f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:h});const b=c.color,k=c.title;f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[v],data:[{color:b,title:k}]}),y.value.classList.remove("selected")}return(c,h)=>(H(),J("div",{ref_key:"lineToolRef",ref:y,class:"context command",title:c.$t("trading.derivative.lineTool"),onClick:Z,onContextmenu:V},[li,Te(ne(ai,{class:"contextmenu",enable:T.value,title:d.value,"onUpdate:title":h[0]||(h[0]=v=>d.value=v),color:g.value,"onUpdate:color":h[1]||(h[1]=v=>g.value=v),onDeleteAllLine:S},null,8,["enable","title","color"]),[[_e,T.value]])],40,ci))}},di=["title"],ui=B("i",{class:"far fa-grip-lines-vertical"},null,-1),fi=[ui],mi={__name:"TimeRangeTool",props:["timeRangeSeries","timeToIndex","indexToTime"],emits:["hideContext"],setup(R,{expose:$,emit:C}){const f=me(),t=fe("mf"),s=R,y=C,T=N(null),P=ce(()=>f.state.tradingDerivative.tools.timeRange);let d=[];$({isSelected:g,draw:W}),ve(P,m=>{m&&Z(m)});function g(){return T.value.classList.contains("selected")}function u(m){y("hideContext");const a=m.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(S=>S.classList.remove("selected")),a||m.target.classList.add("selected")}function M(m){x(),m.target.classList.remove("selected")}function W({time:m}){let a={isRemove:!1,name:"timeRange",points:[],data:[]},S={time:m,value:1};switch(d.length){case 0:S.color="OrangeRed",d[0]=S,a.points.push(0),a.data.push(m);break;case 1:S.color="lime",d[1]=S,a.points.push(1),a.data.push(m),T.value.classList.remove("selected");break;default:const i=s.timeToIndex(d[0].time),c=s.timeToIndex(d[1].time),v=s.timeToIndex(m)+(c-i),b=s.indexToTime(v);S.color="OrangeRed",d[0]=t.cloneDeep(S),a.points.push(0),a.data.push(m),S.time=b,S.color="lime",d[1]=S,a.points.push(1),a.data.push(b),T.value.classList.remove("selected");break}s.timeRangeSeries.setData(d),f.dispatch("tradingDerivative/drawTools",a)}function Z(m){x(!1),V(m)}function V(m){let a,S;if(m.length===2)a=m[0],S=m[1];else if(m.length===3){const c=s.timeToIndex(m[0]),h=s.timeToIndex(m[1]),b=s.timeToIndex(m[2])+(h-c);a=m[2],S=s.indexToTime(b)}else return!1;let i=[{time:a,value:1,color:"OrangeRed"},{time:S,value:1,color:"lime"}];d=i,s.timeRangeSeries.setData(i)}function x(m=!0){m&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"timeRange"}),s.timeRangeSeries.setData([]),d=[]}return(m,a)=>(H(),J("div",{ref_key:"timeRangeToolRef",ref:T,class:"command",title:m.$t("trading.derivative.timeRangeTool"),onClick:u,onContextmenu:M},fi,40,di))}},vi=["title"],hi=B("i",{class:"far fa-line-height"},null,-1),gi=[hi],Si={__name:"TargetTool",props:["priceSeries"],emits:["hideContext"],setup(R,{expose:$,emit:C}){const f=me(),t=fe("mf"),s=R,y=C,T=N(null),P=ce(()=>f.state.tradingDerivative.tools.target);let d={};$({isSelected:g,draw:W,drag:m}),ve(P,a=>{a&&Z(a)});function g(){return T.value.classList.contains("selected")}function u(a){y("hideContext");const S=a.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),S||(a.target.classList.add("selected"),x())}function M(a){x(),a.target.classList.remove("selected")}function W({price:a}){const S="target";let i={lineType:S,price:a,lineWidth:1,lineStyle:1,draggable:!0},c={isRemove:!1,name:S,points:[],data:[a]};if(t.isSet(d.A)){const h=+d.A.options().price,v=a-h;i.point="B",i.title=t.fmtNum(v),i.color="#F44336",d[i.point]=s.priceSeries.createPriceLine(i),c.points.push(i.point),i.point="X",i.price=t.fmtNum(h-.5*v),i.title=t.fmtNum(-.5*v),i.color="#2196F3",d[i.point]=s.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(h-v),i.title=t.fmtNum(-v),i.color="#673AB7",d[i.point]=s.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(h-2*v),i.title=t.fmtNum(-2*v),i.color="#9C27B0",d[i.point]=s.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(h-4*v),i.title=t.fmtNum(-4*v),i.color="#E91E63",d[i.point]=s.priceSeries.createPriceLine(i),T.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",d[i.point]=s.priceSeries.createPriceLine(i),c.points.push(i.point);f.dispatch("tradingDerivative/drawTools",c)}function Z(a){x(!1),V(a)}function V(a){let i={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const c=a.A,h=a.B,v=h-c;i.point="A",i.price=c,i.title="0",i.color="#FF9800",d[i.point]=s.priceSeries.createPriceLine(i),i.point="B",i.price=h,i.title=t.fmtNum(v),i.color="#F44336",d[i.point]=s.priceSeries.createPriceLine(i),i.point="X",i.price=t.fmtNum(c-.5*v),i.title=t.fmtNum(-.5*v),i.color="#2196F3",d[i.point]=s.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(c-v),i.title=t.fmtNum(-v),i.color="#673AB7",d[i.point]=s.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(c-2*v),i.title=t.fmtNum(-2*v),i.color="#9C27B0",d[i.point]=s.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(c-4*v),i.title=t.fmtNum(-4*v),i.color="#E91E63",d[i.point]=s.priceSeries.createPriceLine(i)}function x(a=!0){a&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),t.isSet(d.A)&&(s.priceSeries.removePriceLine(d.A),t.isSet(d.B)&&(s.priceSeries.removePriceLine(d.B),s.priceSeries.removePriceLine(d.X),s.priceSeries.removePriceLine(d.Y),s.priceSeries.removePriceLine(d.Z),s.priceSeries.removePriceLine(d.W))),d={}}function m({lineOptions:a,newPrice:S}){if(t.isSet(d.B)){let i={isRemove:!1,name:"target",points:[],data:[]},c,h,v=+d.A.options().price,b=+d.B.options().price,k=b-v;if(c="A",a.point==="A")k=+d.B.options().title,b=v+k;else if(a.point!=="B"){let e=0;switch(a.point){case"X":e=1.5;break;case"Y":e=2;break;case"Z":e=3;break;case"W":e=5;break}k=t.fmtNum((b-S)/e),v=b-k,h={price:v},d[c].applyOptions(h)}i.points.push(c),i.data.push(v),c="B",h={price:b,title:t.fmtNum(k)},a.point===c&&delete h.price,d[c].applyOptions(h),i.points.push(c),i.data.push(b),c="X",h={price:t.fmtNum(v-.5*k),title:t.fmtNum(-.5*k)},a.point===c&&delete h.price,d[c].applyOptions(h),c="Y",h={price:t.fmtNum(v-k),title:t.fmtNum(-k)},a.point===c&&delete h.price,d[c].applyOptions(h),c="Z",h={price:t.fmtNum(v-2*k),title:t.fmtNum(-2*k)},a.point===c&&delete h.price,d[c].applyOptions(h),c="W",h={price:t.fmtNum(v-4*k),title:t.fmtNum(-4*k)},a.point===c&&delete h.price,d[c].applyOptions(h),f.dispatch("tradingDerivative/drawTools",i)}}return(a,S)=>(H(),J("div",{ref_key:"targetToolRef",ref:T,class:"command",title:a.$t("trading.derivative.targetTool"),onClick:u,onContextmenu:M},gi,40,vi))}},yi=["title"],Ue=3,Qe=2,Ti={__name:"OrderTool",props:["position","prices","priceSeries","inSession","TIME"],emits:["getTools","showEntry","showTpSl","orderChanged","hideContext"],setup(R,{expose:$,emit:C}){const f=me(),{t}=Oe(),s=fe("mf"),y=R,T=C,P=N(null),d=N(!1),g=ce(()=>f.state.tradingDerivative.tools.order);let u={side:0,entry:{},tp:{},sl:{}},M=!1;$({show:Z,entry:V,tpsl:x,cancel:m,cancelWithoutClose:a,scan:S,drag:b}),ve(g,e=>{e&&c(e)});function W(){return s.isSet(u.entry.line)||s.isSet(u.tp.line)}function Z({price:e}){if(e&&y.inSession()){const p=G(ke(new Date,7));if(s.isSet(u.entry.line))!s.isSet(u.tp.line)&&y.position&&p>y.TIME.ATO&&p<y.TIME.ATC&&T("showTpSl",{side:y.position});else{let o=null,n=0;y.position?(p<y.TIME.ATO?o="ATO":p>y.TIME.ATC&&(o="ATC"),o&&(u.entry.price=o,n=-y.position)):p>y.TIME.ATO&&p<y.TIME.ATC&&(o=e,n=o>=y.prices.at(-1).value?1:-1,u.side=n,u.entry.price=o),n&&T("showEntry",{side:n,price:o})}}}function V(){if(y.inSession()){const e=G(ke(new Date,7));e<y.TIME.ATO?qe(t("trading.derivative.atoOrder"),t("titles.confirm")).then(o=>{o&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(n=>{n.isOk?re.success(t("trading.derivative.atoOrderSuccess")):k(n.message)})}):e>y.TIME.ATC?qe(t("trading.derivative.atcOrder"),t("titles.confirm")).then(o=>{o&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(n=>{n.isOk?re.success(t("trading.derivative.atcOrderSuccess")):k(n.message)})}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:u.side,price:u.entry.price}}).then(p=>{p.isOk?(i(["entry"]),re.success(t("trading.derivative.newEntrySuccess"))):k(p.message)})}}function x(){u.tp.price=u.entry.price+u.side*Ue,u.sl.price=u.entry.price-u.side*Qe,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:u.tp.price},slData:{cmd:"new",price:u.sl.price}}).then(e=>{e.isOk?(u.entry.line.applyOptions({draggable:!1}),i(["entry","tp","sl"]),re.success(t("trading.derivative.newTpSlSuccess"))):k(e.message)})}function m(){s.isSet(u.entry.line)?s.isSet(u.tp.line)?f.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(e=>{e.isOk?(v(["entry","tp","sl"]),re.success(t("trading.derivative.exitSuccess"))):k(e.message)}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(e=>{e.isOk?(v(["entry"]),re.success(t("trading.derivative.deleteEntrySuccess"))):k(e.message)}):T("getTools")}function a(){if(y.inSession()&&y.position){const e=G(ke(new Date,7));e>y.TIME.ATC-5*60&&(d.value=!0,e>y.TIME.ATC-15&&s.isSet(u.tp.line)&&f.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(p=>{p.isOk?(v(["entry","tp","sl"]),re.success(t("trading.derivative.autoCancelTpSlSuccess"))):k(p.message)}))}}function S(e){if(s.isSet(u.entry.line)){const p=u.side>0;s.isSet(u.tp.line)?(s.cmp(e,p,u.tp.price,!0)&&(M||(M=!0,f.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(o=>{o.isOk?(v(["entry","tp","sl"]),re.success(t("trading.derivative.deleteTpSuccess"))):k(o.message),M=!1}))),s.cmp(e,!p,u.sl.price,!0)&&(M||(M=!0,f.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(o=>{o.isOk?(v(["entry","tp","sl"]),re.success(t("trading.derivative.deleteSlSuccess"))):k(o.message),M=!1})))):s.cmp(e,p,u.entry.price,!0)&&(M||(M=!0,setTimeout(()=>{u.tp.price=u.entry.price+u.side*Ue,u.sl.price=u.entry.price-u.side*Qe,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:u.tp.price},slData:{cmd:"new",price:u.sl.price}}).then(o=>{o.isOk?(u.entry.line.applyOptions({draggable:!1}),i(["entry","tp","sl"]),re.success(t("trading.derivative.autoNewTpSlSuccess"))):k(o.message),M=!1})},1e3)))}}function i(e){const p="order";let o={isRemove:!1,name:p,points:[],data:[]},n,_;e.forEach(l=>{const A=u.entry.price,E=u.tp.price,L=u.sl.price;switch(l){case"entry":n="yellow",_=u.side>0?"LONG":"SHORT";break;case"tp":n="lime",_=s.fmtNum(E-A,1,!0);break;case"sl":n="red",_=s.fmtNum(L-A,1,!0);break}if(o.points.push(l),s.isSet(u[l].line))u[l].line.applyOptions({price:u[l].price,title:_}),o.data.push(u[l].line.options());else{const w={lineType:p,kind:l,side:u.side,price:u[l].price,color:n,lineWidth:1,lineStyle:0,title:_,draggable:!0};u[l].line=y.priceSeries.createPriceLine(w),o.data.push(w)}}),f.dispatch("tradingDerivative/drawTools",o),T("orderChanged",W())}function c(e){v(["entry","tp","sl"],!1),h(e),T("orderChanged",W())}function h(e){Object.entries(e).forEach(([p,o])=>{p==="entry"&&(u.side=o.side),u[p].price=o.price,u[p].line=y.priceSeries.createPriceLine(o)})}function v(e,p=!0){p&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),e.forEach(o=>{s.isSet(u[o].line)&&(y.priceSeries.removePriceLine(u[o].line),delete u[o].line)}),T("orderChanged",W())}function b({line:e,lineOptions:p,oldPrice:o,newPrice:n}){if(n!==o){let _=!1;p.kind==="entry"?y.position||(_=!0,u[p.kind].price=n,f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:u.entry.price}}).then(l=>{l.isOk?(i([p.kind]),re.success(t("trading.derivative.changeEntrySuccess"))):(e.applyOptions({price:o}),k(l.message))})):(_=!0,u[p.kind].price=n,p.kind==="tp"?f.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:u.tp.price}}).then(l=>{l.isOk?(i([p.kind]),re.success(t("trading.derivative.changeTpSuccess"))):(e.applyOptions({price:o}),k(l.message))}):f.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:u.sl.price}}).then(l=>{l.isOk?(i([p.kind]),re.success(t("trading.derivative.changeSlSuccess"))):(e.applyOptions({price:o}),k(l.message))})),_||(e.applyOptions({price:o}),re.show(t("trading.derivative.noChangeOrderLine")))}}function k(e){e||(e="unknown"),re.error(t(`trading.derivative.${e}`))}return(e,p)=>(H(),J("div",{ref_key:"orderToolRef",ref:P,class:"cancel-order command",title:e.$t("trading.derivative.orderTool"),onClick:m},[B("i",{class:ae(["far fa-trash-alt",{blink:d.value}])},null,2)],8,yi))}};const xi=["title"],Ci=["title"],ki=["title"],_i=["title"],bi="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",wi="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",Oi={__name:"Chart",setup(R,{expose:$}){const C=me(),f=Tt(),{t}=Oe(),s=fe("devices"),y=fe("mf"),T=fe("filters"),P=N(null),d=N(null),g=N(null),u=N(null),M=N(null),W=N(null),Z=N(null),V=N(null),x=N(null),m=N(null),a=N(null),S=N(null),i=N(null),c=N(null),h=N(null),v={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},b=Le(new Date,"yyyy-MM-dd"),k={START:G(new Date(`${b}T08:45:00Z`)),ATO:G(new Date(`${b}T09:00:00Z`)),ATC:G(new Date(`${b}T14:30:00Z`)),END:G(new Date(`${b}T14:45:00Z`))};let e={chart:{},whitespaces:[],crosshair:{},interval1:null,interval30:null,websocket:null,socketStop:!1,vpsUpdatedAt:bt(new Date,61)};const p=gt({prices:[],series:{},chartDate:f.query.date??b,clock:Le(new Date,"HH:mm:ss"),isSocketWarning:!1,hasOrderLine:!1,TIME:k}),o=ce(()=>C.state.tradingDerivative.status),n=ce(()=>C.state.tradingDerivative.config),_=ce(()=>C.state.tradingDerivative.isLoading),l=ce(()=>o.value.position||o.value.pending||p.hasOrderLine);e.interval1=setInterval(()=>{i.value&&i.value.cancelWithoutClose(),p.clock=Le(new Date,"HH:mm:ss")},1e3),e.interval30=setInterval(()=>{De()?(He(),n.value.autoRefresh&&V.value.refresh(!0)):clearInterval(e.interval30)},3e4),rt(),We(()=>{A(),new ResizeObserver(se).observe(P.value),document.addEventListener("keydown",ee)}),Ge(()=>{E(),document.removeEventListener("keydown",ee),clearInterval(e.interval1),clearInterval(e.interval30),oe(),e.socketStop=!0}),ve(()=>C.state.tradingDerivative.chartData,te),$({connectSocket:Y});function A(){e.chart=kt(d.value,v),e.chart.subscribeCrosshairMove(X),e.chart.subscribeCustomPriceLineDragged(U),p.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),p.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}})}function E(){e.chart&&(e.chart.remove(),e.chart=null)}function L(r){ue(),ge(!1),S.value.isSelected()?S.value.draw({time:e.crosshair.time}):V.value.isSelected()?V.value.draw({time:e.crosshair.time,price:Ee(e.crosshair.y)}):x.value.isSelected()?x.value.draw({time:e.crosshair.time}):Z.value.isSelected()?Z.value.draw({price:Ee(e.crosshair.y)}):a.value.isSelected()?a.value.draw({time:e.crosshair.time}):m.value.isSelected()&&m.value.draw({price:Ee(e.crosshair.y)})}function w(r){ge(!0),r.preventDefault()}function I(r){r.stopPropagation()}function F(r){r.preventDefault(),r.stopPropagation()}function X(r){if(r.time){let O=r.seriesPrices.get(p.series.price);e.crosshair.time=r.time,e.crosshair.price=O}else s.phone||(e.crosshair.time=null,e.crosshair.price=null);r.point!==void 0&&(e.crosshair.x=r.point.x,e.crosshair.y=r.point.y)}function U(r){let O=r.customPriceLine,D=O.options();D.price=y.fmtNum(D.price);const z=+r.fromPriceString,K=D.price;switch(D.lineType){case"order":i.value.drag({line:O,lineOptions:D,oldPrice:z,newPrice:K});break;case"line":Z.value.drag({lineOptions:D,oldPrice:z,newPrice:K});break;case"target":m.value.drag({lineOptions:D,newPrice:K});break;case"pattern":V.value.drag({lineOptions:D});break}}function se(){P.value&&(e.chart.resize(P.value.offsetWidth,P.value.offsetHeight),P.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function ee(r){if(r.ctrlKey)switch(r.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(r.altKey)switch(r.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function te(r){p.chartDate===b&&De()||(r.price.length>0&&(e.whitespaces=Q(e.whitespaces,j(p.chartDate))),p.series.whitespace.setData(e.whitespaces),p.prices=Q(p.prices,r.price),p.series.price.setData(p.prices))}function ie(r,O=null){const D=O??n.value.source;let z=[];r.forEach(K=>{let pe,de;D==="FireAnt"?(pe=G(ke(new Date(K.date),7)),de=K.price):(pe=G(new Date(`${b}T${K.time}Z`)),de=K.lastPrice),z.push({time:pe,value:de})}),z.length>1?(p.prices=Q(p.prices,z),p.series.price.setData(p.prices)):(p.prices.push(z[0]),p.series.price.update(z[0]))}function j(r){const O=G(new Date(`${r}T09:00:00Z`)),D=G(new Date(`${r}T11:30:00Z`)),z=G(new Date(`${r}T13:00:00Z`)),K=G(new Date(`${r}T14:30:00Z`)),pe=G(new Date(`${r}T14:00:00Z`));let de=[];for(let Se=O;Se<=K;Se++){if(Se>D&&Se<z)continue;let Xe={time:Se};(Se===pe||Se===K)&&(Xe.value=1),de.push(Xe)}return de}function Q(r,O){return Array.from(new Map([...r,...O].sort((D,z)=>D.time-z.time).map(D=>[D.time,D])).values())}async function Y(){if(De()){await oe();const r=n.value.source==="FireAnt",O=r?bi:wi;e.websocket=new WebSocket(O),e.websocket.onclose=D=>{e.socketStop||(p.isSocketWarning=!0,Y())},r?Pe():(q(),he())}}async function oe(){e.websocket&&e.websocket.readyState===WebSocket.OPEN&&(e.websocket.close(),await new Promise(r=>{const O=setInterval(()=>{(!e.websocket||e.websocket.readyState===WebSocket.CLOSED)&&(e.websocket=null,clearInterval(O),r())},100)}))}function Pe(){C.dispatch("tradingDerivative/setLoading",!0),e.websocket.onopen=r=>{if(e.websocket.readyState===WebSocket.OPEN){let O='{"protocol":"json","version":1}';e.websocket.send(O),O='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(O)}},e.websocket.onmessage=r=>{p.isSocketWarning=!1,le(r.data).forEach(D=>{if(!D)return!1;D.type===3?(D.result[0].date.slice(0,10)===b&&(Re(),e.whitespaces=Q(e.whitespaces,j(b)),p.series.whitespace.setData(e.whitespaces),ie(D.result)),C.dispatch("tradingDerivative/setLoading",!1)):D.type===1&&D.target==="UpdateTrades"&&D.arguments[0]==="VN30F1M"&&(console.log("FireAnt",D.arguments[1]),i.value.scan(D.arguments[1].at(-1).price),ie(D.arguments[1]))})}}function le(r){let O=[];return r.split("").forEach(D=>{const z=D.indexOf("{"),K=D.lastIndexOf("}");let pe=null;if(z!==-1&&K!==-1&&K>z){const de=D.substring(z,K+1);de!=="{}"&&(pe=JSON.parse(de))}O.push(pe)}),O}function he(){e.websocket.onopen=r=>{if(e.websocket.readyState===WebSocket.OPEN){const O={action:"join",list:n.value.vn30f1m},D=`42${JSON.stringify(["regs",JSON.stringify(O)])}`;e.websocket.send(D)}},e.websocket.onmessage=r=>{if(p.isSocketWarning=!1,r.data.substr(0,1)==="4"&&r.data.substr(1,1)==="2"){const O=JSON.parse(r.data.substr(2));if(O[0]==="stockps"){const D=O[1].data;D.id===3220&&(console.log("VPS",D),i.value.scan(D.lastPrice),ie([D]))}}}}function q(){St(new Date,new Date(e.vpsUpdatedAt))>60&&(fetch("https://bddatafeed.vps.com.vn/getpschartintraday/VN30F1M").then(r=>r.json()).then(r=>{console.log(r),ie(r,"VPS")}),e.vpsUpdatedAt=new Date)}function Ce(){V.value.refresh()}function Ye(r){V.value.load(r,{isSave:!0})}function ue(){W.value.hide(),S.value.hide(),Z.value.hide()}function ze(r){W.value.set(r)}function Ie(r){p.hasOrderLine=r}function ge(r){r?i.value.show({price:Ee(e.crosshair.y)}):(c.value.style.display="none",h.value.style.display="none")}function $e({side:r,price:O}){c.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",c.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",c.value.style.background=r>0?"green":"red",c.value.innerText=`${r>0?"LONG":"SHORT"} ${O}`,c.value.style.display="block"}function Ae({side:r}){h.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",h.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",h.value.style.background=r>0?"green":"red",h.value.style.display="block"}function be(){i.value.entry()}function we(){i.value.tpsl()}function Ne(){e.chart.timeScale().scrollToRealTime()}function De(){const r=G(ke(new Date,7));return n.value.openingMarket&&r>=k.START&&r<=k.END}function nt(){if(!p.chartDate)return!1;Be()}function st(){e.whitespaces=[],p.prices=[],Y(),Be()}function rt(){C.dispatch("tradingDerivative/initChart").then(()=>{Y(),!f.query.date&&n.value.lastOpeningDate&&(p.chartDate=n.value.lastOpeningDate),Be()})}function Be(){C.dispatch("tradingDerivative/getChartData",p.chartDate).then(r=>{r&&Re()})}function He(){C.dispatch("tradingDerivative/getStatus")}function Re(){C.dispatch("tradingDerivative/getTools")}function ot(){C.dispatch("tradingDerivative/getAccountInfo").then(r=>{let O="";O+='<div style="width: 200px;">',O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.nav")}</div><div>: ${T.currency(r.nav)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.maxVol")}</div><div>: ${T.numberVnFormat(r.maxVol)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.vm")}</div><div>: ${T.currency(r.vm)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.fee")}</div><div>: ${T.currency(r.fee)}</div></div>`,O+="</div>",xt(O,t("trading.derivative.accountInfo"))})}function Ee(r){return y.fmtNum(p.series.price.coordinateToPrice(r))}function Fe(r){let O=e.whitespaces.findIndex(D=>D.time===r);if(O===-1){const D=Le(new Date(r*1e3),"yyyy-MM-dd"),z=G(new Date(`${D}T11:30:00Z`)),K=G(new Date(`${D}T13:00:00Z`)),pe=G(new Date(`${D}T14:30:00Z`));r>z&&r<K?r=z:r>pe&&(r=pe),O=e.whitespaces.findIndex(de=>de.time===r)}return O}function Je(r){return r<e.whitespaces.length?e.whitespaces[r].time:!1}return(r,O)=>(H(),J("div",{class:"derivative-chart",ref_key:"chartContainerRef",ref:P,onClick:L,onContextmenu:w},[B("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:d},[B("div",{class:"area data-area",onClick:I,onContextmenu:F},[B("div",{ref_key:"connectionRef",ref:g,class:ae(["command",{yellow:o.value.pending,red:n.value.volInValid}]),title:r.$t("trading.derivative.connection"),onClick:He},[B("i",{class:ae(["far",{"fa-link-simple":o.value.connection,"fa-link-simple-slash":!o.value.connection,blink:p.isSocketWarning}])},null,2)],10,xi),B("div",{class:ae(["command status",{green:o.value.position>0,red:o.value.position<0}]),title:r.$t("trading.derivative.position"),onClick:ot},ye(o.value.position),11,Ci),B("div",{class:"command clock",onClick:Y},ye(p.clock),1),Te(B("input",{type:"date",class:"chart-date command",title:r.$t("trading.derivative.date"),"onUpdate:modelValue":O[0]||(O[0]=D=>p.chartDate=D),onChange:nt},null,40,ki),[[yt,p.chartDate]]),B("div",{ref_key:"reloadToolRef",ref:u,class:"command",title:r.$t("trading.derivative.reload"),onClick:st,onContextmenu:Re},[B("i",{class:ae(["far fa-sync-alt",{"fa-spin":_.value}])},null,2)],40,_i)],32),B("div",{class:"area tool-area",onClick:I,onContextmenu:F},[ne(Dt,{chartContainerRef:P.value},null,8,["chartContainerRef"]),ne(Lt,{ref_key:"tradingviewRef",ref:M,vpsUser:n.value.vpsUser,vpsSession:n.value.vpsSession,chartContainerRef:P.value},null,8,["vpsUser","vpsSession","chartContainerRef"]),ne(Nt,{ref_key:"progressToolRef",ref:W,position:o.value.position,onRefreshPattern:Ce,onHideContext:ue},null,8,["position"]),ne(Xt,{ref_key:"scanToolRef",ref:S,prices:p.prices,timeToIndex:Fe,onScaned:Ye,onRemovePattern:O[1]||(O[1]=()=>V.value.remove()),onHideContext:ue},null,8,["prices"]),ne(Qt,{ref_key:"patternToolRef",ref:V,prices:p.prices,priceSeries:p.series.price,timeMarkSeries:p.series.timeMark,pickTimeToolRef:x.value,timeToIndex:Fe,indexToTime:Je,onSetProgress:ze,onHideContext:ue},null,8,["prices","priceSeries","timeMarkSeries","pickTimeToolRef"]),ne(ti,{ref_key:"pickTimeToolRef",ref:x,pickTimeSeries:p.series.pickTime,onRefreshPattern:Ce,onHideContext:ue},null,8,["pickTimeSeries"]),ne(pi,{ref_key:"lineToolRef",ref:Z,priceSeries:p.series.price,onHideContext:ue},null,8,["priceSeries"]),ne(mi,{ref_key:"timeRangeToolRef",ref:a,timeRangeSeries:p.series.timeRange,timeToIndex:Fe,indexToTime:Je,onHideContext:ue},null,8,["timeRangeSeries"]),ne(Si,{ref_key:"targetToolRef",ref:m,priceSeries:p.series.price,onHideContext:ue},null,8,["priceSeries"]),Te(ne(Ti,{ref_key:"orderToolRef",ref:i,position:o.value.position,prices:p.prices,priceSeries:p.series.price,inSession:De,TIME:p.TIME,onGetTools:Re,onShowEntry:$e,onShowTpSl:Ae,onOrderChanged:Ie,onHideContext:ue},null,8,["position","prices","priceSeries","TIME"]),[[_e,l.value]])],32),B("div",null,[B("div",{ref_key:"entryOrderRef",ref:c,class:"order-button entry",onClick:be}," Entry ",512),B("div",{ref_key:"tpslOrderRef",ref:h,class:"order-button tpsl",onClick:we}," TP/SL ",512),B("div",{class:"chart-top command far fa-angle-double-right",onClick:Ne})])],512)],544))}};export{Oi as default};
