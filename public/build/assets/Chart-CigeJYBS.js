import{h as ie,c as B,r as T,w as H,o as se,b as ue,d as E,u as we,S as Le,U as Me,$ as ge,V as de,W as be,X as We,Y as $e,Z as Ve,K as ze,M as ve,a as Pe,y as Ze,H as He,e as W,g as je,I as Je,J as Ye,E as Se,j as Ue,k as ye,x as Qe,l as Ce}from"./app-DSobDHcy.js";import{c as Ge,g as xe,a as Ke,b as Xe,d as qe,e as et}from"./lightweight-charts.esm.development-CjH9i6qM.js";const tt=["title"],nt=E("i",{class:"far fa-grip-lines-vertical"},null,-1),ot=[nt],lt={__name:"FilterTimeTool",props:[],emits:["hideContext"],setup(u,{expose:b,emit:r}){const s=ie(),x=r,D=B(()=>s.state.tradingShare.config.filterTime),S=T(null);let f={},m=[];const I=["rgba(244, 67, 54, 0.7)","rgba(255, 152, 0, 0.7)","rgba(76, 175, 80, 0.7)","rgba(0, 150, 136, 0.7)"];b({createSeries:_,isSelected:w,draw:y,get:g}),H(D,l=>{l&&setTimeout(()=>R(l),3e3)});function w(){return S.value.classList.contains("selected")}function g(){return m.map(h=>h.time).reverse()}function _(l){if(!l)return!1;f=l.addHistogramSeries({priceScaleId:"filterTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function p(l){x("hideContext");const h=l.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(F=>F.classList.remove("selected")),h||(m.pop(),f.setData(m),l.target.classList.add("selected"))}function c(l){A(),l.target.classList.remove("selected")}function y({time:l}){const h=m.length;if(h&&l<=m[h-1].time)return!1;m.push({time:l,color:I[h],value:1}),f.setData(m),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:"",name:"filterTime",points:[h],data:[l]}),h===3&&S.value.classList.remove("selected")}function R(l){for(let h=0;h<l.length;h++)m.push({time:l[h],color:I[h],value:1});f.setData(m)}function A(l=!0){l&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:"",name:"filterTime"}),f.setData([]),m=[]}return(l,h)=>(se(),ue("div",{ref_key:"filterTimeToolRef",ref:S,class:"command",title:l.$t("trading.share.tools.filterTime"),onClick:p,onContextmenu:c},ot,40,tt))}},at=["title"],it=E("i",{class:"far fa-circle-check"},null,-1),st=[it],ut={__name:"CheckTool",props:["symbol"],emits:["checkSymbol","hideContext"],setup(u,{expose:b,emit:r}){const s=ie(),{t:x}=we(),D=u,S=r;let f=null;H(()=>D.symbol,()=>f=null),b({check:m});function m(p){s.dispatch("tradingShare/checkSymbol",p).then(c=>{f=c,g(c)})}function I(){S("checkSymbol"),S("hideContext")}function w(){f&&g(f)}function g(p){let c=JSON.stringify(p.result,void 0,4);Le(`<pre class='check-tool-popup'>${_(c)}</pre>`,`${x("trading.share.tools.check")} ${p.symbol}`)}function _(p){return p=p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),p.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(c){var y="number";return/^"/.test(c)?/:$/.test(c)?y="key":y="string":/true|false/.test(c)?y="boolean":/null/.test(c)&&(y="null"),'<span class="'+y+'">'+c+"</span>"})}return(p,c)=>(se(),ue("div",{class:"command",title:p.$t("trading.share.tools.check"),onClick:I,onContextmenu:w},st,40,at))}},rt=["title"],ct=E("i",{class:"far fa-arrow-trend-down"},null,-1),dt=[ct],ae="reversal",_e="rgba(156, 39, 176, 0.7)",pt={__name:"ReversalTool",props:["symbol","priceSeries"],emits:["indexUpdated","hideContext"],setup(u,{expose:b,emit:r}){const s=ie(),x=u,D=r,S=T(null),f=B(()=>s.state.tradingShare.tools.reversal),m=B(()=>s.state.tradingShare.config.index),I=B(()=>s.state.tradingShare.config.whitespace);let w={},g=[],_=null,p={lineType:ae,color:_e,title:"R",lineWidth:1,lineStyle:1,draggable:!0},c=null;b({createSeries:R,isSelected:y,draw:h,remove:n}),H(f,d=>{d&&L(d[0])});function y(){return S.value.classList.contains("selected")}function R(d){if(!d)return!1;w=d.addHistogramSeries({priceScaleId:ae,color:_e,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function A(d){D("hideContext");const M=d.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach($=>$.classList.remove("selected")),M||(t(),x.symbol===m.value&&D("indexUpdated"),d.target.classList.add("selected"))}function l(d){t(),x.symbol===m.value&&D("indexUpdated"),d.target.classList.remove("selected")}function h({prices:d,time:M}){g.push({time:M,value:1}),g.length===2?(_=F(d,g[0].time,g[1].time),q(_),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:x.symbol,name:ae,points:[0],data:[_]}),x.symbol===m.value&&D("indexUpdated",_),g=[],S.value.classList.remove("selected")):w.setData(g)}function F(d,M,$){let O,j,V,J;const Y=d.filter(k=>k.time>=M&&k.time<=$);for(let k=0;k<Y.length;k++){const G=Y[k].time,K=Y[k].high,X=Y[k].low,U={i:k,p:K},oe={i:k,p:X};if(k===0)O={H:U,L:U},V=0,J=0,j=G;else if(K>O.H.p?O.H=U:O.H.i=k,X<O.L.p){j=G;const le=O.H.p-O.L.p,N=O.H.i-O.L.i;le>V&&(V=le),N>J&&(J=N),O={H:oe,L:oe}}}const ee=[...d,...I.value],te=ee.findIndex(k=>k.time===j),re=ee[te+J].time,ne=O.L.p+V;return{time:re,price:ne}}function L(d){t(!1),q(d)}function q(d){w.setData([{time:d.time,value:1}]),p.price=d.price,c=x.priceSeries.createPriceLine(p)}function n(){t(!1)}function t(d=!0){d&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:x.symbol,name:ae}),_={},w.setData([]),c&&(x.priceSeries.removePriceLine(c),c=null)}return(d,M)=>(se(),ue("div",{ref_key:"reversalToolRef",ref:S,class:"command",title:d.$t("trading.share.tools.reversal"),onClick:A,onContextmenu:l},dt,40,rt))}};var a={},mt="dx-autocomplete",ft="dx-autocomplete-popup-wrapper",De=Me.inherit({_supportedKeys:function(){var u=this._list?this._list.option("focusedElement"):null,b=this.callBase();return u=u&&ge(u),de({},b,{upArrow:function(r){return!be(r)&&(r.preventDefault(),r.stopPropagation(),u&&!this._calcNextItem(-1))?(this._clearFocusedItem(),!1):!0},downArrow:function(r){return!be(r)&&(r.preventDefault(),r.stopPropagation(),u&&!this._calcNextItem(1))?(this._clearFocusedItem(),!1):!0},enter:function(r){u||this.close();var s=this.option("opened");return s&&r.preventDefault(),s}})},_getDefaultOptions:function(){return de(this.callBase(),{minSearchLength:1,maxItemCount:10,noDataText:"",showDropDownButton:!1,searchEnabled:!0})},_initMarkup:function(){this.callBase(),this.$element().addClass(mt),this.setAria("autocomplete","inline")},_displayGetterExpr:function(){return this.option("valueExpr")},_closeOutsideDropDownHandler:function(u){var{target:b}=u;return!ge(b).closest(this.$element()).length},_renderDimensions:function(){this.callBase(),this._updatePopupWidth(),this._updateListDimensions()},_popupWrapperClass:function(){return this.callBase()+" "+ft},_listConfig:function(){return de(this.callBase(),{pageLoadMode:"none",onSelectionChanged:u=>{this._setSelectedItem(u.addedItems[0])}})},_listItemClickHandler:function(u){this._saveValueChangeEvent(u.event);var b=this._displayGetter(u.itemData);this.option("value",b),this.close()},_setListDataSource:function(){this._list&&(this._list.option("selectedItems",[]),this.callBase())},_refreshSelected:We,_searchCanceled:function(){this.callBase(),this.close()},_loadItem:function(u,b){var r=this._getItemFromPlain(u,b);return new $e().resolve(r).promise()},_dataSourceOptions:function(){return{paginate:!0,pageSize:this.option("maxItemCount")}},_searchDataSource:function(u){this._dataSource.pageSize(this.option("maxItemCount")),this.callBase(u),this._clearFocusedItem()},_clearFocusedItem:function(){this._list&&(this._list.option("focusedElement",null),this._list.option("selectedIndex",-1))},_renderValueEventName:function(){return"input keyup"},_valueChangeEventHandler:function(u){var b=this._input().val()||null;return this.callBase(u,b)},_optionChanged:function(u){switch(u.name){case"maxItemCount":this._searchDataSource();break;case"valueExpr":this._compileDisplayGetter(),this._setListOption("displayExpr",this._displayGetterExpr()),this.callBase(u);break;default:this.callBase(u)}},reset:function(){this.callBase(),this.close()}});Ve("dxAutocomplete",De);const ht=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"})),gt=ze(ht);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var ke;function bt(){if(ke)return a;ke=1;var u=a&&a.__importDefault||function(L){return L&&L.__esModule?L:{default:L}};Object.defineProperty(a,"__esModule",{value:!0}),a.DxToolbarItem=a.DxTo=a.DxShow=a.DxPosition=a.DxOptions=a.DxOffset=a.DxMy=a.DxItem=a.DxHide=a.DxFrom=a.DxDropDownOptions=a.DxCollision=a.DxButton=a.DxBoundaryOffset=a.DxAt=a.DxAnimation=a.DxAutocomplete=void 0;var b=u(gt),r=ve(),s=ve(),x=r.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttons:Array,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxItemCount:Number,maxLength:[Number,String],minSearchLength:Number,name:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDropDownButton:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:String,valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxItemCount":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDropDownButton":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=b.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});a.DxAutocomplete=x;var D=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});a.DxAnimation=D,D.$_optionName="animation",D.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var S=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});a.DxAt=S,S.$_optionName="at";var f=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});a.DxBoundaryOffset=f,f.$_optionName="boundaryOffset";var m=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});a.DxButton=m,m.$_optionName="buttons",m.$_isCollectionItem=!0,m.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var I=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});a.DxCollision=I,I.$_optionName="collision";var w=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});a.DxDropDownOptions=w,w.$_optionName="dropDownOptions",w.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var g=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});a.DxFrom=g,g.$_optionName="from",g.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var _=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});a.DxHide=_,_.$_optionName="hide",_.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var p=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});a.DxItem=p,p.$_optionName="items",p.$_isCollectionItem=!0;var c=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});a.DxMy=c,c.$_optionName="my";var y=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});a.DxOffset=y,y.$_optionName="offset";var R=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});a.DxOptions=R,R.$_optionName="options";var A=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});a.DxPosition=A,A.$_optionName="position";var l=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});a.DxShow=l,l.$_optionName="show";var h=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});a.DxTo=h,h.$_optionName="to";var F=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});return a.DxToolbarItem=F,F.$_optionName="toolbarItems",F.$_isCollectionItem=!0,a.default=x,a}var vt=bt();const St={class:"command symbol-input"},yt=["title"],Ct=["title"],kt={__name:"Chart",props:["fromDate","group"],setup(u,{expose:b}){const r=ie(),s=Ue(),{t:x}=we(),D=ye("devices"),S=ye("mf"),f=T(null),m=T(null),I=T(null),w=T(null),g=T(null),_=T(null),p=T(null),c=T(null),y=T(null),R=u,A=B(()=>r.state.tradingShare.isLoading),l=B(()=>r.state.tradingShare.config),h=B(()=>n.symbol),F=B(()=>l.value.watchlist.includes(n.symbol)),L=B(()=>r.state.tradingShare.symbols),q=B(()=>R.fromDate),n=Pe({symbol:s.query.symbol??"VN30",inputSymbol:s.query.symbol??"VN30",series:{}});let t={chart:{},series:{},data:{index:[],stock:[]},crosshair:{},websocket:null};Ze(()=>{d(),oe(),g.value.createSeries(t.chart),p.value.createSeries(t.chart),new ResizeObserver(ee).observe(f.value),document.addEventListener("keydown",te)}),He(()=>{M(),fe(),document.removeEventListener("keydown",te)}),H(()=>r.state.tradingShare.prices,G),H(()=>l.value.whitespace,k),H(()=>l.value.source,le),H(()=>l.value.reversal,pe),b({getFilterTimes:V,getChartData:N,updateWatchlist:re});function d(){const e={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.5,bottom:.05}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:40,horzAlign:"center",vertAlign:"center",color:"rgba(54, 54, 64, 0.4)"}};t.chart=Ge(m.value,e),t.chart.subscribeCrosshairMove(J),t.chart.subscribeCustomPriceLineDragged(Y),t.series.whitespace=t.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),n.series.index=t.chart.addCandlestickSeries({priceScaleId:"index",upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01},scaleMargins:{top:.1,bottom:.55}}),n.series.stock=t.chart.addCandlestickSeries({upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01}})}function M(){t.chart&&(t.chart.remove(),t.chart=null)}function $(e){e.preventDefault(),e.stopPropagation()}function O(){Q(),g.value.isSelected()?g.value.draw({time:t.crosshair.time}):p.value.isSelected()?p.value.draw({prices:t.data.stock,time:t.crosshair.time}):c.value.isSelected()?c.value.draw({price:he(t.crosshair.y)}):y.value.isSelected()&&y.value.draw({price:he(t.crosshair.y)})}function j(e){e.stopPropagation()}function V(){return g.value.get()}function J(e){if(e.time){let o=e.seriesPrices.get(n.series.stock);t.crosshair.time=e.time,t.crosshair.price=o}else D.phone||(t.crosshair.time=null,t.crosshair.price=null);e.point!=null&&(t.crosshair.x=e.point.x,t.crosshair.y=e.point.y)}function Y(e){let i=e.customPriceLine.options();i.price=S.fmtNum(i.price);const v=+e.fromPriceString,C=i.price;switch(i.lineType){case"line":c.value.drag({lineOptions:i,oldPrice:v,newPrice:C});break;case"target":y.value.drag({lineOptions:i,newPrice:C});break}}function ee(){f.value&&(t.chart.resize(f.value.offsetWidth,f.value.offsetHeight),w.value.checkFullscreen())}function te(e){if(e.ctrlKey||e.metaKey)switch(e.code){case"Numpad0":ce(!0);break;case"Numpad1":ce(!1);break;case"NumpadDecimal":ne();break;case"Space":n.inputSymbol="",I.value.instance.focus();break}}function re(e){l.value.watchlist=e}function ne(){if(!n.symbol)return!1;const e={multi:!1,group:R.group,symbol:n.symbol,add:!F.value};r.dispatch("tradingShare/changeWatchlist",e).then(o=>{l.value.watchlist=S.isSet(o)?o:[]})}function k(e){t.series.whitespace.setData(e)}function G(e){t.data.stock=S.cloneDeep(e),n.series.stock.setData(t.data.stock),t.chart.applyOptions({watermark:{text:n.symbol}})}function K(e){t.data.index=e,n.series.index.setData(e)}function X(e,o){let i=t.data[e].pop();if(!i)return!1;i.high=Math.max(i.high,o),i.low=Math.min(i.low,o),i.close=o,t.data[e].push(i),n.series[e].update(i)}function U(){if(!n.inputSymbol||!n.inputSymbol.trim()||(n.inputSymbol=n.inputSymbol.trim().toUpperCase(),n.symbol==n.inputSymbol))return!1;n.symbol=n.inputSymbol,I.value.instance.blur(),N()}function oe(){r.dispatch("tradingShare/initChart")}function le(e){e==="FIREANT"?Ne():(N(!0),fe())}function N(e=!1,o=null){if(!n.symbol)return!1;o||(o=q.value),l.value.source==="FIREANT"?Ie(e,o):Oe(e,o)}function Ie(e=!1,o=null){if(t.websocket&&t.websocket.readyState===WebSocket.OPEN){const i=Ce(o,"yyyy-MM-dd"),v=Ce(new Date,"yyyy-MM-dd");let C=`{"arguments":["${n.symbol}","D","${i}","${v}"],"invocationId":"stock","target":"GetBars","type":1}`;t.websocket.send(C),e&&(C=`{"arguments":["${l.value.index}","D","${i}","${v}"],"invocationId":"index","target":"GetBars","type":1}`,t.websocket.send(C)),me()}}function Oe(e=!1,o=null){r.dispatch("tradingShare/getChartData",{symbol:n.symbol,from:xe(o),withIndex:e}).then(i=>{e&&K(i),me()})}function pe(e){let o=[];e&&o.push({time:e.time,color:"#9C27B0",position:"aboveBar",shape:"circle"}),n.series.index.setMarkers(o)}function me(){p.value.remove(),c.value.remove(),y.value.remove()}function Fe(){ce()}function ce(e=!0){if(A.value)return!1;const o=L.value;let i=o.findIndex(C=>C===n.symbol);i=i+(e?1:-1),i<0?i=o.length-1:i>=o.length&&(i=0);const v=o[i];if(!v)return!1;n.inputSymbol=v,n.symbol=n.inputSymbol,N()}function Te(){if(!n.symbol||n.symbol===l.value.index)return!1;const e=V();if(e.length<2)return Qe.warning(x("trading.share.filterTimeWarning"));_.value.check({symbol:n.symbol,filterTimes:e})}function Ne(){let e="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg";t.websocket=new WebSocket(e),t.websocket.onopen=()=>{console.log("Đã kết nối tới WebSocket server"),t.websocket.send('{"protocol":"json","version":1}'),N(!0)},t.websocket.onmessage=o=>{const i=Ee(o.data);if(i.length==0)return!1;i.forEach(v=>{if(!v)return!1;if(v.type==3){const C=v.result.bars.map(({open:z,high:P,low:Z,close:Be,date:Re})=>{const Ae=xe(new Date(Re));return{open:z,high:P,low:Z,close:Be,time:Ae}});v.invocationId==="stock"?(r.dispatch("tradingShare/getTools",{symbol:n.symbol}),G(C)):K(C)}else if(v.type==1&&v.target==="UpdateLastPrices"){const C=v.arguments[0],z=C.find(Z=>Z.symbol==l.value.index),P=C.find(Z=>Z.symbol==n.symbol);z&&X("index",z.last),P&&X("stock",P.last)}})},t.websocket.onerror=o=>{console.error("Lỗi kết nối WebSocket:",o)},t.websocket.onclose=()=>{console.log("Đã đóng kết nối WebSocket")}}function fe(){t.websocket&&(t.websocket.readyState===WebSocket.OPEN&&t.websocket.close(),t.websocket=null)}function Ee(e){let o=[];return e.split("").forEach(i=>{const v=i.indexOf("{"),C=i.lastIndexOf("}");let z=null;if(v!==-1&&C!==-1&&C>v){const P=i.substring(v,C+1);if(P!="{}")try{z=JSON.parse(P)}catch(Z){console.error("JSON parse error:",Z)}}o.push(z)}),o}function Q(){c.value.hide()}function he(e){return S.fmtNum(n.series.stock.coordinateToPrice(e))}return(e,o)=>(se(),ue("div",{ref_key:"chartContainerRef",ref:f,class:"share-chart",onClick:O,onContextmenu:$},[E("div",{ref_key:"chartRef",ref:m},null,512),E("div",{class:"area data-area",onClick:j,onContextmenu:$},[E("div",St,[W(je(vt.DxAutocomplete),{ref_key:"symbolAutocompleteRef",ref:I,"data-source":L.value,"show-clear-button":!0,openOnFieldClick:!0,minSearchLength:0,maxItemCount:100,modelValue:n.inputSymbol,"onUpdate:modelValue":o[0]||(o[0]=i=>n.inputSymbol=i),onChange:U,onItemClick:U},null,8,["data-source","modelValue"])]),Je(E("div",{ref:"addWatchlistToolRef",class:Se(["command far",{"fa-heart-circle-minus":F.value,"fa-heart-circle-plus":!F.value}]),title:e.$t("trading.share.changeWatchlist"),onClick:ne,onContextmenu:Fe},null,42,yt),[[Ye,h.value]]),E("div",{class:"command",title:e.$t("trading.share.reload"),onClick:o[1]||(o[1]=()=>N()),onContextmenu:o[2]||(o[2]=()=>N(!0))},[E("i",{class:Se(["far fa-sync-alt",{"fa-spin":A.value}])},null,2)],40,Ct)],32),E("div",{class:"area tool-area",onClick:j,onContextmenu:$},[W(Ke,{ref_key:"fullscreenToolRef",ref:w,chartContainerRef:f.value},null,8,["chartContainerRef"]),W(Xe,{ref:"tradingviewToolRef",vpsUser:l.value.vpsUser,vpsSession:l.value.vpsSession,chartContainerRef:f.value,symbol:n.symbol,timeframe:"1D"},null,8,["vpsUser","vpsSession","chartContainerRef","symbol"]),W(lt,{ref_key:"filterTimeToolRef",ref:g,onHideContext:Q},null,512),W(ut,{ref_key:"checkToolRef",ref:_,symbol:n.symbol,onCheckSymbol:Te,onHideContext:Q},null,8,["symbol"]),W(pt,{ref_key:"reversalToolRef",ref:p,symbol:n.symbol,priceSeries:n.series.stock,onIndexUpdated:pe,onHideContext:Q},null,8,["symbol","priceSeries"]),W(qe,{ref_key:"lineToolRef",ref:c,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,onHideContext:Q},null,8,["symbol","priceSeries"]),W(et,{ref_key:"targetToolRef",ref:y,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,levels:[1,2],isPercent:!0,onHideContext:Q},null,8,["symbol","priceSeries"])],32)],544))}};export{kt as default};
