import{_ as w,a as v,m as l,b as $,c as g,d,t as C,e as a,w as c,r as s,o as y}from"./app-d106301a.js";import{D as b,a as D}from"./data-grid-6b2f5208.js";import S from"./PaidContractPopup-60482b04.js";import k from"./WithdrawnContractPopup-cad6c5c4.js";import{C as P}from"./ContractDetailPopup-582d1282.js";import"./row_dragging-ab51ab2a.js";import"./dialog-a3bfaf41.js";import"./exporter-683d1596.js";import"./accordion-0dc41a43.js";import"./Index-afc8005f.js";import"./interest-formula-45587e77.js";import"./load-indicator-d2640182.js";/* empty css                                                            */const T={components:{DxDataGrid:b,DxColumn:D,PaidContractPopup:S,WithdrawnContractPopup:k,ContractDetailPopup:P},data(){return{gridData:null,isOld:!1,validationRules:{}}},beforeCreate(){this.$store.registerModule("Admin.contracts",v)},created(){this.fetch(!1).then(()=>this.createValidation())},destroyed(){this.$store.unregisterModule("Admin.contracts")},computed:{...l("Auth",["permissions"]),...l("Admin.contracts",["contracts","users","principalMin"]),dataGrid:function(){return this.$refs.dataGrid.instance}},watch:{contracts(){this.cloneDeepData()}},methods:{...$("Admin.contracts",["fetch","save","resetState"]),onSave(t){this.save({changes:t.changes})},onToolbarPreparing(t){t.toolbarOptions.items.unshift({visible:this.$mf.isSet(this.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:this.$t("buttons.back"),onClick:()=>{this.$router.go(-1)}}},{location:"before",widget:"dxButton",options:{icon:"far fa-history small",type:this.isOld?"default":"normal",hint:this.$t("models.contract.includeWithdrawn"),onClick:()=>{this.isOld=!this.isOld,this.dataGrid.beginCustomLoading(),this.fetch(this.isOld)}}})},createValidation(){this.validationRules={user:[{type:"required",message:this.$t("models.contract.user")+this.$mt.validations.required}],principal:[{type:"required",message:this.$t("models.contract.principal")+this.$mt.validations.required},{type:"custom",validationCallback:this.validatePrincipal,message:this.$t("models.contract.validations.principal").replace("{amount}",this.$options.filters.currency(this.principalMin))}],advance:[{type:"custom",validationCallback:this.validateAdvance,message:this.$t("models.contract.validations.advance").replace("{advance}",this.$options.filters.currency(.1*this.principalMin)).replace("{surplus}",this.$options.filters.currency(this.principalMin))}],interestRate:[{type:"required",message:this.$t("models.contract.interestRate")+this.$mt.validations.required}],paidAt:[{type:"required",message:this.$t("models.contract.paidAt")+this.$mt.validations.required}]}},onInitNewRow(t){t.data.interest_rate=this.interestRate,t.data.paid_at=moment().format(this.$mc.SERVER_DATE_FORMAT),this.dataGrid.columnOption("interest_rate","allowEditing",this.permissions.includes("system@control")),this.dataGrid.option("editing.popup.title",this.$t("models.contract.popup.create"))},onEditingStart(t){this.dataGrid.columnOption("user_code","allowEditing",t.data.status==1||this.permissions.includes("system@control")),this.dataGrid.columnOption("principal","allowEditing",t.data.status==1||this.permissions.includes("system@control")),this.dataGrid.columnOption("interest_rate","allowEditing",this.permissions.includes("system@control")),this.dataGrid.columnOption("paid_at","allowEditing",t.data.status==1||this.permissions.includes("system@control")),this.dataGrid.columnOption("withdrawn_at","allowEditing",[2,3].includes(t.data.status)),this.dataGrid.option("editing.popup.title",`${this.$t("models.contract.popup.edit")} #${t.data.code}`)},validatePrincipal(t){return t.value>=this.principalMin},validateAdvance(t){return t.value?t.value>=.1*this.principalMin&&t.data.total-t.value>=this.principalMin:!0},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.contracts),this.$route.query.code&&this.dataGrid.columnOption("code","filterValues",[+this.$route.query.code]),this.$route.query.userCode&&this.dataGrid.columnOption("userCode","filterValues",[+this.$route.query.userCode])},onShown(t){this.$mf.checkPinDataGrid(t,this),this.$mf.pushPopupToHistoryState(()=>this.dataGrid.cancelEditData())},onCellDblClick(t){t.rowType=="data"&&t.columnIndex==2&&this.$router.push({name:"users",query:{code:t.data.user_code}})}}},R={class:"content-block"},E={class:"content-block dx-card responsive-paddings"};function M(t,r,G,A,n,i){const o=s("DxColumn"),u=s("DxToolbar"),p=s("DxDataGrid"),m=s("PaidContractPopup"),h=s("WithdrawnContractPopup"),f=s("ContractDetailPopup");return y(),g("div",null,[d("h2",R,C(t.$t("admin.contracts.title")),1),d("div",E,[a(p,{ref:"dataGrid","data-source":n.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"popup",popup:{fullScreen:!!t.$devices.phone,showTitle:!0,onShown:i.onShown,onHiding:t.$mf.popRouteHistoryState},form:{labelLocation:t.$devices.phone?"top":"left",items:[{dataField:"user_code"},{dataField:"principal"},{dataField:"interest_rate"},{dataField:"paid_at"},{dataField:"advance"},{dataField:"withdrawn_at"}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:r[0]||(r[0]=e=>t.$mf.dataGridPreload(n.gridData,i.dataGrid)),onInitNewRow:i.onInitNewRow,onEditingStart:i.onEditingStart,onToolbarPreparing:i.onToolbarPreparing,onCellDblClick:i.onCellDblClick,onSaved:i.onSave},{commandCellTemplate:c(({data:e})=>[a(u,{items:[{visible:e.data.status==2&&t.permissions.includes("system@control")||[0,1].includes(e.data.status),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==2?"file-":""}check small`,hint:t.$t(`components.paidContract.${e.data.status==2?"confirmTitle":"title"}`),text:t.$t(`components.paidContract.${e.data.status==2?"confirmTitle":"title"}`),onClick:()=>t.$refs.paidContractPopup.show(e.data)}},{visible:e.data.status==3||e.data.status==4&&t.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status<=1?"check":e.data.status==3?"check-double":"file-check"} small`,hint:t.$t(`components.withdrawnContract.${e.data.status==4?"withdrawnTitle":"title"}`),text:t.$t(`components.withdrawnContract.${e.data.status==4?"withdrawnTitle":"title"}`),onClick:()=>t.$refs.withdrawnContractPopup.show(e.data)}},{visible:e.data.status<=3||t.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>i.dataGrid.editRow(e.rowIndex)}},{visible:e.data.status==0||t.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>i.dataGrid.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopup.show(e.data)}}]},null,8,["items"])]),default:c(()=>[a(o,{fixed:!0,width:t.$devices.phone?35:125,alignment:"center",type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$devices.phone?"Short":""}`)},null,8,["width","caption"]),a(o,{"allow-editing":!1,"data-field":"code",dataType:"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),a(o,{"allow-editing":!1,"data-field":"status",dataType:"number",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),a(o,{"data-field":"user_code",dataType:"number",name:"userCode","header-filter":{allowSearch:!0},caption:t.$t("models.contract.user"),"validation-rules":n.validationRules.user,lookup:{dataSource:t.users,displayExpr:"name",valueExpr:"code",searchEnabled:!0,searchExpr:["code","name"]}},null,8,["caption","validation-rules","lookup"]),a(o,{"data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":n.validationRules.principal},null,8,["caption","validation-rules"]),a(o,{"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),"editor-options":{step:"0.0001",format:"#0.## %/"+t.$t("models.contract.frequency")},caption:t.$t("models.contract.interestRate"),"validation-rules":n.validationRules.interestRate},null,8,["format","editor-options","caption","validation-rules"]),a(o,{"data-field":"paid_at","data-type":"date","editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("models.contract.paidAt"),"validation-rules":n.validationRules.paidAt},null,8,["editor-options","caption","validation-rules"]),a(o,{"data-field":"advance","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.advance"),"validation-rules":n.validationRules.advance},null,8,["caption","validation-rules"]),a(o,{"data-field":"withdrawn_at","data-type":"date","editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("models.contract.withdrawnAt")},null,8,["editor-options","caption"])]),_:1},8,["data-source","editing","onCellPrepared","onInitNewRow","onEditingStart","onToolbarPreparing","onCellDblClick","onSaved"])]),a(m,{ref:"paidContractPopup"},null,512),a(h,{ref:"withdrawnContractPopup"},null,512),a(f,{ref:"contractDetailPopup"},null,512)])}const X=w(T,[["render",M]]);export{X as default};
