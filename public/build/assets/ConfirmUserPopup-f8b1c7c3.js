import{u as L,r as m,a as N,c as K,x as X,b as $,e as l,f as c,_ as j,n as g,p as y,F as G,h as H,k as h,v as x,l as v,o as f,g as Z,d as n,q as P,t as S,P as q,s as J}from"./app-e58b0d33.js";import{_ as Q}from"./accordion-fdb56672.js";import{_ as W}from"./Index-30ad1033.js";const Y={class:"download"},ee={class:"upload-browser"},te={for:"contractImage"},oe=n("i",{class:"far fa-file-upload"},null,-1),ae={class:"upload-browser"},ne={for:"identityImage"},le=n("i",{class:"far fa-file-upload"},null,-1),fe={__name:"ConfirmUserPopup",setup(se,{expose:V}){const R=H(),{t:p}=L(),B=h("bus"),I=h("mc"),_=h("mf"),s=m(null),T=m(null),w=m(null),d=m(null),u=m(null),t=N({refreshKey:0,user:{},formData:{}});let D=[];const C=K(()=>new Set(t.formData.documents.map(e=>e.file)));X(()=>k());function E({user:e}){s.value.setTitle(p(`components.confirmUser.${e.level==4?"title":"confirmedTitle"}`)+" #"+e.code),s.value.show(),t.user=e}function b(e){let o=e.target.id.replace("Image","");t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&a.isUpload)),console.log("onUploadImageChange",e.target.files),[...e.target.files].forEach(a=>t.formData.documents.push({type:o,file:URL.createObjectURL(a),isUpload:!0}))}function U(e){let o=e.element.id.replace("Delete","");e.value?t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&!a.isUpload)):t.formData.documents=D.filter(a=>a.type==o).concat(t.formData.documents)}function A(){!t.formData.isContractDelete&&!t.formData.isIdentityDelete&&d.value.files.length==0&&u.value.files.length==0?x.info(p("messages.info.noChangedData")):t.formData.documents.length==0?x.show(p("messages.warning.imageEmpty")):w.value.click()}function M(){B.emit("checkPin",async()=>{let e=new FormData;e.append("userId",t.user.id),e.append("isContractDelete",t.formData.isContractDelete),e.append("isIdentityDelete",t.formData.isIdentityDelete);for(var o=0;o<d.value.files.length;o++){let a=await _.resizeImage({file:d.value.files[o],maxSize:I.MAX_SIZE_IMAGE_UPLOAD});e.append(`contractImages[${o}]`,a)}for(var o=0;o<u.value.files.length;o++){let i=await _.resizeImage({file:u.value.files[o],maxSize:I.MAX_SIZE_IMAGE_UPLOAD});e.append(`identityImages[${o}]`,i)}R.dispatch("adminUser/uploadDocuments",e).then(a=>{a&&s.value.hide()})})}function k(){t.formData={isPdfPreview:!1,isContractDelete:!1,isIdentityDelete:!1,documents:[]}}function z(){setTimeout(()=>T.value.instance.option("selectedIndex",t.user.level==4?0:1),0),D=t.user.url_documents.map(e=>({...e,isUpload:!1})),t.formData.documents=D}function O(){k(),t.refreshKey++}return V({show:E}),(e,o)=>{const a=v("DxButton"),i=v("DxCheckBox"),F=v("DxScrollView");return f(),$(G,null,[l(j,{ref_key:"popupRef",ref:s,title:e.$t("admin.users.deletedUsers"),class:"confirm-user-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:A}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>s.value.hide()}}],onShown:z,onHidden:O},{default:c(()=>[l(F,null,{default:c(()=>[l(Z(Q),{ref:"accordion",collapsible:!0,items:[{title:e.$t("components.confirmUser.step1"),template:"step1Template"},{title:e.$t("components.confirmUser.step2"),template:"step2Template"}]},{step1Template:c(()=>[n("div",Y,[l(a,{text:e.$t("buttons.download"),icon:"download",type:"default","styling-mode":"contained",onClick:o[0]||(o[0]=()=>e.$refs.pdfRef.download({component:"ContractPdf",user:t.user,isPreview:t.formData.isPdfPreview}))},null,8,["text"]),e.$screen.getScreenSizeInfo.isXSmall?y("",!0):(f(),g(i,{key:0,modelValue:t.formData.isPdfPreview,"onUpdate:modelValue":o[1]||(o[1]=r=>t.formData.isPdfPreview=r),text:e.$t("components.confirmUser.preview")},null,8,["modelValue","text"]))])]),step2Template:c(()=>[n("form",{onSubmit:J(M,["prevent"])},[n("button",{ref_key:"submitRef",ref:w,class:"display-none"},null,512),(f(),$("div",{class:"upload",key:t.refreshKey},[n("div",ee,[n("input",{ref_key:"contractImageRef",ref:d,type:"file",id:"contractImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",te,[oe,P(" "+S(e.$t("components.confirmUser.chooseContractImage")),1)]),l(i,{id:"contractDelete",modelValue:t.formData.isContractDelete,"onUpdate:modelValue":o[2]||(o[2]=r=>t.formData.isContractDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),n("div",ae,[n("input",{ref_key:"identityImageRef",ref:u,type:"file",id:"identityImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",ne,[le,P(" "+S(e.$t("components.confirmUser.chooseIdentityImage")),1)]),l(i,{id:"identityDelete",modelValue:t.formData.isIdentityDelete,"onUpdate:modelValue":o[3]||(o[3]=r=>t.formData.isIdentityDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),C.value.length?(f(),g(q,{key:0,images:C.value},null,8,["images"])):y("",!0)]))],32)]),_:1},8,["items"])]),_:1})]),_:1},8,["title","toolbarItems"]),e.$mf.isSet(t.user)?(f(),g(W,{key:0,ref:"pdfRef"},null,512)):y("",!0)],64)}}};export{fe as default};
