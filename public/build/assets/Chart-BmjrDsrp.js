import{h as ue,c as E,r as N,w as J,o as re,b as ce,d as R,u as De,S as Re,U as Ae,$ as ve,V as he,W as Se,X as Le,Y as Me,Z as We,K as $e,M as ye,a as Ve,y as ze,H as Pe,e as V,g as He,I as Ze,J as je,E as Ce,j as Je,k as xe,x as Ye,l as ke}from"./app-DuDEuuXb.js";import{c as Qe,g as _e,a as Ue,b as Ge,d as Ke,e as Xe}from"./lightweight-charts.esm.development-B218qAjq.js";const qe=["title"],et=R("i",{class:"far fa-grip-lines-vertical"},null,-1),tt=[et],nt={__name:"FilterTimeTool",props:[],emits:["hideContext"],setup(r,{expose:b,emit:p}){const s=ue(),y=p,F=E(()=>s.state.tradingShare.config.filterTime),C=N(null);let m={},h=[];const w=["rgba(244, 67, 54, 0.7)","rgba(255, 152, 0, 0.7)","rgba(76, 175, 80, 0.7)","rgba(0, 150, 136, 0.7)"];b({createSeries:x,isSelected:O,draw:f,get:v}),J(F,l=>{l&&setTimeout(()=>A(l),3e3)});function O(){return C.value.classList.contains("selected")}function v(){return h.map(g=>g.time).reverse()}function x(l){if(!l)return!1;m=l.addHistogramSeries({priceScaleId:"filterTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function d(l){y("hideContext");const g=l.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(T=>T.classList.remove("selected")),g||(h.pop(),m.setData(h),l.target.classList.add("selected"))}function c(l){L(),l.target.classList.remove("selected")}function f({time:l}){const g=h.length;if(g&&l<=h[g-1].time)return!1;h.push({time:l,color:w[g],value:1}),m.setData(h),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:"",name:"filterTime",points:[g],data:[l]}),g===3&&C.value.classList.remove("selected")}function A(l){for(let g=0;g<l.length;g++)h.push({time:l[g],color:w[g],value:1});m.setData(h)}function L(l=!0){l&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:"",name:"filterTime"}),m.setData([]),h=[]}return(l,g)=>(re(),ce("div",{ref_key:"filterTimeToolRef",ref:C,class:"command",title:l.$t("trading.share.tools.filterTime"),onClick:d,onContextmenu:c},tt,40,qe))}},ot=["title"],lt=R("i",{class:"far fa-circle-check"},null,-1),at=[lt],it={__name:"CheckTool",props:["symbol"],emits:["checkSymbol","hideContext"],setup(r,{expose:b,emit:p}){const s=ue(),{t:y}=De(),F=r,C=p;let m=null;J(()=>F.symbol,()=>m=null),b({check:h});function h(d){s.dispatch("tradingShare/checkSymbol",d).then(c=>{m=c,v(c)})}function w(){C("checkSymbol"),C("hideContext")}function O(){m&&v(m)}function v(d){let c=JSON.stringify(d.result,void 0,4);Re(`<pre class='check-tool-popup'>${x(c)}</pre>`,`${y("trading.share.tools.check")} ${d.symbol}`)}function x(d){return d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(c){var f="number";return/^"/.test(c)?/:$/.test(c)?f="key":f="string":/true|false/.test(c)?f="boolean":/null/.test(c)&&(f="null"),'<span class="'+f+'">'+c+"</span>"})}return(d,c)=>(re(),ce("div",{class:"command",title:d.$t("trading.share.tools.check"),onClick:w,onContextmenu:O},at,40,ot))}},st=["title"],ut=R("i",{class:"far fa-arrow-trend-down"},null,-1),rt=[ut],se="reversal",ct={__name:"ReversalTool",props:["symbol","indexSeries","stockSeries"],emits:["hideContext"],setup(r,{expose:b,emit:p}){const s=ue(),y=r,F=p,C=N(null),m=E(()=>s.state.tradingShare.tools.reversal),h=E(()=>s.state.tradingShare.config.reversal),w=E(()=>s.state.tradingShare.config.index),O=E(()=>s.state.tradingShare.config.whitespace),v={index:"rgba(103, 58, 183, 0.7)",stock:"rgba(156, 39, 176, 0.7)"};let x={},d=[],c={index:null,stock:null},f={title:"R",lineWidth:1,lineStyle:0,draggable:!1};b({createSeries:L,isSelected:A,draw:T,remove:me,loadIndex:t}),J(m,u=>{u&&de(u[0])}),J(h,u=>{u&&t(u)});function A(){return C.value.classList.contains("selected")}function L(u){if(!u)return!1;x.stock=u.addHistogramSeries({priceScaleId:se+"Stock",color:v.stock,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),x.index=u.addHistogramSeries({priceScaleId:se+"Index",color:v.index,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function l(u){F("hideContext");const D=u.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(W=>W.classList.remove("selected")),D||($(),y.symbol===w.value&&U(),u.target.classList.add("selected"))}function g(u){$(),y.symbol===w.value&&U(),u.target.classList.remove("selected")}function T({prices:u,time:D}){if(d.push({time:D,value:1}),d.length===2){const W=M(u,d[0].time,d[1].time);n(W),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:y.symbol,name:se,points:[0],data:[W]}),y.symbol===w.value&&t(W),d=[],C.value.classList.remove("selected")}else x.stock.setData(d)}function M(u,D,W){let I,G,z,Y;const P=u.filter(_=>_.time>=D&&_.time<=W);for(let _=0;_<P.length;_++){const oe=P[_].time,le=P[_].high,B=P[_].low,K={i:_,p:le},ae={i:_,p:B};if(_===0)I={H:K,L:K},z=0,Y=0,G=oe;else if(le>I.H.p?I.H=K:I.H.i=_,B<I.L.p){G=oe;const X=I.H.p-I.L.p,ie=I.H.i-I.L.i;X>z&&(z=X),ie>Y&&(Y=ie),I={H:ae,L:ae}}}const q=[...u,...O.value],ee=q.findIndex(_=>_.time===G),te=q[ee+Y].time,ne=I.L.p+z;return{time:te,price:ne}}function de(u){$(!1),n(u)}function n({price:u,time:D}){x.stock.setData([{time:D,value:1}]),f.price=u,f.color=v.stock,c.stock=y.stockSeries.createPriceLine(f)}function t(u){U(),pe(u)}function pe({price:u,time:D}){x.index.setData([{time:D,value:1}]),f.price=u,f.color=v.index,c.index=y.indexSeries.createPriceLine(f)}function me(){$(!1)}function $(u=!0){u&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:y.symbol,name:se}),x.stock.setData([]),c.stock&&(y.stockSeries.removePriceLine(c.stock),c.stock=null)}function U(){x.index.setData([]),c.index&&(y.indexSeries.removePriceLine(c.index),c.index=null)}return(u,D)=>(re(),ce("div",{ref_key:"reversalToolRef",ref:C,class:"command",title:u.$t("trading.share.tools.reversal"),onClick:l,onContextmenu:g},rt,40,st))}};var o={},dt="dx-autocomplete",pt="dx-autocomplete-popup-wrapper",Ie=Ae.inherit({_supportedKeys:function(){var r=this._list?this._list.option("focusedElement"):null,b=this.callBase();return r=r&&ve(r),he({},b,{upArrow:function(p){return!Se(p)&&(p.preventDefault(),p.stopPropagation(),r&&!this._calcNextItem(-1))?(this._clearFocusedItem(),!1):!0},downArrow:function(p){return!Se(p)&&(p.preventDefault(),p.stopPropagation(),r&&!this._calcNextItem(1))?(this._clearFocusedItem(),!1):!0},enter:function(p){r||this.close();var s=this.option("opened");return s&&p.preventDefault(),s}})},_getDefaultOptions:function(){return he(this.callBase(),{minSearchLength:1,maxItemCount:10,noDataText:"",showDropDownButton:!1,searchEnabled:!0})},_initMarkup:function(){this.callBase(),this.$element().addClass(dt),this.setAria("autocomplete","inline")},_displayGetterExpr:function(){return this.option("valueExpr")},_closeOutsideDropDownHandler:function(r){var{target:b}=r;return!ve(b).closest(this.$element()).length},_renderDimensions:function(){this.callBase(),this._updatePopupWidth(),this._updateListDimensions()},_popupWrapperClass:function(){return this.callBase()+" "+pt},_listConfig:function(){return he(this.callBase(),{pageLoadMode:"none",onSelectionChanged:r=>{this._setSelectedItem(r.addedItems[0])}})},_listItemClickHandler:function(r){this._saveValueChangeEvent(r.event);var b=this._displayGetter(r.itemData);this.option("value",b),this.close()},_setListDataSource:function(){this._list&&(this._list.option("selectedItems",[]),this.callBase())},_refreshSelected:Le,_searchCanceled:function(){this.callBase(),this.close()},_loadItem:function(r,b){var p=this._getItemFromPlain(r,b);return new Me().resolve(p).promise()},_dataSourceOptions:function(){return{paginate:!0,pageSize:this.option("maxItemCount")}},_searchDataSource:function(r){this._dataSource.pageSize(this.option("maxItemCount")),this.callBase(r),this._clearFocusedItem()},_clearFocusedItem:function(){this._list&&(this._list.option("focusedElement",null),this._list.option("selectedIndex",-1))},_renderValueEventName:function(){return"input keyup"},_valueChangeEventHandler:function(r){var b=this._input().val()||null;return this.callBase(r,b)},_optionChanged:function(r){switch(r.name){case"maxItemCount":this._searchDataSource();break;case"valueExpr":this._compileDisplayGetter(),this._setListOption("displayExpr",this._displayGetterExpr()),this.callBase(r);break;default:this.callBase(r)}},reset:function(){this.callBase(),this.close()}});We("dxAutocomplete",Ie);const mt=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"})),ft=$e(mt);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var we;function ht(){if(we)return o;we=1;var r=o&&o.__importDefault||function(M){return M&&M.__esModule?M:{default:M}};Object.defineProperty(o,"__esModule",{value:!0}),o.DxToolbarItem=o.DxTo=o.DxShow=o.DxPosition=o.DxOptions=o.DxOffset=o.DxMy=o.DxItem=o.DxHide=o.DxFrom=o.DxDropDownOptions=o.DxCollision=o.DxButton=o.DxBoundaryOffset=o.DxAt=o.DxAnimation=o.DxAutocomplete=void 0;var b=r(ft),p=ye(),s=ye(),y=p.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttons:Array,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxItemCount:Number,maxLength:[Number,String],minSearchLength:Number,name:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDropDownButton:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:String,valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxItemCount":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDropDownButton":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=b.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});o.DxAutocomplete=y;var F=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});o.DxAnimation=F,F.$_optionName="animation",F.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var C=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});o.DxAt=C,C.$_optionName="at";var m=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});o.DxBoundaryOffset=m,m.$_optionName="boundaryOffset";var h=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});o.DxButton=h,h.$_optionName="buttons",h.$_isCollectionItem=!0,h.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var w=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});o.DxCollision=w,w.$_optionName="collision";var O=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});o.DxDropDownOptions=O,O.$_optionName="dropDownOptions",O.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var v=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});o.DxFrom=v,v.$_optionName="from",v.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var x=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});o.DxHide=x,x.$_optionName="hide",x.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var d=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});o.DxItem=d,d.$_optionName="items",d.$_isCollectionItem=!0;var c=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});o.DxMy=c,c.$_optionName="my";var f=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});o.DxOffset=f,f.$_optionName="offset";var A=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});o.DxOptions=A,A.$_optionName="options";var L=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});o.DxPosition=L,L.$_optionName="position";var l=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});o.DxShow=l,l.$_optionName="show";var g=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});o.DxTo=g,g.$_optionName="to";var T=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});return o.DxToolbarItem=T,T.$_optionName="toolbarItems",T.$_isCollectionItem=!0,o.default=y,o}var gt=ht();const bt={class:"command symbol-input"},vt=["title"],St=["title"],xt={__name:"Chart",props:["fromDate","group"],setup(r,{expose:b}){const p=ue(),s=Je(),{t:y}=De(),F=xe("devices"),C=xe("mf"),m=N(null),h=N(null),w=N(null),O=N(null),v=N(null),x=N(null),d=N(null),c=N(null),f=N(null),A=r,L=E(()=>p.state.tradingShare.isLoading),l=E(()=>p.state.tradingShare.config),g=E(()=>n.symbol),T=E(()=>l.value.watchlist.includes(n.symbol)),M=E(()=>p.state.tradingShare.symbols),de=E(()=>A.fromDate),n=Ve({symbol:s.query.symbol??"VN30",inputSymbol:s.query.symbol??"VN30",series:{}});let t={chart:{},series:{},data:{index:[],stock:[]},crosshair:{},websocket:null};ze(()=>{pe(),oe(),v.value.createSeries(t.chart),d.value.createSeries(t.chart),new ResizeObserver(G).observe(m.value),document.addEventListener("keydown",z)}),Pe(()=>{me(),ge(),document.removeEventListener("keydown",z)}),J(()=>p.state.tradingShare.prices,ee),J(()=>l.value.whitespace,q),J(()=>l.value.source,le),b({getFilterTimes:D,getChartData:B,updateWatchlist:Y});function pe(){const e={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.5,bottom:.05}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:40,horzAlign:"center",vertAlign:"center",color:"rgba(54, 54, 64, 0.4)"}};t.chart=Qe(h.value,e),t.chart.subscribeCrosshairMove(W),t.chart.subscribeCustomPriceLineDragged(I),t.series.whitespace=t.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),n.series.index=t.chart.addCandlestickSeries({priceScaleId:"index",upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01},scaleMargins:{top:.1,bottom:.55}}),n.series.stock=t.chart.addCandlestickSeries({upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01}})}function me(){t.chart&&(t.chart.remove(),t.chart=null)}function $(e){e.preventDefault(),e.stopPropagation()}function U(){Q(),v.value.isSelected()?v.value.draw({time:t.crosshair.time}):d.value.isSelected()?d.value.draw({prices:t.data.stock,time:t.crosshair.time}):c.value.isSelected()?c.value.draw({price:be(t.crosshair.y)}):f.value.isSelected()&&f.value.draw({price:be(t.crosshair.y)})}function u(e){e.stopPropagation()}function D(){return v.value.get()}function W(e){if(e.time){let a=e.seriesPrices.get(n.series.stock);t.crosshair.time=e.time,t.crosshair.price=a}else F.phone||(t.crosshair.time=null,t.crosshair.price=null);e.point!=null&&(t.crosshair.x=e.point.x,t.crosshair.y=e.point.y)}function I(e){let i=e.customPriceLine.options();i.price=C.fmtNum(i.price);const S=+e.fromPriceString,k=i.price;switch(i.lineType){case"line":c.value.drag({lineOptions:i,oldPrice:S,newPrice:k});break;case"target":f.value.drag({lineOptions:i,newPrice:k});break}}function G(){m.value&&(t.chart.resize(m.value.offsetWidth,m.value.offsetHeight),O.value.checkFullscreen())}function z(e){if(e.ctrlKey||e.metaKey)switch(e.code){case"Numpad0":fe(!0);break;case"Numpad1":fe(!1);break;case"NumpadDecimal":P();break;case"Space":n.inputSymbol="",w.value.instance.focus();break}}function Y(e){l.value.watchlist=e}function P(){if(!n.symbol)return!1;const e={multi:!1,group:A.group,symbol:n.symbol,add:!T.value};p.dispatch("tradingShare/changeWatchlist",e).then(a=>{l.value.watchlist=C.isSet(a)?a:[]})}function q(e){t.series.whitespace.setData(e)}function ee(e){t.data.stock=C.cloneDeep(e),n.series.stock.setData(t.data.stock),t.chart.applyOptions({watermark:{text:n.symbol}})}function te(e){t.data.index=e,n.series.index.setData(e)}function ne(e,a){let i=t.data[e].pop();if(!i)return!1;i.high=Math.max(i.high,a),i.low=Math.min(i.low,a),i.close=a,t.data[e].push(i),n.series[e].update(i)}function _(){if(!n.inputSymbol||!n.inputSymbol.trim()||(n.inputSymbol=n.inputSymbol.trim().toUpperCase(),n.symbol==n.inputSymbol))return!1;n.symbol=n.inputSymbol,w.value.instance.blur(),B()}function oe(){p.dispatch("tradingShare/initChart")}function le(e){e==="FIREANT"?Fe():(B(!0),ge())}function B(e=!1,a=null){if(!n.symbol)return!1;a||(a=de.value),l.value.source==="FIREANT"?K(e,a):ae(e,a)}function K(e=!1,a=null){if(t.websocket&&t.websocket.readyState===WebSocket.OPEN){const i=ke(a,"yyyy-MM-dd"),S=ke(new Date,"yyyy-MM-dd");let k=`{"arguments":["${n.symbol}","D","${i}","${S}"],"invocationId":"stock","target":"GetBars","type":1}`;t.websocket.send(k),e&&(k=`{"arguments":["${l.value.index}","D","${i}","${S}"],"invocationId":"index","target":"GetBars","type":1}`,t.websocket.send(k)),X()}}function ae(e=!1,a=null){p.dispatch("tradingShare/getChartData",{symbol:n.symbol,from:_e(a),withIndex:e}).then(i=>{e&&te(i),X()})}function X(){d.value.remove(),c.value.remove(),f.value.remove()}function ie(){fe()}function fe(e=!0){if(L.value)return!1;const a=M.value;let i=a.findIndex(k=>k===n.symbol);i=i+(e?1:-1),i<0?i=a.length-1:i>=a.length&&(i=0);const S=a[i];if(!S)return!1;n.inputSymbol=S,n.symbol=n.inputSymbol,B()}function Oe(){if(!n.symbol||n.symbol===l.value.index)return!1;const e=D();if(e.length<2)return Ye.warning(y("trading.share.filterTimeWarning"));x.value.check({symbol:n.symbol,filterTimes:e})}function Fe(){let e="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg";t.websocket=new WebSocket(e),t.websocket.onopen=()=>{console.log("Đã kết nối tới WebSocket server"),t.websocket.send('{"protocol":"json","version":1}'),B(!0)},t.websocket.onmessage=a=>{const i=Te(a.data);if(i.length==0)return!1;i.forEach(S=>{if(!S)return!1;if(S.type==3){const k=S.result.bars.map(({open:H,high:Z,low:j,close:Ne,date:Ee})=>{const Be=_e(new Date(Ee));return{open:H,high:Z,low:j,close:Ne,time:Be}});S.invocationId==="stock"?(p.dispatch("tradingShare/getTools",{symbol:n.symbol}),ee(k)):te(k)}else if(S.type==1&&S.target==="UpdateLastPrices"){const k=S.arguments[0],H=k.find(j=>j.symbol==l.value.index),Z=k.find(j=>j.symbol==n.symbol);H&&ne("index",H.last),Z&&ne("stock",Z.last)}})},t.websocket.onerror=a=>{console.error("Lỗi kết nối WebSocket:",a)},t.websocket.onclose=()=>{console.log("Đã đóng kết nối WebSocket")}}function ge(){t.websocket&&(t.websocket.readyState===WebSocket.OPEN&&t.websocket.close(),t.websocket=null)}function Te(e){let a=[];return e.split("").forEach(i=>{const S=i.indexOf("{"),k=i.lastIndexOf("}");let H=null;if(S!==-1&&k!==-1&&k>S){const Z=i.substring(S,k+1);if(Z!="{}")try{H=JSON.parse(Z)}catch(j){console.error("JSON parse error:",j)}}a.push(H)}),a}function Q(){c.value.hide()}function be(e){return C.fmtNum(n.series.stock.coordinateToPrice(e))}return(e,a)=>(re(),ce("div",{ref_key:"chartContainerRef",ref:m,class:"share-chart",onClick:U,onContextmenu:$},[R("div",{ref_key:"chartRef",ref:h},null,512),R("div",{class:"area data-area",onClick:u,onContextmenu:$},[R("div",bt,[V(He(gt.DxAutocomplete),{ref_key:"symbolAutocompleteRef",ref:w,"data-source":M.value,"show-clear-button":!0,openOnFieldClick:!0,minSearchLength:0,maxItemCount:100,modelValue:n.inputSymbol,"onUpdate:modelValue":a[0]||(a[0]=i=>n.inputSymbol=i),onChange:_,onItemClick:_},null,8,["data-source","modelValue"])]),Ze(R("div",{ref:"addWatchlistToolRef",class:Ce(["command far",{"fa-heart-circle-minus":T.value,"fa-heart-circle-plus":!T.value}]),title:e.$t("trading.share.changeWatchlist"),onClick:P,onContextmenu:ie},null,42,vt),[[je,g.value]]),R("div",{class:"command",title:e.$t("trading.share.reload"),onClick:a[1]||(a[1]=()=>B()),onContextmenu:a[2]||(a[2]=()=>B(!0))},[R("i",{class:Ce(["far fa-sync-alt",{"fa-spin":L.value}])},null,2)],40,St)],32),R("div",{class:"area tool-area",onClick:u,onContextmenu:$},[V(Ue,{ref_key:"fullscreenToolRef",ref:O,chartContainerRef:m.value},null,8,["chartContainerRef"]),V(Ge,{ref:"tradingviewToolRef",vpsUser:l.value.vpsUser,vpsSession:l.value.vpsSession,chartContainerRef:m.value,symbol:n.symbol,timeframe:"1D"},null,8,["vpsUser","vpsSession","chartContainerRef","symbol"]),V(nt,{ref_key:"filterTimeToolRef",ref:v,onHideContext:Q},null,512),V(it,{ref_key:"checkToolRef",ref:x,symbol:n.symbol,onCheckSymbol:Oe,onHideContext:Q},null,8,["symbol"]),V(ct,{ref_key:"reversalToolRef",ref:d,symbol:n.symbol,indexSeries:n.series.index,stockSeries:n.series.stock,onHideContext:Q},null,8,["symbol","indexSeries","stockSeries"]),V(Ke,{ref_key:"lineToolRef",ref:c,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,onHideContext:Q},null,8,["symbol","priceSeries"]),V(Xe,{ref_key:"targetToolRef",ref:f,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,levels:[1,2],isPercent:!0,onHideContext:Q},null,8,["symbol","priceSeries"])],32)],544))}};export{xt as default};
