import{u as O,r as g,a as z,c as I,x as F,n as u,f as m,_ as H,h as Q,k as h,v as G,l as _,o as c,e as d,d as t,t as o,g as w,b as K,P as S,q as p,p as R,s as X}from"./app-a4f5b4b4.js";import{_ as Z}from"./accordion-f3a41375.js";import{_ as J}from"./load-indicator-cdaf06db.js";const W={class:"caution"},Y={class:"step1"},ee={class:"description text-darker"},te={class:"method"},ae={class:"method1"},ne={key:0},oe={class:"method2"},se={class:"text-darker"},le={class:"upload"},ce={class:"upload-browser"},ie={for:"receiptImage"},re=t("i",{class:"far fa-file-upload"},null,-1),fe={__name:"PayingContractPopup",setup(ue,{expose:V}){const D=Q(),{t:f}=O(),q=h("bus"),B=h("mc"),$=h("mf"),i=g(null),y=g(null),k=g(null),a=z({formData:{},contract:{},qrSrc:null});let v=[];const C=I(()=>new Set(a.formData.documents.map(e=>e.file))),s=I(()=>D.state.userContract.transferInfo);F(()=>b());function T(e){i.value.setTitle(f(`components.payingContract.${e.status==0?"title":"changeReceiptTitle"}`)+" #"+e.code),a.contract=e,i.value.show()}function U(){let e=document.createElement("a");e.href=a.qrSrc,e.download=`vietQR_${a.contract.code}`,e.click()}function x(e){a.formData.documents=a.formData.documents.filter(n=>!n.isUpload),[...e.target.files].forEach(n=>a.formData.documents.push({file:URL.createObjectURL(n),isUpload:!0}))}function N(e){e.value?a.formData.documents=a.formData.documents.filter(n=>n.isUpload):a.formData.documents=v.concat(a.formData.documents)}function P(){a.formData.documents.findIndex(e=>e.isUpload)!=-1?k.value.click():G.show(f("messages.info.noUploadImage"))}function E(){q.emit("checkPin",async()=>{let e=new FormData;e.append("contractId",a.contract.id),e.append("isDelete",a.formData.isDelete);for(var n=0;n<receiptImageRef.value.files.length;n++){let l=await $.resizeImage({file:receiptImageRef.value.files[n],maxSize:B.MAX_SIZE_IMAGE_UPLOAD});e.append(`receiptImages[${n}]`,l)}D.dispatch("userContract/payingContract",e).then(l=>{l&&i.value.hide()})})}function b(){a.formData={isDelete:!1,documents:[]},a.qrSrc=null}function L(){setTimeout(()=>y.value.instance.option("selectedIndex",a.contract.status),0),v=a.contract.url_paid_docs.map(n=>({file:n,isUpload:!1})),a.formData.documents=v;let e=`https://img.vietqr.io/image/${s.value.bank_name}-${s.value.account_number}-KRnx1D.jpg?accountName=${s.value.account_name}&amount=${a.contract.principal}&addInfo=${f("models.contract.transfer.contentValue",[a.contract.code])}`;$.fetchImage(e).then(n=>a.qrSrc=n)}function M(){b()}return V({show:T}),(e,n)=>{const l=_("DxButton"),j=_("DxCheckBox"),A=_("DxScrollView");return c(),u(H,{ref_key:"popupRef",ref:i,class:"paying-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t(`components.payingContract.${a.contract.status==0?"paidButton":"changeReceiptButton"}`),onClick:P}}],onShown:L,onHidden:M},{default:m(()=>[d(A,null,{default:m(()=>[t("form",{onSubmit:X(E,["prevent"])},[t("button",{ref_key:"submitRef",ref:k,class:"display-none"},null,512),t("div",W,[t("div",null,o(e.$t("titles.caution"))+":",1),t("div",null,"  - "+o(e.$t("components.payingContract.paidDateCaution")),1),t("div",null,"  - "+o(e.$t("components.payingContract.timeCaution")),1)]),d(w(Z),{ref_key:"accordionRef",ref:y,collapsible:!0,items:[{title:e.$t("components.payingContract.step1"),template:"step1Template"},{title:e.$t("components.payingContract.step2"),template:"step2Template"}]},{step1Template:m(()=>[t("div",Y,[t("div",ee,o(e.$t("models.contract.transfer.qrCode")),1),t("div",te,[t("div",ae,[a.qrSrc?(c(),K("div",ne,[d(S,{images:[a.qrSrc]},null,8,["images"]),d(l,{class:"download-qr",text:e.$t("buttons.qrDownload"),icon:"download",type:"default","styling-mode":"text",onClick:U},null,8,["text"])])):(c(),u(w(J),{key:1,height:40,width:40}))]),t("div",oe,[t("div",null,[t("span",null,o(e.$t("models.user.bankName"))+":",1),t("span",null,o(s.value.bank_name),1)]),t("div",null,[t("span",null,o(e.$t("models.user.accountName"))+":",1),t("span",null,o(s.value.account_name),1)]),t("div",null,[t("span",null,o(e.$t("models.user.accountNumber"))+":",1),t("span",null,[p(o(s.value.account_number)+" ",1),t("i",{class:"far fa-copy",onClick:n[0]||(n[0]=r=>e.$mf.copyText(s.value.account_number))})])]),t("div",null,[t("span",null,o(e.$t("models.contract.transfer.amount"))+":",1),t("span",null,[p(o(e.$filters.currency(a.contract.principal))+" ",1),t("i",{class:"far fa-copy",onClick:n[1]||(n[1]=r=>e.$mf.copyText(a.contract.principal))})])]),t("div",null,[t("span",null,o(e.$t("models.contract.transfer.content"))+":",1),t("span",null,[p(o(e.$t("models.contract.transfer.contentValue",[a.contract.code]))+" ",1),t("i",{class:"far fa-copy",onClick:n[2]||(n[2]=r=>e.$mf.copyText(e.$t("models.contract.transfer.contentValue",[a.contract.code])))})])]),t("div",se,o(e.$t("models.contract.transfer.note")),1)])])])]),step2Template:m(()=>[t("div",le,[t("div",ce,[t("input",{ref:"receiptImageRef",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:x},null,544),t("label",ie,[re,p(" "+o(e.$t("titles.chooseImage")),1)]),a.contract.status==1?(c(),u(j,{key:0,id:"contractDelete",modelValue:a.formData.isDelete,"onUpdate:modelValue":n[3]||(n[3]=r=>a.formData.isDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:N},null,8,["modelValue","text"])):R("",!0)]),C.value.length?(c(),u(S,{key:0,images:C.value},null,8,["images"])):R("",!0)])]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["toolbarItems"])}}};export{fe as default};
