import{z as at,A as ct,B as lt,r as B,y as We,C as Ge,o as H,b as J,d as F,E as ae,c as ce,G as Te,H as _e,I as pt,J as dt,F as Me,K as Ve,t as ye,h as me,u as Oe,e as ne,L as ut,M as ft,N as je,O as Ke,g as et,k as fe,w as ve,Q as mt,m as vt,R as ht,S as qe,x as se,l as Le,a as gt,T as St,U as yt,j as Tt,V as xt}from"./app-4d673600.js";import{_ as Ct}from"./text-box-d4d26061.js";import{g as G}from"./getUnixTime-7c9db96c.js";import{c as kt}from"./lightweight-charts.esm.development-03366bac.js";function tt(P,A,T){return at((T==null?void 0:T.in)||P,+ct(P)+A)}function ke(P,A,T){return tt(P,A*lt,T)}function _t(P,A,T){return tt(P,A*1e3,T)}function bt(P,A,T){return _t(P,-A,T)}const wt=["title"],Dt={__name:"FullscreenTool",props:["chartContainerRef"],setup(P){const A=P,T=B(!1);We(()=>{document.addEventListener("fullscreenchange",t)}),Ge(()=>{document.removeEventListener("fullscreenchange",t)});function f(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function t(){A.chartContainerRef&&(document.fullscreenElement?(T.value=!0,A.chartContainerRef.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(T.value=!1,A.chartContainerRef.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}return(r,y)=>(H(),J("div",{class:"command",title:r.$t("trading.derivative.fullscreen"),onClick:f},[F("i",{class:ae(["far",{"fa-compress":T.value,"fa-expand":!T.value}])},null,2)],8,wt))}},Rt=["title"],Et=["src"],Lt={__name:"TradingviewTool",props:["vpsUser","vpsSession","chartContainerRef"],setup(P){const A=P,T=B(null),f=B(!1),t=ce(()=>`https://chart.vps.com.vn/tv/?u=${A.vpsUser}&s=${A.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);function r(x){f.value=!f.value,y(),x.stopPropagation()}function y(){if(A.chartContainerRef&&T.value){const{offsetWidth:x,offsetHeight:I}=A.chartContainerRef,{top:d,left:h}=T.value.getBoundingClientRect();T.value.style.top=`${d-2}px`,T.value.style.left=`${h+32}px`,T.value.style.width=`${x-34}px`,T.value.style.height=`${I}px`}}return(x,I)=>(H(),J("div",{class:"tradingview command far fa-chart-candlestick",title:x.$t("trading.derivative.tradingview"),onClick:r},[Te(F("iframe",{ref_key:"tradingviewRef",ref:T,class:"chart",src:t.value},null,8,Et),[[_e,f.value]])],8,Rt))}};const Ot=F("div",{class:"triangle-shadow"},null,-1),Pt=F("div",{class:"triangle"},null,-1),$t={class:"container"},It={__name:"ProgressContext",props:["progress"],setup(P){const A=B([]);We(()=>{T()});function T(){pt(Object.assign({"../../../../../lang/vi/derivative.js":()=>dt(()=>import("./derivative-7a854992.js"),[])}),`../../../../../lang/${window.lang}/derivative.js`).then(t=>{A.value=t.default||[]})}function f(t){t.stopPropagation()}return(t,r)=>(H(),J("div",{class:"pattern-context",onClick:f},[Ot,Pt,F("div",$t,[(H(!0),J(Me,null,Ve(A.value,(y,x)=>(H(),J("div",{key:x,class:ae(["step",[P.progress.step&&P.progress.step===x+1?P.progress.result?"success":"fail":""]])},[F("div",{class:ae(["name",[P.progress.steps?P.progress.steps[x].every(Boolean)?"success":"fail":""]])},ye(x+1)+". "+ye(y.name),3),F("div",null,[(H(!0),J(Me,null,Ve(y.conds,(I,d)=>(H(),J("div",{key:d,class:ae(["condition",[P.progress.steps?P.progress.steps[x][d]?"success":"fail":""]])},ye(d+1)+". "+ye(I),3))),128))])],2))),128))])]))}},At=["title"],Nt={__name:"ProgressTool",emits:["refreshPattern","hideContext"],setup(P,{expose:A,emit:T}){const f=me(),{t}=Oe(),r=T,y=B({}),x=B(!1),I=ce(()=>f.state.tradingDerivative.config.autoRefresh);A({hide:h,set:u});function d(){const R=x.value;r("hideContext"),x.value=!R,x.value&&r("refreshPattern")}function h(R){x.value=R}function u(R){W(R,y.value),y.value=R}function V(R){const w=R??!w.value;f.dispatch("tradingDerivative/setAutoRefresh",w)}function W(R,w){if(I.value&&(R.step>w.step||R.step===w.step&&R.result>w.result)){let g="";R.result?[2,4].includes(R.step)?g=t("trading.derivative.progressOrder",R):g=t("trading.derivative.progressSuccess",R):g=t("trading.derivative.progressFail",R),Z(g)}}function Z(R){const w=new SpeechSynthesisUtterance(R);w.lang="vi-VN",speechSynthesis.speak(w)}return(R,w)=>(H(),J("div",{class:ae(["context command",{green:y.value.result===!0,red:y.value.result===!1}]),title:R.$t("trading.derivative.progressTool"),onClick:d,onContextmenu:V},[F("i",{class:ae(["far",{"fa-badge-check":!y.value.step,[`fa-circle-${y.value.step}`]:y.value.step,blink:I.value}])},null,2),Te(ne(It,{class:"contextmenu",progress:y.value},null,8,["progress"]),[[_e,x.value]])],42,At))}};var xe={};const Bt=ut(ft);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Ft=je&&je.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(xe,"__esModule",{value:!0});xe.DxItem=xe.DxButtonGroup=void 0;var Mt=Ft(Bt),Vt=Ke,Wt=Ke,it=Vt.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttonTemplate:{},disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,items:Array,keyExpr:[Function,String],onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onOptionChanged:Function,onSelectionChanged:Function,rtlEnabled:Boolean,selectedItemKeys:Array,selectedItems:Array,selectionMode:String,stylingMode:String,tabIndex:Number,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttonTemplate":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:items":null,"update:keyExpr":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onOptionChanged":null,"update:onSelectionChanged":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectedItems":null,"update:selectionMode":null,"update:stylingMode":null,"update:tabIndex":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Mt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}}}});xe.DxButtonGroup=it;var Ze=Wt.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:elementAttr":null,"update:hint":null,"update:html":null,"update:icon":null,"update:template":null,"update:text":null,"update:type":null,"update:visible":null},props:{disabled:Boolean,elementAttr:Object,hint:String,html:String,icon:String,template:{},text:String,type:String,visible:Boolean}});xe.DxItem=Ze;Ze.$_optionName="items";Ze.$_isCollectionItem=!0;var Zt=xe.default=it;const Yt=F("div",{class:"triangle-shadow"},null,-1),zt=F("div",{class:"triangle"},null,-1),Ht={__name:"ScanContext",props:["modelValue"],emits:["update:modelValue"],setup(P,{emit:A}){const{t:T}=Oe(),f=[{icon:"chevrondoubleleft",side:"left",text:T("trading.derivative.scanContext.leftScan")},{icon:"chevrondoubleright",side:"right",text:T("trading.derivative.scanContext.rightScan")}],t=P,r=A;function y({itemData:{side:I}}){r("update:modelValue",I)}function x(I){I.stopPropagation()}return(I,d)=>(H(),J("div",{class:"scan-context",onClick:x},[Yt,zt,ne(et(Zt),{items:f,"selected-item-keys":[t.modelValue],"key-expr":"side","styling-mode":"outlined",onItemClick:y},null,8,["selected-item-keys"])]))}},Jt=["title"],Xt={__name:"ScanTool",props:["prices","timeToIndex"],emits:["scaned","removePattern","hideContext"],setup(P,{expose:A,emit:T}){const f=fe("mf"),t=P,r=T,y=B(null),x=B(!1),I=B("left");A({isSelected:d,hide:h,draw:W});function d(){return y.value.classList.contains("selected")}function h(g){x.value=g}function u(g){r("hideContext");const l=g.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(S=>S.classList.remove("selected")),l||(g.target.classList.add("selected"),r("removePattern"))}function V(){const g=x.value;r("hideContext"),x.value=!g}function W({time:g}){const l=I.value==="left",S=g?t.prices.filter(a=>!f.cmp(a.time,l,g)):t.prices;let i=l?Z(S):R(S);f.isSet(i)&&r("scaned",w(i)),y.value.classList.remove("selected")}function Z(g){let l,[S,i,a,v]=Array(4).fill({});for(let m=g.length-1;m>=0;m--){const _=g[m].value,C=g[m].time,e=t.timeToIndex(C);if(e===-1)break;if(m===g.length-1&&(a={index:e,time:C,price:_},[i,S,v]=Array(3).fill(null).map(()=>f.cloneDeep(a))),l===void 0){if(_===a.price)continue;l=_>a.price}if(f.cmp(_,l,i.price)&&(f.cmp(S.price,!l,a.price)?([a,i]=[i,S].map(p=>f.cloneDeep(p)),S={index:e,time:C,price:_},v=f.cloneDeep(S),l=!l):i={index:e,time:C,price:_}),f.cmp(_,!l,S.price)?(S={index:e,time:C,price:_},v=f.cloneDeep(S)):v.index=e,f.cmp(_,l,v.price)&&(v={index:e,time:C,price:_}),a.index>S.index){const p=f.fmtNum(i.price-a.price,1,!0);if(p>=1.5&&(S.index-v.index>a.index-i.index||f.fmtNum(S.price-v.price,1,!0)>p))break}}return{A:S,B:i,C:a}}function R(g){let l,[S,i,a]=Array(3).fill({});for(let v=0;v<g.length;v++){const m=g[v].value,_=g[v].time,C=t.timeToIndex(_);if(C===-1)break;if(v===0&&(S={index:C,time:_,price:m},i=f.cloneDeep(S),a=f.cloneDeep(S)),l===void 0){if(m===S.price)continue;l=m>S.price}f.cmp(m,l,i.price)&&(i={index:C,time:_,price:m},a=f.cloneDeep(i)),f.cmp(i.price,l,S.price)&&f.cmp(m,!l,a.price)&&(f.cmp(m,l,S.price)?a={index:C,time:_,price:m}:(S=f.cloneDeep(i),i={index:C,time:_,price:m},a=f.cloneDeep(i),l=!l))}return{A:S,B:i,C:a}}function w(g){const l={};return Object.entries(g).forEach(([S,i])=>{const{index:a,...v}=i;l[S]=v}),l}return(g,l)=>(H(),J("div",{ref_key:"scanToolRef",ref:y,class:"context command",title:g.$t("trading.derivative.scanTool"),onClick:u,onContextmenu:V},[F("i",{class:ae(["far",{[`fa-angles-${I.value}`]:!0}])},null,2),Te(ne(Ht,{class:"contextmenu",modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=S=>I.value=S)},null,8,["modelValue"]),[[_e,x.value]])],40,Jt))}},jt=["title"],qt=F("i",{class:"far fa-heart-rate"},null,-1),Ut=[qt],Qt={__name:"PatternTool",props:["prices","priceSeries","timeMarkSeries","pickTimeToolRef","timeToIndex","indexToTime"],emits:["setProgress","hideContext"],setup(P,{expose:A,emit:T}){const f=me(),t=fe("mf"),r=P,y=T,x=B(null),I=ce(()=>f.state.tradingDerivative.tools.pattern);let d={},h={};A({isSelected:u,draw:Z,load:R,refresh:g,remove:_,drag:p}),ve(I,o=>{o&&R(o,{isCheck:!0})});function u(){return x.value.classList.contains("selected")}function V(o){y("hideContext");const n=o.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(k=>k.classList.remove("selected")),n||(o.target.classList.add("selected"),r.pickTimeToolRef.remove())}function W(o){o.target.classList.remove("selected"),_()}function Z({time:o,price:n}){let c={lineType:"pattern",price:n,lineWidth:1,lineStyle:1,draggable:!0};if(t.isSet(h.A))if(t.isSet(h.B)){let N,E;if(t.isSet(h.C)){let L,b;d.A={time:o,price:n};const{progress:$,timeMark:M,info:{rEpr1:X,rEpr2:q,rEpr3:re,entry:ee,pStatus:te,x:ie,X:U,y:Q,Y}}=l();E=$,N=M,L="A",b={price:n,title:`A ${X}`},h[L].applyOptions(b),L="B",b={title:`B ${q}`},h[L].applyOptions(b),L="C",b={title:`C ${re}`},h[L].applyOptions(b),L="D",b={price:ee,title:"Entry "+te},h[L].applyOptions(b),L="X",b={price:t.fmtNum(ie),title:`X ${t.fmtNum(U)}`},h[L].applyOptions(b),L="Y",b={price:t.fmtNum(Q),title:`Y ${t.fmtNum(Y)}`},h[L].applyOptions(b)}else{d.C={price:n};const{progress:L,timeMark:b,info:{rEpr1:$,rEpr2:M,rEpr3:X,entry:q,pStatus:re,x:ee,X:te,y:ie,Y:U}}=l();E=L,N=b;let Q="A";h[Q].applyOptions({title:`A ${$}`}),Q="B",h[Q].applyOptions({title:`B ${M}`}),c.point="C",c.title=`C ${X}`,c.color="#FFEB3B",h[c.point]=r.priceSeries.createPriceLine(c),c.point="D",c.price=q,c.title="Entry "+re,c.color="#9C27B0",c.draggable=!1,h[c.point]=r.priceSeries.createPriceLine(c),c.point="Y",c.price=t.fmtNum(ie),c.title=`Y ${t.fmtNum(U)}`,c.color="#E91E63",c.draggable=!1,h[c.point]=r.priceSeries.createPriceLine(c),c.point="X",c.price=t.fmtNum(ee),c.title=`X ${t.fmtNum(te)}`,c.color="#2196F3",c.draggable=!1,h[c.point]=r.priceSeries.createPriceLine(c)}m(),y("setProgress",E),e(N),x.value.classList.remove("selected")}else c.point="B",c.title="B 0",c.color="#4CAF50",h[c.point]=r.priceSeries.createPriceLine(c),d.B={price:n};else c.point="A",c.title="A 0",c.color="#F44336",h[c.point]=r.priceSeries.createPriceLine(c),d={A:{time:o,price:n}}}function R(o,{isSave:n=!1,isCheck:k=!1}){d=t.cloneDeep(o),n&&m(),(k?i(d):!0)&&(C(),w())}function w(){let n={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{A:k,B:c,C:N}=d,{progress:E,timeMark:L,info:{rEpr1:b,rEpr2:$,rEpr3:M,entry:X,pStatus:q,x:re,X:ee,y:te,Y:ie}}=l();y("setProgress",E),e(L),n.point="A",n.title=`A ${b}`,n.color="#F44336",n.price=k.price,h[n.point]=r.priceSeries.createPriceLine(n),n.point="B",n.title=`B ${$}`,n.color="#4CAF50",n.price=c.price,h[n.point]=r.priceSeries.createPriceLine(n),n.point="C",n.price=N.price,n.title=`C ${M}`,n.color="#FFEB3B",h[n.point]=r.priceSeries.createPriceLine(n),n.point="D",n.price=X,n.title="Entry "+q,n.color="#9C27B0",n.draggable=!1,h[n.point]=r.priceSeries.createPriceLine(n),n.point="Y",n.price=t.fmtNum(te),n.title=`Y ${t.fmtNum(ie)}`,n.color="#E91E63",n.draggable=!1,h[n.point]=r.priceSeries.createPriceLine(n),n.point="X",n.price=t.fmtNum(re),n.title=`X ${t.fmtNum(ee)}`,n.color="#2196F3",n.draggable=!1,h[n.point]=r.priceSeries.createPriceLine(n)}function g(o=!1){t.isSet(h.C)&&(o&&v(),C(),w())}function l(){const{A:o,B:n,C:k}=d,c=n.price-k.price,N=c>0,E=S({phase:1,start:o,end:n,retracementPrice:k.price});let L=S({phase:2,start:E.R,end:k});const b=S({phase:3,start:L.R,end:{price:n.price+(N?1:-1)*E.rEp},breakPrices:[L.S1.price,n.price]});E.xBox.tr>=L.tr&&(L.tr=E.xBox.tr),console.log("calculatePattern",[E,L,b]);const $=t.fmtNum(c,1,!0)>=E.pr,M=t.fmtNum(k.price-b.xBox.R.price,1,!0)>=L.pr,X=t.fmtNum(b.xBox.pr)>=b.pr,q=!t.cmp(k.price,!N,E.S1.price),re=!t.cmp(b.xBox.R.price,N,L.S1.price),ee=!t.cmp(b.xBox.S.price,!N,b.S1.price),te=E.R.index+E.tr,ie=E.R.index+5*E.tr,U=L.R.index+L.tr,Q=b.xBox.R.index+b.tr,Y=b.xBox.R.index+5*b.tr,oe=b.xBox.R.index+L.tr,Pe=[te,ie,U,Q,Y,oe],le=b.xBox.S.index;let he,j={};const Ce=[L.R.index>te,E.rEpr<3,L.rEpr<E.rEpr];j.steps=[[$||E.rEt<E.tr&&E.rEp>=E.sEp,q,!b.breakIndexs[1]||te<b.breakIndexs[1],le>te,le<ie],[...Ce,U>te,le<Y,le<U],[L.R.index-E.R.index>.5*E.tr,M,le>U],[X,ee,le>Q,Ce.every(Boolean)||le>oe]],j.step=1,j.result=j.steps[0].every(Boolean),he=E.R1.price,j.result&&(le<=U?(j.step=2,j.result=j.steps[1].every(Boolean),he=L.S1.price):(j.step=3,j.result=j.steps[2].every(Boolean),he=b.R1.price,j.result&&(j.step=4,j.result=j.steps[3].every(Boolean),j.result&&(he=b.xBox.R.price))));const $e=`${q?$?1:0:2}${re?M?1:0:2}${ee?X?1:0:2}`,ge=E.rEp,Ie=a(n.price,ge,N),Ae=b.breakIndexs[1]??le,be=parseInt((Ae-E.R.index)/E.tr),we=be>1?ge*be:ge,Ne=a(n.price,we,N);return{progress:j,timeMark:Pe,info:{rEpr1:E.rEpr,rEpr2:L.rEpr,rEpr3:b.rEpr,entry:he,pStatus:$e,x:Ie,X:ge,y:Ne,Y:we}}}function S({phase:o,start:n,end:k,breakPrices:c,retracementPrice:N}){let E=t.cloneDeep(n),L=t.cloneDeep(k);const b=L.price>E.price;let $={},M={},X={},q=[null,null],re,ee,te;const ie=r.pickTimeToolRef.get();return r.prices.filter(U=>{let Q=U.time>=E.time;return ie&&(Q&=U.time<=ie),Q}).every((U,Q)=>{const Y=U.value,oe=r.timeToIndex(U.time);return oe===-1?!1:((Q===0||Y===E.price)&&($={R:{index:oe,price:Y},S:{index:oe,price:Y},pr:0,tr:0},M=t.cloneDeep($),X=t.cloneDeep($)),t.cmp(Y,b,$.R.price)?($.pr>=M.pr&&(M.pr=$.pr,M.R=t.cloneDeep($.R),M.S=t.cloneDeep($.S)),$.tr>M.tr&&(M.tr=$.tr),o===1&&N&&!t.cmp($.S.price,!b,N)&&$.tr>=X.tr&&$.pr>=X.pr&&(X=t.cloneDeep($)),$={R:{index:oe,price:Y},S:{index:oe,price:Y},pr:0,tr:0},o===3&&c&&(!q[0]&&t.cmp(Y,b,c[0])&&(q[0]=oe),!q[1]&&t.cmp(Y,b,c[1])&&(q[1]=oe))):($.S.index=oe,$.tr=$.S.index-$.R.index,t.cmp(Y,!b,$.S.price)&&($.S.price=Y,$.pr=t.fmtNum($.S.price-$.R.price,1,!0))),t.cmp(Y,!b,E.price)?($.S.price=E.price,!1):!!t.cmp(Y,!b,L.price))}),t.isSet($)&&(E.index=r.timeToIndex(E.time),L.index=$.S.index,L.time=r.indexToTime($.S.index),re=t.fmtNum(L.price-M.R.price,1,!0),ee=t.fmtNum(E.price-M.S.price,1,!0),te=L.index-M.S.index,o===3&&(X=$)),{tr:M.tr,pr:M.pr,rEp:re,sEp:ee,rEpr:M.pr?t.fmtNum(re/M.pr):0,rEt:te,S1:M.S,R1:M.R,xBox:X,S:E,R:L,breakIndexs:q}}function i({A:{time:o}}){return o>=r.prices[0].time&&o<r.prices.at(-1).time}function a(o,n,k){const c=o+(k?1:-1)*n;let N=t.fmtNum(c%1);if(k){if(N>=.1&&N<=.2)return Math.floor(c);if(N>=.6&&N<=.7)return Math.floor(c)+.5}else{if(N>=.8&&N<=.9)return Math.ceil(c);if(N>=.3&&N<=.4)return Math.floor(c)+.5}return c}function v(){if(!r.pickTime)return!1;const o=d.B.price-d.A.price>0,n=r.prices.at(-1).value;if(t.cmp(n,!o,d.C.price)){let k=n;for(let c=r.prices.length-1;c>=0;c--){const N=r.prices[c].value;if(N===d.B.price)break;k=o?Math.min(k,N):Math.max(k,N)}d.C.price=k,m()}}function m(o=!1){let n={isRemove:o,name:"pattern",points:[],data:[]};o?d={}:Object.entries(d).forEach(([k,c])=>{n.points.push(k),n.data.push(c)}),f.dispatch("tradingDerivative/drawTools",n)}function _(){m(!0),r.pickTimeToolRef.remove(),C(),y("setProgress",{})}function C(){t.isSet(h.A)&&(r.priceSeries.removePriceLine(h.A),t.isSet(h.B)&&(r.priceSeries.removePriceLine(h.B),t.isSet(h.C)&&(r.priceSeries.removePriceLine(h.C),r.priceSeries.removePriceLine(h.D),r.priceSeries.removePriceLine(h.X),r.priceSeries.removePriceLine(h.Y)))),h={},e([])}function e(o){const n=["#F44336","#F44336","#4CAF50","#FFEB3B","#FFEB3B","#2196F3"];let k=[];for(let c=0;c<o.length;c++){let N=r.indexToTime(o[c]);N&&(o.indexOf(o[c])!==o.lastIndexOf(o[c])&&(N+=c),k.push({time:N,value:1,color:n[c]}))}k.length&&k.sort((c,N)=>c.time-N.time),r.timeMarkSeries.setData(k)}function p({lineOptions:o}){if(t.isSet(h.C)){let n,k;d={A:{time:d.A.time,price:+h.A.options().price},B:{price:+h.B.options().price},C:{price:+h.C.options().price}},m();const{progress:c,timeMark:N,info:{rEpr1:E,rEpr2:L,rEpr3:b,entry:$,pStatus:M,x:X,X:q,y:re,Y:ee}}=l();y("setProgress",c),e(N),n="A",k={title:`A ${E}`},h[n].applyOptions(k),n="B",k={title:`B ${L}`},h[n].applyOptions(k),n="C",k={title:`C ${b}`},h[n].applyOptions(k),n="D",k={price:$,title:"Entry "+M},o.point===n&&delete k.price,h[n].applyOptions(k),n="X",k={price:t.fmtNum(X),title:`X ${t.fmtNum(q)}`},h[n].applyOptions(k),n="Y",k={price:t.fmtNum(re),title:`Y ${t.fmtNum(ee)}`},h[n].applyOptions(k)}}return(o,n)=>(H(),J("div",{ref_key:"patternToolRef",ref:x,class:"command",title:o.$t("trading.derivative.patternTool"),onClick:V,onContextmenu:W},Ut,40,jt))}},Gt=["title"],Kt=F("i",{class:"far fa-pipe"},null,-1),ei=[Kt],ti={__name:"PickTimeTool",props:["pickTimeSeries"],emits:["refreshPattern","hideContext"],setup(P,{expose:A,emit:T}){const f=me(),t=P,r=T,y=B(null),x=ce(()=>f.state.tradingDerivative.tools.pickTime);let I=null;A({isSelected:d,draw:W,remove:R,get:h}),ve(x,w=>{w&&Z(w[0])});function d(){return y.value.classList.contains("selected")}function h(){return I}function u(w){r("hideContext");const g=w.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(l=>l.classList.remove("selected")),g||w.target.classList.add("selected")}function V(w){w.target.classList.remove("selected"),R(),r("refreshPattern")}function W({time:w}){f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"pickTime",points:[0],data:[w]}),Z(w),r("refreshPattern"),y.value.classList.remove("selected")}function Z(w){I=w,t.pickTimeSeries.setData([{time:w,value:1,color:"#9C27B0"}])}function R(w=!0){w&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"pickTime"}),t.pickTimeSeries.setData([]),I=null}return(w,g)=>(H(),J("div",{ref_key:"pickTimeToolRef",ref:y,class:"command",title:w.$t("trading.derivative.pickTimeTool"),onClick:u,onContextmenu:V},ei,40,Gt))}};const ii=F("div",{class:"triangle-shadow"},null,-1),ni=F("div",{class:"triangle"},null,-1),ri={class:"input"},si={class:"color"},oi=["onClick"],ai={__name:"LineContext",props:["enable","title","color"],emits:["update:title","update:color"],setup(P,{emit:A}){const T=P,f=A,t=B(null),r=B(["#F44336","#FF9800","#FFEB3B","#4CAF50","#009688","#00BCD4","#2196F3","#673AB7","#9C27B0","#E91E63"]);ve(()=>T.enable,h=>{h&&mt().then(()=>t.value.instance.focus())});function y({value:h}){f("update:title",h)}function x(h){f("update:color",h)}function I(){f("deleteAllLine")}function d(h){h.stopPropagation()}return(h,u)=>{const V=vt("DxButton");return H(),J("div",{class:"line-context",onClick:d},[ii,ni,F("div",ri,[ne(et(Ct),{ref_key:"titleRef",ref:t,value:T.title,"show-clear-button":!0,"input-attr":{style:`color:${T.color}`},onValueChanged:y},null,8,["value","input-attr"]),ne(V,{icon:"trash",type:"danger",onClick:u[0]||(u[0]=W=>I())})]),F("div",si,[(H(!0),J(Me,null,Ve(r.value,(W,Z)=>(H(),J("div",{class:"color-swatch",style:ht({background:W,boxShadow:`0 0 4px ${W}`}),key:Z,onClick:R=>x(W)},null,12,oi))),128))])])}}},ci=["title"],li=F("i",{class:"far fa-horizontal-rule"},null,-1),pi={__name:"LineTool",props:["priceSeries"],emits:["hideContext"],setup(P,{expose:A,emit:T}){const f=me(),t=P,r=T,y=B(null),x=B(!1),I=ce(()=>f.state.tradingDerivative.tools.line),d=B(""),h=B("#F44336");let u=[];A({isSelected:V,hide:W,draw:w,drag:i}),ve(I,a=>{a&&g(a)});function V(){return y.value.classList.contains("selected")}function W(a){x.value=a}function Z(a){r("hideContext");const v=a.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(m=>m.classList.remove("selected")),v||a.target.classList.add("selected")}function R(a){const v=x.value;r("hideContext"),x.value=!v}function w({price:a}){const v="line",m=u.length;if(u=u.filter(_=>{const C=_.options(),e=C.type=a===+C.price;return e&&(t.priceSeries.removePriceLine(_),f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:v,point:a})),!e}),u.length===m){const _=h.value,C=d.value,e={lineType:v,price:a,color:_,title:C,lineWidth:1,lineStyle:1,draggable:!0};u.push(t.priceSeries.createPriceLine(e)),f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:v,points:[a],data:[{color:_,title:C}]})}y.value.classList.remove("selected")}function g(a){S(!1),l(a)}function l(a){const m={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(a).forEach(([_,{color:C,title:e}])=>{m.price=+_,m.color=C,m.title=e,u.push(t.priceSeries.createPriceLine(m))})}function S(a=!0){u.length>0&&(a&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),u.forEach(v=>t.priceSeries.removePriceLine(v)),u=[])}function i({lineOptions:a,oldPrice:v,newPrice:m}){f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:v});const _=a.color,C=a.title;f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[m],data:[{color:_,title:C}]}),y.value.classList.remove("selected")}return(a,v)=>(H(),J("div",{ref_key:"lineToolRef",ref:y,class:"context command",title:a.$t("trading.derivative.lineTool"),onClick:Z,onContextmenu:R},[li,Te(ne(ai,{class:"contextmenu",enable:x.value,title:d.value,"onUpdate:title":v[0]||(v[0]=m=>d.value=m),color:h.value,"onUpdate:color":v[1]||(v[1]=m=>h.value=m),onDeleteAllLine:S},null,8,["enable","title","color"]),[[_e,x.value]])],40,ci))}},di=["title"],ui=F("i",{class:"far fa-grip-lines-vertical"},null,-1),fi=[ui],mi={__name:"TimeRangeTool",props:["timeRangeSeries","timeToIndex","indexToTime"],emits:["hideContext"],setup(P,{expose:A,emit:T}){const f=me(),t=fe("mf"),r=P,y=T,x=B(null),I=ce(()=>f.state.tradingDerivative.tools.timeRange);let d=[];A({isSelected:h,draw:W}),ve(I,g=>{g&&Z(g)});function h(){return x.value.classList.contains("selected")}function u(g){y("hideContext");const l=g.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(S=>S.classList.remove("selected")),l||g.target.classList.add("selected")}function V(g){w(),g.target.classList.remove("selected")}function W({time:g}){let l={isRemove:!1,name:"timeRange",points:[],data:[]},S={time:g,value:1};switch(d.length){case 0:S.color="OrangeRed",d[0]=S,l.points.push(0),l.data.push(g);break;case 1:S.color="lime",d[1]=S,l.points.push(1),l.data.push(g),x.value.classList.remove("selected");break;default:const i=r.timeToIndex(d[0].time),a=r.timeToIndex(d[1].time),m=r.timeToIndex(g)+(a-i),_=r.indexToTime(m);S.color="OrangeRed",d[0]=t.cloneDeep(S),l.points.push(0),l.data.push(g),S.time=_,S.color="lime",d[1]=S,l.points.push(1),l.data.push(_),x.value.classList.remove("selected");break}r.timeRangeSeries.setData(d),f.dispatch("tradingDerivative/drawTools",l)}function Z(g){w(!1),R(g)}function R(g){let l,S;if(g.length===2)l=g[0],S=g[1];else if(g.length===3){const a=r.timeToIndex(g[0]),v=r.timeToIndex(g[1]),_=r.timeToIndex(g[2])+(v-a);l=g[2],S=r.indexToTime(_)}else return!1;let i=[{time:l,value:1,color:"OrangeRed"},{time:S,value:1,color:"lime"}];d=i,r.timeRangeSeries.setData(i)}function w(g=!0){g&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"timeRange"}),r.timeRangeSeries.setData([]),d=[]}return(g,l)=>(H(),J("div",{ref_key:"timeRangeToolRef",ref:x,class:"command",title:g.$t("trading.derivative.timeRangeTool"),onClick:u,onContextmenu:V},fi,40,di))}},vi=["title"],hi=F("i",{class:"far fa-line-height"},null,-1),gi=[hi],Si={__name:"TargetTool",props:["priceSeries"],emits:["hideContext"],setup(P,{expose:A,emit:T}){const f=me(),t=fe("mf"),r=P,y=T,x=B(null),I=ce(()=>f.state.tradingDerivative.tools.target);let d={};A({isSelected:h,draw:W,drag:g}),ve(I,l=>{l&&Z(l)});function h(){return x.value.classList.contains("selected")}function u(l){y("hideContext");const S=l.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),S||(l.target.classList.add("selected"),w())}function V(l){w(),l.target.classList.remove("selected")}function W({price:l}){const S="target";let i={lineType:S,price:l,lineWidth:1,lineStyle:1,draggable:!0},a={isRemove:!1,name:S,points:[],data:[l]};if(t.isSet(d.A)){const v=+d.A.options().price,m=l-v;i.point="B",i.title=t.fmtNum(m),i.color="#F44336",d[i.point]=r.priceSeries.createPriceLine(i),a.points.push(i.point),i.point="X",i.price=t.fmtNum(v-.5*m),i.title=t.fmtNum(-.5*m),i.color="#2196F3",d[i.point]=r.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(v-m),i.title=t.fmtNum(-m),i.color="#673AB7",d[i.point]=r.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(v-2*m),i.title=t.fmtNum(-2*m),i.color="#9C27B0",d[i.point]=r.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(v-4*m),i.title=t.fmtNum(-4*m),i.color="#E91E63",d[i.point]=r.priceSeries.createPriceLine(i),x.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",d[i.point]=r.priceSeries.createPriceLine(i),a.points.push(i.point);f.dispatch("tradingDerivative/drawTools",a)}function Z(l){w(!1),R(l)}function R(l){let i={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const a=l.A,v=l.B,m=v-a;i.point="A",i.price=a,i.title="0",i.color="#FF9800",d[i.point]=r.priceSeries.createPriceLine(i),i.point="B",i.price=v,i.title=t.fmtNum(m),i.color="#F44336",d[i.point]=r.priceSeries.createPriceLine(i),i.point="X",i.price=t.fmtNum(a-.5*m),i.title=t.fmtNum(-.5*m),i.color="#2196F3",d[i.point]=r.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(a-m),i.title=t.fmtNum(-m),i.color="#673AB7",d[i.point]=r.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(a-2*m),i.title=t.fmtNum(-2*m),i.color="#9C27B0",d[i.point]=r.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(a-4*m),i.title=t.fmtNum(-4*m),i.color="#E91E63",d[i.point]=r.priceSeries.createPriceLine(i)}function w(l=!0){l&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),t.isSet(d.A)&&(r.priceSeries.removePriceLine(d.A),t.isSet(d.B)&&(r.priceSeries.removePriceLine(d.B),r.priceSeries.removePriceLine(d.X),r.priceSeries.removePriceLine(d.Y),r.priceSeries.removePriceLine(d.Z),r.priceSeries.removePriceLine(d.W))),d={}}function g({lineOptions:l,newPrice:S}){if(t.isSet(d.B)){let i={isRemove:!1,name:"target",points:[],data:[]},a,v,m=+d.A.options().price,_=+d.B.options().price,C=_-m;if(a="A",l.point==="A")C=+d.B.options().title,_=m+C;else if(l.point!=="B"){let e=0;switch(l.point){case"X":e=1.5;break;case"Y":e=2;break;case"Z":e=3;break;case"W":e=5;break}C=t.fmtNum((_-S)/e),m=_-C,v={price:m},d[a].applyOptions(v)}i.points.push(a),i.data.push(m),a="B",v={price:_,title:t.fmtNum(C)},l.point===a&&delete v.price,d[a].applyOptions(v),i.points.push(a),i.data.push(_),a="X",v={price:t.fmtNum(m-.5*C),title:t.fmtNum(-.5*C)},l.point===a&&delete v.price,d[a].applyOptions(v),a="Y",v={price:t.fmtNum(m-C),title:t.fmtNum(-C)},l.point===a&&delete v.price,d[a].applyOptions(v),a="Z",v={price:t.fmtNum(m-2*C),title:t.fmtNum(-2*C)},l.point===a&&delete v.price,d[a].applyOptions(v),a="W",v={price:t.fmtNum(m-4*C),title:t.fmtNum(-4*C)},l.point===a&&delete v.price,d[a].applyOptions(v),f.dispatch("tradingDerivative/drawTools",i)}}return(l,S)=>(H(),J("div",{ref_key:"targetToolRef",ref:x,class:"command",title:l.$t("trading.derivative.targetTool"),onClick:u,onContextmenu:V},gi,40,vi))}},yi=["title"],Ue=3,Qe=2,Ti={__name:"OrderTool",props:["position","prices","priceSeries","inSession","TIME"],emits:["getTools","showEntry","showTpSl","orderChanged","hideContext"],setup(P,{expose:A,emit:T}){const f=me(),{t}=Oe(),r=fe("mf"),y=P,x=T,I=B(null),d=B(!1),h=ce(()=>f.state.tradingDerivative.tools.order);let u={side:0,entry:{},tp:{},sl:{}},V=!1;A({show:Z,entry:R,tpsl:w,cancel:g,cancelWithoutClose:l,scan:S,drag:_}),ve(h,e=>{e&&a(e)});function W(){return r.isSet(u.entry.line)||r.isSet(u.tp.line)}function Z({price:e}){if(e&&y.inSession()){const p=G(ke(new Date,7));if(r.isSet(u.entry.line))!r.isSet(u.tp.line)&&y.position&&p>y.TIME.ATO&&p<y.TIME.ATC&&x("showTpSl",{side:y.position});else{let o=null,n=0;y.position?(p<y.TIME.ATO?o="ATO":p>y.TIME.ATC&&(o="ATC"),o&&(u.entry.price=o,n=-y.position)):p>y.TIME.ATO&&p<y.TIME.ATC&&(o=e,n=o>=y.prices.at(-1).value?1:-1,u.side=n,u.entry.price=o),n&&x("showEntry",{side:n,price:o})}}}function R(){if(y.inSession()){const e=G(ke(new Date,7));e<y.TIME.ATO?qe(t("trading.derivative.atoOrder"),t("titles.confirm")).then(o=>{o&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(n=>{n.isOk?se.success(t("trading.derivative.atoOrderSuccess")):C(n.message)})}):e>y.TIME.ATC?qe(t("trading.derivative.atcOrder"),t("titles.confirm")).then(o=>{o&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(n=>{n.isOk?se.success(t("trading.derivative.atcOrderSuccess")):C(n.message)})}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:u.side,price:u.entry.price}}).then(p=>{p.isOk?(i(["entry"]),se.success(t("trading.derivative.newEntrySuccess"))):C(p.message)})}}function w(){u.tp.price=u.entry.price+u.side*Ue,u.sl.price=u.entry.price-u.side*Qe,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:u.tp.price},slData:{cmd:"new",price:u.sl.price}}).then(e=>{e.isOk?(u.entry.line.applyOptions({draggable:!1}),i(["entry","tp","sl"]),se.success(t("trading.derivative.newTpSlSuccess"))):C(e.message)})}function g(){r.isSet(u.entry.line)?r.isSet(u.tp.line)?f.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(e=>{e.isOk?(m(["entry","tp","sl"]),se.success(t("trading.derivative.exitSuccess"))):C(e.message)}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(e=>{e.isOk?(m(["entry"]),se.success(t("trading.derivative.deleteEntrySuccess"))):C(e.message)}):x("getTools")}function l(){if(y.inSession()&&y.position){const e=G(ke(new Date,7));e>y.TIME.ATC-5*60&&(d.value=!0,e>y.TIME.ATC-15&&r.isSet(u.tp.line)&&f.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(p=>{p.isOk?(m(["entry","tp","sl"]),se.success(t("trading.derivative.autoCancelTpSlSuccess"))):C(p.message)}))}}function S(e){if(r.isSet(u.entry.line)){const p=u.side>0;r.isSet(u.tp.line)?(r.cmp(e,p,u.tp.price,!0)&&(V||(V=!0,f.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(o=>{o.isOk?(m(["entry","tp","sl"]),se.success(t("trading.derivative.deleteTpSuccess"))):C(o.message),V=!1}))),r.cmp(e,!p,u.sl.price,!0)&&(V||(V=!0,f.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(o=>{o.isOk?(m(["entry","tp","sl"]),se.success(t("trading.derivative.deleteSlSuccess"))):C(o.message),V=!1})))):r.cmp(e,p,u.entry.price,!0)&&(V||(V=!0,setTimeout(()=>{u.tp.price=u.entry.price+u.side*Ue,u.sl.price=u.entry.price-u.side*Qe,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:u.tp.price},slData:{cmd:"new",price:u.sl.price}}).then(o=>{o.isOk?(u.entry.line.applyOptions({draggable:!1}),i(["entry","tp","sl"]),se.success(t("trading.derivative.autoNewTpSlSuccess"))):C(o.message),V=!1})},1e3)))}}function i(e){const p="order";let o={isRemove:!1,name:p,points:[],data:[]},n,k;e.forEach(c=>{const N=u.entry.price,E=u.tp.price,L=u.sl.price;switch(c){case"entry":n="yellow",k=u.side>0?"LONG":"SHORT";break;case"tp":n="lime",k=r.fmtNum(E-N,1,!0);break;case"sl":n="red",k=r.fmtNum(L-N,1,!0);break}if(o.points.push(c),r.isSet(u[c].line))u[c].line.applyOptions({price:u[c].price,title:k}),o.data.push(u[c].line.options());else{const b={lineType:p,kind:c,side:u.side,price:u[c].price,color:n,lineWidth:1,lineStyle:0,title:k,draggable:!0};u[c].line=y.priceSeries.createPriceLine(b),o.data.push(b)}}),f.dispatch("tradingDerivative/drawTools",o),x("orderChanged",W())}function a(e){m(["entry","tp","sl"],!1),v(e),x("orderChanged",W())}function v(e){Object.entries(e).forEach(([p,o])=>{p==="entry"&&(u.side=o.side),u[p].price=o.price,u[p].line=y.priceSeries.createPriceLine(o)})}function m(e,p=!0){p&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),e.forEach(o=>{r.isSet(u[o].line)&&(y.priceSeries.removePriceLine(u[o].line),delete u[o].line)}),x("orderChanged",W())}function _({line:e,lineOptions:p,oldPrice:o,newPrice:n}){if(n!==o){let k=!1;p.kind==="entry"?y.position||(k=!0,u[p.kind].price=n,f.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:u.entry.price}}).then(c=>{c.isOk?(i([p.kind]),se.success(t("trading.derivative.changeEntrySuccess"))):(e.applyOptions({price:o}),C(c.message))})):(k=!0,u[p.kind].price=n,p.kind==="tp"?f.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:u.tp.price}}).then(c=>{c.isOk?(i([p.kind]),se.success(t("trading.derivative.changeTpSuccess"))):(e.applyOptions({price:o}),C(c.message))}):f.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:u.sl.price}}).then(c=>{c.isOk?(i([p.kind]),se.success(t("trading.derivative.changeSlSuccess"))):(e.applyOptions({price:o}),C(c.message))})),k||(e.applyOptions({price:o}),se.show(t("trading.derivative.noChangeOrderLine")))}}function C(e){e||(e="unknown"),se.error(t(`trading.derivative.${e}`))}return(e,p)=>(H(),J("div",{ref_key:"orderToolRef",ref:I,class:"cancel-order command",title:e.$t("trading.derivative.orderTool"),onClick:g},[F("i",{class:ae(["far fa-trash-alt",{blink:d.value}])},null,2)],8,yi))}};const xi=["title"],Ci=["title"],ki=["title"],_i=["title"],bi="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",wi="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",Oi={__name:"Chart",setup(P,{expose:A}){const T=me(),f=Tt(),{t}=Oe(),r=fe("devices"),y=fe("mf"),x=fe("filters"),I=B(null),d=B(null),h=B(null),u=B(null),V=B(null),W=B(null),Z=B(null),R=B(null),w=B(null),g=B(null),l=B(null),S=B(null),i=B(null),a=B(null),v=B(null),m={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},_=Le(new Date,"yyyy-MM-dd"),C={START:G(new Date(`${_}T08:45:00Z`)),ATO:G(new Date(`${_}T09:00:00Z`)),ATC:G(new Date(`${_}T14:30:00Z`)),END:G(new Date(`${_}T14:45:00Z`))};let e={chart:{},whitespaces:[],crosshair:{},interval:null,interval60:null,websocket:null,socketStop:!1,vpsUpdatedAt:bt(new Date,61)};const p=gt({prices:[],series:{},chartDate:f.query.date??_,clock:Le(new Date,"HH:mm:ss"),isSocketWarning:!1,hasOrderLine:!1,TIME:C}),o=ce(()=>T.state.tradingDerivative.status),n=ce(()=>T.state.tradingDerivative.config),k=ce(()=>T.state.tradingDerivative.isLoading),c=ce(()=>o.value.position||o.value.pending||p.hasOrderLine);e.interval=setInterval(()=>{i.value&&i.value.cancelWithoutClose(),p.clock=Le(new Date,"HH:mm:ss")},1e3),e.interval60=setInterval(()=>{De()?(He(),n.value.autoRefresh&&R.value.refresh(!0)):clearInterval(e.interval60)},6e4),st(),We(()=>{N(),new ResizeObserver(re).observe(I.value),document.addEventListener("keydown",ee)}),Ge(()=>{E(),document.removeEventListener("keydown",ee),clearInterval(e.interval),clearInterval(e.interval60),oe(),e.socketStop=!0}),ve(()=>T.state.tradingDerivative.chartData,te),A({connectSocket:Y});function N(){e.chart=kt(d.value,m),e.chart.subscribeCrosshairMove(X),e.chart.subscribeCustomPriceLineDragged(q),p.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),p.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),p.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}})}function E(){e.chart&&(e.chart.remove(),e.chart=null)}function L(s){ue(),ge(!1),S.value.isSelected()?S.value.draw({time:e.crosshair.time}):R.value.isSelected()?R.value.draw({time:e.crosshair.time,price:Ee(e.crosshair.y)}):w.value.isSelected()?w.value.draw({time:e.crosshair.time}):Z.value.isSelected()?Z.value.draw({price:Ee(e.crosshair.y)}):l.value.isSelected()?l.value.draw({time:e.crosshair.time}):g.value.isSelected()&&g.value.draw({price:Ee(e.crosshair.y)})}function b(s){ge(!0),s.preventDefault()}function $(s){s.stopPropagation()}function M(s){s.preventDefault(),s.stopPropagation()}function X(s){if(s.time){let O=s.seriesPrices.get(p.series.price);e.crosshair.time=s.time,e.crosshair.price=O}else r.phone||(e.crosshair.time=null,e.crosshair.price=null);s.point!==void 0&&(e.crosshair.x=s.point.x,e.crosshair.y=s.point.y)}function q(s){let O=s.customPriceLine,D=O.options();D.price=y.fmtNum(D.price);const z=+s.fromPriceString,K=D.price;switch(D.lineType){case"order":i.value.drag({line:O,lineOptions:D,oldPrice:z,newPrice:K});break;case"line":Z.value.drag({lineOptions:D,oldPrice:z,newPrice:K});break;case"target":g.value.drag({lineOptions:D,newPrice:K});break;case"pattern":R.value.drag({lineOptions:D});break}}function re(){I.value&&(e.chart.resize(I.value.offsetWidth,I.value.offsetHeight),I.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function ee(s){if(s.ctrlKey)switch(s.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(s.altKey)switch(s.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function te(s){p.chartDate===_&&De()||(s.price.length>0&&(e.whitespaces=Q(e.whitespaces,U(p.chartDate))),p.series.whitespace.setData(e.whitespaces),p.prices=Q(p.prices,s.price),p.series.price.setData(p.prices))}function ie(s,O=null){const D=O??n.value.source;let z=[];s.forEach(K=>{let pe,de;D==="FireAnt"?(pe=G(ke(new Date(K.date),7)),de=K.price):(pe=G(new Date(`${_}T${K.time}Z`)),de=K.lastPrice),z.push({time:pe,value:de})}),z.length>1?(p.prices=Q(p.prices,z),p.series.price.setData(p.prices)):(p.prices.push(z[0]),p.series.price.update(z[0]))}function U(s){const O=G(new Date(`${s}T09:00:00Z`)),D=G(new Date(`${s}T11:30:00Z`)),z=G(new Date(`${s}T13:00:00Z`)),K=G(new Date(`${s}T14:30:00Z`)),pe=G(new Date(`${s}T14:00:00Z`));let de=[];for(let Se=O;Se<=K;Se++){if(Se>D&&Se<z)continue;let Xe={time:Se};(Se===pe||Se===K)&&(Xe.value=1),de.push(Xe)}return de}function Q(s,O){return Array.from(new Map([...s,...O].sort((D,z)=>D.time-z.time).map(D=>[D.time,D])).values())}async function Y(){if(De()){await oe();const s=n.value.source==="FireAnt",O=s?bi:wi;e.websocket=new WebSocket(O),e.websocket.onclose=D=>{e.socketStop||(p.isSocketWarning=!0,Y())},s?Pe():(j(),he())}}async function oe(){e.websocket&&e.websocket.readyState===WebSocket.OPEN&&(e.websocket.close(),await new Promise(s=>{const O=setInterval(()=>{(!e.websocket||e.websocket.readyState===WebSocket.CLOSED)&&(e.websocket=null,clearInterval(O),s())},100)}))}function Pe(){T.dispatch("tradingDerivative/setLoading",!0),e.websocket.onopen=s=>{if(e.websocket.readyState===WebSocket.OPEN){let O='{"protocol":"json","version":1}';e.websocket.send(O),O='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(O)}},e.websocket.onmessage=s=>{p.isSocketWarning=!1,le(s.data).forEach(D=>{if(!D)return!1;D.type===3?(D.result[0].date.slice(0,10)===_&&(Re(),e.whitespaces=Q(e.whitespaces,U(_)),p.series.whitespace.setData(e.whitespaces),ie(D.result)),T.dispatch("tradingDerivative/setLoading",!1)):D.type===1&&D.target==="UpdateTrades"&&D.arguments[0]==="VN30F1M"&&(console.log("FireAnt",D.arguments[1]),i.value.scan(D.arguments[1].at(-1).price),ie(D.arguments[1]))})}}function le(s){let O=[];return s.split("").forEach(D=>{const z=D.indexOf("{"),K=D.lastIndexOf("}");let pe=null;if(z!==-1&&K!==-1&&K>z){const de=D.substring(z,K+1);de!=="{}"&&(pe=JSON.parse(de))}O.push(pe)}),O}function he(){e.websocket.onopen=s=>{if(e.websocket.readyState===WebSocket.OPEN){const O={action:"join",list:n.value.vn30f1m},D=`42${JSON.stringify(["regs",JSON.stringify(O)])}`;e.websocket.send(D)}},e.websocket.onmessage=s=>{if(p.isSocketWarning=!1,s.data.substr(0,1)==="4"&&s.data.substr(1,1)==="2"){const O=JSON.parse(s.data.substr(2));if(O[0]==="stockps"){const D=O[1].data;D.id===3220&&(console.log("VPS",D),i.value.scan(D.lastPrice),ie([D]))}}}}function j(){St(new Date,new Date(e.vpsUpdatedAt))>60&&(fetch("https://bddatafeed.vps.com.vn/getpschartintraday/VN30F1M").then(s=>s.json()).then(s=>{console.log(s),ie(s,"VPS")}),e.vpsUpdatedAt=new Date)}function Ce(){R.value.refresh()}function Ye(s){R.value.load(s,{isSave:!0})}function ue(){W.value.hide(),S.value.hide(),Z.value.hide()}function ze(s){W.value.set(s)}function $e(s){p.hasOrderLine=s}function ge(s){s?i.value.show({price:Ee(e.crosshair.y)}):(a.value.style.display="none",v.value.style.display="none")}function Ie({side:s,price:O}){a.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",a.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",a.value.style.background=s>0?"green":"red",a.value.innerText=`${s>0?"LONG":"SHORT"} ${O}`,a.value.style.display="block"}function Ae({side:s}){v.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",v.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",v.value.style.background=s>0?"green":"red",v.value.style.display="block"}function be(){i.value.entry()}function we(){i.value.tpsl()}function Ne(){e.chart.timeScale().scrollToRealTime()}function De(){const s=G(ke(new Date,7));return n.value.openingMarket&&s>=C.START&&s<=C.END}function nt(){if(!p.chartDate)return!1;Be()}function rt(){e.whitespaces=[],p.prices=[],Y(),Be()}function st(){T.dispatch("tradingDerivative/initChart").then(()=>{Y(),!f.query.date&&n.value.lastOpeningDate&&(p.chartDate=n.value.lastOpeningDate),Be()})}function Be(){T.dispatch("tradingDerivative/getChartData",p.chartDate).then(s=>{s&&Re()})}function He(){T.dispatch("tradingDerivative/getStatus")}function Re(){T.dispatch("tradingDerivative/getTools")}function ot(){T.dispatch("tradingDerivative/getAccountInfo").then(s=>{let O="";O+='<div style="width: 200px;">',O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.nav")}</div><div>: ${x.currency(s.nav)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.maxVol")}</div><div>: ${x.numberVnFormat(s.maxVol)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.vm")}</div><div>: ${x.currency(s.vm)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.fee")}</div><div>: ${x.currency(s.fee)}</div></div>`,O+="</div>",xt(O,t("trading.derivative.accountInfo"))})}function Ee(s){return y.fmtNum(p.series.price.coordinateToPrice(s))}function Fe(s){let O=e.whitespaces.findIndex(D=>D.time===s);if(O===-1){const D=Le(new Date(s*1e3),"yyyy-MM-dd"),z=G(new Date(`${D}T11:30:00Z`)),K=G(new Date(`${D}T13:00:00Z`)),pe=G(new Date(`${D}T14:30:00Z`));s>z&&s<K?s=z:s>pe&&(s=pe),O=e.whitespaces.findIndex(de=>de.time===s)}return O}function Je(s){return s<e.whitespaces.length?e.whitespaces[s].time:!1}return(s,O)=>(H(),J("div",{class:"derivative-chart",ref_key:"chartContainerRef",ref:I,onClick:L,onContextmenu:b},[F("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:d},[F("div",{class:"area data-area",onClick:$,onContextmenu:M},[F("div",{ref_key:"connectionRef",ref:h,class:ae(["command",{yellow:o.value.pending,red:n.value.volInValid}]),title:s.$t("trading.derivative.connection"),onClick:He},[F("i",{class:ae(["far",{"fa-link-simple":o.value.connection,"fa-link-simple-slash":!o.value.connection,blink:p.isSocketWarning}])},null,2)],10,xi),F("div",{class:ae(["command status",{green:o.value.position>0,red:o.value.position<0}]),title:s.$t("trading.derivative.position"),onClick:ot},ye(o.value.position),11,Ci),F("div",{class:"command clock",onClick:Y},ye(p.clock),1),Te(F("input",{type:"date",class:"chart-date command",title:s.$t("trading.derivative.date"),"onUpdate:modelValue":O[0]||(O[0]=D=>p.chartDate=D),onChange:nt},null,40,ki),[[yt,p.chartDate]]),F("div",{ref_key:"reloadToolRef",ref:u,class:"command",title:s.$t("trading.derivative.reload"),onClick:rt,onContextmenu:Re},[F("i",{class:ae(["far fa-sync-alt",{"fa-spin":k.value}])},null,2)],40,_i)],32),F("div",{class:"area tool-area",onClick:$,onContextmenu:M},[ne(Dt,{chartContainerRef:I.value},null,8,["chartContainerRef"]),ne(Lt,{ref_key:"tradingviewRef",ref:V,vpsUser:n.value.vpsUser,vpsSession:n.value.vpsSession,chartContainerRef:I.value},null,8,["vpsUser","vpsSession","chartContainerRef"]),ne(Nt,{ref_key:"progressToolRef",ref:W,onRefreshPattern:Ce,onHideContext:ue},null,512),ne(Xt,{ref_key:"scanToolRef",ref:S,prices:p.prices,timeToIndex:Fe,onScaned:Ye,onRemovePattern:O[1]||(O[1]=()=>R.value.remove()),onHideContext:ue},null,8,["prices"]),ne(Qt,{ref_key:"patternToolRef",ref:R,prices:p.prices,priceSeries:p.series.price,timeMarkSeries:p.series.timeMark,pickTimeToolRef:w.value,timeToIndex:Fe,indexToTime:Je,onSetProgress:ze,onHideContext:ue},null,8,["prices","priceSeries","timeMarkSeries","pickTimeToolRef"]),ne(ti,{ref_key:"pickTimeToolRef",ref:w,pickTimeSeries:p.series.pickTime,onRefreshPattern:Ce,onHideContext:ue},null,8,["pickTimeSeries"]),ne(pi,{ref_key:"lineToolRef",ref:Z,priceSeries:p.series.price,onHideContext:ue},null,8,["priceSeries"]),ne(mi,{ref_key:"timeRangeToolRef",ref:l,timeRangeSeries:p.series.timeRange,timeToIndex:Fe,indexToTime:Je,onHideContext:ue},null,8,["timeRangeSeries"]),ne(Si,{ref_key:"targetToolRef",ref:g,priceSeries:p.series.price,onHideContext:ue},null,8,["priceSeries"]),Te(ne(Ti,{ref_key:"orderToolRef",ref:i,position:o.value.position,prices:p.prices,priceSeries:p.series.price,inSession:De,TIME:p.TIME,onGetTools:Re,onShowEntry:Ie,onShowTpSl:Ae,onOrderChanged:$e,onHideContext:ue},null,8,["position","prices","priceSeries","TIME"]),[[_e,c.value]])],32),F("div",null,[F("div",{ref_key:"entryOrderRef",ref:a,class:"order-button entry",onClick:be}," Entry ",512),F("div",{ref_key:"tpslOrderRef",ref:v,class:"order-button tpsl",onClick:we}," TP/SL ",512),F("div",{class:"chart-top command far fa-angle-double-right",onClick:Ne})])],512)],544))}};export{Oi as default};
