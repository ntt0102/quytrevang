import{A as qt,B as Qt,C as Ut,l as me,u as Gt,r as T,a as Kt,c as J,y as ei,E as ti,w as Ye,x as b,b as ii,d as g,e as ie,G as $,t as Ve,H,I as oi,J as oe,K as ri,F as si,h as ni,j as ai,k as ve,z as Me,L as li,m as ci,o as pi}from"./app-2407ca56.js";import di from"./LineContext-4546edea.js";import ui from"./ScanContext-4e6fc707.js";import fi from"./PatternContext-5a52b7c7.js";import mi from"./VpsOtpPopup-7ef29175.js";import{c as vi}from"./lightweight-charts.esm.development-03366bac.js";import{g as k}from"./getUnixTime-2717a2ea.js";import"./text-box-fbd74f3c.js";function gi(j,q,R){return qt((R==null?void 0:R.in)||j,+Qt(j)+q)}function ke(j,q,R){return gi(j,q*Ut,R)}const hi={class:"content-block dx-card responsive-paddings"},yi=["title"],xi=["title"],Si=["title"],Ci=["title"],Fi=["title"],wi=["title"],Ti=["title"],bi=["title"],ki=["title"],Di=g("i",{class:"far fa-heart-rate"},null,-1),Oi=[Di],Ri=["title"],Li=g("i",{class:"far fa-grip-lines-vertical"},null,-1),Pi=[Li],Ai=["title"],Ei=g("i",{class:"far fa-horizontal-rule"},null,-1),Wi=["title"],Zi=g("i",{class:"far fa-line-height"},null,-1),_i=[Zi],Bi=["title"],Ii=["src"],Ne=3,Xe=2,$i="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",ji={__name:"Index",setup(j){const q={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},R=me(new Date,"yyyy-MM-dd"),L={START:k(new Date(`${R}T08:45:00Z`)),ATO:k(new Date(`${R}T09:00:00Z`)),ATC:k(new Date(`${R}T14:30:00Z`)),END:k(new Date(`${R}T14:45:00Z`))},u=ni(),De=ai(),{t:x}=Gt(),ze=ve("devices"),m=ve("mf"),ge=ve("bus"),re=ve("filters"),_=T(null),Oe=T(null),Je=T(null),He=T(null),je=T(null),qe=T(null),Qe=T(null),se=T(null),he=T(null),ye=T(null),ne=T(null),xe=T(null),Ue=T(null),V=T(null),Q=T(null),Re=T(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:k(ke(new Date,7))};ee();const a=Kt({chartDate:De.query.date??R,clock:me(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,isAutoScan:!1,lineColor:"#F44336",lineTitle:"",progress:[],pattern:{items:[],selected:null},showPatternContext:!1,scanSide:"left",showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),P=J(()=>u.state.tradingDerivative.status),B=J(()=>u.state.tradingDerivative.config),Le=J(()=>u.state.tradingDerivative.tools),Ge=J(()=>u.state.tradingDerivative.isChartLoading),Ke=J(()=>P.value.position!=0||!!P.value.pending||!!Le.value.order),et=J(()=>`https://chart.vps.com.vn/tv/?u=${B.value.vpsUser}&s=${B.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);u.dispatch("tradingDerivative/initChart").then(()=>{Y()&&Se(),!De.query.date&&B.value.lastOpeningDate&&(a.chartDate=B.value.lastOpeningDate),u.dispatch("tradingDerivative/getChartData",a.chartDate).then(i=>{i&&K()})}),e.interval=setInterval(pt,1e3),e.interval60=setInterval(()=>{Y()?($e(),B.value.autoScan&&K()):clearInterval(e.interval60)},6e4),ei(()=>{e.chart=vi(Oe.value,q),e.chart.subscribeCrosshairMove(ot),e.chart.subscribeCustomPriceLineDragged(rt),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(st).observe(_.value),document.addEventListener("keydown",Ee),document.addEventListener("fullscreenchange",We)}),ti(()=>{document.removeEventListener("keydown",Ee),document.removeEventListener("fullscreenchange",We),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),Ye(()=>u.state.tradingDerivative.chartData,lt),Ye(()=>Le.value,at);function tt(i){a.showPatternContext=!1,a.showScanContext=!1,a.showLineContext=!1,de(!1),se.value.classList.contains("selected")?Lt():ye.value.classList.contains("selected")?Wt():ne.value.classList.contains("selected")?Dt():xe.value.classList.contains("selected")?yt():he.value.classList.contains("selected")&&Tt()}function it(i){de(!0),i.preventDefault()}function Pe(i){i.stopPropagation()}function Ae(i){i.preventDefault(),i.stopPropagation()}function ot(i){if(i.time){let r=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=r}else ze.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function rt(i){let r=i.customPriceLine,t=r.options();t.price=parseFloat(t.price.toFixed(1));const o=+i.fromPriceString,s=t.price;switch(t.lineType){case"order":if(s!=o){let c=!1;t.kind=="entry"?P.value.position||(c=!0,e.tools.order[t.kind].price=s,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(l=>{l.isOk?(X([t.kind]),b.success(x("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:o}),A(l.message))})):(c=!0,e.tools.order[t.kind].price=s,t.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(l=>{l.isOk?(X([t.kind]),b.success(x("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:o}),A(l.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(l=>{l.isOk?(X([t.kind]),b.success(x("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:o}),A(l.message))})),c||(r.applyOptions({price:o}),b.show(x("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o});const n=t.color,p=t.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[s],data:[{color:n,title:p}]}),se.value.classList.remove("selected");break;case"target":if(m.isSet(e.tools.target.B)){let c={isRemove:!1,name:"target",points:[],data:[]},l,d,f=+e.tools.target.A.options().price,v=+e.tools.target.B.options().price,h=v-f;if(l="A",t.point=="A")h=+e.tools.target.B.options().title,v=f+h;else if(t.point!="B"){let y=0;switch(t.point){case"X":y=1.5;break;case"Y":y=2;break;case"Z":y=3;break;case"W":y=5;break}h=parseFloat(((v-s)/y).toFixed(1)),f=v-h,d={price:f},e.tools.target[l].applyOptions(d)}c.points.push(l),c.data.push(f),l="B",d={price:v,title:h.toFixed(1)},t.point==l&&delete d.price,e.tools.target[l].applyOptions(d),c.points.push(l),c.data.push(v),l="X",d={price:parseFloat((f-.5*h).toFixed(1)),title:(-.5*h).toFixed(1)},t.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="Y",d={price:parseFloat((f-h).toFixed(1)),title:(-h).toFixed(1)},t.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="Z",d={price:parseFloat((f-2*h).toFixed(1)),title:(-2*h).toFixed(1)},t.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="W",d={price:parseFloat((f-4*h).toFixed(1)),title:(-4*h).toFixed(1)},t.point==l&&delete d.price,e.tools.target[l].applyOptions(d),u.dispatch("tradingDerivative/drawTools",c)}break;case"pattern":if(m.isSet(e.tools.pattern.B)){let c,l;const d=e.tools.pattern.A.options(),f=e.tools.pattern.B.options(),v=e.tools.pattern.C.options(),h={A:{time:+d.time,price:+d.price},B:{price:+f.price},C:{price:+v.price}},y=t.point=="D"?+e.tools.pattern.D.options().price:null,{pattern:C,timeRange:S,info:{el1:D,el2:W,el3:F,fibo:E,tR:O,X:M,Y:N,Z:fe,W:te}}=le(h,null,y);Ce(C),ce(S),U(h),c="A",l={title:`A ${D}`},e.tools.pattern[c].applyOptions(l),c="B",l={title:`B ${W}`},e.tools.pattern[c].applyOptions(l),c="C",l={title:`C ${F}`},e.tools.pattern[c].applyOptions(l),c="D",l={price:O,title:"F "+E},t.point==c&&delete l.price,e.tools.pattern[c].applyOptions(l),c="X",l={price:parseFloat((O+M).toFixed(1)),title:"X "+parseFloat(M.toFixed(1))},e.tools.pattern[c].applyOptions(l),c="Y",l={price:parseFloat((O+N).toFixed(1)),title:"Y "+parseFloat(N.toFixed(1))},e.tools.pattern[c].applyOptions(l),c="Z",l={price:parseFloat((O+fe).toFixed(1)),title:"Z "+parseFloat(fe.toFixed(1))},e.tools.pattern[c].applyOptions(l),c="W",l={price:parseFloat((O+te).toFixed(1)),title:"W "+parseFloat(te.toFixed(1))},e.tools.pattern[c].applyOptions(l)}break}}function st(){_.value&&(e.chart.resize(_.value.offsetWidth,_.value.offsetHeight),_.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ee(i){if(i.ctrlKey)switch(i.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(i.altKey)switch(i.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function We(){_.value&&(document.fullscreenElement?(a.isFullscreen=!0,_.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(a.isFullscreen=!1,_.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function nt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function at(i){_t(),Object.entries(i).forEach(([r,t])=>{switch(r){case"order":dt(t);break;case"pattern":we(i.pattern,null,!("tr"in i));break;case"tr":ce(Object.values(t));break;case"line":Pt(t);break;case"target":Zt(t);break}})}function lt(i){a.chartDate==R&&Y()||(i.price.length>0&&(e.data.whitespace=ae(e.data.whitespace,_e(a.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=ae(e.data.price,i.price),e.series.price.setData(e.data.price))}function Ze(i){let r=[];i.forEach(t=>{const o=k(ke(new Date(t.date),7));r.push({time:o,value:t.price})}),r.length>1?(e.data.price=ae(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function _e(i){const r=k(new Date(`${i}T09:00:00Z`)),t=k(new Date(`${i}T11:30:00Z`)),o=k(new Date(`${i}T13:00:00Z`)),s=k(new Date(`${i}T14:30:00Z`)),n=k(new Date(`${i}T14:00:00Z`));let p=[];for(let c=r;c<=s;c++){if(c>t&&c<o)continue;let l={time:c};(c==n||c==s)&&(l.value=1),p.push(l)}return p}function ae(i,r){return Array.from(new Map([...i,...r].sort((t,o)=>t.time-o.time).map(t=>[t.time,t])).values())}function Se(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket($i),e.websocket.onopen=i=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=i=>{!e.socketStop&&Y()&&(a.isSocketWarning=!0,Se())},e.websocket.onmessage=i=>{a.isSocketWarning=!1,ct(i.data).forEach(t=>{if(!t)return!1;t.type==3?(K(),e.data.whitespace=ae(e.data.whitespace,_e(R)),e.series.whitespace.setData(e.data.whitespace),Ze(t.result),u.dispatch("tradingDerivative/setChartLoading",!1)):t.type==1&&t.target=="UpdateTrades"&&t.arguments[0]=="VN30F1M"&&(Yt(t.arguments[1].at(-1).price),Ze(t.arguments[1]))})}}function ct(i){let r=[];return i.split("").forEach(t=>{const o=t.indexOf("{"),s=t.lastIndexOf("}");let n=null;if(o!==-1&&s!==-1&&s>o){const p=t.substring(o,s+1);p!="{}"&&(n=JSON.parse(p))}r.push(n)}),r}function pt(){e.currentSeconds=k(ke(new Date,7)),Y()&&(P.value.position&&e.currentSeconds>L.ATC-5*60&&(a.isOrderWarning=!0,e.currentSeconds>L.ATC-15&&m.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(i=>{i.isOk?(z(["entry","tp","sl"]),b.success(x("trading.derivative.autoCancelTpSlSuccess"))):A(i.message)})),B.value.openingMarket&&e.currentSeconds==L.START&&Se()),a.clock=me(new Date,"HH:mm:ss")}function X(i){const r="order";let t={isRemove:!1,name:r,points:[],data:[]},o,s;i.forEach(n=>{switch(n){case"entry":o="yellow",s=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",s=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",s=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(t.points.push(n),m.isSet(e.tools.order[n].line))e.tools.order[n].line.applyOptions({price:e.tools.order[n].price,title:s}),t.data.push(e.tools.order[n].line.options());else{const p={lineType:r,kind:n,side:e.tools.order.side,price:e.tools.order[n].price,color:o,lineWidth:1,lineStyle:0,title:s,draggable:!0};e.tools.order[n].line=e.series.price.createPriceLine(p),t.data.push(p)}}),u.dispatch("tradingDerivative/drawTools",t)}function dt(i){Object.entries(i).forEach(([r,t])=>{e.tools.order.side=t.side,e.tools.order[r].price=t.price,e.tools.order[r].line=e.series.price.createPriceLine(t)})}function z(i,r=!0){r&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),i.forEach(t=>{m.isSet(e.tools.order[t].line)&&(e.series.price.removePriceLine(e.tools.order[t].line),delete e.tools.order[t].line)})}function ut(i){a.showTradingView=!a.showTradingView,i.stopPropagation()}function ft(){a.showPatternContext=!a.showPatternContext,a.showScanContext=!1,a.showLineContext=!1}function mt(){u.dispatch("tradingDerivative/setAutoScan",!B.value.autoScan)}function vt(i){if(i!=a.pattern.selected){a.pattern.selected=i;const r=e.tools.pattern.A.options(),t=e.tools.pattern.B.options(),o=e.tools.pattern.C.options(),s={A:{time:+r.time,price:+r.price},B:{price:+t.price},C:{price:+o.price}};G(),we(s,i)}}function Ce(i){a.pattern=i,setTimeout(()=>a.showPatternContext=!0,0)}function Fe(){a.pattern.items=[],a.pattern.selected=null}function gt(i){a.showScanContext=!1,a.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(G(),pe(!1),Fe(),U(),i.target.classList.add("selected"))}function ht(){a.showScanContext=!a.showScanContext,a.showPatternContext=!1,a.showLineContext=!1}function yt(){const i=a.scanSide=="left",r=e.crosshair.time?e.data.price.filter(o=>!w(o.time,i,e.crosshair.time)):e.data.price;let t=i?xt(r):St(r);t=Ct(t),m.isSet(t)&&(G(),we(t),U(t)),xe.value.classList.remove("selected")}function xt(i){let r,[t,o,s,n]=Array(4).fill({});for(let p=i.length-1;p>=0;p--){const c=i[p].value,l=i[p].time,d=Z(l);if(d==-1)break;if(p==i.length-1&&(s={index:d,time:l,price:c},[o,t,n]=Array(3).fill(null).map(()=>m.cloneDeep(s))),r==null){if(c==s.price)continue;r=c>s.price}if(w(c,r,o.price)&&(w(t.price,!r,s.price)?([s,o]=[o,t].map(f=>m.cloneDeep(f)),t={index:d,time:l,price:c},n=m.cloneDeep(t),r=!r):o={index:d,time:l,price:c}),w(c,!r,t.price)?(t={index:d,time:l,price:c},n=m.cloneDeep(t)):n.index=d,w(c,r,n.price)&&(n={index:d,time:l,price:c}),s.index>t.index){const f=Math.abs(o.price-s.price);if(f>=1.5&&(t.index-n.index>s.index-o.index||Math.abs(t.price-n.price)>f))break}}return{A:t,B:o,C:s}}function St(i){let r,[t,o,s]=Array(3).fill({});for(let n=0;n<i.length;n++){const p=i[n].value,c=i[n].time,l=Z(c);if(l==-1)break;if(n==0&&(t={index:l,time:c,price:p},o=m.cloneDeep(t),s=m.cloneDeep(t)),r==null){if(p==t.price)continue;r=p>t.price}w(p,r,o.price)&&(o={index:l,time:c,price:p},s=m.cloneDeep(o)),w(o.price,r,t.price)&&w(p,!r,s.price)&&(w(p,r,t.price)?s={index:l,time:c,price:p}:(t=m.cloneDeep(o),o={index:l,time:c,price:p},s=m.cloneDeep(o),r=!r))}return{A:t,B:o,C:s}}function Ct(i){const r={};return Object.entries(i).forEach(([t,o])=>{const{index:s,...n}=o;r[t]=n}),r}function Ft(i){a.showScanContext=!1,a.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function wt(i){i.target.classList.remove("selected"),G(),pe(!0),Fe(),U()}function Tt(){const i="pattern",r=ue(e.crosshair.y),t=e.crosshair.time;let o={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0};if(m.isSet(e.tools.pattern.A)){const s=e.tools.pattern.A.options();if(m.isSet(e.tools.pattern.B)){const n=e.tools.pattern.B.options();let p,c,l;if(m.isSet(e.tools.pattern.C)){let d,f;const v=e.tools.pattern.C.options();p={A:{time:t,price:r},B:{price:+n.price},C:{price:+v.price}};const{pattern:h,timeRange:y,info:{el1:C,el2:S,el3:D,fibo:W,tR:F,X:E,Y:O,Z:M,W:N}}=le(p);c=y,l=h,d="A",f={price:r,time:t,title:`A ${C}`},e.tools.pattern[d].applyOptions(f),d="B",f={title:`B ${S}`},e.tools.pattern[d].applyOptions(f),d="C",f={title:`C ${D}`},e.tools.pattern[d].applyOptions(f),d="D",f={price:F,title:"F "+W},e.tools.pattern[d].applyOptions(f),d="X",f={price:parseFloat((F+E).toFixed(1)),title:"X "+parseFloat(E.toFixed(1))},e.tools.pattern[d].applyOptions(f),d="Y",f={price:parseFloat((F+O).toFixed(1)),title:"Y "+parseFloat(O.toFixed(1))},e.tools.pattern[d].applyOptions(f),d="Z",f={price:parseFloat((F+M).toFixed(1)),title:"Z "+parseFloat(M.toFixed(1))},e.tools.pattern[d].applyOptions(f),d="W",f={price:parseFloat((F+N).toFixed(1)),title:"W "+parseFloat(N.toFixed(1))},e.tools.pattern[d].applyOptions(f)}else{p={A:{time:+s.time,price:+s.price},B:{price:+n.price},C:{price:r}};const{pattern:d,timeRange:f,info:{el1:v,el2:h,el3:y,fibo:C,tR:S,X:D,Y:W,Z:F,W:E}}=le(p);c=f,l=d;let O="A";e.tools.pattern[O].applyOptions({title:`A ${v}`}),O="B",e.tools.pattern[O].applyOptions({title:`B ${h}`}),o.point="C",o.title=`C ${y}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="D",o.price=S,o.title="F "+C,o.color="#FFEB3B",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="X",o.price=parseFloat((S+D).toFixed(1)),o.title="X "+parseFloat(D.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Y",o.price=parseFloat((S+W).toFixed(1)),o.title="Y "+parseFloat(W.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="Z",o.price=parseFloat((S+F).toFixed(1)),o.title="Z "+parseFloat(F.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),o.point="W",o.price=parseFloat((S+E).toFixed(1)),o.title="W "+parseFloat(E.toFixed(1)),o.color="#E91E63",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}Ce(l),ce(c),U(p),he.value.classList.remove("selected")}else o.point="B",o.title="B 0",o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}else o.point="A",o.title="A 0",o.color="#F44336",o.time=t,e.tools.pattern[o.point]=e.series.price.createPriceLine(o)}function we(i,r=null,t=!0){let s={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{pattern:n,timeRange:p,info:{el1:c,el2:l,el3:d,fibo:f,tR:v,X:h,Y:y,Z:C,W:S}}=le(i,r);Ce(n),t&&ce(p),s.point="A",s.title=`A ${c}`,s.color="#F44336",s.price=i.A.price,s.time=i.A.time,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="B",s.title=`B ${l}`,s.color="#4CAF50",s.price=i.B.price,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="C",s.price=i.C.price,s.title=`C ${d}`,s.color="#FF9800",e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="D",s.price=v,s.title="F "+f,s.color="#FFEB3B",e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="X",s.price=parseFloat((v+h).toFixed(1)),s.title="X "+parseFloat(h.toFixed(1)),s.color="#2196F3",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="Y",s.price=parseFloat((v+y).toFixed(1)),s.title="Y "+parseFloat(y.toFixed(1)),s.color="#673AB7",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="Z",s.price=parseFloat((v+C).toFixed(1)),s.title="Z "+parseFloat(C.toFixed(1)),s.color="#9C27B0",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="W",s.price=parseFloat((v+S).toFixed(1)),s.title="W "+parseFloat(S.toFixed(1)),s.color="#E91E63",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s)}function le(i,r=null,t=null){const o=Te(i.A,i.B),s=Te(o.R,i.C),n=Te(s.R,s.S),p=parseFloat(o.el.toFixed(1)),c=parseFloat(s.el.toFixed(1)),l=parseFloat(n.el.toFixed(1)),d=i.B.price-i.C.price,v=i.B.price-i.A.price>0,h=Math.abs(d);let y=[],C,S,D,W;if(h>o.pr){const te=w(i.C.price,v,o.S1.price);h>=1.5&&(s.tr>=o.tr&&s.tr<3*o.tr&&(te?y.push("F"):w(n.R1.price,!v,s.S1.price)&&y.push("R")),n.tr>=o.tr&&n.tr<3*o.tr&&y.push("T")),o.pr>=1.5&&te&&(o.el>=3||(o.el>=2?s.tr>n.tr?y.push("E2F"):y.push("E2T"):o.el>=1&&(w(i.C.price,!v,o.R1.price)||(s.tr>n.tr?y.push("EF"):y.push("ET")))))}const F=r??(y.length?y[0]:"");F.includes("E")?(S=o.S1.price,C=o.R1.price,F.includes("F")?D=[s.R1.time,I(s.S1.index),s.R.time]:D=[o.R1.time,I(o.S1.index),o.R.time],W=o.R1.price-o.S1.price):F=="R"?(S=n.R1.price,C=n.S1.price,D=[s.R1.time,I(s.S1.index),s.R.time],W=n.S.price-n.R1.price):F!=""?(F=="F"?(S=s.R.price,C=s.S1.price,D=[s.R1.time,I(s.S1.index),s.S1.time]):F=="T"&&(S=n.S.price,C=n.R1.price,D=[o.R1.time,I(o.S1.index),n.R1.time]),W=d):(S=s.R.price,C=i.B.price,D=[o.R1.time,I(o.S1.index)],W=d),t&&(C=t);const E=C-S,O=.5*E,M=2*E,N=4*E,fe=parseInt(E/W*100);return{pattern:{items:y,selected:F},timeRange:D,info:{el1:p,el2:c,el3:l,fibo:fe,tR:C,X:O,Y:E,Z:M,W:N}}}function Te(i,r){let t=m.cloneDeep(i),o=m.cloneDeep(r);const s=o.price>t.price;let n={},p={};e.data.price.filter(d=>d.time>=t.time).every((d,f)=>{const v=d.value,h=d.time,y=Z(h);if(y==-1)return!1;if((f==0||v==t.price)&&(n={R:{index:y,time:h,price:v},S:{index:y,time:h,price:v}},p={R:n.R,S:n.S,pr:0,tr:0}),w(v,s,n.R.price)){const C=n.S.index-n.R.index,S=Math.abs(n.S.price-n.R.price);C>=p.tr&&(p.tr=C,p.pr=S,p.R=n.R,p.S=n.S),S>=p.pr&&Math.abs(n.R.price-p.R.price)/S<.2&&(p.S.index=n.S.index,p.tr=n.S.index-p.R.index,p.pr=S),n={R:{index:y,time:h,price:v},S:{index:y,time:h,price:v}}}else n.S.index=y,w(v,!s,n.S.price)&&(n.S.time=h,n.S.price=v);return w(v,!s,t.price)?(n.S.price=t.price,!1):!!w(v,!s,o.price)});const c=n.S.index-n.R.index;if(c>=p.tr){const d=Math.abs(n.S.price-n.R.price);p.tr=c,p.pr=d,p.R=n.R,p.S=n.S}o.time=I(n.S.index),o.index=Z(o.time),t.index=Z(t.time);const l=Math.abs(o.price-p.R.price);return{tr:p.tr,pr:p.pr,el:p.pr!=0?l/p.pr:0,S1:p.S,R1:p.R,S:t,R:o}}function U(i={}){let r=!m.isSet(i),t={isRemove:r,name:"pattern",points:[],data:[]};r||Object.entries(i).forEach(([o,s])=>{t.points.push(o),t.data.push(s)}),u.dispatch("tradingDerivative/drawTools",t)}function G(){m.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),m.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),m.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y),e.series.price.removePriceLine(e.tools.pattern.Z),e.series.price.removePriceLine(e.tools.pattern.W)))),ee(["pattern"])}function bt(i){a.showScanContext=!1,a.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function kt(i){pe(),i.target.classList.remove("selected")}function Dt(){let i={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let t={time:r,value:1};switch(e.tools.timeRange.length){case 0:t.color="OrangeRed",e.tools.timeRange[0]=t,i.points.push(0),i.data.push(r);break;case 1:t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(r),ne.value.classList.remove("selected");break;default:const o=Z(e.tools.timeRange[0].time),s=Z(e.tools.timeRange[1].time),p=Z(r)+(s-o),c=I(p);t.color="OrangeRed",e.tools.timeRange[0]=m.cloneDeep(t),i.points.push(0),i.data.push(r),t.time=c,t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(c),ne.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",i)}function ce(i){let r,t;if(i.length==2)r=i[0],t=i[1];else if(i.length==3){const s=Z(i[0]),n=Z(i[1]),c=Z(i[2])+(n-s);r=i[2],t=I(c)}else return!1;let o=[{time:r,value:1,color:"OrangeRed"},{time:t,value:1,color:"lime"}];e.tools.timeRange=o,e.series.timeRange.setData(o)}function pe(i=!0,r=!1){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),r||(e.series.timeRange.setData([]),ee(["tr"]))}function Ot(i){a.showScanContext=!1,a.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||i.target.classList.add("selected")}function Rt(i){a.showLineContext=!a.showLineContext,a.showPatternContext=!1,a.showScanContext=!1}function Lt(){const i="line",r=ue(e.crosshair.y),t=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const s=o.options(),n=s.type=r==+s.price;return n&&(e.series.price.removePriceLine(o),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:i,point:r})),!n}),e.tools.lines.length==t){const o=a.lineColor,s=a.lineTitle,n={lineType:i,price:r,color:o,title:s,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(n)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:i,points:[r],data:[{color:o,title:s}]})}se.value.classList.remove("selected")}function Pt(i){const t={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(i).forEach(([o,{color:s,title:n}])=>{t.price=+o,t.color=s,t.title=n,e.tools.lines.push(e.series.price.createPriceLine(t))})}function Be(i=!0){e.tools.lines.length>0&&(i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),ee(["lines"]))}function At(i){a.showScanContext=!1,a.showLineContext=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),r||(i.target.classList.add("selected"),be())}function Et(i){be(),i.target.classList.remove("selected")}function Wt(){const i="target",r=ue(e.crosshair.y);let t={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:i,points:[],data:[r]};if(m.isSet(e.tools.target.A)){const s=+e.tools.target.A.options().price,n=r-s;t.point="B",t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point),t.point="X",t.price=parseFloat((s-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((s-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((s-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((s-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t),ye.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),o.points.push(t.point);u.dispatch("tradingDerivative/drawTools",o)}function Zt(i){let t={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const o=i.A,s=i.B,n=s-o;t.point="A",t.price=o,t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="B",t.price=s,t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="X",t.price=parseFloat((o-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((o-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((o-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((o-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t)}function be(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),m.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),m.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z),e.series.price.removePriceLine(e.tools.target.W))),ee(["target"])}function _t(){z(["entry","tp","sl"],!1),Be(!1),be(!1),pe(!1),Fe(),G()}function de(i){if(i){if(Y()&&(m.isSet(e.tools.order.tp.line)||P.value.position&&e.currentSeconds>L.ATO&&e.currentSeconds<L.ATC&&(Q.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",Q.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",Q.value.style.display="block"),!m.isSet(e.tools.order.entry.line))){let r=null,t=0;P.value.position?(e.currentSeconds<L.ATO?r="ATO":e.currentSeconds>L.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,t=-P.value.position)):e.currentSeconds>L.ATO&&e.currentSeconds<L.ATC&&(r=ue(e.crosshair.y),t=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=t,e.tools.order.entry.price=r),t&&(V.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",V.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",V.value.style.background=t>0?"green":"red",V.value.innerText=`${t>0?"LONG":"SHORT"} ${r}`,V.value.style.display="block")}}else V.value.style.display="none",Q.value.style.display="none"}function Bt(){Y()&&(e.currentSeconds<L.ATO?Me(x("trading.derivative.atoOrder"),x("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(t=>{t.isOk?b.success(x("trading.derivative.atoOrderSuccess")):A(t.message)})}):e.currentSeconds<L.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(i=>{i.isOk?(X(["entry"]),b.success(x("trading.derivative.newEntrySuccess"))):A(i.message)}):Me(x("trading.derivative.atcOrder"),x("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(t=>{t.isOk?b.success(x("trading.derivative.atcOrderSuccess")):A(t.message)})}))}function It(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Ne,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*Xe,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(i=>{i.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),X(["entry","tp","sl"]),b.success(x("trading.derivative.newTpSlSuccess"))):A(i.message)})}function $t(){m.isSet(e.tools.order.entry.line)?m.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(i=>{i.isOk?(z(["entry","tp","sl"]),b.success(x("trading.derivative.exitSuccess"))):A(i.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(i=>{i.isOk?(z(["entry"]),b.success(x("trading.derivative.deleteEntrySuccess"))):A(i.message)}):K()}function Yt(i){m.isSet(e.tools.order.entry.line)&&(m.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&i>=e.tools.order.tp.price||e.tools.order.side<0&&i<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(z(["entry","tp","sl"]),b.success(x("trading.derivative.deleteTpSuccess")),de(!1)):A(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&i<=e.tools.order.sl.price||e.tools.order.side<0&&i>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(z(["entry","tp","sl"]),b.success(x("trading.derivative.deleteSlSuccess")),de(!1)):A(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&i>=e.tools.order.entry.price||e.tools.order.side<0&&i<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*Ne,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*Xe,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),X(["entry","tp","sl"]),b.success(x("trading.derivative.autoNewTpSlSuccess"))):A(r.message),e.isAutoOrdering=!1})},1e3))))}function Vt(){e.chart.timeScale().scrollToRealTime()}function Y(){return B.value.openingMarket&&e.currentSeconds>=L.START&&e.currentSeconds<=L.END}function ue(i){return parseFloat(e.series.price.coordinateToPrice(i).toFixed(1))}function A(i){i||(i="unknown"),b.error(x(`trading.derivative.${i}`))}function Mt(){if(!a.chartDate)return!1;u.dispatch("tradingDerivative/getChartData",a.chartDate)}function Ie(){Y()&&e.websocket.send(e.socketSendData)}function Nt(){e.data.whitespace=[],e.data.price=[],Ie(),u.dispatch("tradingDerivative/getChartData",a.chartDate)}function $e(){u.dispatch("tradingDerivative/getStatus")}function K(){u.dispatch("tradingDerivative/getTools")}function ee(i){i==null&&(i=["order","lines","tr","pattern","target"]),i.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),i.includes("lines")&&(e.tools.lines=[]),i.includes("target")&&(e.tools.target={}),i.includes("tr")&&(e.tools.timeRange=[]),i.includes("pattern")&&(e.tools.pattern={})}function Xt(){u.dispatch("tradingDerivative/getAccountInfo").then(i=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${x("trading.derivative.nav")}</div><div>: ${re.currency(i.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${x("trading.derivative.maxVol")}</div><div>: ${re.numberVnFormat(i.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${x("trading.derivative.vm")}</div><div>: ${re.currency(i.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${x("trading.derivative.fee")}</div><div>: ${re.currency(i.fee)}</div></div>`,r+="</div>",li(r,x("trading.derivative.accountInfo"))})}function zt(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/report"))}function Jt(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/export",a.chartDate))}function Ht(){Re.value.show()}function jt(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/loginDnse"))}function w(i,r,t,o=!1){return r?o?i>=t:i>t:o?i<=t:i<t}function Z(i){let r=e.data.whitespace.findIndex(t=>t.time==i);if(r==-1){const t=me(new Date(i*1e3),"yyyy-MM-dd"),o=k(new Date(`${t}T11:30:00Z`)),s=k(new Date(`${t}T13:00:00Z`)),n=k(new Date(`${t}T14:30:00Z`));i>o&&i<s?i=o:i>n&&(i=n),r=e.data.whitespace.findIndex(p=>p.time==i)}return r}function I(i){return e.data.whitespace[i].time}return(i,r)=>{const t=ci("DxToolbar");return pi(),ii(si,null,[g("div",hi,[ie(t,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:i.$t("trading.derivative.buttons.report"),onClick:zt}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:i.$t("trading.derivative.buttons.export"),onClick:Jt}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:i.$t("trading.derivative.buttons.loginVps"),onClick:Ht}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:i.$t("trading.derivative.buttons.loginDnse"),onClick:jt}}]},null,8,["items"]),g("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:_,onClick:tt,onContextmenu:it},[g("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:Oe},[g("div",{class:"area data-area",onClick:Pe,onContextmenu:Ae},[g("div",{ref_key:"connectionRef",ref:Je,class:$(["command",{yellow:P.value.pending}]),title:i.$t("trading.derivative.connection"),onClick:$e},[g("i",{class:$(["far",{"fa-link-simple":P.value.connection,"fa-link-simple-slash":!P.value.connection,blink:a.isSocketWarning}])},null,2)],10,yi),g("div",{class:$(["command status",{green:P.value.position>0,red:P.value.position<0}]),title:i.$t("trading.derivative.position"),onClick:Xt},Ve(P.value.position),11,xi),g("div",{class:"command clock",onClick:Ie},Ve(a.clock),1),H(g("input",{type:"date",class:"chart-date command",title:i.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=o=>a.chartDate=o),onChange:Mt},null,40,Si),[[oi,a.chartDate]]),g("div",{ref_key:"reloadToolRef",ref:qe,class:"command",title:i.$t("trading.derivative.reload"),onClick:Nt,onContextmenu:K},[g("i",{class:$(["far fa-sync-alt",{"fa-spin":Ge.value}])},null,2)],40,Ci)],32),g("div",{class:"area tool-area",onClick:Pe,onContextmenu:Ae},[g("div",{ref_key:"fullscreenToolRef",ref:He,class:"command",title:i.$t("trading.derivative.fullscreen"),onClick:nt},[g("i",{class:$(["far",{"fa-compress":a.isFullscreen,"fa-expand":!a.isFullscreen}])},null,2)],8,Fi),g("div",{ref_key:"tradingviewRef",ref:Qe,class:"command far fa-chart-candlestick",title:i.$t("trading.derivative.tradingview"),onClick:ut},null,8,wi),g("div",{class:$(["context command",{green:a.pattern.items.length}]),title:i.$t("trading.derivative.progressTool"),onClick:ft,onContextmenu:mt},[g("i",{class:$(["far",{"fa-badge-check":!a.pattern.items.length,[`fa-circle-${a.pattern.items.length}`]:a.pattern.items.length,blink:B.value.autoScan}])},null,2),H(ie(fi,{class:"contextmenu",items:a.pattern.items,selected:a.pattern.selected,onSelectPattern:vt},null,8,["items","selected"]),[[oe,a.showPatternContext]])],42,Ti),g("div",{ref_key:"scanToolRef",ref:xe,class:"context command",title:i.$t("trading.derivative.scanTool"),onClick:gt,onContextmenu:ht},[g("i",{class:$(["far",{[`fa-angles-${a.scanSide}`]:!0}])},null,2),H(ie(ui,{class:"contextmenu",modelValue:a.scanSide,"onUpdate:modelValue":r[1]||(r[1]=o=>a.scanSide=o)},null,8,["modelValue"]),[[oe,a.showScanContext]])],40,bi),g("div",{ref_key:"patternToolRef",ref:he,class:"command",title:i.$t("trading.derivative.patternTool"),onClick:Ft,onContextmenu:wt},Oi,40,ki),g("div",{ref_key:"timeRangeToolRef",ref:ne,class:"command",title:i.$t("trading.derivative.timeRangeTool"),onClick:bt,onContextmenu:kt},Pi,40,Ri),g("div",{ref_key:"lineToolRef",ref:se,class:"context command",title:i.$t("trading.derivative.lineTool"),onClick:Ot,onContextmenu:Rt},[Ei,H(ie(di,{class:"contextmenu",enable:a.showLineContext,title:a.lineTitle,"onUpdate:title":r[2]||(r[2]=o=>a.lineTitle=o),color:a.lineColor,"onUpdate:color":r[3]||(r[3]=o=>a.lineColor=o),onDeleteAllLine:Be},null,8,["enable","title","color"]),[[oe,a.showLineContext]])],40,Ai),g("div",{ref_key:"targetToolRef",ref:ye,class:"command",title:i.$t("trading.derivative.targetTool"),onClick:At,onContextmenu:Et},_i,40,Wi),H(g("div",{ref_key:"cancelOrderRef",ref:Ue,class:"cancel-order command",title:i.$t("trading.derivative.cancelTool"),onClick:$t},[g("i",{class:$(["far fa-trash-alt",{blink:a.isOrderWarning}])},null,2)],8,Bi),[[oe,Ke.value]])],32),g("div",null,[g("div",{ref_key:"entryOrderRef",ref:V,class:"order-button entry",onClick:Bt}," Entry ",512),g("div",{ref_key:"tpslOrderRef",ref:Q,class:"order-button tpsl",onClick:It}," TP/SL ",512),g("div",{class:"chart-top command far fa-angle-double-right",onClick:Vt})]),H(g("iframe",{ref_key:"tradingviewChartRef",ref:je,class:"tradingview-chart",style:ri(a.tradingViewStyle),src:et.value},null,12,Ii),[[oe,a.showTradingView]])],512)],544)]),ie(mi,{ref_key:"vpsOtpPopupRef",ref:Re},null,512)],64)}}};export{ji as default};
