import{_ as C,dK as y,Q as $,R as E,dL as P,dM as U,b as I,I as D,c as h,e as s,w as a,g as v,d as n,i as N,r as l,o as p,t as c,h as f}from"./app-cd1178e5.js";const{cookies:g}=y(),M={components:{DxForm:$,DxItem:E,DxDropDownButton:P,Photoswipe:U},data(){return{passwordMode:!0,loggedinUsers:[],formData:{username:null,password:null,rememberMe:!1,avatar:null,name:null},validationRules:{username:[{type:"required",message:this.$t("models.user.username")+this.$mt.validations.required}],password:[{type:"required",message:this.$t("models.user.password")+this.$mt.validations.required}]}}},created(){this.loggedinUsers=this.getLoggedinUsersCookie(),console.log("loggedinUsers",this.loggedinUsers),this.loggedinUsers.length>0&&(this.loggedinUsers.reverse(),this.formData={...this.formData,...this.loggedinUsers[0]})},mounted(){this.$devices.phone&&this.formData.webauthn?this.fingerPrintClick():setTimeout(()=>this.form.getEditor(this.formData.name?"password":"username").focus(),500)},computed:{form:function(){return this.$refs.form.instance}},methods:{...I("auth",["login","loginWebAuthn"]),onSubmit(){this.login(this.formData).then(({isOk:e,isMaintenance:t,user:i})=>this.responseProcess(e,t,i))},fingerPrintClick(){this.formData.username?this.loginWebAuthn(this.formData.username).then(({isOk:e,isMaintenance:t,user:i})=>this.responseProcess(e,t,i)).catch(()=>D.show(this.$t("messages.warning.unregisteredFingerPrint"))):D.show(this.$t("messages.warning.fingerUsernameEmpty"))},responseProcess(e,t,i){if(e)if(this.setLoggedinUsersCookie(i),t)this.$router.push({name:"setting-command"});else{let m=this.$route.query;const o=m.redirect?m.redirect:"overview";delete m.redirect,this.$router.push({name:o,query:m,hash:this.$route.hash})}},onCreateAccountClick(){this.$router.push({name:"create-account"})},viewPasswordClick(){this.form.itemOption("password",{editorOptions:{mode:this.passwordMode?"text":"password",buttons:[{options:{icon:this.passwordMode?"far fa-eye-slash":"far fa-eye",onClick:this.viewPasswordClick},name:"btPw",location:"after"}]}}),this.passwordMode=!this.passwordMode},getLoggedinUsersCookie(){return g.isKey(this.$mc.LOGGEDIN_USERS_COOKIE_NAME)?JSON.parse(g.get(this.$mc.LOGGEDIN_USERS_COOKIE_NAME)):[]},setLoggedinUsersCookie(e){let t=this.getLoggedinUsersCookie();t=t.filter(i=>i.username!=e.username),t.push(e),t=t.slice(-5),g.set(this.$mc.LOGGEDIN_USERS_COOKIE_NAME,JSON.stringify(t),"1y")},onItemClick(e){e.itemData.username?(this.formData={...this.formData,...e.itemData},this.$devices.phone&&e.itemData.webauthn?this.fingerPrintClick():setTimeout(()=>this.form.getEditor("password").focus(),500)):(this.formData.username=null,this.formData.name=null,this.formData.avatar=null,setTimeout(()=>this.form.getEditor("username").focus(),500))}}},O={class:"login-form"},S={key:0,class:"user"},L={style:{display:"flex","align-items":"center"}},A=["alt","src"],B={style:{"font-size":"16px",padding:"5px"}},R={class:"fingerprint"},T={class:"link"},q={class:"create-account"},G={class:"link"};function K(e,t,i,m,o,u){const k=l("Photoswipe"),x=l("DxDropDownButton"),r=l("DxItem"),_=l("DxForm"),b=l("DxButton"),w=l("RouterLink");return p(),h("div",O,[o.formData.name?(p(),h("div",S,[s(k,{images:[o.formData.avatar]},null,8,["images"]),s(x,{"split-button":!0,"use-select-mode":!1,items:[...o.loggedinUsers,{name:e.$t("auth.login.anotherAccount")}],text:o.formData.name,"display-expr":"name","key-expr":"username",itemTemplate:"itemTemplate",dropDownOptions:{minWidth:260,wrapperAttr:{class:"login-users-popup"}},onItemClick:u.onItemClick},{itemTemplate:a(({data:d})=>[n("div",L,[d.avatar?(p(),h("img",{key:0,alt:e.$appName,src:d.avatar,style:{width:"30px","border-radius":"50%","margin-right":"5px"}},null,8,A)):v("",!0),n("span",B,c(d.name),1)])]),_:1},8,["items","text","onItemClick"])])):v("",!0),n("form",{onSubmit:t[0]||(t[0]=N((...d)=>u.onSubmit&&u.onSubmit(...d),["prevent"]))},[s(_,{ref:"form","form-data":o.formData,labelMode:"floating"},{default:a(()=>[s(r,{visible:!o.formData.name,"data-field":"username","editor-type":"dxTextBox","validation-rules":o.validationRules.username,label:{text:e.$t("models.user.username")}},null,8,["visible","validation-rules","label"]),s(r,{name:"password","data-field":"password","editor-type":"dxTextBox","editor-options":{mode:"password",buttons:[{options:{icon:"far fa-eye",onClick:u.viewPasswordClick},name:"btPw",location:"after"}]},"validation-rules":o.validationRules.password,label:{text:e.$t("models.user.password")}},null,8,["editor-options","validation-rules","label"]),s(r,{"data-field":"rememberMe","editor-type":"dxCheckBox","editor-options":{text:e.$t("auth.login.rememberMe"),elementAttr:{class:"form-text"}},label:{visible:!1}},null,8,["editor-options"]),s(r,{"item-type":"button","button-options":{width:"100%",type:"default",text:e.$t("auth.login.submit"),useSubmitBehavior:!0}},null,8,["button-options"])]),_:1},8,["form-data"])],32),n("div",R,[s(b,{icon:"../../../images/fingerprint.png",onClick:u.fingerPrintClick},null,8,["onClick"])]),s(_,null,{default:a(()=>[s(r,null,{default:a(()=>[n("div",T,[s(w,{to:{name:"reset-password"}},{default:a(()=>[f(c(e.$t("auth.login.forgotPassword")),1)]),_:1})])]),_:1}),s(r,null,{default:a(()=>[n("div",q,[n("span",null,c(e.$t("auth.login.haveNotAccount")),1),f(" Â  "),n("span",G,[s(w,{to:{name:"create-account"}},{default:a(()=>[f(c(e.$t("auth.login.createAccount")),1)]),_:1})])])]),_:1})]),_:1})])}const V=C(M,[["render",K]]);export{V as default};
