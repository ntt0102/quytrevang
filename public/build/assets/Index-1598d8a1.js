import{u as Ee,b as Ae,c as Ve,i as W,r as b,d as Be,e as qe,x as $e,w as U,f as Xe,g as Me,h as F,j as D,l as Ye,z as je,C as ze,A as H,E as Z,F as Ne,o as Ie}from"./app-9c048dd5.js";import{_ as We}from"./spinner-40be0a1e.js";import Ue from"./ColorPicker-96b3ed9c.js";import{_ as He,a as Ze}from"./SettingPopup-7eaa84c2.js";import{c as Ge}from"./lightweight-charts.esm.development-03366bac.js";class Je{constructor(){this.create()}create(){return new Promise((C,v)=>{const w=indexedDB.open("stockChart",1);w.onupgradeneeded=u=>{this.store=u.target.result,this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("uplps",{keyPath:"title"}),this.store.createObjectStore("downlps",{keyPath:"title"}),C()},w.onsuccess=u=>{this.store=u.target.result,C()},w.onerror=()=>{location.reload(),v()}})}get(C){var v=this.store;return new Promise(function(u,y){var k=v.transaction(C,"readonly");if(Array.isArray(C)){var S=C.map(T=>k.objectStore(T)),_=S.map(w);Promise.all(_).then(T=>u(T))}else{var E=k.objectStore(C);w(E).then(T=>u(T))}});function w(u){return new Promise(function(y,k){const S=u.getAll();S.onsuccess=_=>y(_.target.result),S.onerror=()=>k()})}}set(C,v){const w=this.store.transaction(C,"readwrite").objectStore(C);Array.isArray(v)?v.length>0&&v.forEach(u=>w.put(u)):w.put(v)}clear(C){var v=this.store;return new Promise(function(w,u){const y=v.transaction(C,"readwrite").objectStore(C).clear();y.onsuccess=()=>{w()},y.onerror=k=>{console.error(`Error to empty Object Store: ${C}`),u()}})}}const o=new Je;const Ke={class:"content-block dx-card responsive-paddings"},Qe={class:"area data-area"},et={class:"area tool-area"},tt=["title"],rt=["title"],it=["title"],ot=["title"],st=["title"],lt=["title"],nt=["title"],ct=["title"],at=["src"],ht={__name:"Index",setup(G){const C={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},v=Ee();Ae(),Ve();const w=W("devices"),u=W("mf"),y=b(null),k=b(null),S=b(null),_=b(null),E=b(null),T=b(null),R=b(null),A=b(null),V=b(null),B=b(null),q=b(null),J=b(null);let e={chart:{},series:{},data:{whitespace:[],original:[],price:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},C:{},D:{}},pattern1:{A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},pattern2:{O:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const p=Be({symbol:"VNINDEX",symbols:[],isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),K=qe(()=>`https://chart.vps.com.vn/tv/?symbol=${p.symbol}`);v.dispatch("tradingStock/getSymbols").then(r=>p.symbols=r),o.create(),$e(()=>{e.chart=Ge(k.value,C),y.value.addEventListener("click",ee),y.value.addEventListener("contextmenu",Q),e.chart.subscribeCrosshairMove(te),e.chart.subscribeCustomPriceLineDragged(re),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",priceFormat:{minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(ie).observe(y.value),document.addEventListener("fullscreenchange",oe),v.dispatch("tradingStock/getChartData",p.symbol).then(()=>{le()})}),U(()=>v.state.tradingStock.chartData,ne),U(()=>v.state.tradingStock.isChartLoading,r=>{S.value.style.display=r?"block":"none"});function Q(r){r.preventDefault()}function ee(){R.value.classList.contains("selected")?O():A.value.classList.contains("selected")?ve():V.value.classList.contains("selected")?ge():B.value.classList.contains("selected")?j():q.value.classList.contains("selected")&&N()}function te(r){if(r.time){let t=r.seriesPrices.get(e.series.price);e.crosshair.time=r.time,e.crosshair.price=t}else w.phone||(e.crosshair.time=null,e.crosshair.price=null);r.point!=null&&(e.crosshair.x=r.point.x,e.crosshair.y=r.point.y)}function re(r){let t=r.customPriceLine,s=t.options();s.price=X(s.price);const l=+r.fromPriceString,c=s.price;switch(s.lineType){case"line":o.set("line",{price:l,removed:!0}),o.set("line",s),R.value.classList.remove("selected");break;case"ruler":switch(s.point){case"l0":if(o.set("ruler",s),e.ruler.pointCount==2){const g=+e.ruler.l1.options().title,Te=+(c-g).toFixed(1);e.ruler.ln1.applyOptions({price:Te}),o.set("ruler",e.ruler.ln1.options());const _e=+(c+g).toFixed(1);e.ruler.l1.applyOptions({price:_e}),o.set("ruler",e.ruler.l1.options());const Oe=+(c+g*2).toFixed(1);e.ruler.l2.applyOptions({price:Oe}),o.set("ruler",e.ruler.l2.options());const Re=+(c+g*3).toFixed(1);e.ruler.l3.applyOptions({price:Re}),o.set("ruler",e.ruler.l3.options());const De=+(c+g*4).toFixed(1);e.ruler.l4.applyOptions({price:De}),o.set("ruler",e.ruler.l4.options())}break;case"ln1":const n=+e.ruler.l0.options().price,i=c-n;t.applyOptions({title:i.toFixed(1)}),o.set("ruler",t.options()),e.ruler.l1.applyOptions({title:(-i).toFixed(1),price:+(n-i).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-i*2).toFixed(1),price:+(n-i*2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-i*3).toFixed(1),price:+(n-i*3).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-i*4).toFixed(1),price:+(n-i*4).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l1":const a=+e.ruler.l0.options().price,d=c-a;t.applyOptions({title:d.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-d).toFixed(1),price:+(a-d).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(d*2).toFixed(1),price:+(a+d*2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(d*3).toFixed(1),price:+(a+d*3).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(d*4).toFixed(1),price:+(a+d*4).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l2":const P=+e.ruler.l0.options().price,h=c-P;t.applyOptions({title:h.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-h*.5).toFixed(1),price:+(P-h*.5).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(h*.5).toFixed(1),price:+(P+h*.5).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(h*1.5).toFixed(1),price:+(P+h*1.5).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(h*2).toFixed(1),price:+(P+h*2).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l3":const x=+e.ruler.l0.options().price,L=c-x;t.applyOptions({title:L.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-L/3).toFixed(1),price:+(x-L/3).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(L/3).toFixed(1),price:+(x+L/3).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(L*2/3).toFixed(1),price:+(x+L*2/3).toFixed(1)}),o.set("ruler",e.ruler.l2.options());break;case"l4":const f=+e.ruler.l0.options().price,m=c-f;t.applyOptions({title:m.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-m/4).toFixed(1),price:+(f-m/4).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(m/4).toFixed(1),price:+(f+m/4).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(m/2).toFixed(1),price:+(f+m/2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(m*3/4).toFixed(1),price:+(f+m*3/4).toFixed(1)}),o.set("ruler",e.ruler.l3.options());break}break;case"pattern1":if(u.isSet(e.pattern1.C)){const n=+e.pattern1.A.options().price,a=+e.pattern1.B.options().price-n;e.pattern1.B.applyOptions({title:a.toFixed(1)}),o.set("pattern1",e.pattern1.B.options()),e.pattern1.C.applyOptions({price:+(n+.5*a).toFixed(1),title:(.5*a).toFixed(1)}),o.set("pattern1",e.pattern1.C.options()),e.pattern1.X1.applyOptions({price:+(n-.375*a).toFixed(1),title:(-.375*a).toFixed(1)}),o.set("pattern1",e.pattern1.X1.options()),e.pattern1.X2.applyOptions({price:+(n-.5*a).toFixed(1),title:(-.5*a).toFixed(1)}),o.set("pattern1",e.pattern1.X2.options()),e.pattern1.Y1.applyOptions({price:+(n-a).toFixed(1),title:-a.toFixed(1)}),o.set("pattern1",e.pattern1.Y1.options()),e.pattern1.Y2.applyOptions({price:+(n-2*a).toFixed(1),title:(-2*a).toFixed(1)}),o.set("pattern1",e.pattern1.Y2.options())}break}}function ie(){y.value&&(e.chart.resize(y.value.offsetWidth,y.value.offsetHeight),y.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function oe(){y.value&&(document.fullscreenElement?(p.isFullscreen=!0,y.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(p.isFullscreen=!1,y.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function se(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function le(){return new Promise(async r=>{(await o.get("line")).forEach(i=>{i.removed||e.lines.push(e.series.price.createPriceLine(i))});const s=await o.get("ruler");s.length>0&&(e.ruler.pointCount=s.length>1?2:1,s.forEach(i=>{e.ruler[i.point]=e.series.price.createPriceLine(i)}));const l=await o.get("pattern1");l.length>0&&l.forEach(i=>{e.pattern1[i.point]=e.series.price.createPriceLine(i)});const c=await o.get("uplps");c.length>0&&c.forEach(i=>{e.uplps[i.title]=e.series[i.title.includes("P")?"price":"cash"].createPriceLine(i)});const n=await o.get("downlps");n.length>0&&n.forEach(i=>{e.downlps[i.title]=e.series[i.title.includes("P")?"price":"cash"].createPriceLine(i)}),r()})}function ne(){e.data=v.state.tradingStock.chartData,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:p.symbol}})}function ce(r){p.showTradingView=!p.showTradingView,r.stopPropagation()}function ae(r){p.showColorPicker=!p.showColorPicker,r.stopPropagation()}function pe(r){u.isSet(e.pattern1.X)&&(O(+e.pattern1.X.options().price),O(+e.pattern1.Y.options().price),O(+e.pattern1.Z.options().price),O(+e.pattern1.T.options().price)),r.preventDefault(),r.stopPropagation()}function de(r){p.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||r.target.classList.add("selected"),r.stopPropagation()}function ue(r){fe(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function O(r=null,t=!1,s=!1){const l="line";r||(r=X($(e.crosshair.y)));const c=e.lines.length;if(e.lines=e.lines.filter(n=>{const i=n.options(),a=i.type=r==+i.price;return a&&(e.series.price.removePriceLine(n),o.set("line",{price:r,removed:!0})),!a}),e.lines.length==c&&!s||t){const n={lineType:l,price:r,color:p.color,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(n)),o.set("line",n)}R.value.classList.remove("selected")}function fe(){e.lines.forEach(r=>e.series.price.removePriceLine(r)),e.lines=[],o.clear("line")}function me(r){p.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||(r.target.classList.add("selected"),M()),r.stopPropagation()}function he(r){M(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function ve(){const r=$(e.crosshair.y);let t={lineType:"ruler",price:r,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)t.point="l0",t.color="#F44336",t.title="0",e.ruler[t.point]=e.series.price.createPriceLine(t),e.ruler.pointCount++,o.set("ruler",t);else{const s=+e.ruler.l0.options().price,l=r-s;t.point="l1",t.color="#FF9800",t.title=l.toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const c=-l;t.point="ln1",t.color="#FF9800",t.title=c.toFixed(1),t.price=+(s+c).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const n=2*l;t.point="l2",t.color="#FFEB3B",t.title=n.toFixed(1),t.price=+(s+n).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const i=3*l;t.point="l3",t.color="#4CAF50",t.title=i.toFixed(1),t.price=+(s+i).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const a=4*l;t.point="l4",t.color="#009688",t.title=a.toFixed(1),t.price=+(s+a).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t),e.ruler.pointCount++,A.value.classList.remove("selected")}}function M(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},o.clear("ruler"))}function ye(r){p.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||(r.target.classList.add("selected"),Y()),r.stopPropagation()}function Pe(r){Y(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function ge(){const r=$(e.crosshair.y);let t={lineType:"pattern1",price:r,lineWidth:1,lineStyle:1,draggable:!0};if(u.isSet(e.pattern1.A)){const s=+e.pattern1.A.options().price,l=r-s;t.point="B",t.title=l.toFixed(1),t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="C",t.price=+(s+.5*l).toFixed(1),t.title=(.5*l).toFixed(1),t.color="#FF9800",t.draggable=!1,e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="X1",t.price=+(s-.375*l).toFixed(1),t.title=(-.375*l).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="X2",t.price=+(s-.5*l).toFixed(1),t.title=(-.5*l).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="Y1",t.price=+(s-l).toFixed(1),t.title=-l.toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="Y2",t.price=+(s-2*l).toFixed(1),t.title=(-2*l).toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),V.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t)}function Y(){u.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),u.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X1),e.series.price.removePriceLine(e.pattern1.X2),e.series.price.removePriceLine(e.pattern1.Y1),e.series.price.removePriceLine(e.pattern1.Y2)),e.pattern1={A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},o.clear("pattern1"))}function Ce(r){p.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t?j():r.target.classList.add("selected"),r.stopPropagation()}function xe(r){z(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function j(){let r,t;u.isSet(e.uplps.P1)?(r=+e.uplps.P1.options().startTime,t=e.crosshair.time,z()):r=e.crosshair.time;const{price1:s,price2:l,cash1:c,cash2:n}=Fe(r,t);let i={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1};i.startTime=r,i.price=s,i.title="P1",e.uplps[i.title]=e.series.price.createPriceLine(i),o.set("uplps",i),i.price=l,i.title="P2",e.uplps[i.title]=e.series.price.createPriceLine(i),o.set("uplps",i),i.price=c,i.title="C1",e.uplps[i.title]=e.series.cash.createPriceLine(i),o.set("uplps",i),i.price=n,i.title="C2",e.uplps[i.title]=e.series.cash.createPriceLine(i),o.set("uplps",i),B.value.classList.remove("selected")}function Fe(r,t){let s,l,c,n=0,i=0,a,d,P=0,h=0;for(let x=0;x<e.data.price.length;x++){const L=e.data.price[x].time;if(L<r)continue;if(t&&L>t)break;const f=e.data.price[x].value,m=e.data.cash[x].value;if(s==null&&(s=f,l=f,c=f,a=m,d=m),f>c)n>i&&(l=c,i=n),c=f,n=0;else if(f<c){const g=+(c-f).toFixed(1);g>n&&(n=g)}if(f<s&&i>0)break;if(m>d)P>h&&(a=d,h=P),d=m,P=0;else if(m<d){const g=+(d-m).toFixed(1);g>P&&(P=g)}}return{price1:+(l-i).toFixed(2),price2:+(c-i).toFixed(2),cash1:+(a-h).toFixed(0),cash2:+(d-h).toFixed(0)}}function z(){u.isSet(e.uplps.P1)&&(e.series.price.removePriceLine(e.uplps.P1),e.series.price.removePriceLine(e.uplps.P2)),u.isSet(e.uplps.C1)&&(e.series.cash.removePriceLine(e.uplps.C1),e.series.cash.removePriceLine(e.uplps.C2)),e.uplps={P1:{},P2:{},C1:{},C2:{}},o.clear("uplps")}function we(r){p.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t?N():r.target.classList.add("selected"),r.stopPropagation()}function Le(r){I(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function N(){let r,t;u.isSet(e.downlps.P1)?(r=+e.downlps.P1.options().startTime,t=e.crosshair.time,I()):r=e.crosshair.time;const{price1:s,price2:l,cash1:c,cash2:n}=be(r,t);let i={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1};i.startTime=r,i.price=s,i.title="P1",e.downlps[i.title]=e.series.price.createPriceLine(i),o.set("downlps",i),i.price=l,i.title="P2",e.downlps[i.title]=e.series.price.createPriceLine(i),o.set("downlps",i),i.price=c,i.title="C1",e.downlps[i.title]=e.series.cash.createPriceLine(i),o.set("downlps",i),i.price=n,i.title="C2",e.downlps[i.title]=e.series.cash.createPriceLine(i),o.set("downlps",i),q.value.classList.remove("selected")}function be(r,t){let s,l,c,n=0,i=0,a,d,P=0,h=0;for(let x=0;x<e.data.price.length;x++){const L=e.data.price[x].time;if(L<r)continue;if(t&&L>t)break;const f=e.data.price[x].value,m=e.data.cash[x].value;if(s==null&&(s=f,l=f,c=f,a=m,d=m),f<c)n<i&&(l=c,i=n),c=f,n=0;else if(f>c){const g=+(c-f).toFixed(1);g<n&&(n=g)}if(f>s&&i<0)break;if(m<d)P<h&&(a=d,h=P),d=m,P=0;else if(m>d){const g=+(d-m).toFixed(1);g<P&&(P=g)}}return{price1:+(l-i).toFixed(1),price2:+(c-i).toFixed(1),cash1:+(a-h).toFixed(1),cash2:+(d-h).toFixed(1)}}function I(){u.isSet(e.downlps.P1)&&(e.series.price.removePriceLine(e.downlps.P1),e.series.price.removePriceLine(e.downlps.P2)),u.isSet(e.downlps.C1)&&(e.series.cash.removePriceLine(e.downlps.C1),e.series.cash.removePriceLine(e.downlps.C2)),e.downlps={P1:{},P2:{},C1:{},C2:{}},o.clear("downlps")}function $(r,t="price"){return X(e.series[t].coordinateToPrice(r))}function X(r){return r?+ +r.toFixed(1):0}function ke(r){if(!p.symbol)return!1;v.dispatch("tradingStock/getChartData",p.symbol)}function Se(){v.dispatch("tradingStock/cloneSymbols")}return(r,t)=>{const s=Xe("DxToolbar");return Ie(),Me(Ne,null,[F("div",Ke,[D(s,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-download-alt small",hint:r.$t("trading.stock.buttons.cloneSymbols"),onClick:Se}},{location:"before",widget:"dxButton",options:{icon:"far fa-filter small",hint:r.$t("trading.stock.buttons.filterCash"),onClick:()=>r.$refs.settingPopupRef.show()}}]},null,8,["items"]),F("div",{class:"stock-container",ref_key:"chartContainerRef",ref:y},[F("div",{class:"chart-wrapper",ref_key:"chartRef",ref:k},[F("div",Qe,[D(Ye(He),{width:r.$screen.getScreenSizeInfo.isXSmall?"140px":"130px",height:"30px","data-source":p.symbols,"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:"symbol-select"},modelValue:p.symbol,"onUpdate:modelValue":t[0]||(t[0]=l=>p.symbol=l),onValueChanged:ke},null,8,["width","data-source","modelValue"]),F("img",{ref_key:"spinnerRef",ref:S,class:"command spinner",src:We},null,512)]),F("div",et,[F("div",{ref_key:"fullscreenToolRef",ref:_,class:je(`command far fa-${p.isFullscreen?"compress":"expand"}`),title:r.$t("trading.orderChart.fullscreen"),onClick:se},null,10,tt),F("div",{ref_key:"tradingviewRef",ref:E,class:"command far fa-chart-bar",title:r.$t("trading.orderChart.tradingview"),onClick:ce},null,8,rt),F("div",{ref_key:"colorToolRef",ref:T,class:"color command far fa-palette",style:ze({color:p.color}),title:r.$t("trading.orderChart.colorTool"),onClick:ae,onContextmenu:pe},[H(D(Ue,{class:"color-picker",modelValue:p.color,"onUpdate:modelValue":t[1]||(t[1]=l=>p.color=l)},null,8,["modelValue"]),[[Z,p.showColorPicker]])],44,it),F("div",{ref_key:"lineToolRef",ref:R,class:"command far fa-horizontal-rule",title:r.$t("trading.orderChart.lineTool"),onClick:de,onContextmenu:ue},null,40,ot),F("div",{ref_key:"pattern1ToolRef",ref:V,class:"command far fa-dot-circle",title:r.$t("trading.orderChart.pattern1Tool"),onClick:ye,onContextmenu:Pe},null,40,st),F("div",{ref_key:"uplpsToolRef",ref:B,class:"command far fa-arrow-up",title:r.$t("trading.orderChart.uplpsTool"),onClick:Ce,onContextmenu:xe},null,40,lt),F("div",{ref_key:"downlpsToolRef",ref:q,class:"command far fa-arrow-down",title:r.$t("trading.orderChart.downlpsTool"),onClick:we,onContextmenu:Le},null,40,nt),F("div",{ref_key:"rulerToolRef",ref:A,class:"command far fa-line-height",title:r.$t("trading.orderChart.rulerTool"),onClick:me,onContextmenu:he},null,40,ct)]),H(F("iframe",{ref_key:"tradingviewChartRef",ref:J,class:"tradingview-chart",src:K.value},null,8,at),[[Z,p.showTradingView]])],512)],512)]),D(Ze,{ref:"settingPopupRef"},null,512)],64)}}};export{ht as default};
