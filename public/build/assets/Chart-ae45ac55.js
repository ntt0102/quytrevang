import{z as pt,A as dt,B as ut,r as F,y as Ye,C as et,o as H,b as J,d as M,E as ae,c as ce,G as Te,H as _e,I as ft,J as mt,m as tt,e as ee,F as We,K as Ze,t as ye,h as me,u as Oe,k as fe,L as vt,M as ht,N as Ue,O as it,g as nt,w as ve,Q as gt,R as St,S as Qe,x as oe,l as Le,a as yt,T as Me,U as Tt,j as xt,V as Ct}from"./app-77e91471.js";import{_ as kt}from"./text-box-8ad94eef.js";import{g as G}from"./getUnixTime-021b8b0d.js";import{c as _t}from"./lightweight-charts.esm.development-03366bac.js";function st(P,I,x){return pt((x==null?void 0:x.in)||P,+dt(P)+I)}function ke(P,I,x){return st(P,I*ut,x)}function bt(P,I,x){return st(P,I*1e3,x)}function Ve(P,I,x){return bt(P,-I,x)}const wt=["title"],Dt={__name:"FullscreenTool",props:["chartContainerRef"],setup(P){const I=P,x=F(!1);Ye(()=>{document.addEventListener("fullscreenchange",t)}),et(()=>{document.removeEventListener("fullscreenchange",t)});function f(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function t(){I.chartContainerRef&&(document.fullscreenElement?(x.value=!0,I.chartContainerRef.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(x.value=!1,I.chartContainerRef.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}return(s,y)=>(H(),J("div",{class:"command",title:s.$t("trading.derivative.fullscreen"),onClick:f},[M("i",{class:ae(["far",{"fa-compress":x.value,"fa-expand":!x.value}])},null,2)],8,wt))}},Rt=["title"],Et=["src"],Lt={__name:"TradingviewTool",props:["vpsUser","vpsSession","chartContainerRef"],setup(P){const I=P,x=F(null),f=F(!1),t=ce(()=>`https://chart.vps.com.vn/tv/?u=${I.vpsUser}&s=${I.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);function s(T){f.value=!f.value,y(),T.stopPropagation()}function y(){if(I.chartContainerRef&&x.value){const{offsetWidth:T,offsetHeight:$}=I.chartContainerRef,{top:c,left:v}=x.value.getBoundingClientRect();x.value.style.top=`${c-2}px`,x.value.style.left=`${v+32}px`,x.value.style.width=`${T-34}px`,x.value.style.height=`${$}px`}}return(T,$)=>(H(),J("div",{class:"tradingview command far fa-chart-candlestick",title:T.$t("trading.derivative.tradingview"),onClick:s},[Te(M("iframe",{ref_key:"tradingviewRef",ref:x,class:"chart",src:t.value},null,8,Et),[[_e,f.value]])],8,Rt))}};const Ot=M("div",{class:"triangle-shadow"},null,-1),Pt=M("div",{class:"triangle"},null,-1),$t={class:"container"},It={__name:"ProgressContext",props:["progress"],emits:["refreshPattern"],setup(P,{emit:I}){const x=I,f=F([]);Ye(()=>{t()});function t(){ft(Object.assign({"../../../../../lang/vi/derivative.js":()=>mt(()=>import("./derivative-0a1a41d1.js"),[])}),`../../../../../lang/${window.lang}/derivative.js`).then(T=>{f.value=T.default||[]})}function s(){x("refreshPattern")}function y(T){T.stopPropagation()}return(T,$)=>{const c=tt("DxButton");return H(),J("div",{class:"pattern-context",onClick:y},[Ot,Pt,M("div",null,[ee(c,{icon:"refresh",type:"success",text:T.$t("trading.derivative.progressContext.refreshPattern"),onClick:s},null,8,["text"])]),M("div",$t,[(H(!0),J(We,null,Ze(f.value,(v,S)=>(H(),J("div",{key:S,class:ae(["step",[P.progress.step&&P.progress.step===S+1?P.progress.result?"success":"fail":""]])},[M("div",{class:ae(["name",[P.progress.steps?P.progress.steps[S].every(Boolean)?"success":"fail":""]])},ye(S+1)+". "+ye(v.name),3),M("div",null,[(H(!0),J(We,null,Ze(v.conds,(B,N)=>(H(),J("div",{key:N,class:ae(["condition",[P.progress.steps?P.progress.steps[S][N]?"success":"fail":""]])},ye(N+1)+". "+ye(B),3))),128))])],2))),128))])])}}},At=["title"],Nt={__name:"ProgressTool",props:[],emits:["refreshPattern","hideContext"],setup(P,{expose:I,emit:x}){const f=me(),{t}=Oe(),s=fe("mf"),y=x,T=F({}),$=F(!1),c=ce(()=>f.state.tradingDerivative.config.autoRefresh);I({hide:S,set:B});function v(){const l=$.value;y("hideContext"),$.value=!l,$.value&&N()}function S(l=!1){$.value=l}function B(l){c.value&&W(l,T.value),T.value=l}function N(){y("refreshPattern")}function Z(){f.dispatch("tradingDerivative/setAutoRefresh",!c.value)}function W(l,r){if(s.isSet(l)&&(l.step!==r.step||l.step===r.step&&l.result!==r.result)){let h="";l.result?[2,4].includes(l.step)?h=t("trading.derivative.progressOrder",l):h=t("trading.derivative.progressSuccess",l):h=t("trading.derivative.progressFail",l),A(h)}}function A(l){const r=new SpeechSynthesisUtterance(l);r.lang="vi-VN",speechSynthesis.speak(r)}return(l,r)=>(H(),J("div",{class:ae(["context command",{green:T.value.result===!0,red:T.value.result===!1}]),title:l.$t("trading.derivative.progressTool"),onClick:v,onContextmenu:Z},[M("i",{class:ae(["far",{"fa-badge-check":!T.value.step,[`fa-circle-${T.value.step}`]:T.value.step,blink:c.value}])},null,2),Te(ee(It,{class:"contextmenu",progress:T.value,onRefreshPattern:N},null,8,["progress"]),[[_e,$.value]])],42,At))}};var xe={};const Bt=vt(ht);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Ft=Ue&&Ue.__importDefault||function(P){return P&&P.__esModule?P:{default:P}};Object.defineProperty(xe,"__esModule",{value:!0});xe.DxItem=xe.DxButtonGroup=void 0;var Mt=Ft(Bt),Vt=it,Wt=it,rt=Vt.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttonTemplate:{},disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,items:Array,keyExpr:[Function,String],onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onOptionChanged:Function,onSelectionChanged:Function,rtlEnabled:Boolean,selectedItemKeys:Array,selectedItems:Array,selectionMode:String,stylingMode:String,tabIndex:Number,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttonTemplate":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:items":null,"update:keyExpr":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onOptionChanged":null,"update:onSelectionChanged":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectedItems":null,"update:selectionMode":null,"update:stylingMode":null,"update:tabIndex":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Mt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}}}});xe.DxButtonGroup=rt;var ze=Wt.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:elementAttr":null,"update:hint":null,"update:html":null,"update:icon":null,"update:template":null,"update:text":null,"update:type":null,"update:visible":null},props:{disabled:Boolean,elementAttr:Object,hint:String,html:String,icon:String,template:{},text:String,type:String,visible:Boolean}});xe.DxItem=ze;ze.$_optionName="items";ze.$_isCollectionItem=!0;var Zt=xe.default=rt;const Yt=M("div",{class:"triangle-shadow"},null,-1),zt=M("div",{class:"triangle"},null,-1),Ht={__name:"ScanContext",props:["modelValue"],emits:["update:modelValue"],setup(P,{emit:I}){const{t:x}=Oe(),f=[{icon:"chevrondoubleleft",side:"left",text:x("trading.derivative.scanContext.leftScan")},{icon:"chevrondoubleright",side:"right",text:x("trading.derivative.scanContext.rightScan")}],t=P,s=I;function y({itemData:{side:$}}){s("update:modelValue",$)}function T($){$.stopPropagation()}return($,c)=>(H(),J("div",{class:"scan-context",onClick:T},[Yt,zt,ee(nt(Zt),{items:f,"selected-item-keys":[t.modelValue],"key-expr":"side","styling-mode":"outlined",onItemClick:y},null,8,["selected-item-keys"])]))}},Jt=["title"],Xt={__name:"ScanTool",props:["prices","timeToIndex"],emits:["scaned","removePattern","hideContext"],setup(P,{expose:I,emit:x}){const f=fe("mf"),t=P,s=x,y=F(null),T=F(!1),$=F("left");I({isSelected:c,hide:v,draw:N});function c(){return y.value.classList.contains("selected")}function v(){T.value=!1}function S(l){s("hideContext");const r=l.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(h=>h.classList.remove("selected")),r||(l.target.classList.add("selected"),s("removePattern"))}function B(){const l=T.value;s("hideContext"),T.value=!l}function N({time:l}){const r=$.value==="left",h=l?t.prices.filter(a=>!f.cmp(a.time,r,l)):t.prices;let i=r?Z(h):W(h);f.isSet(i)&&s("scaned",A(i)),y.value.classList.remove("selected")}function Z(l){let r,[h,i,a,g]=Array(4).fill({});for(let m=l.length-1;m>=0;m--){const b=l[m].value,C=l[m].time,e=t.timeToIndex(C);if(e===-1)break;if(m===l.length-1&&(a={index:e,time:C,price:b},[i,h,g]=Array(3).fill(null).map(()=>f.cloneDeep(a))),r===void 0){if(b===a.price)continue;r=b>a.price}if(f.cmp(b,r,i.price)&&(f.cmp(h.price,!r,a.price)?([a,i]=[i,h].map(d=>f.cloneDeep(d)),h={index:e,time:C,price:b},g=f.cloneDeep(h),r=!r):i={index:e,time:C,price:b}),f.cmp(b,!r,h.price)?(h={index:e,time:C,price:b},g=f.cloneDeep(h)):g.index=e,f.cmp(b,r,g.price)&&(g={index:e,time:C,price:b}),a.index>h.index){const d=f.fmtNum(i.price-a.price,1,!0);if(d>=1&&(h.index-g.index>a.index-i.index||f.fmtNum(h.price-g.price,1,!0)>d))break}}return{A:h,B:i,C:a}}function W(l){let r,[h,i,a]=Array(3).fill({});for(let g=0;g<l.length;g++){const m=l[g].value,b=l[g].time,C=t.timeToIndex(b);if(C===-1)break;if(g===0&&(h={index:C,time:b,price:m},i=f.cloneDeep(h),a=f.cloneDeep(h)),r===void 0){if(m===h.price)continue;r=m>h.price}f.cmp(m,r,i.price)&&(i={index:C,time:b,price:m},a=f.cloneDeep(i)),f.cmp(i.price,r,h.price)&&f.cmp(m,!r,a.price)&&(f.cmp(m,r,h.price)?a={index:C,time:b,price:m}:(h=f.cloneDeep(i),i={index:C,time:b,price:m},a=f.cloneDeep(i),r=!r))}return{A:h,B:i,C:a}}function A(l){const r={};return Object.entries(l).forEach(([h,i])=>{const{index:a,...g}=i;r[h]=g}),r}return(l,r)=>(H(),J("div",{ref_key:"scanToolRef",ref:y,class:"context command",title:l.$t("trading.derivative.scanTool"),onClick:S,onContextmenu:B},[M("i",{class:ae(["far",{[`fa-angles-${$.value}`]:!0}])},null,2),Te(ee(Ht,{class:"contextmenu",modelValue:$.value,"onUpdate:modelValue":r[0]||(r[0]=h=>$.value=h)},null,8,["modelValue"]),[[_e,T.value]])],40,Jt))}},jt=["title"],qt=M("i",{class:"far fa-heart-rate"},null,-1),Ut=[qt],Qt={__name:"PatternTool",props:["prices","priceSeries","timeMarkSeries","pickTimeToolRef","timeToIndex","indexToTime"],emits:["setProgress","hideContext"],setup(P,{expose:I,emit:x}){const f=me(),t=fe("mf"),s=P,y=x,T=F(null),$=ce(()=>f.state.tradingDerivative.tools.pattern);let c={},v={};I({isSelected:S,draw:Z,load:W,refresh:l,remove:b,drag:d}),ve($,p=>{p&&W(p,{isCheck:!0})});function S(){return T.value.classList.contains("selected")}function B(p){y("hideContext");const n=p.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(k=>k.classList.remove("selected")),n||(p.target.classList.add("selected"),s.pickTimeToolRef.remove())}function N(p){p.target.classList.remove("selected"),y("hideContext"),b()}function Z({time:p,price:n}){let u={lineType:"pattern",price:n,lineWidth:1,lineStyle:1,draggable:!0};if(t.isSet(v.A))if(t.isSet(v.B)){let _,w;if(t.isSet(v.C)){let E,D;c.A={time:p,price:n};const{progress:L,timeMark:V,info:{rEpr1:X,rEpr2:U,rEpr3:se,entry:te,pStatus:ie,x:ne,X:j,y:Q,Y}}=r();w=L,_=V,E="A",D={price:n,title:`A ${X}`},v[E].applyOptions(D),E="B",D={title:`B ${U}`},v[E].applyOptions(D),E="C",D={title:`C ${se}`},v[E].applyOptions(D),E="D",D={price:te,title:"Entry "+ie},v[E].applyOptions(D),E="X",D={price:t.fmtNum(ne),title:`X ${t.fmtNum(j)}`},v[E].applyOptions(D),E="Y",D={price:t.fmtNum(Q),title:`Y ${t.fmtNum(Y)}`},v[E].applyOptions(D)}else{c.C={price:n};const{progress:E,timeMark:D,info:{rEpr1:L,rEpr2:V,rEpr3:X,entry:U,pStatus:se,x:te,X:ie,y:ne,Y:j}}=r();w=E,_=D;let Q="A";v[Q].applyOptions({title:`A ${L}`}),Q="B",v[Q].applyOptions({title:`B ${V}`}),u.point="C",u.title=`C ${X}`,u.color="#FFEB3B",v[u.point]=s.priceSeries.createPriceLine(u),u.point="D",u.price=U,u.title="Entry "+se,u.color="#9C27B0",u.draggable=!1,v[u.point]=s.priceSeries.createPriceLine(u),u.point="Y",u.price=t.fmtNum(ne),u.title=`Y ${t.fmtNum(j)}`,u.color="#E91E63",u.draggable=!1,v[u.point]=s.priceSeries.createPriceLine(u),u.point="X",u.price=t.fmtNum(te),u.title=`X ${t.fmtNum(ie)}`,u.color="#2196F3",u.draggable=!1,v[u.point]=s.priceSeries.createPriceLine(u)}m(),y("setProgress",w),e(_),T.value.classList.remove("selected")}else u.point="B",u.title="B 0",u.color="#4CAF50",v[u.point]=s.priceSeries.createPriceLine(u),c.B={price:n};else u.point="A",u.title="A 0",u.color="#F44336",v[u.point]=s.priceSeries.createPriceLine(u),c={A:{time:p,price:n}}}function W(p,{isSave:n=!1,isCheck:k=!1}){c=t.cloneDeep(p),n&&m(),(k?i(c):!0)&&(C(),A())}function A(){let n={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{A:k,B:u,C:_}=c,{progress:w,timeMark:E,info:{rEpr1:D,rEpr2:L,rEpr3:V,entry:X,pStatus:U,x:se,X:te,y:ie,Y:ne}}=r();y("setProgress",w),e(E),n.point="A",n.title=`A ${D}`,n.color="#F44336",n.price=k.price,v[n.point]=s.priceSeries.createPriceLine(n),n.point="B",n.title=`B ${L}`,n.color="#4CAF50",n.price=u.price,v[n.point]=s.priceSeries.createPriceLine(n),n.point="C",n.price=_.price,n.title=`C ${V}`,n.color="#FFEB3B",v[n.point]=s.priceSeries.createPriceLine(n),n.point="D",n.price=X,n.title="Entry "+U,n.color="#9C27B0",n.draggable=!1,v[n.point]=s.priceSeries.createPriceLine(n),n.point="Y",n.price=t.fmtNum(ie),n.title=`Y ${t.fmtNum(ne)}`,n.color="#E91E63",n.draggable=!1,v[n.point]=s.priceSeries.createPriceLine(n),n.point="X",n.price=t.fmtNum(se),n.title=`X ${t.fmtNum(te)}`,n.color="#2196F3",n.draggable=!1,v[n.point]=s.priceSeries.createPriceLine(n)}function l(p=!1){t.isSet(v.C)&&(p&&g(),C(),A())}function r(){const{A:p,B:n,C:k}=c,u=n.price-k.price,_=u>0,w=h({phase:1,start:p,end:n,retracementPrice:k.price});let E=h({phase:2,start:w.R,end:k});const D=h({phase:3,start:E.R,end:{price:n.price+(_?1:-1)*w.rEp},breakPrices:[E.S1.price,n.price]});w.xBox.tr>=E.tr&&(E.tr=w.xBox.tr),console.log("calculatePattern",[w,E,D]);const L=t.fmtNum(u,1,!0)>=w.pr,V=t.fmtNum(k.price-D.xBox.R.price,1,!0)>=E.pr,X=t.fmtNum(D.xBox.pr)>=D.pr,U=!t.cmp(k.price,!_,w.S1.price),se=!t.cmp(D.xBox.R.price,_,E.S1.price),te=!t.cmp(D.xBox.S.price,!_,D.S1.price),ie=w.R.index+w.tr,ne=w.R.index+5*w.tr,j=E.R.index+E.tr,Q=D.xBox.R.index+D.tr,Y=D.xBox.R.index+5*D.tr,re=D.xBox.R.index+E.tr,Pe=[ie,ne,j,Q,Y,re],le=D.xBox.S.index;let he,q={};const Ce=[E.R.index>ie,w.rEpr<3,E.rEpr<w.rEpr];q.steps=[[L||w.rEt<w.tr&&w.rEp>=w.sEp,U,!D.breakIndexs[1]||ie<D.breakIndexs[1],le>ie,le<ne],[...Ce,j>ie,le<Y,le<j],[E.R.index-w.R.index>.5*w.tr,V,!D.breakIndexs[1]||j<D.breakIndexs[1],le>j],[X,te,le>Q,Ce.every(Boolean)||le>re]],q.step=1,q.result=q.steps[0].every(Boolean),he=w.R1.price,q.result&&(le<=j?(q.step=2,q.result=q.steps[1].every(Boolean),he=E.S1.price):(q.step=3,q.result=q.steps[2].every(Boolean),he=D.R1.price,q.result&&(q.step=4,q.result=q.steps[3].every(Boolean),q.result&&(he=D.xBox.R.price))));const $e=`${U?L?1:0:2}${se?V?1:0:2}${te?X?1:0:2}`,ge=w.rEp,Ie=a(n.price,ge,_),Ae=D.breakIndexs[1]??le,be=parseInt((Ae-w.R.index)/w.tr),we=be>1?ge*be:ge,Ne=a(n.price,we,_);return{progress:q,timeMark:Pe,info:{rEpr1:w.rEpr,rEpr2:E.rEpr,rEpr3:D.rEpr,entry:he,pStatus:$e,x:Ie,X:ge,y:Ne,Y:we}}}function h({phase:p,start:n,end:k,breakPrices:u,retracementPrice:_}){let w=t.cloneDeep(n),E=t.cloneDeep(k);const D=E.price>w.price;let L={},V={},X={},U=[null,null],se,te,ie;const ne=s.pickTimeToolRef.get();return s.prices.filter(j=>{let Q=j.time>=w.time;return ne&&(Q&=j.time<=ne),Q}).every((j,Q)=>{const Y=j.value,re=s.timeToIndex(j.time);return re===-1?!1:(Q===0&&(L={R:{index:re,price:Y},S:{index:re,price:Y},pr:0,tr:0},V=t.cloneDeep(L),X=t.cloneDeep(L)),t.cmp(Y,D,L.R.price)?(L.pr>0&&((L.pr>V.pr||L.pr===V.pr&&L.tr>=V.tr)&&(V.pr=L.pr,V.R=t.cloneDeep(L.R),V.S=t.cloneDeep(L.S)),L.tr>V.tr&&(V.tr=L.tr),p===1&&_&&!t.cmp(L.S.price,!D,_)&&L.tr>=X.tr&&L.pr>=X.pr&&(X=t.cloneDeep(L))),L={R:{index:re,price:Y},S:{index:re,price:Y},pr:0,tr:0},p===3&&u&&(!U[0]&&t.cmp(Y,D,u[0])&&(U[0]=re),!U[1]&&t.cmp(Y,D,u[1])&&(U[1]=re))):(L.S.index=re,L.tr=L.S.index-L.R.index,t.cmp(Y,!D,L.S.price)&&(L.S.price=Y,L.pr=t.fmtNum(L.S.price-L.R.price,1,!0))),t.cmp(Y,!D,w.price)?(L.S.price=w.price,!1):!!t.cmp(Y,!D,E.price))}),t.isSet(L)&&(w.index=s.timeToIndex(w.time),E.index=L.S.index,E.time=s.indexToTime(L.S.index),se=t.fmtNum(E.price-V.R.price,1,!0),te=t.fmtNum(w.price-V.S.price,1,!0),ie=E.index-V.S.index,p===3&&(X=L)),{tr:V.tr,pr:V.pr,rEp:se,sEp:te,rEpr:V.pr?t.fmtNum(se/V.pr):0,rEt:ie,S1:V.S,R1:V.R,xBox:X,S:w,R:E,breakIndexs:U}}function i({A:{time:p}}){return p>=s.prices[0].time&&p<s.prices.at(-1).time}function a(p,n,k){const u=p+(k?1:-1)*n;let _=t.fmtNum(u%1);if(k){if(_>=.1&&_<=.2)return Math.floor(u);if(_>=.6&&_<=.7)return Math.floor(u)+.5}else{if(_>=.8&&_<=.9)return Math.ceil(u);if(_>=.3&&_<=.4)return Math.floor(u)+.5}return u}function g(){if(s.pickTimeToolRef.get())return!1;const n=c.B.price-c.A.price>0,k=s.prices.at(-1).value;if(t.cmp(k,!n,c.C.price)){let u=k;for(let _=s.prices.length-1;_>=0;_--){const w=s.prices[_].value;if(w===c.B.price)break;u=n?Math.min(u,w):Math.max(u,w)}c.C.price=u,m()}}function m(p=!1){let n={isRemove:p,name:"pattern",points:[],data:[]};p?c={}:Object.entries(c).forEach(([k,u])=>{n.points.push(k),n.data.push(u)}),f.dispatch("tradingDerivative/drawTools",n)}function b(){m(!0),s.pickTimeToolRef.remove(),C(),y("setProgress",{})}function C(){t.isSet(v.A)&&(s.priceSeries.removePriceLine(v.A),t.isSet(v.B)&&(s.priceSeries.removePriceLine(v.B),t.isSet(v.C)&&(s.priceSeries.removePriceLine(v.C),s.priceSeries.removePriceLine(v.D),s.priceSeries.removePriceLine(v.X),s.priceSeries.removePriceLine(v.Y)))),v={},e([])}function e(p){const n=["#F44336","#F44336","#4CAF50","#FFEB3B","#FFEB3B","#2196F3"];let k=[];for(let u=0;u<p.length;u++){let _=s.indexToTime(p[u]);_&&(p.indexOf(p[u])!==p.lastIndexOf(p[u])&&(_+=u),k.push({time:_,value:1,color:n[u]}))}k.length&&k.sort((u,_)=>u.time-_.time),s.timeMarkSeries.setData(k)}function d({lineOptions:p}){if(t.isSet(v.C)){let n,k;c={A:{time:c.A.time,price:+v.A.options().price},B:{price:+v.B.options().price},C:{price:+v.C.options().price}},m();const{progress:u,timeMark:_,info:{rEpr1:w,rEpr2:E,rEpr3:D,entry:L,pStatus:V,x:X,X:U,y:se,Y:te}}=r();y("setProgress",u),e(_),n="A",k={title:`A ${w}`},v[n].applyOptions(k),n="B",k={title:`B ${E}`},v[n].applyOptions(k),n="C",k={title:`C ${D}`},v[n].applyOptions(k),n="D",k={price:L,title:"Entry "+V},p.point===n&&delete k.price,v[n].applyOptions(k),n="X",k={price:t.fmtNum(X),title:`X ${t.fmtNum(U)}`},v[n].applyOptions(k),n="Y",k={price:t.fmtNum(se),title:`Y ${t.fmtNum(te)}`},v[n].applyOptions(k)}}return(p,n)=>(H(),J("div",{ref_key:"patternToolRef",ref:T,class:"command",title:p.$t("trading.derivative.patternTool"),onClick:B,onContextmenu:N},Ut,40,jt))}},Gt=["title"],Kt=M("i",{class:"far fa-pipe"},null,-1),ei=[Kt],ti={__name:"PickTimeTool",props:["pickTimeSeries"],emits:["refreshPattern","hideContext"],setup(P,{expose:I,emit:x}){const f=me(),t=P,s=x,y=F(null),T=ce(()=>f.state.tradingDerivative.tools.pickTime);let $=null;I({isSelected:c,draw:N,remove:W,get:v}),ve(T,A=>{A&&Z(A[0])});function c(){return y.value.classList.contains("selected")}function v(){return $}function S(A){s("hideContext");const l=A.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(r=>r.classList.remove("selected")),l||A.target.classList.add("selected")}function B(A){A.target.classList.remove("selected"),W(),s("refreshPattern")}function N({time:A}){f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"pickTime",points:[0],data:[A]}),Z(A),s("refreshPattern"),y.value.classList.remove("selected")}function Z(A){$=A,t.pickTimeSeries.setData([{time:A,value:1,color:"#9C27B0"}])}function W(A=!0){A&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"pickTime"}),t.pickTimeSeries.setData([]),$=null}return(A,l)=>(H(),J("div",{ref_key:"pickTimeToolRef",ref:y,class:"command",title:A.$t("trading.derivative.pickTimeTool"),onClick:S,onContextmenu:B},ei,40,Gt))}};const ii=M("div",{class:"triangle-shadow"},null,-1),ni=M("div",{class:"triangle"},null,-1),si={class:"input"},ri={class:"color"},oi=["onClick"],ai={__name:"LineContext",props:["enable","title","color"],emits:["update:title","update:color"],setup(P,{emit:I}){const x=P,f=I,t=F(null),s=F(["#F44336","#FF9800","#FFEB3B","#4CAF50","#009688","#00BCD4","#2196F3","#673AB7","#9C27B0","#E91E63"]);ve(()=>x.enable,v=>{v&&gt().then(()=>t.value.instance.focus())});function y({value:v}){f("update:title",v)}function T(v){f("update:color",v)}function $(){f("deleteAllLine")}function c(v){v.stopPropagation()}return(v,S)=>{const B=tt("DxButton");return H(),J("div",{class:"line-context",onClick:c},[ii,ni,M("div",si,[ee(nt(kt),{ref_key:"titleRef",ref:t,value:x.title,"show-clear-button":!0,"input-attr":{style:`color:${x.color}`},onValueChanged:y},null,8,["value","input-attr"]),ee(B,{icon:"trash",type:"danger",onClick:S[0]||(S[0]=N=>$())})]),M("div",ri,[(H(!0),J(We,null,Ze(s.value,(N,Z)=>(H(),J("div",{class:"color-swatch",style:St({background:N,boxShadow:`0 0 4px ${N}`}),key:Z,onClick:W=>T(N)},null,12,oi))),128))])])}}},ci=["title"],li=M("i",{class:"far fa-horizontal-rule"},null,-1),pi={__name:"LineTool",props:["priceSeries"],emits:["hideContext"],setup(P,{expose:I,emit:x}){const f=me(),t=P,s=x,y=F(null),T=F(!1),$=ce(()=>f.state.tradingDerivative.tools.line),c=F(""),v=F("#F44336");let S=[];I({isSelected:B,hide:N,draw:A,drag:i}),ve($,a=>{a&&l(a)});function B(){return y.value.classList.contains("selected")}function N(){T.value=!1}function Z(a){s("hideContext");const g=a.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(m=>m.classList.remove("selected")),g||a.target.classList.add("selected")}function W(a){const g=T.value;s("hideContext"),T.value=!g}function A({price:a}){const g="line",m=S.length;if(S=S.filter(b=>{const C=b.options(),e=C.type=a===+C.price;return e&&(t.priceSeries.removePriceLine(b),f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:g,point:a})),!e}),S.length===m){const b=v.value,C=c.value,e={lineType:g,price:a,color:b,title:C,lineWidth:1,lineStyle:1,draggable:!0};S.push(t.priceSeries.createPriceLine(e)),f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:g,points:[a],data:[{color:b,title:C}]})}y.value.classList.remove("selected")}function l(a){h(!1),r(a)}function r(a){const m={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(a).forEach(([b,{color:C,title:e}])=>{m.price=+b,m.color=C,m.title=e,S.push(t.priceSeries.createPriceLine(m))})}function h(a=!0){S.length>0&&(a&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),S.forEach(g=>t.priceSeries.removePriceLine(g)),S=[])}function i({lineOptions:a,oldPrice:g,newPrice:m}){f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:g});const b=a.color,C=a.title;f.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[m],data:[{color:b,title:C}]}),y.value.classList.remove("selected")}return(a,g)=>(H(),J("div",{ref_key:"lineToolRef",ref:y,class:"context command",title:a.$t("trading.derivative.lineTool"),onClick:Z,onContextmenu:W},[li,Te(ee(ai,{class:"contextmenu",enable:T.value,title:c.value,"onUpdate:title":g[0]||(g[0]=m=>c.value=m),color:v.value,"onUpdate:color":g[1]||(g[1]=m=>v.value=m),onDeleteAllLine:h},null,8,["enable","title","color"]),[[_e,T.value]])],40,ci))}},di=["title"],ui=M("i",{class:"far fa-grip-lines-vertical"},null,-1),fi=[ui],mi={__name:"TimeRangeTool",props:["timeRangeSeries","timeToIndex","indexToTime"],emits:["hideContext"],setup(P,{expose:I,emit:x}){const f=me(),t=fe("mf"),s=P,y=x,T=F(null),$=ce(()=>f.state.tradingDerivative.tools.timeRange);let c=[];I({isSelected:v,draw:N}),ve($,l=>{l&&Z(l)});function v(){return T.value.classList.contains("selected")}function S(l){y("hideContext");const r=l.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(h=>h.classList.remove("selected")),r||l.target.classList.add("selected")}function B(l){A(),l.target.classList.remove("selected")}function N({time:l}){let r={isRemove:!1,name:"timeRange",points:[],data:[]},h={time:l,value:1};switch(c.length){case 0:h.color="OrangeRed",c[0]=h,r.points.push(0),r.data.push(l);break;case 1:h.color="lime",c[1]=h,r.points.push(1),r.data.push(l),T.value.classList.remove("selected");break;default:const i=s.timeToIndex(c[0].time),a=s.timeToIndex(c[1].time),m=s.timeToIndex(l)+(a-i),b=s.indexToTime(m);h.color="OrangeRed",c[0]=t.cloneDeep(h),r.points.push(0),r.data.push(l),h.time=b,h.color="lime",c[1]=h,r.points.push(1),r.data.push(b),T.value.classList.remove("selected");break}s.timeRangeSeries.setData(c),f.dispatch("tradingDerivative/drawTools",r)}function Z(l){A(!1),W(l)}function W(l){let r,h;if(l.length===2)r=l[0],h=l[1];else if(l.length===3){const a=s.timeToIndex(l[0]),g=s.timeToIndex(l[1]),b=s.timeToIndex(l[2])+(g-a);r=l[2],h=s.indexToTime(b)}else return!1;let i=[{time:r,value:1,color:"OrangeRed"},{time:h,value:1,color:"lime"}];c=i,s.timeRangeSeries.setData(i)}function A(l=!0){l&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"timeRange"}),s.timeRangeSeries.setData([]),c=[]}return(l,r)=>(H(),J("div",{ref_key:"timeRangeToolRef",ref:T,class:"command",title:l.$t("trading.derivative.timeRangeTool"),onClick:S,onContextmenu:B},fi,40,di))}},vi=["title"],hi=M("i",{class:"far fa-line-height"},null,-1),gi=[hi],Si={__name:"TargetTool",props:["priceSeries"],emits:["hideContext"],setup(P,{expose:I,emit:x}){const f=me(),t=fe("mf"),s=P,y=x,T=F(null),$=ce(()=>f.state.tradingDerivative.tools.target);let c={};I({isSelected:v,draw:N,drag:l}),ve($,r=>{r&&Z(r)});function v(){return T.value.classList.contains("selected")}function S(r){y("hideContext");const h=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),h||(r.target.classList.add("selected"),A())}function B(r){A(),r.target.classList.remove("selected")}function N({price:r}){const h="target";let i={lineType:h,price:r,lineWidth:1,lineStyle:1,draggable:!0},a={isRemove:!1,name:h,points:[],data:[r]};if(t.isSet(c.A)){const g=+c.A.options().price,m=r-g;i.point="B",i.title=t.fmtNum(m),i.color="#F44336",c[i.point]=s.priceSeries.createPriceLine(i),a.points.push(i.point),i.point="X",i.price=t.fmtNum(g-.5*m),i.title=t.fmtNum(-.5*m),i.color="#2196F3",c[i.point]=s.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(g-m),i.title=t.fmtNum(-m),i.color="#673AB7",c[i.point]=s.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(g-2*m),i.title=t.fmtNum(-2*m),i.color="#9C27B0",c[i.point]=s.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(g-4*m),i.title=t.fmtNum(-4*m),i.color="#E91E63",c[i.point]=s.priceSeries.createPriceLine(i),T.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",c[i.point]=s.priceSeries.createPriceLine(i),a.points.push(i.point);f.dispatch("tradingDerivative/drawTools",a)}function Z(r){A(!1),W(r)}function W(r){let i={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const a=r.A,g=r.B,m=g-a;i.point="A",i.price=a,i.title="0",i.color="#FF9800",c[i.point]=s.priceSeries.createPriceLine(i),i.point="B",i.price=g,i.title=t.fmtNum(m),i.color="#F44336",c[i.point]=s.priceSeries.createPriceLine(i),i.point="X",i.price=t.fmtNum(a-.5*m),i.title=t.fmtNum(-.5*m),i.color="#2196F3",c[i.point]=s.priceSeries.createPriceLine(i),i.point="Y",i.price=t.fmtNum(a-m),i.title=t.fmtNum(-m),i.color="#673AB7",c[i.point]=s.priceSeries.createPriceLine(i),i.point="Z",i.price=t.fmtNum(a-2*m),i.title=t.fmtNum(-2*m),i.color="#9C27B0",c[i.point]=s.priceSeries.createPriceLine(i),i.point="W",i.price=t.fmtNum(a-4*m),i.title=t.fmtNum(-4*m),i.color="#E91E63",c[i.point]=s.priceSeries.createPriceLine(i)}function A(r=!0){r&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),t.isSet(c.A)&&(s.priceSeries.removePriceLine(c.A),t.isSet(c.B)&&(s.priceSeries.removePriceLine(c.B),s.priceSeries.removePriceLine(c.X),s.priceSeries.removePriceLine(c.Y),s.priceSeries.removePriceLine(c.Z),s.priceSeries.removePriceLine(c.W))),c={}}function l({lineOptions:r,newPrice:h}){if(t.isSet(c.B)){let i={isRemove:!1,name:"target",points:[],data:[]},a,g,m=+c.A.options().price,b=+c.B.options().price,C=b-m;if(a="A",r.point==="A")C=+c.B.options().title,b=m+C;else if(r.point!=="B"){let e=0;switch(r.point){case"X":e=1.5;break;case"Y":e=2;break;case"Z":e=3;break;case"W":e=5;break}C=t.fmtNum((b-h)/e),m=b-C,g={price:m},c[a].applyOptions(g)}i.points.push(a),i.data.push(m),a="B",g={price:b,title:t.fmtNum(C)},r.point===a&&delete g.price,c[a].applyOptions(g),i.points.push(a),i.data.push(b),a="X",g={price:t.fmtNum(m-.5*C),title:t.fmtNum(-.5*C)},r.point===a&&delete g.price,c[a].applyOptions(g),a="Y",g={price:t.fmtNum(m-C),title:t.fmtNum(-C)},r.point===a&&delete g.price,c[a].applyOptions(g),a="Z",g={price:t.fmtNum(m-2*C),title:t.fmtNum(-2*C)},r.point===a&&delete g.price,c[a].applyOptions(g),a="W",g={price:t.fmtNum(m-4*C),title:t.fmtNum(-4*C)},r.point===a&&delete g.price,c[a].applyOptions(g),f.dispatch("tradingDerivative/drawTools",i)}}return(r,h)=>(H(),J("div",{ref_key:"targetToolRef",ref:T,class:"command",title:r.$t("trading.derivative.targetTool"),onClick:S,onContextmenu:B},gi,40,vi))}},yi=["title"],Ge=3,Ke=2,Ti={__name:"OrderTool",props:["position","prices","priceSeries","inSession","TIME"],emits:["getTools","showEntry","showTpSl","orderChanged","hideContext"],setup(P,{expose:I,emit:x}){const f=me(),{t}=Oe(),s=fe("mf"),y=P,T=x,$=F(null),c=F(!1),v=ce(()=>f.state.tradingDerivative.tools.order);let S={},B={},N=!1;I({show:W,entry:A,tpsl:l,cancel:r,cancelWithoutClose:h,scan:i,drag:b}),ve(v,e=>{e&&g(e)});function Z(){return s.isSet(B.entry)||s.isSet(B.tp)}function W({price:e}){if(e&&y.inSession()){const d=G(ke(new Date,7));if(s.isSet(B.entry))!s.isSet(B.tp)&&y.position&&d>y.TIME.ATO&&d<y.TIME.ATC&&T("showTpSl",{side:y.position});else{let p=null,n=0;y.position?(d<y.TIME.ATO?p="ATO":d>y.TIME.ATC&&(p="ATC"),p&&(S.entry=p,n=-y.position)):d>y.TIME.ATO&&d<y.TIME.ATC&&(p=e,n=p>=y.prices.at(-1).value?1:-1,S.side=n,S.entry=p),n&&T("showEntry",{side:n,price:p})}}}function A(){if(y.inSession()){const e=G(ke(new Date,7));e<y.TIME.ATO?Qe(t("trading.derivative.atoOrder"),t("titles.confirm")).then(p=>{p&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(n=>{n.isOk?oe.success(t("trading.derivative.atoOrderSuccess")):C(n.message)})}):e>y.TIME.ATC?Qe(t("trading.derivative.atcOrder"),t("titles.confirm")).then(p=>{p&&f.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(n=>{n.isOk?oe.success(t("trading.derivative.atcOrderSuccess")):C(n.message)})}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",entryData:{cmd:"new",side:S.side,price:S.entry}}).then(d=>{d.isOk?(a(["entry"]),oe.success(t("trading.derivative.newEntrySuccess"))):C(d.message)})}}function l(){S.tp=S.entry+S.side*Ge,S.sl=S.entry-S.side*Ke,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:S.tp},slData:{cmd:"new",price:S.sl}}).then(e=>{e.isOk?(B.entry.applyOptions({draggable:!1}),a(["tp","sl"]),oe.success(t("trading.derivative.newTpSlSuccess"))):C(e.message)})}function r(){s.isSet(B.entry)?s.isSet(B.tp)?f.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(e=>{e.isOk?(m(["entry","tp","sl"]),oe.success(t("trading.derivative.exitSuccess"))):C(e.message)}):f.dispatch("tradingDerivative/executeOrder",{action:"entry",entryData:{cmd:"delete"}}).then(e=>{e.isOk?(m(["entry"]),oe.success(t("trading.derivative.deleteEntrySuccess"))):C(e.message)}):T("getTools")}function h(){if(y.inSession()&&y.position){const e=G(ke(new Date,7));e>y.TIME.ATC-5*60&&(c.value=!0,e>y.TIME.ATC-15&&s.isSet(B.tp)&&f.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(d=>{d.isOk?(m(["entry","tp","sl"]),oe.success(t("trading.derivative.autoCancelTpSlSuccess"))):C(d.message)}))}}function i(e){if(s.isSet(B.entry)){const d=S.side>0;s.isSet(B.tp)?(s.cmp(e,d,S.tp,!0)&&(N||(N=!0,f.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(p=>{p.isOk?(m(["entry","tp","sl"]),oe.success(t("trading.derivative.deleteTpSuccess"))):C(p.message),N=!1}))),s.cmp(e,!d,S.sl,!0)&&(N||(N=!0,f.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(p=>{p.isOk?(m(["entry","tp","sl"]),oe.success(t("trading.derivative.deleteSlSuccess"))):C(p.message),N=!1})))):s.cmp(e,d,S.entry,!0)&&(N||(N=!0,setTimeout(()=>{S.tp=S.entry+S.side*Ge,S.sl=S.entry-S.side*Ke,f.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:S.tp},slData:{cmd:"new",price:S.sl}}).then(p=>{p.isOk?(B.entry.applyOptions({draggable:!1}),a(["tp","sl"]),oe.success(t("trading.derivative.autoNewTpSlSuccess"))):C(p.message),N=!1})},1e3)))}}function a(e,d=!0){const p="order";let n={isRemove:!1,name:p,points:[],data:[]},k,u;e.forEach(_=>{switch(_){case"entry":k="yellow",u=S.side>0?"LONG":"SHORT";break;case"tp":k="lime",u=s.fmtNum(S.tp-S.entry,1,!0);break;case"sl":k="red",u=s.fmtNum(S.sl-S.entry,1,!0);break}if(s.isSet(B[_]))B[_].applyOptions({price:S[_],title:u}),n.points.push(_),n.data.push(S[_]);else{const w={lineType:p,kind:_,side:S.side,price:S[_],color:k,lineWidth:1,lineStyle:0,title:u,draggable:!(_==="entry"&&S.tp)};B[_]=y.priceSeries.createPriceLine(w),_==="entry"&&(n.points.push("side"),n.data.push(S.side)),n.points.push(_),n.data.push(S[_])}}),d&&f.dispatch("tradingDerivative/drawTools",n),T("orderChanged",Z())}function g(e){S=s.cloneDeep(e);let d=["entry"];"tp"in S&&d.push("tp","sl"),m(["entry","tp","sl"],!1),a(d,!1),T("orderChanged",Z())}function m(e,d=!0){d&&f.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),e.forEach(p=>{s.isSet(B[p])&&(y.priceSeries.removePriceLine(B[p]),delete B[p])}),T("orderChanged",Z())}function b({line:e,lineOptions:d,oldPrice:p,newPrice:n}){if(n!==p){const k=d.kind;if(k!=="entry"||!y.position){const _=`${k}Data`,w=`change${k[0].toUpperCase()}${k.slice(1)}Success`;f.dispatch("tradingDerivative/executeOrder",{action:k,[_]:{cmd:"change",price:n}}).then(E=>{E.isOk?(S[k]=n,a([k]),oe.success(t(`trading.derivative.${w}`))):(e.applyOptions({price:p}),C(E.message))})}else e.applyOptions({price:p}),oe.show(t("trading.derivative.noChangeOrderLine"))}}function C(e){e||(e="unknown"),oe.error(t(`trading.derivative.${e}`))}return(e,d)=>(H(),J("div",{ref_key:"orderToolRef",ref:$,class:"cancel-order command",title:e.$t("trading.derivative.orderTool"),onClick:r},[M("i",{class:ae(["far fa-trash-alt",{blink:c.value}])},null,2)],8,yi))}};const xi=["title"],Ci=["title"],ki=["title"],_i=["title"],bi="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",wi="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",Oi={__name:"Chart",setup(P,{expose:I}){const x=me(),f=xt(),{t}=Oe(),s=fe("devices"),y=fe("mf"),T=fe("filters"),$=F(null),c=F(null),v=F(null),S=F(null),B=F(null),N=F(null),Z=F(null),W=F(null),A=F(null),l=F(null),r=F(null),h=F(null),i=F(null),a=F(null),g=F(null),m={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},b=Le(new Date,"yyyy-MM-dd"),C={START:G(new Date(`${b}T08:45:00Z`)),ATO:G(new Date(`${b}T09:00:00Z`)),ATC:G(new Date(`${b}T14:30:00Z`)),END:G(new Date(`${b}T14:45:00Z`))};let e={chart:{},whitespaces:[],crosshair:{},interval:null,refreshAt:Ve(new Date,11),statusAt:Ve(new Date,21),websocket:null,socketStop:!1,vpsUpdatedAt:Ve(new Date,61)};const d=yt({prices:[],series:{},chartDate:f.query.date??b,clock:Le(new Date,"HH:mm:ss"),isSocketWarning:!1,hasOrderLine:!1,TIME:C}),p=ce(()=>x.state.tradingDerivative.status),n=ce(()=>x.state.tradingDerivative.config),k=ce(()=>x.state.tradingDerivative.isLoading),u=ce(()=>p.value.position||p.value.pending||d.hasOrderLine);e.interval=setInterval(()=>{d.clock=Le(new Date,"HH:mm:ss"),De()&&(i.value&&i.value.cancelWithoutClose(),Me(new Date,new Date(e.refreshAt))>10&&(n.value.autoRefresh&&W.value.refresh(!0),e.refreshAt=new Date),Me(new Date,new Date(e.statusAt))>20&&(Xe(),e.statusAt=new Date))},1e3),ct(),Ye(()=>{_(),new ResizeObserver(se).observe($.value),document.addEventListener("keydown",te)}),et(()=>{w(),document.removeEventListener("keydown",te),clearInterval(e.interval),re(),e.socketStop=!0}),ve(()=>x.state.tradingDerivative.chartData,ie),I({connectSocket:Y});function _(){e.chart=_t(c.value,m),e.chart.subscribeCrosshairMove(X),e.chart.subscribeCustomPriceLineDragged(U),d.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),d.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),d.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),d.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),d.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}})}function w(){e.chart&&(e.chart.remove(),e.chart=null)}function E(o){ue(),ge(!1),Z.value.isSelected()?Z.value.draw({time:e.crosshair.time}):W.value.isSelected()?W.value.draw({time:e.crosshair.time,price:Ee(e.crosshair.y)}):A.value.isSelected()?A.value.draw({time:e.crosshair.time}):l.value.isSelected()?l.value.draw({price:Ee(e.crosshair.y)}):r.value.isSelected()?r.value.draw({time:e.crosshair.time}):h.value.isSelected()&&h.value.draw({price:Ee(e.crosshair.y)})}function D(o){ge(!0),o.preventDefault()}function L(o){o.stopPropagation()}function V(o){o.preventDefault(),o.stopPropagation()}function X(o){if(o.time){let O=o.seriesPrices.get(d.series.price);e.crosshair.time=o.time,e.crosshair.price=O}else s.phone||(e.crosshair.time=null,e.crosshair.price=null);o.point!==void 0&&(e.crosshair.x=o.point.x,e.crosshair.y=o.point.y)}function U(o){let O=o.customPriceLine,R=O.options();R.price=y.fmtNum(R.price);const z=+o.fromPriceString,K=R.price;switch(R.lineType){case"order":i.value.drag({line:O,lineOptions:R,oldPrice:z,newPrice:K});break;case"line":l.value.drag({lineOptions:R,oldPrice:z,newPrice:K});break;case"target":h.value.drag({lineOptions:R,newPrice:K});break;case"pattern":W.value.drag({lineOptions:R});break}}function se(){$.value&&(e.chart.resize($.value.offsetWidth,$.value.offsetHeight),$.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function te(o){if(o.ctrlKey)switch(o.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(o.altKey)switch(o.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function ie(o){d.chartDate===b&&De()||(o.price.length>0&&(e.whitespaces=Q(e.whitespaces,j(d.chartDate))),d.series.whitespace.setData(e.whitespaces),d.prices=Q(d.prices,o.price),d.series.price.setData(d.prices))}function ne(o,O=null){const R=O??n.value.source;let z=[];o.forEach(K=>{let pe,de;R==="FireAnt"?(pe=G(ke(new Date(K.date),7)),de=K.price):(pe=G(new Date(`${b}T${K.time}Z`)),de=K.lastPrice),z.push({time:pe,value:de})}),z.length>1?(d.prices=Q(d.prices,z),d.series.price.setData(d.prices)):(d.prices.push(z[0]),d.series.price.update(z[0]))}function j(o){const O=G(new Date(`${o}T09:00:00Z`)),R=G(new Date(`${o}T11:30:00Z`)),z=G(new Date(`${o}T13:00:00Z`)),K=G(new Date(`${o}T14:30:00Z`)),pe=G(new Date(`${o}T14:00:00Z`));let de=[];for(let Se=O;Se<=K;Se++){if(Se>R&&Se<z)continue;let qe={time:Se};(Se===pe||Se===K)&&(qe.value=1),de.push(qe)}return de}function Q(o,O){return Array.from(new Map([...o,...O].sort((R,z)=>R.time-z.time).map(R=>[R.time,R])).values())}async function Y(){if(De()){await re();const o=n.value.source==="FireAnt",O=o?bi:wi;e.websocket=new WebSocket(O),e.websocket.onclose=R=>{e.socketStop||(d.isSocketWarning=!0,Y())},o?Pe():(q(),he())}}async function re(){e.websocket&&e.websocket.readyState===WebSocket.OPEN&&(e.websocket.close(),await new Promise(o=>{const O=setInterval(()=>{(!e.websocket||e.websocket.readyState===WebSocket.CLOSED)&&(e.websocket=null,clearInterval(O),o())},100)}))}function Pe(){x.dispatch("tradingDerivative/setLoading",!0),e.websocket.onopen=o=>{if(e.websocket.readyState===WebSocket.OPEN){let O='{"protocol":"json","version":1}';e.websocket.send(O),O='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(O)}},e.websocket.onmessage=o=>{d.isSocketWarning=!1,le(o.data).forEach(R=>{if(!R)return!1;R.type===3?(R.result[0].date.slice(0,10)===b&&(Re(),e.whitespaces=Q(e.whitespaces,j(b)),d.series.whitespace.setData(e.whitespaces),ne(R.result)),x.dispatch("tradingDerivative/setLoading",!1)):R.type===1&&R.target==="UpdateTrades"&&R.arguments[0]==="VN30F1M"&&(console.log("FireAnt",R.arguments[1]),i.value.scan(R.arguments[1].at(-1).price),ne(R.arguments[1]))})}}function le(o){let O=[];return o.split("").forEach(R=>{const z=R.indexOf("{"),K=R.lastIndexOf("}");let pe=null;if(z!==-1&&K!==-1&&K>z){const de=R.substring(z,K+1);de!=="{}"&&(pe=JSON.parse(de))}O.push(pe)}),O}function he(){e.websocket.onopen=o=>{if(e.websocket.readyState===WebSocket.OPEN){const O={action:"join",list:n.value.vn30f1m},R=`42${JSON.stringify(["regs",JSON.stringify(O)])}`;e.websocket.send(R)}},e.websocket.onmessage=o=>{if(d.isSocketWarning=!1,o.data.substr(0,1)==="4"&&o.data.substr(1,1)==="2"){const O=JSON.parse(o.data.substr(2));if(O[0]==="stockps"){const R=O[1].data;R.id===3220&&(console.log("VPS",R),i.value.scan(R.lastPrice),ne([R]))}}}}function q(){Me(new Date,new Date(e.vpsUpdatedAt))>60&&(fetch("https://bddatafeed.vps.com.vn/getpschartintraday/VN30F1M").then(o=>o.json()).then(o=>{console.log(o),ne(o,"VPS")}),e.vpsUpdatedAt=new Date)}function Ce(){W.value.refresh()}function He(o){W.value.load(o,{isSave:!0})}function ue(){N.value.hide(),Z.value.hide(),l.value.hide()}function Je(o){s.phone||N.value.hide(y.isSet(o)),N.value.set(o)}function $e(o){d.hasOrderLine=o}function ge(o){o?i.value.show({price:Ee(e.crosshair.y)}):(a.value.style.display="none",g.value.style.display="none")}function Ie({side:o,price:O}){a.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",a.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",a.value.style.background=o>0?"green":"red",a.value.innerText=`${o>0?"LONG":"SHORT"} ${O}`,a.value.style.display="block"}function Ae({side:o}){g.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",g.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",g.value.style.background=o>0?"green":"red",g.value.style.display="block"}function be(){i.value.entry()}function we(){i.value.tpsl()}function Ne(){e.chart.timeScale().scrollToRealTime()}function De(){const o=G(ke(new Date,7));return n.value.openingMarket&&o>=C.START&&o<=C.END}function ot(){if(!d.chartDate)return!1;Be()}function at(){e.whitespaces=[],d.prices=[],Y(),Be()}function ct(){x.dispatch("tradingDerivative/initChart").then(()=>{Y(),!f.query.date&&n.value.lastOpeningDate&&(d.chartDate=n.value.lastOpeningDate),Be()})}function Be(){x.dispatch("tradingDerivative/getChartData",d.chartDate).then(o=>{o&&Re()})}function Xe(){x.dispatch("tradingDerivative/getStatus")}function Re(){x.dispatch("tradingDerivative/getTools")}function lt(){x.dispatch("tradingDerivative/getAccountInfo").then(o=>{let O="";O+='<div style="width: 200px;">',O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.nav")}</div><div>: ${T.currency(o.nav)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.maxVol")}</div><div>: ${T.numberVnFormat(o.maxVol)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.vm")}</div><div>: ${T.currency(o.vm)}</div></div>`,O+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${t("trading.derivative.fee")}</div><div>: ${T.currency(o.fee)}</div></div>`,O+="</div>",Ct(O,t("trading.derivative.accountInfo"))})}function Ee(o){return y.fmtNum(d.series.price.coordinateToPrice(o))}function Fe(o){let O=e.whitespaces.findIndex(R=>R.time===o);if(O===-1){const R=Le(new Date(o*1e3),"yyyy-MM-dd"),z=G(new Date(`${R}T11:30:00Z`)),K=G(new Date(`${R}T13:00:00Z`)),pe=G(new Date(`${R}T14:30:00Z`));o>z&&o<K?o=z:o>pe&&(o=pe),O=e.whitespaces.findIndex(de=>de.time===o)}return O}function je(o){return o<e.whitespaces.length?e.whitespaces[o].time:!1}return(o,O)=>(H(),J("div",{class:"derivative-chart",ref_key:"chartContainerRef",ref:$,onClick:E,onContextmenu:D},[M("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:c},[M("div",{class:"area data-area",onClick:L,onContextmenu:V},[M("div",{ref_key:"connectionRef",ref:v,class:ae(["command",{yellow:p.value.pending,red:n.value.volInvalid}]),title:o.$t("trading.derivative.connection"),onClick:Xe},[M("i",{class:ae(["far",{"fa-link-simple":p.value.connection,"fa-link-simple-slash":!p.value.connection,blink:d.isSocketWarning}])},null,2)],10,xi),M("div",{class:ae(["command status",{green:p.value.position>0,red:p.value.position<0}]),title:o.$t("trading.derivative.position"),onClick:lt},ye(p.value.position),11,Ci),M("div",{class:"command clock",onClick:Y},ye(d.clock),1),Te(M("input",{type:"date",class:"chart-date command",title:o.$t("trading.derivative.date"),"onUpdate:modelValue":O[0]||(O[0]=R=>d.chartDate=R),onChange:ot},null,40,ki),[[Tt,d.chartDate]]),M("div",{ref_key:"reloadToolRef",ref:S,class:"command",title:o.$t("trading.derivative.reload"),onClick:at,onContextmenu:Re},[M("i",{class:ae(["far fa-sync-alt",{"fa-spin":k.value}])},null,2)],40,_i)],32),M("div",{class:"area tool-area",onClick:L,onContextmenu:V},[ee(Dt,{chartContainerRef:$.value},null,8,["chartContainerRef"]),ee(Lt,{ref_key:"tradingviewToolRef",ref:B,vpsUser:n.value.vpsUser,vpsSession:n.value.vpsSession,chartContainerRef:$.value},null,8,["vpsUser","vpsSession","chartContainerRef"]),ee(Nt,{ref_key:"progressToolRef",ref:N,onRefreshPattern:Ce,onHideContext:ue},null,512),ee(Xt,{ref_key:"scanToolRef",ref:Z,prices:d.prices,timeToIndex:Fe,onScaned:He,onRemovePattern:O[1]||(O[1]=()=>W.value.remove()),onHideContext:ue},null,8,["prices"]),ee(Qt,{ref_key:"patternToolRef",ref:W,prices:d.prices,priceSeries:d.series.price,timeMarkSeries:d.series.timeMark,pickTimeToolRef:A.value,timeToIndex:Fe,indexToTime:je,onSetProgress:Je,onHideContext:ue},null,8,["prices","priceSeries","timeMarkSeries","pickTimeToolRef"]),ee(ti,{ref_key:"pickTimeToolRef",ref:A,pickTimeSeries:d.series.pickTime,onRefreshPattern:Ce,onHideContext:ue},null,8,["pickTimeSeries"]),ee(pi,{ref_key:"lineToolRef",ref:l,priceSeries:d.series.price,onHideContext:ue},null,8,["priceSeries"]),ee(mi,{ref_key:"timeRangeToolRef",ref:r,timeRangeSeries:d.series.timeRange,timeToIndex:Fe,indexToTime:je,onHideContext:ue},null,8,["timeRangeSeries"]),ee(Si,{ref_key:"targetToolRef",ref:h,priceSeries:d.series.price,onHideContext:ue},null,8,["priceSeries"]),Te(ee(Ti,{ref_key:"orderToolRef",ref:i,position:p.value.position,prices:d.prices,priceSeries:d.series.price,inSession:De,TIME:d.TIME,onGetTools:Re,onShowEntry:Ie,onShowTpSl:Ae,onOrderChanged:$e,onHideContext:ue},null,8,["position","prices","priceSeries","TIME"]),[[_e,u.value]])],32),M("div",null,[M("div",{ref_key:"entryOrderRef",ref:a,class:"order-button entry",onClick:be}," Entry ",512),M("div",{ref_key:"tpslOrderRef",ref:g,class:"order-button tpsl",onClick:we}," TP/SL ",512),M("div",{class:"chart-top command far fa-angle-double-right",onClick:Ne})])],512)],544))}};export{Oi as default};
