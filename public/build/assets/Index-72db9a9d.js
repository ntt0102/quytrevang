import{u as Me,b as Xe,c as Ye,i as I,r as b,d as je,e as U,x as ze,w as H,f as We,g as Ke,h as w,j as E,l as Ne,z as Z,C as Ie,A as G,E as J,F as Ue,o as He}from"./app-c2aaed0e.js";import{_ as Ze}from"./spinner-40be0a1e.js";import Ge from"./ColorPicker-5b0df892.js";import{_ as Je,a as Qe}from"./filterPopup-8420a213.js";import{c as et}from"./lightweight-charts.esm.development-03366bac.js";class tt{constructor(){this.create()}create(){return new Promise((C,m)=>{const v=indexedDB.open("stockChart",1);v.onupgradeneeded=k=>{this.store=k.target.result,this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("uplps",{keyPath:"title"}),this.store.createObjectStore("downlps",{keyPath:"title"}),C()},v.onsuccess=k=>{this.store=k.target.result,C()},v.onerror=()=>{location.reload(),m()}})}get(C){var m=this.store;return new Promise(function(k,y){var g=m.transaction(C,"readonly");if(Array.isArray(C)){var S=C.map(T=>g.objectStore(T)),_=S.map(v);Promise.all(_).then(T=>k(T))}else{var D=g.objectStore(C);v(D).then(T=>k(T))}});function v(k){return new Promise(function(y,g){const S=k.getAll();S.onsuccess=_=>y(_.target.result),S.onerror=()=>g()})}}set(C,m){const v=this.store.transaction(C,"readwrite").objectStore(C);Array.isArray(m)?m.length>0&&m.forEach(k=>v.put(k)):v.put(m)}clear(C){var m=this.store;return new Promise(function(v,k){const y=m.transaction(C,"readwrite").objectStore(C).clear();y.onsuccess=()=>{v()},y.onerror=g=>{console.error(`Error to empty Object Store: ${C}`),k()}})}}const o=new tt;const rt={class:"content-block dx-card responsive-paddings"},it={class:"area data-area"},ot=["title"],st={class:"area tool-area"},lt=["title"],nt=["title"],ct=["title"],at=["title"],pt=["title"],dt=["title"],ut=["title"],ft=["title"],mt=["src"],Pt={__name:"Index",setup(Q){const C={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},m=Me();Xe();const{t:v}=Ye(),k=I("devices"),y=I("mf"),g=b(null),S=b(null),_=b(null),D=b(null),T=b(null),ee=b(null),R=b(null),A=b(null),V=b(null),B=b(null),q=b(null),te=b(null);let e={chart:{},series:{},data:{whitespace:[],original:[],price:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},C:{},D:{}},pattern1:{A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},pattern2:{O:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const a=je({symbol:"VNINDEX",symbols:[],symbolsKind:null,symbolsKinds:[{text:v("trading.stock.hoseList"),value:"hose"},{text:v("trading.stock.filterCash"),value:"cash"},{text:v("trading.stock.filterIndex"),value:"index"},{text:v("trading.stock.filterMix"),value:"mix"},{text:v("trading.stock.watchList"),value:"watch"}],isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1});a.symbolsKind=a.symbolsKinds[0];const re=U(()=>`https://chart.vps.com.vn/tv/?symbol=${a.symbol}`),X=U(()=>m.state.tradingStock.symbols.watch.includes(a.symbol));m.dispatch("tradingStock/getSymbols"),o.create(),ze(()=>{e.chart=et(S.value,C),g.value.addEventListener("click",oe),g.value.addEventListener("contextmenu",ie),e.chart.subscribeCrosshairMove(se),e.chart.subscribeCustomPriceLineDragged(le),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",priceFormat:{minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(ne).observe(g.value),document.addEventListener("fullscreenchange",ce),m.dispatch("tradingStock/getChartData",a.symbol).then(()=>{de()})}),H(()=>m.state.tradingStock.chartData,ue),H(()=>m.state.tradingStock.isChartLoading,r=>{_.value.style.display=r?"block":"none"});function ie(r){r.preventDefault()}function oe(){R.value.classList.contains("selected")?O():A.value.classList.contains("selected")?Ce():V.value.classList.contains("selected")?ke():B.value.classList.contains("selected")?z():q.value.classList.contains("selected")&&K()}function se(r){if(r.time){let t=r.seriesPrices.get(e.series.price);e.crosshair.time=r.time,e.crosshair.price=t}else k.phone||(e.crosshair.time=null,e.crosshair.price=null);r.point!=null&&(e.crosshair.x=r.point.x,e.crosshair.y=r.point.y)}function le(r){let t=r.customPriceLine,s=t.options();s.price=M(s.price);const l=+r.fromPriceString,c=s.price;switch(s.lineType){case"line":o.set("line",{price:l,removed:!0}),o.set("line",s),R.value.classList.remove("selected");break;case"ruler":switch(s.point){case"l0":if(o.set("ruler",s),e.ruler.pointCount==2){const P=+e.ruler.l1.options().title,Ae=+(c-P).toFixed(1);e.ruler.ln1.applyOptions({price:Ae}),o.set("ruler",e.ruler.ln1.options());const Ve=+(c+P).toFixed(1);e.ruler.l1.applyOptions({price:Ve}),o.set("ruler",e.ruler.l1.options());const Be=+(c+P*2).toFixed(1);e.ruler.l2.applyOptions({price:Be}),o.set("ruler",e.ruler.l2.options());const qe=+(c+P*3).toFixed(1);e.ruler.l3.applyOptions({price:qe}),o.set("ruler",e.ruler.l3.options());const $e=+(c+P*4).toFixed(1);e.ruler.l4.applyOptions({price:$e}),o.set("ruler",e.ruler.l4.options())}break;case"ln1":const n=+e.ruler.l0.options().price,i=c-n;t.applyOptions({title:i.toFixed(1)}),o.set("ruler",t.options()),e.ruler.l1.applyOptions({title:(-i).toFixed(1),price:+(n-i).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-i*2).toFixed(1),price:+(n-i*2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-i*3).toFixed(1),price:+(n-i*3).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-i*4).toFixed(1),price:+(n-i*4).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l1":const p=+e.ruler.l0.options().price,d=c-p;t.applyOptions({title:d.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-d).toFixed(1),price:+(p-d).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(d*2).toFixed(1),price:+(p+d*2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(d*3).toFixed(1),price:+(p+d*3).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(d*4).toFixed(1),price:+(p+d*4).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l2":const x=+e.ruler.l0.options().price,h=c-x;t.applyOptions({title:h.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-h*.5).toFixed(1),price:+(x-h*.5).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(h*.5).toFixed(1),price:+(x+h*.5).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(h*1.5).toFixed(1),price:+(x+h*1.5).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(h*2).toFixed(1),price:+(x+h*2).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break;case"l3":const F=+e.ruler.l0.options().price,L=c-F;t.applyOptions({title:L.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-L/3).toFixed(1),price:+(F-L/3).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(L/3).toFixed(1),price:+(F+L/3).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(L*2/3).toFixed(1),price:+(F+L*2/3).toFixed(1)}),o.set("ruler",e.ruler.l2.options());break;case"l4":const u=+e.ruler.l0.options().price,f=c-u;t.applyOptions({title:f.toFixed(1)}),o.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-f/4).toFixed(1),price:+(u-f/4).toFixed(1)}),o.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(f/4).toFixed(1),price:+(u+f/4).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(f/2).toFixed(1),price:+(u+f/2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(f*3/4).toFixed(1),price:+(u+f*3/4).toFixed(1)}),o.set("ruler",e.ruler.l3.options());break}break;case"pattern1":if(y.isSet(e.pattern1.C)){const n=+e.pattern1.A.options().price,p=+e.pattern1.B.options().price-n;e.pattern1.B.applyOptions({title:p.toFixed(1)}),o.set("pattern1",e.pattern1.B.options()),e.pattern1.C.applyOptions({price:+(n+.5*p).toFixed(1),title:(.5*p).toFixed(1)}),o.set("pattern1",e.pattern1.C.options()),e.pattern1.X1.applyOptions({price:+(n-.375*p).toFixed(1),title:(-.375*p).toFixed(1)}),o.set("pattern1",e.pattern1.X1.options()),e.pattern1.X2.applyOptions({price:+(n-.5*p).toFixed(1),title:(-.5*p).toFixed(1)}),o.set("pattern1",e.pattern1.X2.options()),e.pattern1.Y1.applyOptions({price:+(n-p).toFixed(1),title:-p.toFixed(1)}),o.set("pattern1",e.pattern1.Y1.options()),e.pattern1.Y2.applyOptions({price:+(n-2*p).toFixed(1),title:(-2*p).toFixed(1)}),o.set("pattern1",e.pattern1.Y2.options())}break}}function ne(){g.value&&(e.chart.resize(g.value.offsetWidth,g.value.offsetHeight),g.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function ce(){g.value&&(document.fullscreenElement?(a.isFullscreen=!0,g.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(a.isFullscreen=!1,g.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function ae(){const r={symbol:a.symbol,add:!X.value};m.dispatch("tradingStock/addWatchlist",r)}function pe(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function de(){return new Promise(async r=>{(await o.get("line")).forEach(i=>{i.removed||e.lines.push(e.series.price.createPriceLine(i))});const s=await o.get("ruler");s.length>0&&(e.ruler.pointCount=s.length>1?2:1,s.forEach(i=>{e.ruler[i.point]=e.series.price.createPriceLine(i)}));const l=await o.get("pattern1");l.length>0&&l.forEach(i=>{e.pattern1[i.point]=e.series.price.createPriceLine(i)});const c=await o.get("uplps");c.length>0&&c.forEach(i=>{e.uplps[i.title]=e.series[i.title.includes("P")?"price":"cash"].createPriceLine(i)});const n=await o.get("downlps");n.length>0&&n.forEach(i=>{e.downlps[i.title]=e.series[i.title.includes("P")?"price":"cash"].createPriceLine(i)}),r()})}function ue(){e.data=m.state.tradingStock.chartData,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:a.symbol}})}function fe(r){a.showTradingView=!a.showTradingView,r.stopPropagation()}function me(r){a.showColorPicker=!a.showColorPicker,r.stopPropagation()}function he(r){y.isSet(e.pattern1.X)&&(O(+e.pattern1.X.options().price),O(+e.pattern1.Y.options().price),O(+e.pattern1.Z.options().price),O(+e.pattern1.T.options().price)),r.preventDefault(),r.stopPropagation()}function ve(r){a.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||r.target.classList.add("selected"),r.stopPropagation()}function ye(r){ge(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function O(r=null,t=!1,s=!1){const l="line";r||(r=M($(e.crosshair.y)));const c=e.lines.length;if(e.lines=e.lines.filter(n=>{const i=n.options(),p=i.type=r==+i.price;return p&&(e.series.price.removePriceLine(n),o.set("line",{price:r,removed:!0})),!p}),e.lines.length==c&&!s||t){const n={lineType:l,price:r,color:a.color,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(n)),o.set("line",n)}R.value.classList.remove("selected")}function ge(){e.lines.forEach(r=>e.series.price.removePriceLine(r)),e.lines=[],o.clear("line")}function xe(r){a.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||(r.target.classList.add("selected"),Y()),r.stopPropagation()}function Pe(r){Y(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function Ce(){const r=$(e.crosshair.y);let t={lineType:"ruler",price:r,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)t.point="l0",t.color="#F44336",t.title="0",e.ruler[t.point]=e.series.price.createPriceLine(t),e.ruler.pointCount++,o.set("ruler",t);else{const s=+e.ruler.l0.options().price,l=r-s;t.point="l1",t.color="#FF9800",t.title=l.toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const c=-l;t.point="ln1",t.color="#FF9800",t.title=c.toFixed(1),t.price=+(s+c).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const n=2*l;t.point="l2",t.color="#FFEB3B",t.title=n.toFixed(1),t.price=+(s+n).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const i=3*l;t.point="l3",t.color="#4CAF50",t.title=i.toFixed(1),t.price=+(s+i).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t);const p=4*l;t.point="l4",t.color="#009688",t.title=p.toFixed(1),t.price=+(s+p).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),o.set("ruler",t),e.ruler.pointCount++,A.value.classList.remove("selected")}}function Y(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},o.clear("ruler"))}function Fe(r){a.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t||(r.target.classList.add("selected"),j()),r.stopPropagation()}function we(r){j(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function ke(){const r=$(e.crosshair.y);let t={lineType:"pattern1",price:r,lineWidth:1,lineStyle:1,draggable:!0};if(y.isSet(e.pattern1.A)){const s=+e.pattern1.A.options().price,l=r-s;t.point="B",t.title=l.toFixed(1),t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="C",t.price=+(s+.5*l).toFixed(1),t.title=(.5*l).toFixed(1),t.color="#FF9800",t.draggable=!1,e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="X1",t.price=+(s-.375*l).toFixed(1),t.title=(-.375*l).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="X2",t.price=+(s-.5*l).toFixed(1),t.title=(-.5*l).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="Y1",t.price=+(s-l).toFixed(1),t.title=-l.toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),t.point="Y2",t.price=+(s-2*l).toFixed(1),t.title=(-2*l).toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t),V.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),o.set("pattern1",t)}function j(){y.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),y.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X1),e.series.price.removePriceLine(e.pattern1.X2),e.series.price.removePriceLine(e.pattern1.Y1),e.series.price.removePriceLine(e.pattern1.Y2)),e.pattern1={A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},o.clear("pattern1"))}function Le(r){a.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t?z():r.target.classList.add("selected"),r.stopPropagation()}function be(r){W(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function z(){let r,t;y.isSet(e.uplps.P1)?(r=+e.uplps.P1.options().startTime,t=e.crosshair.time,W()):r=e.crosshair.time;const{price1:s,price2:l,cash1:c,cash2:n}=Se(r,t);let i={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1};i.startTime=r,i.price=s,i.title="P1",e.uplps[i.title]=e.series.price.createPriceLine(i),o.set("uplps",i),i.price=l,i.title="P2",e.uplps[i.title]=e.series.price.createPriceLine(i),o.set("uplps",i),i.price=c,i.title="C1",e.uplps[i.title]=e.series.cash.createPriceLine(i),o.set("uplps",i),i.price=n,i.title="C2",e.uplps[i.title]=e.series.cash.createPriceLine(i),o.set("uplps",i),B.value.classList.remove("selected")}function Se(r,t){let s,l,c,n=0,i=0,p,d,x=0,h=0;for(let F=0;F<e.data.price.length;F++){const L=e.data.price[F].time;if(L<r)continue;if(t&&L>t)break;const u=e.data.price[F].value,f=e.data.cash[F].value;if(s==null&&(s=u,l=u,c=u,p=f,d=f),u>c)n>i&&(l=c,i=n),c=u,n=0;else if(u<c){const P=+(c-u).toFixed(1);P>n&&(n=P)}if(u<s&&i>0)break;if(f>d)x>h&&(p=d,h=x),d=f,x=0;else if(f<d){const P=+(d-f).toFixed(1);P>x&&(x=P)}}return{price1:+(l-i).toFixed(2),price2:+(c-i).toFixed(2),cash1:+(p-h).toFixed(0),cash2:+(d-h).toFixed(0)}}function W(){y.isSet(e.uplps.P1)&&(e.series.price.removePriceLine(e.uplps.P1),e.series.price.removePriceLine(e.uplps.P2)),y.isSet(e.uplps.C1)&&(e.series.cash.removePriceLine(e.uplps.C1),e.series.cash.removePriceLine(e.uplps.C2)),e.uplps={P1:{},P2:{},C1:{},C2:{}},o.clear("uplps")}function Te(r){a.showColorPicker=!1;const t=r.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(s=>s.classList.remove("selected")),t?K():r.target.classList.add("selected"),r.stopPropagation()}function _e(r){N(),r.target.classList.remove("selected"),r.preventDefault(),r.stopPropagation()}function K(){let r,t;y.isSet(e.downlps.P1)?(r=+e.downlps.P1.options().startTime,t=e.crosshair.time,N()):r=e.crosshair.time;const{price1:s,price2:l,cash1:c,cash2:n}=Oe(r,t);let i={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1};i.startTime=r,i.price=s,i.title="P1",e.downlps[i.title]=e.series.price.createPriceLine(i),o.set("downlps",i),i.price=l,i.title="P2",e.downlps[i.title]=e.series.price.createPriceLine(i),o.set("downlps",i),i.price=c,i.title="C1",e.downlps[i.title]=e.series.cash.createPriceLine(i),o.set("downlps",i),i.price=n,i.title="C2",e.downlps[i.title]=e.series.cash.createPriceLine(i),o.set("downlps",i),q.value.classList.remove("selected")}function Oe(r,t){let s,l,c,n=0,i=0,p,d,x=0,h=0;for(let F=0;F<e.data.price.length;F++){const L=e.data.price[F].time;if(L<r)continue;if(t&&L>t)break;const u=e.data.price[F].value,f=e.data.cash[F].value;if(s==null&&(s=u,l=u,c=u,p=f,d=f),u<c)n<i&&(l=c,i=n),c=u,n=0;else if(u>c){const P=+(c-u).toFixed(1);P<n&&(n=P)}if(u>s&&i<0)break;if(f<d)x<h&&(p=d,h=x),d=f,x=0;else if(f>d){const P=+(d-f).toFixed(1);P<x&&(x=P)}}return{price1:+(l-i).toFixed(1),price2:+(c-i).toFixed(1),cash1:+(p-h).toFixed(1),cash2:+(d-h).toFixed(1)}}function N(){y.isSet(e.downlps.P1)&&(e.series.price.removePriceLine(e.downlps.P1),e.series.price.removePriceLine(e.downlps.P2)),y.isSet(e.downlps.C1)&&(e.series.cash.removePriceLine(e.downlps.C1),e.series.cash.removePriceLine(e.downlps.C2)),e.downlps={P1:{},P2:{},C1:{},C2:{}},o.clear("downlps")}function $(r,t="price"){return M(e.series[t].coordinateToPrice(r))}function M(r){return r?+ +r.toFixed(1):0}function Re(r){if(!a.symbol)return!1;m.dispatch("tradingStock/getChartData",a.symbol)}function Ee(r){a.symbolsKind=r.value}function De(){m.dispatch("tradingStock/cloneSymbols")}return(r,t)=>{const s=We("DxToolbar");return He(),Ke(Ue,null,[w("div",rt,[E(s,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-list small",hint:r.$t("trading.stock.cloneSymbols"),onClick:De}},{location:"before",widget:"dxButton",options:{icon:"far fa-filter small",hint:r.$t("trading.stock.filterPopup.title"),onClick:()=>r.$refs.filterPopupRef.show()}},{location:"before",widget:"dxSelectBox",options:{width:"170px",dataSource:a.symbolsKinds,keyExpr:"value",displayExpr:"text",value:a.symbolsKind,hint:r.$t("trading.stock.symbolsKind"),onValueChanged:Ee}}]},null,8,["items"]),w("div",{class:"stock-container",ref_key:"chartContainerRef",ref:g},[w("div",{class:"chart-wrapper",ref_key:"chartRef",ref:S},[w("div",it,[E(Ne(Je),{width:r.$screen.getScreenSizeInfo.isXSmall?"140px":"130px",height:"30px","data-source":r.$store.state.tradingStock.symbols[a.symbolsKind.value],"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:"symbol-select"},modelValue:a.symbol,"onUpdate:modelValue":t[0]||(t[0]=l=>a.symbol=l),onValueChanged:Re},null,8,["width","data-source","modelValue"]),w("div",{ref:"addWatchlistToolRef",class:Z(`command far fa-${X.value?"minus-circle":"plus-circle"}`),title:r.$t("trading.stock.addWatchlist"),onClick:ae},null,10,ot),w("img",{ref_key:"spinnerRef",ref:_,class:"command spinner",src:Ze},null,512)]),w("div",st,[w("div",{ref_key:"fullscreenToolRef",ref:D,class:Z(`command far fa-${a.isFullscreen?"compress":"expand"}`),title:r.$t("trading.stock.fullscreen"),onClick:pe},null,10,lt),w("div",{ref_key:"tradingviewRef",ref:T,class:"command far fa-chart-bar",title:r.$t("trading.stock.tradingview"),onClick:fe},null,8,nt),w("div",{ref_key:"colorToolRef",ref:ee,class:"color command far fa-palette",style:Ie({color:a.color}),title:r.$t("trading.stock.colorTool"),onClick:me,onContextmenu:he},[G(E(Ge,{class:"color-picker",modelValue:a.color,"onUpdate:modelValue":t[1]||(t[1]=l=>a.color=l)},null,8,["modelValue"]),[[J,a.showColorPicker]])],44,ct),w("div",{ref_key:"lineToolRef",ref:R,class:"command far fa-horizontal-rule",title:r.$t("trading.stock.lineTool"),onClick:ve,onContextmenu:ye},null,40,at),w("div",{ref_key:"pattern1ToolRef",ref:V,class:"command far fa-dot-circle",title:r.$t("trading.stock.pattern1Tool"),onClick:Fe,onContextmenu:we},null,40,pt),w("div",{ref_key:"uplpsToolRef",ref:B,class:"command far fa-arrow-up",title:r.$t("trading.stock.uplpsTool"),onClick:Le,onContextmenu:be},null,40,dt),w("div",{ref_key:"downlpsToolRef",ref:q,class:"command far fa-arrow-down",title:r.$t("trading.stock.downlpsTool"),onClick:Te,onContextmenu:_e},null,40,ut),w("div",{ref_key:"rulerToolRef",ref:A,class:"command far fa-line-height",title:r.$t("trading.stock.rulerTool"),onClick:xe,onContextmenu:Pe},null,40,ft)]),G(w("iframe",{ref_key:"tradingviewChartRef",ref:te,class:"tradingview-chart",src:re.value},null,8,mt),[[J,a.showTradingView]])],512)],512)]),E(Qe,{ref:"filterPopupRef"},null,512)],64)}}};export{Pt as default};
