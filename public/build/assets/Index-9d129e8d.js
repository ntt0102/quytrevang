import{_ as $,P,m as c,b as v,c as b,d as p,t as y,e as o,w as u,r as i,o as D}from"./app-28056b86.js";import{D as S,a as M}from"./data-grid-5f5ea2fc.js";import k from"./ContractConditionsPopup-649f3547.js";import T from"./PayingContractPopup-4cf429ff.js";import G from"./WithdrawingContractPopup-0b499b67.js";import{C as R}from"./ContractDetailPopup-ad1e9212.js";import"./row_dragging-d40b1e01.js";import"./dialog-ce99b292.js";import"./exporter-d0e7996a.js";import"./interest-formula-45587e77.js";import"./accordion-ebf480f1.js";import"./load-indicator-137d6f69.js";import"./radio-group-1614a5a6.js";/* empty css                                                            */const I={components:{DxDataGrid:S,DxColumn:M,ContractConditionsPopup:k,PayingContractPopup:T,WithdrawingContractPopup:G,ContractDetailPopup:R},data(){return{gridData:null,contract:{id:null},validationRules:[{type:"required",message:this.$t("models.contract.principal")+this.$mt.validations.required},{type:"custom",validationCallback:this.validatePrincipal,message:this.$t("models.contract.validations.principal")}]}},beforeCreate(){this.$store.registerModule("User.contract",P)},created(){this.fetch().then(()=>{this.$route.hash=="#conditions"&&this.showConditions()})},destroyed(){this.$store.unregisterModule("User.contract")},computed:{...c("Auth",["level"]),...c("User.contract",["contracts","interestRate","principalMin","holdWeeksMin"]),dataGrid:function(){return this.$refs.dataGrid.instance}},watch:{contracts(){this.cloneDeepData()}},methods:{...v("User.contract",["fetch","save","withdrawingContract","resetState"]),onSaved(t){this.save({changes:t.changes}).then(({isOk:r,type:d,contract:l})=>{r&&d=="insert"&&this.$refs.payingContractPopup.show(l)})},allowModifying(t){return t.row.data.status==1},validatePrincipal(t){return t.value>=this.principalMin},onInitNewRow(t){t.data.status=1,t.data.interest_rate=this.interestRate,t.data.paid_at=moment().format(this.$mc.SERVER_DATE_FORMAT),this.dataGrid.option("editing.popup.title",this.$t("models.contract.popup.create"))},onEditingStart(t){this.dataGrid.option("editing.popup.title",`${this.$t("models.contract.popup.edit")} #${t.data.code}`)},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.contracts),this.$route.query.code&&this.dataGrid.columnOption("code","filterValues",[+this.$route.query.code])},onShown(t){this.$mf.checkPinDataGrid(t,this),this.$mf.pushPopupToHistoryState(()=>this.dataGrid.cancelEditData())},onToolbarPreparing(t){t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{icon:"help",type:"normal",hint:this.$t("components.contractConditions.title"),onClick:()=>this.$refs.contractConditionsPopup.show()}})}}},E={class:"content-block"},_={class:"content-block dx-card responsive-paddings"};function B(t,r,d,l,s,a){const n=i("DxColumn"),h=i("DxToolbar"),m=i("DxDataGrid"),w=i("ContractConditionsPopup"),f=i("PayingContractPopup"),g=i("WithdrawingContractPopup"),C=i("ContractDetailPopup");return D(),b("div",null,[p("h2",E,y(t.$t("user.contract.title")),1),p("div",_,[o(m,{ref:"dataGrid","column-min-width":40,"data-source":s.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:a.allowModifying,allowDeleting:a.allowModifying,confirmDelete:!1,mode:"popup",popup:{width:300,height:t.$devices.phone?250:210,fullScreen:!1,showTitle:!0,onShown:a.onShown,onHiding:t.$mf.popRouteHistoryState},form:{labelLocation:t.$devices.phone?"top":"left",items:[{dataField:"principal",colSpan:2}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:r[0]||(r[0]=e=>t.$mf.dataGridPreload(s.gridData,a.dataGrid)),onInitNewRow:a.onInitNewRow,onEditingStart:a.onEditingStart,onToolbarPreparing:a.onToolbarPreparing,onSaved:a.onSaved},{commandCellTemplate:u(({data:e})=>[o(h,{items:[{visible:e.data.status<=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==0?"arrow-square-up":"receipt"}`,hint:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),text:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),onClick:()=>t.$refs.payingContractPopup.show(e.data)}},{visible:e.data.status==2,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"far fa-arrow-square-down",hint:t.$t("user.contract.withdrawContract"),text:t.$t("user.contract.withdrawContract"),onClick:()=>t.$refs.withdrawingContractPopup.show(e.data)}},{visible:e.data.status==3,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"undo",hint:t.$t("user.contract.unwithdrawContract"),text:t.$t("user.contract.unwithdrawContract"),onClick:()=>t.$bus.emit("checkPin",()=>t.withdrawingContract({id:e.data.id,advance:0}))}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>a.dataGrid.editRow(e.rowIndex)}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>a.dataGrid.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key)&&e.data.status>=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopup.show(e.data)}}]},null,8,["items"])]),default:u(()=>[o(n,{fixed:!0,width:t.$devices.phone?35:98,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$devices.phone?"Short":""}`)},null,8,["width","caption"]),o(n,{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),o(n,{"allow-editing":!1,"data-field":"status",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),o(n,{name:"principal","data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":s.validationRules},null,8,["caption","validation-rules"]),o(n,{"allow-editing":!1,"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),caption:t.$t("models.contract.interestRate")},null,8,["format","caption"]),o(n,{"allow-editing":!1,name:"paidAt","data-field":"paid_at","data-type":"date",caption:t.$t("models.contract.paidAt")},null,8,["caption"]),o(n,{"allow-editing":!1,name:"withdrawnAt","data-field":"withdrawn_at","data-type":"date",caption:t.$t("models.contract.withdrawnAt")},null,8,["caption"])]),_:1},8,["data-source","editing","onCellPrepared","onInitNewRow","onEditingStart","onToolbarPreparing","onSaved"])]),o(w,{ref:"contractConditionsPopup"},null,512),o(f,{ref:"payingContractPopup"},null,512),o(g,{ref:"withdrawingContractPopup"},null,512),o(C,{ref:"contractDetailPopup"},null,512)])}const K=$(I,[["render",B],["__scopeId","data-v-e8c44344"]]);export{K as default};
