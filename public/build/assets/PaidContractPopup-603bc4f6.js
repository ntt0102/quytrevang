import{u as F,r as _,a as N,n as A,v,f as n,b as c,_ as K,c as C,R as d,F as M,d as O,i as g,e as f,o as s,x as a,g as j,a1 as u,z as h,a3 as H,a4 as X}from"./app-4d074802.js";import{_ as q}from"./accordion-3bc270cd.js";import{_ as G}from"./Index-3b1b5ee0.js";/* empty css            */const Z={ref:"submitRef",class:"display-none"},J={class:"step1"},Q={class:"download"},W={class:"upload-browser"},Y={for:"receiptImage"},ee=a("i",{class:"far fa-file-upload"},null,-1),te={class:"is-confirmed"},oe={key:0},re={__name:"PaidContractPopup",setup(ae,{expose:k}){const I=O(),{t:P}=F(),$=g("bus"),x=g("mc"),R=g("mf"),i=_(null),b=_(null),m=_(null),e=N({refreshKey:0,contract:{},formData:{}});let p=[];const y=A(()=>new Set(e.formData.documents.map(t=>t.file)));w();function V(t){i.value.setTitle(P(`components.paidContract.${t.status==2?"confirmTitle":"title"}`)+" #"+t.code),i.value.show(),e.contract=t}function S(t){e.formData.documents=e.formData.documents.filter(o=>!o.isUpload),[...t.target.files].forEach(o=>e.formData.documents.push({file:URL.createObjectURL(o),isUpload:!0}))}function B(t){t.value?e.formData.documents=e.formData.documents.filter(o=>o.isUpload):e.formData.documents=p.concat(e.formData.documents)}function U(){$.emit("checkPin",async()=>{let t=new FormData;if(t.append("contractId",e.contract.id),t.append("isDelete",e.formData.isDelete),t.append("isConfirmed",e.formData.isConfirmed),m.value)for(var o=0;o<m.value.files.length;o++){let l=await R.resizeImage({file:m.value.files[o],maxSize:x.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${o}]`,l)}I.dispatch("adminContract/paidContract",t).then(l=>{l&&i.value.hide()})})}function w(){e.formData={isPdfPreview:!1,isDelete:!1,isConfirmed:!1,documents:[]}}function T(){e.formData.isConfirmed=!!e.contract.confirmed_by,setTimeout(()=>b.value.instance.option("selectedIndex",e.contract.status==0?0:1),500),p=e.contract.url_paid_docs.map(t=>({file:t,isUpload:!1})),e.formData.documents=p}function L(){w(),e.refreshKey++}return k({show:V}),(t,o)=>{const l=f("DxButton"),D=f("DxCheckBox"),z=f("RouterLink"),E=f("DxScrollView");return s(),v(M,null,[n(K,{ref_key:"popupRef",ref:i,class:"paid-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:()=>t.$refs.submitRef.click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>i.value.hide()}}],onShown:T,onHidden:L},{default:c(()=>[n(E,null,{default:c(()=>[a("form",{onSubmit:X(U,["prevent"])},[a("button",Z,null,512),n(j(q),{ref_key:"accordionRef",ref:b,collapsible:!0,selectedIndex:0,items:[{title:t.$t("components.paidContract.step1"),template:"step1Template"},{title:t.$t("components.paidContract.step2"),template:"step2Template"}]},{step1Template:c(()=>[a("div",J,[a("div",Q,[n(l,{text:t.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:o[0]||(o[0]=()=>t.$refs.pdfRef.download({component:"PayReceiptPdf",contract:e.contract,isPreview:e.formData.isPdfPreview}))},null,8,["text"]),t.$screen.getScreenSizeInfo.isXSmall?d("",!0):(s(),C(D,{key:0,modelValue:e.formData.isPdfPreview,"onUpdate:modelValue":o[1]||(o[1]=r=>e.formData.isPdfPreview=r),text:t.$t("components.paidContract.preview")},null,8,["modelValue","text"]))])])]),step2Template:c(()=>[(s(),v("div",{class:"upload",key:e.refreshKey},[a("div",W,[a("input",{ref_key:"receiptImageRef",ref:m,type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:S},null,544),a("label",Y,[ee,u(" "+h(t.$t("titles.chooseImage")),1)]),n(D,{id:"contractDelete",modelValue:e.formData.isDelete,"onUpdate:modelValue":o[2]||(o[2]=r=>e.formData.isDelete=r),text:t.$t("titles.deleteOldImage"),onValueChanged:B},null,8,["modelValue","text"])]),y.value.length?(s(),C(H,{key:0,images:y.value},null,8,["images"])):d("",!0)]))]),_:1},8,["items"]),a("div",te,[n(D,{modelValue:e.formData.isConfirmed,"onUpdate:modelValue":o[3]||(o[3]=r=>e.formData.isConfirmed=r),text:t.$t("components.paidContract.isConfirmed")},null,8,["modelValue","text"]),e.contract.confirmed_by?(s(),v("div",oe,[u(" ("+h(t.$t("components.paidContract.confirmedBy"))+" ",1),n(z,{to:{name:"users",query:{code:e.contract.confirmed_by}}},{default:c(()=>[u("#"+h(e.contract.confirmed_by),1)]),_:1},8,["to"]),u(") ")])):d("",!0)])],32)]),_:1})]),_:1},8,["toolbarItems"]),t.$mf.isSet(e.contract)?(s(),C(G,{key:0,ref:"pdfRef"},null,512)):d("",!0)],64)}}};export{re as default};
