import{B as k,u as G,r as P,a as H,c as X,w as j,p as U,f as o,_ as K,h as L,k as p,m as V,o as Q,e,g as i,n as W,D as s,l as Y}from"./app-7f04e4ab.js";function Z(_,g){return+k(_)>+k(g)}const tt={__name:"TrackStatisticPopup",setup(_,{expose:g}){const m=L(),{t:n}=G(),F=p("bus"),u=p("mt"),T=p("mc"),q=p("mf"),w=p("filters"),D=P(null),v=P(null),l=H({gridData:null,validationRules:{symbol:[{type:"required",message:n("trading.shrstats.symbol")+u.validations.required}],buyDate:[{type:"required",message:n("trading.shrstats.date")+u.validations.required}],buyVolume:[{type:"required",message:n("trading.shrstats.volume")+u.validations.required},{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}],buyPrice:[{type:"required",message:n("trading.shrstats.price")+u.validations.required},{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}],buyFee:[{type:"required",message:n("trading.shrstats.fee")+u.validations.required},{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}],sellDate:[{type:"custom",validationCallback:M,message:n("trading.shrstats.validations.sellDate")}],sellVolume:[{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}],sellPrice:[{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}],sellFee:[{type:"custom",validationCallback:d,message:n("trading.shrstats.validations.array")}]}});X(()=>m.state.auth.user.permissions),j(()=>m.state.tradingShrstat.data,t=>{l.gridData=q.cloneDeep(t)});function A(){D.value.show()}function B(t){t.changes.length&&F.emit("checkPin",()=>m.dispatch("tradingShrstat/save",t))}function E(t){const a=new Date;t.data.buy_date=Y(a,T.SERVER_DATE_FORMAT),t.data.buy_volume="[]",t.data.buy_price="[]",t.data.buy_fee="[]",t.data.sell_volume="[]",t.data.sell_price="[]",t.data.sell_fee="[]"}function M(t){return t.value?Z(new Date(t.value),new Date(t.data.buy_date)):!0}function d(t){return/^\[.*\]$/.test(t.value)}function N(t){try{const a=R(t);return a.percent==-100?"-":w.shorten(a.money)}catch{return"-"}}function O(t){try{const a=R(t);return a.percent==-100?"-":w.numberVnFormat(a.percent,1)}catch{return"-"}}function R(t){const a=JSON.parse(t.buy_volume),y=JSON.parse(t.buy_price),f=JSON.parse(t.buy_fee),c=JSON.parse(t.sell_volume),I=JSON.parse(t.sell_price),S=JSON.parse(t.sell_fee);let h=0,$=0,b=0;for(let r=0;r<a.length;r++)h=-a[r]*y[r]-f[r];b=h;for(let r=0;r<c.length;r++)$=c[r]*I[r]-S[r],b+=-S[r];const C=h+$;return{money:C,percent:C/-b*100}}function J(){m.dispatch("tradingShrstat/getData")}function z(){l.gridData=null}return g({show:A}),(t,a)=>{const y=V("DxToolbar"),f=V("DxScrollView");return Q(),U(K,{ref_key:"popupRef",ref:D,title:t.$t("trading.shrstats.buttons.addData"),onShown:J,onHidden:z},{default:o(()=>[e(f,null,{default:o(()=>[e(i(W),{ref_key:"dataGridRef",ref:v,"data-source":l.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:8},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,mode:"batch",startEditAction:"dblClick"},onContentReady:a[0]||(a[0]=c=>t.$mf.dataGridPreload(l.gridData,v.value.instance)),onInitNewRow:E,onSaved:B},{commandCellTemplate:o(({data:c})=>[e(y,{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>{v.value.instance.deleteRow(c.rowIndex)}}}]},null,8,["items"])]),default:o(()=>[e(i(s),{fixed:!0,visible:!1,width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t("titles.commandHeaderTitleShort")},null,8,["caption"]),e(i(s),{"data-field":"symbol","data-type":"string",width:80,caption:t.$t("trading.shrstats.symbol"),"validation-rules":l.validationRules.symbol},null,8,["caption","validation-rules"]),e(i(s),{alignment:"center",caption:t.$t("trading.shrstats.buy")},{default:o(()=>[e(i(s),{"data-field":"buy_date","data-type":"date",width:110,"editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("trading.shrstats.date"),"validation-rules":l.validationRules.buyDate},null,8,["editor-options","caption","validation-rules"]),e(i(s),{"data-field":"buy_volume","data-type":"string",caption:t.$t("trading.shrstats.volume"),"validation-rules":l.validationRules.buyVolume},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"buy_price","data-type":"string",caption:t.$t("trading.shrstats.price"),"validation-rules":l.validationRules.buyPrice},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"buy_fee","data-type":"string",caption:t.$t("trading.shrstats.fee"),"validation-rules":l.validationRules.buyFee},null,8,["caption","validation-rules"])]),_:1},8,["caption"]),e(i(s),{alignment:"center",caption:t.$t("trading.shrstats.sell")},{default:o(()=>[e(i(s),{"data-field":"sell_date","data-type":"date",width:110,"editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("trading.shrstats.date"),"validation-rules":l.validationRules.sellDate},null,8,["editor-options","caption","validation-rules"]),e(i(s),{"data-field":"sell_volume","data-type":"string",caption:t.$t("trading.shrstats.volume"),"validation-rules":l.validationRules.sellVolume},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"sell_price","data-type":"string",caption:t.$t("trading.shrstats.price"),"validation-rules":l.validationRules.sellPrice},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"sell_fee","data-type":"string",caption:t.$t("trading.shrstats.fee"),"validation-rules":l.validationRules.sellFee},null,8,["caption","validation-rules"])]),_:1},8,["caption"]),e(i(s),{alignment:"center",caption:t.$t("trading.shrstats.profit")},{default:o(()=>[e(i(s),{"data-type":"string","calculate-cell-value":N,caption:t.$t("trading.shrstats.moneyProfit")},null,8,["caption"]),e(i(s),{"data-type":"string","calculate-cell-value":O,caption:t.$t("trading.shrstats.percentProfit")},null,8,["caption"])]),_:1},8,["caption"])]),_:1},8,["data-source"])]),_:1})]),_:1},8,["title"])}}};export{tt as default};
