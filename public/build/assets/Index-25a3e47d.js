import{J as bt,K as yt,L as oe,M as ae,u as Ct,b as St,c as wt,i as ne,r as b,d as xt,e as L,x as kt,w as Tt,f as Dt,g as Lt,j as F,h,l as le,z as E,A as P,E as O,C as Ft,G as B,v as Et,o as Pt,H as Ot}from"./app-a53b0f99.js";import Bt from"./ColorPicker-98c41777.js";import{c as $t}from"./lightweight-charts.esm.development-03366bac.js";var u={};const _t=bt(yt);/*!
 * devextreme-vue
 * Version: 22.2.10
 * Build date: Mon Dec 11 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var It=oe&&oe.__importDefault||function(w){return w&&w.__esModule?w:{default:w}};Object.defineProperty(u,"__esModule",{value:!0});u.DxToolbarItem=u.DxTo=u.DxShow=u.DxPosition=u.DxOptions=u.DxOffset=u.DxMy=u.DxItem=u.DxHide=u.DxFrom=u.DxDropDownOptions=u.DxCollision=u.DxButton=u.DxBoundaryOffset=u.DxAt=u.DxAnimation=u.DxSelectBox=void 0;var Nt=It(_t),Rt=ae,v=ae,se=Rt.createComponent({props:{acceptCustomValue:Boolean,accessKey:String,activeStateEnabled:Boolean,buttons:Array,customItemCreateEvent:String,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayExpr:[Function,String],displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,fieldTemplate:{},focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxLength:[Number,String],minSearchLength:Number,name:String,noDataText:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCustomItemCreating:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDataBeforeSearch:Boolean,showDropDownButton:Boolean,showSelectionControls:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:{},valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:acceptCustomValue":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:customItemCreateEvent":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayExpr":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:fieldTemplate":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:noDataText":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCustomItemCreating":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDataBeforeSearch":null,"update:showDropDownButton":null,"update:showSelectionControls":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Nt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});u.DxSelectBox=se;var K=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});u.DxAnimation=K;K.$_optionName="animation";K.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var re=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxAt=re;re.$_optionName="at";var ue=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxBoundaryOffset=ue;ue.$_optionName="boundaryOffset";var $=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});u.DxButton=$;$.$_optionName="buttons";$.$_isCollectionItem=!0;$.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var ce=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxCollision=ce;ce.$_optionName="collision";var q=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});u.DxDropDownOptions=q;q.$_optionName="dropDownOptions";q.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var W=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxFrom=W;W.$_optionName="from";W.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var H=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxHide=H;H.$_optionName="hide";H.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var Y=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});u.DxItem=Y;Y.$_optionName="items";Y.$_isCollectionItem=!0;var de=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxMy=de;de.$_optionName="my";var pe=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxOffset=pe;pe.$_optionName="offset";var me=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});u.DxOptions=me;me.$_optionName="options";var fe=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});u.DxPosition=fe;fe.$_optionName="position";var he=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxShow=he;he.$_optionName="show";var ge=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxTo=ge;ge.$_optionName="to";var U=v.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});u.DxToolbarItem=U;U.$_optionName="toolbarItems";U.$_isCollectionItem=!0;var ie=u.default=se;const At={class:"content-block dx-card responsive-paddings"},Mt=["title"],Vt=["title"],jt=["title"],zt=["title"],Kt=["title"],qt=["title"],Wt=["title"],Ht=["title"],Yt=["title"],Ut=["title"],Xt=["title"],Zt=["title"],Gt=["title"],Jt=["title"],Qt=["src"],no={__name:"Index",setup(w){const ve={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.35}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},c=Ct(),X=St(),{t:g}=wt(),be=ne("devices"),p=ne("mf"),y=b(null),Z=b(null),ye=b(null),Ce=b(null),Se=b(null),x=b(null),_=b(null),I=b(null),N=b(null),R=b(null),A=b(null),we=b(null);let e={chart:{},series:{},data:{ohlc:[],price:[],cash:[]},tools:{lines:[],target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},rr:{EP:{},SL:{},TP:{}},range:[]},crosshair:{},isCashDraw:!1,isOnlyLoadData:!1,showNewsInfo:!1};const r=xt({symbol:X.query.symbol??"VNINDEX",timeframe:"D",symbolKind:null,symbolKinds:[{text:g("trading.stock.symbolList.hose"),value:"hose"},{text:g("trading.stock.symbolList.nh"),value:"nh"},{text:g("trading.stock.symbolList.ck"),value:"ck"},{text:g("trading.stock.symbolList.filterCash"),value:"f_cash"},{text:g("trading.stock.symbolList.filterMix"),value:"f_mix"},{text:g("trading.stock.symbolList.watch"),value:"watch"},{text:g("trading.stock.symbolList.hold"),value:"hold"},{text:g("trading.stock.symbolList.hnx"),value:"hnx"}],color:"#F44336",showColorPicker:!1,isFullscreen:!1,showTradingView:!1});r.symbolKind=X.query.list??"hose";const xe=L(()=>`https://chart.vps.com.vn/tv/?symbol=${r.symbol}`),G=L(()=>c.state.tradingStock.symbols.watch.includes(r.symbol)),ke=L(()=>c.state.tradingStock.symbols[r.symbolKind]),Te=L(()=>c.state.tradingStock.chart.dividend?" dividend":"");c.dispatch("tradingStock/getSymbols"),kt(()=>{e.chart=$t(Z.value,ve),e.chart.subscribeCrosshairMove(Le),e.chart.subscribeCustomPriceLineDragged(Fe),e.series.range=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.events=e.chart.addHistogramSeries({priceScaleId:"events",scaleMargins:{top:.96,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.vnindex=e.chart.addLineSeries({priceScaleId:"vnindex",scaleMargins:{top:.05,bottom:.76},color:"aqua",priceFormat:{minMove:.01},lastValueVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.66,bottom:.05},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#42946C",downColor:"#BC3E4A",borderVisible:!1,wickUpColor:"#42946C",wickDownColor:"#BC3E4A",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(Ee).observe(y.value),document.addEventListener("fullscreenchange",Pe),c.dispatch("tradingStock/initChart",{symbol:r.symbol,timeframe:r.timeframe}).then(t=>{e.series.vnindex.setData(t.vnindex),e.tools.range=t.range,e.series.range.setData(t.range)})}),Tt(()=>c.state.tradingStock.chart,()=>{e.isOnlyLoadData||(_e(),Ne()),Re()});function k(t){t.preventDefault(),t.stopPropagation()}function De(t){x.value.classList.contains("selected")?ze():_.value.classList.contains("selected")?We():I.value.classList.contains("selected")?Q():N.value.classList.contains("selected")?ee():R.value.classList.contains("selected")?ot():A.value.classList.contains("selected")?it():ut(),k(t)}function Le(t){if(t.time){let n=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=n}else be.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function Fe(t){let n=t.customPriceLine,o=n.options();o.price=z(o.price);const l=+t.fromPriceString;switch(+o.price,o.lineType){case"line":c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:r.symbol,name:o.lineType,points:[l],data:[o]}),x.value.classList.remove("selected");break;case"target":if(p.isSet(e.tools.target.B)){let i={isRemove:!1,symbol:r.symbol,name:"target",points:[],data:[]},a;const s=+e.tools.target.A.options().price,m=+e.tools.target.B.options().price-s;o.point=="A"&&(a="A",i.points.push(a),i.data.push(e.tools.target[a].options())),a="B",e.tools.target[a].applyOptions({title:(100*m/s).toFixed(1)+"%"}),i.points.push(a),i.data.push(e.tools.target[a].options()),a="X",e.tools.target[a].applyOptions({price:+(s-.5*m).toFixed(2),title:(100*-.5*m/s).toFixed(1)+"%"}),i.points.push(a),i.data.push(e.tools.target[a].options()),a="Y",e.tools.target[a].applyOptions({price:+(s-m).toFixed(2),title:(100*-m/s).toFixed(1)+"%"}),i.points.push(a),i.data.push(e.tools.target[a].options()),a="Z",e.tools.target[a].applyOptions({price:+(s-2*m).toFixed(2),title:(100*-2*m/s).toFixed(1)+"%"}),i.points.push(a),i.data.push(e.tools.target[a].options()),c.dispatch("tradingStock/drawTools",i)}break;case"rr":if(p.isSet(e.tools.rr.TP)){let i={isRemove:!1,symbol:r.symbol,name:"rr",points:[],data:[]},a;const s=+e.tools.rr.EP.options().price,d=+e.tools.rr.SL.options().price,m=+e.tools.rr.TP.options().price,C=d-s;if((m-s)/C>0)return n.applyOptions({price:l}),!1;const S=Math.abs(m-s)/Math.abs(d-s),gt=(d-s)/s*100,vt=(m-s)/s*100;a="EP",e.tools.rr[a].applyOptions({title:`RR=${S.toFixed(1)}`}),i.points.push(a),i.data.push(e.tools.rr[a].options()),a="SL",e.tools.rr[a].applyOptions({title:`SL=${gt.toFixed(1)}%`}),i.points.push(a),i.data.push(e.tools.rr[a].options()),a="TP",e.tools.rr[a].applyOptions({title:`TP=${vt.toFixed(1)}%`}),i.points.push(a),i.data.push(e.tools.rr[a].options()),c.dispatch("tradingStock/drawTools",i)}break}}function Ee(){y.value&&(e.chart.resize(y.value.offsetWidth,y.value.offsetHeight),y.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Pe(){y.value&&(document.fullscreenElement?(r.isFullscreen=!0,y.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(r.isFullscreen=!1,y.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Oe(){B(`${g("trading.stock.removeFilterList")}?`,g("titles.confirm")).then(t=>{if(t){const n=c.state.tradingStock.symbols[r.symbolKind];let o=n.findIndex(i=>i==r.symbol);o=o==n.length-1?0:o+1;const l={symbol:r.symbol,name:r.symbolKind};c.dispatch("tradingStock/removeFilterList",l).then(()=>r.symbol=n[o])}})}function Be(){if(!r.symbol)return!1;const t={symbol:r.symbol,add:!G.value};c.dispatch("tradingStock/addWatchlist",t)}function $e(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function _e(){J(!1),M(!1),T(!1),T(!1,!0),D(!1),D(!1,!0),V(!1),Ie()}function Ie(){const t=c.state.tradingStock.chart.tools;for(const[n,o]of Object.entries(t))switch(n){case"line":Object.values(o).forEach(l=>e.tools.lines.push(e.series.price.createPriceLine(l)));break;case"target":Object.entries(o).forEach(([l,i])=>e.tools.target[l]=e.series.price.createPriceLine(i));break;case"rr":Object.entries(o).forEach(([l,i])=>e.tools.rr[l]=e.series.price.createPriceLine(i));break;default:n.includes("uplps")?Object.entries(o).forEach(([l,i])=>e.tools.uplps[l]=e.series[l.includes("P")?"price":"cash"].createPriceLine(i)):n.includes("downlps")&&Object.entries(o).forEach(([l,i])=>e.tools.downlps[l]=e.series[l.includes("P")?"price":"cash"].createPriceLine(i));break}}function Ne(){e.series.events.setData(c.state.tradingStock.chart.events)}function Re(){e.data=c.state.tradingStock.chart.data,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:r.symbol}})}function Ae(t){r.showTradingView=!r.showTradingView}function Me(t){r.showColorPicker=!r.showColorPicker}function Ve(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n||t.target.classList.add("selected")}function je(t){J(),t.target.classList.remove("selected")}function ze(t=null,n=!1,o=!1){const l="line";t||(t=z(j(e.crosshair.y)));const i=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(a=>{const s=a.options(),d=s.type=t==+s.price;return d&&(e.series.price.removePriceLine(a),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:l,point:t})),!d}),e.tools.lines.length==i&&!o||n){const a={lineType:l,price:t,color:r.color,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(a)),c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:r.symbol,name:l,points:[t],data:[a]})}x.value.classList.remove("selected")}function J(t=!0){e.tools.lines.length>0&&(console.log("removeLineTool"),e.tools.lines.forEach(n=>e.series.price.removePriceLine(n)),e.tools.lines=[],t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:"line",point:null}))}function Ke(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n||(t.target.classList.add("selected"),M())}function qe(t){M(),t.target.classList.remove("selected")}function We(){const t="target",n=j(e.crosshair.y);let o={lineType:t,price:n,lineWidth:1,lineStyle:1,draggable:!0},l={isRemove:!1,symbol:r.symbol,name:t,points:[],data:[]};if(p.isSet(e.tools.target.A)){const i=+e.tools.target.A.options().price,a=n-i;o.point="B",o.title=(100*a/i).toFixed(1)+"%",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o)),o.point="X",o.price=+(i-.5*a).toFixed(2),o.title=(100*-.5*a/i).toFixed(1)+"%",o.color="#2196F3",e.tools.target[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o)),o.point="Y",o.price=+(i-a).toFixed(2),o.title=(100*-a/i).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o)),o.point="Z",o.price=+(i-2*a).toFixed(2),o.title=(100*-2*a/i).toFixed(1)+"%",o.color="#673AB7",e.tools.target[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o)),_.value.classList.remove("selected")}else o.point="A",o.title="0",o.color="#FF9800",e.tools.target[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o));c.dispatch("tradingStock/drawTools",l)}function M(t=!0){p.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),p.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z)),e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:"target"})}function He(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n?Q():t.target.classList.add("selected")}function Ye(t){T(),t.target.classList.remove("selected")}function Q(){let t,n;const o=e.isCashDraw?"cash":"price",l=e.isCashDraw?"C":"P";p.isSet(e.tools.uplps[`${l}1`])?(t=+e.tools.uplps[`${l}1`].options().startTime,n=e.crosshair.time,T(!1)):t=e.crosshair.time;const{value1:i,value2:a}=Ue(t,n);let s={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},d={isRemove:!1,symbol:r.symbol,name:`${o}uplps`,points:[],data:[]};s.startTime=t,s.price=i,s.title=`${l}1`,e.tools.uplps[s.title]=e.series[o].createPriceLine(s),d.points.push(s.title),d.data.push(p.cloneDeep(s)),s.price=a,s.title=`${l}2`,e.tools.uplps[s.title]=e.series[o].createPriceLine(s),d.points.push(s.title),d.data.push(p.cloneDeep(s)),c.dispatch("tradingStock/drawTools",d),I.value.classList.remove("selected")}function Ue(t,n){let o,l,i,a=0,s=0;const d=e.data[e.isCashDraw?"cash":"price"];for(let m=0;m<d.length;m++){const C=d[m].time;if(C<t)continue;if(n&&C>n)break;const f=d[m].value;if(o==null&&(o=f,l=f,i=f),f>i)a>s&&(l=i,s=a),i=f,a=0;else if(f<i){const S=+(i-f).toFixed(2);S>a&&(a=S)}if(f<o&&s>0)break}return{value1:+(l-s).toFixed(2),value2:+(i-s).toFixed(2)}}function T(t=!0,n=!1){const o=e.isCashDraw||n,l=o?"cash":"price",i=o?"C":"P",a=`${i}1`,s=`${i}2`;p.isSet(e.tools.uplps[a])&&(e.series[l].removePriceLine(e.tools.uplps[a]),e.series[l].removePriceLine(e.tools.uplps[s])),e.tools.uplps[a]={},e.tools.uplps[s]={},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:`${l}uplps`})}function Xe(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n?ee():t.target.classList.add("selected")}function Ze(t){D(),t.target.classList.remove("selected")}function ee(){let t,n;const o=e.isCashDraw?"cash":"price",l=e.isCashDraw?"C":"P";p.isSet(e.tools.downlps[`${l}1`])?(t=+e.tools.downlps[`${l}1`].options().startTime,n=e.crosshair.time,D()):t=e.crosshair.time;const{value1:i,value2:a}=Ge(t,n);let s={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},d={isRemove:!1,symbol:r.symbol,name:`${o}downlps`,points:[],data:[]};s.startTime=t,s.price=i,s.title=`${l}1`,e.tools.downlps[s.title]=e.series[o].createPriceLine(s),d.points.push(s.title),d.data.push(p.cloneDeep(s)),s.price=a,s.title=`${l}2`,e.tools.downlps[s.title]=e.series[o].createPriceLine(s),d.points.push(s.title),d.data.push(p.cloneDeep(s)),c.dispatch("tradingStock/drawTools",d),N.value.classList.remove("selected")}function Ge(t,n){let o,l,i,a=0,s=0;const d=e.data[e.isCashDraw?"cash":"price"];for(let m=0;m<d.length;m++){const C=d[m].time;if(C<t)continue;if(n&&C>n)break;const f=d[m].value;if(o==null&&(o=f,l=f,i=f),f<i)a<s&&(l=i,s=a),i=f,a=0;else if(f>i){const S=+(i-f).toFixed(2);S<a&&(a=S)}if(f>o&&s<0)break}return{value1:+(l-s).toFixed(2),value2:+(i-s).toFixed(2)}}function D(t=!0,n=!1){const o=e.isCashDraw||n,l=o?"cash":"price",i=o?"C":"P",a=`${i}1`,s=`${i}2`;p.isSet(e.tools.downlps[a])&&(e.series[l].removePriceLine(e.tools.downlps[a]),e.series[l].removePriceLine(e.tools.downlps[s])),e.tools.downlps[a]={},e.tools.downlps[s]={},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:`${l}downlps`})}function Je(t){t.target.classList.contains("selected")?(t.target.classList.remove("selected"),e.isCashDraw=!1):(t.target.classList.add("selected"),e.isCashDraw=!0)}function Qe(t){e.isCashDraw=!1,t.target.classList.remove("selected")}function et(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n||(t.target.classList.add("selected"),V())}function tt(t){V(),t.target.classList.remove("selected")}function ot(){const t="rr",n=j(e.crosshair.y);let o={lineType:t,price:n,lineWidth:1,lineStyle:1,draggable:!0},l={isRemove:!1,symbol:r.symbol,name:t,points:[],data:[]};if(p.isSet(e.tools.rr.EP)){const i=+e.tools.rr.EP.options().price;if(p.isSet(e.tools.rr.SL)){const s=+e.tools.rr.SL.options().price-i,d=n-i;if(d/s>0)return!1;const m=(n-i)/i*100;o.point="TP",o.title=`TP=${m.toFixed(1)}%`,o.color="lime",e.tools.rr[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o));const C=Math.abs(d)/Math.abs(s),f="EP";e.tools.rr[f].applyOptions({title:`RR=${C.toFixed(1)}`}),l.points.push(f),l.data.push(e.tools.rr[f].options()),R.value.classList.remove("selected")}else{const a=(n-i)/i*100;o.point="SL",o.title=`SL=${a.toFixed(1)}%`,o.color="red",e.tools.rr[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o))}}else o.point="EP",o.title="RR=",o.color="yellow",e.tools.rr[o.point]=e.series.price.createPriceLine(o),l.points.push(o.point),l.data.push(p.cloneDeep(o));c.dispatch("tradingStock/drawTools",l)}function V(t=!0){p.isSet(e.tools.rr.EP)&&(e.series.price.removePriceLine(e.tools.rr.EP),p.isSet(e.tools.rr.SL)&&(e.series.price.removePriceLine(e.tools.rr.SL),p.isSet(e.tools.rr.TP)&&e.series.price.removePriceLine(e.tools.rr.TP))),e.tools.rr={EP:{},SL:{},TP:{}},t&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:r.symbol,name:"rr"})}function nt(t){r.showColorPicker=!1;const n=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),n||t.target.classList.add("selected")}function lt(t){at(),t.target.classList.remove("selected")}function it(){let t={isRemove:!1,symbol:"ALL",name:"range",points:[],data:[]},n={time:e.crosshair.time,value:1};e.tools.range.length>0?(n.color="red",e.tools.range[1]=n,t.points.push(1),A.value.classList.remove("selected")):(n.color="aqua",e.tools.range[0]=n,t.points.push(0)),e.series.range.setData(e.tools.range),t.data.push(n),c.dispatch("tradingStock/drawTools",t)}function at(){e.tools.range=[],e.series.range.setData([]),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:"ALL",name:"range"})}function st(t){t.target.classList.contains("selected")?(t.target.classList.remove("selected"),e.showNewsInfo=!1):(t.target.classList.add("selected"),e.showNewsInfo=!0)}function rt(t){e.showNewsInfo=!1,t.target.classList.remove("selected")}function ut(){if(e.showNewsInfo){const t=c.state.tradingStock.chart.events.find(n=>n.time==e.crosshair.time);if(p.isSet(t)){const n=t.title.split("|");let o=`
                <div>${g("trading.stock.date")} ${moment.unix(t.time).format("DD/MM/YYYY")}:</div>
                <div>&nbsp;</div>
                `;n.forEach(l=>{o+=`<div>${l}</div>`}),Ot(o,g("trading.stock.event"))}}}function j(t,n="price"){return z(e.series[n].coordinateToPrice(t))}function z(t){return t?+ +t.toFixed(2):0}function ct(t){if(!r.symbol)return!1;e.isOnlyLoadData=!1,c.dispatch("tradingStock/getChartData",{symbol:r.symbol,timeframe:r.timeframe})}function te(){e.isOnlyLoadData=!0,c.dispatch("tradingStock/getChartData",{symbol:r.symbol,timeframe:r.timeframe})}function dt(t){const n=c.state.tradingStock.symbols[r.symbolKind];let o=n.findIndex(l=>l==r.symbol);o=o==n.length-1?0:o+1,r.symbol=n[o]}function pt(t){r.symbolKind=t.value}function mt(){B(`${g("trading.stock.cloneSymbols")}?`,g("titles.confirm")).then(t=>{t&&c.dispatch("tradingStock/cloneSymbols")})}function ft(){B(`${g("trading.stock.deleteWatchList")}?`,g("titles.confirm")).then(t=>{t&&c.dispatch("tradingStock/deleteWatchlist")})}function ht(){e.tools.range.length==2?B(`${g("trading.stock.filterSymbols")}?`,g("titles.confirm")).then(t=>{if(t){const n={from:e.tools.range[0].time,to:e.tools.range[1].time,timeframe:r.timeframe,name:r.symbolKind};c.dispatch("tradingStock/filterSymbols",n)}}):Et.error(g("trading.stock.rangeWarning"))}return(t,n)=>{const o=Dt("DxToolbar");return Pt(),Lt("div",At,[F(o,{items:[{visible:t.$mf.isSet(t.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:t.$t("buttons.back"),onClick:()=>t.$router.go(-1)}},{location:"before",widget:"dxSelectBox",options:{width:"130px",dataSource:r.symbolKinds,valueExpr:"value",displayExpr:"text",value:r.symbolKind,hint:t.$t("trading.stock.symbolKind"),onValueChanged:pt}},{location:"after",widget:"dxButton",options:{icon:"far fa-list small",hint:t.$t("trading.stock.cloneSymbols"),onClick:mt}},{location:"after",widget:"dxButton",options:{icon:"far fa-folder-times small",hint:t.$t("trading.stock.deleteWatchList"),onClick:ft}},{location:"after",widget:"dxButton",options:{icon:"far fa-filter small",hint:t.$t("trading.stock.filterSymbols"),onClick:ht}}]},null,8,["items"]),h("div",{class:"stock-container",ref_key:"chartContainerRef",ref:y,onClick:De,onContextmenu:k},[h("div",{class:"chart-wrapper",ref_key:"chartRef",ref:Z},[h("div",{class:"area data-area",onClick:k},[F(le(ie),{width:t.$screen.getScreenSizeInfo.isXSmall?"140px":"130px","data-source":ke.value,"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:`command symbol-select ${Te.value}`},modelValue:r.symbol,"onUpdate:modelValue":n[0]||(n[0]=l=>r.symbol=l),onValueChanged:ct},null,8,["width","data-source","element-attr","modelValue"]),F(le(ie),{width:"60px","data-source":["D","W","M"],"element-attr":{class:"command timeframe-select"},modelValue:r.timeframe,"onUpdate:modelValue":n[1]||(n[1]=l=>r.timeframe=l),onValueChanged:te},null,8,["modelValue"]),h("div",{class:"command",title:t.$t("trading.stock.reload"),onClick:te,onContextmenu:dt},[h("i",{class:E(`far fa-sync-alt ${t.$store.state.tradingStock.isChartLoading?"fa-spin":""}`)},null,2)],40,Mt),P(h("div",{class:E("command far fa-times"),title:t.$t("trading.stock.removeFilterList"),onClick:Oe},null,8,Vt),[[O,r.symbolKind.includes("f_")]]),P(h("div",{ref:"addWatchlistToolRef",class:E(`command far fa-${G.value?"minus-circle":"plus-circle"}`),title:t.$t("trading.stock.addWatchlist"),onClick:Be},null,10,jt),[[O,!!r.symbol]])]),h("div",{class:"area tool-area",onClick:k},[h("div",{ref_key:"fullscreenToolRef",ref:ye,class:E(`command far fa-${r.isFullscreen?"compress":"expand"}`),title:t.$t("trading.stock.fullscreen"),onClick:$e},null,10,zt),h("div",{ref_key:"tradingviewRef",ref:Ce,class:"command far fa-chart-bar",title:t.$t("trading.stock.tradingview"),onClick:Ae},null,8,Kt),h("div",{ref_key:"colorToolRef",ref:Se,class:"color command far fa-palette",style:Ft({color:r.color}),title:t.$t("trading.stock.tools.color"),onClick:Me},[P(F(Bt,{class:"color-picker",modelValue:r.color,"onUpdate:modelValue":n[2]||(n[2]=l=>r.color=l)},null,8,["modelValue"]),[[O,r.showColorPicker]])],12,qt),h("div",{ref_key:"lineToolRef",ref:x,class:"command far fa-horizontal-rule",title:t.$t("trading.stock.tools.line"),onClick:Ve,onContextmenu:je},null,40,Wt),h("div",{ref_key:"uplpsToolRef",ref:I,class:"command far fa-arrow-up",title:t.$t("trading.stock.tools.uplps"),onClick:He,onContextmenu:Ye},null,40,Ht),h("div",{ref:"cashToolRef",class:"command drawless far fa-dot-circle",title:t.$t("trading.stock.tools.cash"),onClick:Je,onContextmenu:Qe},null,40,Yt),h("div",{ref_key:"downlpsToolRef",ref:N,class:"command far fa-arrow-down",title:t.$t("trading.stock.tools.downlps"),onClick:Xe,onContextmenu:Ze},null,40,Ut),h("div",{ref_key:"targetToolRef",ref:_,class:"command far fa-flag-checkered",title:t.$t("trading.stock.tools.target"),onClick:Ke,onContextmenu:qe},null,40,Xt),h("div",{ref_key:"rrToolRef",ref:R,class:"command far fa-line-height",title:t.$t("trading.stock.tools.rr"),onClick:et,onContextmenu:tt},null,40,Zt),h("div",{ref_key:"rangeToolRef",ref:A,class:"command far fa-grip-lines-vertical",title:t.$t("trading.stock.tools.range"),onClick:nt,onContextmenu:lt},null,40,Gt),h("div",{ref:"eventsToolRef",class:"command drawless far fa-map-marker-exclamation",title:t.$t("trading.stock.tools.events"),onClick:st,onContextmenu:rt},null,40,Jt)]),P(h("iframe",{ref_key:"tradingviewChartRef",ref:we,class:"tradingview-chart",src:xe.value},null,8,Qt),[[O,r.showTradingView]])],512)],544)])}}};export{no as default};
