import{bQ as mr,Z as Y,$ as O,au as Et,az as Ke,a3 as dt,b7 as Ie,aB as $,ah as Ze,co as xi,c1 as Di,at as de,ad as Ae,ae as Fi,ci as tt,am as ne,bi as Ue,cp as ze,aI as Re,ar as we,cq as $t,bK as Vt,an as ot,bu as at,bq as vt,a2 as ae,bc as Ge,as as fr,cr as gr,bk as gt,cs as vr,ai as Kt,b2 as Gt,aM as Le,ak as At,ct as Mi,ap as fe,a1 as Te,c4 as Pe,bl as Ir,bs as Ti,aJ as ve,b_ as _t,cu as mt,b$ as Cr,cv as yr,cw as Sr,aF as br,bm as Pi,aL as Oi,aH as Er,cx as Ce,cd as Ar,cy as wr,al as It,cz as xr,cA as Dr,cB as Fr,cC as Mr,bO as Tr,aj as Pr,cc as kt,a0 as Wt,cD as Or,aA as kr,av as Rr,cE as Lr,cF as ki,cG as Br,cf as Nr,cH as Ht,cI as Ri,cJ as Li,a5 as Ur,aw as zr,cK as $r,bG as je,cL as Vr,b8 as Kr,cM as Gr,cN as Wr,M as Hr,O as be,u as jr,k as jt,r as ft,w as Zr,o as qr,b as Xr,e as Zt,g as Yr,P as Jr,F as Qr,x as it}from"./app-a379b0c5.js";import{f as qt}from"./file_saver-4c47e254.js";import{T as en}from"./editor-db1f33d0.js";var tn="dx-trackbar",rn="dx-trackbar-container",nn="dx-trackbar-range",an="dx-trackbar-wrapper",Bi=mr.inherit({_getDefaultOptions(){return Y(this.callBase(),{min:0,max:100,value:0})},_initMarkup(){this.$element().addClass(tn),this._renderWrapper(),this._renderContainer(),this._renderRange(),this._renderValue(),this._setRangeStyles(),this.callBase()},_render(){this.callBase(),this._setRangeStyles(this._rangeStylesConfig())},_renderWrapper(){this._$wrapper=O("<div>").addClass(an).appendTo(this.$element())},_renderContainer(){this._$bar=O("<div>").addClass(rn).appendTo(this._$wrapper)},_renderRange(){this._$range=O("<div>").addClass(nn).appendTo(this._$bar)},_renderValue(){var w=this.option("value"),e=this.option("min"),t=this.option("max");if(!(e>t)){if(w<e){this.option("value",e),this._currentRatio=0;return}if(w>t){this.option("value",t),this._currentRatio=1;return}var i=e===t?0:(w-e)/(t-e);!this._needPreventAnimation&&this._setRangeStyles({width:"".concat(100*i,"%")}),this.setAria({valuemin:this.option("min"),valuemax:t,valuenow:w}),this._currentRatio=i}},_rangeStylesConfig(){return{width:"".concat(100*this._currentRatio,"%")}},_setRangeStyles(w){if(Et.stop(this._$range),!w){this._$range.css({width:0});return}this._needPreventAnimation||!Ke()||Et.animate(this._$range,{type:"custom",duration:100,to:w})},_optionChanged(w){switch(w.name){case"value":this._renderValue(),this.callBase(w);break;case"max":case"min":this._renderValue();break;default:this.callBase(w)}},_dispose(){Et.stop(this._$range),this.callBase()}});dt("dxTrackBar",Bi);var sn="dx-progressbar",on="dx-progressbar-container",ln="dx-progressbar-range-container",dn="dx-progressbar-range",hn="dx-progressbar-wrapper",cn="dx-progressbar-status",un="dx-progressbar-animating-container",Xt="dx-progressbar-animating-segment",Rt=Bi.inherit({_getDefaultOptions(){return Y(this.callBase(),{value:0,statusFormat:w=>"Progress: ".concat(Math.round(100*w),"%"),showStatus:!0,onComplete:null,activeStateEnabled:!1,statusPosition:"bottom left",_animatingSegmentCount:0})},_defaultOptionsRules(){return this.callBase().concat([{device:w=>w.platform==="android",options:{_animatingSegmentCount:2}}])},_initMarkup(){this._renderStatus(),this._createCompleteAction(),this.callBase(),this.$element().addClass(sn),this._$wrapper.addClass(hn),this._$bar.addClass(on),this.setAria("role","progressbar"),O("<div>").addClass(ln).appendTo(this._$wrapper).append(this._$bar),this._$range.addClass(dn),this._toggleStatus(this.option("showStatus"))},_useTemplates:()=>!1,_createCompleteAction(){this._completeAction=this._createActionByOption("onComplete")},_renderStatus(){this._$status=O("<div>").addClass(cn)},_renderIndeterminateState(){this._$segmentContainer=O("<div>").addClass(un);for(var w=this.option("_animatingSegmentCount"),e=0;e<w;e++)O("<div>").addClass(Xt).addClass("".concat(Xt,"-").concat(e+1)).appendTo(this._$segmentContainer);this._$segmentContainer.appendTo(this._$wrapper)},_toggleStatus(w){var e=this.option("statusPosition").split(" ");w?e[0]==="top"||e[0]==="left"?this._$status.prependTo(this._$wrapper):this._$status.appendTo(this._$wrapper):this._$status.detach(),this._togglePositionClass()},_togglePositionClass(){var w=this.option("statusPosition"),e=w.split(" ");this._$wrapper.removeClass("dx-position-top-left dx-position-top-right dx-position-bottom-left dx-position-bottom-right dx-position-left dx-position-right");var t="dx-position-".concat(e[0]);e[1]&&(t+="-".concat(e[1])),this._$wrapper.addClass(t)},_toggleIndeterminateState(w){w?(this._renderIndeterminateState(),this._$bar.toggle(!1)):(this._$bar.toggle(!0),this._$segmentContainer.remove(),delete this._$segmentContainer)},_renderValue(){var w=this.option("value"),e=this.option("max");if(!w&&w!==0){this._toggleIndeterminateState(!0);return}this._$segmentContainer&&this._toggleIndeterminateState(!1),w===e&&this._completeAction(),this.callBase(),this._setStatus()},_setStatus(){var w=this.option("statusFormat");Ie(w)?w=w.bind(this):w=function(t){return t};var e=w(this._currentRatio,this.option("value"));this._$status.text(e)},_dispose(){this._$status.remove(),this.callBase()},_optionChanged(w){switch(w.name){case"statusFormat":this._setStatus();break;case"showStatus":this._toggleStatus(w.value);break;case"statusPosition":this._toggleStatus(this.option("showStatus"));break;case"onComplete":this._createCompleteAction();break;case"_animatingSegmentCount":break;default:this.callBase(w)}}});dt("dxProgressBar",Rt);var lt=Ge(),pn="dx-fileuploader",_n="dx-fileuploader-empty",mn="dx-fileuploader-show-file-list",Yt="dx-fileuploader-dragover",fn="dx-fileuploader-wrapper",gn="dx-fileuploader-container",vn="dx-fileuploader-content",In="dx-fileuploader-input-wrapper",Cn="dx-fileuploader-input-container",yn="dx-fileuploader-input-label",Sn="dx-fileuploader-input",bn="dx-fileuploader-files-container",Jt="dx-fileuploader-file-container",En="dx-fileuploader-file-info",An="dx-fileuploader-file-status-message",wn="dx-fileuploader-file",Qt="dx-fileuploader-file-name",ei="dx-fileuploader-file-size",rt="dx-fileuploader-button",wt="dx-fileuploader-button-container",xn="dx-fileuploader-cancel-button",ti="dx-fileuploader-upload-button",Dn="dx-fileuploader-invalid",ii=400,Fn="chunkMetadata",ri=1,Mn=()=>O("<input>").attr("type","file"),xt=()=>!!lt.FormData;class Ni extends en{_supportedKeys(){var e=t=>{t.preventDefault();var i=this._selectButton.$element();de.trigger(i,fr)};return Y(super._supportedKeys(),{space:e,enter:e})}_setOptionsByReference(){super._setOptionsByReference(),Y(this._optionsByReference,{value:!0})}_getDefaultOptions(){return Y(super._getDefaultOptions(),{chunkSize:0,value:[],selectButtonText:$.format("dxFileUploader-selectFile"),uploadButtonText:$.format("dxFileUploader-upload"),labelText:$.format("dxFileUploader-dropFile"),name:"files[]",multiple:!1,accept:"",uploadUrl:"/",allowCanceling:!0,showFileList:!0,progress:0,dialogTrigger:void 0,dropZone:void 0,readyToUploadMessage:$.format("dxFileUploader-readyToUpload"),uploadedMessage:$.format("dxFileUploader-uploaded"),uploadFailedMessage:$.format("dxFileUploader-uploadFailedMessage"),uploadAbortedMessage:$.format("dxFileUploader-uploadAbortedMessage"),uploadMode:"instantly",uploadMethod:"POST",uploadHeaders:{},uploadCustomData:{},onBeforeSend:null,onUploadStarted:null,onUploaded:null,onFilesUploaded:null,onProgress:null,onUploadError:null,onUploadAborted:null,onDropZoneEnter:null,onDropZoneLeave:null,allowedFileExtensions:[],maxFileSize:0,minFileSize:0,inputAttr:{},invalidFileExtensionMessage:$.format("dxFileUploader-invalidFileExtension"),invalidMaxFileSizeMessage:$.format("dxFileUploader-invalidMaxFileSize"),invalidMinFileSizeMessage:$.format("dxFileUploader-invalidMinFileSize"),extendSelection:!0,validationMessageMode:"always",uploadFile:null,uploadChunk:null,abortUpload:null,validationMessageOffset:{h:0,v:0},hoverStateEnabled:!0,useNativeInputClick:!1,useDragOver:!0,nativeDropSupported:!0,_uploadButtonType:"normal",_buttonStylingMode:"contained"})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:()=>Ze.real().deviceType==="desktop"&&!Ze.isSimulator(),options:{focusStateEnabled:!0}},{device:[{platform:"android"}],options:{validationMessageOffset:{v:0}}},{device:()=>Ze.real().deviceType!=="desktop",options:{useDragOver:!1}},{device:()=>!xt(),options:{uploadMode:"useForm"}},{device:()=>Ze.real().deviceType!=="desktop",options:{nativeDropSupported:!1}},{device:()=>xi(),options:{_uploadButtonType:"default"}},{device:()=>Di(),options:{_buttonStylingMode:"text"}}])}_initOptions(e){var t="labelText"in e;super._initOptions(e),!t&&!this._shouldDragOverBeRendered()&&this.option("labelText","")}_init(){super._init(),this._initFileInput(),this._initLabel(),this._setUploadStrategy(),this._createFiles(),this._createBeforeSendAction(),this._createUploadStartedAction(),this._createUploadedAction(),this._createFilesUploadedAction(),this._createProgressAction(),this._createUploadErrorAction(),this._createUploadAbortedAction(),this._createDropZoneEnterAction(),this._createDropZoneLeaveAction()}_setUploadStrategy(){if(this.option("chunkSize")>0){var e=this.option("uploadChunk");this._uploadStrategy=e&&Ie(e)?new On(this):new Pn(this)}else{var t=this.option("uploadFile");this._uploadStrategy=t&&Ie(t)?new Rn(this):new kn(this)}}_initFileInput(){this._isCustomClickEvent=!1;var{multiple:e,accept:t,hint:i}=this.option();this._$fileInput||(this._$fileInput=Mn(),de.on(this._$fileInput,"change",this._inputChangeHandler.bind(this)),de.on(this._$fileInput,"click",n=>(n.stopPropagation(),this._resetInputValue(),this.option("useNativeInputClick")||this._isCustomClickEvent)));var r={multiple:e,accept:t,tabIndex:-1};ne(i)&&(r.title=i),this._$fileInput.prop(r)}_inputChangeHandler(){if(!this._doPreventInputChange){var e=this._$fileInput.val().replace(/^.*\\/,""),t=this._$fileInput.prop("files");if(!(t&&!t.length&&this.option("uploadMode")!=="useForm")){var i=t?this._getFiles(t):[{name:e}];this._changeValue(i),this.option("uploadMode")==="instantly"&&this._uploadFiles()}}}_shouldFileListBeExtended(){return this.option("uploadMode")!=="useForm"&&this.option("extendSelection")&&this.option("multiple")}_changeValue(e){var t=this._shouldFileListBeExtended()?this.option("value").slice():[];this.option("value",t.concat(e))}_getFiles(e){var t=[];return Ae(e,(i,r)=>t.push(r)),t}_getFile(e){var t=Fi(e)?this.option("value")[e]:e;return this._files.filter(i=>i.value===t)[0]}_initLabel(){this._$inputLabel||(this._$inputLabel=O("<div>")),this._updateInputLabelText()}_updateInputLabelText(){var e=this._isInteractionDisabled()?"":this.option("labelText");this._$inputLabel.text(e)}_focusTarget(){return this.$element().find(".".concat(rt))}_getSubmitElement(){return this._$fileInput}_initMarkup(){super._initMarkup(),this.$element().addClass(pn),this._renderWrapper(),this._renderInputWrapper(),this._renderSelectButton(),this._renderInputContainer(),this._renderUploadButton(),this._preventRecreatingFiles=!0,this._activeDropZone=null}_render(){this._preventRecreatingFiles=!1,this._attachDragEventHandlers(this._$inputWrapper),this._attachDragEventHandlers(this.option("dropZone")),this._renderFiles(),super._render()}_createFileProgressBar(e){e.progressBar=this._createProgressBar(e.value.size),e.progressBar.$element().appendTo(e.$file),this._initStatusMessage(e),this._ensureCancelButtonInitialized(e)}_setStatusMessage(e,t){setTimeout(()=>{this.option("showFileList")&&e.$statusMessage&&(e.$statusMessage.text(t),e.$statusMessage.css("display",""),e.progressBar.$element().remove())},ii)}_getUploadAbortedStatusMessage(){return this.option("uploadMode")==="instantly"?this.option("uploadAbortedMessage"):this.option("readyToUploadMessage")}_createFiles(){var e=this.option("value");this._files&&((e==null?void 0:e.length)===0||!this._shouldFileListBeExtended())&&(this._preventFilesUploading(this._files),this._files=null),this._files||(this._files=[]),Ae(e==null?void 0:e.slice(this._files.length),(t,i)=>{var r=this._createFile(i);this._validateFile(r),this._files.push(r)})}_preventFilesUploading(e){e.forEach(t=>this._uploadStrategy.abortUpload(t))}_validateFile(e){e.isValidFileExtension=this._validateFileExtension(e),e.isValidMinSize=this._validateMinFileSize(e),e.isValidMaxSize=this._validateMaxFileSize(e)}_validateFileExtension(e){var t=this.option("allowedFileExtensions"),i=this.option("accept"),r=this._getAllowedFileTypes(i),n=e.value.name.substring(e.value.name.lastIndexOf(".")).toLowerCase();if((i==null?void 0:i.length)!==0&&!this._isFileTypeAllowed(e.value,r))return!1;if((t==null?void 0:t.length)===0)return!0;for(var a=0;a<t.length;a++)if(n===t[a].toLowerCase())return!0;return!1}_validateMaxFileSize(e){var t=e.value.size,i=this.option("maxFileSize");return i>0?t<=i:!0}_validateMinFileSize(e){var t=e.value.size,i=this.option("minFileSize");return i>0?t>=i:!0}_createBeforeSendAction(){this._beforeSendAction=this._createActionByOption("onBeforeSend",{excludeValidators:["readOnly"]})}_createUploadStartedAction(){this._uploadStartedAction=this._createActionByOption("onUploadStarted",{excludeValidators:["readOnly"]})}_createUploadedAction(){this._uploadedAction=this._createActionByOption("onUploaded",{excludeValidators:["readOnly"]})}_createFilesUploadedAction(){this._filesUploadedAction=this._createActionByOption("onFilesUploaded",{excludeValidators:["readOnly"]})}_createProgressAction(){this._progressAction=this._createActionByOption("onProgress",{excludeValidators:["readOnly"]})}_createUploadAbortedAction(){this._uploadAbortedAction=this._createActionByOption("onUploadAborted",{excludeValidators:["readOnly"]})}_createUploadErrorAction(){this._uploadErrorAction=this._createActionByOption("onUploadError",{excludeValidators:["readOnly"]})}_createDropZoneEnterAction(){this._dropZoneEnterAction=this._createActionByOption("onDropZoneEnter")}_createDropZoneLeaveAction(){this._dropZoneLeaveAction=this._createActionByOption("onDropZoneLeave")}_createFile(e){return{value:e,loadedSize:0,onProgress:tt(),onAbort:tt(),onLoad:tt(),onError:tt(),onLoadStart:tt(),isValidFileExtension:!0,isValidMaxSize:!0,isValidMinSize:!0,isValid(){return this.isValidFileExtension&&this.isValidMaxSize&&this.isValidMinSize},isInitialized:!1}}_resetFileState(e){e.isAborted=!1,e.uploadStarted=!1,e.isStartLoad=!1,e.loadedSize=0,e.chunksData=void 0,e.request=void 0}_renderFiles(){var e,t=this.option("value");this._$filesContainer?(!this._shouldFileListBeExtended()||(t==null?void 0:t.length)===0)&&this._$filesContainer.empty():this._$filesContainer=O("<div>").addClass(bn).appendTo(this._$content);var i=this.option("showFileList");i&&Ae(this._files,(r,n)=>{n.$file||this._renderFile(n)}),this.$element().toggleClass(mn,i),this._toggleFileUploaderEmptyClassName(),this._updateFileNameMaxWidth(),(e=this._validationMessage)===null||e===void 0||e.repaint()}_renderFile(e){var{value:t}=e,i=O("<div>").addClass(Jt).appendTo(this._$filesContainer);this._renderFileButtons(e,i),e.$file=O("<div>").addClass(wn).appendTo(i);var r=O("<div>").addClass(En).appendTo(e.$file);e.$statusMessage=O("<div>").addClass(An).appendTo(e.$file),O("<div>").addClass(Qt).text(t.name).appendTo(r),ne(t.size)&&O("<div>").addClass(ei).text(this._getFileSize(t.size)).appendTo(r),e.isValid()?e.$statusMessage.text(this.option("readyToUploadMessage")):(e.isValidFileExtension||e.$statusMessage.append(this._createValidationElement("invalidFileExtensionMessage")),e.isValidMaxSize||e.$statusMessage.append(this._createValidationElement("invalidMaxFileSizeMessage")),e.isValidMinSize||e.$statusMessage.append(this._createValidationElement("invalidMinFileSizeMessage")),i.addClass(Dn))}_createValidationElement(e){return O("<span>").text(this.option(e))}_updateFileNameMaxWidth(){var e=this.option("allowCanceling")&&this.option("uploadMode")!=="useForm"?1:0,t=this.option("uploadMode")==="useButtons"?1:0,i=Ue(this._$filesContainer.find(".".concat(Jt)).first())||Ue(this._$filesContainer),r=this._$filesContainer.find(".".concat(wt)).eq(0),n=Ue(r)*(e+t),a=this._$filesContainer.find(".".concat(ei)).eq(0),s=a.text();a.text("1000 Mb");var d=Ue(a);a.text(s),this._$filesContainer.find(".".concat(Qt)).css("maxWidth",i-n-d)}_renderFileButtons(e,t){var i=this._getCancelButton(e);i&&t.append(i);var r=this._getUploadButton(e);r&&t.append(r)}_getCancelButton(e){if(this.option("uploadMode")==="useForm")return null;var{allowCanceling:t,readOnly:i,hoverStateEnabled:r,_buttonStylingMode:n}=this.option();return e.cancelButton=this._createComponent(O("<div>").addClass("".concat(rt," ").concat(xn)),ze,{onClick:()=>this._removeFile(e),icon:"close",visible:t,disabled:i,integrationOptions:{},hoverStateEnabled:r,stylingMode:n}),O("<div>").addClass(wt).append(e.cancelButton.$element())}_getUploadButton(e){if(!e.isValid()||this.option("uploadMode")!=="useButtons")return null;var{hoverStateEnabled:t,_buttonStylingMode:i}=this.option();return e.uploadButton=this._createComponent(O("<div>").addClass("".concat(rt," ").concat(ti)),ze,{onClick:()=>this._uploadFile(e),icon:"upload",hoverStateEnabled:t,stylingMode:i}),e.onLoadStart.add(()=>e.uploadButton.option({visible:!1,disabled:!0})),e.onAbort.add(()=>e.uploadButton.option({visible:!0,disabled:!1})),O("<div>").addClass(wt).append(e.uploadButton.$element())}_removeFile(e){var t;(t=e.$file)===null||t===void 0||t.parent().remove(),this._files.splice(this._files.indexOf(e),1);var i=this.option("value").slice();i.splice(i.indexOf(e.value),1),this._preventRecreatingFiles=!0,this.option("value",i),this._preventRecreatingFiles=!1,this._toggleFileUploaderEmptyClassName(),this._resetInputValue(!0)}removeFile(e){if(!(this.option("uploadMode")==="useForm"||!ne(e))){var t=this._getFile(e);t&&(t.uploadStarted&&this._preventFilesUploading([t]),this._removeFile(t))}}_toggleFileUploaderEmptyClassName(){this.$element().toggleClass(_n,!this._files.length||this._hasInvalidFile(this._files))}_hasInvalidFile(e){for(var t=0;t<e.length;t++)if(!e[t].isValid())return!0;return!1}_getFileSize(e){for(var t=0,i=[$.format("dxFileUploader-bytes"),$.format("dxFileUploader-kb"),$.format("dxFileUploader-Mb"),$.format("dxFileUploader-Gb")],r=i.length-1;t<r&&e>=1024;)e/=1024,t++;return"".concat(Math.round(e)," ").concat(i[t])}_renderSelectButton(){var e=O("<div>").addClass(rt).appendTo(this._$inputWrapper);this._selectButton=this._createComponent(e,ze,{text:this.option("selectButtonText"),focusStateEnabled:!1,integrationOptions:{},disabled:this.option("readOnly"),hoverStateEnabled:this.option("hoverStateEnabled")}),this._selectFileDialogHandler=this._selectButtonClickHandler.bind(this),Ze.real().deviceType==="desktop"?this._selectButton.option("onClick",this._selectFileDialogHandler):this._attachSelectFileDialogHandler(this._selectButton.$element()),this._attachSelectFileDialogHandler(this.option("dialogTrigger"))}_selectButtonClickHandler(){if(!this.option("useNativeInputClick")){if(this._isInteractionDisabled())return!1;this._isCustomClickEvent=!0,de.trigger(this._$fileInput,"click"),this._isCustomClickEvent=!1}}_attachSelectFileDialogHandler(e){ne(e)&&(this._detachSelectFileDialogHandler(e),de.on(O(e),"click",this._selectFileDialogHandler))}_detachSelectFileDialogHandler(e){ne(e)&&de.off(O(e),"click",this._selectFileDialogHandler)}_renderUploadButton(){if(this.option("uploadMode")==="useButtons"){var e=O("<div>").addClass(rt).addClass(ti).appendTo(this._$content);this._uploadButton=this._createComponent(e,ze,{text:this.option("uploadButtonText"),onClick:this._uploadButtonClickHandler.bind(this),type:this.option("_uploadButtonType"),integrationOptions:{},hoverStateEnabled:this.option("hoverStateEnabled")})}}_uploadButtonClickHandler(){this._uploadFiles()}_shouldDragOverBeRendered(){return!this.option("readOnly")&&(this.option("uploadMode")!=="useForm"||this.option("nativeDropSupported"))}_isInteractionDisabled(){return this.option("readOnly")||this.option("disabled")}_renderInputContainer(){this._$inputContainer=O("<div>").addClass(Cn).appendTo(this._$inputWrapper),this._$fileInput.addClass(Sn),this._renderInput();var e="dx-fileuploader-input-label-".concat(new Re);this._$inputLabel.attr("id",e).addClass(yn).appendTo(this._$inputContainer),this.setAria("labelledby",e,this._$fileInput)}_renderInput(){this.option("useNativeInputClick")?this._selectButton.option("template",this._selectButtonInputTemplate.bind(this)):(this._$fileInput.appendTo(this._$inputContainer),this._selectButton.option("template","content")),this._applyInputAttributes(this.option("inputAttr"))}_selectButtonInputTemplate(e,t){var i=O(t),r=O("<span>").addClass("dx-button-text").text(e.text);return i.append(r).append(this._$fileInput),i}_renderInputWrapper(){this._$inputWrapper=O("<div>").addClass(In).appendTo(this._$content)}_detachDragEventHandlers(e){ne(e)&&de.off(O(e),we("",this.NAME))}_attachDragEventHandlers(e){var t=e!==this._$inputWrapper;!ne(e)||!this._shouldDragOverBeRendered()||(this._detachDragEventHandlers(e),e=O(e),de.on(e,we("dragenter",this.NAME),this._dragEnterHandler.bind(this,t)),de.on(e,we("dragover",this.NAME),this._dragOverHandler.bind(this,t)),de.on(e,we("dragleave",this.NAME),this._dragLeaveHandler.bind(this,t)),de.on(e,we("drop",this.NAME),this._dropHandler.bind(this,t)))}_applyInputAttributes(e){this._$fileInput.attr(e)}_useInputForDrop(){return this.option("nativeDropSupported")&&this.option("uploadMode")==="useForm"}_getDropZoneElement(e,t){var i=e?Array.from(O(this.option("dropZone"))):[this._$inputWrapper];return i=i.map(r=>O(r).get(0)),i[i.indexOf(t.currentTarget)]}_dragEnterHandler(e,t){if(this.option("disabled"))return!1;this._useInputForDrop()||t.preventDefault();var i=this._getDropZoneElement(e,t);ne(i)&&this._shouldRaiseDragOver(t,i)&&(this._activeDropZone=i,this._tryToggleDropZoneActive(!0,e,t))}_shouldRaiseDragOver(e,t){return this._activeDropZone===null&&this.isMouseOverElement(e,t,!1)&&e.originalEvent.dataTransfer.types.find(i=>i==="Files")}_dragOverHandler(e,t){if(this._useInputForDrop()||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",!e){var i=this._getDropZoneElement(!1,t);this._shouldRaiseDragOver(t,i)&&this._dragEnterHandler(!1,t),this._shouldRaiseDragLeave(t,!1)&&this._dragLeaveHandler(!1,t)}}_dragLeaveHandler(e,t){this._useInputForDrop()||t.preventDefault(),this._shouldRaiseDragLeave(t,e)&&(this._tryToggleDropZoneActive(!1,e,t),this._activeDropZone=null)}_shouldRaiseDragLeave(e,t){return this._activeDropZone!==null&&!this.isMouseOverElement(e,this._activeDropZone,!t,-ri)}_tryToggleDropZoneActive(e,t,i){var r=e?"addClass":"removeClass",n=e?"_dropZoneEnterAction":"_dropZoneLeaveAction";this[n]({event:i,dropZoneElement:this._activeDropZone}),t||this.$element()[r](Yt)}_dropHandler(e,t){if(this._activeDropZone=null,e||this.$element().removeClass(Yt),!(this._useInputForDrop()||e&&this._isInteractionDisabled())){t.preventDefault();var i=t.originalEvent.dataTransfer.files,r=this._getFiles(i);!this.option("multiple")&&r.length>1||r.length===0||(this._changeValue(r),this.option("uploadMode")==="instantly"&&this._uploadFiles())}}_areAllFilesLoaded(){return this._files.every(e=>!e.isValid()||e._isError||e._isLoaded||e.isAborted)}_handleAllFilesUploaded(){this._recalculateProgress(),this._areAllFilesLoaded()&&this._filesUploadedAction()}_getAllowedFileTypes(e){return e.length?e.split(",").map(t=>t.trim()):[]}_isFileTypeAllowed(e,t){for(var i=0,r=t.length;i<r;i++){var n=t[i];if(n[0]==="."){if(n=n.replace(".","\\."),e.name.match(new RegExp("".concat(n,"$"),"i")))return!0}else if(n=n.replace(new RegExp("\\*","g"),""),e.type.match(new RegExp(n,"i")))return!0}return!1}_renderWrapper(){var e=O("<div>").addClass(fn).appendTo(this.$element()),t=O("<div>").addClass(gn).appendTo(e);this._$content=O("<div>").addClass(vn).appendTo(t)}_clean(){this._$fileInput.detach(),delete this._$filesContainer,this._detachSelectFileDialogHandler(this.option("dialogTrigger")),this._detachDragEventHandlers(this.option("dropZone")),this._files&&this._files.forEach(e=>{e.$file=null,e.$statusMessage=null}),super._clean()}abortUpload(e){if(this.option("uploadMode")!=="useForm")if(ne(e)){var t=this._getFile(e);t&&this._preventFilesUploading([t])}else this._preventFilesUploading(this._files)}upload(e){if(this.option("uploadMode")!=="useForm")if(ne(e)){var t=this._getFile(e);t&&xt()&&this._uploadFile(t)}else this._uploadFiles()}_uploadFiles(){xt()&&Ae(this._files,(e,t)=>this._uploadFile(t))}_uploadFile(e){this._uploadStrategy.upload(e)}_updateProgressBar(e,t){e.progressBar&&e.progressBar.option({value:t.loaded,showStatus:!0}),this._progressAction({file:e.value,segmentSize:t.currentSegmentSize,bytesLoaded:t.loaded,bytesTotal:t.total,event:t.event,request:e.request})}_updateTotalProgress(e,t){var i=0;ne(e)&&(this._files.length>0&&this._areAllFilesLoaded()&&e===0&&t===0?i=this._getProgressValue(1):e&&(i=this._getProgressValue(t/e))),this.option("progress",i),this._setLoadedSize(t)}_getProgressValue(e){return Math.floor(100*e)}_initStatusMessage(e){e.$statusMessage.css("display","none")}_ensureCancelButtonInitialized(e){if(!e.isInitialized){e.cancelButton.option("onClick",()=>{this._preventFilesUploading([e]),this._removeFile(e)});var t=()=>{setTimeout(()=>{e.cancelButton.option({visible:!1})},ii)};e.onLoad.add(t),e.onError.add(t)}}_createProgressBar(e){return this._createComponent(O("<div>"),Rt,{value:void 0,min:0,max:e,statusFormat:t=>"".concat(this._getProgressValue(t),"%"),showStatus:!1,statusPosition:"right"})}_getTotalFilesSize(){return this._totalFilesSize||(this._totalFilesSize=0,Ae(this._files,(e,t)=>{this._totalFilesSize+=t.value.size})),this._totalFilesSize}_getTotalLoadedFilesSize(){return this._totalLoadedFilesSize||(this._totalLoadedFilesSize=0,Ae(this._files,(e,t)=>{this._totalLoadedFilesSize+=t.loadedSize})),this._totalLoadedFilesSize}_setLoadedSize(e){this._totalLoadedFilesSize=e}_recalculateProgress(){this._totalFilesSize=0,this._totalLoadedFilesSize=0,this._updateTotalProgress(this._getTotalFilesSize(),this._getTotalLoadedFilesSize())}isMouseOverElement(e,t,i){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ri;if(!t)return!1;var n=i?parseFloat(lt.getComputedStyle(t,":before").height):0,a=i?parseFloat(lt.getComputedStyle(t,":after").height):0,s=$t(t).left,d=$t(t).top+n,m=t.offsetWidth,C=t.offsetHeight-n-a,I=this._getEventX(e),y=this._getEventY(e);return I+r>=s&&I-r<s+m&&y+r>=d&&y-r<d+C}_getEventX(e){return Vt(e)?this._getTouchEventX(e):e.clientX+this._getDocumentScrollLeft()}_getEventY(e){return Vt(e)?this._getTouchEventY(e):e.clientY+this._getDocumentScrollTop()}_getTouchEventX(e){var t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageX:0}_getTouchEventY(e){var t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageY:0}_getDocumentScrollTop(){var e=ot.getDocument();return e.documentElement.scrollTop||e.body.scrollTop}_getDocumentScrollLeft(){var e=ot.getDocument();return e.documentElement.scrollLeft||e.body.scrollLeft}_updateReadOnlyState(){var e=this.option("readOnly");this._selectButton.option("disabled",e),this._files.forEach(t=>{var i;return(i=t.cancelButton)===null||i===void 0?void 0:i.option("disabled",e)}),this._updateInputLabelText(),this._attachDragEventHandlers(this._$inputWrapper)}_updateHoverState(){var e,t,i=this.option("hoverStateEnabled");(e=this._selectButton)===null||e===void 0||e.option("hoverStateEnabled",i),(t=this._uploadButton)===null||t===void 0||t.option("hoverStateEnabled",i),this._files.forEach(r=>{var n,a;(n=r.uploadButton)===null||n===void 0||n.option("hoverStateEnabled",i),(a=r.cancelButton)===null||a===void 0||a.option("hoverStateEnabled",i)})}_optionChanged(e){var{name:t,value:i,previousValue:r}=e;switch(t){case"height":case"width":this._updateFileNameMaxWidth(),super._optionChanged(e);break;case"value":!i.length&&this._$fileInput.val(""),this._preventRecreatingFiles||(this._createFiles(),this._renderFiles()),this._recalculateProgress(),super._optionChanged(e);break;case"name":this._initFileInput(),super._optionChanged(e);break;case"accept":this._initFileInput();break;case"multiple":this._initFileInput(),e.value||this.clear();break;case"readOnly":this._updateReadOnlyState(),super._optionChanged(e);break;case"disabled":this._updateInputLabelText(),super._optionChanged(e);break;case"selectButtonText":this._selectButton.option("text",i);break;case"uploadButtonText":this._uploadButton&&this._uploadButton.option("text",i);break;case"_uploadButtonType":this._uploadButton&&this._uploadButton.option("type",i);break;case"_buttonStylingMode":this._files.forEach(n=>{var a,s;(a=n.uploadButton)===null||a===void 0||a.option("stylingMode",i),(s=n.cancelButton)===null||s===void 0||s.option("stylingMode",i)});break;case"dialogTrigger":this._detachSelectFileDialogHandler(r),this._attachSelectFileDialogHandler(i);break;case"dropZone":this._detachDragEventHandlers(r),this._attachDragEventHandlers(i);break;case"maxFileSize":case"minFileSize":case"allowedFileExtensions":case"invalidFileExtensionMessage":case"invalidMaxFileSizeMessage":case"invalidMinFileSizeMessage":case"readyToUploadMessage":case"uploadedMessage":case"uploadFailedMessage":case"uploadAbortedMessage":this._invalidate();break;case"labelText":this._updateInputLabelText();break;case"showFileList":this._preventRecreatingFiles||this._renderFiles();break;case"uploadFile":case"uploadChunk":case"chunkSize":this._setUploadStrategy();break;case"abortUpload":case"uploadUrl":case"progress":case"uploadMethod":case"uploadHeaders":case"uploadCustomData":case"extendSelection":break;case"hoverStateEnabled":this._updateHoverState(),super._optionChanged(e);break;case"allowCanceling":case"uploadMode":this.clear(),this._invalidate();break;case"onBeforeSend":this._createBeforeSendAction();break;case"onUploadStarted":this._createUploadStartedAction();break;case"onUploaded":this._createUploadedAction();break;case"onFilesUploaded":this._createFilesUploadedAction();break;case"onProgress":this._createProgressAction();break;case"onUploadError":this._createUploadErrorAction();break;case"onUploadAborted":this._createUploadAbortedAction();break;case"onDropZoneEnter":this._createDropZoneEnterAction();break;case"onDropZoneLeave":this._createDropZoneLeaveAction();break;case"useNativeInputClick":this._renderInput();break;case"useDragOver":this._attachDragEventHandlers(this._$inputWrapper);break;case"nativeDropSupported":this._invalidate();break;case"inputAttr":this._applyInputAttributes(this.option(t));break;case"hint":this._initFileInput(),super._optionChanged(e);break;default:super._optionChanged(e)}}_resetInputValue(e){this.option("uploadMode")==="useForm"&&!e||(this._doPreventInputChange=!0,this._$fileInput.val(""),this._doPreventInputChange=!1)}clear(){this.option("value",[])}}class Tn{constructor(e,t){this.file=e,this.chunkSize=t,this.index=0}read(){if(!this.file)return null;var e=this.createBlobResult(this.file,this.index,this.chunkSize);return e.isCompleted&&(this.file=null),this.index++,e}createBlobResult(e,t,i){var r=t*i;return{blob:this.sliceFile(e,r,i),index:t,isCompleted:r+i>=e.size}}sliceFile(e,t,i){return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):null}}class Ui{constructor(e){this.fileUploader=e}upload(e){e.isInitialized&&e.isAborted&&this.fileUploader._resetFileState(e),e.isValid()&&!e.uploadStarted&&(this._prepareFileBeforeUpload(e),this._uploadCore(e))}abortUpload(e){if(!(e._isError||e._isLoaded||e.isAborted||!e.uploadStarted)&&(e.isAborted=!0,e.request&&e.request.abort(),this._isCustomCallback("abortUpload"))){var t=this.fileUploader.option("abortUpload"),i=this._createUploadArgument(e),r=null;try{var n=t(e.value,i);r=vt(n)}catch(a){r=ae().reject(a).promise()}r.done(()=>e.onAbort.fire()).fail(a=>this._handleFileError(e,a))}}_beforeSend(e,t){var i=this._createUploadArgument(t);this.fileUploader._beforeSendAction({request:e,file:t.value,uploadInfo:i}),t.request=e}_createUploadArgument(e){}_uploadCore(e){}_isCustomCallback(e){var t=this.fileUploader.option(e);return t&&Ie(t)}_handleProgress(e,t){e._isError||(e._isProgressStarted=!0,this._handleProgressCore(e,t))}_handleProgressCore(e,t){}_handleFileError(e,t){e._isError=!0,e.onError.fire(t)}_prepareFileBeforeUpload(e){var t;e.$file&&((t=e.progressBar)===null||t===void 0||t.dispose(),this.fileUploader._createFileProgressBar(e)),!e.isInitialized&&(e.onLoadStart.add(this._onUploadStarted.bind(this,e)),e.onLoad.add(this._onLoadedHandler.bind(this,e)),e.onError.add(this._onErrorHandler.bind(this,e)),e.onAbort.add(this._onAbortHandler.bind(this,e)),e.onProgress.add(this._onProgressHandler.bind(this,e)),e.isInitialized=!0)}_shouldHandleError(e,t){return(this._isStatusError(t.status)||!e._isProgressStarted)&&!e.isAborted}_isStatusError(e){return e>=400&&e<500||e>=500&&e<600}_onUploadStarted(e,t){e.uploadStarted=!0,this.fileUploader._uploadStartedAction({file:e.value,event:t,request:e.request})}_onAbortHandler(e,t){var i={file:e.value,event:t,request:e.request,message:this.fileUploader._getUploadAbortedStatusMessage()};this.fileUploader._uploadAbortedAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onErrorHandler(e,t){var i={file:e.value,event:void 0,request:e.request,error:t,message:this.fileUploader.option("uploadFailedMessage")};this.fileUploader._uploadErrorAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onLoadedHandler(e,t){var i={file:e.value,event:t,request:e.request,message:this.fileUploader.option("uploadedMessage")};e._isLoaded=!0,this.fileUploader._uploadedAction(i),this.fileUploader._setStatusMessage(e,i.message),this.fileUploader._handleAllFilesUploaded()}_onProgressHandler(e,t){if(e){var i=this.fileUploader._getTotalFilesSize(),r=this.fileUploader._getTotalLoadedFilesSize(),n=Math.min(t.loaded,e.value.size),a=n-e.loadedSize;e.loadedSize=n,this.fileUploader._updateTotalProgress(i,r+a),this.fileUploader._updateProgressBar(e,this._getLoadedData(n,t.total,a,t))}}_getLoadedData(e,t,i,r){return{loaded:e,total:t,currentSegmentSize:i}}_extendFormData(e){var t=this.fileUploader.option("uploadCustomData");for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&ne(t[i])&&e.append(i,t[i])}}class zi extends Ui{constructor(e){super(e),this.chunkSize=this.fileUploader.option("chunkSize")}_uploadCore(e){var t=e.value,i={name:t.name,loadedBytes:0,type:t.type,blobReader:new Tn(t,this.chunkSize),guid:new Re,fileSize:t.size,count:this._getFileChunksCount(t),customData:{}};e.chunksData=i,this._sendChunk(e,i)}_getFileChunksCount(e){return e.size===0?1:Math.ceil(e.size/this.chunkSize)}_sendChunk(e,t){var i=t.blobReader.read();t.currentChunk=i,i&&this._sendChunkCore(e,t,i).done(()=>{e.isAborted||(t.loadedBytes+=i.blob.size,e.onProgress.fire({loaded:t.loadedBytes,total:e.value.size}),i.isCompleted&&e.onLoad.fire(),setTimeout(()=>this._sendChunk(e,t)))}).fail(r=>{this._shouldHandleError(e,r)&&this._handleFileError(e,r)})}_sendChunkCore(e,t,i){}_tryRaiseStartLoad(e){e.isStartLoad||(e.isStartLoad=!0,e.onLoadStart.fire())}_getEvent(e){return null}_createUploadArgument(e){return this._createChunksInfo(e.chunksData)}_createChunksInfo(e){return{bytesUploaded:e.loadedBytes,chunkCount:e.count,customData:e.customData,chunkBlob:e.currentChunk.blob,chunkIndex:e.currentChunk.index}}}class Pn extends zi{_sendChunkCore(e,t,i){return at.sendRequest({url:this.fileUploader.option("uploadUrl"),method:this.fileUploader.option("uploadMethod"),headers:this.fileUploader.option("uploadHeaders"),beforeSend:r=>this._beforeSend(r,e),upload:{onprogress:r=>this._handleProgress(e,r),onloadstart:()=>this._tryRaiseStartLoad(e),onabort:()=>e.onAbort.fire()},data:this._createFormData({fileName:t.name,blobName:this.fileUploader.option("name"),blob:i.blob,index:i.index,count:t.count,type:t.type,guid:t.guid,size:t.fileSize})})}_createFormData(e){var t=new lt.FormData;return t.append(e.blobName,e.blob),t.append(Fn,JSON.stringify({FileName:e.fileName,Index:e.index,TotalCount:e.count,FileSize:e.size,FileType:e.type,FileGuid:e.guid})),this._extendFormData(t),t}}class On extends zi{_sendChunkCore(e,t){this._tryRaiseStartLoad(e);var i=this._createChunksInfo(t),r=this.fileUploader.option("uploadChunk");try{var n=r(e.value,i);return vt(n)}catch(a){return ae().reject(a).promise()}}_shouldHandleError(e,t){return!0}}class $i extends Ui{_uploadCore(e){e.loadedSize=0,this._uploadFile(e).done(()=>{e.isAborted||e.onLoad.fire()}).fail(t=>{this._shouldHandleError(e,t)&&this._handleFileError(e,t)})}_uploadFile(e){}_handleProgressCore(e,t){e.onProgress.fire(t)}_getLoadedData(e,t,i,r){var n=super._getLoadedData(e,t,i,r);return n.event=r,n}}class kn extends $i{_uploadFile(e){return at.sendRequest({url:this.fileUploader.option("uploadUrl"),method:this.fileUploader.option("uploadMethod"),headers:this.fileUploader.option("uploadHeaders"),beforeSend:t=>this._beforeSend(t,e),upload:{onprogress:t=>this._handleProgress(e,t),onloadstart:()=>e.onLoadStart.fire(),onabort:()=>e.onAbort.fire()},data:this._createFormData(this.fileUploader.option("name"),e.value)})}_createFormData(e,t){var i=new lt.FormData;return i.append(e,t,t.name),this._extendFormData(i),i}}class Rn extends $i{_uploadFile(e){e.onLoadStart.fire();var t=this.fileUploader.option("uploadFile");try{var i=t(e.value,r=>{var n={loaded:r,total:e.value.size};this._handleProgress(e,n)});return vt(i)}catch(r){return ae().reject(r).promise()}}_shouldHandleError(e,t){return!0}}dt("dxFileUploader",Ni);var Ln=gr.add,Vi="dx-toast",$e="".concat(Vi,"-"),Bn="".concat($e,"wrapper"),Nn="".concat($e,"content"),Un="".concat($e,"message"),zn="".concat($e,"icon"),$n="dxToast",Vn=["info","warning","error","success"],Pt=[],Kn=8e3,Gn={top:{my:"top",at:"top",of:null,offset:"0 0"},bottom:{my:"bottom",at:"bottom",of:null,offset:"0 -20"},center:{my:"center",at:"center",of:null,offset:"0 0"},right:{my:"center right",at:"center right",of:null,offset:"0 0"},left:{my:"center left",at:"center left",of:null,offset:"0 0"}},Wn={h:0,v:0},Hn=20;Ln(()=>{de.subscribeGlobal(ot.getDocument(),gt.down,w=>{for(var e=Pt.length-1;e>=0;e--)if(!Pt[e]._proxiedDocumentDownHandler(w))return})});var Ki=vr.inherit({_getDefaultOptions(){return Y(this.callBase(),{message:"",type:"info",displayTime:2e3,position:"bottom center",animation:{show:{type:"fade",duration:400,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}},shading:!1,height:"auto",hideTopOverlayHandler:null,preventScrollEvents:!1,closeOnSwipe:!0,closeOnClick:!1})},_defaultOptionsRules(){var w={displayTime:Kt()?4e3:2e3,hideOnOutsideClick:!0,animation:{show:{type:"fade",duration:200,from:0,to:1},hide:{type:"fade",duration:200,from:1,to:0}}};return this.callBase().concat([{device:e=>e.deviceType==="phone",options:Gt({width:"calc(100vw - ".concat(2*Hn,"px)")},w)},{device:e=>e.deviceType==="tablet",options:Gt({width:"auto",maxWidth:"80vw"},w)},{device:e=>Kt()&&e.deviceType==="desktop",options:{minWidth:344,maxWidth:568,displayTime:4e3}}])},_init(){this.callBase(),this._posStringToObject()},_renderContentImpl(){this._message=O("<div>").addClass(Un).text(this.option("message")).appendTo(this.$content()),this.setAria("role","alert",this._message),Vn.includes(this.option("type").toLowerCase())&&this.$content().prepend(O("<div>").addClass(zn)),this.callBase()},_render(){this.callBase(),this.$element().addClass(Vi),this.$wrapper().addClass(Bn),this.$content().addClass($e+String(this.option("type")).toLowerCase()),this.$content().addClass(Nn),this._toggleCloseEvents("Swipe"),this._toggleCloseEvents("Click")},_toggleCloseEvents(w){var e="dx".concat(w.toLowerCase());de.off(this.$content(),e),this.option("closeOn".concat(w))&&de.on(this.$content(),e,this.hide.bind(this))},_posStringToObject(){if(Le(this.option("position"))){var w=this.option("position").split(" ")[0],e=this.option("position").split(" ")[1];switch(this.option("position",Y({boundaryOffset:Wn},Gn[w])),e){case"center":case"left":case"right":this.option("position").at+=" ".concat(e),this.option("position").my+=" ".concat(e)}}},_show(){return this.callBase.apply(this,arguments).always(()=>{clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(this.hide.bind(this),this.option("displayTime"))})},_overlayStack:()=>Pt,_zIndexInitValue(){return this.callBase()+Kn},_dispose(){clearTimeout(this._hideTimeout),this.callBase()},_optionChanged(w){switch(w.name){case"type":this.$content().removeClass($e+w.previousValue),this.$content().addClass($e+String(w.value).toLowerCase());break;case"message":this._message&&this._message.text(w.value);break;case"closeOnSwipe":this._toggleCloseEvents("Swipe");break;case"closeOnClick":this._toggleCloseEvents("Click");break;case"displayTime":break;default:this.callBase(w)}}});dt($n,Ki);var ni=Ge(),ai=null,Gi={};function jn(w,e,t){var i=At(w)?w:{message:w},r=At(e)?e:void 0,n=At(e)?void 0:e,{onHidden:a}=i;if(r!=null&&r.position){var{position:s}=r,d=r.direction||Zn(s),m=Le(s)?s:"".concat(s.top,"-").concat(s.left,"-").concat(s.bottom,"-").concat(s.right),{onShowing:C}=i,I=Xn(m);Yn(I,d),Y(i,{container:I,_skipContentPositioning:!0,onShowing(y){Jn(I,d,s),C==null||C(y)}})}Y(i,{type:n,displayTime:t,onHidden(y){O(y.element).remove(),a==null||a(y)}}),ai=O("<div>").appendTo(Mi()),new Ki(ai,i).show()}var Zn=w=>Le(w)&&w.includes("top")?"down-push":"up-push",qn=w=>{var e=O("<div>").appendTo(Mi());return Gi[w]=e,e},Xn=w=>{var e=Gi[w];return e||qn(w)},Yn=(w,e)=>{var t="dx-toast-stack dx-toast-stack-".concat(e,"-direction");w.removeAttr("class").addClass(t)},Jn=(w,e,t)=>{var{offsetWidth:i,offsetHeight:r}=w.children().first().get(0),n={toastWidth:i,toastHeight:r,windowHeight:ni.innerHeight,windowWidth:ni.innerWidth},a=Le(t)?Qn(t,n):t,s=ea(e,a,n);w.css(s)},Qn=(w,e)=>{var{toastWidth:t,toastHeight:i,windowHeight:r,windowWidth:n}=e;switch(w){case"top left":return{top:10,left:10};case"top right":return{top:10,right:10};case"bottom left":return{bottom:10,left:10};case"bottom right":return{bottom:10,right:10};case"top center":return{top:10,left:Math.round(n/2-t/2)};case"left center":return{top:Math.round(r/2-i/2),left:10};case"right center":return{top:Math.round(r/2-i/2),right:10};case"center":return{top:Math.round(r/2-i/2),left:Math.round(n/2-t/2)};case"bottom center":default:return{bottom:10,left:Math.round(n/2-t/2)}}},ea=(w,e,t)=>{var i,r,n,a,s,d,m,C,I,y,c,g,{toastWidth:h,toastHeight:_,windowHeight:u,windowWidth:v}=t;switch(w.replace(/-push|-stack/g,"")){case"up":return{bottom:(i=e.bottom)!==null&&i!==void 0?i:u-_-e.top,top:"",left:(r=e.left)!==null&&r!==void 0?r:"",right:(n=e.right)!==null&&n!==void 0?n:""};case"down":return{top:(a=e.top)!==null&&a!==void 0?a:u-_-e.bottom,bottom:"",left:(s=e.left)!==null&&s!==void 0?s:"",right:(d=e.right)!==null&&d!==void 0?d:""};case"left":return{right:(m=e.right)!==null&&m!==void 0?m:v-h-e.left,left:"",top:(C=e.top)!==null&&C!==void 0?C:"",bottom:(I=e.bottom)!==null&&I!==void 0?I:""};case"right":return{left:(y=e.left)!==null&&y!==void 0?y:v-h-e.right,right:"",top:(c=e.top)!==null&&c!==void 0?c:"",bottom:(g=e.bottom)!==null&&g!==void 0?g:""}}},Ot=function(w,e,t){e=e||Te,t=t||Te,Array.isArray(w)||(w=[w]);var i=w.map((r,n)=>fe(r).then(a=>(Ie(e)&&e({item:r,index:n,result:a}),a),a=>(a||(a={}),a.index=n,Ie(t)&&t(a),new ae().resolve().promise())));return fe.apply(null,i)},Wi=function(w){for(var e=["B","KB","MB","GB","TB"],t=0,i=w;i>=1024&&t<=e.length-1;)i/=1024,t++;return i=Math.round(10*i)/10,"".concat(i," ").concat(e[t])},Ve=function(w,e,t){return t.forEach(i=>{Y(!0,w,ne(e[i])?{[i]:e[i]}:{})}),w},ta=(w,e)=>{var t={};e.forEach(r=>{t[r]=null}),w.forEach(r=>{var n=r.fileItem.key;Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=r)});var i=[];return e.forEach(r=>{var n=t[r];n&&i.push(n)}),i},si=function(w){var e=Object.keys(w),t=[];return e.forEach(i=>t.push(w[i])),{keys:e,values:t}},Ye="/",Hi=w=>{var e=w.lastIndexOf(".");return e!==-1?w.substr(e):""},oi=w=>{var e=w.lastIndexOf(Ye);return e!==-1?w.substr(e+Ye.length):w},ji=(w,e)=>{if(!w||w==="/")return[];for(var t=[],i="",r=0;r<w.length;r++){var n=w.charAt(r);if(n===Ye){var a=w.charAt(r+1);a!==Ye&&(i&&(t.push(i),i=""),n=a),r++}i+=n}if(i&&t.push(i),e)for(var s=0;s<t.length;s++)t[s]=Oe(s===0?"":t[s-1],Lt(t[s]));return t},Lt=function(w){return w.replace(/\/{1,1}/g,"//")},Oe=function(){var w="";return Ae(arguments,(e,t)=>{t&&(w&&(w+=Ye),w+=t)}),w};class qe{constructor(){var e=Le(arguments[0])?this._publicCtor:this._internalCtor;e.apply(this,arguments)}_internalCtor(e,t,i,r){this.name=t||"",this.pathInfo=e&&[...e]||[],this.parentPath=this._getPathByPathInfo(this.pathInfo),this.relativeName=Oe(this.parentPath,t),this.key=r||this._getPathByPathInfo(this.getFullPathInfo(),!0),this.path=Oe(this.parentPath,t),this.pathKeys=this.pathInfo.map(n=>{var{key:a}=n;return a}),this.isRoot()||this.pathKeys.push(this.key),this._initialize(i)}_publicCtor(e,t,i){this.path=e||"",this.pathKeys=i||[];for(var r=[],n=ji(e,!0),a=0;a<n.length-1;a++){var s=n[a],d={key:this.pathKeys[a]||s,name:oi(s)};r.push(d)}this.pathInfo=r,this.relativeName=e,this.name=oi(e),this.key=this.pathKeys.length?this.pathKeys[this.pathKeys.length-1]:e,this.parentPath=n.length>1?n[n.length-2]:"",this._initialize(t)}_initialize(e){this.isDirectory=!!e,this.size=0,this.dateModified=new Date,this.thumbnail="",this.tooltipText=""}getFullPathInfo(){var e=[...this.pathInfo];return this.isRoot()||e.push({key:this.key,name:this.name}),e}isRoot(){return this.path===""}getFileExtension(){return this.isDirectory?"":Hi(this.name)}equals(e){return e&&this.key===e.key}createClone(){var e=new qe(this.pathInfo,this.name,this.isDirectory,this.key);return e.key=this.key,e.size=this.size,e.dateModified=this.dateModified,e.thumbnail=this.thumbnail,e.tooltipText=this.tooltipText,e.hasSubDirectories=this.hasSubDirectories,e.dataItem=this.dataItem,e}_getPathByPathInfo(e,t){return e.map(i=>t?Lt(i.name):i.name).join(Ye)}}var ia=2e5;class Ct{constructor(e){e=ve(e,{}),this._keyGetter=Pe(this._getKeyExpr(e)),this._nameGetter=Pe(this._getNameExpr(e)),this._isDirGetter=Pe(this._getIsDirExpr(e)),this._sizeGetter=Pe(this._getSizeExpr(e)),this._dateModifiedGetter=Pe(this._getDateModifiedExpr(e)),this._thumbnailGetter=Pe(e.thumbnailExpr||"thumbnail")}getItems(e){return[]}renameItem(e,t){}createDirectory(e,t){}deleteItems(e){}moveItems(e,t){}copyItems(e,t){}uploadFileChunk(e,t,i){}abortFileUpload(e,t,i){}downloadItems(e){}getItemsContent(e){}getFileUploadChunkSize(){return ia}_convertDataObjectsToFileItems(e,t){var i=[];return Ae(e,(r,n)=>{var a=this._createFileItem(n,t);i.push(a)}),i}_createFileItem(e,t){var i=this._keyGetter(e),r=new qe(t,this._nameGetter(e),!!this._isDirGetter(e),i);return r.size=this._sizeGetter(e),r.size===void 0&&(r.size=0),r.dateModified=Ir.deserializeDate(this._dateModifiedGetter(e)),r.dateModified===void 0&&(r.dateModified=new Date),r.isDirectory&&(r.hasSubDirectories=this._hasSubDirs(e)),i||(r.key=r.relativeName),r.thumbnail=this._thumbnailGetter(e)||"",r.dataItem=e,r}_hasSubDirs(e){return!0}_getKeyExpr(e){return e.keyExpr||this._defaultKeyExpr}_defaultKeyExpr(e){if(arguments.length===2){e.__KEY__=arguments[1];return}return Object.prototype.hasOwnProperty.call(e,"__KEY__")?e.__KEY__:null}_getNameExpr(e){return e.nameExpr||"name"}_getIsDirExpr(e){return e.isDirectoryExpr||"isDirectory"}_getSizeExpr(e){return e.sizeExpr||"size"}_getDateModifiedExpr(e){return e.dateModifiedExpr||"dateModified"}_executeActionAsDeferred(e,t){var i=new ae;try{var r=e();Ti(r)?vt(r).done(n=>i.resolve(t&&n||void 0)).fail(n=>i.reject(n)):i.resolve(t&&r||void 0)}catch(n){return i.reject(n)}return i.promise()}}var Zi={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(w,e){(function(t){w.exports=t()})(function(){return function t(i,r,n){function a(m,C){if(!r[m]){if(!i[m]){var I=typeof mt=="function"&&mt;if(!C&&I)return I(m,!0);if(s)return s(m,!0);var y=new Error("Cannot find module '"+m+"'");throw y.code="MODULE_NOT_FOUND",y}var c=r[m]={exports:{}};i[m][0].call(c.exports,function(g){var h=i[m][1][g];return a(h||g)},c,c.exports,t,i,r,n)}return r[m].exports}for(var s=typeof mt=="function"&&mt,d=0;d<n.length;d++)a(n[d]);return a}({1:[function(t,i,r){var n=t("./utils"),a=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(d){for(var m,C,I,y,c,g,h,_=[],u=0,v=d.length,E=v,x=n.getTypeOf(d)!=="string";u<d.length;)E=v-u,I=x?(m=d[u++],C=u<v?d[u++]:0,u<v?d[u++]:0):(m=d.charCodeAt(u++),C=u<v?d.charCodeAt(u++):0,u<v?d.charCodeAt(u++):0),y=m>>2,c=(3&m)<<4|C>>4,g=1<E?(15&C)<<2|I>>6:64,h=2<E?63&I:64,_.push(s.charAt(y)+s.charAt(c)+s.charAt(g)+s.charAt(h));return _.join("")},r.decode=function(d){var m,C,I,y,c,g,h=0,_=0,u="data:";if(d.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var v,E=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===s.charAt(64)&&E--,d.charAt(d.length-2)===s.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=a.uint8array?new Uint8Array(0|E):new Array(0|E);h<d.length;)m=s.indexOf(d.charAt(h++))<<2|(y=s.indexOf(d.charAt(h++)))>>4,C=(15&y)<<4|(c=s.indexOf(d.charAt(h++)))>>2,I=(3&c)<<6|(g=s.indexOf(d.charAt(h++))),v[_++]=m,c!==64&&(v[_++]=C),g!==64&&(v[_++]=I);return v}},{"./support":30,"./utils":32}],2:[function(t,i,r){var n=t("./external"),a=t("./stream/DataWorker"),s=t("./stream/Crc32Probe"),d=t("./stream/DataLengthProbe");function m(C,I,y,c,g){this.compressedSize=C,this.uncompressedSize=I,this.crc32=y,this.compression=c,this.compressedContent=g}m.prototype={getContentWorker:function(){var C=new a(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),I=this;return C.on("end",function(){if(this.streamInfo.data_length!==I.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),C},getCompressedWorker:function(){return new a(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},m.createWorkerFrom=function(C,I,y){return C.pipe(new s).pipe(new d("uncompressedSize")).pipe(I.compressWorker(y)).pipe(new d("compressedSize")).withStreamInfo("compression",I)},i.exports=m},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,r){var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,r){var n=t("./utils"),a=function(){for(var s,d=[],m=0;m<256;m++){s=m;for(var C=0;C<8;C++)s=1&s?3988292384^s>>>1:s>>>1;d[m]=s}return d}();i.exports=function(s,d){return s!==void 0&&s.length?n.getTypeOf(s)!=="string"?function(m,C,I,y){var c=a,g=y+I;m^=-1;for(var h=y;h<g;h++)m=m>>>8^c[255&(m^C[h])];return-1^m}(0|d,s,s.length,0):function(m,C,I,y){var c=a,g=y+I;m^=-1;for(var h=y;h<g;h++)m=m>>>8^c[255&(m^C.charCodeAt(h))];return-1^m}(0|d,s,s.length,0):0}},{"./utils":32}],5:[function(t,i,r){r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,i,r){var n=null;n=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:n}},{lie:37}],7:[function(t,i,r){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=t("pako"),s=t("./utils"),d=t("./stream/GenericWorker"),m=n?"uint8array":"array";function C(I,y){d.call(this,"FlateWorker/"+I),this._pako=null,this._pakoAction=I,this._pakoOptions=y,this.meta={}}r.magic="\b\0",s.inherits(C,d),C.prototype.processChunk=function(I){this.meta=I.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(m,I.data),!1)},C.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},C.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},C.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var I=this;this._pako.onData=function(y){I.push({data:y,meta:I.meta})}},r.compressWorker=function(I){return new C("Deflate",I)},r.uncompressWorker=function(){return new C("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,r){function n(c,g){var h,_="";for(h=0;h<g;h++)_+=String.fromCharCode(255&c),c>>>=8;return _}function a(c,g,h,_,u,v){var E,x,b=c.file,R=c.compression,T=v!==m.utf8encode,U=s.transformTo("string",v(b.name)),M=s.transformTo("string",m.utf8encode(b.name)),G=b.comment,J=s.transformTo("string",v(G)),S=s.transformTo("string",m.utf8encode(G)),L=M.length!==b.name.length,l=S.length!==G.length,N="",ie="",K="",re=b.dir,W=b.date,te={crc32:0,compressedSize:0,uncompressedSize:0};g&&!h||(te.crc32=c.crc32,te.compressedSize=c.compressedSize,te.uncompressedSize=c.uncompressedSize);var P=0;g&&(P|=8),T||!L&&!l||(P|=2048);var F=0,ee=0;re&&(F|=16),u==="UNIX"?(ee=798,F|=function(Z,ce){var me=Z;return Z||(me=ce?16893:33204),(65535&me)<<16}(b.unixPermissions,re)):(ee=20,F|=function(Z){return 63&(Z||0)}(b.dosPermissions)),E=W.getUTCHours(),E<<=6,E|=W.getUTCMinutes(),E<<=5,E|=W.getUTCSeconds()/2,x=W.getUTCFullYear()-1980,x<<=4,x|=W.getUTCMonth()+1,x<<=5,x|=W.getUTCDate(),L&&(ie=n(1,1)+n(C(U),4)+M,N+="up"+n(ie.length,2)+ie),l&&(K=n(1,1)+n(C(J),4)+S,N+="uc"+n(K.length,2)+K);var q="";return q+=`
\0`,q+=n(P,2),q+=R.magic,q+=n(E,2),q+=n(x,2),q+=n(te.crc32,4),q+=n(te.compressedSize,4),q+=n(te.uncompressedSize,4),q+=n(U.length,2),q+=n(N.length,2),{fileRecord:I.LOCAL_FILE_HEADER+q+U+N,dirRecord:I.CENTRAL_FILE_HEADER+n(ee,2)+q+n(J.length,2)+"\0\0\0\0"+n(F,4)+n(_,4)+U+N+J}}var s=t("../utils"),d=t("../stream/GenericWorker"),m=t("../utf8"),C=t("../crc32"),I=t("../signature");function y(c,g,h,_){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=h,this.encodeFileName=_,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(y,d),y.prototype.push=function(c){var g=c.meta.percent||0,h=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,d.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:h?(g+100*(h-_-1))/h:100}}))},y.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var g=this.streamFiles&&!c.file.dir;if(g){var h=a(c,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},y.prototype.closedSource=function(c){this.accumulate=!1;var g=this.streamFiles&&!c.file.dir,h=a(c,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),g)this.push({data:function(_){return I.DATA_DESCRIPTOR+n(_.crc32,4)+n(_.compressedSize,4)+n(_.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},y.prototype.flush=function(){for(var c=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var h=this.bytesWritten-c,_=function(u,v,E,x,b){var R=s.transformTo("string",b(x));return I.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(u,2)+n(u,2)+n(v,4)+n(E,4)+n(R.length,2)+R}(this.dirRecords.length,h,c,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},y.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},y.prototype.registerPrevious=function(c){this._sources.push(c);var g=this;return c.on("data",function(h){g.processChunk(h)}),c.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),c.on("error",function(h){g.error(h)}),this},y.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},y.prototype.error=function(c){var g=this._sources;if(!d.prototype.error.call(this,c))return!1;for(var h=0;h<g.length;h++)try{g[h].error(c)}catch{}return!0},y.prototype.lock=function(){d.prototype.lock.call(this);for(var c=this._sources,g=0;g<c.length;g++)c[g].lock()},i.exports=y},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,r){var n=t("../compressions"),a=t("./ZipFileWorker");r.generateWorker=function(s,d,m){var C=new a(d.streamFiles,m,d.platform,d.encodeFileName),I=0;try{s.forEach(function(y,c){I++;var g=function(v,E){var x=v||E,b=n[x];if(!b)throw new Error(x+" is not a valid compression method !");return b}(c.options.compression,d.compression),h=c.options.compressionOptions||d.compressionOptions||{},_=c.dir,u=c.date;c._compressWorker(g,h).withStreamInfo("file",{name:y,dir:_,date:u,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(C)}),C.entriesCount=I}catch(y){C.error(y)}return C}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,r){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new n;for(var s in this)typeof this[s]!="function"&&(a[s]=this[s]);return a}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.10.1",n.loadAsync=function(a,s){return new n().loadAsync(a,s)},n.external=t("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,r){var n=t("./utils"),a=t("./external"),s=t("./utf8"),d=t("./zipEntries"),m=t("./stream/Crc32Probe"),C=t("./nodejsUtils");function I(y){return new a.Promise(function(c,g){var h=y.decompressed.getContentWorker().pipe(new m);h.on("error",function(_){g(_)}).on("end",function(){h.streamInfo.crc32!==y.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}i.exports=function(y,c){var g=this;return c=n.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),C.isNode&&C.isStream(y)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",y,!0,c.optimizedBinaryString,c.base64).then(function(h){var _=new d(c);return _.load(h),_}).then(function(h){var _=[a.Promise.resolve(h)],u=h.files;if(c.checkCRC32)for(var v=0;v<u.length;v++)_.push(I(u[v]));return a.Promise.all(_)}).then(function(h){for(var _=h.shift(),u=_.files,v=0;v<u.length;v++){var E=u[v],x=E.fileNameStr,b=n.resolve(E.fileNameStr);g.file(b,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:c.createFolders}),E.dir||(g.file(b).unsafeOriginalName=x)}return _.zipComment.length&&(g.comment=_.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,r){var n=t("../utils"),a=t("../stream/GenericWorker");function s(d,m){a.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(m)}n.inherits(s,a),s.prototype._bindStream=function(d){var m=this;(this._stream=d).pause(),d.on("data",function(C){m.push({data:C,meta:{percent:0}})}).on("error",function(C){m.isPaused?this.generatedError=C:m.error(C)}).on("end",function(){m.isPaused?m._upstreamEnded=!0:m.end()})},s.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,r){var n=t("readable-stream").Readable;function a(s,d,m){n.call(this,d),this._helper=s;var C=this;s.on("data",function(I,y){C.push(I)||C._helper.pause(),m&&m(y)}).on("error",function(I){C.emit("error",I)}).on("end",function(){C.push(null)})}t("../utils").inherits(a,n),a.prototype._read=function(){this._helper.resume()},i.exports=a},{"../utils":32,"readable-stream":16}],14:[function(t,i,r){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,a);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,a)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var a=new Buffer(n);return a.fill(0),a},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(t,i,r){function n(b,R,T){var U,M=s.getTypeOf(R),G=s.extend(T||{},C);G.date=G.date||new Date,G.compression!==null&&(G.compression=G.compression.toUpperCase()),typeof G.unixPermissions=="string"&&(G.unixPermissions=parseInt(G.unixPermissions,8)),G.unixPermissions&&16384&G.unixPermissions&&(G.dir=!0),G.dosPermissions&&16&G.dosPermissions&&(G.dir=!0),G.dir&&(b=u(b)),G.createFolders&&(U=_(b))&&v.call(this,U,!0);var J=M==="string"&&G.binary===!1&&G.base64===!1;T&&T.binary!==void 0||(G.binary=!J),(R instanceof I&&R.uncompressedSize===0||G.dir||!R||R.length===0)&&(G.base64=!1,G.binary=!0,R="",G.compression="STORE",M="string");var S=null;S=R instanceof I||R instanceof d?R:g.isNode&&g.isStream(R)?new h(b,R):s.prepareContent(b,R,G.binary,G.optimizedBinaryString,G.base64);var L=new y(b,S,G);this.files[b]=L}var a=t("./utf8"),s=t("./utils"),d=t("./stream/GenericWorker"),m=t("./stream/StreamHelper"),C=t("./defaults"),I=t("./compressedObject"),y=t("./zipObject"),c=t("./generate"),g=t("./nodejsUtils"),h=t("./nodejs/NodejsStreamInputAdapter"),_=function(b){b.slice(-1)==="/"&&(b=b.substring(0,b.length-1));var R=b.lastIndexOf("/");return 0<R?b.substring(0,R):""},u=function(b){return b.slice(-1)!=="/"&&(b+="/"),b},v=function(b,R){return R=R!==void 0?R:C.createFolders,b=u(b),this.files[b]||n.call(this,b,null,{dir:!0,createFolders:R}),this.files[b]};function E(b){return Object.prototype.toString.call(b)==="[object RegExp]"}var x={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(b){var R,T,U;for(R in this.files)U=this.files[R],(T=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&b(T,U)},filter:function(b){var R=[];return this.forEach(function(T,U){b(T,U)&&R.push(U)}),R},file:function(b,R,T){if(arguments.length!==1)return b=this.root+b,n.call(this,b,R,T),this;if(E(b)){var U=b;return this.filter(function(G,J){return!J.dir&&U.test(G)})}var M=this.files[this.root+b];return M&&!M.dir?M:null},folder:function(b){if(!b)return this;if(E(b))return this.filter(function(M,G){return G.dir&&b.test(M)});var R=this.root+b,T=v.call(this,R),U=this.clone();return U.root=T.name,U},remove:function(b){b=this.root+b;var R=this.files[b];if(R||(b.slice(-1)!=="/"&&(b+="/"),R=this.files[b]),R&&!R.dir)delete this.files[b];else for(var T=this.filter(function(M,G){return G.name.slice(0,b.length)===b}),U=0;U<T.length;U++)delete this.files[T[U].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(b){var R,T={};try{if((T=s.extend(b||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");s.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var U=T.comment||this.comment||"";R=c.generateWorker(this,T,U)}catch(M){(R=new d("error")).error(M)}return new m(R,T.type||"string",T.mimeType)},generateAsync:function(b,R){return this.generateInternalStream(b).accumulate(R)},generateNodeStream:function(b,R){return(b=b||{}).type||(b.type="nodebuffer"),this.generateInternalStream(b).toNodejsStream(R)}};i.exports=x},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,r){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,r){var n=t("./DataReader");function a(s){n.call(this,s);for(var d=0;d<this.data.length;d++)s[d]=255&s[d]}t("../utils").inherits(a,n),a.prototype.byteAt=function(s){return this.data[this.zero+s]},a.prototype.lastIndexOfSignature=function(s){for(var d=s.charCodeAt(0),m=s.charCodeAt(1),C=s.charCodeAt(2),I=s.charCodeAt(3),y=this.length-4;0<=y;--y)if(this.data[y]===d&&this.data[y+1]===m&&this.data[y+2]===C&&this.data[y+3]===I)return y-this.zero;return-1},a.prototype.readAndCheckSignature=function(s){var d=s.charCodeAt(0),m=s.charCodeAt(1),C=s.charCodeAt(2),I=s.charCodeAt(3),y=this.readData(4);return d===y[0]&&m===y[1]&&C===y[2]&&I===y[3]},a.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},i.exports=a},{"../utils":32,"./DataReader":18}],18:[function(t,i,r){var n=t("../utils");function a(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var d,m=0;for(this.checkOffset(s),d=this.index+s-1;d>=this.index;d--)m=(m<<8)+this.byteAt(d);return this.index+=s,m},readString:function(s){return n.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},i.exports=a},{"../utils":32}],19:[function(t,i,r){var n=t("./Uint8ArrayReader");function a(s){n.call(this,s)}t("../utils").inherits(a,n),a.prototype.readData=function(s){this.checkOffset(s);var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},i.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,r){var n=t("./DataReader");function a(s){n.call(this,s)}t("../utils").inherits(a,n),a.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},a.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},a.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},a.prototype.readData=function(s){this.checkOffset(s);var d=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},i.exports=a},{"../utils":32,"./DataReader":18}],21:[function(t,i,r){var n=t("./ArrayReader");function a(s){n.call(this,s)}t("../utils").inherits(a,n),a.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,d},i.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,r){var n=t("../utils"),a=t("../support"),s=t("./ArrayReader"),d=t("./StringReader"),m=t("./NodeBufferReader"),C=t("./Uint8ArrayReader");i.exports=function(I){var y=n.getTypeOf(I);return n.checkSupport(y),y!=="string"||a.uint8array?y==="nodebuffer"?new m(I):a.uint8array?new C(n.transformTo("uint8array",I)):new s(n.transformTo("array",I)):new d(I)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,r){r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,r){var n=t("./GenericWorker"),a=t("../utils");function s(d){n.call(this,"ConvertWorker to "+d),this.destType=d}a.inherits(s,n),s.prototype.processChunk=function(d){this.push({data:a.transformTo(this.destType,d.data),meta:d.meta})},i.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,r){var n=t("./GenericWorker"),a=t("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,n),s.prototype.processChunk=function(d){this.streamInfo.crc32=a(d.data,this.streamInfo.crc32||0),this.push(d)},i.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,r){var n=t("../utils"),a=t("./GenericWorker");function s(d){a.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}n.inherits(s,a),s.prototype.processChunk=function(d){if(d){var m=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=m+d.data.length}a.prototype.processChunk.call(this,d)},i.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,r){var n=t("../utils"),a=t("./GenericWorker");function s(d){a.call(this,"DataWorker");var m=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(C){m.dataIsReady=!0,m.data=C,m.max=C&&C.length||0,m.type=n.getTypeOf(C),m.isPaused||m._tickAndRepeat()},function(C){m.error(C)})}n.inherits(s,a),s.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,m=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,m);break;case"uint8array":d=this.data.subarray(this.index,m);break;case"array":case"nodebuffer":d=this.data.slice(this.index,m)}return this.index=m,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,r){function n(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,s){return this._listeners[a].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,s){if(this._listeners[a])for(var d=0;d<this._listeners[a].length;d++)this._listeners[a][d].call(this,s)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var s=this;return a.on("data",function(d){s.processChunk(d)}),a.on("end",function(){s.end()}),a.on("error",function(d){s.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,s){return this.extraStreamInfo[a]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},i.exports=n},{}],29:[function(t,i,r){var n=t("../utils"),a=t("./ConvertWorker"),s=t("./GenericWorker"),d=t("../base64"),m=t("../support"),C=t("../external"),I=null;if(m.nodestream)try{I=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function y(g,h){return new C.Promise(function(_,u){var v=[],E=g._internalType,x=g._outputType,b=g._mimeType;g.on("data",function(R,T){v.push(R),h&&h(T)}).on("error",function(R){v=[],u(R)}).on("end",function(){try{var R=function(T,U,M){switch(T){case"blob":return n.newBlob(n.transformTo("arraybuffer",U),M);case"base64":return d.encode(U);default:return n.transformTo(T,U)}}(x,function(T,U){var M,G=0,J=null,S=0;for(M=0;M<U.length;M++)S+=U[M].length;switch(T){case"string":return U.join("");case"array":return Array.prototype.concat.apply([],U);case"uint8array":for(J=new Uint8Array(S),M=0;M<U.length;M++)J.set(U[M],G),G+=U[M].length;return J;case"nodebuffer":return Buffer.concat(U);default:throw new Error("concat : unsupported type '"+T+"'")}}(E,v),b);_(R)}catch(T){u(T)}v=[]}).resume()})}function c(g,h,_){var u=h;switch(h){case"blob":case"arraybuffer":u="uint8array";break;case"base64":u="string"}try{this._internalType=u,this._outputType=h,this._mimeType=_,n.checkSupport(u),this._worker=g.pipe(new a(u)),g.lock()}catch(v){this._worker=new s("error"),this._worker.error(v)}}c.prototype={accumulate:function(g){return y(this,g)},on:function(g,h){var _=this;return g==="data"?this._worker.on(g,function(u){h.call(_,u.data,u.meta)}):this._worker.on(g,function(){n.delay(h,arguments,_)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new I(this,{objectMode:this._outputType!=="nodebuffer"},g)}},i.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,r){if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",r.nodebuffer=typeof Buffer<"u",r.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(n),r.blob=a.getBlob("application/zip").size===0}catch{r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch{r.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,r){for(var n=t("./utils"),a=t("./support"),s=t("./nodejsUtils"),d=t("./stream/GenericWorker"),m=new Array(256),C=0;C<256;C++)m[C]=252<=C?6:248<=C?5:240<=C?4:224<=C?3:192<=C?2:1;m[254]=m[254]=1;function I(){d.call(this,"utf-8 decode"),this.leftOver=null}function y(){d.call(this,"utf-8 encode")}r.utf8encode=function(c){return a.nodebuffer?s.newBufferFrom(c,"utf-8"):function(g){var h,_,u,v,E,x=g.length,b=0;for(v=0;v<x;v++)(64512&(_=g.charCodeAt(v)))==55296&&v+1<x&&(64512&(u=g.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(u-56320),v++),b+=_<128?1:_<2048?2:_<65536?3:4;for(h=a.uint8array?new Uint8Array(b):new Array(b),v=E=0;E<b;v++)(64512&(_=g.charCodeAt(v)))==55296&&v+1<x&&(64512&(u=g.charCodeAt(v+1)))==56320&&(_=65536+(_-55296<<10)+(u-56320),v++),_<128?h[E++]=_:(_<2048?h[E++]=192|_>>>6:(_<65536?h[E++]=224|_>>>12:(h[E++]=240|_>>>18,h[E++]=128|_>>>12&63),h[E++]=128|_>>>6&63),h[E++]=128|63&_);return h}(c)},r.utf8decode=function(c){return a.nodebuffer?n.transformTo("nodebuffer",c).toString("utf-8"):function(g){var h,_,u,v,E=g.length,x=new Array(2*E);for(h=_=0;h<E;)if((u=g[h++])<128)x[_++]=u;else if(4<(v=m[u]))x[_++]=65533,h+=v-1;else{for(u&=v===2?31:v===3?15:7;1<v&&h<E;)u=u<<6|63&g[h++],v--;1<v?x[_++]=65533:u<65536?x[_++]=u:(u-=65536,x[_++]=55296|u>>10&1023,x[_++]=56320|1023&u)}return x.length!==_&&(x.subarray?x=x.subarray(0,_):x.length=_),n.applyFromCharCode(x)}(c=n.transformTo(a.uint8array?"uint8array":"array",c))},n.inherits(I,d),I.prototype.processChunk=function(c){var g=n.transformTo(a.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var h=g;(g=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),g.set(h,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var _=function(v,E){var x;for((E=E||v.length)>v.length&&(E=v.length),x=E-1;0<=x&&(192&v[x])==128;)x--;return x<0||x===0?E:x+m[v[x]]>E?x:E}(g),u=g;_!==g.length&&(a.uint8array?(u=g.subarray(0,_),this.leftOver=g.subarray(_,g.length)):(u=g.slice(0,_),this.leftOver=g.slice(_,g.length))),this.push({data:r.utf8decode(u),meta:c.meta})},I.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:r.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},r.Utf8DecodeWorker=I,n.inherits(y,d),y.prototype.processChunk=function(c){this.push({data:r.utf8encode(c.data),meta:c.meta})},r.Utf8EncodeWorker=y},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,r){var n=t("./support"),a=t("./base64"),s=t("./nodejsUtils"),d=t("./external");function m(h){return h}function C(h,_){for(var u=0;u<h.length;++u)_[u]=255&h.charCodeAt(u);return _}t("setimmediate"),r.newBlob=function(h,_){r.checkSupport("blob");try{return new Blob([h],{type:_})}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return u.append(h),u.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var I={stringifyByChunk:function(h,_,u){var v=[],E=0,x=h.length;if(x<=u)return String.fromCharCode.apply(null,h);for(;E<x;)_==="array"||_==="nodebuffer"?v.push(String.fromCharCode.apply(null,h.slice(E,Math.min(E+u,x)))):v.push(String.fromCharCode.apply(null,h.subarray(E,Math.min(E+u,x)))),E+=u;return v.join("")},stringifyByChar:function(h){for(var _="",u=0;u<h.length;u++)_+=String.fromCharCode(h[u]);return _},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function y(h){var _=65536,u=r.getTypeOf(h),v=!0;if(u==="uint8array"?v=I.applyCanBeUsed.uint8array:u==="nodebuffer"&&(v=I.applyCanBeUsed.nodebuffer),v)for(;1<_;)try{return I.stringifyByChunk(h,u,_)}catch{_=Math.floor(_/2)}return I.stringifyByChar(h)}function c(h,_){for(var u=0;u<h.length;u++)_[u]=h[u];return _}r.applyFromCharCode=y;var g={};g.string={string:m,array:function(h){return C(h,new Array(h.length))},arraybuffer:function(h){return g.string.uint8array(h).buffer},uint8array:function(h){return C(h,new Uint8Array(h.length))},nodebuffer:function(h){return C(h,s.allocBuffer(h.length))}},g.array={string:y,array:m,arraybuffer:function(h){return new Uint8Array(h).buffer},uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return s.newBufferFrom(h)}},g.arraybuffer={string:function(h){return y(new Uint8Array(h))},array:function(h){return c(new Uint8Array(h),new Array(h.byteLength))},arraybuffer:m,uint8array:function(h){return new Uint8Array(h)},nodebuffer:function(h){return s.newBufferFrom(new Uint8Array(h))}},g.uint8array={string:y,array:function(h){return c(h,new Array(h.length))},arraybuffer:function(h){return h.buffer},uint8array:m,nodebuffer:function(h){return s.newBufferFrom(h)}},g.nodebuffer={string:y,array:function(h){return c(h,new Array(h.length))},arraybuffer:function(h){return g.nodebuffer.uint8array(h).buffer},uint8array:function(h){return c(h,new Uint8Array(h.length))},nodebuffer:m},r.transformTo=function(h,_){if(_=_||"",!h)return _;r.checkSupport(h);var u=r.getTypeOf(_);return g[u][h](_)},r.resolve=function(h){for(var _=h.split("/"),u=[],v=0;v<_.length;v++){var E=_[v];E==="."||E===""&&v!==0&&v!==_.length-1||(E===".."?u.pop():u.push(E))}return u.join("/")},r.getTypeOf=function(h){return typeof h=="string"?"string":Object.prototype.toString.call(h)==="[object Array]"?"array":n.nodebuffer&&s.isBuffer(h)?"nodebuffer":n.uint8array&&h instanceof Uint8Array?"uint8array":n.arraybuffer&&h instanceof ArrayBuffer?"arraybuffer":void 0},r.checkSupport=function(h){if(!n[h.toLowerCase()])throw new Error(h+" is not supported by this platform")},r.MAX_VALUE_16BITS=65535,r.MAX_VALUE_32BITS=-1,r.pretty=function(h){var _,u,v="";for(u=0;u<(h||"").length;u++)v+="\\x"+((_=h.charCodeAt(u))<16?"0":"")+_.toString(16).toUpperCase();return v},r.delay=function(h,_,u){setImmediate(function(){h.apply(u||null,_||[])})},r.inherits=function(h,_){function u(){}u.prototype=_.prototype,h.prototype=new u},r.extend=function(){var h,_,u={};for(h=0;h<arguments.length;h++)for(_ in arguments[h])Object.prototype.hasOwnProperty.call(arguments[h],_)&&u[_]===void 0&&(u[_]=arguments[h][_]);return u},r.prepareContent=function(h,_,u,v,E){return d.Promise.resolve(_).then(function(x){return n.blob&&(x instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(x))!==-1)&&typeof FileReader<"u"?new d.Promise(function(b,R){var T=new FileReader;T.onload=function(U){b(U.target.result)},T.onerror=function(U){R(U.target.error)},T.readAsArrayBuffer(x)}):x}).then(function(x){var b=r.getTypeOf(x);return b?(b==="arraybuffer"?x=r.transformTo("uint8array",x):b==="string"&&(E?x=a.decode(x):u&&v!==!0&&(x=function(R){return C(R,n.uint8array?new Uint8Array(R.length):new Array(R.length))}(x))),x):d.Promise.reject(new Error("Can't read the data of '"+h+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,r){var n=t("./reader/readerFor"),a=t("./utils"),s=t("./signature"),d=t("./zipEntry"),m=t("./support");function C(I){this.files=[],this.loadOptions=I}C.prototype={checkSignature:function(I){if(!this.reader.readAndCheckSignature(I)){this.reader.index-=4;var y=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(y)+", expected "+a.pretty(I)+")")}},isSignature:function(I,y){var c=this.reader.index;this.reader.setIndex(I);var g=this.reader.readString(4)===y;return this.reader.setIndex(c),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var I=this.reader.readData(this.zipCommentLength),y=m.uint8array?"uint8array":"array",c=a.transformTo(y,I);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var I,y,c,g=this.zip64EndOfCentralSize-44;0<g;)I=this.reader.readInt(2),y=this.reader.readInt(4),c=this.reader.readData(y),this.zip64ExtensibleData[I]={id:I,length:y,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var I,y;for(I=0;I<this.files.length;I++)y=this.files[I],this.reader.setIndex(y.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),y.readLocalPart(this.reader),y.handleUTF8(),y.processAttributes()},readCentralDir:function(){var I;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(I=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(I);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var I=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(I<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(I);var y=I;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(I=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(I),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var g=y-c;if(0<g)this.isSignature(y,s.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(I){this.reader=n(I)},load:function(I){this.prepareReader(I),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=C},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,r){var n=t("./reader/readerFor"),a=t("./utils"),s=t("./compressedObject"),d=t("./crc32"),m=t("./utf8"),C=t("./compressions"),I=t("./support");function y(c,g){this.options=c,this.loadOptions=g}y.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var g,h;if(c.skip(22),this.fileNameLength=c.readInt(2),h=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=function(_){for(var u in C)if(Object.prototype.hasOwnProperty.call(C,u)&&C[u].magic===_)return C[u];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,g,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var g=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(g),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=n(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var g,h,_,u=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<u;)g=c.readInt(2),h=c.readInt(2),_=c.readData(h),this.extraFields[g]={id:g,length:h,value:_};c.setIndex(u)},handleUTF8:function(){var c=I.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=m.utf8decode(this.fileName),this.fileCommentStr=m.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var h=a.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var u=a.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(u)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var g=n(c.value);return g.readInt(1)!==1||d(this.fileName)!==g.readInt(4)?null:m.utf8decode(g.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var g=n(c.value);return g.readInt(1)!==1||d(this.fileComment)!==g.readInt(4)?null:m.utf8decode(g.readData(c.length-5))}return null}},i.exports=y},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,r){function n(g,h,_){this.name=g,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=h,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var a=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),d=t("./utf8"),m=t("./compressedObject"),C=t("./stream/GenericWorker");n.prototype={internalStream:function(g){var h=null,_="string";try{if(!g)throw new Error("No output type specified.");var u=(_=g.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),h=this._decompressWorker();var v=!this._dataBinary;v&&!u&&(h=h.pipe(new d.Utf8EncodeWorker)),!v&&u&&(h=h.pipe(new d.Utf8DecodeWorker))}catch(E){(h=new C("error")).error(E)}return new a(h,_,"")},async:function(g,h){return this.internalStream(g).accumulate(h)},nodeStream:function(g,h){return this.internalStream(g||"nodebuffer").toNodejsStream(h)},_compressWorker:function(g,h){if(this._data instanceof m&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new d.Utf8EncodeWorker)),m.createWorkerFrom(_,g,h)},_decompressWorker:function(){return this._data instanceof m?this._data.getContentWorker():this._data instanceof C?this._data:new s(this._data)}};for(var I=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],y=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<I.length;c++)n.prototype[I[c]]=y;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,r){(function(n){var a,s,d=n.MutationObserver||n.WebKitMutationObserver;if(d){var m=0,C=new d(g),I=n.document.createTextNode("");C.observe(I,{characterData:!0}),a=function(){I.data=m=++m%2}}else if(n.setImmediate||n.MessageChannel===void 0)a="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var h=n.document.createElement("script");h.onreadystatechange=function(){g(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},n.document.documentElement.appendChild(h)}:function(){setTimeout(g,0)};else{var y=new n.MessageChannel;y.port1.onmessage=g,a=function(){y.port2.postMessage(0)}}var c=[];function g(){var h,_;s=!0;for(var u=c.length;u;){for(_=c,c=[],h=-1;++h<u;)_[h]();u=c.length}s=!1}i.exports=function(h){c.push(h)!==1||s||a()}}).call(this,typeof _t<"u"?_t:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,r){var n=t("immediate");function a(){}var s={},d=["REJECTED"],m=["FULFILLED"],C=["PENDING"];function I(u){if(typeof u!="function")throw new TypeError("resolver must be a function");this.state=C,this.queue=[],this.outcome=void 0,u!==a&&h(this,u)}function y(u,v,E){this.promise=u,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function c(u,v,E){n(function(){var x;try{x=v(E)}catch(b){return s.reject(u,b)}x===u?s.reject(u,new TypeError("Cannot resolve promise with itself")):s.resolve(u,x)})}function g(u){var v=u&&u.then;if(u&&(typeof u=="object"||typeof u=="function")&&typeof v=="function")return function(){v.apply(u,arguments)}}function h(u,v){var E=!1;function x(T){E||(E=!0,s.reject(u,T))}function b(T){E||(E=!0,s.resolve(u,T))}var R=_(function(){v(b,x)});R.status==="error"&&x(R.value)}function _(u,v){var E={};try{E.value=u(v),E.status="success"}catch(x){E.status="error",E.value=x}return E}(i.exports=I).prototype.finally=function(u){if(typeof u!="function")return this;var v=this.constructor;return this.then(function(E){return v.resolve(u()).then(function(){return E})},function(E){return v.resolve(u()).then(function(){throw E})})},I.prototype.catch=function(u){return this.then(null,u)},I.prototype.then=function(u,v){if(typeof u!="function"&&this.state===m||typeof v!="function"&&this.state===d)return this;var E=new this.constructor(a);return this.state!==C?c(E,this.state===m?u:v,this.outcome):this.queue.push(new y(E,u,v)),E},y.prototype.callFulfilled=function(u){s.resolve(this.promise,u)},y.prototype.otherCallFulfilled=function(u){c(this.promise,this.onFulfilled,u)},y.prototype.callRejected=function(u){s.reject(this.promise,u)},y.prototype.otherCallRejected=function(u){c(this.promise,this.onRejected,u)},s.resolve=function(u,v){var E=_(g,v);if(E.status==="error")return s.reject(u,E.value);var x=E.value;if(x)h(u,x);else{u.state=m,u.outcome=v;for(var b=-1,R=u.queue.length;++b<R;)u.queue[b].callFulfilled(v)}return u},s.reject=function(u,v){u.state=d,u.outcome=v;for(var E=-1,x=u.queue.length;++E<x;)u.queue[E].callRejected(v);return u},I.resolve=function(u){return u instanceof this?u:s.resolve(new this(a),u)},I.reject=function(u){var v=new this(a);return s.reject(v,u)},I.all=function(u){var v=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=u.length,x=!1;if(!E)return this.resolve([]);for(var b=new Array(E),R=0,T=-1,U=new this(a);++T<E;)M(u[T],T);return U;function M(G,J){v.resolve(G).then(function(S){b[J]=S,++R!==E||x||(x=!0,s.resolve(U,b))},function(S){x||(x=!0,s.reject(U,S))})}},I.race=function(u){var v=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=u.length,x=!1;if(!E)return this.resolve([]);for(var b=-1,R=new this(a);++b<E;)T=u[b],v.resolve(T).then(function(U){x||(x=!0,s.resolve(R,U))},function(U){x||(x=!0,s.reject(R,U))});var T;return R}},{immediate:36}],38:[function(t,i,r){var n={};(0,t("./lib/utils/common").assign)(n,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,r){var n=t("./zlib/deflate"),a=t("./utils/common"),s=t("./utils/strings"),d=t("./zlib/messages"),m=t("./zlib/zstream"),C=Object.prototype.toString,I=0,y=-1,c=0,g=8;function h(u){if(!(this instanceof h))return new h(u);this.options=a.assign({level:y,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},u||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new m,this.strm.avail_out=0;var E=n.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(E!==I)throw new Error(d[E]);if(v.header&&n.deflateSetHeader(this.strm,v.header),v.dictionary){var x;if(x=typeof v.dictionary=="string"?s.string2buf(v.dictionary):C.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(E=n.deflateSetDictionary(this.strm,x))!==I)throw new Error(d[E]);this._dict_set=!0}}function _(u,v){var E=new h(v);if(E.push(u,!0),E.err)throw E.msg||d[E.err];return E.result}h.prototype.push=function(u,v){var E,x,b=this.strm,R=this.options.chunkSize;if(this.ended)return!1;x=v===~~v?v:v===!0?4:0,typeof u=="string"?b.input=s.string2buf(u):C.call(u)==="[object ArrayBuffer]"?b.input=new Uint8Array(u):b.input=u,b.next_in=0,b.avail_in=b.input.length;do{if(b.avail_out===0&&(b.output=new a.Buf8(R),b.next_out=0,b.avail_out=R),(E=n.deflate(b,x))!==1&&E!==I)return this.onEnd(E),!(this.ended=!0);b.avail_out!==0&&(b.avail_in!==0||x!==4&&x!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(a.shrinkBuf(b.output,b.next_out))):this.onData(a.shrinkBuf(b.output,b.next_out)))}while((0<b.avail_in||b.avail_out===0)&&E!==1);return x===4?(E=n.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===I):x!==2||(this.onEnd(I),!(b.avail_out=0))},h.prototype.onData=function(u){this.chunks.push(u)},h.prototype.onEnd=function(u){u===I&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},r.Deflate=h,r.deflate=_,r.deflateRaw=function(u,v){return(v=v||{}).raw=!0,_(u,v)},r.gzip=function(u,v){return(v=v||{}).gzip=!0,_(u,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,r){var n=t("./zlib/inflate"),a=t("./utils/common"),s=t("./utils/strings"),d=t("./zlib/constants"),m=t("./zlib/messages"),C=t("./zlib/zstream"),I=t("./zlib/gzheader"),y=Object.prototype.toString;function c(h){if(!(this instanceof c))return new c(h);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},h||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||h&&h.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&!(15&_.windowBits)&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new C,this.strm.avail_out=0;var u=n.inflateInit2(this.strm,_.windowBits);if(u!==d.Z_OK)throw new Error(m[u]);this.header=new I,n.inflateGetHeader(this.strm,this.header)}function g(h,_){var u=new c(_);if(u.push(h,!0),u.err)throw u.msg||m[u.err];return u.result}c.prototype.push=function(h,_){var u,v,E,x,b,R,T=this.strm,U=this.options.chunkSize,M=this.options.dictionary,G=!1;if(this.ended)return!1;v=_===~~_?_:_===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof h=="string"?T.input=s.binstring2buf(h):y.call(h)==="[object ArrayBuffer]"?T.input=new Uint8Array(h):T.input=h,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new a.Buf8(U),T.next_out=0,T.avail_out=U),(u=n.inflate(T,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&M&&(R=typeof M=="string"?s.string2buf(M):y.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,u=n.inflateSetDictionary(this.strm,R)),u===d.Z_BUF_ERROR&&G===!0&&(u=d.Z_OK,G=!1),u!==d.Z_STREAM_END&&u!==d.Z_OK)return this.onEnd(u),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&u!==d.Z_STREAM_END&&(T.avail_in!==0||v!==d.Z_FINISH&&v!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=s.utf8border(T.output,T.next_out),x=T.next_out-E,b=s.buf2string(T.output,E),T.next_out=x,T.avail_out=U-x,x&&a.arraySet(T.output,T.output,E,x,0),this.onData(b)):this.onData(a.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(G=!0)}while((0<T.avail_in||T.avail_out===0)&&u!==d.Z_STREAM_END);return u===d.Z_STREAM_END&&(v=d.Z_FINISH),v===d.Z_FINISH?(u=n.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===d.Z_OK):v!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(T.avail_out=0))},c.prototype.onData=function(h){this.chunks.push(h)},c.prototype.onEnd=function(h){h===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},r.Inflate=c,r.inflate=g,r.inflateRaw=function(h,_){return(_=_||{}).raw=!0,g(h,_)},r.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,r){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";r.assign=function(d){for(var m=Array.prototype.slice.call(arguments,1);m.length;){var C=m.shift();if(C){if(typeof C!="object")throw new TypeError(C+"must be non-object");for(var I in C)C.hasOwnProperty(I)&&(d[I]=C[I])}}return d},r.shrinkBuf=function(d,m){return d.length===m?d:d.subarray?d.subarray(0,m):(d.length=m,d)};var a={arraySet:function(d,m,C,I,y){if(m.subarray&&d.subarray)d.set(m.subarray(C,C+I),y);else for(var c=0;c<I;c++)d[y+c]=m[C+c]},flattenChunks:function(d){var m,C,I,y,c,g;for(m=I=0,C=d.length;m<C;m++)I+=d[m].length;for(g=new Uint8Array(I),m=y=0,C=d.length;m<C;m++)c=d[m],g.set(c,y),y+=c.length;return g}},s={arraySet:function(d,m,C,I,y){for(var c=0;c<I;c++)d[y+c]=m[C+c]},flattenChunks:function(d){return[].concat.apply([],d)}};r.setTyped=function(d){d?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,a)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(t,i,r){var n=t("./common"),a=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var d=new n.Buf8(256),m=0;m<256;m++)d[m]=252<=m?6:248<=m?5:240<=m?4:224<=m?3:192<=m?2:1;function C(I,y){if(y<65537&&(I.subarray&&s||!I.subarray&&a))return String.fromCharCode.apply(null,n.shrinkBuf(I,y));for(var c="",g=0;g<y;g++)c+=String.fromCharCode(I[g]);return c}d[254]=d[254]=1,r.string2buf=function(I){var y,c,g,h,_,u=I.length,v=0;for(h=0;h<u;h++)(64512&(c=I.charCodeAt(h)))==55296&&h+1<u&&(64512&(g=I.charCodeAt(h+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),h++),v+=c<128?1:c<2048?2:c<65536?3:4;for(y=new n.Buf8(v),h=_=0;_<v;h++)(64512&(c=I.charCodeAt(h)))==55296&&h+1<u&&(64512&(g=I.charCodeAt(h+1)))==56320&&(c=65536+(c-55296<<10)+(g-56320),h++),c<128?y[_++]=c:(c<2048?y[_++]=192|c>>>6:(c<65536?y[_++]=224|c>>>12:(y[_++]=240|c>>>18,y[_++]=128|c>>>12&63),y[_++]=128|c>>>6&63),y[_++]=128|63&c);return y},r.buf2binstring=function(I){return C(I,I.length)},r.binstring2buf=function(I){for(var y=new n.Buf8(I.length),c=0,g=y.length;c<g;c++)y[c]=I.charCodeAt(c);return y},r.buf2string=function(I,y){var c,g,h,_,u=y||I.length,v=new Array(2*u);for(c=g=0;c<u;)if((h=I[c++])<128)v[g++]=h;else if(4<(_=d[h]))v[g++]=65533,c+=_-1;else{for(h&=_===2?31:_===3?15:7;1<_&&c<u;)h=h<<6|63&I[c++],_--;1<_?v[g++]=65533:h<65536?v[g++]=h:(h-=65536,v[g++]=55296|h>>10&1023,v[g++]=56320|1023&h)}return C(v,g)},r.utf8border=function(I,y){var c;for((y=y||I.length)>I.length&&(y=I.length),c=y-1;0<=c&&(192&I[c])==128;)c--;return c<0||c===0?y:c+d[I[c]]>y?c:y}},{"./common":41}],43:[function(t,i,r){i.exports=function(n,a,s,d){for(var m=65535&n|0,C=n>>>16&65535|0,I=0;s!==0;){for(s-=I=2e3<s?2e3:s;C=C+(m=m+a[d++]|0)|0,--I;);m%=65521,C%=65521}return m|C<<16|0}},{}],44:[function(t,i,r){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,r){var n=function(){for(var a,s=[],d=0;d<256;d++){a=d;for(var m=0;m<8;m++)a=1&a?3988292384^a>>>1:a>>>1;s[d]=a}return s}();i.exports=function(a,s,d,m){var C=n,I=m+d;a^=-1;for(var y=m;y<I;y++)a=a>>>8^C[255&(a^s[y])];return-1^a}},{}],46:[function(t,i,r){var n,a=t("../utils/common"),s=t("./trees"),d=t("./adler32"),m=t("./crc32"),C=t("./messages"),I=0,y=4,c=0,g=-2,h=-1,_=4,u=2,v=8,E=9,x=286,b=30,R=19,T=2*x+1,U=15,M=3,G=258,J=G+M+1,S=42,L=113,l=1,N=2,ie=3,K=4;function re(o,B){return o.msg=C[B],B}function W(o){return(o<<1)-(4<o?9:0)}function te(o){for(var B=o.length;0<=--B;)o[B]=0}function P(o){var B=o.state,k=B.pending;k>o.avail_out&&(k=o.avail_out),k!==0&&(a.arraySet(o.output,B.pending_buf,B.pending_out,k,o.next_out),o.next_out+=k,B.pending_out+=k,o.total_out+=k,o.avail_out-=k,B.pending-=k,B.pending===0&&(B.pending_out=0))}function F(o,B){s._tr_flush_block(o,0<=o.block_start?o.block_start:-1,o.strstart-o.block_start,B),o.block_start=o.strstart,P(o.strm)}function ee(o,B){o.pending_buf[o.pending++]=B}function q(o,B){o.pending_buf[o.pending++]=B>>>8&255,o.pending_buf[o.pending++]=255&B}function Z(o,B){var k,f,p=o.max_chain_length,A=o.strstart,z=o.prev_length,V=o.nice_match,D=o.strstart>o.w_size-J?o.strstart-(o.w_size-J):0,H=o.window,X=o.w_mask,j=o.prev,Q=o.strstart+G,he=H[A+z-1],oe=H[A+z];o.prev_length>=o.good_match&&(p>>=2),V>o.lookahead&&(V=o.lookahead);do if(H[(k=B)+z]===oe&&H[k+z-1]===he&&H[k]===H[A]&&H[++k]===H[A+1]){A+=2,k++;do;while(H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&H[++A]===H[++k]&&A<Q);if(f=G-(Q-A),A=Q-G,z<f){if(o.match_start=B,V<=(z=f))break;he=H[A+z-1],oe=H[A+z]}}while((B=j[B&X])>D&&--p!=0);return z<=o.lookahead?z:o.lookahead}function ce(o){var B,k,f,p,A,z,V,D,H,X,j=o.w_size;do{if(p=o.window_size-o.lookahead-o.strstart,o.strstart>=j+(j-J)){for(a.arraySet(o.window,o.window,j,j,0),o.match_start-=j,o.strstart-=j,o.block_start-=j,B=k=o.hash_size;f=o.head[--B],o.head[B]=j<=f?f-j:0,--k;);for(B=k=j;f=o.prev[--B],o.prev[B]=j<=f?f-j:0,--k;);p+=j}if(o.strm.avail_in===0)break;if(z=o.strm,V=o.window,D=o.strstart+o.lookahead,H=p,X=void 0,X=z.avail_in,H<X&&(X=H),k=X===0?0:(z.avail_in-=X,a.arraySet(V,z.input,z.next_in,X,D),z.state.wrap===1?z.adler=d(z.adler,V,X,D):z.state.wrap===2&&(z.adler=m(z.adler,V,X,D)),z.next_in+=X,z.total_in+=X,X),o.lookahead+=k,o.lookahead+o.insert>=M)for(A=o.strstart-o.insert,o.ins_h=o.window[A],o.ins_h=(o.ins_h<<o.hash_shift^o.window[A+1])&o.hash_mask;o.insert&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[A+M-1])&o.hash_mask,o.prev[A&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=A,A++,o.insert--,!(o.lookahead+o.insert<M)););}while(o.lookahead<J&&o.strm.avail_in!==0)}function me(o,B){for(var k,f;;){if(o.lookahead<J){if(ce(o),o.lookahead<J&&B===I)return l;if(o.lookahead===0)break}if(k=0,o.lookahead>=M&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+M-1])&o.hash_mask,k=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),k!==0&&o.strstart-k<=o.w_size-J&&(o.match_length=Z(o,k)),o.match_length>=M)if(f=s._tr_tally(o,o.strstart-o.match_start,o.match_length-M),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=M){for(o.match_length--;o.strstart++,o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+M-1])&o.hash_mask,k=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart,--o.match_length!=0;);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+1])&o.hash_mask;else f=s._tr_tally(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(f&&(F(o,!1),o.strm.avail_out===0))return l}return o.insert=o.strstart<M-1?o.strstart:M-1,B===y?(F(o,!0),o.strm.avail_out===0?ie:K):o.last_lit&&(F(o,!1),o.strm.avail_out===0)?l:N}function se(o,B){for(var k,f,p;;){if(o.lookahead<J){if(ce(o),o.lookahead<J&&B===I)return l;if(o.lookahead===0)break}if(k=0,o.lookahead>=M&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+M-1])&o.hash_mask,k=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=M-1,k!==0&&o.prev_length<o.max_lazy_match&&o.strstart-k<=o.w_size-J&&(o.match_length=Z(o,k),o.match_length<=5&&(o.strategy===1||o.match_length===M&&4096<o.strstart-o.match_start)&&(o.match_length=M-1)),o.prev_length>=M&&o.match_length<=o.prev_length){for(p=o.strstart+o.lookahead-M,f=s._tr_tally(o,o.strstart-1-o.prev_match,o.prev_length-M),o.lookahead-=o.prev_length-1,o.prev_length-=2;++o.strstart<=p&&(o.ins_h=(o.ins_h<<o.hash_shift^o.window[o.strstart+M-1])&o.hash_mask,k=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),--o.prev_length!=0;);if(o.match_available=0,o.match_length=M-1,o.strstart++,f&&(F(o,!1),o.strm.avail_out===0))return l}else if(o.match_available){if((f=s._tr_tally(o,0,o.window[o.strstart-1]))&&F(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return l}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(f=s._tr_tally(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<M-1?o.strstart:M-1,B===y?(F(o,!0),o.strm.avail_out===0?ie:K):o.last_lit&&(F(o,!1),o.strm.avail_out===0)?l:N}function le(o,B,k,f,p){this.good_length=o,this.max_lazy=B,this.nice_length=k,this.max_chain=f,this.func=p}function _e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*T),this.dyn_dtree=new a.Buf16(2*(2*b+1)),this.bl_tree=new a.Buf16(2*(2*R+1)),te(this.dyn_ltree),te(this.dyn_dtree),te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(U+1),this.heap=new a.Buf16(2*x+1),te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*x+1),te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ue(o){var B;return o&&o.state?(o.total_in=o.total_out=0,o.data_type=u,(B=o.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?S:L,o.adler=B.wrap===2?0:1,B.last_flush=I,s._tr_init(B),c):re(o,g)}function De(o){var B=ue(o);return B===c&&function(k){k.window_size=2*k.w_size,te(k.head),k.max_lazy_match=n[k.level].max_lazy,k.good_match=n[k.level].good_length,k.nice_match=n[k.level].nice_length,k.max_chain_length=n[k.level].max_chain,k.strstart=0,k.block_start=0,k.lookahead=0,k.insert=0,k.match_length=k.prev_length=M-1,k.match_available=0,k.ins_h=0}(o.state),B}function Ee(o,B,k,f,p,A){if(!o)return g;var z=1;if(B===h&&(B=6),f<0?(z=0,f=-f):15<f&&(z=2,f-=16),p<1||E<p||k!==v||f<8||15<f||B<0||9<B||A<0||_<A)return re(o,g);f===8&&(f=9);var V=new _e;return(o.state=V).strm=o,V.wrap=z,V.gzhead=null,V.w_bits=f,V.w_size=1<<V.w_bits,V.w_mask=V.w_size-1,V.hash_bits=p+7,V.hash_size=1<<V.hash_bits,V.hash_mask=V.hash_size-1,V.hash_shift=~~((V.hash_bits+M-1)/M),V.window=new a.Buf8(2*V.w_size),V.head=new a.Buf16(V.hash_size),V.prev=new a.Buf16(V.w_size),V.lit_bufsize=1<<p+6,V.pending_buf_size=4*V.lit_bufsize,V.pending_buf=new a.Buf8(V.pending_buf_size),V.d_buf=1*V.lit_bufsize,V.l_buf=3*V.lit_bufsize,V.level=B,V.strategy=A,V.method=k,De(o)}n=[new le(0,0,0,0,function(o,B){var k=65535;for(k>o.pending_buf_size-5&&(k=o.pending_buf_size-5);;){if(o.lookahead<=1){if(ce(o),o.lookahead===0&&B===I)return l;if(o.lookahead===0)break}o.strstart+=o.lookahead,o.lookahead=0;var f=o.block_start+k;if((o.strstart===0||o.strstart>=f)&&(o.lookahead=o.strstart-f,o.strstart=f,F(o,!1),o.strm.avail_out===0)||o.strstart-o.block_start>=o.w_size-J&&(F(o,!1),o.strm.avail_out===0))return l}return o.insert=0,B===y?(F(o,!0),o.strm.avail_out===0?ie:K):(o.strstart>o.block_start&&(F(o,!1),o.strm.avail_out),l)}),new le(4,4,8,4,me),new le(4,5,16,8,me),new le(4,6,32,32,me),new le(4,4,16,16,se),new le(8,16,32,32,se),new le(8,16,128,128,se),new le(8,32,128,256,se),new le(32,128,258,1024,se),new le(32,258,258,4096,se)],r.deflateInit=function(o,B){return Ee(o,B,v,15,8,0)},r.deflateInit2=Ee,r.deflateReset=De,r.deflateResetKeep=ue,r.deflateSetHeader=function(o,B){return o&&o.state?o.state.wrap!==2?g:(o.state.gzhead=B,c):g},r.deflate=function(o,B){var k,f,p,A;if(!o||!o.state||5<B||B<0)return o?re(o,g):g;if(f=o.state,!o.output||!o.input&&o.avail_in!==0||f.status===666&&B!==y)return re(o,o.avail_out===0?-5:g);if(f.strm=o,k=f.last_flush,f.last_flush=B,f.status===S)if(f.wrap===2)o.adler=0,ee(f,31),ee(f,139),ee(f,8),f.gzhead?(ee(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),ee(f,255&f.gzhead.time),ee(f,f.gzhead.time>>8&255),ee(f,f.gzhead.time>>16&255),ee(f,f.gzhead.time>>24&255),ee(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),ee(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(ee(f,255&f.gzhead.extra.length),ee(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(o.adler=m(o.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(ee(f,0),ee(f,0),ee(f,0),ee(f,0),ee(f,0),ee(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),ee(f,3),f.status=L);else{var z=v+(f.w_bits-8<<4)<<8;z|=(2<=f.strategy||f.level<2?0:f.level<6?1:f.level===6?2:3)<<6,f.strstart!==0&&(z|=32),z+=31-z%31,f.status=L,q(f,z),f.strstart!==0&&(q(f,o.adler>>>16),q(f,65535&o.adler)),o.adler=1}if(f.status===69)if(f.gzhead.extra){for(p=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),P(o),p=f.pending,f.pending!==f.pending_buf_size));)ee(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(f.status===73)if(f.gzhead.name){p=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),P(o),p=f.pending,f.pending===f.pending_buf_size)){A=1;break}A=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,ee(f,A)}while(A!==0);f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),A===0&&(f.gzindex=0,f.status=91)}else f.status=91;if(f.status===91)if(f.gzhead.comment){p=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),P(o),p=f.pending,f.pending===f.pending_buf_size)){A=1;break}A=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,ee(f,A)}while(A!==0);f.gzhead.hcrc&&f.pending>p&&(o.adler=m(o.adler,f.pending_buf,f.pending-p,p)),A===0&&(f.status=103)}else f.status=103;if(f.status===103&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&P(o),f.pending+2<=f.pending_buf_size&&(ee(f,255&o.adler),ee(f,o.adler>>8&255),o.adler=0,f.status=L)):f.status=L),f.pending!==0){if(P(o),o.avail_out===0)return f.last_flush=-1,c}else if(o.avail_in===0&&W(B)<=W(k)&&B!==y)return re(o,-5);if(f.status===666&&o.avail_in!==0)return re(o,-5);if(o.avail_in!==0||f.lookahead!==0||B!==I&&f.status!==666){var V=f.strategy===2?function(D,H){for(var X;;){if(D.lookahead===0&&(ce(D),D.lookahead===0)){if(H===I)return l;break}if(D.match_length=0,X=s._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++,X&&(F(D,!1),D.strm.avail_out===0))return l}return D.insert=0,H===y?(F(D,!0),D.strm.avail_out===0?ie:K):D.last_lit&&(F(D,!1),D.strm.avail_out===0)?l:N}(f,B):f.strategy===3?function(D,H){for(var X,j,Q,he,oe=D.window;;){if(D.lookahead<=G){if(ce(D),D.lookahead<=G&&H===I)return l;if(D.lookahead===0)break}if(D.match_length=0,D.lookahead>=M&&0<D.strstart&&(j=oe[Q=D.strstart-1])===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]){he=D.strstart+G;do;while(j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&j===oe[++Q]&&Q<he);D.match_length=G-(he-Q),D.match_length>D.lookahead&&(D.match_length=D.lookahead)}if(D.match_length>=M?(X=s._tr_tally(D,1,D.match_length-M),D.lookahead-=D.match_length,D.strstart+=D.match_length,D.match_length=0):(X=s._tr_tally(D,0,D.window[D.strstart]),D.lookahead--,D.strstart++),X&&(F(D,!1),D.strm.avail_out===0))return l}return D.insert=0,H===y?(F(D,!0),D.strm.avail_out===0?ie:K):D.last_lit&&(F(D,!1),D.strm.avail_out===0)?l:N}(f,B):n[f.level].func(f,B);if(V!==ie&&V!==K||(f.status=666),V===l||V===ie)return o.avail_out===0&&(f.last_flush=-1),c;if(V===N&&(B===1?s._tr_align(f):B!==5&&(s._tr_stored_block(f,0,0,!1),B===3&&(te(f.head),f.lookahead===0&&(f.strstart=0,f.block_start=0,f.insert=0))),P(o),o.avail_out===0))return f.last_flush=-1,c}return B!==y?c:f.wrap<=0?1:(f.wrap===2?(ee(f,255&o.adler),ee(f,o.adler>>8&255),ee(f,o.adler>>16&255),ee(f,o.adler>>24&255),ee(f,255&o.total_in),ee(f,o.total_in>>8&255),ee(f,o.total_in>>16&255),ee(f,o.total_in>>24&255)):(q(f,o.adler>>>16),q(f,65535&o.adler)),P(o),0<f.wrap&&(f.wrap=-f.wrap),f.pending!==0?c:1)},r.deflateEnd=function(o){var B;return o&&o.state?(B=o.state.status)!==S&&B!==69&&B!==73&&B!==91&&B!==103&&B!==L&&B!==666?re(o,g):(o.state=null,B===L?re(o,-3):c):g},r.deflateSetDictionary=function(o,B){var k,f,p,A,z,V,D,H,X=B.length;if(!o||!o.state||(A=(k=o.state).wrap)===2||A===1&&k.status!==S||k.lookahead)return g;for(A===1&&(o.adler=d(o.adler,B,X,0)),k.wrap=0,X>=k.w_size&&(A===0&&(te(k.head),k.strstart=0,k.block_start=0,k.insert=0),H=new a.Buf8(k.w_size),a.arraySet(H,B,X-k.w_size,k.w_size,0),B=H,X=k.w_size),z=o.avail_in,V=o.next_in,D=o.input,o.avail_in=X,o.next_in=0,o.input=B,ce(k);k.lookahead>=M;){for(f=k.strstart,p=k.lookahead-(M-1);k.ins_h=(k.ins_h<<k.hash_shift^k.window[f+M-1])&k.hash_mask,k.prev[f&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=f,f++,--p;);k.strstart=f,k.lookahead=M-1,ce(k)}return k.strstart+=k.lookahead,k.block_start=k.strstart,k.insert=k.lookahead,k.lookahead=0,k.match_length=k.prev_length=M-1,k.match_available=0,o.next_in=V,o.input=D,o.avail_in=z,k.wrap=A,c},r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,r){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,r){i.exports=function(n,a){var s,d,m,C,I,y,c,g,h,_,u,v,E,x,b,R,T,U,M,G,J,S,L,l,N;s=n.state,d=n.next_in,l=n.input,m=d+(n.avail_in-5),C=n.next_out,N=n.output,I=C-(a-n.avail_out),y=C+(n.avail_out-257),c=s.dmax,g=s.wsize,h=s.whave,_=s.wnext,u=s.window,v=s.hold,E=s.bits,x=s.lencode,b=s.distcode,R=(1<<s.lenbits)-1,T=(1<<s.distbits)-1;e:do{E<15&&(v+=l[d++]<<E,E+=8,v+=l[d++]<<E,E+=8),U=x[v&R];t:for(;;){if(v>>>=M=U>>>24,E-=M,(M=U>>>16&255)===0)N[C++]=65535&U;else{if(!(16&M)){if(!(64&M)){U=x[(65535&U)+(v&(1<<M)-1)];continue t}if(32&M){s.mode=12;break e}n.msg="invalid literal/length code",s.mode=30;break e}G=65535&U,(M&=15)&&(E<M&&(v+=l[d++]<<E,E+=8),G+=v&(1<<M)-1,v>>>=M,E-=M),E<15&&(v+=l[d++]<<E,E+=8,v+=l[d++]<<E,E+=8),U=b[v&T];i:for(;;){if(v>>>=M=U>>>24,E-=M,!(16&(M=U>>>16&255))){if(!(64&M)){U=b[(65535&U)+(v&(1<<M)-1)];continue i}n.msg="invalid distance code",s.mode=30;break e}if(J=65535&U,E<(M&=15)&&(v+=l[d++]<<E,(E+=8)<M&&(v+=l[d++]<<E,E+=8)),c<(J+=v&(1<<M)-1)){n.msg="invalid distance too far back",s.mode=30;break e}if(v>>>=M,E-=M,(M=C-I)<J){if(h<(M=J-M)&&s.sane){n.msg="invalid distance too far back",s.mode=30;break e}if(L=u,(S=0)===_){if(S+=g-M,M<G){for(G-=M;N[C++]=u[S++],--M;);S=C-J,L=N}}else if(_<M){if(S+=g+_-M,(M-=_)<G){for(G-=M;N[C++]=u[S++],--M;);if(S=0,_<G){for(G-=M=_;N[C++]=u[S++],--M;);S=C-J,L=N}}}else if(S+=_-M,M<G){for(G-=M;N[C++]=u[S++],--M;);S=C-J,L=N}for(;2<G;)N[C++]=L[S++],N[C++]=L[S++],N[C++]=L[S++],G-=3;G&&(N[C++]=L[S++],1<G&&(N[C++]=L[S++]))}else{for(S=C-J;N[C++]=N[S++],N[C++]=N[S++],N[C++]=N[S++],2<(G-=3););G&&(N[C++]=N[S++],1<G&&(N[C++]=N[S++]))}break}}break}}while(d<m&&C<y);d-=G=E>>3,v&=(1<<(E-=G<<3))-1,n.next_in=d,n.next_out=C,n.avail_in=d<m?m-d+5:5-(d-m),n.avail_out=C<y?y-C+257:257-(C-y),s.hold=v,s.bits=E}},{}],49:[function(t,i,r){var n=t("../utils/common"),a=t("./adler32"),s=t("./crc32"),d=t("./inffast"),m=t("./inftrees"),C=1,I=2,y=0,c=-2,g=1,h=852,_=592;function u(S){return(S>>>24&255)+(S>>>8&65280)+((65280&S)<<8)+((255&S)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(S){var L;return S&&S.state?(L=S.state,S.total_in=S.total_out=L.total=0,S.msg="",L.wrap&&(S.adler=1&L.wrap),L.mode=g,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new n.Buf32(h),L.distcode=L.distdyn=new n.Buf32(_),L.sane=1,L.back=-1,y):c}function x(S){var L;return S&&S.state?((L=S.state).wsize=0,L.whave=0,L.wnext=0,E(S)):c}function b(S,L){var l,N;return S&&S.state?(N=S.state,L<0?(l=0,L=-L):(l=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?c:(N.window!==null&&N.wbits!==L&&(N.window=null),N.wrap=l,N.wbits=L,x(S))):c}function R(S,L){var l,N;return S?(N=new v,(S.state=N).window=null,(l=b(S,L))!==y&&(S.state=null),l):c}var T,U,M=!0;function G(S){if(M){var L;for(T=new n.Buf32(512),U=new n.Buf32(32),L=0;L<144;)S.lens[L++]=8;for(;L<256;)S.lens[L++]=9;for(;L<280;)S.lens[L++]=7;for(;L<288;)S.lens[L++]=8;for(m(C,S.lens,0,288,T,0,S.work,{bits:9}),L=0;L<32;)S.lens[L++]=5;m(I,S.lens,0,32,U,0,S.work,{bits:5}),M=!1}S.lencode=T,S.lenbits=9,S.distcode=U,S.distbits=5}function J(S,L,l,N){var ie,K=S.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new n.Buf8(K.wsize)),N>=K.wsize?(n.arraySet(K.window,L,l-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):(N<(ie=K.wsize-K.wnext)&&(ie=N),n.arraySet(K.window,L,l-N,ie,K.wnext),(N-=ie)?(n.arraySet(K.window,L,l-N,N,0),K.wnext=N,K.whave=K.wsize):(K.wnext+=ie,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=ie))),0}r.inflateReset=x,r.inflateReset2=b,r.inflateResetKeep=E,r.inflateInit=function(S){return R(S,15)},r.inflateInit2=R,r.inflate=function(S,L){var l,N,ie,K,re,W,te,P,F,ee,q,Z,ce,me,se,le,_e,ue,De,Ee,o,B,k,f,p=0,A=new n.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!S||!S.state||!S.output||!S.input&&S.avail_in!==0)return c;(l=S.state).mode===12&&(l.mode=13),re=S.next_out,ie=S.output,te=S.avail_out,K=S.next_in,N=S.input,W=S.avail_in,P=l.hold,F=l.bits,ee=W,q=te,B=y;e:for(;;)switch(l.mode){case g:if(l.wrap===0){l.mode=13;break}for(;F<16;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(2&l.wrap&&P===35615){A[l.check=0]=255&P,A[1]=P>>>8&255,l.check=s(l.check,A,2,0),F=P=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&P)<<8)+(P>>8))%31){S.msg="incorrect header check",l.mode=30;break}if((15&P)!=8){S.msg="unknown compression method",l.mode=30;break}if(F-=4,o=8+(15&(P>>>=4)),l.wbits===0)l.wbits=o;else if(o>l.wbits){S.msg="invalid window size",l.mode=30;break}l.dmax=1<<o,S.adler=l.check=1,l.mode=512&P?10:12,F=P=0;break;case 2:for(;F<16;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(l.flags=P,(255&l.flags)!=8){S.msg="unknown compression method",l.mode=30;break}if(57344&l.flags){S.msg="unknown header flags set",l.mode=30;break}l.head&&(l.head.text=P>>8&1),512&l.flags&&(A[0]=255&P,A[1]=P>>>8&255,l.check=s(l.check,A,2,0)),F=P=0,l.mode=3;case 3:for(;F<32;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.head&&(l.head.time=P),512&l.flags&&(A[0]=255&P,A[1]=P>>>8&255,A[2]=P>>>16&255,A[3]=P>>>24&255,l.check=s(l.check,A,4,0)),F=P=0,l.mode=4;case 4:for(;F<16;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.head&&(l.head.xflags=255&P,l.head.os=P>>8),512&l.flags&&(A[0]=255&P,A[1]=P>>>8&255,l.check=s(l.check,A,2,0)),F=P=0,l.mode=5;case 5:if(1024&l.flags){for(;F<16;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.length=P,l.head&&(l.head.extra_len=P),512&l.flags&&(A[0]=255&P,A[1]=P>>>8&255,l.check=s(l.check,A,2,0)),F=P=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(W<(Z=l.length)&&(Z=W),Z&&(l.head&&(o=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Array(l.head.extra_len)),n.arraySet(l.head.extra,N,K,Z,o)),512&l.flags&&(l.check=s(l.check,N,Z,K)),W-=Z,K+=Z,l.length-=Z),l.length))break e;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(W===0)break e;for(Z=0;o=N[K+Z++],l.head&&o&&l.length<65536&&(l.head.name+=String.fromCharCode(o)),o&&Z<W;);if(512&l.flags&&(l.check=s(l.check,N,Z,K)),W-=Z,K+=Z,o)break e}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(W===0)break e;for(Z=0;o=N[K+Z++],l.head&&o&&l.length<65536&&(l.head.comment+=String.fromCharCode(o)),o&&Z<W;);if(512&l.flags&&(l.check=s(l.check,N,Z,K)),W-=Z,K+=Z,o)break e}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;F<16;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(P!==(65535&l.check)){S.msg="header crc mismatch",l.mode=30;break}F=P=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),S.adler=l.check=0,l.mode=12;break;case 10:for(;F<32;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}S.adler=l.check=u(P),F=P=0,l.mode=11;case 11:if(l.havedict===0)return S.next_out=re,S.avail_out=te,S.next_in=K,S.avail_in=W,l.hold=P,l.bits=F,2;S.adler=l.check=1,l.mode=12;case 12:if(L===5||L===6)break e;case 13:if(l.last){P>>>=7&F,F-=7&F,l.mode=27;break}for(;F<3;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}switch(l.last=1&P,F-=1,3&(P>>>=1)){case 0:l.mode=14;break;case 1:if(G(l),l.mode=20,L!==6)break;P>>>=2,F-=2;break e;case 2:l.mode=17;break;case 3:S.msg="invalid block type",l.mode=30}P>>>=2,F-=2;break;case 14:for(P>>>=7&F,F-=7&F;F<32;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if((65535&P)!=(P>>>16^65535)){S.msg="invalid stored block lengths",l.mode=30;break}if(l.length=65535&P,F=P=0,l.mode=15,L===6)break e;case 15:l.mode=16;case 16:if(Z=l.length){if(W<Z&&(Z=W),te<Z&&(Z=te),Z===0)break e;n.arraySet(ie,N,K,Z,re),W-=Z,K+=Z,te-=Z,re+=Z,l.length-=Z;break}l.mode=12;break;case 17:for(;F<14;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(l.nlen=257+(31&P),P>>>=5,F-=5,l.ndist=1+(31&P),P>>>=5,F-=5,l.ncode=4+(15&P),P>>>=4,F-=4,286<l.nlen||30<l.ndist){S.msg="too many length or distance symbols",l.mode=30;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;F<3;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.lens[z[l.have++]]=7&P,P>>>=3,F-=3}for(;l.have<19;)l.lens[z[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,k={bits:l.lenbits},B=m(0,l.lens,0,19,l.lencode,0,l.work,k),l.lenbits=k.bits,B){S.msg="invalid code lengths set",l.mode=30;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;le=(p=l.lencode[P&(1<<l.lenbits)-1])>>>16&255,_e=65535&p,!((se=p>>>24)<=F);){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(_e<16)P>>>=se,F-=se,l.lens[l.have++]=_e;else{if(_e===16){for(f=se+2;F<f;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(P>>>=se,F-=se,l.have===0){S.msg="invalid bit length repeat",l.mode=30;break}o=l.lens[l.have-1],Z=3+(3&P),P>>>=2,F-=2}else if(_e===17){for(f=se+3;F<f;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}F-=se,o=0,Z=3+(7&(P>>>=se)),P>>>=3,F-=3}else{for(f=se+7;F<f;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}F-=se,o=0,Z=11+(127&(P>>>=se)),P>>>=7,F-=7}if(l.have+Z>l.nlen+l.ndist){S.msg="invalid bit length repeat",l.mode=30;break}for(;Z--;)l.lens[l.have++]=o}}if(l.mode===30)break;if(l.lens[256]===0){S.msg="invalid code -- missing end-of-block",l.mode=30;break}if(l.lenbits=9,k={bits:l.lenbits},B=m(C,l.lens,0,l.nlen,l.lencode,0,l.work,k),l.lenbits=k.bits,B){S.msg="invalid literal/lengths set",l.mode=30;break}if(l.distbits=6,l.distcode=l.distdyn,k={bits:l.distbits},B=m(I,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,k),l.distbits=k.bits,B){S.msg="invalid distances set",l.mode=30;break}if(l.mode=20,L===6)break e;case 20:l.mode=21;case 21:if(6<=W&&258<=te){S.next_out=re,S.avail_out=te,S.next_in=K,S.avail_in=W,l.hold=P,l.bits=F,d(S,q),re=S.next_out,ie=S.output,te=S.avail_out,K=S.next_in,N=S.input,W=S.avail_in,P=l.hold,F=l.bits,l.mode===12&&(l.back=-1);break}for(l.back=0;le=(p=l.lencode[P&(1<<l.lenbits)-1])>>>16&255,_e=65535&p,!((se=p>>>24)<=F);){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(le&&!(240&le)){for(ue=se,De=le,Ee=_e;le=(p=l.lencode[Ee+((P&(1<<ue+De)-1)>>ue)])>>>16&255,_e=65535&p,!(ue+(se=p>>>24)<=F);){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}P>>>=ue,F-=ue,l.back+=ue}if(P>>>=se,F-=se,l.back+=se,l.length=_e,le===0){l.mode=26;break}if(32&le){l.back=-1,l.mode=12;break}if(64&le){S.msg="invalid literal/length code",l.mode=30;break}l.extra=15&le,l.mode=22;case 22:if(l.extra){for(f=l.extra;F<f;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.length+=P&(1<<l.extra)-1,P>>>=l.extra,F-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;le=(p=l.distcode[P&(1<<l.distbits)-1])>>>16&255,_e=65535&p,!((se=p>>>24)<=F);){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(!(240&le)){for(ue=se,De=le,Ee=_e;le=(p=l.distcode[Ee+((P&(1<<ue+De)-1)>>ue)])>>>16&255,_e=65535&p,!(ue+(se=p>>>24)<=F);){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}P>>>=ue,F-=ue,l.back+=ue}if(P>>>=se,F-=se,l.back+=se,64&le){S.msg="invalid distance code",l.mode=30;break}l.offset=_e,l.extra=15&le,l.mode=24;case 24:if(l.extra){for(f=l.extra;F<f;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}l.offset+=P&(1<<l.extra)-1,P>>>=l.extra,F-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){S.msg="invalid distance too far back",l.mode=30;break}l.mode=25;case 25:if(te===0)break e;if(Z=q-te,l.offset>Z){if((Z=l.offset-Z)>l.whave&&l.sane){S.msg="invalid distance too far back",l.mode=30;break}ce=Z>l.wnext?(Z-=l.wnext,l.wsize-Z):l.wnext-Z,Z>l.length&&(Z=l.length),me=l.window}else me=ie,ce=re-l.offset,Z=l.length;for(te<Z&&(Z=te),te-=Z,l.length-=Z;ie[re++]=me[ce++],--Z;);l.length===0&&(l.mode=21);break;case 26:if(te===0)break e;ie[re++]=l.length,te--,l.mode=21;break;case 27:if(l.wrap){for(;F<32;){if(W===0)break e;W--,P|=N[K++]<<F,F+=8}if(q-=te,S.total_out+=q,l.total+=q,q&&(S.adler=l.check=l.flags?s(l.check,ie,q,re-q):a(l.check,ie,q,re-q)),q=te,(l.flags?P:u(P))!==l.check){S.msg="incorrect data check",l.mode=30;break}F=P=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;F<32;){if(W===0)break e;W--,P+=N[K++]<<F,F+=8}if(P!==(4294967295&l.total)){S.msg="incorrect length check",l.mode=30;break}F=P=0}l.mode=29;case 29:B=1;break e;case 30:B=-3;break e;case 31:return-4;case 32:default:return c}return S.next_out=re,S.avail_out=te,S.next_in=K,S.avail_in=W,l.hold=P,l.bits=F,(l.wsize||q!==S.avail_out&&l.mode<30&&(l.mode<27||L!==4))&&J(S,S.output,S.next_out,q-S.avail_out)?(l.mode=31,-4):(ee-=S.avail_in,q-=S.avail_out,S.total_in+=ee,S.total_out+=q,l.total+=q,l.wrap&&q&&(S.adler=l.check=l.flags?s(l.check,ie,q,S.next_out-q):a(l.check,ie,q,S.next_out-q)),S.data_type=l.bits+(l.last?64:0)+(l.mode===12?128:0)+(l.mode===20||l.mode===15?256:0),(ee==0&&q===0||L===4)&&B===y&&(B=-5),B)},r.inflateEnd=function(S){if(!S||!S.state)return c;var L=S.state;return L.window&&(L.window=null),S.state=null,y},r.inflateGetHeader=function(S,L){var l;return S&&S.state&&2&(l=S.state).wrap?((l.head=L).done=!1,y):c},r.inflateSetDictionary=function(S,L){var l,N=L.length;return S&&S.state?(l=S.state).wrap!==0&&l.mode!==11?c:l.mode===11&&a(1,L,N,0)!==l.check?-3:J(S,L,N,N)?(l.mode=31,-4):(l.havedict=1,y):c},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,r){var n=t("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],m=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(C,I,y,c,g,h,_,u){var v,E,x,b,R,T,U,M,G,J=u.bits,S=0,L=0,l=0,N=0,ie=0,K=0,re=0,W=0,te=0,P=0,F=null,ee=0,q=new n.Buf16(16),Z=new n.Buf16(16),ce=null,me=0;for(S=0;S<=15;S++)q[S]=0;for(L=0;L<c;L++)q[I[y+L]]++;for(ie=J,N=15;1<=N&&q[N]===0;N--);if(N<ie&&(ie=N),N===0)return g[h++]=20971520,g[h++]=20971520,u.bits=1,0;for(l=1;l<N&&q[l]===0;l++);for(ie<l&&(ie=l),S=W=1;S<=15;S++)if(W<<=1,(W-=q[S])<0)return-1;if(0<W&&(C===0||N!==1))return-1;for(Z[1]=0,S=1;S<15;S++)Z[S+1]=Z[S]+q[S];for(L=0;L<c;L++)I[y+L]!==0&&(_[Z[I[y+L]]++]=L);if(T=C===0?(F=ce=_,19):C===1?(F=a,ee-=257,ce=s,me-=257,256):(F=d,ce=m,-1),S=l,R=h,re=L=P=0,x=-1,b=(te=1<<(K=ie))-1,C===1&&852<te||C===2&&592<te)return 1;for(;;){for(U=S-re,G=_[L]<T?(M=0,_[L]):_[L]>T?(M=ce[me+_[L]],F[ee+_[L]]):(M=96,0),v=1<<S-re,l=E=1<<K;g[R+(P>>re)+(E-=v)]=U<<24|M<<16|G|0,E!==0;);for(v=1<<S-1;P&v;)v>>=1;if(v!==0?(P&=v-1,P+=v):P=0,L++,--q[S]==0){if(S===N)break;S=I[y+_[L]]}if(ie<S&&(P&b)!==x){for(re===0&&(re=ie),R+=l,W=1<<(K=S-re);K+re<N&&!((W-=q[K+re])<=0);)K++,W<<=1;if(te+=1<<K,C===1&&852<te||C===2&&592<te)return 1;g[x=P&b]=ie<<24|K<<16|R-h|0}}return P!==0&&(g[R+P]=S-re<<24|64<<16|0),u.bits=ie,0}},{"../utils/common":41}],51:[function(t,i,r){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,r){var n=t("../utils/common"),a=0,s=1;function d(p){for(var A=p.length;0<=--A;)p[A]=0}var m=0,C=29,I=256,y=I+1+C,c=30,g=19,h=2*y+1,_=15,u=16,v=7,E=256,x=16,b=17,R=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],U=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=new Array(2*(y+2));d(J);var S=new Array(2*c);d(S);var L=new Array(512);d(L);var l=new Array(256);d(l);var N=new Array(C);d(N);var ie,K,re,W=new Array(c);function te(p,A,z,V,D){this.static_tree=p,this.extra_bits=A,this.extra_base=z,this.elems=V,this.max_length=D,this.has_stree=p&&p.length}function P(p,A){this.dyn_tree=p,this.max_code=0,this.stat_desc=A}function F(p){return p<256?L[p]:L[256+(p>>>7)]}function ee(p,A){p.pending_buf[p.pending++]=255&A,p.pending_buf[p.pending++]=A>>>8&255}function q(p,A,z){p.bi_valid>u-z?(p.bi_buf|=A<<p.bi_valid&65535,ee(p,p.bi_buf),p.bi_buf=A>>u-p.bi_valid,p.bi_valid+=z-u):(p.bi_buf|=A<<p.bi_valid&65535,p.bi_valid+=z)}function Z(p,A,z){q(p,z[2*A],z[2*A+1])}function ce(p,A){for(var z=0;z|=1&p,p>>>=1,z<<=1,0<--A;);return z>>>1}function me(p,A,z){var V,D,H=new Array(_+1),X=0;for(V=1;V<=_;V++)H[V]=X=X+z[V-1]<<1;for(D=0;D<=A;D++){var j=p[2*D+1];j!==0&&(p[2*D]=ce(H[j]++,j))}}function se(p){var A;for(A=0;A<y;A++)p.dyn_ltree[2*A]=0;for(A=0;A<c;A++)p.dyn_dtree[2*A]=0;for(A=0;A<g;A++)p.bl_tree[2*A]=0;p.dyn_ltree[2*E]=1,p.opt_len=p.static_len=0,p.last_lit=p.matches=0}function le(p){8<p.bi_valid?ee(p,p.bi_buf):0<p.bi_valid&&(p.pending_buf[p.pending++]=p.bi_buf),p.bi_buf=0,p.bi_valid=0}function _e(p,A,z,V){var D=2*A,H=2*z;return p[D]<p[H]||p[D]===p[H]&&V[A]<=V[z]}function ue(p,A,z){for(var V=p.heap[z],D=z<<1;D<=p.heap_len&&(D<p.heap_len&&_e(A,p.heap[D+1],p.heap[D],p.depth)&&D++,!_e(A,V,p.heap[D],p.depth));)p.heap[z]=p.heap[D],z=D,D<<=1;p.heap[z]=V}function De(p,A,z){var V,D,H,X,j=0;if(p.last_lit!==0)for(;V=p.pending_buf[p.d_buf+2*j]<<8|p.pending_buf[p.d_buf+2*j+1],D=p.pending_buf[p.l_buf+j],j++,V===0?Z(p,D,A):(Z(p,(H=l[D])+I+1,A),(X=T[H])!==0&&q(p,D-=N[H],X),Z(p,H=F(--V),z),(X=U[H])!==0&&q(p,V-=W[H],X)),j<p.last_lit;);Z(p,E,A)}function Ee(p,A){var z,V,D,H=A.dyn_tree,X=A.stat_desc.static_tree,j=A.stat_desc.has_stree,Q=A.stat_desc.elems,he=-1;for(p.heap_len=0,p.heap_max=h,z=0;z<Q;z++)H[2*z]!==0?(p.heap[++p.heap_len]=he=z,p.depth[z]=0):H[2*z+1]=0;for(;p.heap_len<2;)H[2*(D=p.heap[++p.heap_len]=he<2?++he:0)]=1,p.depth[D]=0,p.opt_len--,j&&(p.static_len-=X[2*D+1]);for(A.max_code=he,z=p.heap_len>>1;1<=z;z--)ue(p,H,z);for(D=Q;z=p.heap[1],p.heap[1]=p.heap[p.heap_len--],ue(p,H,1),V=p.heap[1],p.heap[--p.heap_max]=z,p.heap[--p.heap_max]=V,H[2*D]=H[2*z]+H[2*V],p.depth[D]=(p.depth[z]>=p.depth[V]?p.depth[z]:p.depth[V])+1,H[2*z+1]=H[2*V+1]=D,p.heap[1]=D++,ue(p,H,1),2<=p.heap_len;);p.heap[--p.heap_max]=p.heap[1],function(oe,ye){var Je,Fe,Qe,pe,ut,bt,ke=ye.dyn_tree,Ut=ye.max_code,ur=ye.stat_desc.static_tree,pr=ye.stat_desc.has_stree,_r=ye.stat_desc.extra_bits,zt=ye.stat_desc.extra_base,et=ye.stat_desc.max_length,pt=0;for(pe=0;pe<=_;pe++)oe.bl_count[pe]=0;for(ke[2*oe.heap[oe.heap_max]+1]=0,Je=oe.heap_max+1;Je<h;Je++)et<(pe=ke[2*ke[2*(Fe=oe.heap[Je])+1]+1]+1)&&(pe=et,pt++),ke[2*Fe+1]=pe,Ut<Fe||(oe.bl_count[pe]++,ut=0,zt<=Fe&&(ut=_r[Fe-zt]),bt=ke[2*Fe],oe.opt_len+=bt*(pe+ut),pr&&(oe.static_len+=bt*(ur[2*Fe+1]+ut)));if(pt!==0){do{for(pe=et-1;oe.bl_count[pe]===0;)pe--;oe.bl_count[pe]--,oe.bl_count[pe+1]+=2,oe.bl_count[et]--,pt-=2}while(0<pt);for(pe=et;pe!==0;pe--)for(Fe=oe.bl_count[pe];Fe!==0;)Ut<(Qe=oe.heap[--Je])||(ke[2*Qe+1]!==pe&&(oe.opt_len+=(pe-ke[2*Qe+1])*ke[2*Qe],ke[2*Qe+1]=pe),Fe--)}}(p,A),me(H,he,p.bl_count)}function o(p,A,z){var V,D,H=-1,X=A[1],j=0,Q=7,he=4;for(X===0&&(Q=138,he=3),A[2*(z+1)+1]=65535,V=0;V<=z;V++)D=X,X=A[2*(V+1)+1],++j<Q&&D===X||(j<he?p.bl_tree[2*D]+=j:D!==0?(D!==H&&p.bl_tree[2*D]++,p.bl_tree[2*x]++):j<=10?p.bl_tree[2*b]++:p.bl_tree[2*R]++,H=D,he=(j=0)===X?(Q=138,3):D===X?(Q=6,3):(Q=7,4))}function B(p,A,z){var V,D,H=-1,X=A[1],j=0,Q=7,he=4;for(X===0&&(Q=138,he=3),V=0;V<=z;V++)if(D=X,X=A[2*(V+1)+1],!(++j<Q&&D===X)){if(j<he)for(;Z(p,D,p.bl_tree),--j!=0;);else D!==0?(D!==H&&(Z(p,D,p.bl_tree),j--),Z(p,x,p.bl_tree),q(p,j-3,2)):j<=10?(Z(p,b,p.bl_tree),q(p,j-3,3)):(Z(p,R,p.bl_tree),q(p,j-11,7));H=D,he=(j=0)===X?(Q=138,3):D===X?(Q=6,3):(Q=7,4)}}d(W);var k=!1;function f(p,A,z,V){q(p,(m<<1)+(V?1:0),3),function(D,H,X,j){le(D),j&&(ee(D,X),ee(D,~X)),n.arraySet(D.pending_buf,D.window,H,X,D.pending),D.pending+=X}(p,A,z,!0)}r._tr_init=function(p){k||(function(){var A,z,V,D,H,X=new Array(_+1);for(D=V=0;D<C-1;D++)for(N[D]=V,A=0;A<1<<T[D];A++)l[V++]=D;for(l[V-1]=D,D=H=0;D<16;D++)for(W[D]=H,A=0;A<1<<U[D];A++)L[H++]=D;for(H>>=7;D<c;D++)for(W[D]=H<<7,A=0;A<1<<U[D]-7;A++)L[256+H++]=D;for(z=0;z<=_;z++)X[z]=0;for(A=0;A<=143;)J[2*A+1]=8,A++,X[8]++;for(;A<=255;)J[2*A+1]=9,A++,X[9]++;for(;A<=279;)J[2*A+1]=7,A++,X[7]++;for(;A<=287;)J[2*A+1]=8,A++,X[8]++;for(me(J,y+1,X),A=0;A<c;A++)S[2*A+1]=5,S[2*A]=ce(A,5);ie=new te(J,T,I+1,y,_),K=new te(S,U,0,c,_),re=new te(new Array(0),M,0,g,v)}(),k=!0),p.l_desc=new P(p.dyn_ltree,ie),p.d_desc=new P(p.dyn_dtree,K),p.bl_desc=new P(p.bl_tree,re),p.bi_buf=0,p.bi_valid=0,se(p)},r._tr_stored_block=f,r._tr_flush_block=function(p,A,z,V){var D,H,X=0;0<p.level?(p.strm.data_type===2&&(p.strm.data_type=function(j){var Q,he=4093624447;for(Q=0;Q<=31;Q++,he>>>=1)if(1&he&&j.dyn_ltree[2*Q]!==0)return a;if(j.dyn_ltree[18]!==0||j.dyn_ltree[20]!==0||j.dyn_ltree[26]!==0)return s;for(Q=32;Q<I;Q++)if(j.dyn_ltree[2*Q]!==0)return s;return a}(p)),Ee(p,p.l_desc),Ee(p,p.d_desc),X=function(j){var Q;for(o(j,j.dyn_ltree,j.l_desc.max_code),o(j,j.dyn_dtree,j.d_desc.max_code),Ee(j,j.bl_desc),Q=g-1;3<=Q&&j.bl_tree[2*G[Q]+1]===0;Q--);return j.opt_len+=3*(Q+1)+5+5+4,Q}(p),D=p.opt_len+3+7>>>3,(H=p.static_len+3+7>>>3)<=D&&(D=H)):D=H=z+5,z+4<=D&&A!==-1?f(p,A,z,V):p.strategy===4||H===D?(q(p,2+(V?1:0),3),De(p,J,S)):(q(p,4+(V?1:0),3),function(j,Q,he,oe){var ye;for(q(j,Q-257,5),q(j,he-1,5),q(j,oe-4,4),ye=0;ye<oe;ye++)q(j,j.bl_tree[2*G[ye]+1],3);B(j,j.dyn_ltree,Q-1),B(j,j.dyn_dtree,he-1)}(p,p.l_desc.max_code+1,p.d_desc.max_code+1,X+1),De(p,p.dyn_ltree,p.dyn_dtree)),se(p),V&&le(p)},r._tr_tally=function(p,A,z){return p.pending_buf[p.d_buf+2*p.last_lit]=A>>>8&255,p.pending_buf[p.d_buf+2*p.last_lit+1]=255&A,p.pending_buf[p.l_buf+p.last_lit]=255&z,p.last_lit++,A===0?p.dyn_ltree[2*z]++:(p.matches++,A--,p.dyn_ltree[2*(l[z]+I+1)]++,p.dyn_dtree[2*F(A)]++),p.last_lit===p.lit_bufsize-1},r._tr_align=function(p){q(p,2,3),Z(p,E,J),function(A){A.bi_valid===16?(ee(A,A.bi_buf),A.bi_buf=0,A.bi_valid=0):8<=A.bi_valid&&(A.pending_buf[A.pending++]=255&A.bi_buf,A.bi_buf>>=8,A.bi_valid-=8)}(p)}},{"../utils/common":41}],53:[function(t,i,r){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,r){(function(n){(function(a,s){if(!a.setImmediate){var d,m,C,I,y=1,c={},g=!1,h=a.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(a);_=_&&_.setTimeout?_:a,d={}.toString.call(a.process)==="[object process]"?function(x){process.nextTick(function(){v(x)})}:function(){if(a.postMessage&&!a.importScripts){var x=!0,b=a.onmessage;return a.onmessage=function(){x=!1},a.postMessage("","*"),a.onmessage=b,x}}()?(I="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",E,!1):a.attachEvent("onmessage",E),function(x){a.postMessage(I+x,"*")}):a.MessageChannel?((C=new MessageChannel).port1.onmessage=function(x){v(x.data)},function(x){C.port2.postMessage(x)}):h&&"onreadystatechange"in h.createElement("script")?(m=h.documentElement,function(x){var b=h.createElement("script");b.onreadystatechange=function(){v(x),b.onreadystatechange=null,m.removeChild(b),b=null},m.appendChild(b)}):function(x){setTimeout(v,0,x)},_.setImmediate=function(x){typeof x!="function"&&(x=new Function(""+x));for(var b=new Array(arguments.length-1),R=0;R<b.length;R++)b[R]=arguments[R+1];var T={callback:x,args:b};return c[y]=T,d(y),y++},_.clearImmediate=u}function u(x){delete c[x]}function v(x){if(g)setTimeout(v,0,x);else{var b=c[x];if(b){g=!0;try{(function(R){var T=R.callback,U=R.args;switch(U.length){case 0:T();break;case 1:T(U[0]);break;case 2:T(U[0],U[1]);break;case 3:T(U[0],U[1],U[2]);break;default:T.apply(s,U)}})(b)}finally{u(x),g=!1}}}}function E(x){x.source===a&&typeof x.data=="string"&&x.data.indexOf(I)===0&&v(+x.data.slice(I.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof _t<"u"?_t:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Zi);var ra=Zi.exports;const li=Cr(ra);class st{constructor(e,t,i){this.errorCode=e,this.fileSystemItem=t,this.errorText=i}}var ge={NoAccess:0,FileExists:1,FileNotFound:2,DirectoryExists:3,DirectoryNotFound:4,WrongFileExtension:5,MaxFileSizeExceeded:6,InvalidSymbols:7,Other:32767},Dt=Ge();class di extends Ct{constructor(e){e=ve(e,{}),super(e);var t=e.data;if(t&&!Array.isArray(t))throw yr.Error("E4006");var i=e.itemsExpr||"items";this._subFileItemsGetter=Pe(i),this._subFileItemsSetter=this._getSetter(i);var r=e.contentExpr||"content";this._contentGetter=Pe(r),this._contentSetter=this._getSetter(r);var n=this._getNameExpr(e);this._nameSetter=this._getSetter(n);var a=this._getIsDirExpr(e);this._getIsDirSetter=this._getSetter(a);var s=this._getKeyExpr(e);this._keySetter=this._getSetter(s);var d=this._getSizeExpr(e);this._sizeSetter=this._getSetter(d);var m=this._getDateModifiedExpr(e);this._dateModifiedSetter=this._getSetter(m),this._data=t||[]}getItems(e){return this._executeActionAsDeferred(()=>this._getItems(e),!0)}renameItem(e,t){return this._executeActionAsDeferred(()=>this._renameItemCore(e,t))}_renameItemCore(e,t){if(e){var i=this._findDataObject(e);this._nameSetter(i,t),e.name=t,e.key=this._ensureDataObjectKey(i)}}createDirectory(e,t){return this._executeActionAsDeferred(()=>{this._validateDirectoryExists(e),this._createDataObject(e,t,!0)})}deleteItems(e){return e.map(t=>this._executeActionAsDeferred(()=>this._deleteItem(t)))}moveItems(e,t){var i=this._findDataObject(t),r=this._getDirectoryDataItems(i),n=e.map(a=>this._executeActionAsDeferred(()=>{this._checkAbilityToMoveOrCopyItem(a,t);var s=this._findDataObject(a);this._deleteItem(a),r.push(s)}));return n}copyItems(e,t){var i=this._findDataObject(t),r=this._getDirectoryDataItems(i),n=e.map(a=>this._executeActionAsDeferred(()=>{this._checkAbilityToMoveOrCopyItem(a,t);var s=this._findDataObject(a),d=this._createCopy(s);r.push(d)}));return n}uploadFileChunk(e,t,i){if(t.chunkIndex>0)return t.customData.deferred;this._validateDirectoryExists(i);var r=t.customData.deferred=new ae,n=this._createFileReader();return n.readAsDataURL(e),n.onload=()=>{var a=n.result.split(",")[1],s=this._createDataObject(i,e.name,!1);this._sizeSetter(s,e.size),this._dateModifiedSetter(s,e.lastModifiedDate),this._contentSetter(s,a),r.resolve()},n.onerror=a=>r.reject(a),r}downloadItems(e){e.length===1?this._downloadSingleFile(e[0]):this._downloadMultipleFiles(e)}_downloadSingleFile(e){for(var t=this._getFileContent(e),i=Dt.atob(t),r=new ArrayBuffer(i.length),n=new Uint8Array(r),a=0;a<i.length;a++)n[a]=i.charCodeAt(a);var s=new Dt.Blob([r],{type:"application/octet-stream"});qt.saveAs(e.name,null,s)}_downloadMultipleFiles(e){var t=na(),i=new t;e.forEach(a=>i.file(a.name,this._getFileContent(a),{base64:!0}));var r={type:"blob",compression:"DEFLATE",mimeType:"application/zip"},n=new ae;i.generateAsync?i.generateAsync(r).then(n.resolve):n.resolve(i.generate(r)),n.done(a=>qt.saveAs("files.zip",null,a))}_getFileContent(e){var t=this._findDataObject(e);return this._contentGetter(t)||""}_validateDirectoryExists(e){if(!this._isFileItemExists(e)||this._isDirGetter(e.fileItem))throw new st(ge.DirectoryNotFound,e)}_checkAbilityToMoveOrCopyItem(e,t){var i=this._findDataObject(e),r=this._getKeyFromDataObject(i,e.parentPath),n=t.getFullPathInfo(),a="";n.forEach(s=>{a=Oe(a,s.name);var d=this._getDataObjectKey(s.key,a);if(d===r)throw new st(ge.Other,e)})}_createDataObject(e,t,i){var r={};this._nameSetter(r,t),this._getIsDirSetter(r,i),this._keySetter(r,String(new Re));var n=this._findDataObject(e),a=this._getDirectoryDataItems(n);return a.push(r),r}_createCopy(e){var t={};this._nameSetter(t,this._nameGetter(e)),this._getIsDirSetter(t,this._isDirGetter(e));var i=this._subFileItemsGetter(e);if(Array.isArray(i)){var r=[];i.forEach(n=>{var a=this._createCopy(n);r.push(a)}),this._subFileItemsSetter(t,r)}return t}_deleteItem(e){var t=this._findDataObject(e),i=this._findFileItemObj(e.pathInfo),r=this._getDirectoryDataItems(i),n=r.indexOf(t);r.splice(n,1)}_getDirectoryDataItems(e){if(!e)return this._data;var t=this._subFileItemsGetter(e);return Array.isArray(t)||(t=[],this._subFileItemsSetter(e,t)),t}_getItems(e){this._validateDirectoryExists(e);var t=e.getFullPathInfo(),i=t&&t.length>0?t[t.length-1].key:null,r=this._data;if(i){var n=this._findFileItemObj(t);r=n&&this._subFileItemsGetter(n)||[]}return this._ensureKeysForDuplicateNameItems(r),this._convertDataObjectsToFileItems(r,t)}_ensureKeysForDuplicateNameItems(e){var t={};e.forEach(i=>{var r=this._nameGetter(i);t[r]?this._ensureDataObjectKey(i):t[r]=!0})}_findDataObject(e){if(e.isRoot())return null;var t=this._findFileItemObj(e.getFullPathInfo());if(!t){var i=e.isDirectory?ge.DirectoryNotFound:ge.FileNotFound;throw new st(i,e)}return t}_findFileItemObj(e){var t=this;Array.isArray(e)||(e=[]);for(var i="",r=null,n=this._data,a=function(d){r=n.find(m=>{var C=t._isDirGetter(m)||d===e.length-1;return t._getKeyFromDataObject(m,i)===e[d].key&&t._nameGetter(m)===e[d].name&&C}),r&&(i=Oe(i,t._nameGetter(r)),n=t._subFileItemsGetter(r))},s=0;s<e.length&&(s===0||r);s++)a(s);return r}_getKeyFromDataObject(e,t){var i=this._keyGetter(e),r=Oe(t,this._nameGetter(e));return this._getDataObjectKey(i,r)}_getDataObjectKey(e,t){return e||t}_ensureDataObjectKey(e){var t=this._keyGetter(e);return t||(t=String(new Re),this._keySetter(e,t)),t}_hasSubDirs(e){var t=ve(this._subFileItemsGetter(e),[]);if(!Array.isArray(t))return!0;for(var i=0;i<t.length;i++)if(this._isDirGetter(t[i])===!0)return!0;return!1}_getSetter(e){return Ie(e)?e:Sr(e)}_isFileItemExists(e){return e.isDirectory&&e.isRoot()||!!this._findFileItemObj(e.getFullPathInfo())}_createFileReader(){return new Dt.FileReader}}function na(){if(!li)throw br.Error("E1041","JSZip");return li}var aa=Ge(),sa="chunk",Me={GET_DIR_CONTENTS:"GetDirContents",CREATE_DIR:"CreateDir",RENAME:"Rename",MOVE:"Move",COPY:"Copy",REMOVE:"Remove",UPLOAD_CHUNK:"UploadChunk",ABORT_UPLOAD:"AbortUpload",DOWLOAD:"Download"},nt={GET:"GET",POST:"POST"};class oa extends Ct{constructor(e){e=ve(e,{}),super(e),this._endpointUrl=e.endpointUrl,this._beforeAjaxSend=e.beforeAjaxSend,this._beforeSubmit=e.beforeSubmit,this._requestHeaders=e.requestHeaders,this._hasSubDirsGetter=Pe(e.hasSubDirectoriesExpr||"hasSubDirectories")}getItems(e){var t=e.getFullPathInfo();return this._executeRequest(Me.GET_DIR_CONTENTS,{pathInfo:t}).then(i=>this._convertDataObjectsToFileItems(i.result,t))}renameItem(e,t){return this._executeRequest(Me.RENAME,{pathInfo:e.getFullPathInfo(),isDirectory:e.isDirectory,name:t})}createDirectory(e,t){return this._executeRequest(Me.CREATE_DIR,{pathInfo:e.getFullPathInfo(),name:t})}deleteItems(e){return e.map(t=>this._executeRequest(Me.REMOVE,{pathInfo:t.getFullPathInfo(),isDirectory:t.isDirectory}))}moveItems(e,t){return e.map(i=>this._executeRequest(Me.MOVE,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()}))}copyItems(e,t){return e.map(i=>this._executeRequest(Me.COPY,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()}))}uploadFileChunk(e,t,i){t.chunkIndex===0&&(t.customData.uploadId=new Re);var r={destinationPathInfo:i.getFullPathInfo(),chunkMetadata:JSON.stringify({UploadId:t.customData.uploadId,FileName:e.name,Index:t.chunkIndex,TotalCount:t.chunkCount,FileSize:e.size})},n={url:this._endpointUrl,headers:this._requestHeaders||{},method:nt.POST,dataType:"json",data:{[sa]:t.chunkBlob,arguments:JSON.stringify(r),command:Me.UPLOAD_CHUNK},upload:{onprogress:Te,onloadstart:Te,onabort:Te},xhrFields:{},cache:!1},a=new ae;return this._beforeSendInternal(n),at.sendRequest(n).done(s=>{!s.success&&a.reject(s)||a.resolve()}).fail(a.reject),a.promise()}abortFileUpload(e,t,i){return this._executeRequest(Me.ABORT_UPLOAD,{uploadId:t.customData.uploadId})}downloadItems(e){var t=this._getDownloadArgs(e),i=O("<form>").css({display:"none"}).attr({method:nt.POST,action:t.url}),r={command:t.command,arguments:t.arguments};this._beforeSubmitInternal(r),this._appendFormDataInputsToForm(r,i),i.appendTo("body"),de.trigger(i,"submit"),setTimeout(()=>i.remove())}getItemsContent(e){var t=this._getDownloadArgs(e),i={url:t.url,headers:this._requestHeaders||{},method:nt.POST,responseType:"arraybuffer",data:{command:t.command,arguments:t.arguments},upload:{onprogress:Te,onloadstart:Te,onabort:Te},xhrFields:{},cache:!1};return this._beforeSendInternal(i),at.sendRequest(i)}_getDownloadArgs(e){var t=e.map(n=>n.getFullPathInfo()),i={pathInfoList:t},r=JSON.stringify(i);return{url:this._endpointUrl,arguments:r,command:Me.DOWLOAD}}_getItemsIds(e){return e.map(t=>t.relativeName)}_executeRequest(e,t){var i=e===Me.GET_DIR_CONTENTS?nt.GET:nt.POST,r=new ae,n={url:this._getEndpointUrl(e,t),headers:this._requestHeaders||{},method:i,dataType:"json",data:{},xhrFields:{},cache:!1};return this._beforeSendInternal(n),at.sendRequest(n).then(a=>{!a.success&&r.reject(a)||r.resolve(a)},a=>r.reject(a)),r.promise()}_beforeSubmitInternal(e){Ie(this._beforeSubmit)&&this._beforeSubmit({formData:e})}_beforeSendInternal(e){if(Ie(this._beforeAjaxSend)){var t={headers:e.headers,formData:e.data,xhrFields:e.xhrFields};this._beforeAjaxSend(t),e.headers=t.headers,e.data=t.formData,e.xhrFields=t.xhrFields}Pi(e.data)?delete e.data:(e.responseType||e.upload)&&(e.data=this._createFormData(e.data))}_createFormData(e){var t=new aa.FormData;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&ne(e[i])&&t.append(i,e[i]);return t}_appendFormDataInputsToForm(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&ne(e[i])&&O("<input>").attr({type:"hidden",name:i,value:e[i]}).appendTo(t)}_getEndpointUrl(e,t){var i=this._getQueryString({command:e,arguments:JSON.stringify(t)}),r=this._endpointUrl&&this._endpointUrl.indexOf("?")>0?"&":"?";return this._endpointUrl+r+i}_getQueryString(e){for(var t=[],i=Object.keys(e),r=0;r<i.length;r++){var n=i[r],a=e[n];if(a!==void 0)if(a===null&&(a=""),Array.isArray(a))this._processQueryStringArrayParam(n,a,t);else{var s=this._getQueryStringPair(n,a);t.push(s)}}return t.join("&")}_processQueryStringArrayParam(e,t,i){Ae(t,(r,n)=>{var a=this._getQueryStringPair(e,n);i.push(a)})}_getQueryStringPair(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}_hasSubDirs(e){var t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}}class qi extends Ct{constructor(e){e=ve(e,{}),super(e),this._hasSubDirsGetter=Pe(e.hasSubDirectoriesExpr||"hasSubDirectories"),this._getItemsFunction=this._ensureFunction(e.getItems,()=>[]),this._renameItemFunction=this._ensureFunction(e.renameItem),this._createDirectoryFunction=this._ensureFunction(e.createDirectory),this._deleteItemFunction=this._ensureFunction(e.deleteItem),this._moveItemFunction=this._ensureFunction(e.moveItem),this._copyItemFunction=this._ensureFunction(e.copyItem),this._uploadFileChunkFunction=this._ensureFunction(e.uploadFileChunk),this._abortFileUploadFunction=this._ensureFunction(e.abortFileUpload),this._downloadItemsFunction=this._ensureFunction(e.downloadItems),this._getItemsContentFunction=this._ensureFunction(e.getItemsContent)}getItems(e){var t=e.getFullPathInfo();return this._executeActionAsDeferred(()=>this._getItemsFunction(e),!0).then(i=>this._convertDataObjectsToFileItems(i,t))}renameItem(e,t){return this._executeActionAsDeferred(()=>this._renameItemFunction(e,t))}createDirectory(e,t){return this._executeActionAsDeferred(()=>this._createDirectoryFunction(e,t))}deleteItems(e){return e.map(t=>this._executeActionAsDeferred(()=>this._deleteItemFunction(t)))}moveItems(e,t){return e.map(i=>this._executeActionAsDeferred(()=>this._moveItemFunction(i,t)))}copyItems(e,t){return e.map(i=>this._executeActionAsDeferred(()=>this._copyItemFunction(i,t)))}uploadFileChunk(e,t,i){return this._executeActionAsDeferred(()=>this._uploadFileChunkFunction(e,t,i))}abortFileUpload(e,t,i){return this._executeActionAsDeferred(()=>this._abortFileUploadFunction(e,t,i))}downloadItems(e){return this._executeActionAsDeferred(()=>this._downloadItemsFunction(e))}getItemsContent(e){return this._executeActionAsDeferred(()=>this._getItemsContentFunction(e))}_hasSubDirs(e){var t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}_ensureFunction(e,t){return t=t||Te,Ie(e)?e:t}}var hi="Files",Xe={NAVIGATION:"navigation",REFRESH:"refresh"};class la{constructor(e){e=e||{},this._options=Y({},e),this._isInitialized=!1,this._dataLoading=!1,this._dataLoadingDeferred=null,this._rootDirectoryInfo=this._createRootDirectoryInfo(e.rootText),this._currentDirectoryInfo=this._rootDirectoryInfo,this._defaultIconMap=this._createDefaultIconMap(),this.startSingleLoad(),this._setSecurityController(),this._setProvider(e.fileProvider),this._initialize()}_initialize(){var e=this._options.currentPathKeys&&this._options.currentPathKeys.length?this.setCurrentPathByKeys(this._options.currentPathKeys):this.setCurrentPath(this._options.currentPath),t=()=>{this._isInitialized=!0,this._raiseInitialized()};e?fe(e).always(t):t()}_setSecurityController(){this._securityController=new da({allowedFileExtensions:this._options.allowedFileExtensions,maxFileSize:this._options.uploadMaxFileSize}),this._resetState()}setAllowedFileExtensions(e){ne(e)&&(this._options.allowedFileExtensions=e),this._setSecurityController(),this.refresh()}setUploadOptions(e){var{maxFileSize:t,chunkSize:i}=e;ne(i)&&(this._options.uploadChunkSize=i),ne(t)&&(this._options.uploadMaxFileSize=t,this._setSecurityController(),this.refresh())}_setProvider(e){this._fileProvider=this._createFileProvider(e),this._resetState()}updateProvider(e,t){return ne(t)?fe(this._getDirectoryByPathParts(this._rootDirectoryInfo,t,!0)).then(i=>{i!==this._rootDirectoryInfo&&this._resetCurrentDirectory(),this._setProvider(e)}).then(()=>this.setCurrentPathByKeys(t)):this._updateProviderOnly(e)}_updateProviderOnly(e){return this._resetCurrentDirectory(),this._setProvider(e),fe(this.refresh())}_createFileProvider(e){if(e||(e=[]),Array.isArray(e))return new di({data:e});if(e instanceof Ct)return e;switch(e.type){case"remote":return new oa(e);case"custom":return new qi(e)}return new di(e)}setCurrentPath(e){var t=ji(e),i=Oe(...t);return this.getCurrentDirectory().fileItem.relativeName===i?new ae().resolve().promise():this._setCurrentDirectoryByPathParts(t)}setCurrentPathByKeys(e){return Oi(this.getCurrentDirectory().fileItem.pathKeys,e)?new ae().resolve().promise():this._setCurrentDirectoryByPathParts(e,!0)}getCurrentPath(){for(var e="",t=this.getCurrentDirectory();t&&!t.fileItem.isRoot();){var i=Lt(t.fileItem.name);e=Oe(i,e),t=t.parentDirectory}return e}getCurrentPathKeys(){return this.getCurrentDirectory().fileItem.pathKeys}getCurrentDirectory(){return this._currentDirectoryInfo}setCurrentDirectory(e,t){if(e){if(t&&(e=this._getActualDirectoryInfo(e)),this._currentDirectoryInfo&&this._currentDirectoryInfo===e){this._raisePathPotentiallyChanged();return}var i=this._currentDirectoryInfo.fileItem.key!==e.fileItem.key;this._currentDirectoryInfo=e,i&&this._isInitialized&&(this._dataLoading||this._raiseDataLoading(Xe.NAVIGATION),this._raiseSelectedDirectoryChanged(e))}}_resetCurrentDirectory(){this._currentDirectoryInfo=this._rootDirectoryInfo}getCurrentItems(e){return this._dataLoadingDeferred?this._dataLoadingDeferred.then(()=>this._getCurrentItemsInternal(e)):this._getCurrentItemsInternal(e)}_getCurrentItemsInternal(e){var t=this.getCurrentDirectory(),i=this.getDirectoryContents(t);return i.then(r=>{var n=this._separateItemsByType(r);return t.fileItem.hasSubDirectories=!!n.folders.length,e?n.files:r})}getDirectories(e,t){return this.getDirectoryContents(e,t).then(i=>i.filter(r=>r.fileItem.isDirectory))}_separateItemsByType(e){var t=[],i=[];return e.forEach(r=>r.fileItem.isDirectory?t.push(r):i.push(r)),{folders:t,files:i}}getDirectoryContents(e,t){if(!e)return new ae().resolve([this._rootDirectoryInfo]).promise();if(e.itemsLoaded)return new ae().resolve(e.items).promise();if(this._singleOperationLockId&&e.itemsSingleLoadErrorId===this._singleOperationLockId)return this._changeDirectoryOnError(e,t,!0),new ae().reject().promise();var i=e.getInternalKey(),r=this._loadedItems[i];return r||(r=this._getFileItems(e,t).then(n=>(n=n||[],e.items=n.map(a=>a.isDirectory&&this._createDirectoryInfo(a,e)||this._createFileInfo(a,e)),e.itemsLoaded=!0,e.items),()=>(this._singleOperationLockId&&e.itemsSingleLoadErrorId!==this._singleOperationLockId&&(e.itemsSingleLoadErrorId=this._singleOperationLockId),[])),this._loadedItems[i]=r,r.always(()=>{delete this._loadedItems[i]}),r)}_getFileItems(e,t){var i=null;try{i=this._fileProvider.getItems(e.fileItem)}catch(r){return this._handleItemLoadError(e,r,t)}return fe(i).then(r=>this._securityController.getAllowedItems(r),r=>this._handleItemLoadError(e,r,t))}createDirectory(e,t){var i=e.fileItem,r=this._createDirInfoByName(t,e),n=this._createEditActionInfo("create",r,e);return this._processEditAction(n,a=>{a.parentDirectory=i,a.name=t,this._editingEvents.onDirectoryCreating(a)},()=>this._fileProvider.createDirectory(i,t).done(a=>(i.isRoot()||(i.hasSubDirectories=!0),a)),()=>{var a={parentDirectory:i,name:t};this._editingEvents.onDirectoryCreated(a)},()=>this._resetDirectoryState(e,!0))}renameItem(e,t){var i=e.fileItem.createClone(),r=this._createEditActionInfo("rename",e,e.parentDirectory,{itemNewName:t});return this._processEditAction(r,(n,a)=>{a.fileItem.isDirectory||this._securityController.validateExtension(t),n.item=i,n.newName=t,this._editingEvents.onItemRenaming(n)},n=>this._fileProvider.renameItem(n,t),()=>{var n={sourceItem:i,itemName:t};this._editingEvents.onItemRenamed(n)},()=>{var n=this._getActualDirectoryInfo(e.parentDirectory);this._resetDirectoryState(n),this.setCurrentDirectory(n)})}moveItems(e,t){var i=this._createEditActionInfo("move",e,t);return this._processEditAction(i,(r,n)=>{r.item=n.fileItem,r.destinationDirectory=t.fileItem,this._editingEvents.onItemMoving(r)},r=>this._fileProvider.moveItems([r],t.fileItem),r=>{var n={sourceItem:r.fileItem,parentDirectory:t.fileItem,itemName:r.fileItem.name,itemPath:Oe(t.fileItem.path,r.fileItem.name)};this._editingEvents.onItemMoved(n)},r=>{e.forEach(n=>this._resetDirectoryState(n.parentDirectory,!0)),r&&(this._resetDirectoryState(t),this.setCurrentPathByKeys(t.fileItem.pathKeys),t.expanded=!0)})}copyItems(e,t){var i=this._createEditActionInfo("copy",e,t);return this._processEditAction(i,(r,n)=>{r.item=n.fileItem,r.destinationDirectory=t.fileItem,this._editingEvents.onItemCopying(r)},r=>this._fileProvider.copyItems([r],t.fileItem),r=>{var n={sourceItem:r.fileItem,parentDirectory:t.fileItem,itemName:r.fileItem.name,itemPath:Oe(t.fileItem.path,r.fileItem.name)};this._editingEvents.onItemCopied(n)},r=>{r&&(t=this._getActualDirectoryInfo(t),this._resetDirectoryState(t),this.setCurrentDirectory(t),t.expanded=!0)})}deleteItems(e){var t=e.length>0?e[0].parentDirectory:null,i=this._createEditActionInfo("delete",e,t);return this._processEditAction(i,(r,n)=>{r.item=n.fileItem,this._editingEvents.onItemDeleting(r)},r=>this._fileProvider.deleteItems([r]),r=>this._editingEvents.onItemDeleted({item:r.fileItem}),()=>{e.forEach(r=>{var n=this._getActualDirectoryInfo(r.parentDirectory);this._resetDirectoryState(n),this.setCurrentDirectory(n)})})}processUploadSession(e,t){var i=this._getItemInfosForUploaderFiles(e.files,t),r=this._createEditActionInfo("upload",i,t,{sessionInfo:e});return this._processEditAction(r,()=>{},(n,a)=>e.deferreds[a],()=>{},()=>this._resetDirectoryState(t,!0))}uploadFileChunk(e,t,i){var r=null;t.chunkIndex===0?(this._securityController.validateMaxFileSize(e.size),this._securityController.validateExtension(e.name),r=this._processBeforeItemEditAction(a=>{a.fileData=e,a.destinationDirectory=i,this._editingEvents.onFileUploading(a)})):r=new ae().resolve().promise();var n=r.then(()=>this._fileProvider.uploadFileChunk(e,t,i));return t.chunkIndex===t.chunkCount-1&&(n=n.done(()=>{var a={fileData:e,parentDirectory:i};this._editingEvents.onFileUploaded(a)})),n}abortFileUpload(e,t,i){return fe(this._fileProvider.abortFileUpload(e,t,i))}getFileUploadChunkSize(){var e=this._options.uploadChunkSize;return e&&e>0?e:this._fileProvider.getFileUploadChunkSize()}downloadItems(e){var t=e.map(i=>this._processBeforeItemEditAction(r=>{r.item=i.fileItem,this._editingEvents.onItemDownloading(r)},i));return fe(...t).then(()=>{var i=e.map(r=>r.fileItem);return fe(this._getItemActionResult(this._fileProvider.downloadItems(i))).then(()=>{},r=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,r)})},i=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,i)})}getItemContent(e){var t=e.map(i=>i.fileItem);return fe(this._fileProvider.getItemsContent(t))}_handleItemLoadError(e,t,i){return e=this._getActualDirectoryInfo(e),this._raiseGetItemsError(e,t),this._changeDirectoryOnError(e,i),new ae().reject().promise()}_raiseGetItemsError(e,t){var i=this._createEditActionInfo("getItems",e,e);this._raiseEditActionStarting(i),this._raiseEditActionResultAcquired(i),this._raiseEditActionError(i,{errorCode:t.errorCode,errorText:t.errorText,fileItem:e.fileItem,index:0})}_raiseDownloadItemsError(e,t,i){var r=this._createEditActionInfo("download",e,t),n=e.length;r.singleRequest=n===1,this._raiseEditActionStarting(r),this._raiseEditActionResultAcquired(r);for(var a=0;a<n-1;a++)this._raiseEditActionItemError(r,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[a].fileItem,index:a});this._raiseEditActionError(r,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[n-1].fileItem,index:n-1})}_changeDirectoryOnError(e,t,i){i&&(e=this._getActualDirectoryInfo(e)),this._resetDirectoryState(e),e.expanded=!1,t||this.setCurrentDirectory(e.parentDirectory)}_getItemActionResult(e){return Array.isArray(e)?e[0]:e}_processEditAction(e,t,i,r,n){var a=!1;this._raiseEditActionStarting(e);var s=e.itemInfos.map((d,m)=>this._processBeforeItemEditAction(t,d).then(()=>{var C=this._getItemActionResult(i(d.fileItem,m));return C.done(()=>r(d))}));return e.singleRequest=s.length===1,this._raiseEditActionResultAcquired(e),Ot(s,d=>{a=!0,this._raiseCompleteEditActionItem(e,d)},d=>this._raiseEditActionItemError(e,d)).then(()=>{n(a),this._raiseCompleteEditAction(e)})}_createEditActionInfo(e,t,i,r){t=Array.isArray(t)?t:[t],r=r||{};var n=t.map(a=>a.fileItem);return{name:e,itemInfos:t,items:n,directory:i,customData:r,singleRequest:!0}}_processBeforeItemEditAction(e,t){var i=new ae,r=this._createBeforeActionArgs();try{e(r,t)}catch(n){return i.reject(n).promise()}if(!r.cancel)i.resolve();else{if(r.cancel===!0)return i.reject({errorText:r.errorText,errorCode:r.errorCode});Ti(r.cancel)&&fe(r.cancel).then(n=>{n===!0?i.reject():Er(n)&&n.cancel===!0&&i.reject({errorText:n.errorText,errorCode:n.errorCode}),i.resolve()},i.resolve)}return i.promise()}_createBeforeActionArgs(){return{errorCode:void 0,errorText:"",cancel:!1}}_getItemInfosForUploaderFiles(e,t){for(var i=this._getPathInfo(t),r=[],n=0;n<e.length;n++){var a=e[n],s=new qe(i,a.name,!1),d=this._createFileInfo(s,t);r.push(d)}return r}refresh(){return this._lockRefresh?this._refreshDeferred:(this._lockRefresh=!0,this._executeDataLoad(()=>this._refreshDeferred=this._refreshInternal(),Xe.REFRESH))}startSingleLoad(){this._singleOperationLockId=new Re().toString()}endSingleLoad(){delete this._singleOperationLockId}_refreshInternal(){var e={items:this._rootDirectoryInfo.items},t=this._getDirectoryPathKeyParts(this.getCurrentDirectory());return this._resetDirectoryState(this._rootDirectoryInfo),this._loadItemsRecursive(this._rootDirectoryInfo,e).then(()=>{var i=this._findDirectoryByPathKeyParts(t);this.setCurrentDirectory(i),delete this._lockRefresh})}_loadItemsRecursive(e,t){var i=this;return this.getDirectories(e).then(r=>{for(var n=[],a=function(d){var m=t.items.find(C=>r[d].fileItem.key===C.fileItem.key);if(!m)return 1;r[d].expanded=m.expanded,r[d].expanded&&n.push(i._loadItemsRecursive(r[d],m))},s=0;s<r.length;s++)a(s);return Ot(n)},()=>null)}_setCurrentDirectoryByPathParts(e,t){return this._executeDataLoad(()=>this._setCurrentDirectoryByPathPartsInternal(e,t),Xe.NAVIGATION)}_setCurrentDirectoryByPathPartsInternal(e,t){return this._getDirectoryByPathParts(this._rootDirectoryInfo,e,t).then(i=>{for(var r=i.parentDirectory;r;r=r.parentDirectory)r.expanded=!0;this.setCurrentDirectory(i)},()=>{this._raisePathPotentiallyChanged()})}_executeDataLoad(e,t){return this._dataLoadingDeferred?this._dataLoadingDeferred.then(()=>this._executeDataLoad(e,t)):(this._dataLoading=!0,this._dataLoadingDeferred=new ae,this._isInitialized&&this._raiseDataLoading(t),e().always(()=>{var i=this._dataLoadingDeferred;this._dataLoadingDeferred=null,this._dataLoading=!1,i.resolve()}))}_getDirectoryByPathParts(e,t,i){if(t.length<1)return new ae().resolve(e).promise();var r=i?"key":"name";return this.getDirectories(e).then(n=>{var a=n.find(d=>d.fileItem[r]===t[0]);if(!a)return new ae().reject().promise();var s=[...t].splice(1);return this._getDirectoryByPathParts(a,s,i)})}_getDirectoryPathKeyParts(e){for(var t=[];e&&e.parentDirectory;)t.unshift(e.fileItem.key),e=e.parentDirectory;return t}_findDirectoryByPathKeyParts(e){var t=this._rootDirectoryInfo;if(e.length===0)return t;for(var i=0,r=t;r&&i<e.length;)r=t.items.find(n=>n.fileItem.key===e[i]),r&&(t=r),i++;return t}_getActualDirectoryInfo(e){var t=this._getDirectoryPathKeyParts(e);return this._findDirectoryByPathKeyParts(t)}_createDirInfoByName(e,t){var i=this._getPathInfo(t),r=new qe(i,e,!0);return this._createDirectoryInfo(r,t)}_createDirectoryInfo(e,t){return Y(this._createFileInfo(e,t),{icon:"folder",expanded:e.isRoot(),items:[]})}_createFileInfo(e,t){return{fileItem:e,parentDirectory:t,icon:this._getFileItemDefaultIcon(e),getInternalKey(){return"FIK_".concat(this.fileItem.key)},getDisplayName(){return this.displayName||this.fileItem.name}}}_resetDirectoryState(e,t){t&&(e=this._getActualDirectoryInfo(e)),e.itemsLoaded=!1,e.items=[]}_getFileItemDefaultIcon(e){if(e.isDirectory)return"folder";var t=e.getFileExtension(),i=this._defaultIconMap[t];return i||"doc"}_createDefaultIconMap(){var e={".txt":"txtfile",".rtf":"rtffile",".doc":"docfile",".docx":"docxfile",".xls":"xlsfile",".xlsx":"xlsxfile",".ppt":"pptfile",".pptx":"pptxfile",".pdf":"pdffile"};return[".png",".gif",".jpg",".jpeg",".ico",".bmp"].forEach(t=>{e[t]="image"}),e}_createRootDirectoryInfo(e){var t=new qe(null,"",!0),i=this._createDirectoryInfo(t,null);return i.displayName=e||hi,i}setRootText(e){this._rootDirectoryInfo.displayName=e||hi}_raiseInitialized(){this._tryCallAction("onInitialized",{controller:this})}_raiseDataLoading(e){this._tryCallAction("onDataLoading",{operation:e})}_raiseSelectedDirectoryChanged(e){this._tryCallAction("onSelectedDirectoryChanged",{selectedDirectoryInfo:e})}_raiseEditActionStarting(e){this._tryCallAction("onEditActionStarting",e)}_raiseEditActionResultAcquired(e){this._tryCallAction("onEditActionResultAcquired",e)}_raiseEditActionError(e,t){this._tryCallAction("onEditActionError",e,t)}_raiseEditActionItemError(e,t){this._tryCallAction("onEditActionItemError",e,t)}_raiseCompleteEditActionItem(e,t){this._tryCallAction("onCompleteEditActionItem",e,t)}_raiseCompleteEditAction(e){this._tryCallAction("onCompleteEditAction",e)}_raisePathPotentiallyChanged(){this._tryCallAction("onPathPotentiallyChanged")}_tryCallAction(e){var t=Array.prototype.slice.call(arguments,1);this._isInitialized&&this._options[e]&&this._options[e](...t)}_resetState(){this._selectedDirectory=null,this._rootDirectoryInfo.items=[],this._rootDirectoryInfo.itemsLoaded=!1,this._loadedItems={}}_getPathInfo(e){for(var t=[],i=e;i&&!i.fileItem.isRoot();i=i.parentDirectory)t.unshift({key:i.fileItem.key,name:i.fileItem.name});return t}on(e,t){var i="on".concat(e);this._options[i]=t}get _editingEvents(){return this._options.editingEvents}}class da{constructor(e){this._options=Y({allowedFileExtensions:[],maxFileSize:0},e),this._extensionsMap={},this._allowedFileExtensions.forEach(t=>{this._extensionsMap[t.toUpperCase()]=!0})}getAllowedItems(e){return this._allowedFileExtensions.length===0?e:e.filter(t=>t.isDirectory||this._isValidExtension(t.name))}validateExtension(e){if(!this._isValidExtension(e))throw new st(ge.WrongFileExtension,null)}validateMaxFileSize(e){if(this._maxFileSize&&e>this._maxFileSize)throw new st(ge.MaxFileSizeExceeded,null)}_isValidExtension(e){if(this._allowedFileExtensions.length===0)return!0;var t=Hi(e).toUpperCase();return this._extensionsMap[t]}get _allowedFileExtensions(){return this._options.allowedFileExtensions}get _maxFileSize(){return this._options.maxFileSize}}var Xi={create:!1,copy:!1,move:!1,delete:!1,rename:!1,upload:!1,download:!1};class ha{constructor(e){this._actions={},this._permissions=e||{},this._initCommands()}_initCommands(){this._commands=[{name:"create",text:$.format("dxFileManager-commandCreate"),icon:"newfolder",enabled:this._permissions.create,noFileItemRequired:!0},{name:"rename",text:$.format("dxFileManager-commandRename"),icon:"rename",enabled:this._permissions.rename,isSingleFileItemCommand:!0},{name:"move",text:$.format("dxFileManager-commandMove"),icon:"movetofolder",enabled:this._permissions.move},{name:"copy",text:$.format("dxFileManager-commandCopy"),icon:"copy",enabled:this._permissions.copy},{name:"delete",text:$.format("dxFileManager-commandDelete"),icon:"trash",enabled:this._permissions.delete},{name:"download",text:$.format("dxFileManager-commandDownload"),icon:"download",enabled:this._permissions.download},{name:"upload",text:$.format("dxFileManager-commandUpload"),icon:"upload",enabled:this._permissions.upload,noFileItemRequired:!0},{name:"refresh",text:$.format("dxFileManager-commandRefresh"),icon:"dx-filemanager-i dx-filemanager-i-refresh",enabled:!0,noFileItemRequired:!0},{name:"thumbnails",text:$.format("dxFileManager-commandThumbnails"),icon:"mediumiconslayout",enabled:!0,noFileItemRequired:!0},{name:"details",text:$.format("dxFileManager-commandDetails"),icon:"detailslayout",enabled:!0,noFileItemRequired:!0},{name:"clearSelection",text:$.format("dxFileManager-commandClearSelection"),icon:"remove",enabled:!0},{name:"showNavPane",hint:$.format("dxFileManager-commandShowNavPane"),icon:"menu",enabled:!1,noFileItemRequired:!0}],this._commandMap={},this._commands.forEach(e=>{this._commandMap[e.name]=e})}registerActions(e){this._actions=Y(this._actions,e)}executeCommand(e,t){var i=Le(e)?e:e.name,r=this._actions[i];if(r)return r(t)}updatePermissions(e){var t=Y({},Xi,e);this._permissions=t,Ae(this._permissions,i=>{this._commandMap[i].enabled=this._permissions[i]})}setCommandEnabled(e,t){var i=this.getCommandByName(e);i&&(i.enabled=t)}getCommandByName(e){return this._commandMap[e]}isCommandAvailable(e,t){var i=this.getCommandByName(e);if(!i||!i.enabled)return!1;if(i.noFileItemRequired)return!0;var r=t&&t.length||0;return r===0||t.some(n=>n.fileItem.isRoot()||n.fileItem.isParentFolder)?!1:e==="download"?t.every(n=>!n.fileItem.isDirectory):!i.isSingleFileItemCommand||r===1}}var ca="dx-filemanager-context-menu",ci={create:{},upload:{},download:{},rename:{},move:{},copy:{},delete:{},refresh:{beginGroup:!0}},ua=["beginGroup","closeMenuOnClick","disabled","icon","selectable","selected","text","visible"];class pa extends Ce{_initMarkup(){this._initActions(),this._isVisible=!1;var e=O("<div>").appendTo(this.$element());this._contextMenu=this._createComponent(e,Ar,{cssClass:ca,showEvent:"",onItemClick:t=>this._onContextMenuItemClick(t.itemData.name,t),onShowing:t=>this._onContextMenuShowing(t),onShown:()=>this._onContextMenuShown(),onHidden:()=>this._onContextMenuHidden()}),super._initMarkup()}showAt(e,t,i,r){var{itemData:n,itemElement:a,isActionButton:s=!1}=r;this._isVisible&&this._onContextMenuHidden(),this._menuShowingContext={targetElement:a,itemData:n,fileItems:e,event:i,isActionButton:s};var d={of:t,at:"top left",my:"top left",offset:""};i?d.offset=i.offsetX+" "+i.offsetY:(d.my="left top",d.at="left bottom",d.boundaryOffset="1"),this._contextMenu.option({target:t,position:d}),this._contextMenu.show()}createContextMenuItems(e,t,i){this._targetFileItems=e,this._targetFileItem=ne(i)?i:e==null?void 0:e[0];var r=[],n=t||this.option("items");return n.forEach(a=>{var s=Le(a)?a:a.name,d=this._configureItemByCommandName(s,a,e,this._targetFileItem);this._isContextMenuItemAvailable(d,e)&&r.push(d)}),r}_isContextMenuItemAvailable(e,t){return!this._isDefaultItem(e.name)||!e._autoHide?ve(e.visible,!0):this._isIsolatedCreationItemCommand(e.name)&&t&&t.length?!1:this._commandManager.isCommandAvailable(e.name,t)}_isIsolatedCreationItemCommand(e){return(e==="create"||e==="upload")&&this.option("isolateCreationItemCommands")}_isDefaultItem(e){return!!ci[e]}_configureItemByCommandName(e,t,i,r){if(!this._isDefaultItem(e)){var n=Y(!0,{},t);return n.originalItemData=t,this._addItemClickHandler(e,n),Array.isArray(t.items)&&(n.items=this.createContextMenuItems(i,t.items,r)),n}var a=this._createMenuItemByCommandName(e),s=ci[e];return Y(a,s),a.originalItemData=t,Ve(a,t,ua),ne(a.visible)||(a._autoHide=!0),e&&!a.name&&Y(a,{name:e}),a}_createMenuItemByCommandName(e){var{text:t,icon:i}=this._commandManager.getCommandByName(e),r={name:e,text:t,icon:i};return this._addItemClickHandler(e,r),r}_addItemClickHandler(e,t){t.onItemClick=i=>this._onContextMenuItemClick(e,i)}_onContextMenuItemClick(e,t){var i,r=Y(!0,{},t);if(r.itemData=t.itemData.originalItemData,r.fileSystemItem=(i=this._targetFileItem)===null||i===void 0?void 0:i.fileItem,r.viewArea=this.option("viewArea"),this._actions.onItemClick(r),this._isDefaultItem(e)){var n=this._isIsolatedCreationItemCommand(e)?null:this._targetFileItems;this._commandManager.executeCommand(e,n)}}_initActions(){this._actions={onContextMenuHidden:this._createActionByOption("onContextMenuHidden"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemClick:this._createActionByOption("onItemClick")}}_onContextMenuShowing(e){if(this._isVisible&&this._onContextMenuHidden(!0),e=Y(e,this._menuShowingContext,{options:this.option(),cancel:!1}),this._actions.onContextMenuShowing(e),!e.cancel){var t=this.createContextMenuItems(this._menuShowingContext.fileItems,null,this._menuShowingContext.fileSystemItem);this._contextMenu.option("dataSource",t)}}tryUpdateVisibleContextMenu(){if(this._isVisible){var e=this.createContextMenuItems(this._targetFileItems);this._contextMenu.option("dataSource",e)}}_onContextMenuShown(){this._isVisible=!0}_onContextMenuHidden(e){this._isVisible=!1,e||(this._menuShowingContext={}),this._contextMenu.option("visible",!1),this._raiseContextMenuHidden()}_raiseContextMenuHidden(){this._actions.onContextMenuHidden()}_getDefaultOptions(){return Y(super._getDefaultOptions(),{commandManager:null,onContextMenuHidden:null,onItemClick:null})}_optionChanged(e){var t=e.name;switch(t){case"commandManager":this.repaint();break;case"items":this.tryUpdateVisibleContextMenu();break;case"onItemClick":case"onContextMenuShowing":case"onContextMenuHidden":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _commandManager(){return this.option("commandManager")}}var _a="dx-filemanager-file-actions-button",ma="dx-filemanager-file-actions-button-activated",fa="dx-state-active";class Yi extends Ce{_initMarkup(){this._createClickAction();var e=O("<div>");this.$element().append(e).addClass(_a),this._button=this._createComponent(e,ze,{icon:"overflow",stylingMode:"text",onClick:t=>this._raiseClick(t)}),super._initMarkup()}_createClickAction(){this._clickAction=this._createActionByOption("onClick")}_raiseClick(e){this._clickAction(e)}_getDefaultOptions(){return Y(super._getDefaultOptions(),{cssClass:"",onClick:null})}_optionChanged(e){var t=e.name;switch(t){case"cssClass":this.repaint();break;case"onClick":this._createClickAction();break;default:super._optionChanged(e)}}setActive(e){this.$element().toggleClass(ma,e),setTimeout(()=>this._button.$element().toggleClass(fa,e))}}var ga="dx-filemanager-dirs-tree",ui="dx-filemanager-focused-item",va="dx-filemanager-dirs-tree-item-text",Ia="dx-treeview-item";class Ji extends Ce{_initMarkup(){this._initActions(),this._getCurrentDirectory=this.option("getCurrentDirectory"),this._createFileActionsButton=Te,this._storeExpandedState=this.option("storeExpandedState")||!1;var e=O("<div>").addClass(ga).appendTo(this.$element()),t={dataStructure:"plain",rootValue:"",createChildren:this._onFilesTreeViewCreateSubDirectories.bind(this),itemTemplate:this._createFilesTreeViewItemTemplate.bind(this),keyExpr:"getInternalKey",parentIdExpr:"parentDirectory.getInternalKey",displayExpr:i=>i.getDisplayName(),hasItemsExpr:"fileItem.hasSubDirectories",onItemClick:i=>this._actions.onDirectoryClick(i),onItemExpanded:i=>this._onFilesTreeViewItemExpanded(i),onItemCollapsed:i=>this._onFilesTreeViewItemCollapsed(i),onItemRendered:i=>this._onFilesTreeViewItemRendered(i),onContentReady:()=>this._actions.onFilesTreeViewContentReady()};this._contextMenu&&(this._contextMenu.option("onContextMenuHidden",()=>this._onContextMenuHidden()),t.onItemContextMenu=i=>this._onFilesTreeViewItemContextMenu(i),this._createFileActionsButton=(i,r)=>this._createComponent(i,Yi,r)),this._filesTreeView=this._createComponent(e,wr,t)}_initActions(){this._actions={onDirectoryClick:this._createActionByOption("onDirectoryClick"),onFilesTreeViewContentReady:this._createActionByOption("onFilesTreeViewContentReady")}}_render(){super._render();var e=this;setTimeout(()=>{e._updateFocusedElement()})}_onFilesTreeViewCreateSubDirectories(e){var t=this.option("getDirectories"),i=e&&e.itemData||null;return t&&t(i,!0)}_onFilesTreeViewItemRendered(e){var{itemData:t}=e,i=this._getCurrentDirectory();i&&i.fileItem.equals(t.fileItem)&&(this._updateFocusedElement(),this._restoreScrollTopPosition())}_onFilesTreeViewItemExpanded(e){var{itemData:t}=e;this._storeExpandedState&&(t.expanded=!0)}_onFilesTreeViewItemCollapsed(e){var{itemData:t}=e;this._storeExpandedState&&(t.expanded=!1)}_createFilesTreeViewItemTemplate(e,t,i){var r=O(i),n=r.closest(this._filesTreeViewItemSelector);n.data("item",e);var a=It(e.icon),s=O("<span>").text(e.getDisplayName()).addClass(va),d=O("<div>");r.append(a,s,d),this._createFileActionsButton(d,{onClick:m=>this._onFileItemActionButtonClick(m)})}_onFilesTreeViewItemContextMenu(e){var{itemElement:t,event:i}=e;i.preventDefault(),i.stopPropagation();var r=O(t).data("item");this._contextMenu.showAt([r],t,i,{itemData:r,itemElement:t})}_onFileItemActionButtonClick(e){var{component:t,element:i,event:r}=e;r.stopPropagation();var n=t.$element().closest(this._filesTreeViewItemSelector),a=n.data("item"),s={itemData:a,itemElement:n,isActionButton:!0};this._contextMenu.showAt([a],i,r,s),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}toggleNodeDisabledState(e,t){var i=this._getNodeByKey(e);if(i){var r=this._filesTreeView.option("items"),n=r.map(a=>a.getInternalKey()).indexOf(i.getInternalKey());n!==-1&&this._filesTreeView.option("items[".concat(n,"].disabled"),t)}}_saveScrollTopPosition(){Ke()&&(this._scrollTopPosition=this._filesTreeView.getScrollable().scrollTop())}_restoreScrollTopPosition(){!Ke()||!Fi(this._scrollTopPosition)||setTimeout(()=>this._filesTreeView.getScrollable().scrollTo(this._scrollTopPosition))}_updateFocusedElement(){var e=this._getCurrentDirectory(),t=this._getItemElementByKey(e==null?void 0:e.getInternalKey());this._$focusedElement&&this._$focusedElement.toggleClass(ui,!1),this._$focusedElement=t||O(),this._$focusedElement.toggleClass(ui,!0)}_getNodeByKey(e){var t;return(t=this._filesTreeView)===null||t===void 0?void 0:t._getNode(e)}_getPublicNode(e){for(var t,i=[...(t=this._filesTreeView)===null||t===void 0?void 0:t.getNodes()];i.length;){var r=i.shift();if(r.itemData.getInternalKey()===e)return r;r.children.length&&i.push(...r.children)}}_getItemElementByKey(e){var t=this._getNodeByKey(e);if(t){var i=this._filesTreeView._getNodeElement(t);if(i)return i.children(this._filesTreeViewItemSelector)}return null}_getDefaultOptions(){return Y(super._getDefaultOptions(),{storeExpandedState:!1,initialFolder:null,contextMenu:null,getItems:null,getCurrentDirectory:null,onDirectoryClick:null})}_optionChanged(e){var t=e.name;switch(t){case"storeExpandedState":this._storeExpandedState=this.option(t);break;case"getItems":case"rootFolderDisplayName":case"initialFolder":case"contextMenu":this.repaint();break;case"getCurrentDirectory":this.getCurrentDirectory=this.option(t);break;case"onDirectoryClick":case"onFilesTreeViewContentReady":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _filesTreeViewItemSelector(){return".".concat(Ia)}get _contextMenu(){return this.option("contextMenu")}toggleDirectoryExpandedState(e,t){var i=new ae,r=this._getPublicNode(e==null?void 0:e.getInternalKey());if(!r)return i.reject().promise();if(r.expanded===t||r.itemsLoaded&&!r.itemData.fileItem.hasSubDirectories)return i.resolve().promise();var n=t?"expandItem":"collapseItem";return this._filesTreeView[n](e.getInternalKey())}refresh(){this._$focusedElement=null,this._saveScrollTopPosition(),this._filesTreeView.option("dataSource",[])}updateCurrentDirectory(){this._disposed||(this._updateFocusedElement(),this._storeExpandedState&&this._updateExpandedStateToCurrentDirectory())}_updateExpandedStateToCurrentDirectory(){return this.toggleDirectoryExpandedStateRecursive(this._getCurrentDirectory().parentDirectory,!0)}toggleDirectoryExpandedStateRecursive(e,t){for(var i=[],r=e;r;r=r.parentDirectory)i.unshift(r);return this.toggleDirectoryLineExpandedState(i,t)}toggleDirectoryLineExpandedState(e,t){return e.length?this.toggleDirectoryExpandedState(e.shift(),t).then(()=>this.toggleDirectoryLineExpandedState(e,t)):new ae().resolve().promise()}}var Ca="dx-filemanager-files-view",ya="dxFileManager_open";class Qi extends Ce{_init(){this._initActions(),this._lockFocusedItemProcessing=!1,this._focusedItemKey=this.option("focusedItemKey"),super._init()}_initMarkup(){this._needResetScrollPosition=!1,this.$element().addClass(Ca);var e=we(xr,ya);de.on(this.$element(),e,this._getItemSelector(),this._onItemDblClick.bind(this)),super._initMarkup()}_initActions(){this._actions={onError:this._createActionByOption("onError"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onSelectedItemOpened:this._createActionByOption("onSelectedItemOpened"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemListDataLoaded:this._createActionByOption("onItemListDataLoaded")}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{selectionMode:"single",selectedItemKeys:[],focusedItemKey:void 0,contextMenu:null,getItems:null,getItemThumbnail:null,onError:null,onSelectionChanged:null,onFocusedItemChanged:null,onSelectedItemOpened:null,onContextMenuShowing:null})}_optionChanged(e){var t=e.name;switch(t){case"selectionMode":case"contextMenu":case"getItems":case"getItemThumbnail":this.repaint();break;case"selectedItemKeys":this._setSelectedItemKeys(e.value);break;case"focusedItemKey":this._lockFocusedItemProcessing||this._setFocusedItemKey(e.value);break;case"onError":case"onSelectedItemOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onContextMenuShowing":case"onItemListDataLoaded":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_getItems(){return this._getItemsInternal().done(e=>{this._itemCount=e.length,this._itemCount===0&&this._resetFocus();var t=this._findParentDirectoryItem(e);this._hasParentDirectoryItem=!!t,this._parentDirectoryItemKey=t?t.fileItem.key:null}).always(()=>{this._onDataLoaded()})}_getItemsInternal(){var e=this.option("getItems"),t=e?e():[];return fe(t)}_raiseOnError(e){this._actions.onError({error:e})}_raiseSelectionChanged(e){this._actions.onSelectionChanged(e)}_raiseFocusedItemChanged(e){this._actions.onFocusedItemChanged(e)}_raiseSelectedItemOpened(e){this._actions.onSelectedItemOpened({fileItemInfo:e})}_raiseContextMenuShowing(e){this._actions.onContextMenuShowing(e)}_raiseItemListDataLoaded(){this._actions.onItemListDataLoaded()}_onDataLoaded(){var e;this._raiseItemListDataLoaded(),(e=this._refreshDeferred)===null||e===void 0||e.resolve()}_onContentReady(){this._needResetScrollPosition&&(this._resetScrollTopPosition(),this._needResetScrollPosition=!1)}_tryRaiseSelectionChanged(e){var{selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:n,currentDeselectedItemKeys:a}=e,s=this._findParentDirectoryItem(this.getSelectedItems());s&&this._deselectItem(s);var d=!this._hasParentDirectoryItem;d=d||this._hasValidKeys(n)||this._hasValidKeys(a),d&&(t=this._filterOutItemByPredicate(t,m=>m.fileItem.key===this._parentDirectoryItemKey),i=this._filterOutParentDirectory(i),r=this._filterOutParentDirectoryKey(r,!0),n=this._filterOutParentDirectoryKey(n,!0),a=this._filterOutParentDirectoryKey(a,!0),this._raiseSelectionChanged({selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:n,currentDeselectedItemKeys:a}))}_onFocusedItemChanged(e){this._focusedItemKey!==e.itemKey&&(this._focusedItemKey=e.itemKey,this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_resetFocus(){}_resetScrollTopPosition(){Ke()&&setTimeout(()=>{var e;return(e=this._getScrollable())===null||e===void 0?void 0:e.scrollTo(0)})}_getScrollable(){}_getItemThumbnail(e){var t=this.option("getItemThumbnail");return t?t(e):{thumbnail:""}}_getItemThumbnailContainer(e){var{thumbnail:t,cssClass:i}=this._getItemThumbnail(e),r=It(t).addClass(this._getItemThumbnailCssClass());return i&&r.addClass(i),r}_getItemThumbnailCssClass(){return""}_getItemSelector(){}_onItemDblClick(e){}_isDesktop(){return Ze.real().deviceType==="desktop"}_showContextMenu(e,t,i,r){this._contextMenu.showAt(e,t,i,r)}get _contextMenu(){return this.option("contextMenu")}_findParentDirectoryItem(e){for(var t=0;t<e.length;t++){var i=e[t];if(this._isParentDirectoryItem(i))return i}return null}_getFileItemsForContextMenu(e){var t=this.getSelectedItems();return this._isParentDirectoryItem(e)&&t.push(e),t}_isParentDirectoryItem(e){return e.fileItem.isParentFolder}_hasValidKeys(e){return e.length>1||e.length===1&&e[0]!==this._parentDirectoryItemKey}_filterOutParentDirectory(e,t){return this._filterOutItemByPredicate(e,i=>i.key===this._parentDirectoryItemKey,t)}_filterOutParentDirectoryKey(e,t){return this._filterOutItemByPredicate(e,i=>i===this._parentDirectoryItemKey,t)}_filterOutItemByPredicate(e,t,i){for(var r=e,n=-1,a=0;a<e.length;a++)if(t(e[a])){n=a;break}return n!==-1&&(i&&(r=[...e]),r.splice(n,1)),r}_isMultipleSelectionMode(){return this.option("selectionMode")==="multiple"}_deselectItem(e){}_setSelectedItemKeys(e){}_setFocusedItemKey(e){}_createDataSource(){return{store:new Dr({key:"fileItem.key",load:this._getItems.bind(this)})}}getSelectedItems(){}clearSelection(){}selectItem(){}refresh(e,t){}}var Sa="dx-filemanager-details",ba="dx-filemanager-details-item-thumbnail",Ea="dx-filemanager-details-item-name",Aa="dx-filemanager-details-item-name-wrapper",wa="dx-filemanager-details-item-is-directory",xa="dx-filemanager-parent-directory-item",Da="dx-data-row",pi={thumbnail:{caption:"",calculateSortValue:"isDirectory",width:36,alignment:"center",cssClass:wa},name:{caption:$.format("dxFileManager-listDetailsColumnCaptionName")},dateModified:{caption:$.format("dxFileManager-listDetailsColumnCaptionDateModified"),width:110,hidingPriority:1},size:{caption:$.format("dxFileManager-listDetailsColumnCaptionFileSize"),width:90,alignment:"right",hidingPriority:0},isParentFolder:{caption:"isParentFolder",visible:!1,sortIndex:0,sortOrder:"asc"}};class Fa extends Qi{_initMarkup(){this._itemCount=0,this._focusedItem=null,this._hasParentDirectoryItem=!1,this._parentDirectoryItemKey=null,this._selectAllCheckBox=null,this._selectAllCheckBoxUpdating=!1,this.$element().addClass(Sa),this._createFilesView(),this._contextMenu.option("onContextMenuHidden",()=>this._onContextMenuHidden()),super._initMarkup()}_createFilesView(){var e=O("<div>").appendTo(this.$element()),t=this._isMultipleSelectionMode()?"multiple":"none";this._filesView=this._createComponent(e,Fr,{dataSource:this._createDataSource(),hoverStateEnabled:!0,selection:{mode:t,showCheckBoxesMode:this._isDesktop()?"onClick":"none"},selectedRowKeys:this.option("selectedItemKeys"),focusedRowKey:this.option("focusedItemKey"),focusedRowEnabled:!0,allowColumnResizing:!0,scrolling:{mode:"virtual"},sorting:{mode:"single",showSortIndexes:!1},loadPanel:{shading:!0},showColumnLines:!1,showRowLines:!1,columnHidingEnabled:!1,columns:this._createColumns(),onEditorPreparing:this._onEditorPreparing.bind(this),onRowPrepared:this._onRowPrepared.bind(this),onContextMenuPreparing:this._onContextMenuPreparing.bind(this),onSelectionChanged:this._onFilesViewSelectionChanged.bind(this),onFocusedRowChanged:this._onFilesViewFocusedRowChanged.bind(this),onOptionChanged:this._onFilesViewOptionChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_createColumns(){var e=this.option("detailColumns");e=e.slice(0),e=e.map(i=>{var r=i;return Le(i)&&(r={dataField:i}),this._getPreparedColumn(r)});var t=this.option("customizeDetailColumns");return Ie(t)&&(e=t(e)),e.push(this._getPreparedColumn({dataField:"isParentFolder"})),e.forEach(i=>this._updateColumnDataField(i)),e}_getPreparedColumn(e){var t={},i="";if(this._isDefaultColumn(e.dataField)){var r=Y(!0,{},pi[e.dataField]);switch(i=r.cssClass||"",e.dataField){case"thumbnail":r.cellTemplate=this._createThumbnailColumnCell.bind(this),r.calculateSortValue="fileItem.".concat(r.calculateSortValue);break;case"name":r.cellTemplate=this._createNameColumnCell.bind(this),r.caption=$.format("dxFileManager-listDetailsColumnCaptionName");break;case"size":r.calculateCellValue=this._calculateSizeColumnCellValue.bind(this),r.caption=$.format("dxFileManager-listDetailsColumnCaptionFileSize"),r.calculateSortValue=n=>n.fileItem.isDirectory?-1:n.fileItem.size;break;case"dateModified":r.caption=$.format("dxFileManager-listDetailsColumnCaptionDateModified")}Y(!0,t,r)}return Ve(t,e,["alignment","caption","dataField","dataType","hidingPriority","sortIndex","sortOrder","visible","visibleIndex","width"]),e.cssClass&&(i="".concat(i," ").concat(e.cssClass)),i&&(t.cssClass=i),t}_updateColumnDataField(e){var t=this._isDefaultColumn(e.dataField)?"":"dataItem.";return e.dataField="fileItem."+t+e.dataField,e}_isDefaultColumn(e){return!!pi[e]}_onFileItemActionButtonClick(e){var{component:t,element:i,event:r}=e;r.stopPropagation();var n=t.$element().closest(this._getItemSelector()),a=n.data("item");this._selectItem(a);var s={itemData:a,itemElement:n,isActionButton:!0},d=this._getFileItemsForContextMenu(a);this._showContextMenu(d,i,r,s),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}_getItemThumbnailCssClass(){return ba}_getItemSelector(){return".".concat(Da)}_onItemDblClick(e){var t=O(e.currentTarget),i=t.data("item");this._raiseSelectedItemOpened(i)}_isAllItemsSelected(){var e=this._hasParentDirectoryItem?this._itemCount-1:this._itemCount,t=this._filesView.option("selectedRowKeys");return t.length?t.length>=e?!0:void 0:!1}_onEditorPreparing(e){var{component:t,command:i,row:r,parentType:n,editorOptions:a}=e;this._filesView||(this._filesView=t),i==="select"&&r?this._isParentDirectoryItem(r.data)&&(a.disabled=!0):n==="headerRow"&&(a.onInitialized=s=>{var{component:d}=s;this._selectAllCheckBox=d},a.value=this._isAllItemsSelected(),a.onValueChanged=s=>this._onSelectAllCheckBoxValueChanged(s))}_onSelectAllCheckBoxValueChanged(e){var{event:t,previousValue:i,value:r}=e;if(!t){i&&!this._selectAllCheckBoxUpdating&&this._selectAllCheckBox&&this._selectAllCheckBox.option("value",i);return}this._isAllItemsSelected()!==r&&(r?this._filesView.selectAll():this._filesView.deselectAll(),t.preventDefault())}_onRowPrepared(e){var{rowType:t,rowElement:i,data:r}=e;if(t==="data"){var n=O(i);n.data("item",r),this._isParentDirectoryItem(r)&&n.addClass(xa)}}_onContextMenuPreparing(e){if(this._isDesktop()){var t=null,i={};e.row&&e.row.rowType==="data"&&(i=e.row.data,this._selectItem(i),t=this._getFileItemsForContextMenu(i));var r=Y({},{targetElement:e.target==="content"&&ne(e.row)?this._filesView.getRowElement(e.rowIndex):void 0,itemData:i,options:this._contextMenu.option(),event:e.event,isActionButton:!1,cancel:!1});this._raiseContextMenuShowing(r),e.items=r.cancel?[]:this._contextMenu.createContextMenuItems(t,null,i)}}_onFilesViewSelectionChanged(e){var{component:t,selectedRowsData:i,selectedRowKeys:r,currentSelectedRowKeys:n,currentDeselectedRowKeys:a}=e;this._filesView=this._filesView||t,this._selectAllCheckBox&&(this._selectAllCheckBoxUpdating=!0,this._selectAllCheckBox.option("value",this._isAllItemsSelected()),this._selectAllCheckBoxUpdating=!1);var s=i.map(d=>d.fileItem);this._tryRaiseSelectionChanged({selectedItemInfos:i,selectedItems:s,selectedItemKeys:r,currentSelectedItemKeys:n,currentDeselectedItemKeys:a})}_onFilesViewFocusedRowChanged(e){var t;if(!this._isMultipleSelectionMode()){var i;this._selectItemSingleSelection((i=e.row)===null||i===void 0?void 0:i.data)}var r=((t=e.row)===null||t===void 0?void 0:t.data.fileItem)||null;this._onFocusedItemChanged({item:r,itemKey:r==null?void 0:r.key,itemElement:e.rowElement})}_onFilesViewOptionChanged(e){var{fullName:t}=e;t.indexOf("sortOrder")>-1&&this._filesView.columnOption("isParentFolder",{sortOrder:"asc",sortIndex:0})}_resetFocus(){this._setFocusedItemKey(void 0)}_createThumbnailColumnCell(e,t){this._getItemThumbnailContainer(t.data).appendTo(e)}_createNameColumnCell(e,t){var i=O("<div>"),r=O("<span>").text(t.data.fileItem.name).addClass(Ea),n=O("<div>").append(r,i).addClass(Aa);O(e).append(n),this._createComponent(i,Yi,{onClick:a=>this._onFileItemActionButtonClick(a)})}_calculateSizeColumnCellValue(e){return e.fileItem.isDirectory?"":Wi(e.fileItem.size)}_selectItem(e){var t=this._isMultipleSelectionMode()?this._selectItemMultipleSelection:this._selectItemSingleSelection;t.call(this,e)}_deselectItem(e){this._filesView.deselectRows([e.fileItem.key])}_selectItemSingleSelection(e){if(!this._focusedItem||!e||this._focusedItem.fileItem.key!==e.fileItem.key){var t=this._focusedItem;this._focusedItem=e;var i=[];t&&i.push(t.fileItem.key);var r=[],n=[];e&&!this._isParentDirectoryItem(e)&&(r.push(e.fileItem),n.push(e.fileItem.key)),this._raiseSelectionChanged({selectedItems:r,selectedItemKeys:n,currentSelectedItemKeys:[...n],currentDeselectedItemKeys:i})}}_selectItemMultipleSelection(e){var{fileItem:t}=e;if(!this._filesView.isRowSelected(t.key)){var i=this._filesView.getController("selection"),r=i.isSelectionWithCheckboxes();this._filesView.selectRows([t.key],r)}}_setSelectedItemKeys(e){this._filesView.option("selectedRowKeys",e)}_setFocusedItemKey(e){var t;(t=this._filesView)===null||t===void 0||t.option("focusedRowKey",e)}clearSelection(){this._isMultipleSelectionMode()?this._filesView.clearSelection():this._filesView.option("focusedRowIndex",-1)}refresh(e,t){var i={dataSource:this._createDataSource()};e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(ne(e.focusedItemKey)?i.focusedRowKey=e.focusedItemKey:i.focusedRowIndex=-1);var r=!ne(i.focusedRowKey)&&i.focusedRowIndex===-1;return r&&t===Xe.NAVIGATION&&(i.paging={pageIndex:0},this._needResetScrollPosition=!0),this._filesView.option(i),this._refreshDeferred=new ae,this._refreshDeferred.promise()}_getScrollable(){return this._filesView.getScrollable()}getSelectedItems(){return this._isMultipleSelectionMode()?this._filesView.getSelectedRowsData():this._focusedItem&&!this._isParentDirectoryItem(this._focusedItem)?[this._focusedItem]:[]}}var Ma="dx-filemanager-thumbnails-view-port",Ta="dx-filemanager-thumbnails-container",Pa="dx-filemanager-thumbnails-item",Oa="dx-filemanager-thumbnails-item-name",ka="dx-filemanager-thumbnails-item-spacer",Ra="dxFileManagerItemData",La="dxFileManagerThumbnailsListBox",_i=we(Mr.name,La);class Ba extends Tr{_initMarkup(){this._initActions(),this._lockFocusedItemProcessing=!1,this.$element().addClass(Ma),this._renderScrollView(),this._renderItemsContainer(),this._createScrollViewControl(),super._initMarkup(),this.onFocusedItemChanged=this._onFocusedItemChanged.bind(this),this._layoutUtils=new Na(this._scrollView,this.$element(),this._$itemContainer,this.itemElements().first()),this._syncFocusedItemKey()}_initActions(){this._actions={onItemEnterKeyPressed:this._createActionByOption("onItemEnterKeyPressed"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged")}}_initTemplates(){super._initTemplates(),this._itemThumbnailTemplate=this.option("itemThumbnailTemplate"),this._getTooltipText=this.option("getTooltipText"),this._templateManager.addDefaultTemplates({item:new Pr((function(e,t,i){var r=this._getDefaultItemTemplate(i,e);e.append(r)}).bind(this),["fileItem"],this.option("integrationOptions.watchMethod"))})}_createScrollViewControl(){this._scrollView||(this._scrollView=this._createComponent(this._$scrollView,kt,{scrollByContent:!0,scrollByThumb:!0,useKeyboard:!1,showScrollbar:"onHover"}))}_renderScrollView(){this._$scrollView||(this._$scrollView=O("<div>").appendTo(this.$element()))}getScrollable(){return this._scrollView}_renderItemsContainer(){this._$itemContainer||(this._$itemContainer=O("<div>").addClass(Ta).appendTo(this._$scrollView))}_render(){super._render(),this._detachEventHandlers(),this._attachEventHandlers()}_clean(){this._detachEventHandlers(),super._clean()}_supportedKeys(){return Y(super._supportedKeys(),{upArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(-1,!1,e)},downArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(1,!1,e)},home(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(0,!0,e)},end(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(this._getItemsLength()-1,!0,e)},pageUp(e){this._beforeKeyProcessing(e),this._processPageChange(!0,e)},pageDown(e){this._beforeKeyProcessing(e),this._processPageChange(!1,e)},enter(e){this._beforeKeyProcessing(e),this._actions.onItemEnterKeyPressed(this._getFocusedItem())},A(e){this._beforeKeyProcessing(e),Wt(e)&&this.selectAll()}})}_beforeKeyProcessing(e){e.preventDefault(),this._layoutUtils.reset()}_processArrowKeys(e,t,i){var r=this._getFocusedItem();if(r){if(!t){var n=this._layoutUtils.getLayoutModel();if(!n)return;e*=n.itemPerRowCount}var a=this._getIndexByItem(r)+e;this._focusItemByIndex(a,!0,i)}}_processHomeEndKeys(e,t,i){this._focusItemByIndex(e,t,i)}_processPageChange(e,t){var i=this._getFocusedItem();if(i){var r=this._layoutUtils.getLayoutModel();if(r){var n=this._layoutUtils.createItemLayoutModel(this._getIndexByItem(i)),a=e?r.rowPerPageRate:-r.rowPerPageRate,s=n.itemRowIndex-a,d=e?Math.ceil:Math.floor,m=d(s),C=m*r.itemPerRowCount+n.itemColumnIndex;C<0?C=0:C>=this._getItemsLength()&&(C=this._getItemsLength()-1),this._focusItemByIndex(C,!0,t)}}}_processLongTap(e){var t=this._closestItemElement(O(e.target)),i=this._getIndexByItemElement(t);this._selection.changeItemSelection(i,{control:!0})}_attachEventHandlers(){this.option("selectionMode")==="multiple"&&de.on(this._itemContainer(),_i,".".concat(this._itemContentClass()),e=>{this._processLongTap(e),e.stopPropagation()}),de.on(this._itemContainer(),"mousedown selectstart",e=>{e.shiftKey&&e.preventDefault()})}_detachEventHandlers(){de.off(this._itemContainer(),_i),de.off(this._itemContainer(),"mousedown selectstart")}_itemContainer(){return this._$itemContainer}_itemClass(){return Pa}_itemDataKey(){return Ra}_getDefaultItemTemplate(e,t){t.attr("title",this._getTooltipText(e));var i=this._itemThumbnailTemplate(e),r=O("<div>").addClass(ka),n=O("<div>").addClass(Oa).text(e.fileItem.name);t.append(i,r,n)}_itemSelectHandler(e){var t={};this.option("selectionMode")==="multiple"&&(this._isPreserveSelectionMode||(this._isPreserveSelectionMode=Wt(e)||e.shiftKey),t={control:this._isPreserveSelectionMode,shift:e.shiftKey});var i=this._getIndexByItemElement(e.currentTarget);this._selection.changeItemSelection(i,t)}_initSelectionModule(){super._initSelectionModule();var e=Y(this._selection.options,{selectedKeys:this.option("selectedItemKeys"),onSelectionChanged:t=>{this.option("selectedItems",this._getItemsByKeys(t.selectedItemKeys,t.selectedItems)),this._updateSelectedItems(t)}});this._selection=new Or(e)}_updateSelectedItems(e){var t=e.addedItemKeys,i=e.removedItemKeys;if(this._rendered&&(t.length||i.length)){var r=this._selectionChangePromise;if(!this._rendering){var n=[],a,s=[];this._editStrategy.beginCache();for(var d=0;d<i.length;d++)a=this._getIndexByKey(i[d]),s.push(a),this._removeSelection(a);for(var m=0;m<t.length;m++)a=this._getIndexByKey(t[m]),n.push(a),this._addSelection(a);this._editStrategy.endCache(),this._updateSelection(n,s)}fe(r).done(()=>this._fireSelectionChangeEvent(e))}}_fireSelectionChangeEvent(e){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})(e)}_updateSelection(e,t){var i=this.getSelectedItems().length;i===0&&(this._isPreserveSelectionMode=!1)}_normalizeSelectedItems(){var e=this._getKeysByItems(this.option("selectedItems")),t=this._selection.getSelectedItemKeys();return this._compareKeys(t,e)||this._selection.setSelection(e),new ae().resolve().promise()}_focusOutHandler(){}_getItems(){return this.option("items")||[]}_getItemsLength(){return this._getItems().length}_getIndexByItemElement(e){return this._editStrategy.getNormalizedIndex(e)}_getItemByIndex(e){return this._getItems()[e]}_getFocusedItem(){return this.getItemByItemElement(this.option("focusedElement"))}_focusItem(e,t){this.option("focusedElement",this.getItemElementByItem(e)),t&&this._layoutUtils.scrollToItem(this._getIndexByItem(e))}_focusItemByIndex(e,t,i){if(e>=0&&e<this._getItemsLength()){var r=this._getItemByIndex(e);this._focusItem(r,t,i)}}_syncFocusedItemKey(){this._syncFocusedItemKeyDeferred||(this._syncFocusedItemKeyDeferred=new ae);var e=this._syncFocusedItemKeyDeferred;if(this._dataSource&&this._dataSource.isLoading())return e.promise();var t=this.option("focusedItemKey");if(ne(t)){var i=this.option("items"),r=i.find(n=>this.keyOf(n)===t);r?(this._focusItem(r,!0),e.resolve()):(this.option("focusedItemKey",void 0),e.reject())}else e.resolve();return this._syncFocusedItemKeyDeferred=null,e.promise()}_onFocusedItemChanged(){var e=this._getFocusedItem(),t=this.keyOf(e),i=this.option("focusedItemKey");t!==i&&(this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",t),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_raiseFocusedItemChanged(e){var t={item:e,itemElement:this.option("focusedElement")};this._actions.onFocusedItemChanged(t)}_changeItemSelection(e,t){if(this.isItemSelected(e)!==t){var i=this.getItemElementByItem(e),r=this._getIndexByItemElement(i);this._selection.changeItemSelection(r,{control:this._isPreserveSelectionMode})}}_chooseSelectOption(){return"selectedItemKeys"}getSelectedItems(){return this._selection.getSelectedItems()}getItemElementByItem(e){return this._editStrategy.getItemElement(e)}getItemByItemElement(e){return this._getItemByIndex(this._getIndexByItemElement(e))}selectAll(){this.option("selectionMode")==="multiple"&&(this._selection.selectAll(),this._isPreserveSelectionMode=!0)}selectItem(e){this._changeItemSelection(e,!0)}deselectItem(e){this._changeItemSelection(e,!1)}clearSelection(){this._selection.deselectAll()}_optionChanged(e){switch(e.name){case"items":this._layoutUtils&&this._layoutUtils.updateItems(this.itemElements().first()),super._optionChanged(e);break;case"focusedItemKey":if(this._lockFocusedItemProcessing)break;ne(e.value)?this._syncFocusedItemKey().done(()=>{var t=this._getFocusedItem();this._raiseFocusedItemChanged(t)}):(this.option("focusedElement",null),this._raiseFocusedItemChanged(null));break;case"onItemEnterKeyPressed":case"onFocusedItemChanged":this._actions[e.name]=this._createActionByOption(e.name);break;default:super._optionChanged(e)}}}class Na{constructor(e,t,i,r){this._layoutModel=null,this._scrollView=e,this._$viewPort=t,this._$itemContainer=i,this._$item=r}updateItems(e){this._$item=e}reset(){this._layoutModel=null}getLayoutModel(){return this._layoutModel||(this._layoutModel=this._createLayoutModel()),this._layoutModel}_createLayoutModel(){if(!this._$item)return null;var e=kr(this._$item,!0);if(e===0)return null;var t=Rr(this._$item,!0),i=Lr(this._$itemContainer),r=ki(this._$viewPort),n=this._scrollView.scrollTop(),a=n+r,s=Math.floor(i/e),d=r/t;return{itemWidth:e,itemHeight:t,viewPortWidth:i,viewPortHeight:r,viewPortScrollTop:n,viewPortScrollBottom:a,itemPerRowCount:s,rowPerPageRate:d}}createItemLayoutModel(e){var t=this.getLayoutModel();if(!t)return null;var i=Math.floor(e/t.itemPerRowCount),r=e%t.itemPerRowCount,n=i*t.itemHeight,a=n+t.itemHeight;return{itemRowIndex:i,itemColumnIndex:r,itemTop:n,itemBottom:a}}scrollToItem(e){var t=this.getLayoutModel();if(t){var i=Math.floor(e/t.itemPerRowCount),r=i*t.itemHeight,n=r+t.itemHeight,a=t.viewPortScrollTop;r<t.viewPortScrollTop?a=r:n>t.viewPortScrollBottom&&(a=n-t.viewPortHeight),this._scrollView.scrollTo(a)}}}var Ua="dx-filemanager-thumbnails",za="dx-filemanager-thumbnails-item",$a="dx-filemanager-thumbnails-item-thumbnail",Va="dxFileManager_thumbnails";class Ka extends Qi{_initMarkup(){super._initMarkup(),this.$element().addClass(Ua);var e=we(Br,Va);de.on(this.$element(),e,this._onContextMenu.bind(this)),this._createItemList()}_createItemList(){var e=this._isMultipleSelectionMode()?"multiple":"single",t=O("<div>").appendTo(this.$element());this._itemList=this._createComponent(t,Ba,{dataSource:this._createDataSource(),selectionMode:e,selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),activeStateEnabled:!0,hoverStateEnabled:!0,loopItemFocus:!1,focusStateEnabled:!0,onItemEnterKeyPressed:this._tryOpen.bind(this),itemThumbnailTemplate:this._getItemThumbnailContainer.bind(this),getTooltipText:this._getTooltipText.bind(this),onSelectionChanged:this._onItemListSelectionChanged.bind(this),onFocusedItemChanged:this._onItemListFocusedItemChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_onContextMenu(e){if(e.preventDefault(),e.stopPropagation(),!!this._isDesktop()){var t=null,i=O(e.target).closest(this._getItemSelector()),r=null;i.length>0&&(r=this._itemList.getItemByItemElement(i),this._itemList.selectItem(r),t=this._getFileItemsForContextMenu(r));var n={itemData:r,itemElement:i.length?i:void 0};this._showContextMenu(t,e.target,e,n)}}_getItemThumbnailCssClass(){return $a}_getItemSelector(){return".".concat(za)}_getTooltipText(e){var t=e.fileItem;if(t.tooltipText)return t.tooltipText;var i="".concat(t.name,`\r
`);return t.isDirectory||(i+="".concat($.format("dxFileManager-listThumbnailsTooltipTextSize"),": ").concat(Wi(t.size),`\r
`)),i+="".concat($.format("dxFileManager-listThumbnailsTooltipTextDateModified"),": ").concat(t.dateModified),i}_onItemDblClick(e){var t=O(e.currentTarget),i=this._itemList.getItemByItemElement(t);this._tryOpen(i)}_tryOpen(e){e&&this._raiseSelectedItemOpened(e)}_getItemsInternal(){return super._getItemsInternal().then(e=>{var t=new ae;return setTimeout(()=>t.resolve(e)),t.promise()})}_disableDragging(){return!1}_getDefaultOptions(){return Y(super._getDefaultOptions(),{focusStateEnabled:!0})}_onItemListSelectionChanged(e){var{addedItemKeys:t,removedItemKeys:i}=e,r=this.getSelectedItems(),n=r.map(s=>s.fileItem),a=n.map(s=>s.key);this._tryRaiseSelectionChanged({selectedItemInfos:r,selectedItems:n,selectedItemKeys:a,currentSelectedItemKeys:t,currentDeselectedItemKeys:i})}_onItemListFocusedItemChanged(e){var{item:t,itemElement:i}=e;this._isMultipleSelectionMode()||this._selectItemSingleSelection(t);var r=(t==null?void 0:t.fileItem)||null;this._onFocusedItemChanged({item:r,itemKey:r==null?void 0:r.key,itemElement:i||void 0})}_getScrollable(){return this._itemList.getScrollable()}_setSelectedItemKeys(e){this._itemList.option("selectedItemKeys",e)}_setFocusedItemKey(e){this._itemList.option("focusedItemKey",e)}refresh(e,t){var i={dataSource:this._createDataSource()};return e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(i.focusedItemKey=e.focusedItemKey),e&&Object.prototype.hasOwnProperty.call(e,"selectedItemKeys")&&(i.selectedItemKeys=e.selectedItemKeys),!ne(i.focusedItemKey)&&t===Xe.NAVIGATION&&(this._needResetScrollPosition=!0),this._itemList.option(i),this._refreshDeferred=new ae,this._refreshDeferred.promise()}_deselectItem(e){var t=this._itemList.getItemElementByItem(e);this._itemList.unselectItem(t)}_selectItemSingleSelection(e){e?this._itemList.selectItem(e):this._itemList.clearSelection()}clearSelection(){this._itemList.clearSelection()}getSelectedItems(){return this._itemList.getSelectedItems()}}var yt="dx-filemanager-toolbar",mi="dx-filemanager-general-toolbar",Ga="dx-filemanager-file-toolbar",Wa=yt+"-separator-item",Ha=yt+"-viewmode-item",ja=yt+"-has-large-icon",Za="dx-filemanager-view-switcher-popup",fi={showNavPane:{location:"before"},create:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},upload:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},refresh:{location:"after",showText:"inMenu",cssClass:ja,compactMode:{showText:"inMenu",locateInMenu:"auto"}},switchView:{location:"after"},download:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},move:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},copy:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},rename:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},delete:{location:"before",compactMode:{showText:"inMenu"}},clearSelection:{location:"after",locateInMenu:"never",compactMode:{showText:"inMenu"}},separator:{location:"before"}},qa=["visible","location","locateInMenu","disabled","showText"],Xa=["accessKey","elementAttr","height","hint","icon","stylingMode","tabIndex","text","width"],Ya=["separator","switchView"],gi={default:"dx-filemanager-i dx-filemanager-i-refresh",progress:"dx-filemanager-i dx-filemanager-i-progress",success:"dx-filemanager-i dx-filemanager-i-done",error:"dx-filemanager-i dx-filemanager-i-danger"},Ja=500;class Qa extends Ce{_init(){super._init(),this._generalToolbarVisible=!0,this._refreshItemState={message:"",status:"default"}}_initMarkup(){this._createItemClickedAction(),this._$viewSwitcherPopup=O("<div>").addClass(Za),this._generalToolbar=this._createToolbar(this.option("generalItems"),!this._generalToolbarVisible),this._fileToolbar=this._createToolbar(this.option("fileItems"),this._generalToolbarVisible),this._$viewSwitcherPopup.appendTo(this.$element()),this.$element().addClass(yt+" "+mi)}_render(){super._render();var e=this._getVisibleToolbar();this._checkCompactMode(e)}_clean(){delete this._commandManager,delete this._itemClickedAction,delete this._$viewSwitcherPopup,delete this._generalToolbar,delete this._fileToolbar,super._clean()}_dimensionChanged(e){if(!e||e!=="height"){var t=this._getVisibleToolbar();this._checkCompactMode(t)}}_getVisibleToolbar(){return this._generalToolbarVisible?this._generalToolbar:this._fileToolbar}_createToolbar(e,t){var i=this._getPreparedItems(e),r=O("<div>").appendTo(this.$element()),n=this._createComponent(r,Nr,{items:i,visible:!t,onItemClick:a=>this._raiseItemClicked(a)});return n.compactMode=!1,n}_getPreparedItems(e){return e=e.map(t=>{var i=t;Le(t)&&(i={name:t});var r=i.name,n=this._configureItemByCommandName(r,i);return n.originalItemData=t,r!=="separator"&&this._setItemVisibleAvailable(n),n}),this._updateSeparatorsVisibility(e),e}_updateSeparatorsVisibility(e,t){var i=!1,r=this._getMenuItems(t),n={before:!1,center:!1,after:!1},a={before:this._getItemsInGroup(e,r,"before"),center:this._getItemsInGroup(e,r,"center"),after:this._getItemsInGroup(e,r,"after")};return e.forEach((s,d)=>{var m=s.location;if(s.name==="separator"){var C=n[m]&&this._groupHasItemsAfter(a[m]);s.visible!==C&&(i=!0,s.visible=C),n[m]=!1}else this._isItemInMenu(r,s)||(n[m]=n[m]||s.visible),a[m].shift()}),t&&i&&t.repaint(),i}_getMenuItems(e){var t=e?e._getMenuItems():[];return t.map(i=>i.originalItemData)}_isItemInMenu(e,t){return!!e.length&&ve(t.locateInMenu,"never")!=="never"&&e.indexOf(t.originalItemData)!==-1}_getItemsInGroup(e,t,i){return e.filter(r=>r.location===i&&!this._isItemInMenu(t,r))}_groupHasItemsAfter(e){for(var t=0;t<e.length;t++)if(e[t].name!=="separator"&&e[t].visible)return!0;return!1}_configureItemByCommandName(e,t){var i,r={},n=this._commandManager.getCommandByName(e);switch(n&&(r=this._createCommandItem(n)),e){case"separator":r=this._createSeparatorItem();break;case"switchView":r=this._createViewModeItem()}if(this._isDefaultItem(e)){var a=fi[e];Y(!0,r,a);var s=r.cssClass||"";Ve(r,t,qa),ne(t.options)&&Ve(r.options,t.options,Xa),Ve(r.options,t,["text","icon"]),t.cssClass&&(s="".concat(s," ").concat(t.cssClass)),s&&(r.cssClass=s),ne(t.visible)||(r._autoHide=!0),r.widget==="dxButton"&&(r.showText==="inMenu"&&!ne(r.options.hint)&&(r.options.hint=r.options.text),r.compactMode&&!ne(r.options.hint)&&this._configureHintForCompactMode(r))}else Y(!0,r,t),r.widget||(r.widget="dxButton"),r.widget==="dxButton"&&!r.compactMode&&!r.showText&&r.options&&r.options.icon&&r.options.text&&(r.compactMode={showText:"inMenu"});return e&&!r.name&&Y(r,{name:e}),r.location=ve(r.location,"before"),ne((i=r.options)===null||i===void 0?void 0:i.stylingMode)||(r.widget==="dxButton"&&Y(!0,r,{options:{stylingMode:"text"}}),r.widget==="dxSelectBox"&&Y(!0,r,{options:{stylingMode:"filled"}})),r}_isDefaultItem(e){return!!fi[e]}_createCommandItem(e){return{widget:"dxButton",options:{text:e.text,hint:e.hint,commandText:e.text,icon:e.icon,stylingMode:"text",onClick:t=>this._executeCommand(e)}}}_createSeparatorItem(){return{template:(e,t,i)=>{O(i).addClass(Wa)}}}_createViewModeItem(){var e=["details","thumbnails"].map(r=>{var{text:n,icon:a}=this._commandManager.getCommandByName(r);return{name:r,text:n,icon:a}}),t=this.option("itemViewMode")==="thumbnails"?1:0,i={container:this._$viewSwitcherPopup};return xi()?i.width=Ht()?28:36:Di()&&(i.width=Ht()?34:40),{cssClass:Ha,widget:"dxDropDownButton",options:{items:e,keyExpr:"name",selectedItemKey:this.option("itemViewMode"),displayExpr:" ",hint:e[t].text,stylingMode:"text",showArrowIcon:!1,useSelectMode:!0,dropDownOptions:i,onItemClick:r=>this._executeCommand(r.itemData.name)}}}_configureHintForCompactMode(e){e.options.hint="",e.compactMode.options=e.compactMode.options||{},e.compactMode.options.hint=e.options.text}_checkCompactMode(e){e.compactMode&&this._toggleCompactMode(e,!1);var t=this._toolbarHasItemsOverflow(e);e.compactMode!==t?(e.compactMode||this._toggleCompactMode(e,t),e.compactMode=t):e.compactMode&&this._toggleCompactMode(e,!0)}_toolbarHasItemsOverflow(e){var t=Ue(e.$element()),i=e._getItemsWidth();return t<i}_toggleCompactMode(e,t){var i=!1,r=e.option("items");r.forEach(n=>{if(n.compactMode){var a=null;t?(n.saved=this._getCompactModeOptions(n,n._available),a=n.compactMode):a=n.saved;var s=this._getCompactModeOptions(a,n._available);Y(!0,n,s),i=!0}}),i=this._updateSeparatorsVisibility(r)||i,i&&e.repaint(),this._updateSeparatorsVisibility(r,e)}_getCompactModeOptions(e,t){var{showText:i,locateInMenu:r,options:n}=e;return{visible:t,showText:ve(i,"always"),locateInMenu:ve(r,"never"),options:{hint:n==null?void 0:n.hint}}}_ensureAvailableCommandsVisible(e){var t=!1,i=e.option("items");i.forEach(r=>{if(r.name!=="separator"){var n=r._available;this._setItemVisibleAvailable(r),r._available!==n&&(t=!0)}}),t=this._updateSeparatorsVisibility(i)||t,t&&e.repaint(),this._updateSeparatorsVisibility(i,e)}_setItemVisibleAvailable(e){var t,i=(t=e.originalItemData)===null||t===void 0?void 0:t.visible;e._available=this._isToolbarItemAvailable(e),e.visible=ne(i)?i:e._available}_fileToolbarHasEffectiveItems(){var e=this._fileToolbar.option("items");return e.some(t=>this._isFileToolbarItemAvailable(t))}_executeCommand(e){this._commandManager.executeCommand(e)}_isToolbarItemAvailable(e){return!this._isDefaultItem(e.name)||!e._autoHide?ve(e.visible,!0):e.name==="refresh"?this._generalToolbarVisible||!!this._isRefreshVisibleInFileToolbar:Ya.indexOf(e.name)>-1?!0:this._isCommandAvailable(e.name)}_isFileToolbarItemAvailable(e){var{name:t,visible:i}=e;return!this._isDefaultItem(t)&&ve(i,!0)||t!=="clearSelection"&&t!=="refresh"&&this._isCommandAvailable(t)}_isCommandAvailable(e){return this._commandManager.isCommandAvailable(e,this.option("contextItems"))}_updateItemInToolbar(e,t,i){e.beginUpdate();for(var r=e.option("items"),n=0;n<r.length;n++){var a=r[n];if(a.name===t){e.option("items[".concat(n,"]"),i);break}}e.endUpdate()}_raiseItemClicked(e){var t=Y(!0,{},e);t.itemData=e.itemData.originalItemData,this._itemClickedAction(t)}_createItemClickedAction(){this._itemClickedAction=this._createActionByOption("onItemClick")}_getDefaultOptions(){return Y(super._getDefaultOptions(),{commandManager:null,generalItems:[],fileItems:[],contextItems:[],itemViewMode:"details",onItemClick:null})}_optionChanged(e){var t=e.name;switch(t){case"commandManager":case"itemViewMode":case"generalItems":case"fileItems":this.repaint();break;case"contextItems":this._update();break;case"onItemClick":this._itemClickedAction=this._createActionByOption(t);break;default:super._optionChanged(e)}}updateItemPermissions(){this.repaint(),this._restoreRefreshItemState()}_restoreRefreshItemState(){this.updateRefreshItem(this._refreshItemState.message,this._refreshItemState.status)}updateRefreshItem(e,t){var i=null,r=$.format("dxFileManager-commandRefresh"),n="inMenu";this._isRefreshVisibleInFileToolbar=!1,this._refreshItemState={message:e,status:t},t==="default"?i={options:{icon:gi.default}}:(i={options:{icon:gi[t]}},this._isRefreshVisibleInFileToolbar=!0,r=e,n="always");var a=Y({},i,{visible:this._isRefreshVisibleInFileToolbar});this._applyRefreshItemOptions(i,a),this._refreshItemTextTimeout=this._updateRefreshItemText(t==="progress",r,n)}_updateRefreshItemText(e,t,i){var r={showText:i,options:{text:t}};if(e)return setTimeout(()=>{this._applyRefreshItemOptions(r),this._refreshItemTextTimeout=void 0},Ja);this._refreshItemTextTimeout&&clearTimeout(this._refreshItemTextTimeout),this._applyRefreshItemOptions(r)}_applyRefreshItemOptions(e,t){t||(t=Y({},e)),this._updateItemInToolbar(this._generalToolbar,"refresh",e),this._updateItemInToolbar(this._fileToolbar,"refresh",t)}_update(){var e=this.option("contextItems").length===0||!this._fileToolbarHasEffectiveItems();this._generalToolbarVisible!==e&&(this._generalToolbar.option("visible",e),this._fileToolbar.option("visible",!e),this._generalToolbarVisible=e,this.$element().toggleClass(mi,e),this.$element().toggleClass(Ga,!e));var t=this._getVisibleToolbar();this._ensureAvailableCommandsVisible(t),this._checkCompactMode(t)}get _commandManager(){return this.option("commandManager")}}var xe="dx-filemanager-progress-panel",es="".concat(xe,"-container"),ts="".concat(xe,"-title"),is="".concat(xe,"-title-text"),rs="".concat(xe,"-close-button"),ns="".concat(xe,"-infos-container"),vi="".concat(xe,"-separator"),as="".concat(xe,"-info"),ss="".concat(xe,"-common"),os="".concat(xe,"-info-with-details"),ls="".concat(xe,"-details"),Be="dx-filemanager-progress-box",ds="".concat(Be,"-error"),Ii="".concat(Be,"-without-close-button"),hs="".concat(Be,"-image"),cs="".concat(Be,"-wrapper"),us="".concat(Be,"-common"),ps="".concat(Be,"-progress-bar"),_s="".concat(Be,"-close-button"),ms="dx-card";class fs extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._operationCount=0,this.$element().addClass(xe);var e=O("<div>").appendTo(this.$element()),t=O("<div>").addClass(es).appendTo(e);this._scrollView=this._createComponent(e,kt,{scrollByContent:!0,scrollByThumb:!0,showScrollbar:"onScroll"});var i=O("<div>").addClass(ts).appendTo(t);O("<div>").text($.format("dxFileManager-notificationProgressPanelTitle")).addClass(is).appendTo(i);var r=O("<div>").addClass(rs).appendTo(i);this._createComponent(r,ze,{icon:"close",stylingMode:"text",onClick:()=>this._raisePanelClosed()}),this._$infosContainer=O("<div>").addClass(ns).appendTo(t),this._renderEmptyListText()}_getDefaultOptions(){return Y(super._getDefaultOptions(),{onOperationClosed:null,onOperationCanceled:null,onOperationItemCanceled:null,onPanelClosed:null})}_initActions(){this._actions={onOperationClosed:this._createActionByOption("onOperationClosed"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled"),onPanelClosed:this._createActionByOption("onPanelClosed")}}_optionChanged(e){var t=e.name;switch(t){case"test":break;case"onOperationClosed":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}addOperation(e,t,i){this._operationCount?O("<div>").addClass(vi).prependTo(this._$infosContainer):this._$infosContainer.empty(),this._operationCount++;var r={customCloseHandling:t,allowProgressAutoUpdate:ve(i,!0)},n=O("<div>").addClass(as).prependTo(this._$infosContainer);r.$info=n;var a=O("<div>").addClass(ss).appendTo(n);return r.common=this._createProgressBox(a,{commonText:e,showCloseButton:!0,showCloseButtonAlways:t,onCloseButtonClick:()=>this._closeOperation(r)}),r}addOperationDetails(e,t,i){e.$info.addClass(os);var r=O("<div>").addClass(ls).appendTo(e.$info);e.details=t.map((n,a)=>(n.info=e,this._createDetailsItem(r,n,a,!1,i)))}_createDetailsItem(e,t,i,r,n){var a=O("<div>").appendTo(e);return i!==-1&&a.addClass(ms),this._createProgressBox(a,{commonText:t.commonText,imageUrl:t.imageUrl,skipProgressBox:r,showCloseButton:n,showCloseButtonAlways:n,onCloseButtonClick:()=>this._cancelOperationItem(t,i)})}completeOperationItem(e,t,i){e.allowProgressAutoUpdate&&this.updateOperationItemProgress(e,t,100,i),this._setCloseButtonVisible(e.details[t],!1)}updateOperationItemProgress(e,t,i,r){if(this.updateOperationCommonProgress(e,r),e.details){var n=e.details[t];n.progressBar.option("value",i)}}updateOperationCommonProgress(e,t){var i;(i=e.common.progressBar)===null||i===void 0||i.option("value",t)}completeOperation(e,t,i,r){e.completed=!0,e.common.$commonText.text(t),i?this._removeProgressBar(e.common):e.allowProgressAutoUpdate&&this.updateOperationCommonProgress(e,100),r&&this._setProgressBarText(e.common,r),this._setCloseButtonVisible(e.common,!0)}completeSingleOperationWithError(e,t){var i,r=(i=e.details)===null||i===void 0?void 0:i[0];e.completed=!0,this._renderOperationError(r||e.common,t),this._setCloseButtonVisible(e.common,!0),r&&this._setCloseButtonVisible(r,!1)}addOperationDetailsError(e,t,i){var r=e.details[t];this._renderOperationError(r,i),this._setCloseButtonVisible(r,!1)}_renderError(e,t,i){O("<div>").text(i).addClass(ds).appendTo(e)}_renderEmptyListText(){this._$infosContainer.text($.format("dxFileManager-notificationProgressPanelEmptyListText"))}_renderOperationError(e,t){this._removeProgressBar(e),this._renderError(e.$wrapper,e.$commonText,t)}_removeProgressBar(e){e.progressBar&&(e.progressBar.dispose(),e.progressBar.$element().remove(),e.progressBar=null)}_createProgressBox(e,t){e.addClass(Be),t.showCloseButtonAlways||e.addClass(Ii),t.imageUrl&&It(t.imageUrl).addClass(hs).appendTo(e);var i=O("<div>").addClass(cs).appendTo(e),r=O("<div>").addClass(us).text(t.commonText).appendTo(i),n=null;if(!t.skipProgressBox){var a=O("<div>").addClass(ps).appendTo(i);n=this._createComponent(a,Rt,{min:0,max:100,width:"100%",validationMessageMode:"always",statusFormat:(m,C)=>this._getStatusString(m,C)})}var s=null;if(t.showCloseButton){var d=O("<div>").addClass(_s).appendTo(e);s=this._createComponent(d,ze,{icon:"dx-filemanager-i dx-filemanager-i-cancel",stylingMode:"text",visible:t.showCloseButtonAlways,onClick:t.onCloseButtonClick})}return{$commonText:r,progressBar:n,$element:e,$wrapper:i,closeButton:s}}_setCloseButtonVisible(e,t){e.closeButton&&(e.$element.toggleClass(Ii,!t),e.closeButton.option("visible",t))}_setProgressBarText(e,t){e.progressBar.option("statusFormat",()=>t)}_closeOperation(e){e.customCloseHandling&&!e.completed?(this._raiseOperationCanceled(e),this._setCloseButtonVisible(e.common,!1),e.details.forEach(t=>this._displayClosedOperationItem(t))):(this._raiseOperationClosed(e),e.$info.next(".".concat(vi)).remove(),e.$info.remove(),this._operationCount--,this._operationCount||this._renderEmptyListText())}_cancelOperationItem(e,t){this._raiseOperationItemCanceled(e,t);var i=e.info.details[t];this._displayClosedOperationItem(i)}_displayClosedOperationItem(e){this._setProgressBarText(e,$.format("dxFileManager-notificationProgressPanelOperationCanceled")),this._setCloseButtonVisible(e,!1)}_getStatusString(e,t){return e===1?$.format("Done"):Math.round(100*e)+"%"}_raiseOperationClosed(e){this._actions.onOperationClosed({info:e})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_raisePanelClosed(){this._actions.onPanelClosed()}}var ht="dx-filemanager-progress-box",gs="".concat(ht,"-error"),vs="".concat(ht,"-image"),Is="".concat(ht,"-wrapper"),Cs="".concat(ht,"-common"),Bt="__operationInfoManager",Se={default:"default",progress:"progress",error:"error",success:"success"};class er{constructor(e){var{onActionProgressStatusChanged:t,isActual:i}=e;this._id=new Re().toString(),this._isActual=i||!1,this._actionProgressStatus=Se.default,this._raiseActionProgress=t}getId(){return this._id}isActual(){return this._isActual}createErrorDetailsProgressBox(e,t,i){var r=this._createDetailsItem(e,t);this.renderError(r.$wrapper,i)}renderError(e,t){O("<div>").text(t).addClass(gs).appendTo(e)}isActionProgressStatusDefault(){return this._actionProgressStatus===Se.default}_createDetailsItem(e,t){var i=O("<div>").appendTo(e);return this._createProgressBox(i,{commonText:t.commonText,imageUrl:t.imageUrl})}_createProgressBox(e,t){e.addClass(ht),t.imageUrl&&It(t.imageUrl).addClass(vs).appendTo(e);var i=O("<div>").addClass(Is).appendTo(e),r=O("<div>").addClass(Cs).text(t.commonText).appendTo(i);return{$commonText:r,$element:e,$wrapper:i}}}class ys extends er{addOperation(){return{[Bt]:this._id}}addOperationDetails(){}updateOperationItemProgress(){}completeOperationItem(){}finishOperation(){}completeOperation(){}completeSingleOperationWithError(){}addOperationDetailsError(){}handleDimensionChanged(){return!1}ensureProgressPanelCreated(){}tryHideActionProgress(){this._updateActionProgress("",Se.default)}updateActionProgressStatus(){this._updateActionProgress("",Se.default)}_updateActionProgress(e,t){t!==Se.default&&t!==Se.progress||(this._actionProgressStatus=t,this._raiseActionProgress(e,t))}hasNoOperations(){return!0}get _operationInProgressCount(){return 0}set _operationInProgressCount(e){}get _failedOperationCount(){return 0}set _failedOperationCount(e){}}class Ss extends er{constructor(e){super(e),this._failedOperationCount=0,this._operationInProgressCount=0}addOperation(e,t,i){this._operationInProgressCount++;var r=this._progressPanel.addOperation(e,t,i);return r[Bt]=this._id,this._updateActionProgress(e,Se.progress),r}addOperationDetails(e,t,i){this._progressPanel.addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,r){this._progressPanel.updateOperationItemProgress(e,t,i,r)}completeOperationItem(e,t,i){this._progressPanel.completeOperationItem(e,t,i)}finishOperation(e,t){this._progressPanel.updateOperationCommonProgress(e,t)}completeOperation(e,t,i,r){this._operationInProgressCount--,i&&this._failedOperationCount++,this._progressPanel.completeOperation(e,t,i,r)}completeSingleOperationWithError(e,t){this._progressPanel.completeSingleOperationWithError(e,t.detailErrorText),this._notifyError(t)}addOperationDetailsError(e,t){this._progressPanel.addOperationDetailsError(e,t.itemIndex,t.detailErrorText),this._notifyError(t)}handleDimensionChanged(){return this._progressPanel&&this._progressPanel.$element().detach(),!0}ensureProgressPanelCreated(e,t){if(this._progressPanel)this._progressPanel.$element().appendTo(e);else{var i=O("<div>").appendTo(e),r=this._getProgressPanelComponent();this._progressPanel=new r(i,Y({},t,{onOperationClosed:n=>{var{info:a}=n;return this._onProgressPanelOperationClosed(a)}}))}}_getProgressPanelComponent(){return fs}_onProgressPanelOperationClosed(e){e.hasError&&(this._failedOperationCount--,this.tryHideActionProgress())}tryHideActionProgress(){this.hasNoOperations()&&this._updateActionProgress("",Se.default)}updateActionProgressStatus(e){if(e){var t=this._failedOperationCount===0?Se.success:Se.error;this._updateActionProgress("",t)}}_notifyError(e){var t=this.hasNoOperations()?Se.default:Se.error;this._updateActionProgress(e.commonErrorText,t)}_updateActionProgress(e,t){this._actionProgressStatus=t,this._raiseActionProgress(e,t)}hasNoOperations(){return this._operationInProgressCount===0&&this._failedOperationCount===0}get _operationInProgressCount(){return this._operationInProgressCountInternal}set _operationInProgressCount(e){this._operationInProgressCountInternal=e}get _failedOperationCount(){return this._failedOperationCountInternal}set _failedOperationCount(e){this._failedOperationCountInternal=e}}var bs=Ge(),Es=1e3,We="dx-filemanager-notification",tr="".concat(We,"-drawer"),Ci="".concat(tr,"-panel"),As="".concat(We,"-popup"),ws="".concat(We,"-popup-error"),xs="".concat(We,"-common"),Ds="".concat(We,"-separator"),Fs="".concat(We,"-details"),Ms="".concat(We,"-common-no-item");class Ts extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=this._isSmallScreen(),this._managerMap={},this._notificationManagerStubId=null,this._setNotificationManager();var e=this.option("progressPanelContainer"),t=O("<div>").addClass(tr).appendTo(e);O("<div>").addClass(Ci).appendTo(t);var i=Y({opened:!1,position:"right",template:a=>this._ensureProgressPanelCreated(a)},this._getProgressDrawerAdaptiveOptions());this._progressDrawer=this._createComponent(t,Ri,i);var r=t.find(".".concat(Ci)).first(),n=this.option("contentTemplate");Ie(n)&&n(r,this)}_setNotificationManager(e){if(e=Y({onActionProgressStatusChanged:this._raiseActionProgress.bind(this)},e),!this._notificationManagerStubId){var t=new ys(e);this._notificationManagerStubId=t.getId(),this._managerMap[this._notificationManagerStubId]=t}if(!this._isProgressDrawerDisabled()){var i=this._getProgressManagerComponent();e.isActual=!0;var r=new i(e);this._managerMap[r.getId()]=r}}_getNotificationManager(e){var t=(e==null?void 0:e[Bt])||this._getActualNotificationManagerId();return this._managerMap[t]||this._managerMap[this._notificationManagerStubId]}_clearManagerMap(){var e=this._managerMap[this._notificationManagerStubId];delete this._managerMap,this._managerMap={[this._notificationManagerStubId]:e}}_getActualNotificationManagerId(){return Object.keys(this._managerMap).filter(e=>this._managerMap[e].isActual())[0]}tryShowProgressPanel(){var e=new ae,t=this._getNotificationManager();return t.isActionProgressStatusDefault()||this._isProgressDrawerOpened()||this._isProgressDrawerDisabled()?e.resolve().promise():(setTimeout(()=>{this._progressDrawer.show().done(e.resolve),this._hidePopup(),t.tryHideActionProgress()}),e.promise())}addOperation(e,t,i){var r=this._getNotificationManager();return r.addOperation(e,t,i)}addOperationDetails(e,t,i){var r=this._getNotificationManager(e);r.addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,r){var n=this._getNotificationManager(e);n.updateOperationItemProgress(e,t,i,r)}completeOperationItem(e,t,i){var r=this._getNotificationManager(e);r.completeOperationItem(e,t,i)}finishOperation(e,t){var i=this._getNotificationManager(e);i.finishOperation(e,t)}completeOperation(e,t,i,r){var n=this._getNotificationManager(e);i||this._showPopup(t),n.completeOperation(e,t,i,r),!this._isProgressDrawerOpened()||!n.hasNoOperations()?n.updateActionProgressStatus(e):n.tryHideActionProgress()}completeSingleOperationWithError(e,t){var i=this._getNotificationManager(e);i.completeSingleOperationWithError(e,t),this._showPopupError(t)}addOperationDetailsError(e,t){var i=this._getNotificationManager(e);i.addOperationDetailsError(e,t),this._showPopupError(t)}_hideProgressPanel(){setTimeout(()=>this._progressDrawer.hide())}_isSmallScreen(){return Ke()?Ue(bs)<=Es:!1}_dimensionChanged(e){e&&e==="height"||this._checkAdaptiveState()}_checkAdaptiveState(){var e=this._isInAdaptiveState;if(this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&this._progressDrawer){var t=this._getNotificationManager();if(t.handleDimensionChanged()){var i=this._getProgressDrawerAdaptiveOptions();this._progressDrawer.option(i)}}}_getProgressDrawerAdaptiveOptions(){return this._isInAdaptiveState?{openedStateMode:"overlap",shading:!0,hideOnOutsideClick:!0}:{openedStateMode:"shrink",shading:!1,hideOnOutsideClick:!1}}_ensureProgressPanelCreated(e){var t=this._getNotificationManager();t.ensureProgressPanelCreated(e,{onOperationCanceled:i=>{var{info:r}=i;return this._raiseOperationCanceled(r)},onOperationItemCanceled:i=>{var{item:r,itemIndex:n}=i;return this._raiseOperationItemCanceled(r,n)},onPanelClosed:()=>this._hideProgressPanel()})}_getProgressManagerComponent(){return Ss}_isProgressDrawerDisabled(){return!this.option("showProgressPanel")}_isProgressDrawerOpened(){return this._progressDrawer.option("opened")}_hidePopup(e){!this.option("showNotificationPopup")&&!e||this._getNotificationPopup().hide()}_showPopup(e,t){this._isProgressDrawerOpened()||!this.option("showNotificationPopup")||(this._getNotificationPopup().$wrapper().toggleClass(ws,!!t),this._getNotificationPopup().option("contentTemplate",e),this._getNotificationPopup().option("visible")||this._getNotificationPopup().show())}_showPopupError(e){if(this.option("showNotificationPopup")){var t=this._getNotificationManager(),i=O("<div>"),r=O("<div>").addClass(xs).text(e.commonErrorText),n=O("<div>").addClass(Ds);O("<div>").appendTo(n);var a=O("<div>").addClass(Fs);e.item?t.createErrorDetailsProgressBox(a,e.item,e.detailErrorText):(r.addClass(Ms),t.renderError(a,e.detailErrorText)),i.append(r,n,a),this._showPopup(i,!0)}}_getNotificationPopup(){if(!this._notificationPopup){var e=O("<div>").appendTo(this.$element());this._notificationPopup=this._createComponent(e,Li,{container:this.$element(),width:"auto",height:"auto",showTitle:!1,dragEnabled:!1,shading:!1,visible:!1,hideOnOutsideClick:!0,animation:{duration:0},position:{my:"right top",at:"right top",of:this.option("positionTarget"),offset:"-10 -5"},_wrapperClassExternal:As})}return this._notificationPopup}_raiseActionProgress(e,t){this._actions.onActionProgress({message:e,status:t})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_initActions(){this._actions={onActionProgress:this._createActionByOption("onActionProgress"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled")}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{progressPanelContainer:null,contentTemplate:null,onActionProgress:null,onOperationCanceled:null,onOperationItemCanceled:null,showProgressPanel:!0,showNotificationPopup:!0})}_optionChanged(e){var t=e.name;switch(t){case"progressPanelContainer":case"contentTemplate":break;case"showProgressPanel":this._setNotificationManager(),this._getNotificationManager().updateActionProgressStatus(),e.value||(this._hideProgressPanel(),this._clearManagerMap()),this._progressDrawer.repaint();break;case"showNotificationPopup":e.value||this._hidePopup(!0);break;case"onActionProgress":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}var Ps="dx-filemanager-dialog",Os="dx-filemanager-dialog-popup";class Nt extends Ce{_initMarkup(){var e;super._initMarkup(),this._createOnClosedAction();var t=this._getDialogOptions(),i=O("<div>").appendTo(this.$element()),r={showTitle:!0,title:t.title,visible:!1,hideOnOutsideClick:!0,contentTemplate:this._createContentTemplate.bind(this),toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:t.buttonText,onClick:this._applyDialogChanges.bind(this)}},{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:$.format("dxFileManager-dialogButtonCancel"),onClick:this._closeDialog.bind(this)}}],onInitialized:n=>{var{component:a}=n;a.registerKeyHandler("enter",this._applyDialogChanges.bind(this))},onHiding:this._onPopupHiding.bind(this),onShown:this._onPopupShown.bind(this),_wrapperClassExternal:"".concat(Os," ").concat((e=t.popupCssClass)!==null&&e!==void 0?e:"")};ne(t.height)&&(r.height=t.height),ne(t.maxHeight)&&(r.maxHeight=t.maxHeight),this._popup=this._createComponent(i,Li,r)}show(){this._dialogResult=null,this._popup.show()}_getDialogOptions(){return{title:"Title",buttonText:"ButtonText",contentCssClass:"",popupCssClass:""}}_createContentTemplate(e){this._$contentElement=O("<div>").appendTo(e).addClass(Ps);var t=this._getDialogOptions().contentCssClass;t&&this._$contentElement.addClass(t)}_getDialogResult(){return null}_applyDialogChanges(){var e=this._getDialogResult();e&&(this._dialogResult=e,this._closeDialog())}_closeDialog(){this._popup.hide()}_onPopupHiding(){this._onClosedAction({dialogResult:this._dialogResult})}_onPopupShown(){}_createOnClosedAction(){this._onClosedAction=this._createActionByOption("onClosed")}_setTitle(e){this._popup.option("title",e)}_setApplyButtonOptions(e){this._popup.option("toolbarItems[0].options",e)}_getDefaultOptions(){return Y(super._getDefaultOptions(),{onClosed:null})}_optionChanged(e){var t=e.name;switch(t){case"onClosed":this._createOnPathChangedAction();break;default:super._optionChanged(e)}}}var ks="dx-filemanager-dialog-name-editor",Rs="dx-filemanager-dialog-name-editor-popup";class yi extends Nt{show(e){e=e||"",this._nameTextBox?this._nameTextBox.option("value",e):this._initialNameValue=e,super.show()}_onPopupShown(){if(this._nameTextBox){var e=this._nameTextBox._input();e.length&&e[0].select(),this._nameTextBox.focus()}}_getDialogOptions(){return Y(super._getDialogOptions(),{title:this.option("title"),buttonText:this.option("buttonText"),contentCssClass:ks,popupCssClass:Rs})}_createContentTemplate(e){super._createContentTemplate(e),this._nameTextBox=this._createComponent(O("<div>"),Ur,{value:this._initialNameValue,onEnterKey:()=>this._hasCompositionJustEnded&&this._applyDialogChanges(),onKeyDown:t=>this._checkCompositionEnded(t)}),this._$contentElement.append(this._nameTextBox.$element())}_checkCompositionEnded(e){var{event:t}=e;this._hasCompositionJustEnded=t.which!==229}_getDialogResult(){var e=this._nameTextBox.option("value");return e?{name:e}:null}_getDefaultOptions(){return Y(super._getDefaultOptions(),{title:"",buttonText:""})}}var Ls="dx-filemanager-dialog-folder-chooser",Bs="dx-filemanager-dialog-folder-chooser-popup";class Ns extends Nt{show(){var e;this._setSelectedDirInfo(null),(e=this._filesTreeView)===null||e===void 0||e.refresh(),super.show()}switchToCopyDialog(e){this._targetItemInfos=e,this._setTitle($.format("dxFileManager-dialogDirectoryChooserCopyTitle")),this._setApplyButtonOptions({text:$.format("dxFileManager-dialogDirectoryChooserCopyButtonText"),disabled:!0})}switchToMoveDialog(e){this._targetItemInfos=e,this._setTitle($.format("dxFileManager-dialogDirectoryChooserMoveTitle")),this._setApplyButtonOptions({text:$.format("dxFileManager-dialogDirectoryChooserMoveButtonText"),disabled:!0})}_getDialogOptions(){return Y(super._getDialogOptions(),{contentCssClass:Ls,popupCssClass:Bs})}_createContentTemplate(e){super._createContentTemplate(e),this._filesTreeView=this._createComponent(O("<div>"),Ji,{getDirectories:this.option("getDirectories"),getCurrentDirectory:()=>this._getDialogSelectedDirectory(),onDirectoryClick:t=>this._onFilesTreeViewDirectoryClick(t),onFilesTreeViewContentReady:()=>this._toggleUnavailableLocationsDisabled(!0)}),this._$contentElement.append(this._filesTreeView.$element())}_getDialogResult(){var e=this._getDialogSelectedDirectory();return e&&{folder:e}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{getItems:null})}_getDialogSelectedDirectory(){return this._selectedDirectoryInfo}_onFilesTreeViewDirectoryClick(e){var{itemData:t}=e;this._setSelectedDirInfo(t),this._filesTreeView.updateCurrentDirectory()}_setSelectedDirInfo(e){this._selectedDirectoryInfo=e,this._setApplyButtonOptions({disabled:!e})}_onPopupShown(){this._toggleUnavailableLocationsDisabled(!0),super._onPopupShown()}_onPopupHiding(){this._toggleUnavailableLocationsDisabled(!1),super._onPopupHiding()}_toggleUnavailableLocationsDisabled(e){if(this._filesTreeView){var t=this._getLocationsToProcess(e);this._filesTreeView.toggleDirectoryExpandedStateRecursive(t.locationsToExpand[0],e).then(()=>this._filesTreeView.toggleDirectoryLineExpandedState(t.locationsToCollapse,!e).then(()=>t.locationKeysToDisable.forEach(i=>this._filesTreeView.toggleNodeDisabledState(i,e))))}}_getLocationsToProcess(e){var t={},i={};this._targetItemInfos.forEach(a=>{a.parentDirectory&&(t[a.parentDirectory.getInternalKey()]=a.parentDirectory),a.fileItem.isDirectory&&(i[a.getInternalKey()]=a)});var r=si(t),n=si(i);return{locationsToExpand:e?r.values:[],locationsToCollapse:e?n.values:[],locationKeysToDisable:r.keys.concat(...n.keys)}}}var Us="dx-filemanager-dialog-delete-item",zs="dx-filemanager-dialog-delete-item-popup";class $s extends Nt{show(e){var{itemName:t,itemCount:i}=e,r=i===1?$.format("dxFileManager-dialogDeleteItemSingleItemConfirmation",t):$.format("dxFileManager-dialogDeleteItemMultipleItemsConfirmation",i);this._$text?this._$text.text(r):this._initialText=r,super.show()}_getDialogOptions(){return Y(super._getDialogOptions(),{title:$.format("dxFileManager-dialogDeleteItemTitle"),buttonText:$.format("dxFileManager-dialogDeleteItemButtonText"),contentCssClass:Us,popupCssClass:zs,height:"auto",maxHeight:"80vh"})}_createContentTemplate(e){super._createContentTemplate(e),this._$text=O("<div>").text(this._initialText).appendTo(this._$contentElement),this._createComponent(this._$contentElement,kt,{width:"100%",height:"100%"})}_getDialogResult(){return{}}}class Vs{constructor(e,t){this._$element=e,this._options=t;var i={onClosed:this._options.onDialogClosed,rtlEnabled:this._options.rtlEnabled},r=O("<div>").appendTo(this._$element);this._chooseDirectoryDialog=new Ns(r,Y(i,this._options.chooseDirectoryDialog));var n=O("<div>").appendTo(this._$element);this._renameItemDialog=new yi(n,Y(i,{title:$.format("dxFileManager-dialogRenameItemTitle"),buttonText:$.format("dxFileManager-dialogRenameItemButtonText")}));var a=O("<div>").appendTo(this._$element);this._createItemDialog=new yi(a,Y(i,{title:$.format("dxFileManager-dialogCreateDirectoryTitle"),buttonText:$.format("dxFileManager-dialogCreateDirectoryButtonText")}));var s=O("<div>").appendTo(this._$element);this._deleteItemDialog=new $s(s,i)}getCopyDialog(e){return this._chooseDirectoryDialog.switchToCopyDialog(e),this._chooseDirectoryDialog}getMoveDialog(e){return this._chooseDirectoryDialog.switchToMoveDialog(e),this._chooseDirectoryDialog}getRenameItemDialog(){return this._renameItemDialog}getCreateItemDialog(){return this._createItemDialog}getDeleteItemDialog(){return this._deleteItemDialog}updateDialogRtl(e){[this._chooseDirectoryDialog,this._renameItemDialog,this._createItemDialog,this._deleteItemDialog].forEach(t=>{t.option("rtlEnabled",e)})}}var Ks="dx-filemanager-fileuploader",Gs="dx-filemanager-fileuploader-dropzone-placeholder";class Ws extends Ce{_initMarkup(){this._initActions(),this.$element().addClass(Ks),this._uploaderInfos=[],this._createInternalFileUploader(),this._createDropZonePlaceholder(),this._setDropZonePlaceholderVisible(!1),super._initMarkup()}_createInternalFileUploader(){var e=this._getController().chunkSize,t=O("<div>").appendTo(this.$element()),i=this._createComponent(t,Ni,{name:"file",multiple:!0,showFileList:!1,activeStateEnabled:!1,focusStateEnabled:!1,hoverStateEnabled:!1,labelText:"",readyToUploadMessage:"",accept:"*",chunkSize:e,dropZone:this.option("dropZone"),onValueChanged:n=>this._onFileUploaderValueChanged(n),onProgress:n=>this._onFileUploaderProgress(n),onUploaded:n=>this._onFileUploaderUploaded(n),onFilesUploaded:n=>this._onFileUploaderAllFilesUploaded(n),onUploadAborted:n=>this._onFileUploaderUploadAborted(n),onUploadError:n=>this._onFileUploaderUploadError(n),onDropZoneEnter:()=>this._setDropZonePlaceholderVisible(!0),onDropZoneLeave:()=>this._setDropZonePlaceholderVisible(!1)});i.option({uploadChunk:(n,a)=>this._fileUploaderUploadChunk(i,n,a),abortUpload:(n,a)=>this._fileUploaderAbortUpload(i,n,a)}),i._shouldRaiseDragLeaveBase=i._shouldRaiseDragLeave,i._shouldRaiseDragLeave=n=>this._shouldRaiseDragLeave(n,i);var r={fileUploader:i};this._uploaderInfos.push(r)}tryUpload(){var e=this._findAndUpdateAvailableUploaderInfo();e&&e.fileUploader._selectButtonClickHandler()}cancelUpload(e){this._cancelUpload(e)}cancelFileUpload(e,t){this._cancelUpload(e,t)}_cancelUpload(e,t){var{fileUploader:i}=this._findUploaderInfoBySessionId(e);i.abortUpload(t)}_fileUploaderUploadChunk(e,t,i){var{session:r,fileIndex:n}=this._findSessionByFile(e,t),a=r.controller;return i.fileIndex=n,a.uploadFileChunk(t,i)}_fileUploaderAbortUpload(e,t,i){var{session:r,fileIndex:n}=this._findSessionByFile(e,t),a=r.controller;return i.fileIndex=n,a.abortFileUpload(t,i)}_onFileUploaderValueChanged(e){var{component:t,value:i}=e;if(i.length!==0){var r=i.slice(),n=this._findUploaderInfo(t);this._uploadFiles(n,r),setTimeout(()=>{this._findAndUpdateAvailableUploaderInfo()||this._createInternalFileUploader()})}}_onFileUploaderProgress(e){var{component:t,file:i,bytesLoaded:r,bytesTotal:n}=e,{session:a,fileIndex:s}=this._findSessionByFile(t,i),d=n!==0?r/n:1,m=t.option("progress")/100,C={sessionId:a.id,fileIndex:s,commonValue:m,fileValue:d};this._raiseUploadProgress(C)}_onFileUploaderAllFilesUploaded(e){var{component:t}=e,{session:i}=this._findSessionByFile(t,t._files[0].value);this._raiseUploadFinished({sessionId:i.id,commonValue:t.option("progress")/100})}_onFileUploaderUploaded(e){var{component:t,file:i}=e,r=this._getDeferredForFile(t,i);r.resolve()}_onFileUploaderUploadAborted(e){var{component:t,file:i}=e,r=this._getDeferredForFile(t,i);r.resolve({canceled:!0})}_onFileUploaderUploadError(e){var{component:t,file:i,error:r}=e,n=this._getDeferredForFile(t,i);n.reject(r)}_createDropZonePlaceholder(){this._$dropZonePlaceholder=O("<div>").addClass(Gs).appendTo(this.option("dropZonePlaceholderContainer"))}_adjustDropZonePlaceholder(){var e=this.option("dropZone");if(!(!Ke()||e.length===0)){var t=parseFloat(this._$dropZonePlaceholder.css("borderTopWidth")),i=parseFloat(this._$dropZonePlaceholder.css("borderLeftWidth")),r=this.option("dropZonePlaceholderContainer"),n=parseFloat(r.css("borderBottomWidth")),a=parseFloat(r.css("borderLeftWidth")),s=ki(r),d=r.offset(),m=e.offset();this._$dropZonePlaceholder.css({top:m.top-d.top-s-n,left:m.left-d.left-a}),zr(this._$dropZonePlaceholder,e.get(0).offsetHeight-2*t),$r(this._$dropZonePlaceholder,e.get(0).offsetWidth-2*i)}}_setDropZonePlaceholderVisible(e){e?(this._adjustDropZonePlaceholder(),this._$dropZonePlaceholder.css("display","")):this._$dropZonePlaceholder.css("display","none")}_shouldRaiseDragLeave(e,t){return t.isMouseOverElement(e,this.option("splitterElement"))||t._shouldRaiseDragLeaveBase(e,!0)}_uploadFiles(e,t){this._setDropZonePlaceholderVisible(!1);var i=new Re().toString(),r=this._getController(),n=t.map(()=>new ae),a={id:i,controller:r,files:t,deferreds:n};e.session=a;var s={sessionId:i,deferreds:n,files:t};return this._raiseUploadSessionStarted(s),Ot(n).always(()=>setTimeout(()=>{e.fileUploader.clear(),e.session=null}))}_getDeferredForFile(e,t){var{session:i,fileIndex:r}=this._findSessionByFile(e,t);return i.deferreds[r]}_findSessionByFile(e,t){var i=this._findUploaderInfo(e),r=i.session,n=r.files.indexOf(t);return{session:r,fileIndex:n}}_findUploaderInfoBySessionId(e){for(var t=0;t<this._uploaderInfos.length;t++){var i=this._uploaderInfos[t],r=i.session;if(r&&r.id===e)return i}return null}_findAndUpdateAvailableUploaderInfo(){for(var e,t=null,i=0;i<this._uploaderInfos.length;i++){var r=this._uploaderInfos[i];r.fileUploader.option("dropZone",""),!t&&!r.session&&(t=r)}return(e=t)===null||e===void 0||e.fileUploader.option("dropZone",this.option("dropZone")),t}_findUploaderInfo(e){for(var t=0;t<this._uploaderInfos.length;t++){var i=this._uploaderInfos[t];if(i.fileUploader===e)return i}return null}_getController(){var e=this.option("getController");return e()}_raiseUploadSessionStarted(e){this._actions.onUploadSessionStarted({sessionInfo:e})}_raiseUploadProgress(e){this._actions.onUploadProgress(e)}_raiseUploadFinished(e){this._actions.onUploadFinished(e)}_initActions(){this._actions={onUploadSessionStarted:this._createActionByOption("onUploadSessionStarted"),onUploadProgress:this._createActionByOption("onUploadProgress"),onUploadFinished:this._createActionByOption("onUploadFinished")}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{getController:null,onUploadSessionStarted:null,onUploadProgress:null,onUploadFinished:null,splitterElement:null})}_optionChanged(e){var t=e.name;switch(t){case"getController":this.repaint();break;case"onUploadSessionStarted":case"onUploadProgress":case"onUploadFinished":this._actions[t]=this._createActionByOption(t);break;case"dropZone":this._findAndUpdateAvailableUploaderInfo(),this._adjustDropZonePlaceholder();break;case"dropZonePlaceholderContainer":this._$dropZonePlaceholder.detach(),this._$dropZonePlaceholder.appendTo(e.value);break;case"splitterElement":break;default:super._optionChanged(e)}}}var Hs={get:(w,e)=>{switch(w){case ge.NoAccess:return $.format("dxFileManager-errorNoAccess");case ge.FileExists:return $.format("dxFileManager-errorFileExistsFormat",e);case ge.FileNotFound:return $.format("dxFileManager-errorFileNotFoundFormat",e);case ge.DirectoryExists:return $.format("dxFileManager-errorDirectoryExistsFormat",e);case ge.DirectoryNotFound:return $.format("dxFileManager-errorDirectoryNotFoundFormat",e);case ge.WrongFileExtension:return $.format("dxFileManager-errorWrongFileExtension");case ge.MaxFileSizeExceeded:return $.format("dxFileManager-errorMaxFileSizeExceeded");case ge.InvalidSymbols:return $.format("dxFileManager-errorInvalidSymbols")}return $.format("dxFileManager-errorDefault")}};class js extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._controller=this.option("controller"),this._controller.on("EditActionStarting",this._onEditActionStarting.bind(this)),this._controller.on("EditActionResultAcquired",this._onEditActionResultAcquired.bind(this)),this._controller.on("EditActionItemError",this._onEditActionItemError.bind(this)),this._controller.on("EditActionError",this._onEditActionError.bind(this)),this._controller.on("CompleteEditActionItem",this._onCompleteEditActionItem.bind(this)),this._controller.on("CompleteEditAction",this._onCompleteEditAction.bind(this)),this._model=this.option("model"),this._uploadOperationInfoMap={},this._dialogManager=new Vs(this.$element(),{chooseDirectoryDialog:{provider:this._controller._fileProvider,getDirectories:this._controller.getDirectories.bind(this._controller),getCurrentDirectory:this._controller.getCurrentDirectory.bind(this._controller)},rtlEnabled:this.option("rtlEnabled"),onDialogClosed:this._onDialogClosed.bind(this)}),this._fileUploader=this._createFileUploader();var e=this.option("notificationControl");e&&this._initNotificationControl(e),this._createMetadataMap()}_initNotificationControl(e){this._notificationControl=e,this._notificationControl.option({onOperationCanceled:t=>{var{info:i}=t;return this._onCancelUploadSession(i)},onOperationItemCanceled:t=>{var{item:i,itemIndex:r}=t;return this._onCancelFileUpload(i,r)}})}_getFileUploaderComponent(){return Ws}_createFileUploader(){var e=O("<div>").appendTo(this.$element());return this._createComponent(e,this._getFileUploaderComponent(),{getController:this._getFileUploaderController.bind(this),dropZonePlaceholderContainer:this.option("uploadDropZonePlaceholderContainer"),onUploadSessionStarted:t=>this._onUploadSessionStarted(t),onUploadProgress:t=>this._onUploadProgress(t),onUploadFinished:t=>this._onUploadFinished(t)})}setUploaderDropZone(e){this._fileUploader.option("dropZone",e)}setUploaderSplitterElement(e){this._fileUploader.option("splitterElement",e)}_getFileUploaderController(){var e=this.uploadDirectoryInfo.fileItem;return{chunkSize:this._controller.getFileUploadChunkSize(),uploadFileChunk:(t,i)=>this._controller.uploadFileChunk(t,i,e),abortFileUpload:(t,i)=>this._controller.abortFileUpload(t,i,e)}}_createMetadataMap(){this._metadataMap={create:{action:e=>this._tryCreate(e),affectsAllItems:!0,singleItemProcessingMessage:$.format("dxFileManager-editingCreateSingleItemProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingCreateSingleItemSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingCreateSingleItemErrorMessage"),commonErrorMessage:$.format("dxFileManager-editingCreateCommonErrorMessage")},rename:{action:e=>this._tryRename(e),singleItemProcessingMessage:$.format("dxFileManager-editingRenameSingleItemProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingRenameSingleItemSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingRenameSingleItemErrorMessage"),commonErrorMessage:$.format("dxFileManager-editingRenameCommonErrorMessage")},delete:{action:e=>this._tryDelete(e),singleItemProcessingMessage:$.format("dxFileManager-editingDeleteSingleItemProcessingMessage"),multipleItemsProcessingMessage:$.format("dxFileManager-editingDeleteMultipleItemsProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingDeleteSingleItemSuccessMessage"),multipleItemsSuccessMessage:$.format("dxFileManager-editingDeleteMultipleItemsSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingDeleteSingleItemErrorMessage"),multipleItemsErrorMessage:$.format("dxFileManager-editingDeleteMultipleItemsErrorMessage"),commonErrorMessage:$.format("dxFileManager-editingDeleteCommonErrorMessage")},move:{action:e=>this._tryMove(e),singleItemProcessingMessage:$.format("dxFileManager-editingMoveSingleItemProcessingMessage"),multipleItemsProcessingMessage:$.format("dxFileManager-editingMoveMultipleItemsProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingMoveSingleItemSuccessMessage"),multipleItemsSuccessMessage:$.format("dxFileManager-editingMoveMultipleItemsSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingMoveSingleItemErrorMessage"),multipleItemsErrorMessage:$.format("dxFileManager-editingMoveMultipleItemsErrorMessage"),commonErrorMessage:$.format("dxFileManager-editingMoveCommonErrorMessage")},copy:{action:e=>this._tryCopy(e),singleItemProcessingMessage:$.format("dxFileManager-editingCopySingleItemProcessingMessage"),multipleItemsProcessingMessage:$.format("dxFileManager-editingCopyMultipleItemsProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingCopySingleItemSuccessMessage"),multipleItemsSuccessMessage:$.format("dxFileManager-editingCopyMultipleItemsSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingCopySingleItemErrorMessage"),multipleItemsErrorMessage:$.format("dxFileManager-editingCopyMultipleItemsErrorMessage"),commonErrorMessage:$.format("dxFileManager-editingCopyCommonErrorMessage")},upload:{action:e=>this._tryUpload(e),allowCancel:!0,allowItemProgress:!0,singleItemProcessingMessage:$.format("dxFileManager-editingUploadSingleItemProcessingMessage"),multipleItemsProcessingMessage:$.format("dxFileManager-editingUploadMultipleItemsProcessingMessage"),singleItemSuccessMessage:$.format("dxFileManager-editingUploadSingleItemSuccessMessage"),multipleItemsSuccessMessage:$.format("dxFileManager-editingUploadMultipleItemsSuccessMessage"),singleItemErrorMessage:$.format("dxFileManager-editingUploadSingleItemErrorMessage"),multipleItemsErrorMessage:$.format("dxFileManager-editingUploadMultipleItemsErrorMessage"),canceledMessage:$.format("dxFileManager-editingUploadCanceledMessage")},download:{action:e=>this._download(e),singleItemProcessingMessage:"",multipleItemsProcessingMessage:"",singleItemErrorMessage:$.format("dxFileManager-editingDownloadSingleItemErrorMessage"),multipleItemsErrorMessage:$.format("dxFileManager-editingDownloadMultipleItemsErrorMessage")},getItemContent:{action:e=>this._getItemContent(e)},getItems:{singleItemProcessingMessage:"",singleItemErrorMessage:$.format("dxFileManager-errorDirectoryOpenFailed"),commonErrorMessage:$.format("dxFileManager-errorDirectoryOpenFailed")}}}getCommandActions(){var e={};return Ae(this._metadataMap,t=>{Object.prototype.hasOwnProperty.call(this._metadataMap,t)&&(e[t]=i=>this._executeAction(t,i))}),e}_executeAction(e,t){var i=this._metadataMap[e];return i?i.action(t):null}_onCancelUploadSession(e){this._fileUploader.cancelUpload(e.uploadSessionId)}_onCancelFileUpload(e,t){this._fileUploader.cancelFileUpload(e.info.uploadSessionId,t)}_onUploadProgress(e){var{sessionId:t,fileIndex:i,commonValue:r,fileValue:n}=e,{operationInfo:a}=this._uploadOperationInfoMap[t];this._notificationControl.updateOperationItemProgress(a,i,100*n,100*r)}_onUploadFinished(e){var{sessionId:t,commonValue:i}=e,{operationInfo:r}=this._uploadOperationInfoMap[t];this._notificationControl.finishOperation(r,100*i),this._scheduleUploadSessionDisposal(t,"uploader")}_onUploadSessionStarted(e){var{sessionInfo:t}=e;this._controller.processUploadSession(t,this.uploadDirectoryInfo)}_onEditActionStarting(e){var t=this._metadataMap[e.name],i=new Zs(t,e.itemInfos,e.directory),r=this._notificationControl.addOperation(i.processingMessage,t.allowCancel,!t.allowItemProgress);switch(Y(e.customData,{context:i,operationInfo:r}),e.name){case"upload":var n=e.customData.sessionInfo.sessionId;r.uploadSessionId=n,this._uploadOperationInfoMap[n]={operationInfo:r};break;case"rename":e.customData.context.itemNewName=e.customData.itemNewName}}_onEditActionResultAcquired(e){var{context:t,operationInfo:i}=e.customData;t.singleRequest=e.singleRequest;var r=t.itemInfos.map(n=>this._getItemProgressDisplayInfo(n));this._notificationControl.addOperationDetails(i,r,t.actionMetadata.allowCancel)}_onEditActionError(e,t){var{context:i,operationInfo:r}=e.customData;i.singleRequest=e.singleRequest,this._handleActionError(r,i,t),this._completeAction(r,i)}_onEditActionItemError(e,t){var{context:i,operationInfo:r}=e.customData;this._handleActionError(r,i,t)}_onCompleteEditActionItem(e,t){var{context:i,operationInfo:r}=e.customData;(!t.result||!t.result.canceled)&&(i.completeOperationItem(t.index),this._notificationControl.completeOperationItem(r,t.index,i.commonProgress))}_onCompleteEditAction(e){var{context:t,operationInfo:i}=e.customData;this._completeAction(i,t),e.name==="upload"&&this._scheduleUploadSessionDisposal(e.customData.sessionInfo.sessionId,"controller")}_scheduleUploadSessionDisposal(e,t){ne(this._uploadOperationInfoMap[e].requester)&&this._uploadOperationInfoMap[e].requester!==t?delete this._uploadOperationInfoMap[e]:this._uploadOperationInfoMap[e].requester=t}_tryCreate(e){var t=e&&e[0]||this._getCurrentDirectory(),i=$.format("dxFileManager-newDirectoryName");return this._showDialog(this._dialogManager.getCreateItemDialog(),i).then(r=>{var{name:n}=r;return this._controller.createDirectory(t,n)})}_tryRename(e){var t=e&&e[0]||this._model.getMultipleSelectedItems()[0];return t?this._showDialog(this._dialogManager.getRenameItemDialog(),t.fileItem.name).then(i=>{var{name:r}=i;return this._controller.renameItem(t,r)}):new ae().reject().promise()}_tryDelete(e){if(e=e||this._model.getMultipleSelectedItems(),e.length===0)return new ae().reject().promise();var t=e[0].fileItem.name,i=e.length;return this._showDialog(this._dialogManager.getDeleteItemDialog(),{itemName:t,itemCount:i}).then(()=>this._controller.deleteItems(e))}_tryMove(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new ae().reject().promise():this._showDialog(this._dialogManager.getMoveDialog(e)).then(t=>{var{folder:i}=t;return this._controller.moveItems(e,i)})}_tryCopy(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new ae().reject().promise():this._showDialog(this._dialogManager.getCopyDialog(e)).then(t=>{var{folder:i}=t;return this._controller.copyItems(e,i)})}_tryUpload(e){this._uploadDirectoryInfo=e==null?void 0:e[0],this._fileUploader.tryUpload()}_download(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new ae().reject().promise():this._controller.downloadItems(e)}_getItemContent(e){return e=e||this._model.getMultipleSelectedItems(),this._controller.getItemContent(e)}_completeAction(e,t){this._notificationControl.completeOperation(e,t.completionMessage,!t.success,t.statusText),t.hasModifiedItems()&&this._raiseOnSuccess(t.onlyFiles)}_handleActionError(e,t,i){e.hasError=!0,t.singleRequest?this._handleSingleRequestActionError(e,t,i):this._handleMultipleRequestActionError(e,t,i)}_handleSingleRequestActionError(e,t,i){var r=t.getItemForSingleRequestError(),n=t.getItemName(i.errorCode),a=this._getErrorText(i,r,n);t.processSingleRequestError(a);var s=this._getOperationErrorInfo(t);this._notificationControl.completeSingleOperationWithError(e,s),t.multipleItems&&this._raiseOnSuccess(t.onlyFiles)}_handleMultipleRequestActionError(e,t,i){var r=t.getItemForMultipleRequestError(i.index),n=t.getItemName(i.errorCode,i.index),a=this._getErrorText(i,r,n);t.processMultipleRequestError(i.index,a);var s=this._getOperationErrorInfo(t);this._notificationControl.addOperationDetailsError(e,s)}_getOperationErrorInfo(e){var t=e.errorState.currentDetailError;return{commonErrorText:e.errorState.commonErrorText,item:t.itemInfo?this._getItemProgressDisplayInfo(t.itemInfo):null,itemIndex:t.itemIndex,detailErrorText:t.errorText}}_getErrorText(e,t,i){var r=e.errorText||Hs.get(e.errorCode,i),n={fileSystemItem:t==null?void 0:t.fileItem,errorCode:e.errorCode,errorText:r};return this._raiseOnError(n),n.errorText}_getItemProgressDisplayInfo(e){return{commonText:e.fileItem.name,imageUrl:this._getItemThumbnail(e)}}_showDialog(e,t){return this._dialogDeferred=new ae,e.show(t),this._dialogDeferred.promise()}_onDialogClosed(e){var t=e.dialogResult;t?this._dialogDeferred.resolve(t):this._dialogDeferred.reject()}updateDialogRtl(e){this._dialogManager.updateDialogRtl(e)}_getItemThumbnail(e){var t=this.option("getItemThumbnail");if(!t)return null;var i=t(e);return i?i.thumbnail:null}_initActions(){this._actions={onSuccess:this._createActionByOption("onSuccess"),onError:this._createActionByOption("onError")}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{model:{getMultipleSelectedItems:null},notificationControl:null,getItemThumbnail:null,onSuccess:null,onError:null})}_optionChanged(e){var t=e.name;switch(t){case"model":this.repaint();break;case"notificationControl":this._initNotificationControl(e.value);break;case"getItemThumbnail":break;case"uploadDropZonePlaceholderContainer":this._fileUploader.option("dropZonePlaceholderContainer",e.value);break;case"onSuccess":case"onError":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_raiseOnSuccess(e){this._actions.onSuccess({updatedOnlyFiles:e})}_raiseOnError(e){this._actions.onError(e)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}get uploadDirectoryInfo(){return this._uploadDirectoryInfo||this._getCurrentDirectory()}}class Zs{constructor(e,t,i){this._actionMetadata=e,this._itemInfos=t,this._onlyFiles=!this._actionMetadata.affectsAllItems&&this._itemInfos.every(r=>!r.fileItem.isDirectory),this._items=this._itemInfos.map(r=>r.fileItem),this._multipleItems=this._items.length>1,this._location=i.getDisplayName(),this._singleRequest=!0,this._completedItems=[],this._commonProgress=0,this._errorState={failedCount:0},this._itemNewName=""}completeOperationItem(e){if(this._singleRequest)this._completedItems=[...this._items];else{var t=this._items[e];this._completedItems.push(t)}this._actionMetadata.allowItemProgress||(this._commonProgress=this._completedItems.length/this._items.length*100)}processSingleRequestError(e){this._errorState.failedCount=1,this._errorState.commonErrorText=this._multipleItems?this._actionMetadata.commonErrorMessage:this._actionMetadata.singleItemErrorMessage;var t=this._multipleItems?-1:1,i=this.getItemForSingleRequestError();this._setCurrentDetailError(t,i,e)}processMultipleRequestError(e,t){this._errorState.failedCount++,this._errorState.commonErrorText=this._errorState.failedCount>1?je(this._actionMetadata.multipleItemsErrorMessage,this._errorState.failedCount):this._actionMetadata.singleItemErrorMessage;var i=this.getItemForMultipleRequestError(e);this._setCurrentDetailError(e,i,t)}hasModifiedItems(){return this._hasCompletedItems()||this._singleRequest&&!this.success&&this._multipleItems}getItemForSingleRequestError(){return this._multipleItems?null:this._itemInfos[0]}getItemForMultipleRequestError(e){return this._itemInfos[e]}getItemName(e,t){var i=this.singleRequest?this.getItemForSingleRequestError():this.getItemForMultipleRequestError(t),r=i==null?void 0:i.fileItem.name;return this.itemNewName&&this._isItemExistsErrorCode(e)&&(r=this.itemNewName),r}_isItemExistsErrorCode(e){return e===ge.DirectoryExists||e===ge.FileExists}_setCurrentDetailError(e,t,i){this._errorState.currentDetailError={itemIndex:e,itemInfo:t,errorText:i}}_hasCompletedItems(){return this._completedItems.length>0}get actionMetadata(){return this._actionMetadata}get itemInfos(){return this._itemInfos}get itemNewName(){return this._itemNewName}set itemNewName(e){this._itemNewName=e}get errorState(){return this._errorState}get singleRequest(){return this._singleRequest}set singleRequest(e){this._singleRequest=e}get multipleItems(){return this._multipleItems}get onlyFiles(){return this._onlyFiles}get processingMessage(){return this._multipleItems?je(this._actionMetadata.multipleItemsProcessingMessage,this._items.length,this._location):je(this._actionMetadata.singleItemProcessingMessage,this._location)}get successMessage(){return this._hasCompletedItems()?this._multipleItems?je(this._actionMetadata.multipleItemsSuccessMessage,this._completedItems.length,this._location):je(this._actionMetadata.singleItemSuccessMessage,this._location):this._multipleItems?je(this._actionMetadata.multipleItemsErrorMessage,this._items.length):this._actionMetadata.singleItemErrorMessage}get completionMessage(){return this.success?this.successMessage:this.errorState.commonErrorText}get statusText(){return this.success&&!this._hasCompletedItems()?this._actionMetadata.canceledMessage:void 0}get commonProgress(){return this._commonProgress}get success(){return!this._errorState.failedCount}}var St="dx-filemanager-breadcrumbs",qs=St+"-parent-folder-item",Xs=St+"-separator-item",Ys=St+"-path-separator-item";class Js extends Ce{_init(){super._init(),this._currentDirectory=null}_initMarkup(){super._initMarkup(),this._initActions(),this._currentDirectory&&this._renderMenu(),this.$element().addClass(St)}setCurrentDirectory(e){this._areDirsEqual(this._currentDirectory,e)||(this._currentDirectory=e,this.repaint())}_renderMenu(){var e=O("<div>").appendTo(this.$element());this._menu=this._createComponent(e,Vr,{dataSource:this._getMenuItems(),onItemClick:this._onItemClick.bind(this),onItemRendered:this._onItemRendered.bind(this)})}_getMenuItems(){var e=this._getParentDirsLine(),t=[{icon:"arrowup",directory:this._currentDirectory.parentDirectory,isPathItem:!0,cssClass:qs},{text:"",cssClass:Xs}];return e.forEach((i,r)=>{t.push({text:i.getDisplayName(),directory:i,isPathItem:!0}),r!==e.length-1&&t.push({icon:"spinnext",cssClass:Ys})}),t}_onItemClick(e){var{itemData:t}=e;if(t.isPathItem){var i=t.directory;this._areDirsEqual(i,this._currentDirectory)||this._raiseCurrentDirectoryChanged(i)}}_onItemRendered(e){var{itemElement:t,itemData:i}=e;i.cssClass&&O(t).addClass(i.cssClass)}_getParentDirsLine(){for(var e=this._currentDirectory,t=[];e;)t.unshift(e),e=e.parentDirectory;return t}_areDirsEqual(e,t){return e&&t&&e===t&&e.fileItem.key===t.fileItem.key}_initActions(){this._actions={onCurrentDirectoryChanging:this._createActionByOption("onCurrentDirectoryChanging")}}_raiseCurrentDirectoryChanged(e){this._actions.onCurrentDirectoryChanging({currentDirectory:e})}_getDefaultOptions(){return Y(super._getDefaultOptions(),{rootFolderDisplayName:"Files",onCurrentDirectoryChanging:null})}_optionChanged(e){var t=e.name;switch(t){case"rootFolderDisplayName":this.repaint();break;case"onCurrentDirectoryChanging":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}var Si=Ge(),ct="dx-splitter",Qs="".concat(ct,"-wrapper"),Ft="".concat(ct,"-inactive"),eo="".concat(ct,"-border"),Mt="".concat(ct,"-initial"),bi="dx-state-disabled",Tt="dxSplitterResizing";class to extends Ce{_init(){super._init();var e=new Re().toString();this.SPLITTER_POINTER_DOWN_EVENT_NAME=we(gt.down,Tt+e),this.SPLITTER_POINTER_MOVE_EVENT_NAME=we(gt.move,Tt+e),this.SPLITTER_POINTER_UP_EVENT_NAME=we(gt.up,Tt+e)}_initMarkup(){super._initMarkup(),this._initActions(),this._$container=this.option("container"),this._$leftElement=this.option("leftElement"),this._$rightElement=this.option("rightElement"),this.$element().addClass(Qs).addClass(Mt),this._$splitterBorder=O("<div>").addClass(eo).appendTo(this.$element()),this._$splitter=O("<div>").addClass(ct).addClass(Ft).appendTo(this._$splitterBorder)}_initActions(){this._actions={onApplyPanelSize:this._createActionByOption("onApplyPanelSize"),onActiveStateChanged:this._createActionByOption("onActiveStateChanged")}}_render(){super._render(),this._detachEventHandlers(),this._attachEventHandlers()}_clean(){this._detachEventHandlers(),super._clean()}_attachEventHandlers(){var e=ot.getDocument();de.on(this._$splitterBorder,this.SPLITTER_POINTER_DOWN_EVENT_NAME,this._onMouseDownHandler.bind(this)),de.on(e,this.SPLITTER_POINTER_MOVE_EVENT_NAME,this._onMouseMoveHandler.bind(this)),de.on(e,this.SPLITTER_POINTER_UP_EVENT_NAME,this._onMouseUpHandler.bind(this))}_detachEventHandlers(){var e=ot.getDocument();de.off(this._$splitterBorder,this.SPLITTER_POINTER_DOWN_EVENT_NAME),de.off(e,this.SPLITTER_POINTER_MOVE_EVENT_NAME),de.off(e,this.SPLITTER_POINTER_UP_EVENT_NAME)}_dimensionChanged(e){(!e||e!=="height")&&(this._containerWidth=this._$container.get(0).clientWidth,this._setSplitterPositionLeft({needUpdatePanels:!0,usePercentagePanelsWidth:!0}))}_onMouseDownHandler(e){e.preventDefault(),this._offsetX=e.pageX-this._$splitterBorder.offset().left<=this._getSplitterBorderWidth()?e.pageX-this._$splitterBorder.offset().left:0,this._containerWidth=this._$container.get(0).clientWidth,this.$element().removeClass(Mt),this._toggleActive(!0),this._setSplitterPositionLeft({needUpdatePanels:!0})}_onMouseMoveHandler(e){this._isSplitterActive&&this._setSplitterPositionLeft({splitterPositionLeft:this._getNewSplitterPositionLeft(e),needUpdatePanels:!0})}_onMouseUpHandler(){this._isSplitterActive&&(this._leftPanelPercentageWidth=null,this._toggleActive(!1),this._setSplitterPositionLeft({needUpdatePanels:!0,usePercentagePanelsWidth:!0}))}_getNewSplitterPositionLeft(e){var t=e.pageX-this._getContainerLeftOffset()-this._offsetX;return t=Math.max(0-this._getSplitterOffset(),t),t=Math.min(this._containerWidth-this._getSplitterOffset()-this._getSplitterWidth(),t),t}_getContainerLeftOffset(){var e=this._$container.offset().left;if(Si){var t=Si.getComputedStyle(this._$container.get(0)),i=parseFloat(t.paddingLeft)||0,r=parseFloat(t.borderLeftWidth)||0;e+=i+r}return e}_getSplitterOffset(){return(this._getSplitterBorderWidth()-this._getSplitterWidth())/2}_getSplitterWidth(){return this._$splitter.get(0).clientWidth}_getSplitterBorderWidth(){return this._$splitterBorder.get(0).clientWidth}_getLeftPanelWidth(){return this._$leftElement.get(0).clientWidth}getSplitterBorderElement(){return this._$splitterBorder}_toggleActive(e){this.$element().toggleClass(Ft,!e),this._$splitter.toggleClass(Ft,!e),this._isSplitterActive=e,this._actions.onActiveStateChanged({isActive:e})}toggleDisabled(e){this.$element().toggleClass(bi,e),this._$splitter.toggleClass(bi,e)}isSplitterMoved(){return!this.$element().hasClass(Mt)}disableSplitterCalculation(e){this._isSplitterCalculationDisabled=e}_setSplitterPositionLeft(){var{splitterPositionLeft:e=null,needUpdatePanels:t=!1,usePercentagePanelsWidth:i=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=e||this._getLeftPanelWidth()-this._getSplitterOffset();var r=e+this._getSplitterOffset(),n=this._containerWidth-r;this._isSplitterCalculationDisabled||this.$element().css("left",e),this._leftPanelPercentageWidth=this._leftPanelPercentageWidth||this._convertToPercentage(r);var a=this._convertToPercentage(this._containerWidth-this._convertToPixels(this._leftPanelPercentageWidth));t&&this._actions.onApplyPanelSize({leftPanelWidth:i?"".concat(this._leftPanelPercentageWidth,"%"):r,rightPanelWidth:i?"".concat(a,"%"):n})}_optionChanged(e){switch(e.name){case"initialLeftPanelWidth":this._leftPanelPercentageWidth=this._convertToPercentage(e.value),this._dimensionChanged();break;case"leftElement":this.repaint();break;case"onActiveStateChanged":case"onApplyPanelSize":this._actions[e.name]=this._createActionByOption(e.name);break;default:super._optionChanged(e)}}_convertToPercentage(e){return e/this._$container.get(0).clientWidth*100}_convertToPixels(e){return e/100*this._$container.get(0).clientWidth}}var io=Ge(),ro=573,Ei="dx-filemanager-adaptivity-drawer-panel",Ai="dx-drawer-panel-content-initial",no="dx-drawer-panel-content-adaptive";class ao extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=!1;var e=O("<div>").appendTo(this.$element());O("<div>").addClass(Ei).appendTo(e),this._drawer=this._createComponent(e,Ri),this._drawer.option({opened:!0,template:this._createDrawerTemplate.bind(this)}),O(this._drawer.content()).addClass(Ai);var t=e.find(".".concat(Ei)).first(),i=this.option("contentTemplate");Ie(i)&&i(t),this._updateDrawerMaxSize()}_createDrawerTemplate(e){this.option("drawerTemplate")(e),this._splitter=this._createComponent("<div>",to,{container:this.$element(),leftElement:O(this._drawer.content()),rightElement:O(this._drawer.viewContent()),onApplyPanelSize:this._onApplyPanelSize.bind(this),onActiveStateChanged:this._onActiveStateChanged.bind(this)}),this._splitter.$element().appendTo(e),this._splitter.disableSplitterCalculation(!0)}_render(){super._render(),this._checkAdaptiveState()}_onApplyPanelSize(e){if(Ke()){if(!this._splitter.isSplitterMoved()){this._setDrawerWidth("");return}O(this._drawer.content()).removeClass(Ai),this._setDrawerWidth(e.leftPanelWidth)}}_onActiveStateChanged(e){var{isActive:t}=e;this._splitter.disableSplitterCalculation(!t),!t&&this._splitter.$element().css("left","auto")}_setDrawerWidth(e){O(this._drawer.content()).css("width",e),this._updateDrawerMaxSize(),this._drawer.resizeViewContent()}_updateDrawerMaxSize(){this._drawer.option("maxSize",this._drawer.getRealPanelWidth())}_dimensionChanged(e){(!e||e!=="height")&&this._checkAdaptiveState()}_checkAdaptiveState(){var e=this._isInAdaptiveState;this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&(this.toggleDrawer(!this._isInAdaptiveState,!0),O(this._drawer.content()).toggleClass(no,this._isInAdaptiveState),this._raiseAdaptiveStateChanged(this._isInAdaptiveState)),this._isInAdaptiveState&&this._isDrawerOpened()&&this._updateDrawerMaxSize()}_isSmallScreen(){return Ue(io)<=ro}_isDrawerOpened(){return this._drawer.option("opened")}_initActions(){this._actions={onAdaptiveStateChanged:this._createActionByOption("onAdaptiveStateChanged")}}_raiseAdaptiveStateChanged(e){this._actions.onAdaptiveStateChanged({enabled:e})}_getDefaultOptions(){return Y(super._getDefaultOptions(),{drawerTemplate:null,contentTemplate:null,onAdaptiveStateChanged:null})}_optionChanged(e){var t=e.name;switch(t){case"drawerTemplate":case"contentTemplate":this.repaint();break;case"onAdaptiveStateChanged":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}isInAdaptiveState(){return this._isInAdaptiveState}toggleDrawer(e,t){this._updateDrawerMaxSize(),this._drawer.option("animationEnabled",!t),this._drawer.toggle(e);var i=this._isDrawerOpened()&&!this.isInAdaptiveState();this._splitter.toggleDisabled(!i)}getSplitterElement(){return this._splitter.getSplitterBorderElement().get(0)}}var He="dx-filemanager",so=He+"-wrapper",wi=He+"-container",oo=He+"-dirs-panel",lo=He+"-editing-container",ho=He+"-items-panel",co=He+"-item-custom-thumbnail",uo="[*DXPDK*]$40F96F03-FBD8-43DF-91BE-F55F4B8BA871$",Ne={folders:"navPane",items:"itemView"};class ir extends Ce{_initTemplates(){}_init(){super._init(),this._initActions(),this._providerUpdateDeferred=null,this._lockCurrentPathProcessing=!1,this._wasRendered=!1,this._controller=new la({currentPath:this.option("currentPath"),currentPathKeys:this.option("currentPathKeys"),rootText:this.option("rootFolderName"),fileProvider:this.option("fileSystemProvider"),allowedFileExtensions:this.option("allowedFileExtensions"),uploadMaxFileSize:this.option("upload").maxFileSize,uploadChunkSize:this.option("upload").chunkSize,onInitialized:this._onControllerInitialized.bind(this),onDataLoading:this._onDataLoading.bind(this),onSelectedDirectoryChanged:this._onSelectedDirectoryChanged.bind(this),onPathPotentiallyChanged:this._checkPathActuality.bind(this),editingEvents:this._actions.editing})}_initMarkup(){super._initMarkup(),this._firstItemViewLoad=!0,this._lockSelectionProcessing=!1,this._lockFocusedItemProcessing=!1,this._itemKeyToFocus=void 0,this._loadedWidgets=[],this._commandManager=new ha(this.option("permissions")),this.$element().addClass(He),this._wasRendered?this._prepareToLoad():this._wasRendered=!0,this._createNotificationControl(),this._initCommandManager()}_createNotificationControl(){var e=O("<div>").addClass("dx-filemanager-notification-container").appendTo(this.$element());this._notificationControl=this._createComponent(e,Ts,{progressPanelContainer:this.$element(),contentTemplate:(t,i)=>this._createWrapper(t,i),onActionProgress:t=>this._onActionProgress(t),positionTarget:".".concat(wi),showProgressPanel:this.option("notifications.showPanel"),showNotificationPopup:this.option("notifications.showPopup")})}_createWrapper(e,t){this._$wrapper=O("<div>").addClass(so).appendTo(e),this._createEditing(t);var i=O("<div>").appendTo(this._$wrapper);this._toolbar=this._createComponent(i,Qa,{commandManager:this._commandManager,generalItems:this.option("toolbar.items"),fileItems:this.option("toolbar.fileSelectionItems"),itemViewMode:this.option("itemView").mode,onItemClick:r=>this._actions.onToolbarItemClick(r)}),this._createAdaptivityControl()}_createAdaptivityControl(){var e=O("<div>").addClass(wi).appendTo(this._$wrapper);this._adaptivityControl=this._createComponent(e,ao,{drawerTemplate:t=>this._createFilesTreeView(t),contentTemplate:t=>this._createItemsPanel(t),onAdaptiveStateChanged:t=>this._onAdaptiveStateChanged(t)}),this._editing.setUploaderSplitterElement(this._adaptivityControl.getSplitterElement())}_createEditing(e){var t=O("<div>").addClass(lo).appendTo(this.$element());this._editing=this._createComponent(t,js,{controller:this._controller,model:{getMultipleSelectedItems:this._getSelectedItemInfos.bind(this)},getItemThumbnail:this._getItemThumbnailInfo.bind(this),notificationControl:e,uploadDropZonePlaceholderContainer:this.$element(),rtlEnabled:this.option("rtlEnabled"),onSuccess:i=>{var{updatedOnlyFiles:r}=i;return this._redrawComponent(r)},onError:i=>this._onEditingError(i)})}_createItemsPanel(e){this._$itemsPanel=O("<div>").addClass(ho).appendTo(e),this._createBreadcrumbs(this._$itemsPanel),this._createItemView(this._$itemsPanel),this._updateUploadDropZone()}_updateUploadDropZone(){var e=this._commandManager.isCommandAvailable("upload")?this._$itemsPanel:O();this._editing.setUploaderDropZone(e)}_createFilesTreeView(e){this._filesTreeViewContextMenu=this._createContextMenu(!1,Ne.folders);var t=O("<div>").addClass(oo).appendTo(e);this._filesTreeView=this._createComponent(t,Ji,{storeExpandedState:!0,contextMenu:this._filesTreeViewContextMenu,getDirectories:this.getDirectories.bind(this),getCurrentDirectory:this._getCurrentDirectory.bind(this),onDirectoryClick:i=>{var{itemData:r}=i;return this._setCurrentDirectory(r)},onItemListDataLoaded:()=>this._tryEndLoading(Ne.folders)}),this._filesTreeView.updateCurrentDirectory()}_createItemView(e,t){this._itemViewContextMenu=this._createContextMenu(!0,Ne.items);var i=this.option("itemView"),r={selectionMode:this.option("selectionMode"),selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),contextMenu:this._itemViewContextMenu,getItems:this._getItemViewItems.bind(this),onError:s=>{var{error:d}=s;return this._showError(d)},onSelectionChanged:this._onItemViewSelectionChanged.bind(this),onFocusedItemChanged:this._onItemViewFocusedItemChanged.bind(this),onSelectedItemOpened:this._onSelectedItemOpened.bind(this),onContextMenuShowing:s=>this._onContextMenuShowing(Ne.items,s),onItemListItemsLoaded:()=>this._tryEndLoading(Ne.items),getItemThumbnail:this._getItemThumbnailInfo.bind(this),customizeDetailColumns:this.option("customizeDetailColumns"),detailColumns:this.option("itemView.details.columns")},n=O("<div>").appendTo(e);t=t||i.mode;var a=t==="thumbnails"?Ka:Fa;this._itemView=this._createComponent(n,a,r)}_createBreadcrumbs(e){var t=O("<div>").appendTo(e);this._breadcrumbs=this._createComponent(t,Js,{rootFolderDisplayName:this.option("rootFolderName"),onCurrentDirectoryChanging:i=>{var{currentDirectory:r}=i;return this._setCurrentDirectory(r,!0)}}),this._breadcrumbs.setCurrentDirectory(this._getCurrentDirectory())}_createContextMenu(e,t){var i=O("<div>").appendTo(this._$wrapper);return this._createComponent(i,pa,{commandManager:this._commandManager,items:this.option("contextMenu.items"),onItemClick:r=>this._actions.onContextMenuItemClick(r),onContextMenuShowing:r=>this._onContextMenuShowing(t,r),isolateCreationItemCommands:e,viewArea:t})}_initCommandManager(){var e=Y(this._editing.getCommandActions(),{refresh:()=>this._refreshAndShowProgress(),thumbnails:()=>this.option("itemView.mode","thumbnails"),details:()=>this.option("itemView.mode","details"),clearSelection:()=>this._clearSelection(),showNavPane:()=>this._adaptivityControl.toggleDrawer()});this._commandManager.registerActions(e)}_onItemViewSelectionChanged(e){var{selectedItemInfos:t,selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:n,currentDeselectedItemKeys:a}=e;this._lockSelectionProcessing=!0,this.option("selectedItemKeys",r),this._lockSelectionProcessing=!1,this._actions.onSelectionChanged({selectedItems:i,selectedItemKeys:r,currentSelectedItemKeys:n,currentDeselectedItemKeys:a}),this._updateToolbar(t)}_onItemViewFocusedItemChanged(e){this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._actions.onFocusedItemChanged({item:e.item,itemElement:e.itemElement})}_onAdaptiveStateChanged(e){var{enabled:t}=e;this._commandManager.setCommandEnabled("showNavPane",t),this._updateToolbar()}_onActionProgress(e){var{message:t,status:i}=e;this._toolbar.updateRefreshItem(t,i),this._updateToolbar()}_onEditingError(e){var t=Ve({},e,["errorCode","errorText","fileSystemItem"]);this._actions.onErrorOccurred(t),e.errorText=t.errorText}_refreshAndShowProgress(){return this._prepareToLoad(),fe(this._notificationControl.tryShowProgressPanel(),this._controller.refresh()).then(()=>this._filesTreeView.refresh())}_isAllWidgetsLoaded(){return this._loadedWidgets.length===2&&this._loadedWidgets.indexOf(Ne.folders)!==-1&&this._loadedWidgets.indexOf(Ne.items)!==-1}_tryEndLoading(e){this._loadedWidgets.push(e),this._isAllWidgetsLoaded()&&this._controller.endSingleLoad()}_prepareToLoad(){this._loadedWidgets=[],this._controller.startSingleLoad()}_updateToolbar(e){var t=e||this._getSelectedItemInfos();this._toolbar.option("contextItems",ve(t,[]))}_switchView(e){this._disposeWidget(this._itemView.option("contextMenu")),this._disposeWidget(this._itemView),this._createItemView(this._$itemsPanel,e),this._toolbar.option({itemViewMode:e})}_disposeWidget(e){e.dispose(),e.$element().remove()}_clearSelection(){this._itemView.clearSelection()}_showError(e){this._showNotification(e,!1)}_showNotification(e,t){jn({message:e,width:450},t?"success":"error",5e3)}_redrawComponent(e){this._itemView.refresh().then(()=>!e&&this._filesTreeView.refresh())}_getItemViewItems(){var e=this.option("itemView").showFolders,t=this._controller.getCurrentItems(!e);return this._updateToolbarWithSelectionOnFirstLoad(t),this.option("itemView.showParentFolder")&&(t=fe(t).then(i=>this._getPreparedItemViewItems(i))),t}_updateToolbarWithSelectionOnFirstLoad(e){if(this._firstItemViewLoad){this._firstItemViewLoad=!1;var t=this.option("selectedItemKeys");t.length>0&&fe(e).done(i=>{var r=ta(i,t);r.length>0&&this._updateToolbar(r)})}}_getPreparedItemViewItems(e){var t=this._getCurrentDirectory();if(t.fileItem.isRoot())return e;var i=t.fileItem.createClone();i.isParentFolder=!0,i.name="..",i.relativeName="..",i.key="".concat(uo).concat(t.fileItem.key);var r=[...e];return r.unshift({fileItem:i,icon:"parentfolder"}),r}_onContextMenuShowing(e,t){var i,r=Ve({},t,["targetElement","cancel","event"]);r=Y(r,{viewArea:e,fileSystemItem:(i=t.itemData)===null||i===void 0?void 0:i.fileItem,_isActionButton:t.isActionButton}),this._actions.onContextMenuShowing(r),t.cancel=ve(r.cancel,!1)}_getItemThumbnailInfo(e){var t=this.option("customizeThumbnail"),i=Ie(t)?t(e.fileItem):e.fileItem.thumbnail;return i?{thumbnail:i,cssClass:co}:{thumbnail:e.icon}}_getDefaultOptions(){return Y(super._getDefaultOptions(),{fileSystemProvider:null,currentPath:"",currentPathKeys:[],rootFolderName:$.format("dxFileManager-rootDirectoryName"),selectionMode:"multiple",selectedItemKeys:[],focusedItemKey:void 0,toolbar:{items:["showNavPane","create","upload","switchView",{name:"separator",location:"after"},"refresh"],fileSelectionItems:["download","separator","move","copy","rename","separator","delete","clearSelection",{name:"separator",location:"after"},"refresh"]},contextMenu:{items:["create","upload","rename","move","copy","delete","refresh","download"]},itemView:{details:{columns:["thumbnail","name","dateModified","size"]},mode:"details",showFolders:!0,showParentFolder:!0},customizeThumbnail:null,customizeDetailColumns:null,onContextMenuItemClick:null,onContextMenuShowing:null,onCurrentDirectoryChanged:null,onSelectedFileOpened:null,onSelectionChanged:null,onFocusedItemChanged:null,onToolbarItemClick:null,onErrorOccurred:null,onDirectoryCreating:null,onDirectoryCreated:null,onItemRenaming:null,onItemRenamed:null,onItemDeleting:null,onItemDeleted:null,onItemCopying:null,onItemCopied:null,onItemMoving:null,onItemMoved:null,onFileUploading:null,onFileUploaded:null,onItemDownloading:null,allowedFileExtensions:[],upload:{maxFileSize:0,chunkSize:2e5},permissions:Y({},Xi),notifications:{showPanel:!0,showPopup:!0}})}option(e,t){var i=Wr(e,t),r=arguments.length<2&&Kr(e)!=="object",n=s=>ne(i[s]),a=s=>{if(!n(s))return!1;var d=this.option(s),m=i[s];return!Gr(d,m)};return!r&&n("fileSystemProvider")&&(this._providerUpdateDeferred=new ae,(a("currentPath")||a("currentPathKeys"))&&(this._lockCurrentPathProcessing=!0)),super.option(...arguments)}_optionChanged(e){var t=e.name;switch(t){case"currentPath":var i=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPath(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(i):i();break;case"currentPathKeys":var r=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPathByKeys(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(r):r();break;case"selectedItemKeys":!this._lockSelectionProcessing&&this._itemView&&this._itemView.option("selectedItemKeys",e.value);break;case"focusedItemKey":!this._lockFocusedItemProcessing&&this._itemView&&this._itemView.option("focusedItemKey",e.value);break;case"rootFolderName":this._controller.setRootText(e.value),this._invalidate();break;case"fileSystemProvider":this._lockCurrentPathProcessing||(this._providerUpdateDeferred=new ae);var n=this._lockCurrentPathProcessing?void 0:this.option("currentPathKeys");this._controller.updateProvider(e.value,n).then(()=>this._providerUpdateDeferred.resolve()).always(()=>{this._providerUpdateDeferred=null,this.repaint()});break;case"allowedFileExtensions":this._controller.setAllowedFileExtensions(e.value),this._invalidate();break;case"upload":this._controller.setUploadOptions(this.option("upload")),this._invalidate();break;case"permissions":this._commandManager.updatePermissions(this.option("permissions")),this._filesTreeViewContextMenu.tryUpdateVisibleContextMenu(),this._itemViewContextMenu.tryUpdateVisibleContextMenu(),this._toolbar.updateItemPermissions(),this._updateUploadDropZone();break;case"selectionMode":case"customizeThumbnail":case"customizeDetailColumns":this._invalidate();break;case"itemView":e.fullName==="itemView.mode"?this._switchView(e.value):this._invalidate();break;case"toolbar":var a={};e.fullName==="toolbar"&&(e.value.items&&(a.generalItems=e.value.items),e.value.fileSelectionItems&&(a.fileItems=e.value.fileSelectionItems)),e.fullName.indexOf("toolbar.items")===0&&(a.generalItems=this.option("toolbar.items")),e.fullName.indexOf("toolbar.fileSelectionItems")===0&&(a.fileItems=this.option("toolbar.fileSelectionItems")),this._toolbar.option(a);break;case"contextMenu":if(e.fullName==="contextMenu"&&e.value.items||e.fullName.indexOf("contextMenu.items")===0){var s=this.option("contextMenu.items");this._filesTreeViewContextMenu.option("items",s),this._itemViewContextMenu.option("items",s)}break;case"notifications":this._notificationControl.option("showProgressPanel",this.option("notifications.showPanel")),this._notificationControl.option("showNotificationPopup",this.option("notifications.showPopup"));break;case"onContextMenuItemClick":case"onContextMenuShowing":case"onCurrentDirectoryChanged":case"onSelectedFileOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onToolbarItemClick":case"onErrorOccurred":this._actions[t]=this._createActionByOption(t);break;case"onDirectoryCreating":case"onDirectoryCreated":case"onItemRenaming":case"onItemRenamed":case"onItemDeleting":case"onItemDeleted":case"onItemCopying":case"onItemCopied":case"onItemMoving":case"onItemMoved":case"onFileUploading":case"onFileUploaded":case"onItemDownloading":this._actions.editing[t]=this._createActionByOption(t);break;case"rtlEnabled":this._editing.updateDialogRtl(e.value),super._optionChanged(e);break;default:super._optionChanged(e)}}_initActions(){this._actions={onContextMenuItemClick:this._createActionByOption("onContextMenuItemClick"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onCurrentDirectoryChanged:this._createActionByOption("onCurrentDirectoryChanged"),onSelectedFileOpened:this._createActionByOption("onSelectedFileOpened"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onToolbarItemClick:this._createActionByOption("onToolbarItemClick"),onErrorOccurred:this._createActionByOption("onErrorOccurred"),editing:{onDirectoryCreating:this._createActionByOption("onDirectoryCreating"),onDirectoryCreated:this._createActionByOption("onDirectoryCreated"),onItemRenaming:this._createActionByOption("onItemRenaming"),onItemRenamed:this._createActionByOption("onItemRenamed"),onItemDeleting:this._createActionByOption("onItemDeleting"),onItemDeleted:this._createActionByOption("onItemDeleted"),onItemCopying:this._createActionByOption("onItemCopying"),onItemCopied:this._createActionByOption("onItemCopied"),onItemMoving:this._createActionByOption("onItemMoving"),onItemMoved:this._createActionByOption("onItemMoved"),onFileUploading:this._createActionByOption("onFileUploading"),onFileUploaded:this._createActionByOption("onFileUploaded"),onItemDownloading:this._createActionByOption("onItemDownloading")}}}executeCommand(e){return this._commandManager.executeCommand(e)}_setCurrentDirectory(e,t){this._controller.setCurrentDirectory(e,t)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}_onControllerInitialized(e){var{controller:t}=e;this._controller=this._controller||t,this._syncToCurrentDirectory()}_onDataLoading(e){var{operation:t}=e,i=null;t===Xe.NAVIGATION&&(i={focusedItemKey:this._itemKeyToFocus,selectedItemKeys:this.option("selectedItemKeys")},this._itemKeyToFocus=void 0),this._itemView.refresh(i,t)}_onSelectedDirectoryChanged(){var e=this._getCurrentDirectory();this._syncToCurrentDirectory(),this._actions.onCurrentDirectoryChanged({directory:e.fileItem})}_syncToCurrentDirectory(){var e=this._getCurrentDirectory();this._filesTreeView&&this._filesTreeView.updateCurrentDirectory(),this._breadcrumbs&&this._breadcrumbs.setCurrentDirectory(e),this._checkPathActuality()}_checkPathActuality(){if(!this._lockCurrentPathProcessing){var e=this._controller.getCurrentPath(),t=this._controller.getCurrentPathKeys(),i={};this.option("currentPath")!==e&&(i.currentPath=e),Oi(this.option("currentPathKeys"),t)||(i.currentPathKeys=t),Pi(i)||this.option(i)}}getDirectories(e,t){return this._controller.getDirectories(e,t)}_getSelectedItemInfos(){return this._itemView?this._itemView.getSelectedItems():[]}refresh(){return this.executeCommand("refresh")}getCurrentDirectory(){var e=this._getCurrentDirectory();return e&&e.fileItem||null}getSelectedItems(){return this._getSelectedItemInfos().map(e=>e.fileItem)}_onSelectedItemOpened(e){var{fileItemInfo:t}=e,i=t.fileItem;if(!i.isDirectory){this._actions.onSelectedFileOpened({file:i});return}i.isParentFolder&&(this._itemKeyToFocus=this._getCurrentDirectory().fileItem.key);var r=i.isParentFolder?this._getCurrentDirectory().parentDirectory:t;this._setCurrentDirectory(r),r&&this._filesTreeView.toggleDirectoryExpandedState(r.parentDirectory,!0)}}dt("dxFileManager",ir);/*!
 * devextreme-vue
 * Version: 23.2.10
 * Build date: Mon Oct 28 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var po=Hr({props:{accessKey:String,activeStateEnabled:Boolean,allowedFileExtensions:Array,contextMenu:Object,currentPath:String,currentPathKeys:Array,customizeDetailColumns:Function,customizeThumbnail:Function,disabled:Boolean,elementAttr:Object,fileSystemProvider:{},focusedItemKey:String,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,itemView:Object,notifications:Object,onContentReady:Function,onContextMenuItemClick:Function,onContextMenuShowing:Function,onCurrentDirectoryChanged:Function,onDirectoryCreated:Function,onDirectoryCreating:Function,onDisposing:Function,onErrorOccurred:Function,onFileUploaded:Function,onFileUploading:Function,onFocusedItemChanged:Function,onInitialized:Function,onItemCopied:Function,onItemCopying:Function,onItemDeleted:Function,onItemDeleting:Function,onItemDownloading:Function,onItemMoved:Function,onItemMoving:Function,onItemRenamed:Function,onItemRenaming:Function,onOptionChanged:Function,onSelectedFileOpened:Function,onSelectionChanged:Function,onToolbarItemClick:Function,permissions:Object,rootFolderName:String,rtlEnabled:Boolean,selectedItemKeys:Array,selectionMode:String,tabIndex:Number,toolbar:Object,upload:Object,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:allowedFileExtensions":null,"update:contextMenu":null,"update:currentPath":null,"update:currentPathKeys":null,"update:customizeDetailColumns":null,"update:customizeThumbnail":null,"update:disabled":null,"update:elementAttr":null,"update:fileSystemProvider":null,"update:focusedItemKey":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:itemView":null,"update:notifications":null,"update:onContentReady":null,"update:onContextMenuItemClick":null,"update:onContextMenuShowing":null,"update:onCurrentDirectoryChanged":null,"update:onDirectoryCreated":null,"update:onDirectoryCreating":null,"update:onDisposing":null,"update:onErrorOccurred":null,"update:onFileUploaded":null,"update:onFileUploading":null,"update:onFocusedItemChanged":null,"update:onInitialized":null,"update:onItemCopied":null,"update:onItemCopying":null,"update:onItemDeleted":null,"update:onItemDeleting":null,"update:onItemDownloading":null,"update:onItemMoved":null,"update:onItemMoving":null,"update:onItemRenamed":null,"update:onItemRenaming":null,"update:onOptionChanged":null,"update:onSelectedFileOpened":null,"update:onSelectionChanged":null,"update:onToolbarItemClick":null,"update:permissions":null,"update:rootFolderName":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectionMode":null,"update:tabIndex":null,"update:toolbar":null,"update:upload":null,"update:visible":null,"update:width":null},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=ir,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={contextMenu:{isCollectionItem:!1,optionName:"contextMenu"},itemView:{isCollectionItem:!1,optionName:"itemView"},notifications:{isCollectionItem:!1,optionName:"notifications"},permissions:{isCollectionItem:!1,optionName:"permissions"},toolbar:{isCollectionItem:!1,optionName:"toolbar"},upload:{isCollectionItem:!1,optionName:"upload"}}}}),rr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:alignment":null,"update:caption":null,"update:cssClass":null,"update:dataField":null,"update:dataType":null,"update:hidingPriority":null,"update:sortIndex":null,"update:sortOrder":null,"update:visible":null,"update:visibleIndex":null,"update:width":null},props:{alignment:String,caption:String,cssClass:String,dataField:String,dataType:String,hidingPriority:Number,sortIndex:Number,sortOrder:String,visible:Boolean,visibleIndex:Number,width:[Number,String]}});rr.$_optionName="columns";rr.$_isCollectionItem=!0;var nr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:items":null},props:{items:Array}});nr.$_optionName="contextMenu";nr.$_expectedChildren={contextMenuItem:{isCollectionItem:!0,optionName:"items"},item:{isCollectionItem:!0,optionName:"items"}};var ar=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:disabled":null,"update:icon":null,"update:items":null,"update:name":null,"update:selectable":null,"update:selected":null,"update:text":null,"update:visible":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,disabled:Boolean,icon:String,items:Array,name:String,selectable:Boolean,selected:Boolean,text:String,visible:Boolean}});ar.$_optionName="items";ar.$_isCollectionItem=!0;var sr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:columns":null},props:{columns:Array}});sr.$_optionName="details";sr.$_expectedChildren={column:{isCollectionItem:!0,optionName:"columns"}};var or=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,icon:String,locateInMenu:String,location:String,name:String,options:{},showText:String,text:String,visible:Boolean,widget:String}});or.$_optionName="fileSelectionItems";or.$_isCollectionItem=!0;var lr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:items":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:selectable":null,"update:selected":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,cssClass:String,disabled:Boolean,icon:String,items:Array,locateInMenu:String,location:String,name:String,options:{},selectable:Boolean,selected:Boolean,showText:String,text:String,visible:Boolean,widget:String}});lr.$_optionName="items";lr.$_isCollectionItem=!0;var dr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:details":null,"update:mode":null,"update:showFolders":null,"update:showParentFolder":null},props:{details:Object,mode:String,showFolders:Boolean,showParentFolder:Boolean}});dr.$_optionName="itemView";dr.$_expectedChildren={details:{isCollectionItem:!1,optionName:"details"}};var _o=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:showPanel":null,"update:showPopup":null},props:{showPanel:Boolean,showPopup:Boolean}});_o.$_optionName="notifications";var mo=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:copy":null,"update:create":null,"update:delete":null,"update:download":null,"update:move":null,"update:rename":null,"update:upload":null},props:{copy:Boolean,create:Boolean,delete:Boolean,download:Boolean,move:Boolean,rename:Boolean,upload:Boolean}});mo.$_optionName="permissions";var hr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:fileSelectionItems":null,"update:items":null},props:{fileSelectionItems:Array,items:Array}});hr.$_optionName="toolbar";hr.$_expectedChildren={fileSelectionItem:{isCollectionItem:!0,optionName:"fileSelectionItems"},item:{isCollectionItem:!0,optionName:"items"},toolbarItem:{isCollectionItem:!0,optionName:"items"}};var cr=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,icon:String,locateInMenu:String,location:String,name:String,options:{},showText:String,text:String,visible:Boolean,widget:String}});cr.$_optionName="items";cr.$_isCollectionItem=!0;var fo=be({emits:{"update:isActive":null,"update:hoveredElement":null,"update:chunkSize":null,"update:maxFileSize":null},props:{chunkSize:Number,maxFileSize:Number}});fo.$_optionName="upload";const Co={__name:"FileManager",props:{clientPath:{type:String,default:""}},emits:["copiedUrl"],setup(w,{emit:e}){const t=w,i=e,{t:r}=jr(),n=jt("mc"),a=jt("mf"),s=ft(null),d=ft(null),m=ft([]),C=ft(new qi({getItems:I,createDirectory:y,renameItem:c,deleteItem:g,copyItem:h,moveItem:_,uploadFileChunk:u}));Zr(()=>t.clientPath,()=>{s.value.instance.refresh()});function I(b){return new Promise((R,T)=>{axios.post("settings/file/getItems",{clientPath:t.clientPath,path:b.path}).then(U=>{R(U.data),m.value=U.data.reduce((M,G)=>(!G.isDirectory&&G.name.match(/.(jpg|jpeg|png|gif)$/i)&&M.push(`${window.baseURL}/storage/${t.clientPath}/${b.path}/${G.name}`),M),[])})})}function y(b,R){return new Promise((T,U)=>{axios.post("settings/file/createDirectory",{clientPath:t.clientPath,path:b.path,name:R}).then(M=>{M.data?T():U()})})}function c(b,R){return new Promise((T,U)=>{axios.post("settings/file/renameItem",{clientPath:t.clientPath,path:b.parentPath,oldName:b.name,newName:R}).then(M=>{M.data?T():U()})})}function g(b){return new Promise((R,T)=>{axios.post("settings/file/deleteItem",{clientPath:t.clientPath,path:b.path,isDirectory:b.isDirectory}).then(U=>{U.data?R():T()})})}function h(b,R){return new Promise((T,U)=>{axios.post("settings/file/copyItem",{clientPath:t.clientPath,fromPath:b.parentPath,toPath:R.path,name:b.name}).then(M=>{M.data?T():U()}),T()})}function _(b,R){return new Promise((T,U)=>{axios.post("settings/file/moveItem",{clientPath:t.clientPath,fromPath:b.parentPath,toPath:R.path,name:b.name}).then(M=>{M.data?T():U()}),T()})}async function u(b,R,T){const U=b.name;if(b.type.match(/image.*/)){const M={file:b,maxSize:n.MAX_SIZE_IMAGE_UPLOAD};b=await a.resizeImage(M)}return new Promise((M,G)=>{let J=new FormData;J.append("clientPath",t.clientPath),J.append("file",b),J.append("name",U),J.append("path",T.path),axios.post("settings/file/uploadFileChunk",J,{headers:{"Content-Type":"multipart/form-data"},noCrypt:!0}).then(S=>{S.data?(U.match(/.(jpg|jpeg|png|gif)$/i)&&m.value.push(`${window.baseURL}/storage/${t.clientPath}/${T.path}/${U}`),M()):G()})})}function v(){const b=s.value.instance.getSelectedItems();if(b.length>1)it.info(r("settings.files.messages.multiFile"));else if(b[0].isDirectory)it.info(r("settings.files.messages.notIsFile"));else{let R=`${window.baseURL}/storage/${t.clientPath}/${b[0].path}`;navigator.clipboard.writeText(R).then(()=>{it.success(r("settings.files.messages.copiedUrl")),i("copiedUrl",R)},T=>it.error(r("settings.files.messages.notCopiedUrl")+"<br>ERROR: "+T))}}function E({file:b}){b.name.match(/.(jpg|jpeg|png|gif)$/i)?d.value.openSlide(b.name):it.info(r("settings.files.messages.notIsImage"))}function x(b){setTimeout(()=>s.value.instance.repaint(),3e3)}return(b,R)=>(qr(),Xr(Qr,null,[Zt(Yr(po),{ref_key:"fileManagerRef",ref:s,"file-system-provider":C.value,permissions:{create:!0,copy:!0,move:!0,delete:!0,rename:!0,upload:!0},itemView:{mode:"thumbnails"},toolbar:{fileSelectionItems:[{widget:"dxButton",options:{text:b.$t("settings.files.copyUrl"),hint:b.$t("settings.files.copyUrl"),icon:"link"},location:"before",onClick:v},"separator","move","copy","rename","separator","delete","clearSelection"]},onErrorOccurred:x,onSelectedFileOpened:E},null,8,["file-system-provider","toolbar"]),Zt(Jr,{ref_key:"photoswipeRef",ref:d,images:m.value,style:{display:"none !important"}},null,8,["images"])],64))}};export{Ni as F,Co as _};
