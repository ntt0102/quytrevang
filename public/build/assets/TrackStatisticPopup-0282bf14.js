import{D as C,a as o}from"./data-grid-0eec16c9.js";import{x as k,y as _,z as c,A as f,B as P,E as T,C as B,r as g,f as x,w as l,O as z,o as A,e as a,D as i}from"./app-1d96e4f7.js";import"./row_dragging-39c76075.js";import"./dialog-24b6b308.js";import"./exporter-1d49b0ae.js";const I={__name:"TrackStatisticPopup",setup(E,{expose:w}){const d=k(),{t:n}=_(),h=c("bus"),s=c("mt"),y=c("mf"),p=f(null),u=f(null),t=P({gridData:null,editPermission:"trades@edit",validationRules:{amount:[{type:"required",message:n("trading.trades.amount")+s.validations.required}],scores:[{type:"required",message:n("trading.trades.scores")+s.validations.required}],revenue:[{type:"required",message:n("trading.trades.revenue")+s.validations.required}],loss:[{type:"required",message:n("trading.trades.loss")+s.validations.required}],fees:[{type:"required",message:n("trading.trades.fees")+s.validations.required}],date:[{type:"required",message:n("trading.trades.date")+s.validations.required},{type:"async",validationCallback:e=>d.dispatch("tradingStatistic/validateDuplicateDate",e),message:n("trading.trades.validations.date")}]}}),r=T(()=>d.state.auth.user.permissions);B(()=>d.state.tradingStatistic.data,e=>{t.gridData=y.cloneDeep(e)});function b(){p.value.show()}function D(e){e.length&&h.emit("checkPin",()=>d.dispatch("tradingStatistic/save",e))}function R(){d.dispatch("tradingStatistic/getData")}function S(){t.gridData=null}return w({show:b}),(e,m)=>{const $=g("DxToolbar"),q=g("DxScrollView");return A(),x(z,{ref_key:"popupRef",ref:p,title:e.$t("trading.trades.buttons.addData"),onShown:R,onHidden:S},{default:l(()=>[a(q,null,{default:l(()=>[a(i(C),{ref_key:"dataGridRef",ref:u,"data-source":t.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:8},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:r.value.includes(t.editPermission),allowUpdating:r.value.includes(t.editPermission),allowDeleting:r.value.includes(t.editPermission),mode:"batch",startEditAction:"dblClick"},onContentReady:m[0]||(m[0]=v=>e.$mf.dataGridPreload(t.gridData,u.value.instance)),onSaved:D},{commandCellTemplate:l(({data:v})=>[a($,{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:e.$t("buttons.delete"),text:e.$t("buttons.delete"),onClick:()=>{u.value.instance.deleteRow(v.rowIndex)}}}]},null,8,["items"])]),default:l(()=>[a(i(o),{fixed:!0,visible:r.value.includes(t.editPermission),width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t("titles.commandHeaderTitleShort")},null,8,["visible","caption"]),a(i(o),{"data-field":"date","data-type":"date","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:e.$t("trading.trades.date"),"validation-rules":t.validationRules.date},null,8,["editor-options","caption","validation-rules"]),a(i(o),{"data-field":"amount","data-type":"number",width:100,caption:e.$t("trading.trades.amount"),"validation-rules":t.validationRules.amount},null,8,["caption","validation-rules"]),a(i(o),{"data-field":"scores","data-type":"number",format:"#0.#","editor-options":{step:"0.1",format:"#0.#"},caption:e.$t("trading.trades.scores"),"validation-rules":t.validationRules.scores},null,8,["editor-options","caption","validation-rules"]),a(i(o),{"data-field":"revenue","data-type":"number",format:"#,##0","editor-options":{step:"1",format:"#,##0"},caption:e.$t("trading.trades.revenue"),"validation-rules":t.validationRules.revenue},null,8,["caption","validation-rules"]),a(i(o),{"data-field":"loss","data-type":"number",format:"#,##0","editor-options":{step:"1",format:"#,##0"},caption:e.$t("trading.trades.loss"),"validation-rules":t.validationRules.loss},null,8,["caption","validation-rules"]),a(i(o),{"data-field":"fees","data-type":"number",format:"#,##0","editor-options":{step:"1",format:"#,##0"},caption:e.$t("trading.trades.fees"),"validation-rules":t.validationRules.fees},null,8,["caption","validation-rules"])]),_:1},8,["data-source","editing"])]),_:1})]),_:1},8,["title"])}}};export{I as default};
