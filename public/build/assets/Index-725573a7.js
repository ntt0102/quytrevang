import{J as yt,K as Ct,L as ae,M as ue,u as St,b as wt,c as xt,i as ie,r as S,d as kt,e as Y,x as Dt,w as Tt,f as Pt,g as Lt,j as O,h as g,l as se,z as B,A as $,E as _,C as Ft,G as re,v as Et,o as Ot,H as Bt}from"./app-0de866e0.js";import $t from"./ColorPicker-1093aa8e.js";import{c as _t}from"./lightweight-charts.esm.development-03366bac.js";class It{constructor(){this.create()}create(){return new Promise((v,c)=>{const y=indexedDB.open("stockChart",1);y.onupgradeneeded=m=>{this.store=m.target.result,this.store.createObjectStore("range",{keyPath:"color"}),v()},y.onsuccess=m=>{this.store=m.target.result,v()},y.onerror=()=>{location.reload(),c()}})}get(v){var c=this.store;return new Promise(function(m,x){var d=c.transaction(v,"readonly");if(Array.isArray(v)){var C=v.map(k=>d.objectStore(k)),P=C.map(y);Promise.all(P).then(k=>m(k))}else{var R=d.objectStore(v);y(R).then(k=>m(k))}});function y(m){return new Promise(function(x,d){const C=m.getAll();C.onsuccess=P=>x(P.target.result),C.onerror=()=>d()})}}set(v,c){const y=this.store.transaction(v,"readwrite").objectStore(v);Array.isArray(c)?c.length>0&&c.forEach(m=>y.put(m)):y.put(c)}clear(v){var c=this.store;return new Promise(function(y,m){const x=c.transaction(v,"readwrite").objectStore(v).clear();x.onsuccess=()=>{y()},x.onerror=d=>{console.error(`Error to empty Object Store: ${v}`),m()}})}}const I=new It;var u={};const Nt=yt(Ct);/*!
 * devextreme-vue
 * Version: 22.2.10
 * Build date: Mon Dec 11 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var Rt=ae&&ae.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(u,"__esModule",{value:!0});u.DxToolbarItem=u.DxTo=u.DxShow=u.DxPosition=u.DxOptions=u.DxOffset=u.DxMy=u.DxItem=u.DxHide=u.DxFrom=u.DxDropDownOptions=u.DxCollision=u.DxButton=u.DxBoundaryOffset=u.DxAt=u.DxAnimation=u.DxSelectBox=void 0;var At=Rt(Nt),Mt=ue,b=ue,de=Mt.createComponent({props:{acceptCustomValue:Boolean,accessKey:String,activeStateEnabled:Boolean,buttons:Array,customItemCreateEvent:String,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayExpr:[Function,String],displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,fieldTemplate:{},focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxLength:[Number,String],minSearchLength:Number,name:String,noDataText:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCustomItemCreating:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDataBeforeSearch:Boolean,showDropDownButton:Boolean,showSelectionControls:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:{},valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:acceptCustomValue":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:customItemCreateEvent":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayExpr":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:fieldTemplate":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:noDataText":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCustomItemCreating":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDataBeforeSearch":null,"update:showDropDownButton":null,"update:showSelectionControls":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=At.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});u.DxSelectBox=de;var U=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});u.DxAnimation=U;U.$_optionName="animation";U.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var pe=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxAt=pe;pe.$_optionName="at";var me=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxBoundaryOffset=me;me.$_optionName="boundaryOffset";var N=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});u.DxButton=N;N.$_optionName="buttons";N.$_isCollectionItem=!0;N.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var fe=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxCollision=fe;fe.$_optionName="collision";var X=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});u.DxDropDownOptions=X;X.$_optionName="dropDownOptions";X.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var Z=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxFrom=Z;Z.$_optionName="from";Z.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var G=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxHide=G;G.$_optionName="hide";G.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var J=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});u.DxItem=J;J.$_optionName="items";J.$_isCollectionItem=!0;var he=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxMy=he;he.$_optionName="my";var ge=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxOffset=ge;ge.$_optionName="offset";var ve=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});u.DxOptions=ve;ve.$_optionName="options";var be=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});u.DxPosition=be;be.$_optionName="position";var ye=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxShow=ye;ye.$_optionName="show";var Ce=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxTo=Ce;Ce.$_optionName="to";var Q=b.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});u.DxToolbarItem=Q;Q.$_optionName="toolbarItems";Q.$_isCollectionItem=!0;var ce=u.default=de;const Vt={class:"content-block dx-card responsive-paddings"},jt=["title"],qt=["title"],zt=["title"],Kt={class:"area tool-area"},Wt=["title"],Ht=["title"],Yt=["title"],Ut=["title"],Xt=["title"],Zt=["title"],Gt=["title"],Jt=["title"],Qt=["title"],eo=["title"],to=["title"],oo=["src"],io={__name:"Index",setup(T){const v={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.35}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},c=St(),y=wt(),{t:m}=xt(),x=ie("devices"),d=ie("mf"),C=S(null),P=S(null),R=S(null),k=S(null),Se=S(null),L=S(null),A=S(null),M=S(null),V=S(null),j=S(null),q=S(null),we=S(null);let t={chart:{},series:{},data:{ohlc:[],price:[],cash:[]},tools:{lines:[],target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},rr:{EP:{},SL:{},TP:{}},range:[]},crosshair:{},isOnlyLoadData:!1,showNewsInfo:!1};const l=kt({symbol:y.query.symbol??"VNINDEX",timeframe:"D",symbolKind:null,symbolKinds:[{text:m("trading.stock.symbolList.hose"),value:"hose"},{text:m("trading.stock.symbolList.nh"),value:"nh"},{text:m("trading.stock.symbolList.ck"),value:"ck"},{text:m("trading.stock.symbolList.filterCash"),value:"f_cash"},{text:m("trading.stock.symbolList.filterMix"),value:"f_mix"},{text:m("trading.stock.symbolList.watch"),value:"watch"},{text:m("trading.stock.symbolList.hold"),value:"hold"},{text:m("trading.stock.symbolList.hnx"),value:"hnx"}],isFullscreen:!1,color:"#F44336",showColorPicker:!1,isCashDraw:!1,showTradingView:!1});l.symbolKind=y.query.list??"hose";const xe=Y(()=>`https://chart.vps.com.vn/tv/?symbol=${l.symbol}`),ee=Y(()=>c.state.tradingStock.symbols.watch.includes(l.symbol)),ke=Y(()=>c.state.tradingStock.chart.dividend?" dividend":"");c.dispatch("tradingStock/getSymbols"),I.create(),Dt(()=>{t.chart=_t(P.value,v),t.chart.subscribeCrosshairMove(Pe),t.chart.subscribeCustomPriceLineDragged(Le),t.series.range=t.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),t.series.events=t.chart.addHistogramSeries({priceScaleId:"events",scaleMargins:{top:.96,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),t.series.vnindex=t.chart.addLineSeries({priceScaleId:"vnindex",scaleMargins:{top:.05,bottom:.76},color:"aqua",priceFormat:{minMove:.01},lastValueVisible:!1}),t.series.cash=t.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.66,bottom:.05},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),t.series.ohlc=t.chart.addCandlestickSeries({upColor:"#42946C",downColor:"#BC3E4A",borderVisible:!1,wickUpColor:"#42946C",wickDownColor:"#BC3E4A",priceFormat:{minMove:.01}}),t.series.price=t.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(Fe).observe(C.value),document.addEventListener("fullscreenchange",Ee),c.dispatch("tradingStock/getChartData",{symbol:l.symbol,timeframe:l.timeframe,vnindex:!0}).then(async e=>{t.series.vnindex.setData(e);const a=await I.get("range");a.length==2&&(t.tools.range=a,t.series.range.setData(a))})}),Tt(()=>c.state.tradingStock.chart,()=>{t.isOnlyLoadData||(_e(),Ne()),Re()});function De(e){e.preventDefault()}function Te(e){L.value.classList.contains("selected")?ze():A.value.classList.contains("selected")?He():M.value.classList.contains("selected")?oe():V.value.classList.contains("selected")?ne():j.value.classList.contains("selected")?nt():q.value.classList.contains("selected")?it():ut()}function Pe(e){if(e.time){let a=e.seriesPrices.get(t.series.price);t.crosshair.time=e.time,t.crosshair.price=a}else x.phone||(t.crosshair.time=null,t.crosshair.price=null);e.point!=null&&(t.crosshair.x=e.point.x,t.crosshair.y=e.point.y)}function Le(e){let a=e.customPriceLine,o=a.options();o.price=H(o.price);const n=+e.fromPriceString;switch(+o.price,o.lineType){case"line":c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:l.symbol,name:o.lineType,points:[n],data:[o]}),L.value.classList.remove("selected");break;case"target":if(d.isSet(t.tools.target.B)){let i={isRemove:!1,symbol:l.symbol,name:"target",points:[],data:[]},s;const r=+t.tools.target.A.options().price,f=+t.tools.target.B.options().price-r;o.point=="A"&&(s="A",i.points.push(s),i.data.push(t.tools.target[s].options())),s="B",t.tools.target[s].applyOptions({title:(100*f/r).toFixed(1)+"%"}),i.points.push(s),i.data.push(t.tools.target[s].options()),s="X",t.tools.target[s].applyOptions({price:+(r-.5*f).toFixed(2),title:(100*-.5*f/r).toFixed(1)+"%"}),i.points.push(s),i.data.push(t.tools.target[s].options()),s="Y",t.tools.target[s].applyOptions({price:+(r-f).toFixed(2),title:(100*-f/r).toFixed(1)+"%"}),i.points.push(s),i.data.push(t.tools.target[s].options()),s="Z",t.tools.target[s].applyOptions({price:+(r-2*f).toFixed(2),title:(100*-2*f/r).toFixed(1)+"%"}),i.points.push(s),i.data.push(t.tools.target[s].options()),c.dispatch("tradingStock/drawTools",i)}break;case"rr":if(d.isSet(t.tools.rr.TP)){let i={isRemove:!1,symbol:l.symbol,name:"rr",points:[],data:[]},s;const r=+t.tools.rr.EP.options().price,p=+t.tools.rr.SL.options().price,f=+t.tools.rr.TP.options().price,w=p-r;if((f-r)/w>0)return a.applyOptions({price:n}),!1;const D=Math.abs(f-r)/Math.abs(p-r),vt=(p-r)/r*100,bt=(f-r)/r*100;s="EP",t.tools.rr[s].applyOptions({title:`RR=${D.toFixed(1)}`}),i.points.push(s),i.data.push(t.tools.rr[s].options()),s="SL",t.tools.rr[s].applyOptions({title:`SL=${vt.toFixed(1)}%`}),i.points.push(s),i.data.push(t.tools.rr[s].options()),s="TP",t.tools.rr[s].applyOptions({title:`TP=${bt.toFixed(1)}%`}),i.points.push(s),i.data.push(t.tools.rr[s].options()),c.dispatch("tradingStock/drawTools",i)}break}}function Fe(){C.value&&(t.chart.resize(C.value.offsetWidth,C.value.offsetHeight),C.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ee(){C.value&&(document.fullscreenElement?(l.isFullscreen=!0,C.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(l.isFullscreen=!1,C.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Oe(){re(`${m("trading.stock.removeFilterList")}?`,m("titles.confirm")).then(e=>{if(e){const a=c.state.tradingStock.symbols[l.symbolKind];let o=a.findIndex(i=>i==l.symbol);o=o==a.length-1?0:o+1;const n={symbol:l.symbol,name:l.symbolKind};c.dispatch("tradingStock/removeFilterList",n).then(()=>l.symbol=a[o])}})}function Be(){if(!l.symbol)return!1;const e={symbol:l.symbol,add:!ee.value};c.dispatch("tradingStock/addWatchlist",e)}function $e(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function _e(){te(!1),z(!1),F(!1),F(!1,!0),E(!1),E(!1,!0),K(!1),Ie()}function Ie(){const e=c.state.tradingStock.chart.tools;for(const[a,o]of Object.entries(e))switch(a){case"line":Object.values(o).forEach(n=>t.tools.lines.push(t.series.price.createPriceLine(n)));break;case"target":Object.entries(o).forEach(([n,i])=>t.tools.target[n]=t.series.price.createPriceLine(i));break;case"rr":Object.entries(o).forEach(([n,i])=>t.tools.rr[n]=t.series.price.createPriceLine(i));break;default:a.includes("uplps")?Object.entries(o).forEach(([n,i])=>t.tools.uplps[n]=t.series[n.includes("P")?"price":"cash"].createPriceLine(i)):a.includes("downlps")&&Object.entries(o).forEach(([n,i])=>t.tools.downlps[n]=t.series[n.includes("P")?"price":"cash"].createPriceLine(i));break}}function Ne(){t.series.events.setData(c.state.tradingStock.chart.events)}function Re(){t.data=c.state.tradingStock.chart.data,t.series.ohlc.setData(t.data.ohlc),t.series.price.setData(t.data.price),t.series.cash.setData(t.data.cash),t.chart.applyOptions({watermark:{text:l.symbol}})}function Ae(e){l.showTradingView=!l.showTradingView,e.stopPropagation()}function Me(e){l.showColorPicker=!l.showColorPicker,e.stopPropagation()}function Ve(e){e.preventDefault(),e.stopPropagation()}function je(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a||e.target.classList.add("selected"),e.stopPropagation()}function qe(e){te(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function ze(e=null,a=!1,o=!1){const n="line";e||(e=H(W(t.crosshair.y)));const i=t.tools.lines.length;if(t.tools.lines=t.tools.lines.filter(s=>{const r=s.options(),p=r.type=e==+r.price;return p&&(t.series.price.removePriceLine(s),c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:n,point:e})),!p}),t.tools.lines.length==i&&!o||a){const s={lineType:n,price:e,color:l.color,lineWidth:1,lineStyle:1,draggable:!0};t.tools.lines.push(t.series.price.createPriceLine(s)),c.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:l.symbol,name:n,points:[e],data:[s]})}L.value.classList.remove("selected")}function te(e=!0){t.tools.lines.length>0&&(console.log("removeLineTool"),t.tools.lines.forEach(a=>t.series.price.removePriceLine(a)),t.tools.lines=[],e&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"line",point:null}))}function Ke(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a||(e.target.classList.add("selected"),z()),e.stopPropagation()}function We(e){z(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function He(){const e="target",a=W(t.crosshair.y);let o={lineType:e,price:a,lineWidth:1,lineStyle:1,draggable:!0},n={isRemove:!1,symbol:l.symbol,name:e,points:[],data:[]};if(d.isSet(t.tools.target.A)){const i=+t.tools.target.A.options().price,s=a-i;o.point="B",o.title=(100*s/i).toFixed(1)+"%",o.color="#FF9800",t.tools.target[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o)),o.point="X",o.price=+(i-.5*s).toFixed(2),o.title=(100*-.5*s/i).toFixed(1)+"%",o.color="#2196F3",t.tools.target[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o)),o.point="Y",o.price=+(i-s).toFixed(2),o.title=(100*-s/i).toFixed(1)+"%",o.color="#673AB7",t.tools.target[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o)),o.point="Z",o.price=+(i-2*s).toFixed(2),o.title=(100*-2*s/i).toFixed(1)+"%",o.color="#673AB7",t.tools.target[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o)),A.value.classList.remove("selected")}else o.point="A",o.title="0",o.color="#FF9800",t.tools.target[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o));c.dispatch("tradingStock/drawTools",n)}function z(e=!0){d.isSet(t.tools.target.A)&&(t.series.price.removePriceLine(t.tools.target.A),d.isSet(t.tools.target.B)&&(t.series.price.removePriceLine(t.tools.target.B),t.series.price.removePriceLine(t.tools.target.X),t.series.price.removePriceLine(t.tools.target.Y),t.series.price.removePriceLine(t.tools.target.Z)),t.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),e&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"target"})}function Ye(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a?oe():e.target.classList.add("selected"),e.stopPropagation()}function Ue(e){F(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function oe(){let e,a;const o=l.isCashDraw?"cash":"price",n=l.isCashDraw?"C":"P";d.isSet(t.tools.uplps[`${n}1`])?(e=+t.tools.uplps[`${n}1`].options().startTime,a=t.crosshair.time,F(!1)):e=t.crosshair.time;const{value1:i,value2:s}=Xe(e,a);let r={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},p={isRemove:!1,symbol:l.symbol,name:`${o}uplps`,points:[],data:[]};r.startTime=e,r.price=i,r.title=`${n}1`,t.tools.uplps[r.title]=t.series[o].createPriceLine(r),p.points.push(r.title),p.data.push(d.cloneDeep(r)),r.price=s,r.title=`${n}2`,t.tools.uplps[r.title]=t.series[o].createPriceLine(r),p.points.push(r.title),p.data.push(d.cloneDeep(r)),c.dispatch("tradingStock/drawTools",p),M.value.classList.remove("selected")}function Xe(e,a){let o,n,i,s=0,r=0;const p=t.data[l.isCashDraw?"cash":"price"];for(let f=0;f<p.length;f++){const w=p[f].time;if(w<e)continue;if(a&&w>a)break;const h=p[f].value;if(o==null&&(o=h,n=h,i=h),h>i)s>r&&(n=i,r=s),i=h,s=0;else if(h<i){const D=+(i-h).toFixed(2);D>s&&(s=D)}if(h<o&&r>0)break}return{value1:+(n-r).toFixed(2),value2:+(i-r).toFixed(2)}}function F(e=!0,a=!1){const o=l.isCashDraw||a,n=o?"cash":"price",i=o?"C":"P",s=`${i}1`,r=`${i}2`;d.isSet(t.tools.uplps[s])&&(t.series[n].removePriceLine(t.tools.uplps[s]),t.series[n].removePriceLine(t.tools.uplps[r])),t.tools.uplps[s]={},t.tools.uplps[r]={},e&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:`${n}uplps`})}function Ze(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a?ne():e.target.classList.add("selected"),e.stopPropagation()}function Ge(e){E(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function ne(){let e,a;const o=l.isCashDraw?"cash":"price",n=l.isCashDraw?"C":"P";d.isSet(t.tools.downlps[`${n}1`])?(e=+t.tools.downlps[`${n}1`].options().startTime,a=t.crosshair.time,E()):e=t.crosshair.time;const{value1:i,value2:s}=Je(e,a);let r={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},p={isRemove:!1,symbol:l.symbol,name:`${o}downlps`,points:[],data:[]};r.startTime=e,r.price=i,r.title=`${n}1`,t.tools.downlps[r.title]=t.series[o].createPriceLine(r),p.points.push(r.title),p.data.push(d.cloneDeep(r)),r.price=s,r.title=`${n}2`,t.tools.downlps[r.title]=t.series[o].createPriceLine(r),p.points.push(r.title),p.data.push(d.cloneDeep(r)),c.dispatch("tradingStock/drawTools",p),V.value.classList.remove("selected")}function Je(e,a){let o,n,i,s=0,r=0;const p=t.data[l.isCashDraw?"cash":"price"];for(let f=0;f<p.length;f++){const w=p[f].time;if(w<e)continue;if(a&&w>a)break;const h=p[f].value;if(o==null&&(o=h,n=h,i=h),h<i)s<r&&(n=i,r=s),i=h,s=0;else if(h>i){const D=+(i-h).toFixed(2);D<s&&(s=D)}if(h>o&&r<0)break}return{value1:+(n-r).toFixed(2),value2:+(i-r).toFixed(2)}}function E(e=!0,a=!1){const o=l.isCashDraw||a,n=o?"cash":"price",i=o?"C":"P",s=`${i}1`,r=`${i}2`;d.isSet(t.tools.downlps[s])&&(t.series[n].removePriceLine(t.tools.downlps[s]),t.series[n].removePriceLine(t.tools.downlps[r])),t.tools.downlps[s]={},t.tools.downlps[r]={},e&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:`${n}downlps`})}function Qe(e){e.target.classList.contains("selected")?(e.target.classList.remove("selected"),l.isCashDraw=!1):(e.target.classList.add("selected"),l.isCashDraw=!0),e.stopPropagation()}function et(e){l.isCashDraw=!1,e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function tt(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a||(e.target.classList.add("selected"),K()),e.stopPropagation()}function ot(e){K(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function nt(){const e="rr",a=W(t.crosshair.y);let o={lineType:e,price:a,lineWidth:1,lineStyle:1,draggable:!0},n={isRemove:!1,symbol:l.symbol,name:e,points:[],data:[]};if(d.isSet(t.tools.rr.EP)){const i=+t.tools.rr.EP.options().price;if(d.isSet(t.tools.rr.SL)){const r=+t.tools.rr.SL.options().price-i,p=a-i;if(p/r>0)return!1;const f=(a-i)/i*100;o.point="TP",o.title=`TP=${f.toFixed(1)}%`,o.color="lime",t.tools.rr[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o));const w=Math.abs(p)/Math.abs(r),h="EP";t.tools.rr[h].applyOptions({title:`RR=${w.toFixed(1)}`}),n.points.push(h),n.data.push(t.tools.rr[h].options()),j.value.classList.remove("selected")}else{const s=(a-i)/i*100;o.point="SL",o.title=`SL=${s.toFixed(1)}%`,o.color="red",t.tools.rr[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o))}}else o.point="EP",o.title="RR=",o.color="yellow",t.tools.rr[o.point]=t.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(d.cloneDeep(o));c.dispatch("tradingStock/drawTools",n)}function K(e=!0){d.isSet(t.tools.rr.EP)&&(t.series.price.removePriceLine(t.tools.rr.EP),d.isSet(t.tools.rr.SL)&&(t.series.price.removePriceLine(t.tools.rr.SL),d.isSet(t.tools.rr.TP)&&t.series.price.removePriceLine(t.tools.rr.TP))),t.tools.rr={EP:{},SL:{},TP:{}},e&&c.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:l.symbol,name:"rr"})}function lt(e){l.showColorPicker=!1;const a=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(o=>o.classList.remove("selected")),a||e.target.classList.add("selected"),e.stopPropagation()}function at(e){st(),e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function it(){let e={time:t.crosshair.time,value:1};t.tools.range.length>0?(e.color="red",t.tools.range[1]=e,q.value.classList.remove("selected")):(e.color="aqua",t.tools.range[0]=e),t.series.range.setData(t.tools.range),I.set("range",e)}function st(){t.tools.range=[],t.series.range.setData([]),I.clear("range")}function rt(e){e.target.classList.contains("selected")?(e.target.classList.remove("selected"),t.showNewsInfo=!1):(e.target.classList.add("selected"),t.showNewsInfo=!0),e.stopPropagation()}function ct(e){t.showNewsInfo=!1,e.target.classList.remove("selected"),e.preventDefault(),e.stopPropagation()}function ut(){if(t.showNewsInfo){const e=c.state.tradingStock.chart.events.find(a=>a.time==t.crosshair.time);if(d.isSet(e)){const a=e.title.split("|");let o=`
                <div>${m("trading.stock.date")} ${moment.unix(e.time).format("DD/MM/YYYY")}:</div>
                <div>&nbsp;</div>
                `;a.forEach(n=>{o+=`<div>${n}</div>`}),Bt(o,m("trading.stock.event"))}}}function W(e,a="price"){return H(t.series[a].coordinateToPrice(e))}function H(e){return e?+ +e.toFixed(2):0}function dt(e){e.stopPropagation()}function pt(e){if(!l.symbol)return!1;t.isOnlyLoadData=!1,c.dispatch("tradingStock/getChartData",{symbol:l.symbol,timeframe:l.timeframe,vnindex:!1})}function le(){t.isOnlyLoadData=!0,c.dispatch("tradingStock/getChartData",{symbol:l.symbol,timeframe:l.timeframe,vnindex:!1})}function mt(e){const a=c.state.tradingStock.symbols[l.symbolKind];let o=a.findIndex(n=>n==l.symbol);o=o==a.length-1?0:o+1,l.symbol=a[o],e.preventDefault(),e.stopPropagation()}function ft(e){l.symbolKind=e.value}function ht(){if(t.tools.range.length==2){const e={from:t.tools.range[0].time,to:t.tools.range[1].time,timeframe:l.timeframe,name:l.symbolKind};c.dispatch("tradingStock/filterSymbols",e)}else Et.error(m("trading.stock.rangeWarning"))}function gt(){re(`${m("trading.stock.deleteWatchList")}?`,m("titles.confirm")).then(e=>{e&&c.dispatch("tradingStock/deleteWatchlist")})}return(e,a)=>{const o=Pt("DxToolbar");return Ot(),Lt("div",Vt,[O(o,{items:[{visible:e.$mf.isSet(e.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:e.$t("buttons.back"),onClick:()=>e.$router.go(-1)}},{location:"before",widget:"dxSelectBox",options:{width:"130px",dataSource:l.symbolKinds,valueExpr:"value",displayExpr:"text",value:l.symbolKind,hint:e.$t("trading.stock.symbolKind"),onValueChanged:ft}},{location:"after",widget:"dxButton",options:{icon:"far fa-list small",hint:e.$t("trading.stock.cloneSymbols"),onClick:()=>e.$store.dispatch("tradingStock/cloneSymbols")}},{location:"after",widget:"dxButton",options:{icon:"far fa-folder-times small",hint:e.$t("trading.stock.deleteWatchList"),onClick:gt}},{location:"after",widget:"dxButton",options:{icon:"far fa-filter small",hint:e.$t("trading.stock.filterPopup.title"),onClick:ht}}]},null,8,["items"]),g("div",{class:"stock-container",ref_key:"chartContainerRef",ref:C,onClick:Te,onContextmenu:De},[g("div",{class:"chart-wrapper",ref_key:"chartRef",ref:P},[g("div",{class:"area data-area",onClick:dt},[O(se(ce),{width:e.$screen.getScreenSizeInfo.isXSmall?"140px":"130px","data-source":e.$store.state.tradingStock.symbols[l.symbolKind],"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:`command symbol-select ${ke.value}`},modelValue:l.symbol,"onUpdate:modelValue":a[0]||(a[0]=n=>l.symbol=n),onValueChanged:pt},null,8,["width","data-source","element-attr","modelValue"]),O(se(ce),{width:"60px","data-source":["D","W","M"],"element-attr":{class:"command timeframe-select"},modelValue:l.timeframe,"onUpdate:modelValue":a[1]||(a[1]=n=>l.timeframe=n),onValueChanged:le},null,8,["modelValue"]),g("div",{class:"command",title:e.$t("trading.stock.reload"),onClick:le,onContextmenu:mt},[g("i",{class:B(`far fa-sync-alt ${e.$store.state.tradingStock.isChartLoading?"fa-spin":""}`)},null,2)],40,jt),$(g("div",{class:B("command far fa-times"),title:e.$t("trading.stock.removeFilterList"),onClick:Oe},null,8,qt),[[_,l.symbolKind.includes("f_")]]),$(g("div",{ref:"addWatchlistToolRef",class:B(`command far fa-${ee.value?"minus-circle":"plus-circle"}`),title:e.$t("trading.stock.addWatchlist"),onClick:Be},null,10,zt),[[_,!!l.symbol]])]),g("div",Kt,[g("div",{ref_key:"fullscreenToolRef",ref:R,class:B(`command far fa-${l.isFullscreen?"compress":"expand"}`),title:e.$t("trading.stock.fullscreen"),onClick:$e},null,10,Wt),g("div",{ref_key:"tradingviewRef",ref:k,class:"command far fa-chart-bar",title:e.$t("trading.stock.tradingview"),onClick:Ae},null,8,Ht),g("div",{ref_key:"colorToolRef",ref:Se,class:"color command far fa-palette",style:Ft({color:l.color}),title:e.$t("trading.stock.tools.color"),onClick:Me,onContextmenu:Ve},[$(O($t,{class:"color-picker",modelValue:l.color,"onUpdate:modelValue":a[2]||(a[2]=n=>l.color=n)},null,8,["modelValue"]),[[_,l.showColorPicker]])],44,Yt),g("div",{ref_key:"lineToolRef",ref:L,class:"command far fa-horizontal-rule",title:e.$t("trading.stock.tools.line"),onClick:je,onContextmenu:qe},null,40,Ut),g("div",{ref_key:"uplpsToolRef",ref:M,class:"command far fa-arrow-up",title:e.$t("trading.stock.tools.uplps"),onClick:Ye,onContextmenu:Ue},null,40,Xt),g("div",{ref:"cashToolRef",class:"command drawless far fa-dot-circle",title:e.$t("trading.stock.tools.cash"),onClick:Qe,onContextmenu:et},null,40,Zt),g("div",{ref_key:"downlpsToolRef",ref:V,class:"command far fa-arrow-down",title:e.$t("trading.stock.tools.downlps"),onClick:Ze,onContextmenu:Ge},null,40,Gt),g("div",{ref_key:"targetToolRef",ref:A,class:"command far fa-flag-checkered",title:e.$t("trading.stock.tools.target"),onClick:Ke,onContextmenu:We},null,40,Jt),g("div",{ref_key:"rrToolRef",ref:j,class:"command far fa-line-height",title:e.$t("trading.stock.tools.rr"),onClick:tt,onContextmenu:ot},null,40,Qt),g("div",{ref_key:"rangeToolRef",ref:q,class:"command far fa-grip-lines-vertical",title:e.$t("trading.stock.tools.range"),onClick:lt,onContextmenu:at},null,40,eo),g("div",{ref:"eventsToolRef",class:"command drawless far fa-map-marker-exclamation",title:e.$t("trading.stock.tools.events"),onClick:rt,onContextmenu:ct},null,40,to)]),$(g("iframe",{ref_key:"tradingviewChartRef",ref:we,class:"tradingview-chart",src:xe.value},null,8,oo),[[_,l.showTradingView]])],512)],544)])}}};export{io as default};
