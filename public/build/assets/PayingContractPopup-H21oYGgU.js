import{u as O,r as g,a as z,c as I,y as F,p as u,f as m,_ as H,h as Q,k as h,x as G,m as D,o as c,e as d,d as t,t as n,g as w,b as K,P as S,s as p,q as R,v as X}from"./app-orJpy11M.js";import{D as Z}from"./accordion-pR2X8OEv.js";import{D as J}from"./load-indicator-D3azcrVi.js";const W={class:"caution"},Y={class:"step1"},ee={class:"description text-darker"},te={class:"method"},oe={class:"method1"},ae={key:0},ne={class:"method2"},se={class:"text-darker"},le={class:"upload"},ce={class:"upload-browser"},ie={for:"receiptImage"},re=t("i",{class:"far fa-file-upload"},null,-1),fe={__name:"PayingContractPopup",setup(ue,{expose:V}){const $=Q(),{t:f}=O(),q=h("bus"),B=h("mc"),k=h("mf"),i=g(null),y=g(null),_=g(null),o=z({formData:{},contract:{},qrSrc:null});let v=[];const C=I(()=>new Set(o.formData.documents.map(e=>e.file))),s=I(()=>$.state.userContract.transferInfo);F(()=>b());function x(e){i.value.setTitle(f(`components.payingContract.${e.status==0?"title":"changeReceiptTitle"}`)+" #"+e.code),o.contract=e,i.value.show()}function T(){let e=document.createElement("a");e.href=o.qrSrc,e.download=`vietQR_${o.contract.code}`,e.click()}function U(e){o.formData.documents=o.formData.documents.filter(a=>!a.isUpload),[...e.target.files].forEach(a=>o.formData.documents.push({file:URL.createObjectURL(a),isUpload:!0}))}function N(e){e.value?o.formData.documents=o.formData.documents.filter(a=>a.isUpload):o.formData.documents=v.concat(o.formData.documents)}function P(){o.formData.documents.findIndex(e=>e.isUpload)!=-1?_.value.click():G.show(f("messages.info.noUploadImage"))}function E(){q.emit("checkPin",async()=>{let e=new FormData;e.append("contractId",o.contract.id),e.append("isDelete",o.formData.isDelete);for(var a=0;a<receiptImageRef.value.files.length;a++){let l=await k.resizeImage({file:receiptImageRef.value.files[a],maxSize:B.MAX_SIZE_IMAGE_UPLOAD});e.append(`receiptImages[${a}]`,l)}$.dispatch("userContract/payingContract",e).then(l=>{l&&i.value.hide()})})}function b(){o.formData={isDelete:!1,documents:[]},o.qrSrc=null}function L(){setTimeout(()=>y.value.instance.option("selectedIndex",o.contract.status),0),v=o.contract.url_paid_docs.map(a=>({file:a,isUpload:!1})),o.formData.documents=v;let e=`https://img.vietqr.io/image/${s.value.bank_name}-${s.value.account_number}-KRnx1D.jpg?accountName=${s.value.account_name}&amount=${o.contract.principal}&addInfo=${f("models.contract.transfer.contentValue",[o.contract.code])}`;k.fetchImage(e).then(a=>o.qrSrc=a)}function A(){b()}return V({show:x}),(e,a)=>{const l=D("DxButton"),M=D("DxCheckBox"),j=D("DxScrollView");return c(),u(H,{ref_key:"popupRef",ref:i,class:"paying-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t(`components.payingContract.${o.contract.status==0?"paidButton":"changeReceiptButton"}`),onClick:P}}],onShown:L,onHidden:A},{default:m(()=>[d(j,null,{default:m(()=>[t("form",{onSubmit:X(E,["prevent"])},[t("button",{ref_key:"submitRef",ref:_,class:"display-none"},null,512),t("div",W,[t("div",null,n(e.$t("titles.caution"))+":",1),t("div",null,"  - "+n(e.$t("components.payingContract.paidDateCaution")),1),t("div",null,"  - "+n(e.$t("components.payingContract.timeCaution")),1)]),d(w(Z),{ref_key:"accordionRef",ref:y,collapsible:!0,items:[{title:e.$t("components.payingContract.step1"),template:"step1Template"},{title:e.$t("components.payingContract.step2"),template:"step2Template"}]},{step1Template:m(()=>[t("div",Y,[t("div",ee,n(e.$t("models.contract.transfer.qrCode")),1),t("div",te,[t("div",oe,[o.qrSrc?(c(),K("div",ae,[d(S,{images:[o.qrSrc]},null,8,["images"]),d(l,{class:"download-qr",text:e.$t("buttons.qrDownload"),icon:"download",type:"default","styling-mode":"text",onClick:T},null,8,["text"])])):(c(),u(w(J),{key:1,height:40,width:40}))]),t("div",ne,[t("div",null,[t("span",null,n(e.$t("models.user.bankName"))+":",1),t("span",null,n(s.value.bank_name),1)]),t("div",null,[t("span",null,n(e.$t("models.user.accountName"))+":",1),t("span",null,n(s.value.account_name),1)]),t("div",null,[t("span",null,n(e.$t("models.user.accountNumber"))+":",1),t("span",null,[p(n(s.value.account_number)+" ",1),t("i",{class:"far fa-copy",onClick:a[0]||(a[0]=r=>e.$mf.copyText(s.value.account_number))})])]),t("div",null,[t("span",null,n(e.$t("models.contract.transfer.amount"))+":",1),t("span",null,[p(n(e.$filters.currency(o.contract.principal))+" ",1),t("i",{class:"far fa-copy",onClick:a[1]||(a[1]=r=>e.$mf.copyText(o.contract.principal))})])]),t("div",null,[t("span",null,n(e.$t("models.contract.transfer.content"))+":",1),t("span",null,[p(n(e.$t("models.contract.transfer.contentValue",[o.contract.code]))+" ",1),t("i",{class:"far fa-copy",onClick:a[2]||(a[2]=r=>e.$mf.copyText(e.$t("models.contract.transfer.contentValue",[o.contract.code])))})])]),t("div",se,n(e.$t("models.contract.transfer.note")),1)])])])]),step2Template:m(()=>[t("div",le,[t("div",ce,[t("input",{ref:"receiptImageRef",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:U},null,544),t("label",ie,[re,p(" "+n(e.$t("titles.chooseImage")),1)]),o.contract.status==1?(c(),u(M,{key:0,id:"contractDelete",modelValue:o.formData.isDelete,"onUpdate:modelValue":a[3]||(a[3]=r=>o.formData.isDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:N},null,8,["modelValue","text"])):R("",!0)]),C.value.length?(c(),u(S,{key:0,images:C.value},null,8,["images"])):R("",!0)])]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["toolbarItems"])}}};export{fe as default};
