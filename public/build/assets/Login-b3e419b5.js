import{_ as o,D as r,bP as n,a as l,n as m}from"./app-089c7b72.js";const u={components:{DxForm:o,DxItem:r,DxDropDownButton:n},data(){return{passwordMode:!0,loggedinUsers:[],formData:{username:null,password:null,rememberMe:!1,avatar:null,name:null},validationRules:{username:[{type:"required",message:this.$t("models.user.username")+this.$mt.validations.required}],password:[{type:"required",message:this.$t("models.user.password")+this.$mt.validations.required}]}}},created(){this.loggedinUsers=this.getLoggedinUsersCookie(),this.loggedinUsers.length>0&&(this.loggedinUsers.reverse(),this.formData={...this.formData,...this.loggedinUsers[0]})},mounted(){this.$devices.phone&&this.formData.webauthn?this.fingerPrintClick():setTimeout(()=>this.form.getEditor(this.formData.name?"password":"username").focus(),500)},computed:{form:function(){return this.$refs.form.instance}},methods:{...l("Auth",["login","setState","loginWebAuthn"]),onSubmit(){this.login(this.formData).then(({isOk:s,isMaintenance:e,user:t})=>this.responseProcess(s,e,t))},fingerPrintClick(){if(this.formData.username){let s={},e=this.formData.username.includes("@")?"email":"phone";s[e]=this.formData.username,s.username=e,s.routeAction="assert",this.loginWebAuthn(s).then(({isOk:t,isMaintenance:i,user:a})=>this.responseProcess(t,i,a)).catch(()=>this.$toasted.show(this.$t("messages.warning.unregisteredFingerPrint")))}else this.$toasted.show(this.$t("messages.warning.fingerUsernameEmpty"))},responseProcess(s,e,t){if(s)if(this.setLoggedinUsersCookie(t),e)this.$router.push({name:"setting-command"});else{let i=this.$route.query;const a=i.redirect?i.redirect:"overview";delete i.redirect,this.$router.push({name:a,query:i,hash:this.$route.hash})}},onCreateAccountClick(){this.$router.push({name:"create-account"})},viewPasswordClick(){this.form.itemOption("password",{editorOptions:{mode:this.passwordMode?"text":"password",buttons:[{options:{icon:this.passwordMode?"far fa-eye-slash":"far fa-eye",onClick:this.viewPasswordClick},name:"btPw",location:"after"}]}}),this.passwordMode=!this.passwordMode},getLoggedinUsersCookie(){return this.$cookies.isKey(this.$mc.LOGGEDIN_USERS_COOKIE_NAME)?this.$cookies.get(this.$mc.LOGGEDIN_USERS_COOKIE_NAME):[]},setLoggedinUsersCookie(s){let e=this.getLoggedinUsersCookie();e=e.filter(t=>t.username!=s.username),e.push(s),e=e.slice(-5),this.$cookies.set(this.$mc.LOGGEDIN_USERS_COOKIE_NAME,e,"1y")},onItemClick(s){s.itemData.username?(this.formData={...this.formData,...s.itemData},this.$devices.phone&&s.itemData.webauthn?this.fingerPrintClick():setTimeout(()=>this.form.getEditor("password").focus(),500)):(this.formData.username=null,this.formData.name=null,this.formData.avatar=null,setTimeout(()=>this.form.getEditor("username").focus(),500))}}};var d=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"header"},[t("div",{staticClass:"title"},[e._v(e._s(e.$t("auth.login.title")))])]),t("div",{staticClass:"login-form"},[e.formData.name?t("div",{staticClass:"user"},[t("DxDropDownButton",{attrs:{"split-button":!0,"use-select-mode":!1,items:[...e.loggedinUsers,{name:e.$t("auth.login.anotherAccount")}],text:e.formData.name,"display-expr":"name","key-expr":"username",itemTemplate:"itemTemplate",dropDownOptions:{minWidth:260,wrapperAttr:{class:"login-users-popup"}}},on:{"item-click":e.onItemClick},scopedSlots:e._u([{key:"itemTemplate",fn:function({data:i}){return[t("div",{staticStyle:{display:"flex","align-items":"center"}},[i.avatar?t("img",{staticStyle:{width:"30px","border-radius":"50%","margin-right":"5px"},attrs:{alt:e.$appName,src:i.avatar}}):e._e(),t("span",{staticStyle:{"font-size":"16px",padding:"5px"}},[e._v(e._s(i.name))])])]}}],null,!1,4039290376)})],1):e._e(),t("form",{on:{submit:function(i){return i.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("DxForm",{ref:"form",attrs:{"form-data":e.formData,labelMode:"floating"}},[t("DxItem",{attrs:{visible:!e.formData.name,"data-field":"username","editor-type":"dxTextBox","validation-rules":e.validationRules.username,label:{text:e.$t("models.user.username")}}}),t("DxItem",{attrs:{name:"password","data-field":"password","editor-type":"dxTextBox","editor-options":{mode:"password",buttons:[{options:{icon:"far fa-eye",onClick:e.viewPasswordClick},name:"btPw",location:"after"}]},"validation-rules":e.validationRules.password,label:{text:e.$t("models.user.password")}}}),t("DxItem",{attrs:{"data-field":"rememberMe","editor-type":"dxCheckBox","editor-options":{text:e.$t("auth.login.rememberMe"),elementAttr:{class:"form-text"}},label:{visible:!1}}}),t("DxItem",{attrs:{"item-type":"button","button-options":{width:"100%",type:"default",text:e.$t("auth.login.submit"),useSubmitBehavior:!0}}})],1)],1),t("div",{staticClass:"fingerprint"},[t("DxButton",{attrs:{icon:"../../../images/fingerprint.png"},on:{click:e.fingerPrintClick}})],1),t("DxForm",[t("DxItem",{scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"link"},[t("RouterLink",{attrs:{to:{name:"reset-password"}}},[e._v(e._s(e.$t("auth.login.forgotPassword")))])],1)]},proxy:!0}])}),t("DxItem",{scopedSlots:e._u([{key:"default",fn:function(){return[t("div",{staticClass:"create-account"},[t("span",[e._v(e._s(e.$t("auth.login.haveNotAccount")))]),t("span",{staticClass:"link"},[t("RouterLink",{attrs:{to:{name:"create-account"}}},[e._v(e._s(e.$t("auth.login.createAccount")))])],1)])]},proxy:!0}])})],1)],1)])},c=[],h=m(u,d,c,!1,null,null,null,null);const f=h.exports;export{f as default};
