import{A as pi,B as di,C as ui,E as lt,r as L,w as ue,y as ct,o as Z,b as X,m as Ne,d as m,t as ne,e as U,f as ot,F as Be,G as st,g as Le,c as re,a as pt,q as ge,H as j,p as be,I as fi,J as vi,l as De,u as hi,K as mi,x as I,L as K,M as gi,N as se,h as yi,j as Si,k as ke,z as rt,O as Ti}from"./app-a19d8466.js";import xi from"./LineContextMenu-2763616b.js";import{_ as Ci,g as E}from"./select-box-3b3e54f3.js";import wi from"./VpsOtpPopup-cae9923c.js";import{c as Di}from"./lightweight-charts.esm.development-03366bac.js";import"./text-box-3852c4cf.js";function ki(R,B,y){return pi((y==null?void 0:y.in)||R,+di(R)+B)}function Ze(R,B,y){return ki(R,B*ui,y)}const bi=[{price:[[0,100],[50,30],[120,90],[170,50],[200,70],[300,0]],volume:[[0,180],[50,160],[120,200],[170,140],[200,170],[300,100]],et:[[217,50],[237,50]],sl:[[190,70],[210,70]],tp1:[[160,50],[180,50],2],time:170},{price:[[0,100],[50,30],[90,60],[110,40],[140,90],[170,60],[200,80],[300,0]],volume:[[0,200],[50,140],[90,180],[110,160],[140,190],[170,150],[200,170],[300,100]],et:[[215,60],[235,60]],sl:[[190,80],[210,80]],tp1:[[160,60],[180,60],2],time:170},{price:[[0,100],[50,30],[90,90],[130,40],[170,80],[200,50],[230,70],[300,0]],volume:[[0,200],[50,140],[90,180],[130,160],[170,190],[200,150],[230,170],[300,100]],et:[[240,50],[260,50]],sl:[[220,70],[240,70]],tp1:[[120,40],[140,40],2],time:200},{price:[[0,100],[70,20],[110,90],[170,35],[185,70],[200,50],[215,80],[230,40],[245,60],[300,0]],volume:[[0,140],[40,180],[70,120],[110,190],[170,150],[215,170],[300,100]],et:[[255,40],[275,40]],sl:[[235,60],[255,60]],tp1:[[160,35],[180,35],1],time:70},{price:[[0,100],[40,40],[70,60],[110,20],[150,70],[200,50],[240,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,40],[70,60],[110,20],[150,80],[180,40],[200,60],[220,50],[250,70],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[180,150],[250,180],[300,100]]},{price:[[0,100],[40,70],[70,80],[110,20],[150,70],[160,40],[180,60],[200,30],[250,80],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]},{price:[[0,100],[40,60],[70,85],[110,45],[150,65],[200,30],[240,45],[300,0]],volume:[[0,200],[40,130],[70,160],[110,140],[150,170],[200,150],[240,180],[300,100]]}],Li=[{price:[[0,30],[50,0],[100,100],[130,60],[150,75],[170,60],[190,80],[220,40],[250,60],[300,0]],volume:[[0,190],[50,170],[100,200],[130,130],[190,160],[220,120],[250,140],[300,100]],et:[[257,40],[277,40]],sl:[[240,60],[260,60]],tp1:[[210,40],[230,40],2],time:130},{price:[[0,40],[50,10],[100,90],[120,60],[140,80],[170,40],[200,100],[230,60],[250,90],[300,0]],volume:[[0,190],[50,170],[100,200],[170,130],[200,160],[230,140],[250,150],[300,100]],et:[[257,60],[277,60]],sl:[[240,90],[260,90]],tp1:[[160,40],[180,40],.5],tp2:[[40,10],[60,10]],time:170},{price:[[0,80],[40,20],[70,60],[110,0],[140,50],[180,10],[210,40],[250,20],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,0],[70,60],[110,10],[140,50],[180,20],[210,40],[250,30],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]},{price:[[0,80],[40,20],[70,60],[110,10],[140,60],[180,0],[210,70],[250,50],[300,100]],volume:[[0,180],[40,100],[70,130],[110,110],[140,145],[180,125],[210,160],[250,140],[300,200]]}],Me={continueData:bi,reversalData:Li};const Oi={__name:"Pattern",props:["pattern"],setup(R){const B=R,y=L(null),x=L(B.pattern);ue(()=>B.pattern,F=>{x.value=F,d(!0)}),ct(()=>setTimeout(()=>{d()},0));function d(F=!1){if(!x.value)return!1;const u=y.value,h=u.getContext("2d");F&&h.clearRect(0,0,u.width,u.height);const p=x.value.price,M=x.value.volume,T=x.value.et,b=x.value.sl,$=x.value.tp1,Y=x.value.tp2,fe=x.value.time;h.beginPath(),h.strokeStyle="white",h.lineWidth=2,h.setLineDash([1,0]),h.moveTo(p[0][0],p[0][1]);for(let J=1;J<p.length;J++)h.lineTo(p[J][0],p[J][1]);h.stroke(),h.beginPath(),h.strokeStyle="orange",h.moveTo(M[0][0],M[0][1]);for(let J=1;J<M.length;J++)h.lineTo(M[J][0],M[J][1]);h.stroke(),T&&(h.beginPath(),h.strokeStyle="yellow",h.moveTo(T[0][0],T[0][1]),h.lineTo(T[1][0],T[1][1]),h.stroke()),b&&(h.beginPath(),h.strokeStyle="red",h.moveTo(b[0][0],b[0][1]),h.lineTo(b[1][0],b[1][1]),h.stroke()),$&&(h.beginPath(),h.strokeStyle="lime",h.moveTo($[0][0],$[0][1]),h.lineTo($[1][0],$[1][1]),h.stroke(),h.font="15px Arial",h.fillStyle="lime",h.fillText($[2],$[1][0]+5,$[1][1]+5)),Y&&(h.beginPath(),h.strokeStyle="lime",h.moveTo(Y[0][0],Y[0][1]),h.lineTo(Y[1][0],Y[1][1]),h.stroke()),fe&&(h.beginPath(),h.strokeStyle="red",h.setLineDash([5,10]),h.moveTo(fe,0),h.lineTo(fe,200),h.stroke())}return(F,u)=>(Z(),X("canvas",{ref_key:"canvasRef",ref:y,width:"300",height:"200"},null,512))}},We=lt(Oi,[["__scopeId","data-v-251fbed0"]]);const Ri=m("div",{class:"triangle-shadow"},null,-1),_i=m("div",{class:"triangle"},null,-1),Fi={class:"container"},Pi={class:"continue"},Ai={class:"title"},$i={class:"name"},Vi={class:"reversal"},Ii={class:"title"},Ei={class:"name"},Zi={__name:"Index",setup(R){function B(y){y.stopPropagation()}return(y,x)=>{const d=Ne("DxScrollView");return Z(),X("div",{class:"pattern-popup",onClick:B,title:""},[Ri,_i,m("div",Fi,[m("div",Pi,[m("div",Ai,ne(y.$t("trading.derivative.patternContextMenu.continue")),1),U(d,{class:"items"},{default:ot(()=>[(Z(!0),X(Be,null,st(Le(Me).continueData,(F,u)=>(Z(),X("div",{key:u},[m("div",$i,ne(u+1)+".",1),U(We,{pattern:F},null,8,["pattern"])]))),128))]),_:1})]),m("div",Vi,[m("div",Ii,ne(y.$t("trading.derivative.patternContextMenu.reversal")),1),U(d,{class:"items"},{default:ot(()=>[(Z(!0),X(Be,null,st(Le(Me).reversalData,(F,u)=>(Z(),X("div",{key:u},[m("div",Ei,ne(u+1)+".",1),U(We,{pattern:F},null,8,["pattern"])]))),128))]),_:1})])])])}}};const Bi={key:0,class:"tree-node"},Mi={key:0,class:"text"},Wi={key:2},Ni=["innerHTML"],Yi={__name:"TreeNode",props:["node","index","modelValue"],emits:["update:modelValue"],setup(R,{emit:B}){const y=R,x=B,d=re(()=>Array.isArray(y.node.items)),F=re(()=>Array.isArray(y.node.items)&&y.node.items.length>1),u=pt({selectedChild:y.node.items[y.modelValue[y.index]],childValue:y.modelValue,hasChild:!1});u.hasChild=!!u.selectedChild;let h=!1;ue(()=>y.modelValue,T=>{h=!0,u.selectedChild=y.node.items[T[y.index]],u.childValue=T,u.hasChild=!!u.selectedChild,setTimeout(()=>h=!1,1e3)}),ue(()=>y.node,T=>{h=!0,u.selectedChild=T.items[u.childValue[y.index]],u.hasChild=!!u.selectedChild,setTimeout(()=>h=!1,1e3)});function p(){if(h)return!1;u.hasChild=!1,setTimeout(()=>{u.selectedChild&&(u.hasChild=!0)},0);const T=y.node.items.findIndex(b=>b===u.selectedChild);T==-1?u.childValue=u.childValue.slice(0,y.index):(u.childValue=u.childValue.slice(0,y.index+1),u.childValue[y.index]=T),x("update:modelValue",u.childValue)}function M(T){x("update:modelValue",T)}return(T,b)=>{const $=Ne("TreeNode",!0);return R.node.items?(Z(),X("div",Bi,[R.index==0?(Z(),X("div",Mi,ne(T.$t("trading.derivative.progressContextMenu.start")),1)):ge("",!0),m("i",{class:j(`arrow far fa-chevron-${F.value?"double-":""}down`)},null,2),d.value?(Z(),be(Le(Ci),{key:1,items:R.node.items,modelValue:u.selectedChild,"onUpdate:modelValue":b[0]||(b[0]=Y=>u.selectedChild=Y),displayExpr:"name",stylingMode:"outlined","show-clear-button":!0,showDropDownButton:!1,placeholder:T.$t("titles.dxSelectPlacehoder"),onValueChanged:p},null,8,["items","modelValue","placeholder"])):(Z(),X("div",Wi,[m("span",{class:"text",innerHTML:R.node.items},null,8,Ni),R.node.pattern?(Z(),be(We,{key:0,pattern:Le(Me)[R.node.pattern[0]][R.node.pattern[1]-1]},null,8,["pattern"])):ge("",!0)])),u.hasChild?(Z(),be($,{key:3,node:u.selectedChild,index:R.index+1,modelValue:u.childValue,"onUpdate:modelValue":[b[1]||(b[1]=Y=>u.childValue=Y),M]},null,8,["node","index","modelValue"])):ge("",!0)])):ge("",!0)}}},Ji=lt(Yi,[["__scopeId","data-v-d485f979"]]);const zi=m("div",{class:"triangle-shadow"},null,-1),Xi=m("div",{class:"triangle"},null,-1),ji={__name:"Index",props:["modelValue"],emits:["update:modelValue","change"],setup(R,{emit:B}){const y=R,x=B,d=L(null),F=L(!1),u=L({});fi(Object.assign({"../../../../lang/vi/derivative.js":()=>vi(()=>import("./derivative-15b4c4bd.js"),[])}),`../../../../lang/${window.lang}/derivative.js`).then(T=>{u.value=T.default,F.value=!0});const h=L(y.modelValue);ue(()=>y.modelValue,T=>h.value=T);function p(T){x("update:modelValue",T),x("change",T),setTimeout(()=>{d.value.scrollTop=d.value.scrollHeight},0)}function M(T){T.stopPropagation()}return(T,b)=>(Z(),X("div",{class:"progress-popup",onClick:M,title:""},[zi,Xi,m("div",{ref_key:"scrollContainer",ref:d,class:"container"},[F.value?(Z(),be(Ji,{key:0,node:u.value,index:0,modelValue:h.value,"onUpdate:modelValue":[b[0]||(b[0]=$=>h.value=$),p]},null,8,["node","modelValue"])):ge("",!0)],512)]))}};const Hi={class:"content-block dx-card responsive-paddings"},qi=["title"],Qi=["title"],Ui=["title"],Gi=["title"],Ki=["title"],eo=["title"],to=["title"],io=["title"],oo=["title"],so=m("i",{class:"far fa-heart-rate"},null,-1),ro=[so],no=["title"],ao=m("i",{class:"far fa-grip-lines-vertical"},null,-1),lo=[ao],co=["title"],po=m("i",{class:"far fa-horizontal-rule"},null,-1),uo=["title"],fo=m("i",{class:"far fa-line-height"},null,-1),vo=[fo],ho=["title"],mo=m("i",{class:"far fa-percent"},null,-1),go=[mo],yo=["title"],So=m("i",{class:"far fa-heart-rate"},null,-1),To=["title"],xo=["src"],nt=3,at=2,Co="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",Ro={__name:"Index",setup(R){const B={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},y=De(new Date,"yyyy-MM-dd"),x={START:E(new Date(`${y}T08:45:00Z`)),ATO:E(new Date(`${y}T09:00:00Z`)),ATC:E(new Date(`${y}T14:30:00Z`)),END:E(new Date(`${y}T14:45:00Z`))},d=yi(),F=Si(),{t:u}=hi(),h=ke("devices"),p=ke("mf"),M=ke("bus"),T=ke("filters"),b=L(null),$=L(null),Y=L(null),fe=L(null),J=L(null),dt=L(null),ut=L(null),ye=L(null),Oe=L(null),Re=L(null),_e=L(null),Se=L(null),Fe=L(null),ft=L(null),ee=L(null),ve=L(null),Ye=L(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:E(Ze(new Date,7))};te();const f=pt({chartDate:F.query.date??y,clock:De(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,isAutoScan:!1,lineColor:"#F44336",lineTitle:"",progress:[],showLineContext:!1,showSampleContext:!1,showProgressContext:!1,showTradingView:!1}),W=re(()=>d.state.tradingDerivative.status),H=re(()=>d.state.tradingDerivative.config),Je=re(()=>d.state.tradingDerivative.tools),vt=re(()=>W.value.position!=0||!!W.value.pending||!!Je.value.order),ht=re(()=>`https://chart.vps.com.vn/tv/?u=${H.value.vpsUser}&s=${H.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);d.dispatch("tradingDerivative/initChart").then(()=>{console.log("inSession()",q()),q()&&Pe(),!F.query.date&&H.value.lastOpeningDate&&(f.chartDate=H.value.lastOpeningDate),d.dispatch("tradingDerivative/getChartData",{date:f.chartDate}).then(t=>{t&&d.dispatch("tradingDerivative/getTools")})}),e.interval=setInterval(kt,1e3),e.interval60=setInterval(()=>{q()?(d.dispatch("tradingDerivative/getStatus"),H.value.autoScan&&Ee()):clearInterval(e.interval60)},6e4),ct(()=>{e.chart=Di($.value,B),e.chart.subscribeCrosshairMove(yt),e.chart.subscribeCustomPriceLineDragged(St),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(Tt).observe(b.value),document.addEventListener("keydown",je),document.addEventListener("fullscreenchange",He)}),mi(()=>{document.removeEventListener("keydown",je),document.removeEventListener("fullscreenchange",He),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),ue(()=>d.state.tradingDerivative.chartData,wt),ue(()=>Je.value,Ct);function mt(t){f.showLineContext=!1,f.showSampleContext=!1,we(!1),ye.value.classList.contains("selected")?Rt():_e.value.classList.contains("selected")?Xt():Se.value.classList.contains("selected")?Yt():Fe.value.classList.contains("selected")?Pt():Oe.value.classList.contains("selected")?qt():Re.value.classList.contains("selected")&&Bt()}function gt(t){we(!0),t.preventDefault()}function ze(t){t.stopPropagation()}function Xe(t){t.preventDefault(),t.stopPropagation()}function yt(t){if(t.time){let s=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=s}else h.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function St(t){let s=t.customPriceLine,i=s.options();i.price=parseFloat(i.price.toFixed(1));const o=+t.fromPriceString,n=i.price;switch(i.lineType){case"order":if(n!=o){let l=!1;i.kind=="entry"?W.value.position||(l=!0,e.tools.order[i.kind].price=n,d.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(r=>{r.isOk?(ae([i.kind]),I.success(u("trading.derivative.changeEntrySuccess"))):(s.applyOptions({price:o}),N(r.message))})):(l=!0,e.tools.order[i.kind].price=n,i.kind=="tp"?d.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(r=>{r.isOk?(ae([i.kind]),I.success(u("trading.derivative.changeTpSuccess"))):(s.applyOptions({price:o}),N(r.message))}):d.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(ae([i.kind]),I.success(u("trading.derivative.changeSlSuccess"))):(s.applyOptions({price:o}),N(r.message))})),l||(s.applyOptions({price:o}),I.show(u("trading.derivative.noChangeOrderLine")))}break;case"line":d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:o}),d.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[n],data:[i]}),ye.value.classList.remove("selected");break;case"target":if(p.isSet(e.tools.target.B)){let l={isRemove:!1,name:"target",points:[],data:[]},r,a,v=+e.tools.target.A.options().price,S=+e.tools.target.B.options().price,g=S-v;if(r="A",i.point=="A")g=+e.tools.target.B.options().title,S=v+g;else if(i.point!="B"){let w=0;switch(i.point){case"X":w=1.5;break;case"Y":w=2;break;case"Z":w=3;break}g=parseFloat(((S-n)/w).toFixed(1)),v=S-g,a={price:v},e.tools.target[r].applyOptions(a)}l.points.push(r),l.data.push(e.tools.target[r].options()),r="B",a={price:S,title:g.toFixed(1)},i.point==r&&delete a.price,e.tools.target[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.target[r].options()),r="X",a={price:parseFloat((v-.5*g).toFixed(1)),title:(-.5*g).toFixed(1)},i.point==r&&delete a.price,e.tools.target[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.target[r].options()),r="Y",a={price:parseFloat((v-g).toFixed(1)),title:(-g).toFixed(1)},i.point==r&&delete a.price,e.tools.target[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.target[r].options()),r="Z",a={price:parseFloat((v-2*g).toFixed(1)),title:(-2*g).toFixed(1)},i.point==r&&delete a.price,e.tools.target[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.target[r].options()),d.dispatch("tradingDerivative/drawTools",l)}break;case"rr":if(p.isSet(e.tools.rr.TP)){let l={isRemove:!1,symbol:f.symbol,name:"rr",points:[],data:[]},r;const a=+e.tools.rr.EP.options().price,v=+e.tools.rr.SL.options().price,S=+e.tools.rr.TP.options().price;if(i.point=="EP")r="SL",e.tools.rr[r].applyOptions({price:a+v-o}),l.points.push(r),l.data.push(e.tools.rr[r].options()),r="TP",e.tools.rr[r].applyOptions({price:a+S-o}),l.points.push(r),l.data.push(e.tools.rr[r].options());else{const g=v-a,w=S-a;if(w/g>0)return s.applyOptions({price:o}),!1;const k=Math.abs(w)/Math.abs(g);r="EP",e.tools.rr[r].applyOptions({title:`RR=${k.toFixed(1)}`}),l.points.push(r),l.data.push(e.tools.rr[r].options()),r="SL",e.tools.rr[r].applyOptions({title:`SL=${g.toFixed(1)}`}),l.points.push(r),l.data.push(e.tools.rr[r].options()),r="TP",e.tools.rr[r].applyOptions({title:`TP=${w.toFixed(1)}`}),l.points.push(r),l.data.push(e.tools.rr[r].options())}d.dispatch("tradingDerivative/drawTools",l)}break;case"pattern":if(p.isSet(e.tools.pattern.B)){let l={isRemove:!1,name:"pattern",points:[],data:[]},r,a;const v=e.tools.pattern.A.options(),S=e.tools.pattern.B.options(),g=e.tools.pattern.C.options(),w={A:{time:+v.time,price:+v.price},B:{price:+S.price},C:{price:+g.price}},k=i.point=="D"?+e.tools.pattern.D.options().price:null,{pattern:D,timeRS1:O,info:{tr1:P,tr2:c,tr3:C,pr1:G,pr2:V,pr3:z,fibo:A,sp:Q,X:oe,Y:de,Z:it}}=he(w,k);ce(O,!0,!0),pe([D],!0),r="A",a={title:`A ${P} ${G}`},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="B",a={title:`B ${c} ${V}`},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="C",a={title:`C ${C} ${z}`},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="D",a={price:Q,title:"F "+A},i.point==r&&delete a.price,e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="X",a={price:parseFloat((Q+oe).toFixed(1)),title:"T "+parseFloat(oe.toFixed(1))},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="Y",a={price:parseFloat((Q+de).toFixed(1)),title:"T "+parseFloat(de.toFixed(1))},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),r="Z",a={price:parseFloat((Q+it).toFixed(1)),title:"T "+parseFloat(it.toFixed(1))},e.tools.pattern[r].applyOptions(a),l.points.push(r),l.data.push(e.tools.pattern[r].options()),d.dispatch("tradingDerivative/drawTools",l)}break}}function Tt(){b.value&&(e.chart.resize(b.value.offsetWidth,b.value.offsetHeight),b.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function je(t){if(t.ctrlKey)switch(t.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(t.altKey)switch(t.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function He(){b.value&&(document.fullscreenElement?(f.isFullscreen=!0,b.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(f.isFullscreen=!1,b.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function xt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Ct(t){Gt(),Object.entries(t).forEach(([s,i])=>{switch(s){case"order":Object.entries(i).forEach(([o,n])=>{e.tools.order.side=n.side,e.tools.order[o].price=n.price,e.tools.order[o].line=e.series.price.createPriceLine(n)});break;case"line":Object.values(i).forEach(o=>e.tools.lines.push(e.series.price.createPriceLine(o)));break;case"tr":ce(Object.values(i));break;case"progress":pe(Object.values(i)[0]);break;case"target":case"pattern":Object.entries(i).forEach(([o,n])=>e.tools[s][o]=e.series.price.createPriceLine(n));break;case"auto":At(t.auto,!("pattern"in t),!("tr"in t));break}})}function wt(t){f.chartDate==y&&q()||(!t.isDay&&t.price.length>0&&(e.data.whitespace=Te(e.data.whitespace,Qe(f.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=Te(e.data.price,t.price),e.series.price.setData(e.data.price))}function qe(t,s){let i=[];t.forEach(o=>{const n=E(Ze(new Date(o.date),7));i.push({time:n,value:o.price})}),i.length>1?(e.data.price=Te(e.data.price,i),e.series.price.setData(e.data.price)):(e.data.price.push(i[0]),e.series.price.update(i[0]))}function Qe(t){const s=E(new Date(`${t}T09:00:00Z`)),i=E(new Date(`${t}T11:30:00Z`)),o=E(new Date(`${t}T13:00:00Z`)),n=E(new Date(`${t}T14:30:00Z`)),l=E(new Date(`${t}T14:00:00Z`));let r=[];for(let a=s;a<=n;a++){if(a>i&&a<o)continue;let v={time:a};(a==l||a==n)&&(v.value=1),r.push(v)}return r}function Te(t,s){return Array.from(new Map([...t,...s].sort((i,o)=>i.time-o.time).map(i=>[i.time,i])).values())}function Pe(){d.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(Co),e.websocket.onopen=t=>{let s='{"protocol":"json","version":1}';e.websocket.send(s),s='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(s),e.socketSendData=s},e.websocket.onclose=t=>{!e.socketStop&&q()&&(f.isSocketWarning=!0,Pe())},e.websocket.onmessage=t=>{f.isSocketWarning=!1,Dt(t.data).forEach(i=>{if(!i)return!1;i.type==3?(d.dispatch("tradingDerivative/getTools"),e.data.whitespace=Te(e.data.whitespace,Qe(y)),e.series.whitespace.setData(e.data.whitespace),qe(i.result),d.dispatch("tradingDerivative/setChartLoading",!1)):i.type==1&&i.target=="UpdateTrades"&&i.arguments[0]=="VN30F1M"&&(ii(i.arguments[1].at(-1).price),qe(i.arguments[1]))})}}function Dt(t){let s=[];return t.split("").forEach(i=>{const o=i.indexOf("{"),n=i.lastIndexOf("}");let l=null;if(o!==-1&&n!==-1&&n>o){const r=i.substring(o,n+1);r!="{}"&&(l=JSON.parse(r))}s.push(l)}),s}function kt(){e.currentSeconds=E(Ze(new Date,7)),q()&&(W.value.position&&e.currentSeconds>x.ATC-5*60&&(f.isOrderWarning=!0,e.currentSeconds>x.ATC-15&&p.isSet(e.tools.order.tp.line)&&d.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(t=>{t.isOk?(le(["entry","tp","sl"]),I.success(u("trading.derivative.autoCancelTpSlSuccess"))):N(t.message)})),H.value.openingMarket&&e.currentSeconds==x.START&&Pe()),f.clock=De(new Date,"HH:mm:ss")}function ae(t){const s="order";let i={isRemove:!1,name:s,points:[],data:[]},o,n;t.forEach(l=>{switch(l){case"entry":o="yellow",n=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":o="lime",n=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":o="red",n=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(i.points.push(l),p.isSet(e.tools.order[l].line))e.tools.order[l].line.applyOptions({price:e.tools.order[l].price,title:n}),i.data.push(e.tools.order[l].line.options());else{const r={lineType:s,kind:l,side:e.tools.order.side,price:e.tools.order[l].price,color:o,lineWidth:1,lineStyle:0,title:n,draggable:!0};e.tools.order[l].line=e.series.price.createPriceLine(r),i.data.push(r)}}),d.dispatch("tradingDerivative/drawTools",i)}function le(t,s=!0){s&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),t.forEach(i=>{p.isSet(e.tools.order[i].line)&&(e.series.price.removePriceLine(e.tools.order[i].line),delete e.tools.order[i].line)})}function bt(t){f.showTradingView=!f.showTradingView,t.stopPropagation()}function Lt(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||t.target.classList.add("selected")}function Ot(t){f.showLineContext=!f.showLineContext,f.showSampleContext=!1,f.showProgressContext=!1}function Rt(){const t="line",s=me(e.crosshair.y),i=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(o=>{const n=o.options(),l=n.type=s==+n.price;return l&&(e.series.price.removePriceLine(o),d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:t,point:s})),!l}),e.tools.lines.length==i){const o={lineType:t,price:s,color:f.lineColor,title:f.lineTitle,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(o)),d.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:t,points:[s],data:[o]})}ye.value.classList.remove("selected")}function Ue(t=!0){e.tools.lines.length>0&&(t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(s=>e.series.price.removePriceLine(s)),te(["lines"]))}function _t(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||(It(),xe(!1),Ce(!1),Ve(!1),t.target.classList.add("selected"))}function Ft(t){d.dispatch("tradingDerivative/setAutoScan",!H.value.autoScan),t.target.classList.remove("selected")}function Pt(){Fe.value.classList.remove("selected");const t=e.crosshair.time?e.data.price.filter(r=>r.time<=e.crosshair.time):e.data.price;let s={isRemove:!1,name:"auto",points:[],data:[]};const i=$t(t);if(!p.isSet(i))return!1;const{pattern:o,timeRS1:n,info:l}=he(i);ce(n,!0),pe([o]),xe(!1),Ge(i,l),JSON.stringify(e.tools.auto)!=JSON.stringify(i)&&(e.tools.auto=i,Object.entries(i).forEach(([r,a])=>{s.points.push(r),s.data.push(a)}),d.dispatch("tradingDerivative/drawTools",s))}function At(t,s=!0,i=!0){if(!s)return!1;const o=p.cloneDeep(t);e.tools.auto=o;const{pattern:n,timeRS1:l,info:r}=he(o);if(!p.isSet(o))return!1;i&&ce(l,!0),pe([n]),Ge(o,r)}function $t(t){let s,[i,o,n,l,r]=Array(5).fill({});for(let a=t.length-1;a>=0;a--){const v=t[a].value,S=t[a].time,g=ie(S);if(g==-1)break;if(a==t.length-1&&(l={index:g,time:S,price:v},[n,o,i,r]=Array(4).fill(null).map(()=>p.cloneDeep(l))),s==null){if(v==l.price)continue;s=l.price>v}if(!_(o.price,s,l.price)&&_(v,!s,n.price)&&(n={index:g,time:S,price:v}),_(v,s,o.price)&&(_(i.price,!s,n.price)?([l,n,o]=[n,o,i].map(w=>p.cloneDeep(w)),i={index:g,time:S,price:v},r=p.cloneDeep(i),s=!s):l.index-n.index<=20?(l=p.cloneDeep(n),o=p.cloneDeep(n),n={index:g,time:S,price:v},s=!s):o={index:g,time:S,price:v}),_(v,!s,i.price)?(i={index:g,time:S,price:v},r=p.cloneDeep(i)):r.index=g,_(v,s,r.price)&&(r={index:g,time:S,price:v}),n.index>i.index){const w=Math.abs(o.price-n.price);if(w>=1.5&&(i.index-r.index>n.index-o.index||Math.abs(i.price-r.price)>w))break}}return Vt({A:i,B:o,C:n,D:l})}function Vt(t){const s={};return Object.entries(t).forEach(([i,o])=>{const{index:n,...l}=o;s[i]=l}),s}function It(t=!0){t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"auto"}),te(["auto"])}function Et(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||t.target.classList.add("selected")}function Zt(t){t.target.classList.remove("selected"),xe(!0),Ce(!0),Ve(!0)}function Bt(){const t="pattern",s=me(e.crosshair.y),i=e.crosshair.time;let o={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},n={isRemove:!1,name:t,points:[],data:[]};if(p.isSet(e.tools.pattern.A)){const l=e.tools.pattern.A.options();if(p.isSet(e.tools.pattern.B)){const r=e.tools.pattern.B.options();if(p.isSet(e.tools.pattern.C)){let a,v;const S=e.tools.pattern.C.options(),g={A:{time:i,price:s},B:{price:+r.price},C:{price:+S.price}},{pattern:w,timeRS1:k,info:{tr1:D,tr2:O,tr3:P,pr1:c,pr2:C,pr3:G,fibo:V,sp:z,X:A,Y:Q,Z:oe}}=he(g);ce(k,!0,!0),pe([w],!0),a="A",v={price:s,time:i,title:`A ${D} ${c}`},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="B",v={title:`B ${O} ${C}`},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="C",v={title:`C ${P} ${G}`},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="D",v={price:z,title:"F "+V},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="X",v={price:parseFloat((z+A).toFixed(1)),title:"T "+parseFloat(A.toFixed(1))},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="Y",v={price:parseFloat((z+Q).toFixed(1)),title:"T "+parseFloat(Q.toFixed(1))},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options()),a="Z",v={price:parseFloat((z+oe).toFixed(1)),title:"T "+parseFloat(oe.toFixed(1))},e.tools.pattern[a].applyOptions(v),n.points.push(a),n.data.push(e.tools.pattern[a].options())}else{const a={A:{time:+l.time,price:+l.price},B:{price:+r.price},C:{price:s}},{pattern:v,timeRS1:S,info:{tr1:g,tr2:w,tr3:k,pr1:D,pr2:O,pr3:P,fibo:c,sp:C,X:G,Y:V,Z:z}}=he(a);ce(S,!0,!0),pe([v],!0);let A="A";e.tools.pattern[A].applyOptions({title:`A ${g} ${D}`}),n.points.push(A),n.data.push(e.tools.pattern[A].options()),A="B",e.tools.pattern[A].applyOptions({title:`B ${w} ${O}`}),n.points.push(A),n.data.push(e.tools.pattern[A].options()),o.point="C",o.title=`C ${k} ${P}`,o.color="#FF9800",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o)),o.point="D",o.price=C,o.title="F "+c,o.color="#4CAF50",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o)),o.point="X",o.price=parseFloat((C+G).toFixed(1)),o.title="T "+parseFloat(G.toFixed(1)),o.color="#2196F3",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o)),o.point="Y",o.price=parseFloat((C+V).toFixed(1)),o.title="T "+parseFloat(V.toFixed(1)),o.color="#673AB7",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o)),o.point="Z",o.price=parseFloat((C+z).toFixed(1)),o.title="T "+parseFloat(z.toFixed(1)),o.color="#9C27B0",o.draggable=!1,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o))}Re.value.classList.remove("selected")}else o.point="B",o.title="B 0 0",o.color="#009688",e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o))}else o.point="A",o.title="A 0 0",o.color="#F44336",o.time=i,e.tools.pattern[o.point]=e.series.price.createPriceLine(o),n.points.push(o.point),n.data.push(p.cloneDeep(o));d.dispatch("tradingDerivative/drawTools",n)}function Ge({A:t,B:s,C:i},{tr1:o,tr2:n,tr3:l,pr1:r,pr2:a,pr3:v,fibo:S,sp:g,X:w,Y:k,Z:D},O=!1){if(!e.data.price.length)return!1;const P="pattern";let c={lineType:P,lineWidth:1,lineStyle:1,draggable:!0},C={isRemove:!1,name:P,points:[],data:[]};c.point="A",c.title=`A ${o} ${r}`,c.color="#F44336",c.price=t.price,c.time=t.time,e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="B",c.title=`B ${n} ${a}`,c.color="#009688",c.price=s.price,e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="C",c.price=i.price,c.title=`C ${l} ${v}`,c.color="#FF9800",e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="D",c.price=g,c.title="F "+S,c.color="#4CAF50",e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="X",c.price=parseFloat((g+w).toFixed(1)),c.title="T "+parseFloat(w.toFixed(1)),c.color="#2196F3",c.draggable=!1,e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="Y",c.price=parseFloat((g+k).toFixed(1)),c.title="T "+parseFloat(k.toFixed(1)),c.color="#673AB7",c.draggable=!1,e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),c.point="Z",c.price=parseFloat((g+D).toFixed(1)),c.title="T "+parseFloat(D.toFixed(1)),c.color="#9C27B0",c.draggable=!1,e.tools.pattern[c.point]=e.series.price.createPriceLine(c),C.points.push(c.point),C.data.push(p.cloneDeep(c)),O&&d.dispatch("tradingDerivative/drawTools",C)}function he(t,s=null){const i=Ae(t.A,t.B),o=Ae(i.R,t.C,i.tr),n=Ae(o.R,o.S,i.tr),l=[i.R1.time,i.S1.time],r=t.C.price-t.B.price,a=t.A.price-t.B.price,v=r>0,S=i.S1.price-i.R1.price,g=o.R1.price-o.S1.price,w=n.S1.price-n.R1.price;let[k,D,O,P,c,C]=Array(6).fill(0);P=parseInt(S/a*100),_(i.R1.price,v,t.B.price)&&_(i.S1.price,!v,t.C.price)&&(k=1),Math.abs(r)>1.5&&_(r,v,S)&&(c=parseInt(g/r*100),c>50&&(o.count==1?D=1:r/a<.5&&(o.count>1||o.over)?D=2:k==1&&_(o.S1.price,!v,i.R1.price)&&_(o.R1.price,v,i.S1.price)&&(D=3)),C=parseInt(w/r*100),C>40&&(n.count==1?O=1:r/a<.5&&(n.count>1||n.over)&&(O=2)),D==0&&c>50&&O==0&&C>50&&o.tr>.5*i.tr&&o.pr>.5*i.pr&&n.R.index-n.S.index>=i.tr&&Math.abs(n.S.price-n.R1.price)>=i.pr&&(D=4));const G=Mt(D,O,c,C);let V=s;if(!V){let de=0;V=t.B.price,D>0&&_(g,v,de)&&(de=g,V=D<4?o.S1.price:n.S1.price),O>0&&_(w,v,de)&&(V=n.R1.price)}const z=parseInt((D==4?(V-n.R1.price)/(t.C.price-n.R1.price):(t.C.price-V)/r)*100),A=V-(D==4?n.R1.price:t.C.price),Q=.5*A,oe=2*A;return{pattern:G,timeRS1:l,info:{tr1:k,tr2:D,tr3:O,pr1:P,pr2:c,pr3:C,fibo:z,sp:V,X:Q,Y:A,Z:oe}}}function Ae(t,s,i=0){let o=p.cloneDeep(t),n=p.cloneDeep(s);const l=n.price>o.price;let r={},a={};e.data.price.filter(g=>g.time>=o.time).every((g,w)=>{const k=g.value,D=g.time,O=ie(D);if(O==-1)return!1;if((w==0||k==o.price)&&(r={R:{index:O,time:D,price:k},S:{index:O,time:D,price:k}},a={R:r.R,S:r.S,pr:0,tr:0,count:0,over:!1}),_(k,l,r.R.price)){const P=r.S.index-r.R.index,c=Math.abs(r.S.price-r.R.price);P>=a.tr&&c>=a.pr&&(a.tr=P,a.pr=c,a.R=r.R,a.S=r.S,i>0&&P>=i&&(a.count++,P>=3*i&&(a.over=!0))),r={R:{index:O,time:D,price:k},S:{index:O,time:D,price:k}},c>=2*a.pr&&(a={R:r.R,S:r.S,pr:0,tr:0,count:0,over:!1})}else r.S.index=O,r.S.time=D,_(k,!l,r.S.price)&&(r.S.price=k);return _(k,!l,o.price)?(r.S.price=o.price,!1):!!_(k,!l,n.price)});const v=r.S.index-r.R.index,S=Math.abs(r.S.price-r.R.price);return(v>=a.tr&&S>=a.pr||S>=2*a.pr)&&(a.tr=v,a.pr=S,a.R=r.R,a.S=r.S,i>0&&v>=i&&(a.count++,v>=3*i&&(a.over=!0))),n.time=r.S.time,o.index=ie(o.time),n.index=ie(n.time),{tr:a.tr,pr:a.pr,count:a.count,over:a.over,S1:a.S,R1:a.R,S:o,R:n}}function Mt(t,s,i,o){if(i>=o){if(t>0)return t<4?0:2;if(s>0)return 1}else{if(s>0)return 1;if(t>0)return t<4?0:2}return 3}function xe(t=!0,s=!1){t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"pattern"}),s||(p.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),p.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),p.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y),e.series.price.removePriceLine(e.tools.pattern.Z)))),te(["pattern"]))}function Wt(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||t.target.classList.add("selected")}function Nt(t){Ce(),t.target.classList.remove("selected")}function Yt(){let t={isRemove:!1,name:"tr",points:[],data:[]},s={time:e.crosshair.time,value:1};switch(e.tools.timeRange.length){case 0:s.color="OrangeRed",e.tools.timeRange[0]=s,t.points.push(0),t.data.push(s);break;case 1:s.color="lime",e.tools.timeRange[1]=s,t.points.push(1),t.data.push(s),Se.value.classList.remove("selected");break;default:const i=ie(e.tools.timeRange[0].time),o=ie(e.tools.timeRange[1].time),l=ie(s.time)+(o-i);s.color="OrangeRed",e.tools.timeRange[0]=p.cloneDeep(s),t.points.push(0),t.data.push(p.cloneDeep(s)),s.time=e.data.whitespace[l].time,s.color="lime",e.tools.timeRange[1]=s,t.points.push(1),t.data.push(s),Se.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),d.dispatch("tradingDerivative/drawTools",t)}function ce(t,s=!1,i=!1){s&&(t=[{time:t[0],value:1,color:"OrangeRed"},{time:t[1],value:1,color:"lime"}]),e.tools.timeRange=t,e.series.timeRange.setData(t),i&&d.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"tr",points:[0,1],data:t})}function Ce(t=!0,s=!1){t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),s||(e.series.timeRange.setData([]),te(["tr"]))}function Jt(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||(t.target.classList.add("selected"),$e())}function zt(t){$e(),t.target.classList.remove("selected")}function Xt(){const t="target",s=me(e.crosshair.y);let i={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:t,points:[],data:[]};if(p.isSet(e.tools.target.A)){const n=+e.tools.target.A.options().price,l=s-n;i.point="B",i.title=parseFloat(l.toFixed(1)),i.color="#F44336",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i)),i.point="X",i.price=parseFloat((n-.5*l).toFixed(1)),i.title=parseFloat((-.5*l).toFixed(1)),i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i)),i.point="Y",i.price=parseFloat((n-l).toFixed(1)),i.title=parseFloat(-l.toFixed(1)),i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i)),i.point="Z",i.price=parseFloat((n-2*l).toFixed(1)),i.title=parseFloat((-2*l).toFixed(1)),i.color="#9C27B0",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i)),_e.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i));d.dispatch("tradingDerivative/drawTools",o)}function $e(t=!0){t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),p.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),p.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z))),te(["target"])}function jt(t){f.showLineContext=!1;const s=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),s||(t.target.classList.add("selected"),Ke())}function Ht(t){Ke(),t.target.classList.remove("selected")}function qt(){const t="rr",s=me(e.crosshair.y);let i={lineType:t,price:s,lineWidth:1,lineStyle:1,draggable:!0},o={isRemove:!1,name:t,points:[],data:[]};if(p.isSet(e.tools.rr.EP)){const n=+e.tools.rr.EP.options().price;if(p.isSet(e.tools.rr.SL)){const l=+e.tools.rr.SL.options().price,r=l-n;let a=s-n;if(a/r>0){const g=n-(l-n);i.price=g,a=g-n}i.point="TP",i.title=`TP=${a.toFixed(1)}`,i.color="lime",e.tools.rr[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i));const v=Math.abs(a)/Math.abs(r),S="EP";e.tools.rr[S].applyOptions({title:`RR=${v.toFixed(1)}`}),o.points.push(S),o.data.push(e.tools.rr[S].options()),Oe.value.classList.remove("selected")}else{const l=s-n;i.point="SL",i.title=`SL=${l.toFixed(1)}`,i.color="red",e.tools.rr[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i))}}else i.point="EP",i.title="RR=",i.color="yellow",e.tools.rr[i.point]=e.series.price.createPriceLine(i),o.points.push(i.point),o.data.push(p.cloneDeep(i));d.dispatch("tradingDerivative/drawTools",o)}function Ke(t=!0){t&&d.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"rr"}),p.isSet(e.tools.rr.EP)&&(e.series.price.removePriceLine(e.tools.rr.EP),p.isSet(e.tools.rr.SL)&&(e.series.price.removePriceLine(e.tools.rr.SL),p.isSet(e.tools.rr.TP)&&e.series.price.removePriceLine(e.tools.rr.TP))),te(["rr"])}function Qt(){f.showSampleContext=!f.showSampleContext,f.showProgressContext=!1,f.showLineContext=!1}function Ut(){f.showProgressContext=!f.showProgressContext,f.showSampleContext=!1,f.showLineContext=!1}function pe(t,s=!1){f.progress=t,s&&Ie(f.progress)}function Ve(t=!0,s=!1){t&&Ie([]),s||(f.progress=[])}function Ie(t){d.dispatch("tradingDerivative/drawTools",{isRemove:!t.length,name:"progress",points:[""],data:[t]})}function Gt(){le(["entry","tp","sl"],!1),Ue(!1),$e(!1),Ce(!1),Ve(!1),xe(!1)}function we(t){if(t){if(q()&&(p.isSet(e.tools.order.tp.line)||W.value.position&&e.currentSeconds>x.ATO&&e.currentSeconds<x.ATC&&(ve.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",ve.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",ve.value.style.display="block"),!p.isSet(e.tools.order.entry.line))){let s=null,i=0;W.value.position?(e.currentSeconds<x.ATO?s="ATO":e.currentSeconds>x.ATC&&(s="ATC"),s&&(e.tools.order.entry.price=s,i=-W.value.position)):e.currentSeconds>x.ATO&&e.currentSeconds<x.ATC&&(s=me(e.crosshair.y),i=s>=e.data.price.at(-1).value?1:-1,e.tools.order.side=i,e.tools.order.entry.price=s),i&&(ee.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",ee.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",ee.value.style.background=i>0?"green":"red",ee.value.innerText=`${i>0?"LONG":"SHORT"} ${s}`,ee.value.style.display="block")}}else ee.value.style.display="none",ve.value.style.display="none"}function Kt(){q()&&(e.currentSeconds<x.ATO?rt(u("trading.derivative.atoOrder"),u("titles.confirm")).then(s=>{s&&d.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(i=>{i.isOk?I.success(u("trading.derivative.atoOrderSuccess")):N(i.message)})}):e.currentSeconds<x.ATC?d.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(t=>{t.isOk?(ae(["entry"]),I.success(u("trading.derivative.newEntrySuccess"))):N(t.message)}):rt(u("trading.derivative.atcOrder"),u("titles.confirm")).then(s=>{s&&d.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(i=>{i.isOk?I.success(u("trading.derivative.atcOrderSuccess")):N(i.message)})}))}function ei(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*nt,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*at,d.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(t=>{t.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),ae(["entry","tp","sl"]),I.success(u("trading.derivative.newTpSlSuccess"))):N(t.message)})}function ti(){p.isSet(e.tools.order.entry.line)?p.isSet(e.tools.order.tp.line)?d.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(le(["entry","tp","sl"]),I.success(u("trading.derivative.exitSuccess"))):N(t.message)}):d.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(t=>{t.isOk?(le(["entry"]),I.success(u("trading.derivative.deleteEntrySuccess"))):N(t.message)}):Ee()}function ii(t){p.isSet(e.tools.order.entry.line)&&(p.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&t>=e.tools.order.tp.price||e.tools.order.side<0&&t<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,d.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(s=>{s.isOk?(le(["entry","tp","sl"]),I.success(u("trading.derivative.deleteTpSuccess")),we(!1)):N(s.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&t<=e.tools.order.sl.price||e.tools.order.side<0&&t>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,d.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(s=>{s.isOk?(le(["entry","tp","sl"]),I.success(u("trading.derivative.deleteSlSuccess")),we(!1)):N(s.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&t>=e.tools.order.entry.price||e.tools.order.side<0&&t<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*nt,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*at,d.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(s=>{s.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),ae(["entry","tp","sl"]),I.success(u("trading.derivative.autoNewTpSlSuccess"))):N(s.message),e.isAutoOrdering=!1})},1e3))))}function oi(){e.chart.timeScale().scrollToRealTime()}function q(){return H.value.openingMarket&&e.currentSeconds>=x.START&&e.currentSeconds<=x.END}function me(t){return parseFloat(e.series.price.coordinateToPrice(t).toFixed(1))}function N(t){t||(t="unknown"),I.error(u(`trading.derivative.${t}`))}function si(){if(!f.chartDate)return!1;d.dispatch("tradingDerivative/getChartData",{date:f.chartDate})}function et(){q()&&e.websocket.send(e.socketSendData)}function tt(t){e.data.whitespace=[],e.data.price=[],et(),d.dispatch("tradingDerivative/getChartData",{date:f.chartDate,isDay:t})}function Ee(){d.dispatch("tradingDerivative/getTools")}function te(t){t==null&&(t=["order","lines","rr","target","tr","pattern","auto"]),t.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),t.includes("lines")&&(e.tools.lines=[]),t.includes("rr")&&(e.tools.rr={EP:{},SL:{},TP:{}}),t.includes("target")&&(e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),t.includes("tr")&&(e.tools.timeRange=[]),t.includes("pattern")&&(e.tools.pattern={A:{},B:{},C:{},D:{},X:{},Y:{},Z:{}}),t.includes("auto")&&(e.tools.auto={})}function ri(){d.dispatch("tradingDerivative/getAccountInfo").then(t=>{let s="";s+='<div style="width: 200px;">',s+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${u("trading.derivative.nav")}</div><div>: ${T.currency(t.nav)}</div></div>`,s+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${u("trading.derivative.maxVol")}</div><div>: ${T.numberVnFormat(t.maxVol)}</div></div>`,s+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${u("trading.derivative.vm")}</div><div>: ${T.currency(t.vm)}</div></div>`,s+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${u("trading.derivative.fee")}</div><div>: ${T.currency(t.fee)}</div></div>`,s+="</div>",Ti(s,u("trading.derivative.accountInfo"))})}function ni(){M.emit("checkPin",()=>d.dispatch("tradingDerivative/report"))}function ai(){M.emit("checkPin",()=>d.dispatch("tradingDerivative/export",f.chartDate))}function li(){Ye.value.show()}function ci(){M.emit("checkPin",()=>d.dispatch("tradingDerivative/loginDnse"))}function _(t,s,i,o=!1){return s?o?t>=i:t>i:o?t<=i:t<i}function ie(t){let s=e.data.whitespace.findIndex(i=>i.time==t);if(s==-1){const i=De(new Date(t*1e3),"yyyy-MM-dd"),o=E(new Date(`${i}T11:30:00Z`)),n=E(new Date(`${i}T13:00:00Z`)),l=E(new Date(`${i}T14:30:00Z`));t>o&&t<n?t=o:t>l&&(t=l),s=e.data.whitespace.findIndex(r=>r.time==t)}return s}return(t,s)=>{const i=Ne("DxToolbar");return Z(),X(Be,null,[m("div",Hi,[U(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:t.$t("trading.derivative.buttons.report"),onClick:ni}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:t.$t("trading.derivative.buttons.export"),onClick:ai}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:t.$t("trading.derivative.buttons.loginVps"),onClick:li}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:t.$t("trading.derivative.buttons.loginDnse"),onClick:ci}}]},null,8,["items"]),m("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:b,onClick:mt,onContextmenu:gt},[m("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:$},[m("div",{class:"area data-area",onClick:ze,onContextmenu:Xe},[m("div",{ref_key:"connectionRef",ref:Y,class:j(["command",{yellow:W.value.pending}]),title:t.$t("trading.derivative.connection"),onClick:s[0]||(s[0]=()=>t.$store.dispatch("tradingDerivative/getStatus"))},[m("i",{class:j(["far",{"fa-link-simple":W.value.connection,"fa-link-simple-slash":!W.value.connection,blink:f.isSocketWarning}])},null,2)],10,qi),m("div",{class:j(["command status",{green:W.value.position>0,red:W.value.position<0}]),title:t.$t("trading.derivative.position"),onClick:ri},ne(W.value.position),11,Qi),m("div",{class:"command clock",onClick:et},ne(f.clock),1),K(m("input",{type:"date",class:"chart-date command",title:t.$t("trading.derivative.date"),"onUpdate:modelValue":s[1]||(s[1]=o=>f.chartDate=o),onChange:si},null,40,Ui),[[gi,f.chartDate]]),m("div",{ref_key:"reloadToolRef",ref:dt,class:"command",title:t.$t("trading.derivative.reload"),onClick:s[2]||(s[2]=()=>tt(!1)),onContextmenu:s[3]||(s[3]=()=>tt(!0))},[m("i",{class:j(["far fa-sync-alt",{"fa-spin":t.$store.state.tradingDerivative.isChartLoading}])},null,2)],40,Gi)],32),m("div",{class:"area tool-area",onClick:ze,onContextmenu:Xe},[m("div",{ref_key:"fullscreenToolRef",ref:fe,class:"command",title:t.$t("trading.derivative.fullscreen"),onClick:xt},[m("i",{class:j(["far",{"fa-compress":f.isFullscreen,"fa-expand":!f.isFullscreen}])},null,2)],8,Ki),m("div",{ref_key:"tradingviewRef",ref:ut,class:"command far fa-chart-candlestick",title:t.$t("trading.derivative.tradingview"),onClick:bt,onContextmenu:Ee},null,40,eo),m("div",{class:j(["popup command",{green:f.progress[0]<=2,red:f.progress[0]>2}]),title:t.$t("trading.derivative.progressTool"),onClick:Ut},[m("i",{class:j(["far",{"fa-badge-check":!f.progress.length,[`fa-circle-${f.progress[0]+1}`]:f.progress.length}])},null,2),K(U(ji,{class:"contextmenu",modelValue:f.progress,"onUpdate:modelValue":s[4]||(s[4]=o=>f.progress=o),onChange:Ie},null,8,["modelValue"]),[[se,f.showProgressContext]])],10,to),m("div",{ref_key:"autoScanToolRef",ref:Fe,class:"command",title:t.$t("trading.derivative.autoScanTool"),onClick:_t,onContextmenu:Ft},[m("i",{class:j(["far fa-bolt-auto",{blink:H.value.autoScan}])},null,2)],40,io),m("div",{ref_key:"patternToolRef",ref:Re,class:"command",title:t.$t("trading.derivative.patternTool"),onClick:Et,onContextmenu:Zt},ro,40,oo),m("div",{ref_key:"timeRangeToolRef",ref:Se,class:"command",title:t.$t("trading.derivative.timeRangeTool"),onClick:Wt,onContextmenu:Nt},lo,40,no),m("div",{ref_key:"lineToolRef",ref:ye,class:"popup command",title:t.$t("trading.derivative.lineTool"),onClick:Lt,onContextmenu:Ot},[po,K(U(xi,{class:"contextmenu",enable:f.showLineContext,title:f.lineTitle,"onUpdate:title":s[5]||(s[5]=o=>f.lineTitle=o),color:f.lineColor,"onUpdate:color":s[6]||(s[6]=o=>f.lineColor=o),onDeleteAllLine:Ue},null,8,["enable","title","color"]),[[se,f.showLineContext]])],40,co),m("div",{ref_key:"targetToolRef",ref:_e,class:"command",title:t.$t("trading.derivative.targetTool"),onClick:Jt,onContextmenu:zt},vo,40,uo),K(m("div",{ref_key:"rrToolRef",ref:Oe,class:"command",title:t.$t("trading.derivative.rrTool"),onClick:jt,onContextmenu:Ht},go,40,ho),[[se,!1]]),K(m("div",{class:"popup command",title:t.$t("trading.derivative.sampleTool"),onClick:Qt},[So,K(U(Zi,{class:"contextmenu"},null,512),[[se,f.showSampleContext]])],8,yo),[[se,!1]]),K(m("div",{ref_key:"cancelOrderRef",ref:ft,class:"cancel-order command",title:t.$t("trading.derivative.cancelTool"),onClick:ti},[m("i",{class:j(["far fa-trash-alt",{blink:f.isOrderWarning}])},null,2)],8,To),[[se,vt.value]])],32),m("div",null,[m("div",{ref_key:"entryOrderRef",ref:ee,class:"order-button entry",onClick:Kt}," Entry ",512),m("div",{ref_key:"tpslOrderRef",ref:ve,class:"order-button tpsl",onClick:ei}," TP/SL ",512),m("div",{class:"chart-top command far fa-angle-double-right",onClick:oi})]),K(m("iframe",{ref_key:"tradingviewChartRef",ref:J,class:"tradingview-chart",src:ht.value},null,8,xo),[[se,f.showTradingView]])],512)],544)]),U(wi,{ref_key:"vpsOtpPopupRef",ref:Ye},null,512)],64)}}};export{Ro as default};
