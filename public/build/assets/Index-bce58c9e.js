import{O as Jt,N as ei,Q as ti,R as ii,S as ue,T as J,U as E,V,W as oi,X as he,Y as si,Z as ni,$ as L,a0 as Be,a1 as Me,a2 as Le,a3 as re,a4 as ai,a5 as fe,a6 as Fe,a7 as ri,a8 as W,a9 as P,aa as He,ab as Ne,ac as li,ad as ci,ae as pe,af as Ee,ag as Te,ah as Pe,ai as di,aj as ui,ak as pi,al as hi,am as fi,an as vi,ao as mi,ap as gi,aq as _i,ar as ke,as as bi,at as Si,au as Ci,av as yi,K as wi,L as xe,M as We,u as Li,b as Ei,c as Ti,i as $e,r as x,d as Pi,e as N,x as ki,w as xi,f as $i,g as Oi,j as Y,h as S,l as Oe,z as X,A as G,E as Z,C as Ri,G as Q,o as Di,H as Ai,v as Vi}from"./app-ff2b8f99.js";import Ii from"./ColorPicker-328414a3.js";import{c as Bi}from"./lightweight-charts.esm.development-03366bac.js";import{_ as Re}from"./select-box-af2d22e0.js";import{T as Mi}from"./track_bar-ecbebff9.js";var R={},Fi={left:"borderLeftWidth",top:"borderTopWidth",right:"borderRightWidth",bottom:"borderBottomWidth"},Hi=["shading","target","$arrow"],A={left:-1,top:-1,center:0,right:1,bottom:1},ze={top:{my:"bottom center",at:"top center",collision:"fit flip"},bottom:{my:"top center",at:"bottom center",collision:"fit flip"},right:{my:"left center",at:"right center",collision:"flip fit"},left:{my:"right center",at:"left center",collision:"flip fit"}},Ni={h:10,v:10};class Ke extends Jt{constructor(o){var{shading:s,target:p,$arrow:a}=o,v=ei(o,Hi);super(v),this._props=ti({},this._props,{shading:s,target:p}),this._$arrow=a,this._positionSide=void 0,this.updatePosition(this._props.position)}positionWrapper(){this._props.shading&&this._$wrapper.css({top:0,left:0})}updateTarget(o){this._props.target=o,this.updatePosition(this._props.position)}_renderBoundaryOffset(){}_getContainerPosition(){var o=ii(this._position.offset||""),{h:s,v:p}=o,a=this._isVerticalSide(),v=this._isHorizontalSide();if(a||v){var f=this._isPopoverInside(),b=(f?-1:1)*A[this._positionSide],T=a?ue(this._$arrow):J(this._$arrow),C=this._getContentBorderWidth(this._positionSide),y=b*(T-C);a?p+=y:s+=y}return E({},this._position,{offset:s+" "+p})}_getContentBorderWidth(o){var s=this._$content.css(Fi[o]);return parseInt(s)||0}_isPopoverInside(){var o=V.setup.normalizeAlign(this._position.my),s=V.setup.normalizeAlign(this._position.at);return o.h===s.h&&o.v===s.v}_isVerticalSide(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._positionSide;return o==="top"||o==="bottom"}_isHorizontalSide(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._positionSide;return o==="left"||o==="right"}_getDisplaySide(o){var s=V.setup.normalizeAlign(o.my),p=V.setup.normalizeAlign(o.at),a=A[s.h]===A[p.h]&&A[s.v]===A[p.v]?-1:1,v=Math.abs(A[s.h]-a*A[p.h]),f=Math.abs(A[s.v]-a*A[p.v]);return v>f?p.h:p.v}_normalizePosition(o){var s={of:this._props.target,boundaryOffset:Ni},p;return oi(o)?p=E(!0,{},s,this._positionToObject(o)):p=s,this._positionSide=this._getDisplaySide(p),p}_positionToObject(o){return he(o)?E({},ze[o]):o}}var Wi="dx-popover",zi="dx-popover-wrapper",Ki="dx-popover-arrow",ji="dx-popover-without-title",De={left:"right",top:"bottom",right:"left",bottom:"top",center:"center"},je=function(t){return Fe(t)?t.name:t},qe=function(t,o){var s=t.option(o);return je(s)},qi=function(t,o){var s=t.option(o);return Fe(s)&&s.delay},le=function(t,o){var{target:s,shading:p,disabled:a,hideEvent:v}=t.option(),f=he(s),b=p&&o==="hide",T=b?null:qe(t,"".concat(o,"Event"));if(b&&v&&ri.log("W1020"),!(!T||a)){var C=W(T,t.NAME),y=t._createAction((function(){var k=qi(t,o+"Event");this._clearEventsTimeouts(),k?this._timeouts[o]=setTimeout(function(){t[o]()},k):t[o]()}).bind(t),{validatingTargetName:"target"}),$=function(k){y({event:k,target:L(k.currentTarget)})},w="_"+o+"EventHandler";if(f)t[w]=$,P.on(He.getDocument(),C,s,$);else{var B=Ne(L(s));t[w]=void 0,P.on(B,C,$)}}},ce=function(t,o,s,p){var a=p||qe(t,s+"Event");if(a){a=W(a,t.NAME);var v="_"+s+"EventHandler";t[v]?P.off(He.getDocument(),a,o,t[v]):P.off(Ne(L(o)),a)}},Ue=si.inherit({_getDefaultOptions:function(){return E(this.callBase(),{target:void 0,shading:!1,position:E({},ze.bottom),hideOnOutsideClick:!0,animation:{show:{type:"fade",from:0,to:1},hide:{type:"fade",from:1,to:0}},showTitle:!1,width:"auto",height:"auto",dragEnabled:!1,resizeEnabled:!1,fullScreen:!1,hideOnParentScroll:!0,arrowPosition:"",arrowOffset:0,_fixWrapperPosition:!0})},_defaultOptionsRules:function(){return[{device:{platform:"ios"},options:{arrowPosition:{boundaryOffset:{h:20,v:-10},collision:"fit"}}},{device:function(){return!ni()},options:{animation:null}}]},_init:function(){this.callBase(),this._renderArrow(),this._timeouts={},this.$element().addClass(Wi),this.$wrapper().addClass(zi)},_render:function(){this.callBase.apply(this,arguments),this._detachEvents(this.option("target")),this._attachEvents()},_detachEvents:function(t){ce(this,t,"show"),ce(this,t,"hide")},_attachEvents:function(){le(this,"show"),le(this,"hide")},_renderArrow:function(){this._$arrow=L("<div>").addClass(Ki).prependTo(this.$overlayContent())},_documentDownHandler:function(t){return this._isOutsideClick(t)?this.callBase(t):!0},_isOutsideClick:function(t){return!L(t.target).closest(this.option("target")).length},_animate:function(t){t&&t.to&&typeof t.to=="object"&&E(t.to,{position:this._getContainerPosition()}),this.callBase.apply(this,arguments)},_stopAnimation:function(){this.callBase.apply(this,arguments)},_renderTitle:function(){this.$wrapper().toggleClass(ji,!this.option("showTitle")),this.callBase()},_renderPosition:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.callBase(),this._renderOverlayPosition(t),this._actions.onPositioned()},_renderOverlayPosition:function(t){this._resetOverlayPosition(t),this._updateContentSize(t);var o=this._getContainerPosition(),s=V.setup(this.$overlayContent(),o),p=this._getSideByLocation(s);this._togglePositionClass("dx-position-"+p),this._toggleFlippedClass(s.h.flip,s.v.flip);var a=this._isHorizontalSide()||this._isVerticalSide();a&&this._renderArrowPosition(p)},_resetOverlayPosition:function(t){this._setContentHeight(t),this._togglePositionClass("dx-position-"+this._positionController._positionSide),Be(this.$overlayContent(),{left:0,top:0}),this._$arrow.css({top:"auto",right:"auto",bottom:"auto",left:"auto"})},_updateContentSize:function(t){if(!(!this.$content()||!t)){var o=V.calculate(this.$overlayContent(),this._getContainerPosition());if(o.h.oversize>0&&this._isHorizontalSide()&&!o.h.fit){var s=J(this.$overlayContent())-o.h.oversize;Me(this.$overlayContent(),s)}if(o.v.oversize>0&&this._isVerticalSide()&&!o.v.fit){var p=ue(this.$overlayContent())-o.v.oversize,a=ue(this.$content())-o.v.oversize;Le(this.$overlayContent(),p),Le(this.$content(),a)}}},_getContainerPosition:function(){return this._positionController._getContainerPosition()},_getHideOnParentScrollTarget:function(){return L(this._positionController._position.of||this.callBase())},_getSideByLocation:function(t){var o=t.v.flip,s=t.h.flip;return this._isVerticalSide()&&o||this._isHorizontalSide()&&s||this._isPopoverInside()?De[this._positionController._positionSide]:this._positionController._positionSide},_togglePositionClass:function(t){this.$wrapper().removeClass("dx-position-left dx-position-right dx-position-top dx-position-bottom").addClass(t)},_toggleFlippedClass:function(t,o){this.$wrapper().toggleClass("dx-popover-flipped-horizontal",t).toggleClass("dx-popover-flipped-vertical",o)},_renderArrowPosition:function(t){var o=re(this._$arrow.get(0)),s=-(this._isVerticalSide(t)?o.height:o.width);this._$arrow.css(De[t],s);var p=this._isVerticalSide(t)?"left":"top",a=this._isVerticalSide(t)?"width":"height",v=L(this._positionController._position.of),f=V.offset(v)||{top:0,left:0},b=V.offset(this.$overlayContent()),T=o[a],C=b[p],y=re(this.$overlayContent().get(0))[a],$=f[p],w=v.get(0),B=w&&!w.preventDefault?re(w)[a]:0,k=Math.max(C,$),F=Math.min(C+y,$+B),I;this.option("arrowPosition")==="start"?I=k-C:this.option("arrowPosition")==="end"?I=F-C-T:I=(k+F)/2-C-T/2;var M=this._positionController._getContentBorderWidth(t),ee=ai(I-M+this.option("arrowOffset"),M,y-T-2*M);this._$arrow.css(p,ee)},_isPopoverInside:function(){return this._positionController._isPopoverInside()},_setContentHeight:function(t){t&&this.callBase()},_getPositionControllerConfig(){var{shading:t,target:o}=this.option();return E({},this.callBase(),{target:o,shading:t,$arrow:this._$arrow})},_initPositionController(){this._positionController=new Ke(this._getPositionControllerConfig())},_renderWrapperDimensions:function(){this.option("shading")&&this.$wrapper().css({width:"100%",height:"100%"})},_isVerticalSide:function(t){return this._positionController._isVerticalSide(t)},_isHorizontalSide:function(t){return this._positionController._isHorizontalSide(t)},_clearEventTimeout:function(t){clearTimeout(this._timeouts[t])},_clearEventsTimeouts:function(){this._clearEventTimeout("show"),this._clearEventTimeout("hide")},_clean:function(){this._detachEvents(this.option("target")),this.callBase.apply(this,arguments)},_optionChanged:function(t){switch(t.name){case"arrowPosition":case"arrowOffset":this._renderGeometry();break;case"fullScreen":t.value&&this.option("fullScreen",!1);break;case"target":t.previousValue&&this._detachEvents(t.previousValue),this._positionController.updateTarget(t.value),this._invalidate();break;case"showEvent":case"hideEvent":var o=t.name.substring(0,4),s=je(t.previousValue);this.hide(),ce(this,this.option("target"),o,s),le(this,o);break;case"visible":this._clearEventTimeout(t.value?"show":"hide"),this.callBase(t);break;default:this.callBase(t)}},show:function(t){return t&&this.option("target",t),this.callBase()}});fe("dxPopover",Ue);var Ui="dx-tooltip",Yi="dx-tooltip-wrapper",Ye=Ue.inherit({_getDefaultOptions:function(){return E(this.callBase(),{toolbarItems:[],showCloseButton:!1,showTitle:!1,title:null,titleTemplate:null,onTitleRendered:null,bottomTemplate:null,propagateOutsideClick:!0})},_render:function(){this.$element().addClass(Ui),this.$wrapper().addClass(Yi),this.callBase()},_renderContent:function(){this.callBase(),this._contentId="dx-"+new li,this.$overlayContent().attr({id:this._contentId,role:"tooltip"}),this._toggleAriaDescription(!0)},_toggleAriaDescription:function(t){var o=L(this.option("target")),s=t?this._contentId:void 0;ci(o.get(0))||this.setAria("describedby",s,o)}});fe("dxTooltip",Ye);var Xi={top:{my:"bottom center",at:"top center",collision:"fit none"},bottom:{my:"top center",at:"bottom center",collision:"fit none"}},Gi={h:2,v:1},Zi="dx-slider";class Qi extends Ke{_normalizePosition(o){var s=this._props.target,p=".".concat(Zi),a=s==null?void 0:s.closest(p),v={of:s,boundaryOffset:Gi,boundary:a==null?void 0:a.get(0)},f=E(!0,{},v,this._positionToObject(o));return this._positionSide=this._getDisplaySide(f),f}_renderContentInitialPosition(){super._renderContentInitialPosition(),this._fitIntoSlider()}_fitIntoSlider(){var{collisionSide:o,oversize:s}=V.calculate(this._$content,this._position).h,p=this._visualPosition.left,a=o==="left",v=(a?1:-1)*s;Be(this._$content,{left:p+v}),this._updateVisualPositionValue()}_positionToObject(o){return he(o)?E({},Xi[o]):o}}var Ji="dx-slider-tooltip-visible-on-hover",eo=Ye.inherit({_getDefaultOptions(){return E(this.callBase(),{visible:!1,position:"top",hideOnOutsideClick:!1,hideTopOverlayHandler:null,hideOnParentScroll:!1,animation:null,arrowPosition:null,templatesRenderAsynchronously:!1,_fixWrapperPosition:!1,useResizeObserver:!1,showMode:"onHover",format:t=>t,value:0})},_initMarkup(){this.callBase(),this._attachToMarkup(this.option("visible")),this._toggleShowModeClass()},_renderContent(){this.callBase(),this._renderContentText()},_renderContentText(){var{value:t,format:o}=this.option(),s=pe.format(t??0,o);this.$content().text(s),this._renderPosition()},_toggleShowModeClass(){var t=this.option("showMode")==="onHover",o=this.option("target");o.toggleClass(Ji,t)},_initPositionController(){this._positionController=new Qi(this._getPositionControllerConfig())},_attachToMarkup(t){var o=this.option("target");t?this.$element().appendTo(o):this.$element().detach()},_optionChanged(t){var{name:o,value:s}=t;switch(o){case"visible":this._attachToMarkup(s),this.callBase(t);break;case"showMode":this._toggleShowModeClass();break;case"format":case"value":this._renderContentText();break;default:this.callBase(t)}},updatePosition(){this._renderPosition()}}),to="dx-slider-handle",K=Ee.inherit({_getDefaultOptions:function(){return E(this.callBase(),{hoverStateEnabled:!1,value:0,tooltip:{enabled:!1,format:t=>t,position:"top",showMode:"onHover"}})},_initMarkup:function(){this.callBase(),this.$element().addClass(to),this.setAria({role:"slider",valuenow:this.option("value")})},_render:function(){this.callBase(),this._renderTooltip()},_renderTooltip:function(){var{tooltip:t,value:o}=this.option(),{position:s,format:p,enabled:a,showMode:v}=t,f=L("<div>");this._sliderTooltip=this._createComponent(f,eo,{target:this.$element(),container:f,position:s,visible:a,showMode:v,format:p,value:o})},_clean:function(){this.callBase(),this._sliderTooltip=null},_updateTooltipOptions(t){var o,s=Ee.getOptionsFromContainer(t);this._setWidgetOption("_sliderTooltip",[s]),(o=this._sliderTooltip)===null||o===void 0||o.option("visible",s.enabled)},_optionChanged:function(t){var{name:o,value:s}=t;switch(o){case"value":var p;(p=this._sliderTooltip)===null||p===void 0||p.option("value",s),this.setAria("valuenow",s);break;case"tooltip":this._updateTooltipOptions(t);break;default:this.callBase(t)}},updateTooltipPosition:function(){var t;(t=this._sliderTooltip)===null||t===void 0||t.updatePosition()},repaint:function(){var t;(t=this._sliderTooltip)===null||t===void 0||t.repaint()}}),io="dx-slider",oo="dx-slider-wrapper",so=".dx-slider-handle",no="dx-slider-bar",ao="dx-slider-range",ro="dx-slider-range-visible",Ae="dx-slider-label",de="dx-slider-label-position-",Ve="dx-slider-tooltip-position-",lo="dx-invalid-message-visible",Ie="Validation",Xe=Mi.inherit({_activeStateUnit:so,_supportedKeys:function(){var t=this.option("rtlEnabled"),o=(a,v)=>{a=this._valueStep(a);var f=this.option("step"),b=this.option("value"),T=b-this.option("min"),C=yi(T,f,this._getValueExponentLength()),y=v?b-a+(C?f-C:0):b+a-C,$=this.option("min"),w=this.option("max");return y<$?y=$:y>w&&(y=w),this._roundToExponentLength(y)},s=a=>{this.option("value",o(a,t))},p=a=>{this.option("value",o(a,!t))};return E(this.callBase(),{leftArrow:function(a){this._processKeyboardEvent(a),p(this.option("step"))},rightArrow:function(a){this._processKeyboardEvent(a),s(this.option("step"))},pageUp:function(a){this._processKeyboardEvent(a),s(this.option("step")*this.option("keyStep"))},pageDown:function(a){this._processKeyboardEvent(a),p(this.option("step")*this.option("keyStep"))},home:function(a){this._processKeyboardEvent(a);var v=this.option("min");this.option("value",v)},end:function(a){this._processKeyboardEvent(a);var v=this.option("max");this.option("value",v)}})},_processKeyboardEvent:function(t){t.preventDefault(),t.stopPropagation(),this._saveValueChangeEvent(t)},_getDefaultOptions:function(){return E(this.callBase(),{value:50,hoverStateEnabled:!0,activeStateEnabled:!0,step:1,showRange:!0,tooltip:{enabled:!1,format:function(t){return t},position:"top",showMode:"onHover"},label:{visible:!1,position:"bottom",format:function(t){return t}},keyStep:1,useInkRipple:!1,validationMessageOffset:Te()?{h:18,v:0}:{h:7,v:4},focusStateEnabled:!0,valueChangeMode:"onHandleMove"})},_toggleValidationMessage:function(t){this.option("isValid")||this.$element().toggleClass(lo,t)},_defaultOptionsRules:function(){return this.callBase().concat([{device:function(){return Pe.real().deviceType==="desktop"&&!Pe.isSimulator()},options:{focusStateEnabled:!0}},{device:function(){var t=di();return Te(t)},options:{useInkRipple:!0}}])},_initMarkup:function(){this.$element().addClass(io),this._renderSubmitElement(),this.option("useInkRipple")&&this._renderInkRipple(),this.callBase(),this._renderLabels(),this._renderStartHandler(),this._renderAriaMinAndMax()},_attachFocusEvents:function(){this.callBase();var t=this.NAME+Ie,o=W("focusin",t),s=W("focusout",t),p=this._focusTarget();P.on(p,o,this._toggleValidationMessage.bind(this,!0)),P.on(p,s,this._toggleValidationMessage.bind(this,!1))},_detachFocusEvents:function(){this.callBase();var t=this._focusTarget();this._toggleValidationMessage(!1),P.off(t,this.NAME+Ie)},_render:function(){this.callBase(),this._repaintHandle()},_renderSubmitElement:function(){this._$submitElement=L("<input>").attr("type","hidden").appendTo(this.$element())},_getSubmitElement:function(){return this._$submitElement},_renderInkRipple:function(){this._inkRipple=ui({waveSizeCoefficient:.7,isCentered:!0,wavesNumber:2,useHoldAnimation:!1})},_renderInkWave:function(t,o,s,p){if(this._inkRipple){var a={element:t,event:o,wave:p};s?this._inkRipple.showWave(a):this._inkRipple.hideWave(a)}},_visibilityChanged:function(){this.repaint()},_renderWrapper:function(){this.callBase(),this._$wrapper.addClass(oo),this._createComponent(this._$wrapper,pi,{elastic:!1,immediate:!0,immediateTimeout:0,onStart:this._swipeStartHandler.bind(this),onUpdated:this._swipeUpdateHandler.bind(this),onEnd:this._swipeEndHandler.bind(this),itemSizeFunc:this._itemWidthFunc.bind(this)})},_renderContainer:function(){this.callBase(),this._$bar.addClass(no)},_renderRange:function(){this.callBase(),this._$range.addClass(ao),this._renderHandle(),this._renderRangeVisibility()},_renderRangeVisibility:function(){this._$range.toggleClass(ro,!!this.option("showRange"))},_renderHandle:function(){this._$handle=this._renderHandleImpl(this.option("value"),this._$handle)},_renderHandleImpl:function(t,o){var s=o||L("<div>").appendTo(this._$range),p=this.option("tooltip");return this.$element().toggleClass(Ve+"bottom",p.enabled&&p.position==="bottom").toggleClass(Ve+"top",p.enabled&&p.position==="top"),this._createComponent(s,K,{value:t,tooltip:p}),s},_renderAriaMinAndMax:function(){this.setAria({valuemin:this.option("min"),valuemax:this.option("max")},this._$handle)},_toggleActiveState:function(t,o){this.callBase(t,o),this._renderInkWave(t,null,!!o,1)},_toggleFocusClass:function(t,o){if(this.callBase(t,o),!this._disposed){var s=L(o||this._focusTarget());this._renderInkWave(s,null,t,0)}},_renderLabels:function(){if(this.$element().removeClass(de+"bottom").removeClass(de+"top"),this.option("label.visible")){var t=this.option("min"),o=this.option("max"),s=this.option("label.position"),p=this.option("label.format");this._$minLabel||(this._$minLabel=L("<div>").addClass(Ae).appendTo(this._$wrapper)),this._$minLabel.text(pe.format(t,p)),this._$maxLabel||(this._$maxLabel=L("<div>").addClass(Ae).appendTo(this._$wrapper)),this._$maxLabel.text(pe.format(o,p)),this.$element().addClass(de+s)}else this._$minLabel&&(this._$minLabel.remove(),delete this._$minLabel),this._$maxLabel&&(this._$maxLabel.remove(),delete this._$maxLabel)},_renderStartHandler:function(){var t=W(hi.down,this.NAME),o=W(fi,this.NAME),s=this._createAction(this._startHandler.bind(this)),p=this.$element();P.off(p,t),P.on(p,t,a=>{vi(a)&&s({event:a})}),P.off(p,o),P.on(p,o,a=>{var v=this._activeHandle();v&&(P.trigger(v,"focusin"),P.trigger(v,"focus")),s({event:a}),this.option("valueChangeMode")==="onHandleRelease"&&(this.option("value",this._getActualValue()),this._actualValue=void 0)})},_itemWidthFunc:function(){return this._itemWidthRatio},_swipeStartHandler:function(t){var o=this.option("rtlEnabled");mi(t.event)&&this._createAction(this._startHandler.bind(this))({event:t.event}),this._feedbackDeferred=new gi,_i(this._feedbackDeferred),this._toggleActiveState(this._activeHandle(),this.option("activeStateEnabled")),this._startOffset=this._currentRatio;var s=this._startOffset*this._swipePixelRatio(),p=(1-this._startOffset)*this._swipePixelRatio();t.event.maxLeftOffset=o?p:s,t.event.maxRightOffset=o?s:p,this._itemWidthRatio=J(this.$element())/this._swipePixelRatio(),this._needPreventAnimation=!0},_swipeEndHandler:function(t){if(!this._isSingleValuePossible()){this._feedbackDeferred.resolve(),this._toggleActiveState(this._activeHandle(),!1);var o=this.option("rtlEnabled")?-1:1,s=this._startOffset+o*t.event.targetOffset/this._swipePixelRatio();delete this._needPreventAnimation,this._saveValueChangeEvent(t.event),this._changeValueOnSwipe(s),this.option("valueChangeMode")==="onHandleRelease"&&this.option("value",this._getActualValue()),this._actualValue=void 0,delete this._startOffset,this._renderValue()}},_activeHandle:function(){return this._$handle},_swipeUpdateHandler:function(t){this._isSingleValuePossible()||(this._saveValueChangeEvent(t.event),this._updateHandlePosition(t))},_updateHandlePosition:function(t){var o=this.option("rtlEnabled")?-1:1,s=Math.min(this._startOffset+o*t.event.offset/this._swipePixelRatio(),1);Me(this._$range,100*s+"%"),K.getInstance(this._activeHandle()).fitTooltipPosition,this._changeValueOnSwipe(s)},_swipePixelRatio:function(){var t=this.option("min"),o=this.option("max"),s=this._valueStep(this.option("step"));return(o-t)/s},_valueStep:function(t){return(!t||isNaN(t))&&(t=1),t},_getValueExponentLength:function(){var{step:t,min:o}=this.option();return Math.max(ke(t),ke(o))},_roundToExponentLength:function(t){var o=this._getValueExponentLength();return bi(t,o)},_changeValueOnSwipe:function(t){var o=this.option("min"),s=this.option("max"),p=this._valueStep(this.option("step")),a=t*(s-o),v=o+a;if(!(p<0))if(v===s||v===o)this._setValueOnSwipe(v);else{var f=Math.round((v-o)/p);v=this._roundToExponentLength(f*p+o),this._setValueOnSwipe(Math.max(Math.min(v,s),o))}},_setValueOnSwipe:function(t){this._actualValue=t,this.option("valueChangeMode")==="onHandleRelease"?K.getInstance(this._activeHandle()).option("value",t):(this.option("value",t),this._saveValueChangeEvent(void 0))},_getActualValue:function(){var t;return(t=this._actualValue)!==null&&t!==void 0?t:this.option("value")},_isSingleValuePossible:function(){var{min:t,max:o}=this.option();return t===o},_startHandler:function(t){if(!this._isSingleValuePossible()){var o=t.event;this._currentRatio=(Si(o).x-this._$bar.offset().left)/J(this._$bar),this.option("rtlEnabled")&&(this._currentRatio=1-this._currentRatio),this._saveValueChangeEvent(o),this._changeValueOnSwipe(this._currentRatio)}},_renderValue:function(){this.callBase();var t=this._getActualValue();this._getSubmitElement().val(Ci(t)),K.getInstance(this._activeHandle()).option("value",t)},_setRangeStyles:function(t){t&&this._$range.css(t)},_callHandlerMethod:function(t,o){K.getInstance(this._$handle)[t](o)},_repaintHandle:function(){this._callHandlerMethod("repaint")},_fitTooltip:function(){this._callHandlerMethod("updateTooltipPosition")},_optionChanged:function(t){switch(t.name){case"visible":this.callBase(t),this._renderHandle(),this._repaintHandle();break;case"min":case"max":this._renderValue(),this.callBase(t),this._renderLabels(),this._renderAriaMinAndMax(),this._fitTooltip();break;case"step":this._renderValue();break;case"keyStep":break;case"showRange":this._renderRangeVisibility();break;case"tooltip":this._renderHandle();break;case"label":this._renderLabels();break;case"useInkRipple":this._invalidate();break;case"valueChangeMode":break;default:this.callBase(t)}},_refresh:function(){this._toggleRTLDirection(this.option("rtlEnabled")),this._renderDimensions(),this._renderValue(),this._renderHandle(),this._repaintHandle()},_clean:function(){delete this._inkRipple,delete this._actualValue,this.callBase()}});fe("dxSlider",Xe);const co=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"})),uo=wi(co);/*!
 * devextreme-vue
 * Version: 22.2.10
 * Build date: Mon Dec 11 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var po=xe&&xe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(R,"__esModule",{value:!0});R.DxTooltip=R.DxLabel=R.DxFormat=R.DxSlider=void 0;var ho=po(uo),fo=We,ve=We,Ge=fo.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,isValid:Boolean,keyStep:Number,label:Object,max:Number,min:Number,name:String,onContentReady:Function,onDisposing:Function,onInitialized:Function,onOptionChanged:Function,onValueChanged:Function,readOnly:Boolean,rtlEnabled:Boolean,showRange:Boolean,step:Number,tabIndex:Number,tooltip:Object,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:Number,valueChangeMode:String,visible:Boolean,width:[Function,Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:isValid":null,"update:keyStep":null,"update:label":null,"update:max":null,"update:min":null,"update:name":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onValueChanged":null,"update:readOnly":null,"update:rtlEnabled":null,"update:showRange":null,"update:step":null,"update:tabIndex":null,"update:tooltip":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeMode":null,"update:visible":null,"update:width":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=ho.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={label:{isCollectionItem:!1,optionName:"label"},tooltip:{isCollectionItem:!1,optionName:"tooltip"}}}});R.DxSlider=Ge;var Ze=ve.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:currency":null,"update:formatter":null,"update:parser":null,"update:precision":null,"update:type":null,"update:useCurrencyAccountingStyle":null},props:{currency:String,formatter:Function,parser:Function,precision:Number,type:String,useCurrencyAccountingStyle:Boolean}});R.DxFormat=Ze;Ze.$_optionName="format";var me=ve.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:format":null,"update:position":null,"update:visible":null},props:{format:[Object,Function,String],position:String,visible:Boolean}});R.DxLabel=me;me.$_optionName="label";me.$_expectedChildren={format:{isCollectionItem:!1,optionName:"format"}};var ge=ve.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:enabled":null,"update:format":null,"update:position":null,"update:showMode":null},props:{enabled:Boolean,format:[Object,Function,String],position:String,showMode:String}});R.DxTooltip=ge;ge.$_optionName="tooltip";ge.$_expectedChildren={format:{isCollectionItem:!1,optionName:"format"}};R.default=Ge;const vo={class:"stock-page content-block dx-card responsive-paddings"},mo=["title"],go=["title"],_o=["title"],bo=["title"],So=["title"],Co=["title"],yo=["title"],wo=["title"],Lo=["title"],Eo=["title"],To=["title"],Po=["title"],ko=["title"],xo=["title"],$o=["src"],Io={__name:"Index",setup(t){const o={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.35}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},s=Li(),p=Ei(),{t:a}=Ti(),v=$e("devices"),f=$e("mf"),b=x(null),T=x(null),C=x(null),y=x(null),$=x(null),w=x(null),B=x(null),k=x(null),F=x(null),I=x(null),M=x(null),ee=x(null);let e={chart:{},series:{},data:{ohlc:[],price:[],cash:[],foreign:[]},tools:{lines:[],target:{A:{},B:{},X:{},Y:{},Z:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},rr:{EP:{},SL:{},TP:{}},range:[]},fundSize:0,losePerOrder:0,crosshair:{},isCashDraw:!1,isOnlyLoadData:!1,showNewsInfo:!1,foreignEnable:!1};const c=Pi({symbol:p.query.symbol??"VNINDEX",timeframe:"D",symbolKind:null,chartShift:0,symbolKinds:[{text:a("trading.stock.symbolList.hose"),value:"hose"},{text:a("trading.stock.symbolList.filterTop"),value:"f_top"},{text:a("trading.stock.symbolList.filterBottom"),value:"f_bottom"},{text:a("trading.stock.symbolList.watch"),value:"watch"},{text:a("trading.stock.symbolList.hold"),value:"hold"},{text:a("trading.stock.symbolList.nh"),value:"nh"},{text:a("trading.stock.symbolList.ck"),value:"ck"},{text:a("trading.stock.symbolList.hnx"),value:"hnx"}],filterItems:[{text:a("trading.stock.symbolList.filterBottom"),value:"f_bottom"},{text:a("trading.stock.symbolList.filterTop"),value:"f_top"}],color:"#F44336",showColorPicker:!1,isFullscreen:!1,showTradingView:!1,dividendEnable:!0});c.symbolKind=p.query.list??"hose";const Qe=N(()=>`https://chart.vps.com.vn/tv/?symbol=${c.symbol}`),te=N(()=>moment().subtract(c.chartShift+3,"years").unix()),ie=N(()=>moment().subtract(c.chartShift,"years").unix()),_e=N(()=>s.state.tradingStock.symbols.watch.includes(c.symbol)),Je=N(()=>s.state.tradingStock.symbols[c.symbolKind]),et=N(()=>s.state.tradingStock.chart.dividend?" dividend":"");s.dispatch("tradingStock/getSymbols"),ki(()=>{e.chart=Bi(T.value,o),e.chart.subscribeCrosshairMove(it),e.chart.subscribeCustomPriceLineDragged(ot),e.series.range=e.chart.addHistogramSeries({priceScaleId:"range",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.events=e.chart.addHistogramSeries({priceScaleId:"events",scaleMargins:{top:.96,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.vnindex=e.chart.addLineSeries({priceScaleId:"vnindex",scaleMargins:{top:.05,bottom:.76},color:"aqua",priceFormat:{minMove:.01},lastValueVisible:!1}),e.series.foreign=e.chart.addLineSeries({priceScaleId:"foreign",scaleMargins:{top:.66,bottom:.05},color:"blue",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.66,bottom:.05},color:"yellow",priceFormat:{type:"volume",minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#42946C",downColor:"#BC3E4A",borderVisible:!1,wickUpColor:"#42946C",wickDownColor:"#BC3E4A",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(st).observe(b.value),document.addEventListener("keydown",nt),document.addEventListener("fullscreenchange",at),console.log("params.foreignEnable",e.foreignEnable),s.dispatch("tradingStock/initChart",{symbol:c.symbol,from:te.value,to:ie.value,timeframe:c.timeframe,vnindex:!0,dividend:c.dividendEnable,foreign:e.foreignEnable}).then(i=>{e.series.vnindex.setData(i.chart.vnindex),e.tools.range=i.range,e.series.range.setData(i.range),e.fundSize=i.fundSize,e.losePerOrder=i.losePerOrder})}),xi(()=>s.state.tradingStock.chart,()=>{e.isOnlyLoadData||(ct(),ut()),pt()});function j(i){i.preventDefault(),i.stopPropagation()}function tt(i){w.value.classList.contains("selected")?gt():B.value.classList.contains("selected")?St():k.value.classList.contains("selected")?Ce():F.value.classList.contains("selected")?ye():I.value.classList.contains("selected")?Ot():M.value.classList.contains("selected")?At():Mt(),j(i)}function it(i){if(i.time){let r=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=r}else v.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function ot(i){let r=i.customPriceLine,n=r.options();n.price=ae(n.price);const l=+i.fromPriceString;switch(+n.price,n.lineType){case"line":s.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:c.symbol,name:n.lineType,points:[l],data:[n]}),w.value.classList.remove("selected");break;case"target":if(f.isSet(e.tools.target.B)){let d={isRemove:!1,symbol:c.symbol,name:"target",points:[],data:[]},u;const h=+e.tools.target.A.options().price,_=+e.tools.target.B.options().price-h;n.point=="A"&&(u="A",d.points.push(u),d.data.push(e.tools.target[u].options())),u="B",e.tools.target[u].applyOptions({title:(100*_/h).toFixed(1)+"%"}),d.points.push(u),d.data.push(e.tools.target[u].options()),u="X",e.tools.target[u].applyOptions({price:+(h-.5*_).toFixed(2),title:(100*-.5*_/h).toFixed(1)+"%"}),d.points.push(u),d.data.push(e.tools.target[u].options()),u="Y",e.tools.target[u].applyOptions({price:+(h-_).toFixed(2),title:(100*-_/h).toFixed(1)+"%"}),d.points.push(u),d.data.push(e.tools.target[u].options()),u="Z",e.tools.target[u].applyOptions({price:+(h-2*_).toFixed(2),title:(100*-2*_/h).toFixed(1)+"%"}),d.points.push(u),d.data.push(e.tools.target[u].options()),s.dispatch("tradingStock/drawTools",d)}break;case"rr":if(f.isSet(e.tools.rr.TP)){let d={isRemove:!1,symbol:c.symbol,name:"rr",points:[],data:[]},u;const h=+e.tools.rr.EP.options().price,m=+e.tools.rr.SL.options().price,_=+e.tools.rr.TP.options().price,O=m-h,g=_-h;if(g/O>0)return r.applyOptions({price:l}),!1;const D=Math.abs(g)/Math.abs(O),H=O/h*100,Zt=g/h*100,Qt=(e.fundSize*e.losePerOrder/Math.abs(H)/(h*1e3)).toFixed(0);u="EP",e.tools.rr[u].applyOptions({title:`[V=${Qt}] RR=${D.toFixed(1)}`}),d.points.push(u),d.data.push(e.tools.rr[u].options()),u="SL",e.tools.rr[u].applyOptions({title:`SL=${H.toFixed(1)}%`}),d.points.push(u),d.data.push(e.tools.rr[u].options()),u="TP",e.tools.rr[u].applyOptions({title:`TP=${Zt.toFixed(1)}%`}),d.points.push(u),d.data.push(e.tools.rr[u].options()),s.dispatch("tradingStock/drawTools",d)}break}}function st(){b.value&&(e.chart.resize(b.value.offsetWidth,b.value.offsetHeight),b.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function nt(i){if(i.ctrlKey||i.metaKey)switch(i.keyCode){case 96:we();break;case 110:be();break}}function at(){b.value&&(document.fullscreenElement?(c.isFullscreen=!0,b.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(c.isFullscreen=!1,b.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function rt(){Q(`${a("trading.stock.removeFilterList")}?`,a("titles.confirm")).then(i=>{if(i){const r=s.state.tradingStock.symbols[c.symbolKind];let n=r.findIndex(d=>d==c.symbol);n=n==r.length-1?0:n+1;const l={symbol:c.symbol,name:c.symbolKind};s.dispatch("tradingStock/removeFilterList",l).then(()=>c.symbol=r[n])}})}function be(){if(!c.symbol)return!1;const i={symbol:c.symbol,add:!_e.value};s.dispatch("tradingStock/addWatchlist",i)}function lt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function ct(){Se(!1),oe(!1),q(!1),q(!1,!0),U(!1),U(!1,!0),se(!1),dt()}function dt(){const i=s.state.tradingStock.chart.tools;for(const[r,n]of Object.entries(i))switch(r){case"line":Object.values(n).forEach(l=>e.tools.lines.push(e.series.price.createPriceLine(l)));break;case"target":Object.entries(n).forEach(([l,d])=>e.tools.target[l]=e.series.price.createPriceLine(d));break;case"rr":Object.entries(n).forEach(([l,d])=>e.tools.rr[l]=e.series.price.createPriceLine(d));break;default:r.includes("uplps")?Object.entries(n).forEach(([l,d])=>e.tools.uplps[l]=e.series[l.includes("P")?"price":"cash"].createPriceLine(d)):r.includes("downlps")&&Object.entries(n).forEach(([l,d])=>e.tools.downlps[l]=e.series[l.includes("P")?"price":"cash"].createPriceLine(d));break}}function ut(){e.series.events.setData(s.state.tradingStock.chart.events)}function pt(){e.data=s.state.tradingStock.chart.data,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.series.foreign.setData(e.data.foreign),e.chart.applyOptions({watermark:{text:c.symbol}})}function ht(i){c.showTradingView=!c.showTradingView}function ft(i){c.showColorPicker=!c.showColorPicker}function vt(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r||i.target.classList.add("selected")}function mt(i){Se(),i.target.classList.remove("selected")}function gt(i=null,r=!1,n=!1){const l="line";i||(i=ae(ne(e.crosshair.y)));const d=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(u=>{const h=u.options(),m=h.type=i==+h.price;return m&&(e.series.price.removePriceLine(u),s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:l,point:i})),!m}),e.tools.lines.length==d&&!n||r){const u={lineType:l,price:i,color:c.color,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(u)),s.dispatch("tradingStock/drawTools",{isRemove:!1,symbol:c.symbol,name:l,points:[i],data:[u]})}w.value.classList.remove("selected")}function Se(i=!0){e.tools.lines.length>0&&(console.log("removeLineTool"),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),e.tools.lines=[],i&&s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"line",point:null}))}function _t(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r||(i.target.classList.add("selected"),oe())}function bt(i){oe(),i.target.classList.remove("selected")}function St(){const i="target",r=ne(e.crosshair.y);let n={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},l={isRemove:!1,symbol:c.symbol,name:i,points:[],data:[]};if(f.isSet(e.tools.target.A)){const d=+e.tools.target.A.options().price,u=r-d;n.point="B",n.title=(100*u/d).toFixed(1)+"%",n.color="#FF9800",e.tools.target[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n)),n.point="X",n.price=+(d-.5*u).toFixed(2),n.title=(100*-.5*u/d).toFixed(1)+"%",n.color="#2196F3",e.tools.target[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n)),n.point="Y",n.price=+(d-u).toFixed(2),n.title=(100*-u/d).toFixed(1)+"%",n.color="#673AB7",e.tools.target[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n)),n.point="Z",n.price=+(d-2*u).toFixed(2),n.title=(100*-2*u/d).toFixed(1)+"%",n.color="#673AB7",e.tools.target[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n)),B.value.classList.remove("selected")}else n.point="A",n.title="0",n.color="#FF9800",e.tools.target[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n));s.dispatch("tradingStock/drawTools",l)}function oe(i=!0){f.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),f.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z)),e.tools.target={A:{},B:{},X:{},Y:{},Z:{}}),i&&s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"target"})}function Ct(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r?Ce():i.target.classList.add("selected")}function yt(i){q(),i.target.classList.remove("selected")}function Ce(){let i,r;const n=e.isCashDraw?"cash":"price",l=e.isCashDraw?"C":"P";f.isSet(e.tools.uplps[`${l}1`])?(i=+e.tools.uplps[`${l}1`].options().startTime,r=e.crosshair.time,q(!1)):i=e.crosshair.time;const{value1:d,value2:u}=wt(i,r);let h={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1},m={isRemove:!1,symbol:c.symbol,name:`${n}uplps`,points:[],data:[]};h.startTime=i,h.price=d,h.title=`${l}1`,e.tools.uplps[h.title]=e.series[n].createPriceLine(h),m.points.push(h.title),m.data.push(f.cloneDeep(h)),h.price=u,h.title=`${l}2`,e.tools.uplps[h.title]=e.series[n].createPriceLine(h),m.points.push(h.title),m.data.push(f.cloneDeep(h)),s.dispatch("tradingStock/drawTools",m),k.value.classList.remove("selected")}function wt(i,r){let n,l,d,u=0,h=0;const m=e.data[e.isCashDraw?"cash":"price"];for(let _=0;_<m.length;_++){const O=m[_].time;if(O<i)continue;if(r&&O>r)break;const g=m[_].value;if(n==null&&(n=g,l=g,d=g),g>d)u>h&&(l=d,h=u),d=g,u=0;else if(g<d){const D=+(d-g).toFixed(2);D>u&&(u=D)}if(g<n&&h>0)break}return{value1:+(l-h).toFixed(2),value2:+(d-h).toFixed(2)}}function q(i=!0,r=!1){const n=e.isCashDraw||r,l=n?"cash":"price",d=n?"C":"P",u=`${d}1`,h=`${d}2`;f.isSet(e.tools.uplps[u])&&(e.series[l].removePriceLine(e.tools.uplps[u]),e.series[l].removePriceLine(e.tools.uplps[h])),e.tools.uplps[u]={},e.tools.uplps[h]={},i&&s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:`${l}uplps`})}function Lt(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r?ye():i.target.classList.add("selected")}function Et(i){U(),i.target.classList.remove("selected")}function ye(){let i,r;const n=e.isCashDraw?"cash":"price",l=e.isCashDraw?"C":"P";f.isSet(e.tools.downlps[`${l}1`])?(i=+e.tools.downlps[`${l}1`].options().startTime,r=e.crosshair.time,U()):i=e.crosshair.time;const{value1:d,value2:u}=Tt(i,r);let h={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1},m={isRemove:!1,symbol:c.symbol,name:`${n}downlps`,points:[],data:[]};h.startTime=i,h.price=d,h.title=`${l}1`,e.tools.downlps[h.title]=e.series[n].createPriceLine(h),m.points.push(h.title),m.data.push(f.cloneDeep(h)),h.price=u,h.title=`${l}2`,e.tools.downlps[h.title]=e.series[n].createPriceLine(h),m.points.push(h.title),m.data.push(f.cloneDeep(h)),s.dispatch("tradingStock/drawTools",m),F.value.classList.remove("selected")}function Tt(i,r){let n,l,d,u=0,h=0;const m=e.data[e.isCashDraw?"cash":"price"];for(let _=0;_<m.length;_++){const O=m[_].time;if(O<i)continue;if(r&&O>r)break;const g=m[_].value;if(n==null&&(n=g,l=g,d=g),g<d)u<h&&(l=d,h=u),d=g,u=0;else if(g>d){const D=+(d-g).toFixed(2);D<u&&(u=D)}if(g>n&&h<0)break}return{value1:+(l-h).toFixed(2),value2:+(d-h).toFixed(2)}}function U(i=!0,r=!1){const n=e.isCashDraw||r,l=n?"cash":"price",d=n?"C":"P",u=`${d}1`,h=`${d}2`;f.isSet(e.tools.downlps[u])&&(e.series[l].removePriceLine(e.tools.downlps[u]),e.series[l].removePriceLine(e.tools.downlps[h])),e.tools.downlps[u]={},e.tools.downlps[h]={},i&&s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:`${l}downlps`})}function Pt(i){i.target.classList.contains("selected")?(i.target.classList.remove("selected"),e.isCashDraw=!1):(i.target.classList.add("selected"),e.isCashDraw=!0)}function kt(i){e.isCashDraw=!1,i.target.classList.remove("selected")}function xt(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r||(i.target.classList.add("selected"),se())}function $t(i){se(),i.target.classList.remove("selected")}function Ot(){const i="rr",r=ne(e.crosshair.y);let n={lineType:i,price:r,lineWidth:1,lineStyle:1,draggable:!0},l={isRemove:!1,symbol:c.symbol,name:i,points:[],data:[]};if(f.isSet(e.tools.rr.EP)){const d=+e.tools.rr.EP.options().price;if(f.isSet(e.tools.rr.SL)){const h=+e.tools.rr.SL.options().price-d,m=r-d;if(m/h>0)return!1;const _=m/d*100;n.point="TP",n.title=`TP=${_.toFixed(1)}%`,n.color="lime",e.tools.rr[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n));const O=h/d*100,g=(e.fundSize*e.losePerOrder/Math.abs(O)/(d*1e3)).toFixed(0),D=Math.abs(m)/Math.abs(h),H="EP";e.tools.rr[H].applyOptions({title:`[V=${g}] RR=${D.toFixed(1)}`}),l.points.push(H),l.data.push(e.tools.rr[H].options()),I.value.classList.remove("selected")}else{const u=(r-d)/d*100;n.point="SL",n.title=`SL=${u.toFixed(1)}%`,n.color="red",e.tools.rr[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n))}}else n.point="EP",n.title="RR=",n.color="yellow",e.tools.rr[n.point]=e.series.price.createPriceLine(n),l.points.push(n.point),l.data.push(f.cloneDeep(n));s.dispatch("tradingStock/drawTools",l)}function se(i=!0){f.isSet(e.tools.rr.EP)&&(e.series.price.removePriceLine(e.tools.rr.EP),f.isSet(e.tools.rr.SL)&&(e.series.price.removePriceLine(e.tools.rr.SL),f.isSet(e.tools.rr.TP)&&e.series.price.removePriceLine(e.tools.rr.TP))),e.tools.rr={EP:{},SL:{},TP:{}},i&&s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:c.symbol,name:"rr"})}function Rt(i){c.showColorPicker=!1;const r=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(n=>n.classList.remove("selected")),r||i.target.classList.add("selected")}function Dt(i){Vt(),i.target.classList.remove("selected")}function At(){let i={isRemove:!1,symbol:"ALL",name:"range",points:[],data:[]},r={time:e.crosshair.time,value:1};e.tools.range.length>0?(r.color="red",e.tools.range[1]=r,i.points.push(1),M.value.classList.remove("selected")):(r.color="aqua",e.tools.range[0]=r,i.points.push(0)),e.series.range.setData(e.tools.range),i.data.push(r),s.dispatch("tradingStock/drawTools",i)}function Vt(){e.tools.range=[],e.series.range.setData([]),s.dispatch("tradingStock/drawTools",{isRemove:!0,symbol:"ALL",name:"range"})}function It(i){i.target.classList.contains("selected")?(i.target.classList.remove("selected"),e.showNewsInfo=!1):(i.target.classList.add("selected"),e.showNewsInfo=!0)}function Bt(i){e.showNewsInfo=!1,i.target.classList.remove("selected")}function Mt(){if(e.showNewsInfo){const i=s.state.tradingStock.chart.events.find(r=>r.time==e.crosshair.time);if(f.isSet(i)){const r=i.title.split("|");let n=`
                <div>${a("trading.stock.date")} ${moment.unix(i.time).format("DD/MM/YYYY")}:</div>
                <div>&nbsp;</div>
                `;r.forEach(l=>{n+=`<div>${l}</div>`}),Ai(n,a("trading.stock.event"))}}}function ne(i,r="price"){return ae(e.series[r].coordinateToPrice(i))}function ae(i){return i?+ +i.toFixed(2):0}function Ft(i){if(!c.symbol)return!1;z()}function Ht(){c.dividendEnable=!c.dividendEnable,Kt()}function Nt(){e.foreignEnable=!e.foreignEnable,z(!0)}function Wt(){z(!0,!0)}function zt(){z(!0)}function Kt(){s.dispatch("tradingStock/initChart",{symbol:c.symbol,from:te.value,to:ie.value,timeframe:c.timeframe,vnindex:!0,dividend:c.dividendEnable,foreign:e.foreignEnable}).then(i=>{e.series.vnindex.setData(i.chart.vnindex),e.tools.range=i.range,e.series.range.setData(i.range),e.fundSize=i.fundSize,e.losePerOrder=i.losePerOrder})}function z(i=!1,r=!1){e.isOnlyLoadData=i,s.dispatch("tradingStock/getChartData",{symbol:c.symbol,from:te.value,to:ie.value,timeframe:c.timeframe,vnindex:r,dividend:c.dividendEnable,foreign:e.foreignEnable}).then(n=>{r&&e.series.vnindex.setData(n)})}function we(i){const r=s.state.tradingStock.symbols[c.symbolKind];let n=r.findIndex(l=>l==c.symbol);n=n==r.length-1?0:n+1,c.symbol=r[n]}function jt(i){c.symbolKind=i.value}function qt(i){c.chartShift=i.value,z(!1,!0)}function Ut(){Q(`${a("trading.stock.cloneSymbols")}?`,a("titles.confirm")).then(i=>{i&&s.dispatch("tradingStock/cloneSymbols")})}function Yt(){Q(`${a("trading.stock.deleteWatchList")}?`,a("titles.confirm")).then(i=>{i&&s.dispatch("tradingStock/deleteWatchlist")})}function Xt(i){e.tools.range.length==2?Q(`${a("trading.stock.filterSymbols")}?`,a("titles.confirm")).then(r=>{if(r){const n={from:e.tools.range[0].time,to:e.tools.range[1].time,timeframe:c.timeframe,name:c.symbolKind,kind:i};s.dispatch("tradingStock/filterSymbols",n)}}):Vi.error(a("trading.stock.rangeWarning"))}function Gt({itemData:i}){Xt(i.value)}return(i,r)=>{const n=$i("DxToolbar");return Di(),Oi("div",vo,[Y(n,{items:[{visible:i.$mf.isSet(i.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:i.$t("buttons.back"),onClick:()=>i.$router.go(-1)}},{location:"before",widget:"dxSelectBox",options:{width:"130px",dataSource:c.symbolKinds,valueExpr:"value",displayExpr:"text",value:c.symbolKind,hint:i.$t("trading.stock.symbolKind"),onValueChanged:jt}},{location:"after",widget:"dxSlider",options:{width:"100px",min:0,max:5,value:c.chartShift,rtlEnabled:!0,showRange:!1,tooltip:{enabled:!0},hint:i.$t("trading.stock.chartShift"),onValueChanged:qt}},{location:"after",widget:"dxButton",options:{icon:"far fa-list small",hint:i.$t("trading.stock.cloneSymbols"),onClick:Ut}},{location:"after",widget:"dxButton",options:{icon:"far fa-folder-times small",hint:i.$t("trading.stock.deleteWatchList"),onClick:Yt}},{location:"after",widget:"dxDropDownButton",options:{showArrowIcon:!1,items:c.filterItems,displayExpr:"text",keyExpr:"value",icon:"far fa-filter small",hint:i.$t("trading.stock.filterSymbols"),dropDownOptions:{width:"130px"},onItemClick:Gt}}]},null,8,["items"]),S("div",{class:"stock-container",ref_key:"chartContainerRef",ref:b,onClick:tt,onContextmenu:j},[S("div",{class:"chart-wrapper",ref_key:"chartRef",ref:T},[S("div",{class:"area data-area",onClick:j},[Y(Oe(Re),{width:i.$screen.getScreenSizeInfo.isXSmall?"140px":"130px","data-source":Je.value,"search-enabled":!0,"show-clear-button":!0,"element-attr":{class:`command symbol-select ${et.value} ${c.dividendEnable?"dividend-enable":""}`},modelValue:c.symbol,"onUpdate:modelValue":r[0]||(r[0]=l=>c.symbol=l),onValueChanged:Ft},null,8,["width","data-source","element-attr","modelValue"]),Y(Oe(Re),{width:"60px","data-source":["D","W","M"],"element-attr":{class:"command timeframe-select"},modelValue:c.timeframe,"onUpdate:modelValue":r[1]||(r[1]=l=>c.timeframe=l),onValueChanged:Wt},null,8,["modelValue"]),S("div",{class:"command",title:i.$t("trading.stock.reload"),onClick:zt,onContextmenu:we},[S("i",{class:X(`far fa-sync-alt ${i.$store.state.tradingStock.isChartLoading?"fa-spin":""}`)},null,2)],40,mo),G(S("div",{class:X("command far fa-times"),title:i.$t("trading.stock.removeFilterList"),onClick:rt},null,8,go),[[Z,c.symbolKind.includes("f_")]]),G(S("div",{ref:"addWatchlistToolRef",class:X(`command far fa-${_e.value?"minus-circle":"plus-circle"}`),title:i.$t("trading.stock.addWatchlist"),onClick:be},null,10,_o),[[Z,!!c.symbol]])]),S("div",{class:"area tool-area",onClick:j},[S("div",{ref_key:"fullscreenToolRef",ref:C,class:X(`command far fa-${c.isFullscreen?"compress":"expand"}`),title:i.$t("trading.stock.fullscreen"),onClick:lt,onContextmenu:Ht},null,42,bo),S("div",{ref_key:"tradingviewRef",ref:y,class:"command far fa-chart-bar",title:i.$t("trading.stock.tradingview"),onClick:ht,onContextmenu:Nt},null,40,So),S("div",{ref_key:"colorToolRef",ref:$,class:"color command far fa-palette",style:Ri({color:c.color}),title:i.$t("trading.stock.tools.color"),onClick:ft},[G(Y(Ii,{class:"color-picker",modelValue:c.color,"onUpdate:modelValue":r[2]||(r[2]=l=>c.color=l)},null,8,["modelValue"]),[[Z,c.showColorPicker]])],12,Co),S("div",{ref_key:"lineToolRef",ref:w,class:"command far fa-horizontal-rule",title:i.$t("trading.stock.tools.line"),onClick:vt,onContextmenu:mt},null,40,yo),S("div",{ref_key:"uplpsToolRef",ref:k,class:"command far fa-arrow-up",title:i.$t("trading.stock.tools.uplps"),onClick:Ct,onContextmenu:yt},null,40,wo),S("div",{ref:"cashToolRef",class:"command drawless far fa-dot-circle",title:i.$t("trading.stock.tools.cash"),onClick:Pt,onContextmenu:kt},null,40,Lo),S("div",{ref_key:"downlpsToolRef",ref:F,class:"command far fa-arrow-down",title:i.$t("trading.stock.tools.downlps"),onClick:Lt,onContextmenu:Et},null,40,Eo),S("div",{ref_key:"targetToolRef",ref:B,class:"command far fa-flag-checkered",title:i.$t("trading.stock.tools.target"),onClick:_t,onContextmenu:bt},null,40,To),S("div",{ref_key:"rrToolRef",ref:I,class:"command far fa-line-height",title:i.$t("trading.stock.tools.rr"),onClick:xt,onContextmenu:$t},null,40,Po),S("div",{ref_key:"rangeToolRef",ref:M,class:"command far fa-grip-lines-vertical",title:i.$t("trading.stock.tools.range"),onClick:Rt,onContextmenu:Dt},null,40,ko),S("div",{ref:"eventsToolRef",class:"command drawless far fa-map-marker-exclamation",title:i.$t("trading.stock.tools.events"),onClick:It,onContextmenu:Bt},null,40,xo)]),G(S("iframe",{ref_key:"tradingviewChartRef",ref:ee,class:"tradingview-chart",src:Qe.value},null,8,$o),[[Z,c.showTradingView]])],512)],544)])}}};export{Io as default};
