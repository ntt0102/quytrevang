import{h as ne,c as A,r as F,w as J,o as oe,b as le,d as E,u as _e,S as Re,U as Ae,$ as fe,V as re,W as he,X as Le,Y as Me,Z as $e,K as We,M as ge,a as Ve,y as ze,H as Pe,l as be,e as M,g as Ze,I as He,J as je,E as ve,j as Je,k as Se,x as Ye}from"./app-D3fjTQBU.js";import{c as Ue,g as ye,a as Qe,b as Ge,d as Ke,e as Xe}from"./lightweight-charts.esm.development-Be-8bgUs.js";/* empty css            */const qe=["title"],et=E("i",{class:"far fa-grip-lines-vertical"},null,-1),tt=[et],nt={__name:"FilterTimeTool",props:[],emits:["hideContext"],setup(u,{expose:g,emit:r}){const s=ne(),_=r,D=A(()=>s.state.tradingShare.config.filterTime),v=F(null);let m={},p=[];const k=["rgba(244, 67, 54, 0.7)","rgba(255, 152, 0, 0.7)","rgba(76, 175, 80, 0.7)","rgba(0, 150, 136, 0.7)"];g({createSeries:I,isSelected:C,draw:S,get:h}),J(D,a=>{a&&setTimeout(()=>B(a),3e3)});function C(){return v.value.classList.contains("selected")}function h(){return p.map(f=>f.time).reverse()}function I(a){if(!a)return!1;m=a.addHistogramSeries({priceScaleId:"filterTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function c(a){_("hideContext");const f=a.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(O=>O.classList.remove("selected")),f||(p.pop(),m.setData(p),a.target.classList.add("selected"))}function d(a){R(),a.target.classList.remove("selected")}function S({time:a}){const f=p.length;if(f&&a<=p[f-1].time)return!1;p.push({time:a,color:k[f],value:1}),m.setData(p),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:"",name:"filterTime",points:[f],data:[a]}),f===3&&v.value.classList.remove("selected")}function B(a){for(let f=0;f<a.length;f++)p.push({time:a[f],color:k[f],value:1});m.setData(p)}function R(a=!0){a&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:"",name:"filterTime"}),m.setData([]),p=[]}return(a,f)=>(oe(),le("div",{ref_key:"filterTimeToolRef",ref:v,class:"command",title:a.$t("trading.share.tools.filterTime"),onClick:c,onContextmenu:d},tt,40,qe))}},ot=["title"],lt=E("i",{class:"far fa-circle-check"},null,-1),at=[lt],it={__name:"CheckTool",props:["symbol"],emits:["checkSymbol","hideContext"],setup(u,{expose:g,emit:r}){const s=ne(),{t:_}=_e(),D=u,v=r;let m=null;J(()=>D.symbol,()=>m=null),g({check:p});function p(c){s.dispatch("tradingShare/checkSymbol",c).then(d=>{m=d,h(d)})}function k(){v("checkSymbol"),v("hideContext")}function C(){m&&h(m)}function h(c){let d=JSON.stringify(c.result,void 0,4);Re(`<pre class='check-tool-popup'>${I(d)}</pre>`,`${_("trading.share.tools.check")} ${c.symbol}`)}function I(c){return c=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),c.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(d){var S="number";return/^"/.test(d)?/:$/.test(d)?S="key":S="string":/true|false/.test(d)?S="boolean":/null/.test(d)&&(S="null"),'<span class="'+S+'">'+d+"</span>"})}return(c,d)=>(oe(),le("div",{class:"command",title:c.$t("trading.share.tools.check"),onClick:k,onContextmenu:C},at,40,ot))}},st=["title"],ut=E("i",{class:"far fa-arrow-trend-down"},null,-1),rt=[ut],te="reversal",Ce="rgba(156, 39, 176, 0.7)",ct={__name:"ReversalTool",props:["symbol","priceSeries"],emits:["indexUpdated","hideContext"],setup(u,{expose:g,emit:r}){const s=ne(),_=u,D=r,v=F(null),m=A(()=>s.state.tradingShare.tools.reversal),p=A(()=>s.state.tradingShare.config.index);let k={},C=[],h=null,I={lineType:te,color:Ce,title:"R",lineWidth:1,lineStyle:1,draggable:!0},c=null;g({createSeries:S,isSelected:d,draw:a,remove:ae}),J(m,e=>{e&&O(e[0])});function d(){return v.value.classList.contains("selected")}function S(e){if(!e)return!1;k=e.addHistogramSeries({priceScaleId:te,color:Ce,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function B(e){D("hideContext");const L=e.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(Y=>Y.classList.remove("selected")),L||(n(),_.symbol===p.value&&D("indexUpdated"),e.target.classList.add("selected"))}function R(e){n(),_.symbol===p.value&&D("indexUpdated"),e.target.classList.remove("selected")}function a({prices:e,time:L}){C.push({time:L,value:1}),C.length===2?(h=f(e,C[0].time,C[1].time),T(h),s.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:_.symbol,name:te,points:[0],data:[h]}),_.symbol===p.value&&D("indexUpdated",h),C=[],v.value.classList.remove("selected")):k.setData(C)}function f(e,L,Y){let w,U,$,W;const V=e.filter(x=>x.time>=L&&x.time<=Y);for(let x=0;x<V.length;x++){const Q=V[x].time;V[x].close;const G=V[x].high,K=V[x].low,q={i:x,p:G},H={i:x,p:K};if(x===0)w={H,L:H},$=0,W=0,U=Q;else if(G>w.H.p?w.H=q:w.H.i=x,K<w.L.p){U=Q;const ee=w.H.p-w.L.p,N=w.H.i-w.L.i;ee>$&&($=ee),N>W&&(W=N),w={H,L:H}}}const ie=e.findIndex(x=>x.time===U),se=e[ie+W].time,X=w.L.p+$;return{time:se,price:X}}function O(e){n(!1),T(e)}function T(e){k.setData([{time:e.time,value:1}]),I.price=e.price,c=_.priceSeries.createPriceLine(I)}function ae(){n(!1)}function n(e=!0){e&&s.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:_.symbol,name:te}),h={},k.setData([]),c&&(_.priceSeries.removePriceLine(c),c=null)}return(e,L)=>(oe(),le("div",{ref_key:"reversalToolRef",ref:v,class:"command",title:e.$t("trading.share.tools.reversal"),onClick:B,onContextmenu:R},rt,40,st))}};var l={},dt="dx-autocomplete",pt="dx-autocomplete-popup-wrapper",ke=Ae.inherit({_supportedKeys:function(){var u=this._list?this._list.option("focusedElement"):null,g=this.callBase();return u=u&&fe(u),re({},g,{upArrow:function(r){return!he(r)&&(r.preventDefault(),r.stopPropagation(),u&&!this._calcNextItem(-1))?(this._clearFocusedItem(),!1):!0},downArrow:function(r){return!he(r)&&(r.preventDefault(),r.stopPropagation(),u&&!this._calcNextItem(1))?(this._clearFocusedItem(),!1):!0},enter:function(r){u||this.close();var s=this.option("opened");return s&&r.preventDefault(),s}})},_getDefaultOptions:function(){return re(this.callBase(),{minSearchLength:1,maxItemCount:10,noDataText:"",showDropDownButton:!1,searchEnabled:!0})},_initMarkup:function(){this.callBase(),this.$element().addClass(dt),this.setAria("autocomplete","inline")},_displayGetterExpr:function(){return this.option("valueExpr")},_closeOutsideDropDownHandler:function(u){var{target:g}=u;return!fe(g).closest(this.$element()).length},_renderDimensions:function(){this.callBase(),this._updatePopupWidth(),this._updateListDimensions()},_popupWrapperClass:function(){return this.callBase()+" "+pt},_listConfig:function(){return re(this.callBase(),{pageLoadMode:"none",onSelectionChanged:u=>{this._setSelectedItem(u.addedItems[0])}})},_listItemClickHandler:function(u){this._saveValueChangeEvent(u.event);var g=this._displayGetter(u.itemData);this.option("value",g),this.close()},_setListDataSource:function(){this._list&&(this._list.option("selectedItems",[]),this.callBase())},_refreshSelected:Le,_searchCanceled:function(){this.callBase(),this.close()},_loadItem:function(u,g){var r=this._getItemFromPlain(u,g);return new Me().resolve(r).promise()},_dataSourceOptions:function(){return{paginate:!0,pageSize:this.option("maxItemCount")}},_searchDataSource:function(u){this._dataSource.pageSize(this.option("maxItemCount")),this.callBase(u),this._clearFocusedItem()},_clearFocusedItem:function(){this._list&&(this._list.option("focusedElement",null),this._list.option("selectedIndex",-1))},_renderValueEventName:function(){return"input keyup"},_valueChangeEventHandler:function(u){var g=this._input().val()||null;return this.callBase(u,g)},_optionChanged:function(u){switch(u.name){case"maxItemCount":this._searchDataSource();break;case"valueExpr":this._compileDisplayGetter(),this._setListOption("displayExpr",this._displayGetterExpr()),this.callBase(u);break;default:this.callBase(u)}},reset:function(){this.callBase(),this.close()}});$e("dxAutocomplete",ke);const mt=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),ft=We(mt);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var xe;function ht(){if(xe)return l;xe=1;var u=l&&l.__importDefault||function(T){return T&&T.__esModule?T:{default:T}};Object.defineProperty(l,"__esModule",{value:!0}),l.DxToolbarItem=l.DxTo=l.DxShow=l.DxPosition=l.DxOptions=l.DxOffset=l.DxMy=l.DxItem=l.DxHide=l.DxFrom=l.DxDropDownOptions=l.DxCollision=l.DxButton=l.DxBoundaryOffset=l.DxAt=l.DxAnimation=l.DxAutocomplete=void 0;var g=u(ft),r=ge(),s=ge(),_=r.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttons:Array,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxItemCount:Number,maxLength:[Number,String],minSearchLength:Number,name:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDropDownButton:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:String,valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxItemCount":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDropDownButton":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=g.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});l.DxAutocomplete=_;var D=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});l.DxAnimation=D,D.$_optionName="animation",D.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var v=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxAt=v,v.$_optionName="at";var m=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});l.DxBoundaryOffset=m,m.$_optionName="boundaryOffset";var p=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});l.DxButton=p,p.$_optionName="buttons",p.$_isCollectionItem=!0,p.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var k=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxCollision=k,k.$_optionName="collision";var C=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});l.DxDropDownOptions=C,C.$_optionName="dropDownOptions",C.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var h=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});l.DxFrom=h,h.$_optionName="from",h.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var I=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});l.DxHide=I,I.$_optionName="hide",I.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var c=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});l.DxItem=c,c.$_optionName="items",c.$_isCollectionItem=!0;var d=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxMy=d,d.$_optionName="my";var S=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});l.DxOffset=S,S.$_optionName="offset";var B=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});l.DxOptions=B,B.$_optionName="options";var R=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});l.DxPosition=R,R.$_optionName="position";var a=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});l.DxShow=a,a.$_optionName="show";var f=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});l.DxTo=f,f.$_optionName="to";var O=s.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});return l.DxToolbarItem=O,O.$_optionName="toolbarItems",O.$_isCollectionItem=!0,l.default=_,l}var gt=ht();const bt={class:"command symbol-input"},vt=["title"],St=["title"],_t={__name:"Chart",props:["fromDate","group"],setup(u,{expose:g}){const r=ne(),s=Je(),{t:_}=_e(),D=Se("devices"),v=Se("mf"),m=F(null),p=F(null),k=F(null),C=F(null),h=F(null),I=F(null),c=F(null),d=F(null),S=F(null),B=u,R=A(()=>r.state.tradingShare.isLoading),a=A(()=>r.state.tradingShare.config),f=A(()=>n.symbol),O=A(()=>a.value.watchlist.includes(n.symbol)),T=A(()=>r.state.tradingShare.symbols),ae=A(()=>B.fromDate),n=Ve({symbol:s.query.symbol??"VN30",inputSymbol:s.query.symbol??"VN30",series:{}});let e={chart:{},data:{index:[],stock:[]},crosshair:{},websocket:null};ze(()=>{L(),H(),h.value.createSeries(e.chart),c.value.createSeries(e.chart),new ResizeObserver(se).observe(m.value),document.addEventListener("keydown",X)}),Pe(()=>{Y(),pe(),document.removeEventListener("keydown",X)}),J(()=>r.state.tradingShare.prices,G),J(()=>a.value.source,ee),J(()=>a.value.reversal,ce),g({getFilterTimes:W,getChartData:N,updateWatchlist:x});function L(){const t={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.5,bottom:.05}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:40,horzAlign:"center",vertAlign:"center",color:"rgba(54, 54, 64, 0.4)"}};e.chart=Ue(p.value,t),e.chart.subscribeCrosshairMove(V),e.chart.subscribeCustomPriceLineDragged(ie),n.series.index=e.chart.addCandlestickSeries({priceScaleId:"index",upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01},scaleMargins:{top:.1,bottom:.55},lastValueVisible:!1}),n.series.stock=e.chart.addCandlestickSeries({upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01}})}function Y(){e.chart&&(e.chart.remove(),e.chart=null)}function w(t){t.preventDefault(),t.stopPropagation()}function U(){j(),h.value.isSelected()?h.value.draw({time:e.crosshair.time}):c.value.isSelected()?c.value.draw({prices:e.data.stock,time:e.crosshair.time}):d.value.isSelected()?d.value.draw({price:me(e.crosshair.y)}):S.value.isSelected()&&S.value.draw({price:me(e.crosshair.y)})}function $(t){t.stopPropagation()}function W(){return h.value.get()}function V(t){if(t.time){let o=t.seriesPrices.get(n.series.stock);e.crosshair.time=t.time,e.crosshair.price=o}else D.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function ie(t){let i=t.customPriceLine.options();i.price=v.fmtNum(i.price);const b=+t.fromPriceString,y=i.price;switch(i.lineType){case"line":d.value.drag({lineOptions:i,oldPrice:b,newPrice:y});break;case"target":S.value.drag({lineOptions:i,newPrice:y});break}}function se(){m.value&&(e.chart.resize(m.value.offsetWidth,m.value.offsetHeight),C.value.checkFullscreen())}function X(t){if(t.ctrlKey||t.metaKey)switch(t.code){case"Numpad0":ue(!0);break;case"Numpad1":ue(!1);break;case"NumpadDecimal":Q();break;case"Space":n.inputSymbol="",k.value.instance.focus();break}}function x(t){a.value.watchlist=t}function Q(){if(!n.symbol)return!1;const t={multi:!1,group:B.group,symbol:n.symbol,add:!O.value};r.dispatch("tradingShare/changeWatchlist",t).then(o=>{a.value.watchlist=v.isSet(o)?o:[]})}function G(t){e.data.stock=v.cloneDeep(t),n.series.stock.setData(e.data.stock),e.chart.applyOptions({watermark:{text:n.symbol}})}function K(t,o){let i=e.data[t].pop();if(!i)return!1;i.high=Math.max(i.high,o),i.low=Math.min(i.low,o),i.close=o,e.data[t].push(i),n.series[t].update(i)}function q(){if(!n.inputSymbol||!n.inputSymbol.trim()||(n.inputSymbol=n.inputSymbol.trim().toUpperCase(),n.symbol==n.inputSymbol))return!1;n.symbol=n.inputSymbol,k.value.instance.blur(),N()}function H(){r.dispatch("tradingShare/initChart")}function ee(t){t==="FIREANT"?Fe():(N(!0),pe())}function N(t=!1,o=null){if(!n.symbol)return!1;o||(o=ae.value),a.value.source==="FIREANT"?we(t,o):De(t,o)}function we(t=!1,o=null){if(e.websocket.readyState===WebSocket.OPEN){const i=be(o,"yyyy-MM-dd"),b=be(new Date,"yyyy-MM-dd");let y=`{"arguments":["${n.symbol}","D","${i}","${b}"],"invocationId":"stock","target":"GetBars","type":1}`;e.websocket.send(y),t&&(y=`{"arguments":["${a.value.index}","D","${i}","${b}"],"invocationId":"index","target":"GetBars","type":1}`,e.websocket.send(y)),de()}}function De(t=!1,o=null){r.dispatch("tradingShare/getChartData",{symbol:n.symbol,from:ye(o),withIndex:t}).then(i=>{t&&(e.data.index=i,n.series.index.setData(i)),de()})}function ce(t){let o=[];t&&o.push({time:t.time,color:"#9C27B0",position:"aboveBar",shape:"circle"}),n.series.index.setMarkers(o)}function de(){c.value.remove(),d.value.remove(),S.value.remove()}function Ie(){ue()}function ue(t=!0){if(R.value)return!1;const o=T.value;let i=o.findIndex(y=>y===n.symbol);i=i+(t?1:-1),i<0?i=o.length-1:i>=o.length&&(i=0);const b=o[i];if(!b)return!1;n.inputSymbol=b,n.symbol=n.inputSymbol,N()}function Oe(){if(!n.symbol||n.symbol===a.value.index)return!1;const t=W();if(t.length<2)return Ye.warning(_("trading.share.filterTimeWarning"));I.value.check({symbol:n.symbol,filterTimes:t})}function Fe(){let t="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg";e.websocket=new WebSocket(t),e.websocket.onopen=()=>{console.log("Đã kết nối tới WebSocket server"),e.websocket.send('{"protocol":"json","version":1}'),N(!0)},e.websocket.onmessage=o=>{const i=Te(o.data);if(i.length==0)return!1;i.forEach(b=>{if(!b)return!1;if(b.type==3){const y=b.result.bars.map(({open:z,high:P,low:Z,close:Ne,date:Ee})=>{const Be=ye(new Date(Ee));return{open:z,high:P,low:Z,close:Ne,time:Be}});b.invocationId==="stock"?(r.dispatch("tradingShare/getTools",{symbol:n.symbol}),G(y)):n.series.index.setData(y)}else if(b.type==1&&b.target==="UpdateLastPrices"){const y=b.arguments[0],z=y.find(Z=>Z.symbol===a.value.index),P=y.find(Z=>Z.symbol===n.symbol);z&&K("index",z.last),P&&K("stock",P.last)}})},e.websocket.onerror=o=>{console.error("Lỗi kết nối WebSocket:",o)},e.websocket.onclose=()=>{console.log("Đã đóng kết nối WebSocket")}}function pe(){e.websocket&&(e.websocket.readyState===WebSocket.OPEN&&e.websocket.close(),e.websocket=null)}function Te(t){let o=[];return t.split("").forEach(i=>{const b=i.indexOf("{"),y=i.lastIndexOf("}");let z=null;if(b!==-1&&y!==-1&&y>b){const P=i.substring(b,y+1);if(P!="{}")try{z=JSON.parse(P)}catch(Z){console.error("JSON parse error:",Z)}}o.push(z)}),o}function j(){d.value.hide()}function me(t){return v.fmtNum(n.series.stock.coordinateToPrice(t))}return(t,o)=>(oe(),le("div",{ref_key:"chartContainerRef",ref:m,class:"share-chart",onClick:U,onContextmenu:w},[E("div",{ref_key:"chartRef",ref:p},null,512),E("div",{class:"area data-area",onClick:$,onContextmenu:w},[E("div",bt,[M(Ze(gt.DxAutocomplete),{ref_key:"symbolAutocompleteRef",ref:k,"data-source":T.value,"show-clear-button":!0,openOnFieldClick:!0,minSearchLength:0,maxItemCount:100,modelValue:n.inputSymbol,"onUpdate:modelValue":o[0]||(o[0]=i=>n.inputSymbol=i),onChange:q,onItemClick:q},null,8,["data-source","modelValue"])]),He(E("div",{ref:"addWatchlistToolRef",class:ve(["command far",{"fa-heart-circle-minus":O.value,"fa-heart-circle-plus":!O.value}]),title:t.$t("trading.share.changeWatchlist"),onClick:Q,onContextmenu:Ie},null,42,vt),[[je,f.value]]),E("div",{class:"command",title:t.$t("trading.share.reload"),onClick:o[1]||(o[1]=()=>N()),onContextmenu:o[2]||(o[2]=()=>N(!0))},[E("i",{class:ve(["far fa-sync-alt",{"fa-spin":R.value}])},null,2)],40,St)],32),E("div",{class:"area tool-area",onClick:$,onContextmenu:w},[M(Qe,{ref_key:"fullscreenToolRef",ref:C,chartContainerRef:m.value},null,8,["chartContainerRef"]),M(Ge,{ref:"tradingviewToolRef",vpsUser:a.value.vpsUser,vpsSession:a.value.vpsSession,chartContainerRef:m.value,symbol:n.symbol,timeframe:"1D"},null,8,["vpsUser","vpsSession","chartContainerRef","symbol"]),M(nt,{ref_key:"filterTimeToolRef",ref:h,onHideContext:j},null,512),M(it,{ref_key:"checkToolRef",ref:I,symbol:n.symbol,onCheckSymbol:Oe,onHideContext:j},null,8,["symbol"]),M(ct,{ref_key:"reversalToolRef",ref:c,symbol:n.symbol,priceSeries:n.series.stock,onIndexUpdated:ce,onHideContext:j},null,8,["symbol","priceSeries"]),M(Ke,{ref_key:"lineToolRef",ref:d,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,onHideContext:j},null,8,["symbol","priceSeries"]),M(Xe,{ref_key:"targetToolRef",ref:S,symbol:n.symbol,storeModule:"tradingShare",priceSeries:n.series.stock,levels:[1,2],isPercent:!0,onHideContext:j},null,8,["symbol","priceSeries"])],32)],544))}};export{_t as default};
