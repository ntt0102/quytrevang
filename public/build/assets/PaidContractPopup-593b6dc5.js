import{_ as P,c as k,r as a,d as u,f as r,w as l,g as D,h as f,o as m,e as i,i as p,t as h,j as I}from"./app-b44850ea.js";import{_ as x}from"./accordion-a8a8564e.js";import{P as v}from"./Index-ff0849a0.js";const S={components:{DxAccordion:x,Pdf:v},data(){return{refreshKey:0,contract:{},formData:{},backupDocuments:[]}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance}},methods:{...k("Admin.contracts",["paidContract"]),show(e){this.popup.option("title",this.$t(`components.paidContract.${e.status==2?"confirmTitle":"title"}`)+" #"+e.code),this.contract=e,this.formData.isConfirmed=!!e.confirmed_by,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",e.status==0?0:1),500),this.backupDocuments=e.url_paid_docs.map(t=>({file:t,isUpload:!1})),this.formData.documents=this.backupDocuments,this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(e){this.formData.documents=this.formData.documents.filter(t=>!t.isUpload),[...e.target.files].forEach(t=>this.formData.documents.push({file:URL.createObjectURL(t),isUpload:!0}))},onCheckBoxDeleteChange(e){e.value?this.formData.documents=this.formData.documents.filter(t=>t.isUpload):this.formData.documents=this.backupDocuments.concat(this.formData.documents)},onSubmit(){this.$bus.emit("checkPin",async()=>{let e=new FormData;if(e.append("contractId",this.contract.id),e.append("isDelete",this.formData.isDelete),e.append("isConfirmed",this.formData.isConfirmed),this.$refs.receiptImage)for(var t=0;t<this.$refs.receiptImage.files.length;t++){let c=await this.$mf.resizeImage({file:this.$refs.receiptImage.files[t],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});e.append(`receiptImages[${t}]`,c)}this.paidContract(e).then(c=>{c&&this.popup.hide()})})},initFormData(){this.formData={isPdfPreview:!1,isDelete:!1,isConfirmed:!1,documents:[]}},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}},V={ref:"submit",class:"display-none"},B={class:"step1"},U={class:"download"},$={class:"upload-browser"},A={for:"receiptImage"},T=i("i",{class:"far fa-file-upload"},null,-1),H={class:"is-confirmed"},R={key:0};function L(e,t,c,z,o,n){const g=a("DxButton"),d=a("DxCheckBox"),C=a("DxAccordion"),_=a("RouterLink"),b=a("DxScrollView"),w=a("DxPopup"),y=a("Pdf");return m(),u("div",null,[r(w,{ref:"popup",showCloseButton:!0,fullScreen:!!e.$screen.getScreenSizeInfo.isXSmall,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:()=>e.$refs.submit.click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>n.popup.hide()}}],wrapperAttr:{class:"confirm-contract-popup"},onHiding:n.onHiding},{content:l(()=>[r(b,null,{default:l(()=>[i("form",{onSubmit:t[5]||(t[5]=I((...s)=>n.onSubmit&&n.onSubmit(...s),["prevent"]))},[i("button",V,null,512),r(C,{ref:"accordion",collapsible:!0,selectedIndex:0,items:[{title:e.$t("components.paidContract.step1"),template:"step1Template"},{title:e.$t("components.paidContract.step2"),template:"step2Template"}]},{step1Template:l(()=>[i("div",B,[i("div",U,[r(g,{text:e.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:t[0]||(t[0]=()=>e.$refs.pdf.download({component:"PayReceiptPdf",contract:o.contract,isPreview:o.formData.isPdfPreview}))},null,8,["text"]),e.$screen.getScreenSizeInfo.isXSmall?f("",!0):(m(),D(d,{key:0,modelValue:o.formData.isPdfPreview,"onUpdate:modelValue":t[1]||(t[1]=s=>o.formData.isPdfPreview=s),text:e.$t("components.paidContract.preview")},null,8,["modelValue","text"]))])])]),step2Template:l(()=>[(m(),u("div",{class:"upload",key:o.refreshKey},[i("div",$,[i("input",{ref:"receiptImage",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:t[2]||(t[2]=(...s)=>n.onUploadImageChange&&n.onUploadImageChange(...s))},null,544),i("label",A,[T,p(" "+h(e.$t("titles.chooseImage")),1)]),r(d,{id:"contractDelete",modelValue:o.formData.isDelete,"onUpdate:modelValue":t[3]||(t[3]=s=>o.formData.isDelete=s),text:e.$t("titles.deleteOldImage"),onValueChanged:n.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])])]))]),_:1},8,["items"]),i("div",H,[r(d,{modelValue:o.formData.isConfirmed,"onUpdate:modelValue":t[4]||(t[4]=s=>o.formData.isConfirmed=s),text:e.$t("components.paidContract.isConfirmed")},null,8,["modelValue","text"]),o.contract.confirmed_by?(m(),u("div",R,[p(" ("+h(e.$t("components.paidContract.confirmedBy"))+" ",1),r(_,{to:{name:"users",query:{code:o.contract.confirmed_by}}},{default:l(()=>[p("#"+h(o.contract.confirmed_by),1)]),_:1},8,["to"]),p(") ")])):f("",!0)])],32)]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"]),e.$mf.isSet(o.contract)?(m(),D(y,{key:0,ref:"pdf"},null,512)):f("",!0)])}const K=P(S,[["render",L]]);export{K as default};
