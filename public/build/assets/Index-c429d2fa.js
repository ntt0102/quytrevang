import{m as d,a as l,n as u}from"./app-f37d1114.js";import{D as m,a as p}from"./data-grid-ec6370c3.js";import{L as f}from"./ListTagBox-d12dc9fb.js";import{_ as g}from"./accordion-a197d8b3.js";import{P as v}from"./Index-d015a2c2.js";import{U as $}from"./UserDetailPopup-36625bdb.js";import"./ui.data_grid.row_dragging-72b50656.js";import"./dialog-42ea61b6.js";import"./interest-formula-7420a65d.js";const y={components:{DxDataGrid:m,DxColumn:p},data(){return{gridData:null}},computed:{...d("Admin.users",["deletedUsers"]),dataGrid:function(){return this.$refs.dataGrid.instance},popup(){return this.$refs.popup.instance}},watch:{deletedUsers(){this.cloneDeepData()}},methods:{...l("Admin.users",["save"]),show(){this.popup.show(),this.cloneDeepData(),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onSavedDeletedUser(t){this.$bus.emit("checkPin",()=>{t.isDeleted=!0,this.save(t)})},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.deletedUsers)},isRowRestored(t){const e=this.dataGrid.option("editing.changes").find(s=>s.type=="update"&&s.key==t);return this.$mf.isSet(e)},unrestore(t){let e=this.dataGrid.option("editing.changes");e=e.filter(s=>!(s.type=="update"&&s.key==t)),this.dataGrid.option("editing.changes",e)},isRowDeleted(t){const e=this.dataGrid.option("editing.changes").find(s=>s.type=="remove"&&s.key==t);return this.$mf.isSet(e)}}};var D=function(){var e=this,s=e._self._c;return s("DxPopup",{ref:"popup",attrs:{showCloseButton:!0,fullScreen:!!e.$devices.phone,"show-title":!0,title:e.$t("admin.users.deletedUsers")},on:{hiding:e.$mf.popRouteHistoryState},scopedSlots:e._u([{key:"content",fn:function(){return[s("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":e.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},editing:{allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"batch"}},on:{contentReady:function(a){return e.$mf.dataGridPreload(e.gridData,e.dataGrid)},saved:e.onSavedDeletedUser},scopedSlots:e._u([{key:"commandCellTemplate",fn:function({data:a}){return[s("DxToolbar",{attrs:{items:[{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{disabled:e.isRowDeleted(a.key),type:"default",icon:e.isRowRestored(a.key)?"undo":"repeat",hint:e.$t("admin.users.buttons.revert"),text:e.$t("admin.users.buttons.revert"),onClick:()=>{e.isRowRestored(a.key)?e.unrestore(a.key):e.dataGrid.cellValue(a.rowIndex,"deleted_at",null),e.dataGrid.repaintRows(a.rowIndex)}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:e.isRowDeleted(a.key)?"undo":"clearsquare",hint:e.$t("admin.users.buttons.remove"),text:e.$t("admin.users.buttons.remove"),onClick:()=>{e.isRowDeleted(a.key)?e.dataGrid.undeleteRow(a.rowIndex):e.dataGrid.deleteRow(a.rowIndex)}}}]}})]}}])},[s("DxColumn",{attrs:{fixed:!0,width:e.$devices.phone?35:75,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t(`titles.commandHeaderTitle${e.$devices.phone?"Short":""}`)}}),s("DxColumn",{attrs:{"allow-editing":!1,"data-field":"code","data-type":"string",caption:e.$t("models.user.codeShort")}}),s("DxColumn",{attrs:{"allow-editing":!1,"data-field":"name",caption:e.$t("models.user.name")}}),s("DxColumn",{attrs:{"allow-editing":!1,"data-field":"phone",caption:e.$t("models.user.phone")}}),s("DxColumn",{attrs:{"allow-editing":!1,visible:!1,"data-field":"deleted_at"}})],1)]},proxy:!0}])})},x=[],w=u(y,D,x,!1,null,null,null,null);const b=w.exports;const C={components:{DxAccordion:g,Pdf:v},data(){return{refreshKey:0,user:{},formData:{},backupDocuments:[]}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance},submit(){return this.$refs.submit.instance}},methods:{...l("Admin.users",["uploadDocuments"]),show({user:t}){this.popup.option("title",this.$t(`components.confirmUser.${t.level==4?"title":"confirmedTitle"}`)+" #"+t.code),this.user=t,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",t.level==4?0:1),0),this.backupDocuments=t.url_documents.map(e=>({...e,isUpload:!1})),this.formData.documents=this.backupDocuments,this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(t){let e=t.target.id.replace("Image","");this.formData.documents=this.formData.documents.filter(s=>!(s.type==e&&s.isUpload)),console.log("onUploadImageChange",t.target.files),[...t.target.files].forEach(s=>this.formData.documents.push({type:e,file:URL.createObjectURL(s),isUpload:!0}))},onCheckBoxDeleteChange(t){let e=t.element.id.replace("Delete","");t.value?this.formData.documents=this.formData.documents.filter(s=>!(s.type==e&&!s.isUpload)):this.formData.documents=this.backupDocuments.filter(s=>s.type==e).concat(this.formData.documents)},saveClick(){!this.formData.isContractDelete&&!this.formData.isIdentityDelete&&this.$refs.contractImage.files.length==0&&this.$refs.identityImage.files.length==0?this.$toasted.info(this.$t("messages.info.noChangedData")):this.formData.documents.length==0?this.$toasted.show(this.$t("messages.warning.imageEmpty")):this.submit.element().click()},onSubmit(){this.$bus.emit("checkPin",async()=>{let t=new FormData;t.append("userId",this.user.id),t.append("isContractDelete",this.formData.isContractDelete),t.append("isIdentityDelete",this.formData.isIdentityDelete);for(var e=0;e<this.$refs.contractImage.files.length;e++){let s=await this.$mf.resizeImage({file:this.$refs.contractImage.files[e],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});t.append(`contractImages[${e}]`,s)}for(var e=0;e<this.$refs.identityImage.files.length;e++){let a=await this.$mf.resizeImage({file:this.$refs.identityImage.files[e],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});t.append(`identityImages[${e}]`,a)}this.uploadDocuments(t).then(s=>{s&&this.popup.hide()})})},initFormData(){this.formData={isPdfPreview:!1,isContractDelete:!1,isIdentityDelete:!1,documents:[]}},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}};var _=function(){var e=this,s=e._self._c;return s("div",[s("DxPopup",{ref:"popup",attrs:{showCloseButton:!0,fullScreen:!!e.$devices.phone,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:e.saveClick}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>e.$refs.submit.click()}}],wrapperAttr:{class:"confirm-user-popup"}},on:{hiding:e.onHiding},scopedSlots:e._u([{key:"content",fn:function(){return[s("DxScrollView",[s("DxAccordion",{ref:"accordion",attrs:{collapsible:!0,items:[{title:e.$t("components.confirmUser.step1"),template:"step1Template"},{title:e.$t("components.confirmUser.step2"),template:"step2Template"}]},scopedSlots:e._u([{key:"step1Template",fn:function(){return[s("div",{staticClass:"download"},[s("DxButton",{attrs:{text:e.$t("buttons.download"),icon:"download",type:"default","styling-mode":"contained"},on:{click:()=>e.$refs.pdf.download({component:"ContractPdf",user:e.user,isPreview:e.formData.isPdfPreview})}}),e.$devices.phone?e._e():s("DxCheckBox",{attrs:{text:e.$t("components.confirmUser.preview")},model:{value:e.formData.isPdfPreview,callback:function(a){e.$set(e.formData,"isPdfPreview",a)},expression:"formData.isPdfPreview"}})],1)]},proxy:!0},{key:"step2Template",fn:function(){return[s("form",{on:{submit:function(a){return a.preventDefault(),e.onSubmit.apply(null,arguments)}}},[s("DxButton",{ref:"submit",staticClass:"display-none",attrs:{useSubmitBehavior:!0}}),s("div",{key:e.refreshKey,staticClass:"upload"},[s("div",{staticClass:"upload-browser"},[s("input",{ref:"contractImage",attrs:{type:"file",id:"contractImage",multiple:"multiple",accept:"images/*"},on:{change:e.onUploadImageChange}}),s("label",{attrs:{for:"contractImage"}},[s("i",{staticClass:"far fa-file-upload"}),e._v(" "+e._s(e.$t("components.confirmUser.chooseContractImage")))]),s("DxCheckBox",{attrs:{id:"contractDelete",text:e.$t("titles.deleteOldImage")},on:{valueChanged:e.onCheckBoxDeleteChange},model:{value:e.formData.isContractDelete,callback:function(a){e.$set(e.formData,"isContractDelete",a)},expression:"formData.isContractDelete"}})],1),s("div",{staticClass:"upload-browser"},[s("input",{ref:"identityImage",attrs:{type:"file",id:"identityImage",multiple:"multiple",accept:"images/*"},on:{change:e.onUploadImageChange}}),s("label",{attrs:{for:"identityImage"}},[s("i",{staticClass:"far fa-file-upload"}),e._v(" "+e._s(e.$t("components.confirmUser.chooseIdentityImage")))]),s("DxCheckBox",{attrs:{id:"identityDelete",text:e.$t("titles.deleteOldImage")},on:{valueChanged:e.onCheckBoxDeleteChange},model:{value:e.formData.isIdentityDelete,callback:function(a){e.$set(e.formData,"isIdentityDelete",a)},expression:"formData.isIdentityDelete"}})],1)])],1)]},proxy:!0}])})],1)]},proxy:!0}])}),e.$mf.isSet(e.user)?s("Pdf",{ref:"pdf"}):e._e()],1)},k=[],S=u(C,_,k,!1,null,null,null,null);const I=S.exports;function h(){return{users:[],deletedUsers:[],allRolesName:[],allPermissionsName:[],updatedAt:null}}const P={users:t=>t.users,deletedUsers:t=>t.deletedUsers,allRolesName:t=>t.allRolesName,allPermissionsName:t=>t.allPermissionsName},R={validateDuplicateEmail({state:t,rootGetters:e},s){const a=t.users.find(i=>i.id===s.data.id);return a&&s.value==a.email?Promise.resolve(!0):new Promise((i,o)=>{axios.post("users/validate-duplicate",{field:"email",email:s.value},{noLoading:!0}).then(n=>{i(n.data)})})},validateDuplicateIdNumber({state:t,rootGetters:e},s){const a=t.users.find(i=>i.id===s.data.id);return a&&s.value==a.identity.number?Promise.resolve(!0):new Promise((i,o)=>{axios.post("users/validate-duplicate",{field:"id_number",id_number:s.value},{noLoading:!0}).then(n=>{i(n.data)})})},validateDuplicatePhone({state:t,rootGetters:e},s){const a=t.users.find(i=>i.id===s.data.id);return a&&s.value==a.phone?Promise.resolve(!0):new Promise((i,o)=>{axios.post("users/validate-duplicate",{field:"phone",phone:s.value},{noLoading:!0}).then(n=>{i(n.data)})})},fetch({commit:t,dispatch:e,getters:s,state:a,rootGetters:i}){return moment().diff(a.updatedAt,"seconds")<3?!1:new Promise((o,n)=>{axios.get("users").then(r=>{t("setState",r.data),o()})})},save({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},o){return new Promise((n,r)=>{axios.post("users"+(o.isDeleted?"/deleted":""),{changes:o.changes}).then(c=>{n(),e("fetch"),e("User.layout/initLayout",["users"],{root:!0})})})},uploadDocuments({commit:t,dispatch:e,getters:s,state:a,rootGetters:i},o){return new Promise((n,r)=>{axios.post("users/documents",o,{headers:{"Content-Type":"multipart/form-data"}}).then(c=>{n(c.data.isOk),e("fetch"),e("User.layout/initLayout",["users"],{root:!0})})})},getContractInfo({commit:t,dispatch:e,getters:s,state:a,rootGetters:i}){return new Promise((o,n)=>{axios.get("users/contract-info",{noLoading:!0}).then(r=>{console.log(r.data),o(r.data)})})},resetState({commit:t}){t("resetState")}},T={setState(t,e){t.users=e.users,t.deletedUsers=e.deletedUsers,t.allRolesName=e.allRolesName,t.allPermissionsName=e.allPermissionsName,t.updatedAt=moment()},resetState(t){t=Object.assign(t,h())}},U={namespaced:!0,state:h,getters:P,actions:R,mutations:T};const G={components:{DxDataGrid:m,DxColumn:p,ListTagBox:f,DeletedUsersPopup:b,ConfirmUserPopup:I,UserDetailPopup:$},data(){return{gridData:null,banks:[],rolesCalculateFilterExpression:function(t,e,s){return s==="search"&&typeof t=="string"?[this.dataField,"contains",t]:function(a){return(a.roles||[]).indexOf(t)!==-1}},permissionsCalculateFilterExpression:function(t,e,s){return s==="search"&&typeof t=="string"?[this.dataField,"contains",t]:function(a){return(a.permissions||[]).indexOf(t)!==-1}},validationRules:{name:[{type:"required",message:this.$t("models.user.name")+this.$mt.validations.required},{type:"stringLength",max:50,message:this.$t("models.user.validations.name")}],sex:[{type:"required",message:this.$t("models.user.sex")+this.$mt.validations.required}],role:[{type:"required",message:this.$t("models.user.roles")+this.$mt.validations.required}],birthday:[{type:"required",message:this.$t("models.user.birthday")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateBirthday,message:this.$t("models.user.validations.birthday")}],idNumber:[{type:"required",message:this.$t("models.user.idNumber")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateIdNumber,message:this.$t("models.user.idNumber")+this.$mt.validations.duplicate}],idIssuedOn:[{type:"required",message:this.$t("models.user.idIssuedOn")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateIdIssuedOn,message:this.$t("models.user.validations.idIssuedOn")}],phone:[{type:"required",message:this.$t("models.user.phone")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicatePhone,message:this.$t("models.user.phone")+this.$mt.validations.duplicate}],email:[{type:"required",message:this.$t("models.user.email")+this.$mt.validations.required},{type:"email",message:this.$t("models.user.email")+this.$mt.validations.email},{type:"async",validationCallback:this.validateDuplicateEmail,message:this.$t("models.user.email")+this.$mt.validations.duplicate}],address:[{type:"required",message:this.$t("models.user.address")+this.$mt.validations.required},{type:"stringLength",max:100,message:this.$t("models.user.validations.address")}]}}},beforeCreate(){this.$store.registerModule("Admin.users",U)},created(){this.fetch().then(()=>this.$mf.getBanks()).then(t=>this.banks=t)},destroyed(){this.$store.unregisterModule("Admin.users")},computed:{...d("Auth",["permissions","code"]),...d("Admin.users",["users","allRolesName","allPermissionsName"]),dataGrid:function(){return this.$refs.dataGrid.instance},contextMenu:function(){return this.$refs.contextMenu.instance}},watch:{users(){this.cloneDeepData()}},methods:{...l("Admin.users",["fetch","save","validateDuplicateEmail","validateDuplicateIdNumber","validateDuplicatePhone","resetState"]),...l("User.layout",["initLayout"]),onSaved(t){t.isDeleted=!1,this.save(t)},onToolbarPreparing(t){t.toolbarOptions.items.unshift({visible:this.$mf.isSet(this.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:this.$t("buttons.back"),onClick:()=>{this.$router.go(-1)}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-share-square small",hint:this.$t("admin.users.buttons.sendNotification"),text:this.$t("admin.users.buttons.sendNotification"),onClick:()=>{this.dataGrid.getSelectedRowKeys().length>0?this.$router.push({name:"setting-notification",query:{codes:this.dataGrid.getSelectedRowKeys().join(",")}}):this.$toasted.show(this.$t("messages.info.noSelectedRow"))}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-trash small",hint:this.$t("admin.users.buttons.selectedDelete"),text:this.$t("admin.users.buttons.selectedDelete"),onClick:()=>{let e=this.dataGrid.getSelectedRowKeys();e.length>0?(this.$bus.emit("checkPin",()=>{this.dataGrid.option("editing.mode","batch"),e.forEach(s=>{this.dataGrid.deleteRow(this.dataGrid.getRowIndexByKey(s))}),this.dataGrid.saveEditData()}),this.dataGrid.option("editing.mode","popup")):this.$toasted.show(this.$t("messages.info.noSelectedRow"))}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-user-times small",hint:this.$t("admin.users.deletedUsers"),text:this.$t("admin.users.deletedUsers"),onClick:()=>this.$refs.deletedUsersPopup.show()}})},tagBoxCellTemplate(t,e){var s=" ",a=(e.value||[]).map(i=>e.column.lookup.calculateCellValue(i)).join(", ");t.textContent=a||s,t.title=a},onValueChanged(t,e){e.setValue(t),e.component.updateDimensions()},validateBirthday(t){return moment(t.value).isBefore(moment().subtract(18,"years"))},validateIdIssuedOn(t){return moment(t.value).isBefore(moment().subtract(1,"day"))},onInitNewRow(t){t.data.roles=["user"],t.data.bank_account={},this.dataGrid.option("editing.popup.title",this.$t("models.user.popup.create"))},onEditingStart(t){this.dataGrid.option("editing.popup.title",`${this.$t("models.user.popup.edit")} #${t.data.code}`)},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.users),this.$route.query.code&&this.dataGrid.columnOption("code","filterValues",[+this.$route.query.code]),this.$route.query.selected&&setTimeout(()=>this.dataGrid.selectRows(this.$route.query.selected.split(","),!0),0)},onShown(t){this.$mf.checkPinDataGrid(t,this),this.$mf.pushPopupToHistoryState(()=>this.dataGrid.cancelEditData())},onCellPrepared(t){if(t.rowType==="data"){if(t.column.dataField==="level"){let e;t.value<4?e="#adadad":t.value==4?e="#edc578":e="#86c285",t.cellElement.style.color=e}t.column.dataField==="phone"&&(t.cellElement.innerHTML=this.$options.filters.phone(t.value))}},onCellDblClick(t){t.rowType=="data"&&t.columnIndex==5&&this.$mf.openLink(`https://zalo.me/${t.data.phone}`)}}};var B=function(){var e=this,s=e._self._c;return s("div",{staticClass:"users-page"},[s("h2",{staticClass:"content-block"},[e._v(" "+e._s(e.$t("admin.users.title"))+" ")]),s("div",{staticClass:"content-block dx-card responsive-paddings"},[s("DxDataGrid",{ref:"dataGrid",attrs:{"data-source":e.gridData,"key-expr":"code","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget","column-chooser":{enabled:!0,mode:"select",allowSearch:!0},paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"multiple",showCheckBoxesMode:"always"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"popup",popup:{showTitle:!0,onShown:e.onShown,onHiding:e.$mf.popRouteHistoryState},form:{colCount:2,labelLocation:e.$devices.phone?"top":"left",items:[{itemType:"group",caption:e.$t("models.user.groups.personalInfo"),items:[{dataField:"name"},{dataField:"sex"},{dataField:"birthday"}]},{itemType:"group",caption:e.$t("models.user.groups.idInfo"),items:[{dataField:"identity.number"},{dataField:"identity.issued_on"},{dataField:"",editorOptions:{value:e.$mt.idIssuedAtValue,readOnly:!0},label:{text:e.$t("models.user.idIssuedAt")}}]},{colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.contactInfo"),items:[{dataField:"phone"},{dataField:"email"},{dataField:"address",colSpan:2}]},{colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.bankInfo"),items:[{dataField:"bank_account.bank_name"},{dataField:"bank_account.account_name"},{dataField:"bank_account.account_number"}]},{visible:e.permissions.includes("system@control"),colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.permission"),items:[{dataField:"roles",colSpan:2},{dataField:"permissions",colSpan:2}]}]}}},on:{"cell-prepared":e.onCellPrepared,contentReady:function(a){return e.$mf.dataGridPreload(e.gridData,e.dataGrid)},"toolbar-preparing":e.onToolbarPreparing,"init-new-row":e.onInitNewRow,"editing-start":e.onEditingStart,cellDblClick:e.onCellDblClick,saved:e.onSaved},scopedSlots:e._u([{key:"avatarCellTemplate",fn:function({}){}},{key:"roleTagBoxEditor",fn:function({data:a}){return[s("ListTagBox",{attrs:{value:a.value,"on-value-changed":i=>e.onValueChanged(i,a),"data-source":e.allRolesName,"data-grid-component":a.component}})]}},{key:"permissionTagBoxEditor",fn:function({data:a}){return[s("ListTagBox",{attrs:{value:a.value,"on-value-changed":i=>e.onValueChanged(i,a),"data-source":e.allPermissionsName,"data-grid-component":a.component}})]}},{key:"commandCellTemplate",fn:function({data:a}){return[s("DxToolbar",{attrs:{items:[{visible:[4,5].includes(a.data.level)||e.permissions.includes("system@control")&&a.data.level>5,locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${a.data.level==4?"check":"file-check"} small`,hint:e.$t(`components.confirmUser.${a.data.level==4?"title":"confirmedTitle"}`),text:e.$t(`components.confirmUser.${a.data.level==4?"title":"confirmedTitle"}`),onClick:()=>e.$refs.confirmUserPopup.show({user:a.data})}},{visible:a.data.level>=6,locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"far fa-usd-circle small",hint:e.$t("admin.users.buttons.viewContract"),text:e.$t("admin.users.buttons.viewContract"),onClick:()=>e.$router.push({name:"contracts",query:{userCode:a.data.code}})}},{visible:!a.data.permissions.includes("system@control")||e.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"edit",hint:e.$t("buttons.edit"),text:e.$t("buttons.edit"),onClick:()=>e.dataGrid.editRow(a.rowIndex)}},{visible:a.data.level<=6&&a.data.code!=e.code&&!a.data.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:e.$t("buttons.delete"),text:e.$t("buttons.delete"),onClick:()=>e.$bus.emit("checkPin",()=>e.dataGrid.deleteRow(a.rowIndex))}},{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"info",hint:e.$t("admin.users.detailUser"),text:e.$t("admin.users.detailUser"),onClick:()=>e.$refs.userDetailPopup.show({user:a.data})}}]}})]}}])},[s("DxColumn",{attrs:{fixed:!0,width:e.$devices.phone?35:125,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t(`titles.commandHeaderTitle${e.$devices.phone?"Short":""}`)}}),s("DxColumn",{attrs:{width:60,"allow-sorting":!1,allowFiltering:!1,"data-field":"url_avatar","cell-template":"avatarCellTemplate",cssClass:"avatar-column",caption:e.$t("models.user.avatar")}}),s("DxColumn",{attrs:{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},name:"code",caption:e.$t("models.user.codeShort")}}),s("DxColumn",{attrs:{"allow-editing":!1,"data-field":"level",dataType:"number",caption:e.$t("models.user.status"),lookup:{dataSource:e.$mf.getUserLevelList(),displayExpr:"name",valueExpr:"value"}}}),s("DxColumn",{attrs:{"data-field":"name","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.name"),"validation-rules":e.validationRules.name}}),s("DxColumn",{attrs:{visible:!1,"data-field":"sex","data-type":"number",caption:e.$t("models.user.sex"),"validation-rules":e.validationRules.sex,lookup:{dataSource:e.$mf.getSexList(),displayExpr:"name",valueExpr:"value"}}}),s("DxColumn",{attrs:{visible:!1,"data-field":"birthday","data-type":"date","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},caption:e.$t("models.user.birthday"),"validation-rules":e.validationRules.birthday}}),s("DxColumn",{attrs:{visible:!1,"data-field":"identity.number","data-type":"string","editor-options":{mask:"000000000000"},"header-filter":{allowSearch:!0},caption:e.$t("models.user.idNumber"),"validation-rules":e.validationRules.idNumber}}),s("DxColumn",{attrs:{visible:!1,"data-field":"identity.issued_on","data-type":"date","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},caption:e.$t("models.user.idIssuedOn"),"validation-rules":e.validationRules.idIssuedOn}}),s("DxColumn",{attrs:{"data-field":"phone","data-type":"string","editor-options":{mask:"0000.000.000"},"header-filter":{allowSearch:!0},caption:e.$t("models.user.phone"),"validation-rules":e.validationRules.phone}}),s("DxColumn",{attrs:{visible:!1,"data-field":"email","data-type":"string",name:"email","header-filter":{allowSearch:!0},caption:e.$t("models.user.email"),"validation-rules":e.validationRules.email}}),s("DxColumn",{attrs:{visible:!1,"data-field":"address","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.address"),"validation-rules":e.validationRules.address}}),s("DxColumn",{attrs:{visible:!1,"data-field":"bank_account.bank_name","data-type":"string",lookup:{dataSource:e.banks,displayExpr:"short_name",valueExpr:"short_name",allowClearing:!0},"header-filter":{allowSearch:!0},caption:e.$t("models.user.bankName")}}),s("DxColumn",{attrs:{visible:!1,"data-field":"bank_account.account_name","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.accountName")}}),s("DxColumn",{attrs:{visible:!1,"data-field":"bank_account.account_number","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.accountNumber")}}),e.permissions.includes("system@control")?s("DxColumn",{attrs:{visible:!1,"allow-sorting":!1,"data-field":"roles","data-type":"string","cell-template":e.tagBoxCellTemplate,"calculate-filter-expression":e.rolesCalculateFilterExpression,caption:e.$t("models.user.roles"),"edit-cell-template":"roleTagBoxEditor","validation-rules":e.validationRules.role,lookup:{dataSource:e.allRolesName}}}):e._e(),e.permissions.includes("system@control")?s("DxColumn",{attrs:{visible:!1,"allow-sorting":!1,"data-field":"permissions","data-type":"string","cell-template":e.tagBoxCellTemplate,"calculate-filter-expression":e.permissionsCalculateFilterExpression,caption:e.$t("models.user.permissions"),"edit-cell-template":"permissionTagBoxEditor",lookup:{dataSource:e.allPermissionsName}}}):e._e()],1)],1),s("DeletedUsersPopup",{ref:"deletedUsersPopup"}),s("ConfirmUserPopup",{ref:"confirmUserPopup"}),s("UserDetailPopup",{ref:"userDetailPopup"})],1)},F=[],E=u(G,B,F,!1,null,null,null,null);const K=E.exports;export{K as default};
