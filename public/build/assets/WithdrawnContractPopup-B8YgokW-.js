import{u as K,r as u,a as W,c as j,b as f,e as s,f as i,_ as z,p,q as w,F as O,h as Q,k as D,x as X,m as $,o as l,d as a,g as y,t as o,P as T,s as h,v as G}from"./app-CYzHvIhY.js";import{D as R}from"./accordion-CzjRIRoE.js";import{l as Z}from"./load-indicator-DsIftRal.js";import{_ as J}from"./Index-BZ-CNEHA.js";const Y={class:"amount"},tt=["innerHTML"],et=["innerHTML"],at={class:"way1"},nt={class:"description text-darker"},ot={class:"method"},st={class:"method1"},lt={key:0},ct={class:"method2"},rt={class:"text-darker"},it={class:"download way2"},dt={class:"upload-browser"},mt={for:"receiptImage"},ut=a("i",{class:"far fa-file-upload"},null,-1),kt={__name:"WithdrawnContractPopup",setup(ft,{expose:V}){const P=Q(),{t:v}=K(),q=D("bus"),B=D("mc"),b=D("mf"),d=u(null),g=u(null),_=u(null),m=u(null),e=W({refreshKey:0,contract:{},formData:{},qrSrc:null});let k=[];const C=j(()=>new Set(e.formData.documents.map(t=>t.file)));I();function U(t){d.value.setTitle(v(`components.withdrawnContract.${t.status==4?"withdrawnTitle":"title"}`)+" #"+t.code),d.value.show(),e.contract=t}function x(t){e.formData.documents=e.formData.documents.filter(n=>!n.isUpload),[...t.target.files].forEach(n=>e.formData.documents.push({file:URL.createObjectURL(n),isUpload:!0}))}function L(t){t.value?e.formData.documents=e.formData.documents.filter(n=>n.isUpload):e.formData.documents=k.concat(e.formData.documents)}function N(){!e.formData.isDelete&&m.value.files.length==0?X.info(v("messages.info.noChangedData")):_.value.click()}function M(){q.emit("checkPin",async()=>{let t=new FormData;t.append("contractId",e.contract.id),t.append("isDelete",e.formData.isDelete);for(var n=0;n<m.value.files.length;n++){let c=await b.resizeImage({file:m.value.files[n],maxSize:B.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${n}]`,c)}P.dispatch("adminContract/withdrawnContract",t).then(c=>{c&&d.value.hide()})})}function E(){let t=document.createElement("a");t.href=e.qrSrc,t.download=`vietQR_${e.contract.code}`,t.click()}function I(){e.formData={isPdfPreview:!1,isDelete:!1,documents:[]},e.qrSrc=null}function H(){setTimeout(()=>g.value.instance.option("selectedIndex",e.contract.status==3?0:1),500),k=e.contract.url_withdrawn_docs.map(n=>({file:n,isUpload:!1})),e.formData.documents=k;let t=`https://img.vietqr.io/image/${e.contract.bank_account.bank_name}-${e.contract.bank_account.account_number}-KRnx1D.jpg?accountName=${e.contract.bank_account.account_name}&amount=${e.contract.advance}&addInfo=${v("models.contract.transfer.contentValue",[e.contract.code])}`;b.fetchImage(t).then(n=>e.qrSrc=n)}function A(){I(),e.refreshKey++}return V({show:U}),(t,n)=>{const c=$("DxButton"),S=$("DxCheckBox"),F=$("DxScrollView");return l(),f(O,null,[s(z,{ref_key:"popupRef",ref:d,class:"withdrawn-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:N}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>d.value.hide()}}],onShown:H,onHidden:A},{default:i(()=>[s(F,null,{default:i(()=>[a("form",{onSubmit:G(M,["prevent"])},[a("button",{ref_key:"submitRef",ref:_,class:"display-none"},null,512),a("div",Y,[a("div",{class:"text-dark",innerHTML:t.$t("components.withdrawnContract.amount",[t.$filters.currency(e.contract.advance),t.$filters.currency(e.contract.total)])},null,8,tt),e.contract.advance<e.contract.total?(l(),f("div",{key:0,class:"text-dark",innerHTML:t.$t("components.withdrawnContract.surplus",[t.$filters.currency(e.contract.total-e.contract.advance)])},null,8,et)):w("",!0)]),s(y(R),{ref_key:"accordionRef",ref:g,collapsible:!0,items:[{title:t.$t("components.withdrawnContract.step1"),template:"step1Template"},{title:t.$t("components.withdrawnContract.step2"),template:"step2Template"}]},{step1Template:i(()=>[s(y(R),{collapsible:!0,items:[{title:t.$t("components.withdrawnContract.withdrawnWay1"),template:"way1Template"},{title:t.$t("components.withdrawnContract.withdrawnWay2"),template:"way2Template"}]},{way1Template:i(()=>[a("div",at,[a("div",nt,o(t.$t("models.contract.transfer.qrCode")),1),a("div",ot,[a("div",st,[e.qrSrc?(l(),f("div",lt,[s(T,{images:[e.qrSrc]},null,8,["images"]),s(c,{class:"download-qr",text:t.$t("buttons.qrDownload"),icon:"download",type:"default","styling-mode":"text",onClick:E},null,8,["text"])])):(l(),p(y(Z.DxLoadIndicator),{key:1,height:40,width:40}))]),a("div",ct,[a("div",null,[a("span",null,o(t.$t("models.user.bankName"))+":",1),a("span",null,o(e.contract.bank_account.bank_name),1)]),a("div",null,[a("span",null,o(t.$t("models.user.accountName"))+":",1),a("span",null,o(e.contract.bank_account.account_name),1)]),a("div",null,[a("span",null,o(t.$t("models.user.accountNumber"))+":",1),a("span",null,[h(o(e.contract.bank_account.account_number)+" ",1),a("i",{class:"far fa-copy",onClick:n[0]||(n[0]=r=>t.$mf.copyText(e.contract.bank_account.account_number))})])]),a("div",null,[a("span",null,o(t.$t("models.contract.transfer.amount"))+":",1),a("span",null,[h(o(t.$filters.currency(e.contract.advance))+" ",1),a("i",{class:"far fa-copy",onClick:n[1]||(n[1]=r=>t.$mf.copyText(e.contract.advance))})])]),a("div",null,[a("span",null,o(t.$t("models.contract.transfer.content"))+":",1),a("span",null,[h(o(t.$t("models.contract.transfer.contentValue",[e.contract.code]))+" ",1),a("i",{class:"far fa-copy",onClick:n[2]||(n[2]=r=>t.$mf.copyText(t.$t("models.contract.transfer.contentValue",[e.contract.code])))})])]),a("div",rt,o(t.$t("models.contract.transfer.note")),1)])])])]),way2Template:i(()=>[a("div",it,[s(c,{text:t.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:n[3]||(n[3]=()=>t.$refs.pdfRef.download({component:"WithdrawReceiptPdf",contract:e.contract,isPreview:e.formData.isPdfPreview}))},null,8,["text"]),t.$screen.getScreenSizeInfo.isXSmall?w("",!0):(l(),p(S,{key:0,modelValue:e.formData.isPdfPreview,"onUpdate:modelValue":n[4]||(n[4]=r=>e.formData.isPdfPreview=r),text:t.$t("components.withdrawnContract.preview")},null,8,["modelValue","text"]))])]),_:1},8,["items"])]),step2Template:i(()=>[(l(),f("div",{class:"upload",key:e.refreshKey},[a("div",dt,[a("input",{ref_key:"receiptImageRef",ref:m,type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:x},null,544),a("label",mt,[ut,h(" "+o(t.$t("titles.chooseImage")),1)]),s(S,{id:"contractDelete",modelValue:e.formData.isDelete,"onUpdate:modelValue":n[5]||(n[5]=r=>e.formData.isDelete=r),text:t.$t("titles.deleteOldImage"),onValueChanged:L},null,8,["modelValue","text"])]),C.value.length?(l(),p(T,{key:0,images:C.value},null,8,["images"])):w("",!0)]))]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["toolbarItems"]),t.$mf.isSet(e.contract)?(l(),p(J,{key:0,ref:"pdfRef"},null,512)):w("",!0)],64)}}};export{kt as default};
