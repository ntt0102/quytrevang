import{z as _,u as B,b as E,c as z,i as l,r as m,d as q,w as A,f as H,g as x,h as N,j as o,k as $,l as n,F,o as G,D as i,m as V}from"./app-04f18117.js";import X from"./ContractConditionsPopup-87166395.js";import O from"./PayingContractPopup-f06d85de.js";import j from"./WithdrawingContractPopup-f52e241c.js";import{_ as L}from"./ContractDetailPopup-126a39be.js";import"./accordion-ce6486f1.js";import"./load-indicator-dc8b9c80.js";import"./radio-group-1115270e.js";const U={class:"content-block dx-card responsive-paddings"},J={__name:"Index",setup(K){const r=B(),p=E(),{t:s}=z(),v=l("bus"),b=l("mt"),y=l("mc"),c=l("mf"),w=l("routeHistoryState"),a=m(null),h=m(null),g=m(null),d=q({gridData:null,validationRules:[{type:"required",message:s("models.contract.principal")+b.validations.required},{type:"custom",validationCallback:R,message:s("models.contract.validations.principal")}]});r.dispatch("userContract/getContracts").then(()=>{p.hash=="#conditions"&&showConditions()}),A(()=>r.state.userContract.contracts,t=>D(t));function S(t){v.emit("checkPin",()=>{r.dispatch("userContract/save",{changes:t.changes}).then(({isOk:u,type:f,contract:e})=>{u&&f=="insert"&&h.value.show(e)})})}function C(t){return t.row.data.status==1}function R(t){return t.value>=r.state.userContract.principalMin}function k(t){t.data.status=1,t.data.interest_rate=r.state.userContract.interestRate,t.data.paid_at=moment().format(y.SERVER_DATE_FORMAT),a.value.instance.option("editing.popup.title",s("models.contract.popup.create"))}function P(t){a.value.instance.option("editing.popup.title",`${s("models.contract.popup.edit")} #${t.data.code}`)}function D(t){d.gridData=c.cloneDeep(t),p.query.code&&a.value.instance.columnOption("code","filterValues",[+p.query.code])}function I(t){c.checkPinDataGrid(t,a.value.instance),c.pushPopupToHistoryState(w,()=>a.value.instance.cancelEditData())}function T(){c.popRouteHistoryState(w)}function M(t){t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{icon:"help",type:"normal",hint:s("components.contractConditions.title"),onClick:()=>g.value.show()}})}return(t,u)=>{const f=H("DxToolbar");return G(),x(F,null,[N("div",U,[o(n(V),{ref_key:"dataGridRef",ref:a,"column-min-width":40,"data-source":d.gridData,"key-expr":"code","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:C,allowDeleting:C,confirmDelete:!1,mode:"popup",popup:{width:300,height:t.$screen.getScreenSizeInfo.isXSmall?250:210,fullScreen:!1,showTitle:!0,onShown:I,onHiding:T},form:{labelLocation:t.$screen.getScreenSizeInfo.isXSmall?"top":"left",items:[{dataField:"principal",colSpan:2}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:u[0]||(u[0]=e=>t.$mf.dataGridPreload(d.gridData,a.value.instance)),onInitNewRow:k,onEditingStart:P,onToolbarPreparing:M,onSaved:S},{commandCellTemplate:$(({data:e})=>[o(f,{items:[{visible:e.data.status<=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==0?"arrow-square-up":"receipt"}`,hint:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),text:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),onClick:()=>t.$refs.payingContractPopupRef.show(e.data)}},{visible:e.data.status==2,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"far fa-arrow-square-down",hint:t.$t("user.contract.withdrawContract"),text:t.$t("user.contract.withdrawContract"),onClick:()=>t.$refs.withdrawingContractPopupRef.show(e.data)}},{visible:e.data.status==3,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"undo",hint:t.$t("user.contract.unwithdrawContract"),text:t.$t("user.contract.unwithdrawContract"),onClick:()=>t.$bus.emit("checkPin",()=>t.$store.dispatch("userContract/withdrawingContract",{id:e.data.id,advance:0}))}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>a.value.instance.editRow(e.rowIndex)}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>a.value.instance.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key)&&e.data.status>=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopupRef.show(e.data)}}]},null,8,["items"])]),default:$(()=>[o(n(i),{fixed:!0,width:t.$screen.getScreenSizeInfo.isXSmall?35:98,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$screen.getScreenSizeInfo.isXSmall?"Short":""}`)},null,8,["width","caption"]),o(n(i),{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),o(n(i),{"allow-editing":!1,"data-field":"status",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),o(n(i),{name:"principal","data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":d.validationRules},null,8,["caption","validation-rules"]),o(n(i),{"allow-editing":!1,"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),caption:t.$t("models.contract.interestRate")},null,8,["format","caption"]),o(n(i),{"allow-editing":!1,name:"paidAt","data-field":"paid_at","data-type":"date",caption:t.$t("models.contract.paidAt")},null,8,["caption"]),o(n(i),{"allow-editing":!1,name:"withdrawnAt","data-field":"withdrawn_at","data-type":"date",caption:t.$t("models.contract.withdrawnAt")},null,8,["caption"])]),_:1},8,["data-source","editing","onCellPrepared"])]),o(X,{ref_key:"contractConditionsPopupRef",ref:g},null,512),o(O,{ref_key:"payingContractPopupRef",ref:h},null,512),o(j,{ref:"withdrawingContractPopupRef"},null,512),o(L,{ref:"contractDetailPopupRef"},null,512)],64)}}},nt=_(J,[["__scopeId","data-v-64243979"]]);export{nt as default};
