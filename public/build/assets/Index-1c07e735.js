import{y as Kt,u as Gt,b as Jt,c as Zt,i as se,r as k,d as Qt,e as Re,x as er,z as tr,w as ze,v as S,f as rr,g as ir,h as y,j as oe,A as ve,t as $e,B as N,C as sr,E as or,G as Y,F as ar,H as Be,I as nr,o as lr}from"./app-f1384bd1.js";import cr from"./CopyistStatusPopup-382cccba.js";import{c as pr,_ as dr}from"./DailyCashFlowPopup-3408ab03.js";import ur from"./ColorPicker-d04cdeb1.js";const fr="/build/assets/spinner-4da4a8c6.gif";class hr{constructor(){this.create()}create(){return new Promise((w,L)=>{const x=indexedDB.open("orderChart",1);x.onupgradeneeded=f=>{this.store=f.target.result,this.store.createObjectStore("order",{keyPath:"kind"}),this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("box",{keyPath:"point"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("pattern2",{keyPath:"point"}),this.store.createObjectStore("uplps",{keyPath:"title"}),this.store.createObjectStore("downlps",{keyPath:"title"}),this.store.createObjectStore("volprofile",{keyPath:"time"}),this.store.createObjectStore("alert",{keyPath:"price"}),this.store.createObjectStore("target",{keyPath:"price"}),w()},x.onsuccess=f=>{this.store=f.target.result,w()},x.onerror=()=>{location.reload(),L()}})}get(w){var L=this.store;return new Promise(function(f,q){var g=L.transaction(w,"readonly");if(Array.isArray(w)){var W=w.map(E=>g.objectStore(E)),h=W.map(x);Promise.all(h).then(E=>f(E))}else{var G=g.objectStore(w);x(G).then(E=>f(E))}});function x(f){return new Promise(function(q,g){const W=f.getAll();W.onsuccess=h=>q(h.target.result),W.onerror=()=>g()})}}set(w,L){const x=this.store.transaction(w,"readwrite").objectStore(w);Array.isArray(L)?L.length>0&&L.forEach(f=>x.put(f)):x.put(L)}clear(w){var L=this.store;return new Promise(function(x,f){const q=L.transaction(w,"readwrite").objectStore(w).clear();q.onsuccess=()=>{x()},q.onerror=g=>{console.error(`Error to empty Object Store: ${w}`),f()}})}}const n=new hr,mr="/build/assets/alert-4d705e53.mp3";const gr={class:"content-block dx-card responsive-paddings"},vr={class:"area data-area"},yr=["title"],xr=["title"],Cr=["title"],Pr={class:"area tool-area"},Or=["title"],br=["title"],kr=["title"],Lr=["title"],wr=["title"],Sr=["title"],Tr=["title"],Fr=["title"],Dr=["title"],_r=["title"],Ar=["title"],Er=["title"],Rr=["title"],zr=["title"],$r=["title"],Br=["src"],Me=3,qe=2,Mr="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",qr=120,Ir={__name:"Index",setup(Ie){const w={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:20,minBarSpacing:.01}},L=moment().format("YYYY-MM-DD"),x={START:moment(L+" 08:45:00").unix(),ATO:moment(L+" 09:00:00").unix(),ATC:moment(L+" 14:30:00").unix(),END:moment(L+" 14:45:00").unix()},f=Gt(),q=Jt(),{t:g}=Zt(),W=se("devices"),h=se("mf"),G=se("bus"),E=se("filters"),_=k(null),ye=k(null),X=k(null),xe=k(null),Ce=k(null),Pe=k(null),Oe=k(null),Ve=k(null),H=k(null),J=k(null),ae=k(null),ne=k(null),le=k(null),ce=k(null),pe=k(null),Z=k(null),de=k(null),U=k(null),I=k(null),K=k(null),Ne=k(null);let e={chart:{},series:{},data:{whitespace:[],original:[],price:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},C:{},D:{}},pattern1:{A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},pattern2:{O:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const v=Qt({chartDate:q.query.date??L,clock:moment().format("HH:mm:ss"),isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),T=Re(()=>f.state.tradingOrder.status),We=Re(()=>`https://chart.vps.com.vn/tv/?loadLastChart=true&symbol=VN30F1M&u=${f.state.tradingOrder.config.vpsCode}&s=${f.state.tradingOrder.config.vpsSession}&resolution=1`);f.dispatch("tradingOrder/getConfig").then(()=>{fe()}),f.dispatch("tradingOrder/getStatus"),e.interval=setInterval(rt,1e3),e.interval60=setInterval(()=>f.dispatch("tradingOrder/getStatus"),6e4),n.create(),er(()=>{e.chart=pr(ye.value,w),_.value.addEventListener("click",Ye),_.value.addEventListener("contextmenu",je),e.chart.subscribeCrosshairMove(Xe),e.chart.subscribeCustomPriceLineDragged(He),e.series.whitespace=e.chart.addLineSeries({priceScaleId:"whitespace",visible:!1}),e.series.box=e.chart.addHistogramSeries({priceScaleId:"box",scaleMargins:{top:0,bottom:0},color:"#667b68",lastValueVisible:!1,priceLineVisible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",lastValueVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.1}}),new ResizeObserver(Ue).observe(_.value),document.addEventListener("keydown",Ke),document.addEventListener("fullscreenchange",Ge),f.dispatch("tradingOrder/getChartData",v.chartDate).then(()=>{Ze()})}),tr(()=>{clearInterval(e.interval),clearInterval(e.interval60),e.socketStop=!0,e.websocket.close(),e.websocket=null}),ze(()=>f.state.tradingOrder.chartData,Qe),ze(()=>f.state.tradingOrder.isChartLoading,t=>{xe.value.style.display=t?"block":"none"});function je(t){it(),t.preventDefault()}function Ye(){he(),H.value.classList.contains("selected")?j():J.value.classList.contains("selected")?ft():ae.value.classList.contains("selected")?gt():de.value.classList.contains("selected")?me():ne.value.classList.contains("selected")?xt():le.value.classList.contains("selected")?Se():ce.value.classList.contains("selected")?Fe():pe.value.classList.contains("selected")?_e():Z.value.classList.contains("selected")&&_t()}function Xe(t){if(t.time){let r=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=r}else W.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function He(t){let r=t.customPriceLine,i=r.options();i.price=ee(i.price);const o=+t.fromPriceString,l=i.price;switch(i.lineType){case"order":if(l!=o){let s=!1;i.kind=="entry"?T.value.position||(s=!0,e.order[i.kind].price=l,f.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"change",price:e.order.entry.price}}).then(d=>{d.isOk?(R(i.kind),S.success(g("trading.orderChart.changeEntrySuccess"))):(r.applyOptions({price:o}),D(d.message))})):(s=!0,e.order[i.kind].price=l,i.kind=="tp"?f.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"change",price:e.order.tp.price}}).then(d=>{d.isOk?(R(i.kind),S.success(g("trading.orderChart.changeTpSuccess"))):(r.applyOptions({price:o}),D(d.message))}):f.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"change",price:e.order.sl.price}}).then(d=>{d.isOk?(R(i.kind),S.success(g("trading.orderChart.changeSlSuccess"))):(r.applyOptions({price:o}),D(d.message))})),s||(r.applyOptions({price:o}),S.show(g("trading.orderChart.noChangeOrderLine")))}break;case"line":n.set("line",{price:o,removed:!0}),n.set("line",i),H.value.classList.remove("selected");break;case"ruler":switch(i.point){case"l0":if(n.set("ruler",i),e.ruler.pointCount==2){const A=+e.ruler.l1.options().title,V=+(l-A).toFixed(1);e.ruler.ln1.applyOptions({price:V}),n.set("ruler",e.ruler.ln1.options());const re=+(l+A).toFixed(1);e.ruler.l1.applyOptions({price:re}),n.set("ruler",e.ruler.l1.options());const ie=+(l+A*2).toFixed(1);e.ruler.l2.applyOptions({price:ie}),n.set("ruler",e.ruler.l2.options());const Ht=+(l+A*3).toFixed(1);e.ruler.l3.applyOptions({price:Ht}),n.set("ruler",e.ruler.l3.options());const Ut=+(l+A*4).toFixed(1);e.ruler.l4.applyOptions({price:Ut}),n.set("ruler",e.ruler.l4.options())}break;case"ln1":const s=+e.ruler.l0.options().price,d=l-s;r.applyOptions({title:d.toFixed(1)}),n.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(-d).toFixed(1),price:+(s-d).toFixed(1)}),n.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-d*2).toFixed(1),price:+(s-d*2).toFixed(1)}),n.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-d*3).toFixed(1),price:+(s-d*3).toFixed(1)}),n.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-d*4).toFixed(1),price:+(s-d*4).toFixed(1)}),n.set("ruler",e.ruler.l4.options());break;case"l1":const u=+e.ruler.l0.options().price,c=l-u;r.applyOptions({title:c.toFixed(1)}),n.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-c).toFixed(1),price:+(u-c).toFixed(1)}),n.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(c*2).toFixed(1),price:+(u+c*2).toFixed(1)}),n.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(c*3).toFixed(1),price:+(u+c*3).toFixed(1)}),n.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(c*4).toFixed(1),price:+(u+c*4).toFixed(1)}),n.set("ruler",e.ruler.l4.options());break;case"l2":const O=+e.ruler.l0.options().price,m=l-O;r.applyOptions({title:m.toFixed(1)}),n.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-m*.5).toFixed(1),price:+(O-m*.5).toFixed(1)}),n.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(m*.5).toFixed(1),price:+(O+m*.5).toFixed(1)}),n.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(m*1.5).toFixed(1),price:+(O+m*1.5).toFixed(1)}),n.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(m*2).toFixed(1),price:+(O+m*2).toFixed(1)}),n.set("ruler",e.ruler.l4.options());break;case"l3":const P=+e.ruler.l0.options().price,C=l-P;r.applyOptions({title:C.toFixed(1)}),n.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-C/3).toFixed(1),price:+(P-C/3).toFixed(1)}),n.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(C/3).toFixed(1),price:+(P+C/3).toFixed(1)}),n.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(C*2/3).toFixed(1),price:+(P+C*2/3).toFixed(1)}),n.set("ruler",e.ruler.l2.options());break;case"l4":const z=+e.ruler.l0.options().price,b=l-z;r.applyOptions({title:b.toFixed(1)}),n.set("ruler",r.options()),e.ruler.ln1.applyOptions({title:(-b/4).toFixed(1),price:+(z-b/4).toFixed(1)}),n.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(b/4).toFixed(1),price:+(z+b/4).toFixed(1)}),n.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(b/2).toFixed(1),price:+(z+b/2).toFixed(1)}),n.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(b*3/4).toFixed(1),price:+(z+b*3/4).toFixed(1)}),n.set("ruler",e.ruler.l3.options());break}break;case"pattern1":if(h.isSet(e.pattern1.C)){const s=+e.pattern1.A.options().price,u=+e.pattern1.B.options().price-s;e.pattern1.B.applyOptions({title:u.toFixed(1)}),n.set("pattern1",e.pattern1.B.options()),e.pattern1.C.applyOptions({price:+(s+.5*u).toFixed(1),title:(.5*u).toFixed(1)}),n.set("pattern1",e.pattern1.C.options()),e.pattern1.X1.applyOptions({price:+(s-.375*u).toFixed(1),title:(-.375*u).toFixed(1)}),n.set("pattern1",e.pattern1.X1.options()),e.pattern1.X2.applyOptions({price:+(s-.5*u).toFixed(1),title:(-.5*u).toFixed(1)}),n.set("pattern1",e.pattern1.X2.options()),e.pattern1.Y1.applyOptions({price:+(s-u).toFixed(1),title:-u.toFixed(1)}),n.set("pattern1",e.pattern1.Y1.options()),e.pattern1.Y2.applyOptions({price:+(s-2*u).toFixed(1),title:(-2*u).toFixed(1)}),n.set("pattern1",e.pattern1.Y2.options())}break;case"pattern2":if(h.isSet(e.pattern2.T)){const s=e.pattern2.E.options(),d=+s.price1,u=+s.price2,c=+s.price3,O=+s.price4,m=+s.price,P=c-u,C=d-O,z=c-O,b=m-O;let A,V;i.point=="S"?(V=+e.pattern2.S.options().price,A=m-V):(A=Math.abs(P)>Math.abs(b/2)?P:b/2,V=m-A,e.pattern2.S.applyOptions({price:+V.toFixed(1)}));const re=V+(Math.abs(b)>Math.abs(z)?Math.abs(b)>Math.abs(C)?1:1.5:2)*b,ie=re-m;e.pattern2.S.applyOptions({title:`SL=${(-A).toFixed(1)}`}),n.set("pattern2",e.pattern2.S.options()),e.pattern2.E.applyOptions({title:`RR=${(ie/A).toFixed(1)}`}),n.set("pattern2",e.pattern2.E.options()),e.pattern2.T.applyOptions({price:+re.toFixed(1),title:`TP=${ie.toFixed(1)}`}),n.set("pattern2",e.pattern2.T.options())}break;case"alert":n.set("alert",{price:o,removed:!0});const p=e.data.price.slice(-1)[0].value;let a=l>=p?">":"<";r.applyOptions({title:a}),n.set("alert",r.options()),Z.value.classList.remove("selected");break;case"box":if(i.point==1)me(!0);else if(i.point==5){const s=+e.box[2].z.options().price,d=+e.box[4].z.options().price,u=s-d;e.box[5].z.applyOptions({price:+(s+.375*u).toFixed(1),title:(.375*u).toFixed(1)}),e.box[6].z.applyOptions({price:+(s+u).toFixed(1),title:u.toFixed(1)}),e.box[7].z.applyOptions({price:+(s+2*u).toFixed(1),title:(2*u).toFixed(1)}),n.get("box").then(c=>{c[4].z=e.box[4].z.options(),n.set("box",c[4]),c[5].z=e.box[5].z.options(),n.set("box",c[5]),c[6].z=e.box[6].z.options(),n.set("box",c[6]),c[7].z=e.box[7].z.options(),n.set("box",c[7])})}break}}function Ue(){_.value&&(e.chart.resize(_.value.offsetWidth,_.value.offsetHeight),_.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ke(t){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 38:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.05});break;case 40:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.05});break;case 37:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-10);break;case 39:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+10);break;case 96:J.value.click();break;case 97:H.value.click();break;case 98:Pe.value.click();break;case 99:Ce.value.click();case 100:Oe.value.click();break}}function Ge(){_.value&&(document.fullscreenElement?(v.isFullscreen=!0,_.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(v.isFullscreen=!1,_.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Je(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Ze(){return new Promise(async t=>{T.value.pending&&((await n.get("order")).map(O=>{e.order.side=O.side,e.order[O.kind].price=O.price,R(O.kind),$(!0)}),e.order.tp.hasOwnProperty("line")&&e.order.entry.line.applyOptions({draggable:!1})),(await n.get("line")).forEach(c=>{c.removed||e.lines.push(e.series.price.createPriceLine(c))});const i=await n.get("box");i.length>0&&(e.box=i,i.forEach((c,O)=>{h.isSet(c.x)&&e.series.box.update(c.x),h.isSet(c.y)&&(e.box[O].y=e.series.cash.createPriceLine(c.y)),h.isSet(c.z)&&(e.box[O].z=e.series.price.createPriceLine(c.z))}));const o=await n.get("ruler");o.length>0&&(e.ruler.pointCount=o.length>1?2:1,o.forEach(c=>{e.ruler[c.point]=e.series.price.createPriceLine(c)}));const l=await n.get("target");l.length>0&&l.forEach(c=>{e.target[c.point]=e.series.cash.createPriceLine(c)});const p=await n.get("pattern1");p.length>0&&p.forEach(c=>{e.pattern1[c.point]=e.series.price.createPriceLine(c)});const a=await n.get("uplps");a.length>0&&a.forEach(c=>{e.uplps[c.title]=e.series[c.title.includes("P")?"price":"cash"].createPriceLine(c)});const s=await n.get("downlps");s.length>0&&s.forEach(c=>{e.downlps[c.title]=e.series[c.title.includes("P")?"price":"cash"].createPriceLine(c)});const d=await n.get("pattern2");d.length>0&&d.forEach(c=>{e.pattern2[c.point]=e.series.price.createPriceLine(c)}),(await n.get("alert")).forEach(c=>{c.removed||e.alerts.push(e.series.price.createPriceLine(c))}),t()})}function Qe(){e.loadWhitespace&&(f.state.tradingOrder.chartData.length>0&&(e.data.whitespace=ue(e.data.whitespace,tt())),e.series.whitespace.setData(e.data.whitespace),e.loadWhitespace=!1),e.data.original=ue(f.state.tradingOrder.chartData,e.data.original);let t=e.data.original.reduce((r,i)=>{let o=i.price,l=0;r.price.length>0&&(o=r.price.slice(-1)[0].value,l=r.cash.slice(-1)[0].value);const p=i.price-o,a=p>0?1:p<0?-1:0;return r.price.push({time:i.time,value:i.price}),r.cash.push({time:i.time,value:l+a*i.volume}),r},{price:[],cash:[]});e.data.price=t.price,e.series.price.setData(t.price),e.data.cash=t.cash,e.series.cash.setData(t.cash)}function et(t){const r=e.data.original.length;if(e.data.original=ue(e.data.original,[t]),e.data.original.length>r){const i=e.data.price.slice(-1)[0].value,o=e.data.cash.slice(-1)[0].value,l=t.price-i,p=l>0?1:l<0?-1:0,a={time:t.time,value:t.price},s={time:t.time,value:o+p*t.volume};e.data.price.push(a),e.series.price.update(a),e.data.cash.push(s),e.series.cash.update(s)}}function tt(){const t=v.chartDate,r=moment(`${t} 09:00:00`).unix(),i=moment(`${t} 11:30:00`).unix(),o=moment(`${t} 13:00:00`).unix(),l=moment(`${t} 14:30:00`).unix();let p=[],a;for(a=r;a<=i;a++)p.push({time:a+7*60*60});for(a=o;a<=l;a++)p.push({time:a+7*60*60});return p}function ue(t,r){return Array.from(new Map([...t,...r].sort((i,o)=>i.time-o.time).map(i=>[i.time,i])).values())}function fe(){e.websocket=new WebSocket(Mr),e.websocket.onopen=t=>{let r={action:"join",list:f.state.tradingOrder.config.symbol};e.websocket.send(`42${JSON.stringify(["regs",JSON.stringify(r)])}`)},e.websocket.onclose=t=>{if(e.socketStop)return!1;Q()&&(be(!0),fe(),moment().diff(e.socketRefreshTime,"seconds")>qr&&ge())},e.websocket.onmessage=t=>{if(be(!1),t.data.substr(0,1)==4&&t.data.substr(1,1)==2){const r=JSON.parse(t.data.substr(2));if(r[0]=="stockps"){const i=r[1].data;i.id==3220&&(e.data.original.length>0&&et({time:moment(`${L} ${i.time}`).unix()+7*60*60,price:i.lastPrice,volume:i.lastVol}),It(),qt())}}}}function rt(){const t=moment().unix();Q(t)&&(T.value.position&&t>x.ATC-5*60&&(st(),t>x.ATC-15&&e.order.tp.hasOwnProperty("line")&&f.dispatch("tradingOrder/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),$(!1),n.clear("order"),S.success(g("trading.orderChart.autoCancelTpSlSuccess")),te()):D(r.message)})),t==x.START&&fe()),v.clock=moment().format("HH:mm:ss")}function it(){if(f.state.tradingOrder.config.openingMarket){const t=moment().unix();if(Q(t)&&(e.order.tp.hasOwnProperty("line")||T.value.position&&t>x.ATO&&t<x.ATC&&(e.order.entry.price=e.data.price.slice(-1)[0].value,e.order.side=T.value.position,K.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",K.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",K.value.style.display="block"),!e.order.entry.hasOwnProperty("line"))){let r=null,i=0;T.value.position?(t<x.ATO?r="ATO":t>x.ATC&&(r="ATC"),r&&(e.order.entry.price=r,i=-T.value.position)):t>x.ATO&&t<x.ATC&&(r=M(e.crosshair.y),i=r>=e.data.price.slice(-1)[0].value?1:-1,e.order.side=i,e.order.entry.price=r),i&&(I.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",I.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",I.value.style.background=i>0?"green":"red",I.value.innerText=`${i>0?"LONG":"SHORT"} ${r}`,I.value.style.display="block")}}}function he(){I.value.style.display="none",K.value.style.display="none"}function $(t){U.value.style.display=t?"block":"none"}function st(){U.value.classList.contains("blink")||U.value.classList.add("blink")}function be(t){t?X.value.classList.contains("blink")||X.value.classList.add("blink"):X.value.classList.contains("blink")&&X.value.classList.remove("blink")}function R(t){let r,i;switch(t){case"entry":r="yellow",i=e.order.side>0?"LONG":"SHORT";break;case"tp":r="lime",i=Math.abs(e.order.tp.price-e.order.entry.price).toFixed(1);break;case"sl":r="red",i=Math.abs(e.order.sl.price-e.order.entry.price).toFixed(1);break}e.order[t].hasOwnProperty("line")?e.order[t].line.applyOptions({price:e.order[t].price,title:i}):e.order[t].line=e.series.price.createPriceLine({lineType:"order",kind:t,price:e.order[t].price,color:r,lineWidth:1,lineStyle:0,title:i,draggable:!0}),n.set("order",{kind:t,price:+e.order[t].price,side:e.order.side})}function F(t){e.order[t].hasOwnProperty("line")&&(e.series.price.removePriceLine(e.order[t].line),delete e.order[t].line)}function ot(t){v.showTradingView=!v.showTradingView,t.stopPropagation()}function at(t){v.showColorPicker=!v.showColorPicker,t.stopPropagation()}function nt(t){h.isSet(e.pattern1.X)&&(j(+e.pattern1.X.options().price),j(+e.pattern1.Y.options().price),j(+e.pattern1.Z.options().price),j(+e.pattern1.T.options().price)),t.preventDefault(),t.stopPropagation()}function lt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function ct(t){pt(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function j(t=null,r=!1,i=!1){const o="line";t||(t=ee(M(e.crosshair.y)));const l=e.lines.length;if(e.lines=e.lines.filter(p=>{const a=p.options(),s=a.type=t==+a.price;return s&&(e.series.price.removePriceLine(p),n.set("line",{price:t,removed:!0})),!s}),e.lines.length==l&&!i||r){const p={lineType:o,price:t,color:v.color,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(p)),n.set("line",p)}H.value.classList.remove("selected")}function pt(){e.lines.forEach(t=>e.series.price.removePriceLine(t)),e.lines=[],n.clear("line")}function dt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),ke()),t.stopPropagation()}function ut(t){ke(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ft(){const t=M(e.crosshair.y);let r={lineType:"ruler",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)r.point="l0",r.color="#F44336",r.title="0",e.ruler[r.point]=e.series.price.createPriceLine(r),e.ruler.pointCount++,n.set("ruler",r);else{const i=+e.ruler.l0.options().price,o=t-i;r.point="l1",r.color="#FF9800",r.title=o.toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),n.set("ruler",r);const l=-o;r.point="ln1",r.color="#FF9800",r.title=l.toFixed(1),r.price=+(i+l).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),n.set("ruler",r);const p=2*o;r.point="l2",r.color="#FFEB3B",r.title=p.toFixed(1),r.price=+(i+p).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),n.set("ruler",r);const a=3*o;r.point="l3",r.color="#4CAF50",r.title=a.toFixed(1),r.price=+(i+a).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),n.set("ruler",r);const s=4*o;r.point="l4",r.color="#009688",r.title=s.toFixed(1),r.price=+(i+s).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),n.set("ruler",r),e.ruler.pointCount++,J.value.classList.remove("selected")}}function ke(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},n.clear("ruler"))}function ht(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Le()),t.stopPropagation()}function mt(t){Le(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function gt(){let r={lineType:"target",price:M(e.crosshair.y,"cash"),lineWidth:1,lineStyle:0,draggable:!1,axisLabelVisible:!1};if(h.isSet(e.target.A)?h.isSet(e.target.B)?(r.point="C",r.title="C",r.color="#9C27B0"):(r.point="B",r.title="B",r.color="#E91E63"):(r.point="A",r.title="A",r.color="#E91E63"),e.target[r.point]=e.series.cash.createPriceLine(r),n.set("target",r),r.point=="C"){const i=+e.target.A.options().price,o=+e.target.B.options().price,l=+e.target.C.options().price;r.point="D",r.price=+(l+o-i).toFixed(1),r.title="D",r.color="#9C27B0",e.target[r.point]=e.series.cash.createPriceLine(r),n.set("target",r),ae.value.classList.remove("selected")}}function Le(){h.isSet(e.target.A)&&(e.series.cash.removePriceLine(e.target.A),h.isSet(e.target.B)&&(e.series.cash.removePriceLine(e.target.B),h.isSet(e.target.C)&&(e.series.cash.removePriceLine(e.target.C),e.series.cash.removePriceLine(e.target.D))),e.target={A:{},B:{},C:{},D:{}},n.clear("target"))}function vt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),we()),t.stopPropagation()}function yt(t){we(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function xt(){const t=M(e.crosshair.y);let r={lineType:"pattern1",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(h.isSet(e.pattern1.A)){const i=+e.pattern1.A.options().price,o=t-i;r.point="B",r.title=o.toFixed(1),r.color="#009688",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),r.point="C",r.price=+(i+.5*o).toFixed(1),r.title=(.5*o).toFixed(1),r.color="#009688",r.draggable=!1,e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),r.point="X1",r.price=+(i-.375*o).toFixed(1),r.title=(-.375*o).toFixed(1),r.color="#2196F3",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),r.point="X2",r.price=+(i-.5*o).toFixed(1),r.title=(-.5*o).toFixed(1),r.color="#2196F3",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),r.point="Y1",r.price=+(i-o).toFixed(1),r.title=-o.toFixed(1),r.color="#673AB7",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),r.point="Y2",r.price=+(i-2*o).toFixed(1),r.title=(-2*o).toFixed(1),r.color="#673AB7",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r),ne.value.classList.remove("selected")}else r.point="A",r.title="0",r.color="#009688",e.pattern1[r.point]=e.series.price.createPriceLine(r),n.set("pattern1",r)}function we(){h.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),h.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X1),e.series.price.removePriceLine(e.pattern1.X2),e.series.price.removePriceLine(e.pattern1.Y1),e.series.price.removePriceLine(e.pattern1.Y2)),e.pattern1={A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},n.clear("pattern1"))}function Ct(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Se(!0)),t.stopPropagation()}function Pt(t){Te(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Se(t=!1){let r;if(t){if(!h.isSet(e.uplps.P1))return!1;r=+e.uplps.P1.options().startTime,Te()}else r=e.crosshair.time;const{price1:i,price2:o,cash1:l,cash2:p}=Ot(r);let a={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1};a.startTime=r,a.price=i,a.title="P1",e.uplps[a.title]=e.series.price.createPriceLine(a),n.set("uplps",a),a.price=o,a.title="P2",e.uplps[a.title]=e.series.price.createPriceLine(a),n.set("uplps",a),a.price=l,a.title="C1",e.uplps[a.title]=e.series.cash.createPriceLine(a),n.set("uplps",a),a.price=p,a.title="C2",e.uplps[a.title]=e.series.cash.createPriceLine(a),n.set("uplps",a),le.value.classList.remove("selected")}function Ot(t){let r,i,o,l=0,p=0,a,s,d=0,u=0;for(let c=0;c<e.data.price.length;c++){if(e.data.price[c].time<t)continue;const m=e.data.price[c].value,P=e.data.cash[c].value;if(r==null&&(r=m,i=m,o=m,a=P,s=P),m>o)l>p&&(i=o,p=l),o=m,l=0;else if(m<o){const C=+(o-m).toFixed(1);C>l&&(l=C)}if(m<r&&p>0)break;if(P>s)d>u&&(a=s,u=d),s=P,d=0;else if(P<s){const C=+(s-P).toFixed(1);C>d&&(d=C)}}return{price1:+(i-p).toFixed(1),price2:+(o-p).toFixed(1),cash1:+(a-u).toFixed(1),cash2:+(s-u).toFixed(1)}}function Te(){h.isSet(e.uplps.P1)&&(e.series.price.removePriceLine(e.uplps.P1),e.series.price.removePriceLine(e.uplps.P2)),h.isSet(e.uplps.C1)&&(e.series.cash.removePriceLine(e.uplps.C1),e.series.cash.removePriceLine(e.uplps.C2)),e.uplps={P1:{},P2:{},C1:{},C2:{}},n.clear("uplps")}function bt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Fe(!0)),t.stopPropagation()}function kt(t){De(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Fe(t=!1){let r;if(t){if(!h.isSet(e.downlps.P1))return!1;r=+e.downlps.P1.options().startTime,De()}else r=e.crosshair.time;const{price1:i,price2:o,cash1:l,cash2:p}=Lt(r);let a={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1};a.startTime=r,a.price=i,a.title="P1",e.downlps[a.title]=e.series.price.createPriceLine(a),n.set("downlps",a),a.price=o,a.title="P2",e.downlps[a.title]=e.series.price.createPriceLine(a),n.set("downlps",a),a.price=l,a.title="C1",e.downlps[a.title]=e.series.cash.createPriceLine(a),n.set("downlps",a),a.price=p,a.title="C2",e.downlps[a.title]=e.series.cash.createPriceLine(a),n.set("downlps",a),ce.value.classList.remove("selected")}function Lt(t){let r,i,o,l=0,p=0,a,s,d=0,u=0;for(let c=0;c<e.data.price.length;c++){if(e.data.price[c].time<t)continue;const m=e.data.price[c].value,P=e.data.cash[c].value;if(r==null&&(r=m,i=m,o=m,a=P,s=P),m<o)l<p&&(i=o,p=l),o=m,l=0;else if(m>o){const C=+(o-m).toFixed(1);C<l&&(l=C)}if(m>r&&p<0)break;if(P<s)d<u&&(a=s,u=d),s=P,d=0;else if(P>s){const C=+(s-P).toFixed(1);C<d&&(d=C)}}return{price1:+(i-p).toFixed(1),price2:+(o-p).toFixed(1),cash1:+(a-u).toFixed(1),cash2:+(s-u).toFixed(1)}}function De(){h.isSet(e.downlps.P1)&&(e.series.price.removePriceLine(e.downlps.P1),e.series.price.removePriceLine(e.downlps.P2)),h.isSet(e.downlps.C1)&&(e.series.cash.removePriceLine(e.downlps.C1),e.series.cash.removePriceLine(e.downlps.C2)),e.downlps={P1:{},P2:{},C1:{},C2:{}},n.clear("downlps")}function wt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),_e(!0)),t.stopPropagation()}function St(t){Ae(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function _e(t=!1){let r={};if(h.isSet(e.pattern2.O)){const s=e.pattern2.O.options();r={time:s.time0,value:s.price0},Ae()}else{if(t)return!1;r={time:e.crosshair.time,value:M(e.crosshair.y)}}const{price2:i,price3:o,price4:l,isAcc:p}=Tt(r);let a={lineType:"pattern2",lineWidth:1,lineStyle:1};console.log("isAcc",p),j(r.value,!p,p),a.time0=r.time,a.price0=r.value,a.point="O",a.price=l,a.title="O",a.color="#2196F3",a.draggable=!1,e.pattern2[a.point]=e.series.price.createPriceLine(a),n.set("pattern2",a),pe.value.classList.remove("selected")}function Tt(t){let r=t.value,i=t.value,o=t.value,l=!1;for(let p of e.data.price)if(p.time>=t.time){p.value<t.value?(r<=t.value&&p.value<r&&(r=p.value),i<=t.value&&r>t.value&&p.value<i&&(i=p.value)):p.value>t.value&&(r>=t.value&&p.value>r&&(r=p.value),i>=t.value&&r<t.value&&p.value>i&&(i=p.value));const a=p.value-i,s=t.value-i,d=r-i,u=Math.abs(s*2)>Math.abs(d/2)?s*2:d/2;if(o=+(i+u).toFixed(1),r!=t.value&&i!=t.value){if(Math.abs(a)>Math.abs(u)){l=!0;break}if(Math.abs(a)>Math.abs(s)*3)break}}return{price2:r,price3:i,price4:o,isAcc:l}}function Ae(){h.isSet(e.pattern2.O)&&(e.series.price.removePriceLine(e.pattern2.O),e.pattern2={O:{}},n.clear("pattern2"))}function Ft(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function Dt(t){At(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function _t(){const t="alert",r=ee(M(e.crosshair.y)),i=e.alerts.length;if(e.alerts=e.alerts.filter(o=>{const l=o.options(),p=l.type=r==+l.price;return p&&(e.series.price.removePriceLine(o),n.set("alert",{price:r,removed:!0})),!p}),e.alerts.length==i){const o={lineType:t,price:r,title:r>=e.data.price.slice(-1)[0].value?">":"<",color:"red",lineWidth:1,lineStyle:1,draggable:!0};e.alerts.push(e.series.price.createPriceLine(o)),n.set("alert",o)}Z.value.classList.remove("selected")}function At(){e.alerts.forEach(t=>e.series.price.removePriceLine(t)),e.alerts=[],n.clear("alert")}function Et(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),me(!0)),t.stopPropagation()}function Rt(t){Ee(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function me(t=!1){let r={};if(t){if(e.box.length==0)return!1;r={time:+e.box[0].x.time,cash:+e.box[0].y.options().price,price:+e.box[0].z.options().price},Ee()}else{if(!e.crosshair.price)return!1;r={time:e.crosshair.time,cash:M(e.crosshair.y,"cash"),price:e.crosshair.price}}const{point1:i,point2:o,point3:l,point4:p,point5:a}=zt(r);let s={};const d={x:{value:1},y:{lineWidth:1,lineStyle:0,draggable:!1,axisLabelVisible:!1},z:{lineType:"box",lineWidth:1,lineStyle:1,draggable:!1}};s=h.cloneDeep(d),s.point=1,s.x.time=i.time,s.y.price=i.cash,s.y.color="#6a3c07",s.z.point=1,s.z.price=i.price,s.z.title="⬤",s.z.color="#ff9966",s.z.draggable=!0,B(s),s=h.cloneDeep(d),s.point=2,delete s.x,delete s.y,delete s.z,B(s),s=h.cloneDeep(d),s.point=3,s.x.time=l.time,delete s.y,s.z.price=l.price,s.z.title="0",s.z.color="#ff9966",B(s),s=h.cloneDeep(d),s.point=4,s.x.time=p.time,s.y.price=p.cash,s.y.color="#600844",s.z.price=p.price,s.z.title="◀",s.z.color="#600844",B(s),s=h.cloneDeep(d),s.point=5,s.x.time=a.time,delete s.y,s.z.point=5,s.z.price=a.price,s.z.title="⬛",s.z.color="#ff9966",s.z.draggable=!0,B(s);const u=l.price-a.price;s=h.cloneDeep(d),s.point=6,delete s.x,delete s.y,s.z.price=+(l.price+.375*u).toFixed(1),s.z.title=(.375*u).toFixed(1),s.z.color="#009688",B(s),s=h.cloneDeep(d),s.point=7,delete s.x,delete s.y,s.z.price=+(l.price+u).toFixed(1),s.z.title=u.toFixed(1),s.z.color="#00BCD4",B(s),s=h.cloneDeep(d),s.point=8,delete s.x,delete s.y,s.z.price=+(l.price+2*u).toFixed(1),s.z.title=(2*u).toFixed(1),s.z.color="#2196F3",B(s),de.value.classList.remove("selected")}function zt(t){const r=h.cloneDeep(t);let i={...r},o={...r},l={...r},p={...r},a={...r};for(let s=0;s<e.data.price.length;s++){const d=e.data.price[s].time;if(d<=i.time)continue;const u=e.data.price[s].value,c=e.data.cash[s].value;if(c<i.cash?(o.cash<=i.cash&&c<o.cash&&(o.time=d,o.cash=c,l.time=d,p.time=d,a.time=d),o.cash>i.cash&&(l.cash<=i.cash&&c<l.cash&&(l.time=d,l.cash=c),c<o.cash&&l.cash==i.cash&&(l.time=d,p.time=d,a.time=d))):c>i.cash&&(o.cash>=i.cash&&c>o.cash&&(o.time=d,o.cash=c,l.time=d,p.time=d,a.time=d),o.cash<i.cash&&(l.cash>=i.cash&&c>l.cash&&(l.time=d,l.cash=c),c>o.cash&&l.cash==i.cash&&(l.time=d,p.time=d,a.time=d))),o.cash<l.cash?(o.price<=a.price&&u<o.price&&(o.price=u),u>l.price&&(l.price=u,a.price=u),u<a.price&&(a.price=u)):o.cash>l.cash&&(o.price>=a.price&&u>o.price&&(o.price=u),u<l.price&&(l.price=u,a.price=u),u>a.price&&(a.price=u)),l.cash!=i.cash){const O=e.data.whitespace.findIndex(b=>b.time===i.time),m=e.data.whitespace.findIndex(b=>b.time===l.time),P=e.data.whitespace.findIndex(b=>b.time===d),C=2*m-O,z=3*m-2*O;if(C<e.data.whitespace.length&&(p.time=e.data.whitespace[C].time,p.cash=+(l.cash+o.cash-i.cash).toFixed(1),p.price=+(l.price+o.price-i.price).toFixed(1)),z<e.data.whitespace.length&&(a.time=e.data.whitespace[z].time,a.cash=+(l.cash+o.cash-i.cash).toFixed(1)),P>C)break}}return{point1:i,point2:o,point3:l,point4:p,point5:a}}function B(t){n.set("box",t),h.isSet(t.x)&&e.series.box.update(t.x),h.isSet(t.y)&&(t.y=e.series.cash.createPriceLine(t.y)),h.isSet(t.z)&&(t.z=e.series.price.createPriceLine(t.z)),e.box.push(t)}function Ee(){e.box.forEach(t=>{h.isSet(t.y)&&e.series.cash.removePriceLine(t.y),h.isSet(t.z)&&e.series.price.removePriceLine(t.z)}),e.series.box.setData([]),e.box=[],n.clear("box")}async function $t(){e.order.entry.hasOwnProperty("line")&&(e.order.tp.hasOwnProperty("line")?f.dispatch("tradingOrder/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(F("entry"),F("tp"),F("sl"),$(!1),n.clear("order"),S.success(g("trading.orderChart.exitSuccess"))):($(!0),D(t.message))}):f.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"delete"}}).then(t=>{t.isOk?(F("entry"),$(!1),n.clear("order"),S.success(g("trading.orderChart.deleteEntrySuccess"))):($(!0),D(t.message))}))}function Bt(){const t=moment().unix();Q(t)&&(t<x.ATO?Be(g("trading.orderChart.atoOrder"),g("titles.confirm")).then(i=>{i&&f.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(o=>{o.isOk?S.success(g("trading.orderChart.atoOrderSuccess")):D(o.message)})}):t<x.ATC?f.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"new",side:e.order.side,price:e.order.entry.price}}).then(r=>{r.isOk?(R("entry"),$(!0),S.success(g("trading.orderChart.newEntrySuccess"))):D(r.message)}):Be(g("trading.orderChart.atcOrder"),g("titles.confirm")).then(i=>{i&&f.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(o=>{o.isOk?S.success(g("trading.orderChart.atcOrderSuccess")):D(o.message)})}))}function Mt(){e.order.tp.price=e.order.entry.price+e.order.side*Me,e.order.sl.price=e.order.entry.price-e.order.side*qe,f.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(t=>{t.isOk?(R("entry"),R("tp"),R("sl"),e.order.entry.line.applyOptions({draggable:!1}),S.success(g("trading.orderChart.newTpSlSuccess"))):D(t.message)})}function qt(){if(e.order.entry.hasOwnProperty("line")){const t=e.data.price.slice(-1)[0].value;e.order.tp.hasOwnProperty("line")?((e.order.side>0&&t>=e.order.tp.price||e.order.side<0&&t<=e.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,f.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"delete"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),$(!1),n.clear("order"),S.success(g("trading.orderChart.deleteTpSuccess")),he(),te()):D(r.message),e.isAutoOrdering=!1}))),(e.order.side>0&&t<=e.order.sl.price||e.order.side<0&&t>=e.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,f.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"cancel"}}).then(r=>{r.isOk?(F("entry"),F("tp"),F("sl"),$(!1),n.clear("order"),S.success(g("trading.orderChart.deleteSlSuccess")),he(),te()):D(r.message),e.isAutoOrdering=!1})))):(e.order.side>0&&t>=e.order.entry.price||e.order.side<0&&t<=e.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.order.tp.price=e.order.entry.price+e.order.side*Me,e.order.sl.price=e.order.entry.price-e.order.side*qe,f.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(r=>{r.isOk?(R("tp"),R("sl"),e.order.entry.line.applyOptions({draggable:!1}),S.success(g("trading.orderChart.autoNewTpSlSuccess")),te()):D(r.message),e.isAutoOrdering=!1})},1e3)))}}function It(){if(T.value.position&&h.isSet(e.target.X)){const t=e.data.cash.slice(-1)[0].value,r=+e.target.B.options().price,i=+e.target.X.options().price,o=i-r;(o>0&&t>=i||o<0&&t<=i)&&U.value.click()}}function Vt(){e.chart.timeScale().scrollToRealTime()}function Q(t=null){return t||(t=moment().unix()),t>=x.START&&t<=x.END}function M(t,r="price"){return ee(e.series[r].coordinateToPrice(t))}function ee(t){return t?+ +t.toFixed(1):0}function D(t){t||(t="unknown"),S.error(g(`trading.orderChart.${t}`))}function Nt(){e.loadWhitespace=!0,f.dispatch("tradingOrder/getChartData",v.chartDate)}function ge(){e.socketRefreshTime=moment(),e.loadWhitespace=!0,f.dispatch("tradingOrder/getChartData",v.chartDate)}function Wt(){e.data.original=[],e.data.price=[],e.data.cash=[],e.data.whitespace=[],ge()}function te(){let t=new Audio(mr);t.crossOrigin="anonymous",t.addEventListener("canplaythrough",function(){t.play()})}function jt(){f.dispatch("tradingOrder/getAccountInfo").then(t=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${g("trading.orderChart.nav")}</div><div>: ${E.currency(t.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${g("trading.orderChart.maxVol")}</div><div>: ${E.numberVnFormat(t.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${g("trading.orderChart.vm")}</div><div>: ${E.currency(t.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${g("trading.orderChart.fee")}</div><div>: ${E.currency(t.fee)}</div></div>`,r+="</div>",nr(r,g("trading.orderChart.accountInfo"))})}function Yt(){G.emit("checkPin",()=>f.dispatch("tradingOrder/report"))}function Xt(){G.emit("checkPin",()=>f.dispatch("tradingOrder/export"))}return(t,r)=>{const i=rr("DxToolbar");return lr(),ir(ar,null,[y("div",gr,[oe(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-flag-checkered small",hint:t.$t("trading.orderChart.buttons.report"),onClick:Yt}},{location:"before",widget:"dxButton",options:{icon:"far fa-file-export small",hint:t.$t("trading.orderChart.buttons.export"),onClick:Xt}},{location:"before",widget:"dxButton",options:{icon:"far fa-chart-line small",hint:t.$t("trading.orderChart.buttons.cashflow"),onClick:()=>t.$refs.dailyCashFlowPopupRef.show()}}]},null,8,["items"]),y("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:_},[y("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:ye},[y("div",vr,[y("div",{ref_key:"connectionRef",ref:X,class:ve(`command far fa-${T.value.connection?"link":"unlink"}`),title:t.$t("trading.orderChart.connection"),onClick:r[0]||(r[0]=()=>t.$store.dispatch("tradingOrder/getStatus"))},null,10,yr),y("div",{class:ve(["command status",{green:T.value.position>0,red:T.value.position<0,pending:T.value.pending}]),title:t.$t("trading.orderChart.position"),onClick:jt},$e(T.value.position),11,xr),y("div",{class:"command clock",onClick:ge},$e(v.clock),1),N(y("input",{type:"date",class:"chart-date command",title:t.$t("trading.orderChart.date"),"onUpdate:modelValue":r[1]||(r[1]=o=>v.chartDate=o),onChange:Nt},null,40,Cr),[[sr,v.chartDate]]),y("img",{ref_key:"spinnerRef",ref:xe,class:"command spinner",src:fr},null,512)]),y("div",Pr,[y("div",{ref_key:"fullscreenToolRef",ref:Ce,class:ve(`command far fa-${v.isFullscreen?"compress":"expand"}`),title:t.$t("trading.orderChart.fullscreen"),onClick:Je},null,10,Or),y("div",{ref_key:"reloadToolRef",ref:Pe,class:"command far fa-sync-alt",title:t.$t("trading.orderChart.reload"),onClick:Wt},null,8,br),y("div",{ref_key:"tradingviewRef",ref:Oe,class:"command far fa-chart-bar",title:t.$t("trading.orderChart.tradingview"),onClick:ot},null,8,kr),y("div",{ref_key:"colorToolRef",ref:Ve,class:"color command far fa-palette",style:or({color:v.color}),title:t.$t("trading.orderChart.colorTool"),onClick:at,onContextmenu:nt},[N(oe(ur,{class:"color-picker",modelValue:v.color,"onUpdate:modelValue":r[2]||(r[2]=o=>v.color=o)},null,8,["modelValue"]),[[Y,v.showColorPicker]])],44,Lr),y("div",{ref_key:"lineToolRef",ref:H,class:"command far fa-horizontal-rule",title:t.$t("trading.orderChart.lineTool"),onClick:lt,onContextmenu:ct},null,40,wr),y("div",{ref_key:"pattern1ToolRef",ref:ne,class:"command far fa-dot-circle",title:t.$t("trading.orderChart.pattern1Tool"),onClick:vt,onContextmenu:yt},null,40,Sr),y("div",{ref_key:"uplpsToolRef",ref:le,class:"command far fa-arrow-up",title:t.$t("trading.orderChart.pattern1Tool"),onClick:Ct,onContextmenu:Pt},null,40,Tr),y("div",{ref_key:"downlpsToolRef",ref:ce,class:"command far fa-arrow-down",title:t.$t("trading.orderChart.pattern1Tool"),onClick:bt,onContextmenu:kt},null,40,Fr),N(y("div",{ref_key:"pattern2ToolRef",ref:pe,class:"command far fa-heart",title:t.$t("trading.orderChart.pattern2Tool"),onClick:wt,onContextmenu:St},null,40,Dr),[[Y,!1]]),y("div",{ref_key:"rulerToolRef",ref:J,class:"command far fa-line-height",title:t.$t("trading.orderChart.rulerTool"),onClick:dt,onContextmenu:ut},null,40,_r),N(y("div",{ref_key:"targetToolRef",ref:ae,class:"command far fa-grip-lines",title:t.$t("trading.orderChart.targetTool"),onClick:ht,onContextmenu:mt},null,40,Ar),[[Y,!1]]),y("div",{ref_key:"boxToolRef",ref:de,class:"command far fa-expand-alt",title:t.$t("trading.orderChart.boxTool"),onClick:Et,onContextmenu:Rt},null,40,Er),N(y("div",{ref_key:"alertToolRef",ref:Z,class:"command far fa-alarm-exclamation",title:t.$t("trading.orderChart.alertTool"),onClick:Ft,onContextmenu:Dt},null,40,Rr),[[Y,!1]]),N(y("div",{class:"command far fa-info-circle",title:t.$t("trading.orderChart.copyistStatusPopup.title"),onClick:r[3]||(r[3]=()=>t.$refs.copyistStatusPopupRef.show())},null,8,zr),[[Y,!1]]),y("div",{ref_key:"cancelOrderRef",ref:U,class:"cancel-order command far fa-trash-alt",title:t.$t("trading.orderChart.cancelTool"),onClick:$t},null,8,$r)]),y("div",null,[y("div",{ref_key:"entryOrderRef",ref:I,class:"order-button entry",onClick:Bt}," Entry ",512),y("div",{ref_key:"tpslOrderRef",ref:K,class:"order-button tpsl",onClick:Mt}," TP/SL ",512),y("div",{class:"chart-top command far fa-angle-double-right",onClick:Vt})]),N(y("iframe",{ref_key:"tradingviewChartRef",ref:Ne,class:"tradingview-chart",src:We.value},null,8,Br),[[Y,v.showTradingView]])],512)],512)]),oe(cr,{ref:"copyistStatusPopupRef"},null,512),oe(dr,{ref:"dailyCashFlowPopupRef"},null,512)],64)}}},Yr=Kt(Ir,[["__scopeId","data-v-45c9e28a"]]);export{Yr as default};
