import{u as L,c as N,i as g,r as m,d as j,e as K,x as X,f as y,g as $,j as s,k as c,_ as G,n as h,p as v,F as H,v as S,o as f,l as Z,h as n,q as x,t as P,P as q,s as J}from"./app-e708c993.js";import{_ as Q}from"./accordion-42dd588e.js";import{_ as W}from"./Index-134d658f.js";const Y={class:"download"},ee=["onSubmit"],te={class:"upload-browser"},oe={for:"contractImage"},ae=n("i",{class:"far fa-file-upload"},null,-1),ne={class:"upload-browser"},se={for:"identityImage"},le=n("i",{class:"far fa-file-upload"},null,-1),de={__name:"ConfirmUserPopup",setup(ie,{expose:V}){const R=L(),{t:p}=N(),B=g("bus"),_=g("mc"),I=g("mf"),l=m(null),T=m(null),w=m(null),d=m(null),u=m(null),t=j({refreshKey:0,user:{},formData:{}});let D=[];const C=K(()=>new Set(t.formData.documents.map(e=>e.file)));X(()=>k());function E({user:e}){l.value.setTitle(p(`components.confirmUser.${e.level==4?"title":"confirmedTitle"}`)+" #"+e.code),l.value.show(),t.user=e}function b(e){let o=e.target.id.replace("Image","");t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&a.isUpload)),console.log("onUploadImageChange",e.target.files),[...e.target.files].forEach(a=>t.formData.documents.push({type:o,file:URL.createObjectURL(a),isUpload:!0}))}function U(e){let o=e.element.id.replace("Delete","");e.value?t.formData.documents=t.formData.documents.filter(a=>!(a.type==o&&!a.isUpload)):t.formData.documents=D.filter(a=>a.type==o).concat(t.formData.documents)}function A(){!t.formData.isContractDelete&&!t.formData.isIdentityDelete&&d.value.files.length==0&&u.value.files.length==0?S.info(p("messages.info.noChangedData")):t.formData.documents.length==0?S.show(p("messages.warning.imageEmpty")):w.value.click()}function M(){B.emit("checkPin",async()=>{let e=new FormData;e.append("userId",t.user.id),e.append("isContractDelete",t.formData.isContractDelete),e.append("isIdentityDelete",t.formData.isIdentityDelete);for(var o=0;o<d.value.files.length;o++){let a=await I.resizeImage({file:d.value.files[o],maxSize:_.MAX_SIZE_IMAGE_UPLOAD});e.append(`contractImages[${o}]`,a)}for(var o=0;o<u.value.files.length;o++){let i=await I.resizeImage({file:u.value.files[o],maxSize:_.MAX_SIZE_IMAGE_UPLOAD});e.append(`identityImages[${o}]`,i)}R.dispatch("adminUser/uploadDocuments",e).then(a=>{a&&l.value.hide()})})}function k(){t.formData={isPdfPreview:!1,isContractDelete:!1,isIdentityDelete:!1,documents:[]}}function z(){setTimeout(()=>T.value.instance.option("selectedIndex",t.user.level==4?0:1),0),D=t.user.url_documents.map(e=>({...e,isUpload:!1})),t.formData.documents=D}function O(){k(),t.refreshKey++}return V({show:E}),(e,o)=>{const a=y("DxButton"),i=y("DxCheckBox"),F=y("DxScrollView");return f(),$(H,null,[s(G,{ref_key:"popupRef",ref:l,title:e.$t("admin.users.deletedUsers"),class:"confirm-user-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:A}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>l.value.hide()}}],onShown:z,onHidden:O},{default:c(()=>[s(F,null,{default:c(()=>[s(Z(Q),{ref:"accordion",collapsible:!0,items:[{title:e.$t("components.confirmUser.step1"),template:"step1Template"},{title:e.$t("components.confirmUser.step2"),template:"step2Template"}]},{step1Template:c(()=>[n("div",Y,[s(a,{text:e.$t("buttons.download"),icon:"download",type:"default","styling-mode":"contained",onClick:o[0]||(o[0]=()=>e.$refs.pdfRef.download({component:"ContractPdf",user:t.user,isPreview:t.formData.isPdfPreview}))},null,8,["text"]),e.$screen.getScreenSizeInfo.isXSmall?v("",!0):(f(),h(i,{key:0,modelValue:t.formData.isPdfPreview,"onUpdate:modelValue":o[1]||(o[1]=r=>t.formData.isPdfPreview=r),text:e.$t("components.confirmUser.preview")},null,8,["modelValue","text"]))])]),step2Template:c(()=>[n("form",{onSubmit:J(M,["prevent"])},[n("button",{ref_key:"submitRef",ref:w,class:"display-none"},null,512),(f(),$("div",{class:"upload",key:t.refreshKey},[n("div",te,[n("input",{ref_key:"contractImageRef",ref:d,type:"file",id:"contractImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",oe,[ae,x(" "+P(e.$t("components.confirmUser.chooseContractImage")),1)]),s(i,{id:"contractDelete",modelValue:t.formData.isContractDelete,"onUpdate:modelValue":o[2]||(o[2]=r=>t.formData.isContractDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),n("div",ne,[n("input",{ref_key:"identityImageRef",ref:u,type:"file",id:"identityImage",multiple:"multiple",accept:"images/*",onChange:b},null,544),n("label",se,[le,x(" "+P(e.$t("components.confirmUser.chooseIdentityImage")),1)]),s(i,{id:"identityDelete",modelValue:t.formData.isIdentityDelete,"onUpdate:modelValue":o[3]||(o[3]=r=>t.formData.isIdentityDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:U},null,8,["modelValue","text"])]),C.value.length?(f(),h(q,{key:0,images:C.value},null,8,["images"])):v("",!0)]))],40,ee)]),_:1},8,["items"])]),_:1})]),_:1},8,["title","toolbarItems"]),e.$mf.isSet(t.user)?(f(),h(W,{key:0,ref:"pdfRef"},null,512)):v("",!0)],64)}}};export{de as default};
