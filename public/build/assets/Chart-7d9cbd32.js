import{A as pi,B as di,C as ui,l as fe,u as fi,r as D,a as mi,c as z,y as vi,E as hi,w as we,x as b,b as gi,d as m,G as M,t as ze,H as J,I as yi,J as K,e as ke,K as xi,h as Si,j as Ti,k as Fe,z as Je,L as Ci,o as wi}from"./app-4c1838d5.js";import ki from"./LineContext-de9ada87.js";import Fi from"./ScanContext-a3cd91fd.js";import Di from"./ProgressContext-4a68ebf0.js";import{c as bi}from"./lightweight-charts.esm.development-03366bac.js";import{g as L}from"./getUnixTime-94d169c1.js";import"./text-box-b626dd9b.js";function Li(H,j,O){return pi((O==null?void 0:O.in)||H,+di(H)+j)}function De(H,j,O){return Li(H,j*ui,O)}const Oi=["title"],Ri=["title"],Ei=["title"],Ai=["title"],Pi=["title"],_i=["title"],Bi=["title"],Ii=["title"],Vi=["title"],Mi=m("i",{class:"far fa-heart-rate"},null,-1),Wi=[Mi],Zi=["title"],$i=m("i",{class:"far fa-pipe"},null,-1),Yi=[$i],Ni=["title"],Xi=m("i",{class:"far fa-horizontal-rule"},null,-1),zi=["title"],Ji=m("i",{class:"far fa-grip-lines-vertical"},null,-1),Hi=[Ji],ji=["title"],qi=m("i",{class:"far fa-line-height"},null,-1),Qi=[qi],Ui=["title"],Gi=["src"],He=3,je=2,Ki="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",pr={__name:"Chart",setup(H){const j={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},O=fe(new Date,"yyyy-MM-dd"),R={START:L(new Date(`${O}T08:45:00Z`)),ATO:L(new Date(`${O}T09:00:00Z`)),ATC:L(new Date(`${O}T14:30:00Z`)),END:L(new Date(`${O}T14:45:00Z`))},u=Si(),be=Ti(),{t:h}=fi(),qe=Fe("devices"),f=Fe("mf"),ee=Fe("filters"),V=D(null),Le=D(null),Qe=D(null),Ue=D(null),Ge=D(null),Ke=D(null),et=D(null),te=D(null),me=D(null),ve=D(null),he=D(null),ie=D(null),ge=D(null),tt=D(null),Z=D(null),q=D(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{pattern:{}},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:L(De(new Date,7)),alertAudio:null};X();const c=mi({chartDate:be.query.date??O,clock:fe(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,lineColor:"#F44336",lineTitle:"",progress:{},scanSide:"left",showProgressContext:!1,showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),E=z(()=>u.state.tradingDerivative.status),B=z(()=>u.state.tradingDerivative.config),Oe=z(()=>u.state.tradingDerivative.tools),it=z(()=>u.state.tradingDerivative.isChartLoading),rt=z(()=>E.value.position!=0||!!E.value.pending||!!Oe.value.order),st=z(()=>`https://chart.vps.com.vn/tv/?u=${B.value.vpsUser}&s=${B.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);ii(),e.interval=setInterval(ht,1e3),e.interval60=setInterval(()=>{W()?($e(),B.value.autoRefresh&&se(!0)):clearInterval(e.interval60)},6e4),vi(()=>{e.chart=bi(Le.value,j),e.chart.subscribeCrosshairMove(at),e.chart.subscribeCustomPriceLineDragged(lt),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(ct).observe(V.value),document.addEventListener("keydown",Ae),document.addEventListener("fullscreenchange",Pe)}),hi(()=>{e.chart&&(e.chart.remove(),e.chart=null),document.removeEventListener("keydown",Ae),document.removeEventListener("fullscreenchange",Pe),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),we(()=>u.state.tradingDerivative.chartData,dt),we(Oe,ut),we(()=>c.progress,ft);function ot(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1,le(!1),te.value.classList.contains("selected")?Yt():he.value.classList.contains("selected")?Jt():ie.value.classList.contains("selected")?Mt():ge.value.classList.contains("selected")?kt():me.value.classList.contains("selected")?Rt():ve.value.classList.contains("selected")&&Bt()}function nt(t){le(!0),t.preventDefault()}function Re(t){t.stopPropagation()}function Ee(t){t.preventDefault(),t.stopPropagation()}function at(t){if(t.time){let r=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=r}else qe.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function lt(t){let r=t.customPriceLine,i=r.options();i.price=parseFloat(i.price.toFixed(1));const s=+t.fromPriceString,a=i.price;switch(i.lineType){case"order":if(a!=s){let n=!1;i.kind=="entry"?E.value.position||(n=!0,e.tools.order[i.kind].price=a,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(l=>{l.isOk?($([i.kind]),b.success(h("trading.derivative.changeEntrySuccess"))):(r.applyOptions({price:s}),A(l.message))})):(n=!0,e.tools.order[i.kind].price=a,i.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(l=>{l.isOk?($([i.kind]),b.success(h("trading.derivative.changeTpSuccess"))):(r.applyOptions({price:s}),A(l.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(l=>{l.isOk?($([i.kind]),b.success(h("trading.derivative.changeSlSuccess"))):(r.applyOptions({price:s}),A(l.message))})),n||(r.applyOptions({price:s}),b.show(h("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:s});const o=i.color,p=i.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[a],data:[{color:o,title:p}]}),te.value.classList.remove("selected");break;case"target":if(f.isSet(e.tools.target.B)){let n={isRemove:!1,name:"target",points:[],data:[]},l,d,v=+e.tools.target.A.options().price,y=+e.tools.target.B.options().price,g=y-v;if(l="A",i.point=="A")g=+e.tools.target.B.options().title,y=v+g;else if(i.point!="B"){let T=0;switch(i.point){case"X":T=1.5;break;case"Y":T=2;break;case"Z":T=3;break;case"W":T=5;break}g=parseFloat(((y-a)/T).toFixed(1)),v=y-g,d={price:v},e.tools.target[l].applyOptions(d)}n.points.push(l),n.data.push(v),l="B",d={price:y,title:g.toFixed(1)},i.point==l&&delete d.price,e.tools.target[l].applyOptions(d),n.points.push(l),n.data.push(y),l="X",d={price:parseFloat((v-.5*g).toFixed(1)),title:(-.5*g).toFixed(1)},i.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="Y",d={price:parseFloat((v-g).toFixed(1)),title:(-g).toFixed(1)},i.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="Z",d={price:parseFloat((v-2*g).toFixed(1)),title:(-2*g).toFixed(1)},i.point==l&&delete d.price,e.tools.target[l].applyOptions(d),l="W",d={price:parseFloat((v-4*g).toFixed(1)),title:(-4*g).toFixed(1)},i.point==l&&delete d.price,e.tools.target[l].applyOptions(d),u.dispatch("tradingDerivative/drawTools",n)}break;case"pattern":if(f.isSet(e.tools.pattern.lines.B)){let n,l;e.tools.pattern.points={A:{time:e.tools.pattern.points.A.time,price:+e.tools.pattern.lines.A.options().price},B:{price:+e.tools.pattern.lines.B.options().price},C:{price:+e.tools.pattern.lines.C.options().price}},N();const{progress:d,timeMark:v,info:{rEpr1:y,rEpr2:g,rEpr3:T,entry:F,pStatus:C,x:P,X:x,y:_,Y:w}}=oe();ae(d),ne(v),n="A",l={title:`A ${y}`},e.tools.pattern.lines[n].applyOptions(l),n="B",l={title:`B ${g}`},e.tools.pattern.lines[n].applyOptions(l),n="C",l={title:`C ${T}`},e.tools.pattern.lines[n].applyOptions(l),n="D",l={price:F,title:"Entry "+C},i.point==n&&delete l.price,e.tools.pattern.lines[n].applyOptions(l),n="X",l={price:parseFloat(P.toFixed(1)),title:"X "+parseFloat(x.toFixed(1))},e.tools.pattern.lines[n].applyOptions(l),n="Y",l={price:parseFloat(_.toFixed(1)),title:"Y "+parseFloat(w.toFixed(1))},e.tools.pattern.lines[n].applyOptions(l)}break}}function ct(){V.value&&(e.chart.resize(V.value.offsetWidth,V.value.offsetHeight),V.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ae(t){if(t.ctrlKey)switch(t.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(t.altKey)switch(t.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function Pe(){V.value&&(document.fullscreenElement?(c.isFullscreen=!0,V.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(c.isFullscreen=!1,V.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function pt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function dt(t){c.chartDate==O&&W()||(t.price.length>0&&(e.data.whitespace=re(e.data.whitespace,Be(c.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=re(e.data.price,t.price),e.series.price.setData(e.data.price))}function _e(t){let r=[];t.forEach(i=>{const s=L(De(new Date(i.date),7));r.push({time:s,value:i.price})}),r.length>1?(e.data.price=re(e.data.price,r),e.series.price.setData(e.data.price)):(e.data.price.push(r[0]),e.series.price.update(r[0]))}function Be(t){const r=L(new Date(`${t}T09:00:00Z`)),i=L(new Date(`${t}T11:30:00Z`)),s=L(new Date(`${t}T13:00:00Z`)),a=L(new Date(`${t}T14:30:00Z`)),o=L(new Date(`${t}T14:00:00Z`));let p=[];for(let n=r;n<=a;n++){if(n>i&&n<s)continue;let l={time:n};(n==o||n==a)&&(l.value=1),p.push(l)}return p}function re(t,r){return Array.from(new Map([...t,...r].sort((i,s)=>i.time-s.time).map(i=>[i.time,i])).values())}function ut(t){jt(),Object.entries(t).forEach(([r,i])=>{switch(r){case"order":gt(i);break;case"pattern":Et(i)&&(e.tools.pattern.points=f.cloneDeep(i),xe());break;case"tr":Wt(i);break;case"0_pt":Ve(i[0]);break;case"line":Nt(i);break;case"target":Ht(i);break}})}function ft(t,r){if(B.value.autoRefresh&&(t.step>r.step||t.step==r.step&&t.result>r.result)){let i="";t.result?[2,4,5].includes(t.step)?i=h("trading.derivative.progressOrder",t):i=h("trading.derivative.progressSuccess",t):i=h("trading.derivative.progressFail",t),mt(i)}}function mt(t){const r=new SpeechSynthesisUtterance(t);r.lang="vi-VN",speechSynthesis.speak(r)}function ye(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(Ki),e.websocket.onopen=t=>{let r='{"protocol":"json","version":1}';e.websocket.send(r),r='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(r),e.socketSendData=r},e.websocket.onclose=t=>{!e.socketStop&&W()&&(c.isSocketWarning=!0,ye())},e.websocket.onmessage=t=>{c.isSocketWarning=!1,vt(t.data).forEach(i=>{if(!i)return!1;i.type==3?(pe(),e.data.whitespace=re(e.data.whitespace,Be(O)),e.series.whitespace.setData(e.data.whitespace),_e(i.result),u.dispatch("tradingDerivative/setChartLoading",!1)):i.type==1&&i.target=="UpdateTrades"&&i.arguments[0]=="VN30F1M"&&(Gt(i.arguments[1].at(-1).price),_e(i.arguments[1]))})}}function vt(t){let r=[];return t.split("").forEach(i=>{const s=i.indexOf("{"),a=i.lastIndexOf("}");let o=null;if(s!==-1&&a!==-1&&a>s){const p=i.substring(s,a+1);p!="{}"&&(o=JSON.parse(p))}r.push(o)}),r}function ht(){e.currentSeconds=L(De(new Date,7)),W()&&(E.value.position&&e.currentSeconds>R.ATC-5*60&&(c.isOrderWarning=!0,e.currentSeconds>R.ATC-15&&f.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(t=>{t.isOk?(Y(["entry","tp","sl"]),b.success(h("trading.derivative.autoCancelTpSlSuccess"))):A(t.message)})),B.value.openingMarket&&e.currentSeconds==R.START&&ye()),c.clock=fe(new Date,"HH:mm:ss")}function $(t){const r="order";let i={isRemove:!1,name:r,points:[],data:[]},s,a;t.forEach(o=>{switch(o){case"entry":s="yellow",a=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":s="lime",a=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":s="red",a=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(i.points.push(o),f.isSet(e.tools.order[o].line))e.tools.order[o].line.applyOptions({price:e.tools.order[o].price,title:a}),i.data.push(e.tools.order[o].line.options());else{const p={lineType:r,kind:o,side:e.tools.order.side,price:e.tools.order[o].price,color:s,lineWidth:1,lineStyle:0,title:a,draggable:!0};e.tools.order[o].line=e.series.price.createPriceLine(p),i.data.push(p)}}),u.dispatch("tradingDerivative/drawTools",i)}function gt(t){Object.entries(t).forEach(([r,i])=>{e.tools.order.side=i.side,e.tools.order[r].price=i.price,e.tools.order[r].line=e.series.price.createPriceLine(i)})}function Y(t,r=!0){r&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),t.forEach(i=>{f.isSet(e.tools.order[i].line)&&(e.series.price.removePriceLine(e.tools.order[i].line),delete e.tools.order[i].line)})}function yt(t){c.showTradingView=!c.showTradingView,t.stopPropagation()}function xt(){c.showProgressContext=!c.showProgressContext,c.showScanContext=!1,c.showLineContext=!1,c.showProgressContext&&se()}function St(){Tt()}function Tt(t){const r=t??!B.value.autoRefresh;u.dispatch("tradingDerivative/setAutoRefresh",r)}function Ct(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||(N(!0),U(),Q(),t.target.classList.add("selected"))}function wt(){c.showScanContext=!c.showScanContext,c.showProgressContext=!1,c.showLineContext=!1}function kt(){const t=c.scanSide=="left",r=e.crosshair.time?e.data.price.filter(s=>!S(s.time,t,e.crosshair.time)):e.data.price;let i=t?Ft(r):Dt(r);f.isSet(i)&&(e.tools.pattern.points=bt(i),N(),U(),Q(),xe()),ge.value.classList.remove("selected")}function Ft(t){let r,[i,s,a,o]=Array(4).fill({});for(let p=t.length-1;p>=0;p--){const n=t[p].value,l=t[p].time,d=I(l);if(d==-1)break;if(p==t.length-1&&(a={index:d,time:l,price:n},[s,i,o]=Array(3).fill(null).map(()=>f.cloneDeep(a))),r==null){if(n==a.price)continue;r=n>a.price}if(S(n,r,s.price)&&(S(i.price,!r,a.price)?([a,s]=[s,i].map(v=>f.cloneDeep(v)),i={index:d,time:l,price:n},o=f.cloneDeep(i),r=!r):s={index:d,time:l,price:n}),S(n,!r,i.price)?(i={index:d,time:l,price:n},o=f.cloneDeep(i)):o.index=d,S(n,r,o.price)&&(o={index:d,time:l,price:n}),a.index>i.index){const v=Math.abs(s.price-a.price);if(v>=1.5&&(i.index-o.index>a.index-s.index||Math.abs(i.price-o.price)>v))break}}return{A:i,B:s,C:a}}function Dt(t){let r,[i,s,a]=Array(3).fill({});for(let o=0;o<t.length;o++){const p=t[o].value,n=t[o].time,l=I(n);if(l==-1)break;if(o==0&&(i={index:l,time:n,price:p},s=f.cloneDeep(i),a=f.cloneDeep(i)),r==null){if(p==i.price)continue;r=p>i.price}S(p,r,s.price)&&(s={index:l,time:n,price:p},a=f.cloneDeep(s)),S(s.price,r,i.price)&&S(p,!r,a.price)&&(S(p,r,i.price)?a={index:l,time:n,price:p}:(i=f.cloneDeep(s),s={index:l,time:n,price:p},a=f.cloneDeep(s),r=!r))}return{A:i,B:s,C:a}}function bt(t){const r={};return Object.entries(t).forEach(([i,s])=>{const{index:a,...o}=s;r[i]=o}),r}function Lt(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||(U(),t.target.classList.add("selected"))}function Ot(t){t.target.classList.remove("selected"),N(!0),U(),Q()}function Rt(){const t="pattern",r=ce(e.crosshair.y),i=e.crosshair.time;let s={lineType:t,price:r,lineWidth:1,lineStyle:1,draggable:!0};if(f.isSet(e.tools.pattern.lines.A))if(f.isSet(e.tools.pattern.lines.B)){let a,o;if(f.isSet(e.tools.pattern.lines.C)){let p,n;e.tools.pattern.points.A={time:i,price:r};const{progress:l,timeMark:d,info:{rEpr1:v,rEpr2:y,rEpr3:g,entry:T,pStatus:F,x:C,X:P,y:x,Y:_}}=oe();o=l,a=d,p="A",n={price:r,title:`A ${v}`},e.tools.pattern.lines[p].applyOptions(n),p="B",n={title:`B ${y}`},e.tools.pattern.lines[p].applyOptions(n),p="C",n={title:`C ${g}`},e.tools.pattern.lines[p].applyOptions(n),p="D",n={price:T,title:"Entry "+F},e.tools.pattern.lines[p].applyOptions(n),p="X",n={price:parseFloat(C.toFixed(1)),title:"X "+parseFloat(P.toFixed(1))},e.tools.pattern.lines[p].applyOptions(n),p="Y",n={price:parseFloat(x.toFixed(1)),title:"Y "+parseFloat(_.toFixed(1))},e.tools.pattern.lines[p].applyOptions(n)}else{e.tools.pattern.points.C={price:r};const{progress:p,timeMark:n,info:{rEpr1:l,rEpr2:d,rEpr3:v,entry:y,pStatus:g,x:T,X:F,y:C,Y:P}}=oe();o=p,a=n;let x="A";e.tools.pattern.lines[x].applyOptions({title:`A ${l}`}),x="B",e.tools.pattern.lines[x].applyOptions({title:`B ${d}`}),s.point="C",s.title=`C ${v}`,s.color="#FFEB3B",e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s),s.point="D",s.price=y,s.title="Entry "+g,s.color="#9C27B0",s.draggable=!1,e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s),s.point="Y",s.price=parseFloat(C.toFixed(1)),s.title="Y "+parseFloat(P.toFixed(1)),s.color="#E91E63",s.draggable=!1,e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s),s.point="X",s.price=parseFloat(T.toFixed(1)),s.title="X "+parseFloat(F.toFixed(1)),s.color="#2196F3",s.draggable=!1,e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s)}ae(o),ne(a),me.value.classList.remove("selected")}else s.point="B",s.title="B 0",s.color="#4CAF50",e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s),e.tools.pattern.points.B={price:r};else s.point="A",s.title="A 0",s.color="#F44336",e.tools.pattern.lines[s.point]=e.series.price.createPriceLine(s),e.tools.pattern.points={A:{time:i,price:r}};N()}function xe(){let r={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{A:i,B:s,C:a}=e.tools.pattern.points,{progress:o,timeMark:p,info:{rEpr1:n,rEpr2:l,rEpr3:d,entry:v,pStatus:y,x:g,X:T,y:F,Y:C}}=oe();ae(o),ne(p),r.point="A",r.title=`A ${n}`,r.color="#F44336",r.price=i.price,e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r),r.point="B",r.title=`B ${l}`,r.color="#4CAF50",r.price=s.price,e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r),r.point="C",r.price=a.price,r.title=`C ${d}`,r.color="#FFEB3B",e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r),r.point="D",r.price=v,r.title="Entry "+y,r.color="#9C27B0",r.draggable=!1,e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r),r.point="Y",r.price=parseFloat(F.toFixed(1)),r.title="Y "+parseFloat(C.toFixed(1)),r.color="#E91E63",r.draggable=!1,e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r),r.point="X",r.price=parseFloat(g.toFixed(1)),r.title="X "+parseFloat(T.toFixed(1)),r.color="#2196F3",r.draggable=!1,e.tools.pattern.lines[r.point]=e.series.price.createPriceLine(r)}function se(t=!1){f.isSet(e.tools.pattern.lines.C)&&(t&&At(),Q(),xe())}function Et({A:{time:t}}){return e.data.whitespace.some(r=>r.time===t)}function oe(){const{A:t,B:r,C:i}=e.tools.pattern.points,s=r.price-i.price,a=s>0,o=Se({phase:1,start:t,end:r,retracementPrice:i.price});let p=Se({phase:2,start:o.R,end:i});const n=Se({phase:3,start:p.R,end:{price:r.price+(a?1:-1)*o.rEp},breakPrices:[p.S1.price,r.price]});o.xBox.tr>=p.tr&&(p.tr=o.xBox.tr),console.log("calculatePattern",[o,p,n]);const l=Math.abs(s)>=o.pr,d=Math.abs(i.price-n.xBox.R.price)>=p.pr,v=n.xBox.pr>=n.pr,y=!S(i.price,!a,o.S1.price),g=!S(n.xBox.R.price,a,p.S1.price),T=!S(n.xBox.S.price,!a,n.S1.price),F=o.R.index+o.tr,C=p.R.index+p.tr,P=n.xBox.R.index+n.tr,x=n.xBox.R.index+p.tr,_=[F,C,P,x],w=n.xBox.S.index;let G,k={};const Ye=[p.R.index>F,o.rEpr<3,p.rEpr<o.rEpr];k.steps=[[o.rEp>=1,l||o.rEt<o.tr&&o.rEp>=o.sEp,y,!n.breakIndexs[1]||F<n.breakIndexs[1],w>F],[...Ye,C>F,w<C],[d,w>C],[v,T,w>P,Ye.every(Boolean)||w>x]],k.step=1,k.result=k.steps[0].every(Boolean),G=o.R1.price,k.result&&(w<=C?(k.step=2,k.result=k.steps[1].every(Boolean),G=p.S1.price):(k.step=3,k.result=k.steps[2].every(Boolean),G=n.R1.price,k.result&&(k.step=4,k.result=k.steps[3].every(Boolean),k.result&&(G=n.xBox.R.price))));const si=`${y?l?1:0:2}${g?d?1:0:2}${T?v?1:0:2}`,oi=parseFloat(o.rEpr.toFixed(1)),ni=parseFloat(p.rEpr.toFixed(1)),ai=parseFloat(n.rEpr.toFixed(1)),ue=o.rEp,li=Ie(r.price,ue,a),Ne=parseInt((n.breakIndexs[1]-o.R.index)/o.tr),Xe=Ne>1?ue*Ne:ue,ci=Ie(r.price,Xe,a);return{progress:k,timeMark:_,info:{rEpr1:oi,rEpr2:ni,rEpr3:ai,entry:G,pStatus:si,x:li,X:ue,y:ci,Y:Xe}}}function Se({phase:t,start:r,end:i,breakPrices:s,retracementPrice:a}){let o=f.cloneDeep(r),p=f.cloneDeep(i);const n=p.price>o.price;let l={},d={},v={},y=[null,null],g,T,F;return e.data.price.filter(C=>{let P=C.time>=o.time;return e.tools.pickTime&&(P&=C.time<=e.tools.pickTime),P}).every((C,P)=>{const x=C.value,_=C.time,w=I(_);return w==-1?!1:((P==0||x==o.price)&&(l={R:{index:w,time:_,price:x},S:{index:w,time:_,price:x},pr:0,tr:0},d=f.cloneDeep(l),v=f.cloneDeep(l)),S(x,n,l.R.price)?(l.tr>=d.tr&&l.pr>=d.pr&&(d=f.cloneDeep(l)),t==1&&a&&!S(l.S.price,!n,a)&&l.tr>=v.tr&&l.pr>=v.pr&&(v=f.cloneDeep(l)),l={R:{index:w,time:_,price:x},S:{index:w,time:_,price:x},pr:0,tr:0},t==3&&s&&(!y[0]&&S(x,n,s[0])&&(y[0]=w),!y[1]&&S(x,n,s[1])&&(y[1]=w))):(l.S.index=w,l.tr=l.S.index-l.R.index,S(x,!n,l.S.price)&&(l.S.time=_,l.S.price=x,l.pr=Math.abs(l.S.price-l.R.price))),S(x,!n,o.price)?(l.S.price=o.price,!1):!!S(x,!n,p.price))}),f.isSet(l)&&(o.index=I(o.time),p.index=l.S.index,p.time=de(l.S.index),g=Math.abs(p.price-d.R.price),T=Math.abs(o.price-d.S.price),F=p.index-d.S.index,t==3&&(v=l)),{tr:d.tr,pr:d.pr,rEp:g,sEp:T,rEpr:d.pr?g/d.pr:0,rEt:F,S1:d.S,R1:d.R,xBox:v,S:o,R:p,breakIndexs:y}}function Ie(t,r,i){const s=t+(i?1:-1)*r;let a=parseFloat((s%1).toFixed(1));if(i){if(a>=.1&&a<=.2)return Math.floor(s);if(a>=.6&&a<=.7)return Math.floor(s)+.5}else{if(a>=.8&&a<=.9)return Math.ceil(s);if(a>=.3&&a<=.4)return Math.floor(s)+.5}return s}function At(){if(!e.tools.pickTime)return!1;let t=e.tools.pattern.points;const r=t.B.price-t.A.price>0,i=e.data.price.at(-1).value;if(S(i,!r,t.C.price)){let s=i;for(let a=e.data.price.length-1;a>=0;a--){const o=e.data.price[a].value;if(o==t.B.price)break;s=r?Math.min(s,o):Math.max(s,o)}t.C.price=s,e.tools.pattern.points=t,N()}}function N(t=!1){let r={isRemove:t,name:"pattern",points:[],data:[]};t?e.tools.pattern.points={}:Object.entries(e.tools.pattern.points).forEach(([i,s])=>{r.points.push(i),r.data.push(s)}),u.dispatch("tradingDerivative/drawTools",r)}function Q(){f.isSet(e.tools.pattern.lines.A)&&(e.series.price.removePriceLine(e.tools.pattern.lines.A),f.isSet(e.tools.pattern.lines.B)&&(e.series.price.removePriceLine(e.tools.pattern.lines.B),f.isSet(e.tools.pattern.lines.C)&&(e.series.price.removePriceLine(e.tools.pattern.lines.C),e.series.price.removePriceLine(e.tools.pattern.lines.D),e.series.price.removePriceLine(e.tools.pattern.lines.X),e.series.price.removePriceLine(e.tools.pattern.lines.Y)))),X(["pattern"]),ne([]),ae({})}function ne(t){const r=["#F44336","#4CAF50","#FFEB3B","#2196F3"];let i=[];for(let s=0;s<t.length;s++){let a=de(t[s]);a&&(t.indexOf(t[s])!=t.lastIndexOf(t[s])&&(a+=s),i.push({time:a,value:1,color:r[s]}))}i.length&&i.sort((s,a)=>s.time-a.time),e.series.timeMark.setData(i)}function ae(t){c.progress=t}function Pt(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function _t(t){t.target.classList.remove("selected"),U(),se()}function Bt(){const t=e.crosshair.time;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"0_pt",points:[0],data:[t]}),Ve(t),se(),ve.value.classList.remove("selected")}function Ve(t){e.tools.pickTime=t,e.series.pickTime.setData([{time:t,value:1,color:"#9C27B0"}])}function U(t=!0){t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"0_pt"}),e.series.pickTime.setData([]),X(["pt"])}function It(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function Vt(t){Me(),t.target.classList.remove("selected")}function Mt(){let t={isRemove:!1,name:"tr",points:[],data:[]};const r=e.crosshair.time;let i={time:r,value:1};switch(e.tools.timeRange.length){case 0:i.color="OrangeRed",e.tools.timeRange[0]=i,t.points.push(0),t.data.push(r);break;case 1:i.color="lime",e.tools.timeRange[1]=i,t.points.push(1),t.data.push(r),ie.value.classList.remove("selected");break;default:const s=I(e.tools.timeRange[0].time),a=I(e.tools.timeRange[1].time),p=I(r)+(a-s),n=de(p);i.color="OrangeRed",e.tools.timeRange[0]=f.cloneDeep(i),t.points.push(0),t.data.push(r),i.time=n,i.color="lime",e.tools.timeRange[1]=i,t.points.push(1),t.data.push(n),ie.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",t)}function Wt(t){let r,i;if(t.length==2)r=t[0],i=t[1];else if(t.length==3){const a=I(t[0]),o=I(t[1]),n=I(t[2])+(o-a);r=t[2],i=de(n)}else return!1;let s=[{time:r,value:1,color:"OrangeRed"},{time:i,value:1,color:"lime"}];e.tools.timeRange=s,e.series.timeRange.setData(s)}function Me(t=!0){t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),e.series.timeRange.setData([]),X(["tr"])}function Zt(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected")}function $t(t){c.showLineContext=!c.showLineContext,c.showProgressContext=!1,c.showScanContext=!1}function Yt(){const t="line",r=ce(e.crosshair.y),i=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(s=>{const a=s.options(),o=a.type=r==+a.price;return o&&(e.series.price.removePriceLine(s),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:t,point:r})),!o}),e.tools.lines.length==i){const s=c.lineColor,a=c.lineTitle,o={lineType:t,price:r,color:s,title:a,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(o)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:t,points:[r],data:[{color:s,title:a}]})}te.value.classList.remove("selected")}function Nt(t){const i={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(t).forEach(([s,{color:a,title:o}])=>{i.price=+s,i.color=a,i.title=o,e.tools.lines.push(e.series.price.createPriceLine(i))})}function We(t=!0){e.tools.lines.length>0&&(t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(r=>e.series.price.removePriceLine(r)),X(["lines"]))}function Xt(t){c.showProgressContext=!1,c.showScanContext=!1,c.showLineContext=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Te())}function zt(t){Te(),t.target.classList.remove("selected")}function Jt(){const t="target",r=ce(e.crosshair.y);let i={lineType:t,price:r,lineWidth:1,lineStyle:1,draggable:!0},s={isRemove:!1,name:t,points:[],data:[r]};if(f.isSet(e.tools.target.A)){const a=+e.tools.target.A.options().price,o=r-a;i.point="B",i.title=parseFloat(o.toFixed(1)),i.color="#F44336",e.tools.target[i.point]=e.series.price.createPriceLine(i),s.points.push(i.point),i.point="X",i.price=parseFloat((a-.5*o).toFixed(1)),i.title=parseFloat((-.5*o).toFixed(1)),i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Y",i.price=parseFloat((a-o).toFixed(1)),i.title=parseFloat(-o.toFixed(1)),i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Z",i.price=parseFloat((a-2*o).toFixed(1)),i.title=parseFloat((-2*o).toFixed(1)),i.color="#9C27B0",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="W",i.price=parseFloat((a-4*o).toFixed(1)),i.title=parseFloat((-4*o).toFixed(1)),i.color="#E91E63",e.tools.target[i.point]=e.series.price.createPriceLine(i),he.value.classList.remove("selected")}else i.point="A",i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),s.points.push(i.point);u.dispatch("tradingDerivative/drawTools",s)}function Ht(t){let i={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const s=t.A,a=t.B,o=a-s;i.point="A",i.price=s,i.title="0",i.color="#FF9800",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="B",i.price=a,i.title=parseFloat(o.toFixed(1)),i.color="#F44336",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="X",i.price=parseFloat((s-.5*o).toFixed(1)),i.title=parseFloat((-.5*o).toFixed(1)),i.color="#2196F3",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Y",i.price=parseFloat((s-o).toFixed(1)),i.title=parseFloat(-o.toFixed(1)),i.color="#673AB7",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="Z",i.price=parseFloat((s-2*o).toFixed(1)),i.title=parseFloat((-2*o).toFixed(1)),i.color="#9C27B0",e.tools.target[i.point]=e.series.price.createPriceLine(i),i.point="W",i.price=parseFloat((s-4*o).toFixed(1)),i.title=parseFloat((-4*o).toFixed(1)),i.color="#E91E63",e.tools.target[i.point]=e.series.price.createPriceLine(i)}function Te(t=!0){t&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),f.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),f.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z),e.series.price.removePriceLine(e.tools.target.W))),X(["target"])}function jt(){Y(["entry","tp","sl"],!1),We(!1),Te(!1),Me(!1),Q()}function le(t){if(t){if(W()&&(f.isSet(e.tools.order.tp.line)||E.value.position&&e.currentSeconds>R.ATO&&e.currentSeconds<R.ATC&&(q.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",q.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",q.value.style.display="block"),!f.isSet(e.tools.order.entry.line))){let r=null,i=0;E.value.position?(e.currentSeconds<R.ATO?r="ATO":e.currentSeconds>R.ATC&&(r="ATC"),r&&(e.tools.order.entry.price=r,i=-E.value.position)):e.currentSeconds>R.ATO&&e.currentSeconds<R.ATC&&(r=ce(e.crosshair.y),i=r>=e.data.price.at(-1).value?1:-1,e.tools.order.side=i,e.tools.order.entry.price=r),i&&(Z.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",Z.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",Z.value.style.background=i>0?"green":"red",Z.value.innerText=`${i>0?"LONG":"SHORT"} ${r}`,Z.value.style.display="block")}}else Z.value.style.display="none",q.value.style.display="none"}function qt(){W()&&(e.currentSeconds<R.ATO?Je(h("trading.derivative.atoOrder"),h("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(i=>{i.isOk?b.success(h("trading.derivative.atoOrderSuccess")):A(i.message)})}):e.currentSeconds<R.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(t=>{t.isOk?($(["entry"]),b.success(h("trading.derivative.newEntrySuccess"))):A(t.message)}):Je(h("trading.derivative.atcOrder"),h("titles.confirm")).then(r=>{r&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(i=>{i.isOk?b.success(h("trading.derivative.atcOrderSuccess")):A(i.message)})}))}function Qt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*He,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*je,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(t=>{t.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),$(["entry","tp","sl"]),b.success(h("trading.derivative.newTpSlSuccess"))):A(t.message)})}function Ut(){f.isSet(e.tools.order.entry.line)?f.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(Y(["entry","tp","sl"]),b.success(h("trading.derivative.exitSuccess"))):A(t.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(t=>{t.isOk?(Y(["entry"]),b.success(h("trading.derivative.deleteEntrySuccess"))):A(t.message)}):pe()}function Gt(t){f.isSet(e.tools.order.entry.line)&&(f.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&t>=e.tools.order.tp.price||e.tools.order.side<0&&t<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(r=>{r.isOk?(Y(["entry","tp","sl"]),b.success(h("trading.derivative.deleteTpSuccess")),le(!1)):A(r.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&t<=e.tools.order.sl.price||e.tools.order.side<0&&t>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(r=>{r.isOk?(Y(["entry","tp","sl"]),b.success(h("trading.derivative.deleteSlSuccess")),le(!1)):A(r.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&t>=e.tools.order.entry.price||e.tools.order.side<0&&t<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*He,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*je,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(r=>{r.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),$(["entry","tp","sl"]),b.success(h("trading.derivative.autoNewTpSlSuccess"))):A(r.message),e.isAutoOrdering=!1})},1e3))))}function Kt(){e.chart.timeScale().scrollToRealTime()}function W(){return B.value.openingMarket&&e.currentSeconds>=R.START&&e.currentSeconds<=R.END}function ce(t){return parseFloat(e.series.price.coordinateToPrice(t).toFixed(1))}function A(t){t||(t="unknown"),b.error(h(`trading.derivative.${t}`))}function ei(){if(!c.chartDate)return!1;Ce()}function Ze(){W()&&e.websocket.send(e.socketSendData)}function ti(){e.data.whitespace=[],e.data.price=[],Ze(),Ce()}function ii(){u.dispatch("tradingDerivative/initChart").then(()=>{W()&&ye(),!be.query.date&&B.value.lastOpeningDate&&(c.chartDate=B.value.lastOpeningDate),Ce()})}function Ce(){u.dispatch("tradingDerivative/getChartData",c.chartDate).then(t=>{t&&pe()})}function $e(){u.dispatch("tradingDerivative/getStatus")}function pe(){u.dispatch("tradingDerivative/getTools")}function X(t){t||(t=["order","lines","tr","pattern","target","pt"]),t.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),t.includes("lines")&&(e.tools.lines=[]),t.includes("target")&&(e.tools.target={}),t.includes("tr")&&(e.tools.timeRange=[]),t.includes("pattern")&&(e.tools.pattern.lines={}),t.includes("pt")&&(e.tools.pickTime=null)}function ri(){u.dispatch("tradingDerivative/getAccountInfo").then(t=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.nav")}</div><div>: ${ee.currency(t.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.maxVol")}</div><div>: ${ee.numberVnFormat(t.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.vm")}</div><div>: ${ee.currency(t.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.fee")}</div><div>: ${ee.currency(t.fee)}</div></div>`,r+="</div>",Ci(r,h("trading.derivative.accountInfo"))})}function S(t,r,i,s=!1){return r?s?t>=i:t>i:s?t<=i:t<i}function I(t){let r=e.data.whitespace.findIndex(i=>i.time==t);if(r==-1){const i=fe(new Date(t*1e3),"yyyy-MM-dd"),s=L(new Date(`${i}T11:30:00Z`)),a=L(new Date(`${i}T13:00:00Z`)),o=L(new Date(`${i}T14:30:00Z`));t>s&&t<a?t=s:t>o&&(t=o),r=e.data.whitespace.findIndex(p=>p.time==t)}return r}function de(t){return t<e.data.whitespace.length?e.data.whitespace[t].time:!1}return(t,r)=>(wi(),gi("div",{class:"derivative-container",ref_key:"chartContainerRef",ref:V,onClick:ot,onContextmenu:nt},[m("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:Le},[m("div",{class:"area data-area",onClick:Re,onContextmenu:Ee},[m("div",{ref_key:"connectionRef",ref:Qe,class:M(["command",{yellow:E.value.pending,red:B.value.volInValid}]),title:t.$t("trading.derivative.connection"),onClick:$e},[m("i",{class:M(["far",{"fa-link-simple":E.value.connection,"fa-link-simple-slash":!E.value.connection,blink:c.isSocketWarning}])},null,2)],10,Oi),m("div",{class:M(["command status",{green:E.value.position>0,red:E.value.position<0}]),title:t.$t("trading.derivative.position"),onClick:ri},ze(E.value.position),11,Ri),m("div",{class:"command clock",onClick:Ze},ze(c.clock),1),J(m("input",{type:"date",class:"chart-date command",title:t.$t("trading.derivative.date"),"onUpdate:modelValue":r[0]||(r[0]=i=>c.chartDate=i),onChange:ei},null,40,Ei),[[yi,c.chartDate]]),m("div",{ref_key:"reloadToolRef",ref:Ke,class:"command",title:t.$t("trading.derivative.reload"),onClick:ti,onContextmenu:pe},[m("i",{class:M(["far fa-sync-alt",{"fa-spin":it.value}])},null,2)],40,Ai)],32),m("div",{class:"area tool-area",onClick:Re,onContextmenu:Ee},[m("div",{ref_key:"fullscreenToolRef",ref:Ue,class:"command",title:t.$t("trading.derivative.fullscreen"),onClick:pt},[m("i",{class:M(["far",{"fa-compress":c.isFullscreen,"fa-expand":!c.isFullscreen}])},null,2)],8,Pi),m("div",{ref_key:"tradingviewRef",ref:et,class:"command far fa-chart-candlestick",title:t.$t("trading.derivative.tradingview"),onClick:yt},null,8,_i),m("div",{class:M(["context command",{green:c.progress.result==!0,red:c.progress.result==!1}]),title:t.$t("trading.derivative.progressTool"),onClick:xt,onContextmenu:St},[m("i",{class:M(["far",{"fa-badge-check":!c.progress.step,[`fa-circle-${c.progress.step}`]:c.progress.step,blink:B.value.autoRefresh}])},null,2),J(ke(Di,{class:"contextmenu",progress:c.progress},null,8,["progress"]),[[K,c.showProgressContext]])],42,Bi),m("div",{ref_key:"scanToolRef",ref:ge,class:"context command",title:t.$t("trading.derivative.scanTool"),onClick:Ct,onContextmenu:wt},[m("i",{class:M(["far",{[`fa-angles-${c.scanSide}`]:!0}])},null,2),J(ke(Fi,{class:"contextmenu",modelValue:c.scanSide,"onUpdate:modelValue":r[1]||(r[1]=i=>c.scanSide=i)},null,8,["modelValue"]),[[K,c.showScanContext]])],40,Ii),m("div",{ref_key:"patternToolRef",ref:me,class:"command",title:t.$t("trading.derivative.patternTool"),onClick:Lt,onContextmenu:Ot},Wi,40,Vi),m("div",{ref_key:"pickTimeToolRef",ref:ve,class:"command",title:t.$t("trading.derivative.pickTimeTool"),onClick:Pt,onContextmenu:_t},Yi,40,Zi),m("div",{ref_key:"lineToolRef",ref:te,class:"context command",title:t.$t("trading.derivative.lineTool"),onClick:Zt,onContextmenu:$t},[Xi,J(ke(ki,{class:"contextmenu",enable:c.showLineContext,title:c.lineTitle,"onUpdate:title":r[2]||(r[2]=i=>c.lineTitle=i),color:c.lineColor,"onUpdate:color":r[3]||(r[3]=i=>c.lineColor=i),onDeleteAllLine:We},null,8,["enable","title","color"]),[[K,c.showLineContext]])],40,Ni),m("div",{ref_key:"timeRangeToolRef",ref:ie,class:"command",title:t.$t("trading.derivative.timeRangeTool"),onClick:It,onContextmenu:Vt},Hi,40,zi),m("div",{ref_key:"targetToolRef",ref:he,class:"command",title:t.$t("trading.derivative.targetTool"),onClick:Xt,onContextmenu:zt},Qi,40,ji),J(m("div",{ref_key:"cancelOrderRef",ref:tt,class:"cancel-order command",title:t.$t("trading.derivative.cancelTool"),onClick:Ut},[m("i",{class:M(["far fa-trash-alt",{blink:c.isOrderWarning}])},null,2)],8,Ui),[[K,rt.value]])],32),m("div",null,[m("div",{ref_key:"entryOrderRef",ref:Z,class:"order-button entry",onClick:qt}," Entry ",512),m("div",{ref_key:"tpslOrderRef",ref:q,class:"order-button tpsl",onClick:Qt}," TP/SL ",512),m("div",{class:"chart-top command far fa-angle-double-right",onClick:Kt})]),J(m("iframe",{ref_key:"tradingviewChartRef",ref:Ge,class:"tradingview-chart",style:xi(c.tradingViewStyle),src:st.value},null,12,Gi),[[K,c.showTradingView]])],512)],544))}};export{pr as default};
