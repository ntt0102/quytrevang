import{a6 as _,u as B,r as m,a as E,w as q,b as z,d as A,e as a,f as $,g as n,F as H,h as x,j as N,k as l,l as F,m as G,o as V,D as i,n as X}from"./app-ccde6edd.js";import O from"./ContractConditionsPopup-87de928e.js";import j from"./PayingContractPopup-95dccc0d.js";import L from"./WithdrawingContractPopup-0ef61c70.js";import{_ as U}from"./ContractDetailPopup-b7b4056c.js";import"./accordion-cb1a28fd.js";import"./load-indicator-1b40973d.js";import"./radio-group-96308815.js";const J={class:"content-block dx-card responsive-paddings"},K={__name:"Index",setup(Q){const r=x(),p=N(),{t:s}=B(),b=l("bus"),v=l("mt"),y=l("mc"),c=l("mf"),w=l("routeHistoryState"),o=m(null),h=m(null),g=m(null),d=E({gridData:null,validationRules:[{type:"required",message:s("models.contract.principal")+v.validations.required},{type:"custom",validationCallback:R,message:s("models.contract.validations.principal")}]});r.dispatch("userContract/getContracts").then(()=>{p.hash=="#conditions"&&showConditions()}),q(()=>r.state.userContract.contracts,t=>D(t));function S(t){b.emit("checkPin",()=>{r.dispatch("userContract/save",{changes:t.changes}).then(({isOk:u,type:f,contract:e})=>{u&&f=="insert"&&h.value.show(e)})})}function C(t){return t.row.data.status==1}function R(t){return t.value>=r.state.userContract.principalMin}function k(t){t.data.status=1,t.data.interest_rate=r.state.userContract.interestRate,t.data.paid_at=F(new Date,y.SERVER_DATE_FORMAT),o.value.instance.option("editing.popup.title",s("models.contract.popup.create"))}function P(t){o.value.instance.option("editing.popup.title",`${s("models.contract.popup.edit")} #${t.data.code}`)}function D(t){d.gridData=c.cloneDeep(t),p.query.code&&o.value.instance.columnOption("code","filterValues",[+p.query.code])}function I(t){c.checkPinDataGrid(t,o.value.instance),c.pushPopupToHistoryState(w,()=>o.value.instance.cancelEditData())}function T(){c.popRouteHistoryState(w)}function M(t){t.toolbarOptions.items.unshift({location:"before",widget:"dxButton",options:{icon:"help",type:"normal",hint:s("components.contractConditions.title"),onClick:()=>g.value.show()}})}return(t,u)=>{const f=G("DxToolbar");return V(),z(H,null,[A("div",J,[a(n(X),{ref_key:"dataGridRef",ref:o,"column-min-width":40,"data-source":d.gridData,"key-expr":"code","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:C,allowDeleting:C,confirmDelete:!1,mode:"popup",popup:{width:300,height:t.$screen.getScreenSizeInfo.isXSmall?250:210,fullScreen:!1,showTitle:!0,onShown:I,onHiding:T},form:{labelLocation:t.$screen.getScreenSizeInfo.isXSmall?"top":"left",items:[{dataField:"principal",colSpan:2}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:u[0]||(u[0]=e=>t.$mf.dataGridPreload(d.gridData,o.value.instance)),onInitNewRow:k,onEditingStart:P,onToolbarPreparing:M,onSaved:S},{commandCellTemplate:$(({data:e})=>[a(f,{items:[{visible:e.data.status<=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==0?"arrow-square-up":"receipt"}`,hint:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),text:t.$t(e.data.status==0?"user.contract.paidContract":"user.contract.editPaidContract"),onClick:()=>t.$refs.payingContractPopupRef.show(e.data)}},{visible:e.data.status==2,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"far fa-arrow-square-down",hint:t.$t("user.contract.withdrawContract"),text:t.$t("user.contract.withdrawContract"),onClick:()=>t.$refs.withdrawingContractPopupRef.show(e.data)}},{visible:e.data.status==3,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"undo",hint:t.$t("user.contract.unwithdrawContract"),text:t.$t("user.contract.unwithdrawContract"),onClick:()=>t.$bus.emit("checkPin",()=>t.$store.dispatch("userContract/withdrawingContract",{id:e.data.id,advance:0}))}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>o.value.instance.editRow(e.rowIndex)}},{visible:e.data.status==0,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>o.value.instance.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key)&&e.data.status>=1,locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopupRef.show(e.data)}}]},null,8,["items"])]),default:$(()=>[a(n(i),{fixed:!0,width:t.$screen.getScreenSizeInfo.isXSmall?35:98,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$screen.getScreenSizeInfo.isXSmall?"Short":""}`)},null,8,["width","caption"]),a(n(i),{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),a(n(i),{"allow-editing":!1,"data-field":"status",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),a(n(i),{name:"principal","data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":d.validationRules},null,8,["caption","validation-rules"]),a(n(i),{"allow-editing":!1,"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),caption:t.$t("models.contract.interestRate")},null,8,["format","caption"]),a(n(i),{"allow-editing":!1,name:"paidAt","data-field":"paid_at","data-type":"date",caption:t.$t("models.contract.paidAt")},null,8,["caption"]),a(n(i),{"allow-editing":!1,name:"withdrawnAt","data-field":"withdrawn_at","data-type":"date",caption:t.$t("models.contract.withdrawnAt")},null,8,["caption"])]),_:1},8,["data-source","editing","onCellPrepared"])]),a(O,{ref_key:"contractConditionsPopupRef",ref:g},null,512),a(j,{ref_key:"payingContractPopupRef",ref:h},null,512),a(L,{ref:"withdrawingContractPopupRef"},null,512),a(U,{ref:"contractDetailPopupRef"},null,512)],64)}}},it=_(K,[["__scopeId","data-v-952b1bd0"]]);export{it as default};
