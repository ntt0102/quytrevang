import{h as re,c as B,r as E,w as J,o as ce,b as de,d as R,u as Oe,V as Me,W as We,$ as Se,X as ge,Y as ye,Z as $e,a0 as Ve,a1 as Pe,a2 as ze,a3 as Ce,a as Ze,y as He,L as je,e as V,f as Je,g as Ye,M as Qe,N as Ue,K as xe,j as Ge,k as ke,x as Ke,s as Xe,t as _e,l as we}from"./app-DGdxXa41.js";import{c as qe,g as Ie,a as et,b as tt,d as nt,e as ot}from"./lightweight-charts.esm.development-8U_91CAv.js";const lt=["title"],at=R("i",{class:"far fa-grip-lines-vertical"},null,-1),it=[at],st={__name:"FilterTimeTool",props:[],emits:["hideContext"],setup(u,{expose:S,emit:p}){const i=re(),C=p,N=B(()=>i.state.tradingShare.config.filterTime),x=E(null);let f={},h=[];const I=["rgba(244, 67, 54, 0.5)","rgba(255, 152, 0, 0.5)","rgba(76, 175, 80, 0.5)","rgba(0, 150, 136, 0.5)"];S({createSeries:k,isSelected:T,draw:g,get:y}),J(N,c=>{c&&setTimeout(()=>A(c),3e3)});function T(){return x.value.classList.contains("selected")}function y(){return h.map(m=>m.time).reverse()}function k(c){if(!c)return!1;f=c.addHistogramSeries({priceScaleId:"filterTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function d(c){C("hideContext");const m=c.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(D=>D.classList.remove("selected")),m||(h.pop(),v({isRemove:!0,removePoint:h.length}),f.setData(h),c.target.classList.add("selected"))}function r(c){M(),c.target.classList.remove("selected")}function g({time:c}){const m=h.length;if(m&&c<=h[m-1].time)return!1;h.push({time:c,color:I[m],value:1}),f.setData(h),v({isRemove:!1,points:[m],data:[c]}),m===3&&x.value.classList.remove("selected")}function A(c){for(let m=0;m<c.length;m++)h.push({time:c[m],color:I[m],value:1});f.setData(h)}function M(c=!0){c&&v({isRemove:!0}),f.setData([]),h=[]}function v({isRemove:c,points:m,data:D,removePoint:U}){let n={isRemove:c,symbol:"",name:"filterTime"};c?n.point=U:(n.points=m,n.data=D),i.dispatch("tradingShare/drawTools",n)}return(c,m)=>(ce(),de("div",{ref_key:"filterTimeToolRef",ref:x,class:"command",title:c.$t("trading.share.tools.filterTime"),onClick:d,onContextmenu:r},it,40,lt))}},ut=["title"],rt=R("i",{class:"far fa-circle-check"},null,-1),ct=[rt],dt={__name:"CheckTool",props:["symbol"],emits:["checkSymbol","hideContext"],setup(u,{expose:S,emit:p}){const i=re(),{t:C}=Oe(),N=u,x=p;let f=null;J(()=>N.symbol,()=>f=null),S({check:h});function h(d){i.dispatch("tradingShare/checkSymbol",d).then(r=>{f=r,y(r)})}function I(){x("checkSymbol"),x("hideContext")}function T(){f&&y(f)}function y(d){let r=JSON.stringify(d.result,void 0,4);Me(`<pre class='check-tool-popup'>${k(r)}</pre>`,`${C("trading.share.tools.check")} ${d.symbol}`)}function k(d){return d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(r){var g="number";return/^"/.test(r)?/:$/.test(r)?g="key":g="string":/true|false/.test(r)?g="boolean":/null/.test(r)&&(g="null"),'<span class="'+g+'">'+r+"</span>"})}return(d,r)=>(ce(),de("div",{class:"command",title:d.$t("trading.share.tools.check"),onClick:I,onContextmenu:T},ct,40,ut))}},pt=["title"],mt=R("i",{class:"far fa-arrow-trend-down"},null,-1),ft=[mt],ue="reversal",ht={__name:"ReversalTool",props:["symbol","drawIndexLine","drawStockLine"],emits:["hideContext"],setup(u,{expose:S,emit:p}){const i=re(),C=u,N=p,x=E(null),f=B(()=>i.state.tradingShare.tools.reversal),h=B(()=>i.state.tradingShare.config.reversal),I=B(()=>i.state.tradingShare.config.index),T=B(()=>i.state.tradingShare.config.whitespace),y={index:"rgba(103, 58, 183, 0.5)",stock:"rgba(156, 39, 176, 0.5)"};let k={},d=[],r={index:null,stock:null},g={title:"R",lineWidth:1,lineStyle:0,draggable:!1};S({createSeries:M,isSelected:A,draw:m,remove:me,loadIndex:t}),J(f,s=>{s&&U(s[0])}),J(h,s=>{s&&t(s)});function A(){return x.value.classList.contains("selected")}function M(s){if(!s)return!1;k.stock=s.addHistogramSeries({priceScaleId:ue+"Stock",color:y.stock,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),k.index=s.addHistogramSeries({priceScaleId:ue+"Index",color:y.index,scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1})}function v(s){N("hideContext");const O=s.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(W=>W.classList.remove("selected")),O||($(),C.symbol===I.value&&G(),s.target.classList.add("selected"))}function c(s){$(),C.symbol===I.value&&G(),s.target.classList.remove("selected")}function m({stock:s,time:O}){if(d.push({time:O,value:1}),d.length===2){const W=D(s,d[0].time,d[1].time);n(W),i.dispatch("tradingShare/drawTools",{isRemove:!1,symbol:C.symbol,name:ue,points:[0],data:[W]}),C.symbol===I.value&&t(W),d=[],x.value.classList.remove("selected")}else k.stock.setData(d)}function D(s,O,W){let F,K,P,Y;const z=s.filter(w=>w.time>=O&&w.time<=W);for(let w=0;w<z.length;w++){const le=z[w].time,ae=z[w].high,L=z[w].low,X={i:w,p:ae},ie={i:w,p:L};if(w===0)F={H:X,L:X},P=0,Y=0,K=le;else if(ae>F.H.p?F.H=X:F.H.i=w,L<F.L.p){K=le;const q=F.H.p-F.L.p,se=F.H.i-F.L.i;q>P&&(P=q),se>Y&&(Y=se),F={H:ie,L:ie}}}const ee=[...s,...T.value],te=ee.findIndex(w=>w.time===K),ne=ee[te+Y].time,oe=F.L.p+P;return{time:ne,price:oe}}function U(s){$(!1),n(s)}function n({price:s,time:O}){k.stock.setData([{time:O,value:1}]),g.price=s,g.color=y.stock,r.stock=C.drawStockLine(g)}function t(s){G(),pe(s)}function pe({price:s,time:O}){k.index.setData([{time:O,value:1}]),g.price=s,g.color=y.index,r.index=C.drawIndexLine(g)}function me(){$(!1)}function $(s=!0){s&&i.dispatch("tradingShare/drawTools",{isRemove:!0,symbol:C.symbol,name:ue}),k.stock.setData([]),r.stock&&(C.drawStockLine(r.stock,!0),r.stock=null)}function G(){k.index.setData([]),r.index&&(C.drawIndexLine(r.index,!0),r.index=null)}return(s,O)=>(ce(),de("div",{ref_key:"reversalToolRef",ref:x,class:"command",title:s.$t("trading.share.tools.reversal"),onClick:v,onContextmenu:c},ft,40,pt))}};var l={},gt="dx-autocomplete",bt="dx-autocomplete-popup-wrapper",Fe=We.inherit({_supportedKeys:function(){var u=this._list?this._list.option("focusedElement"):null,S=this.callBase();return u=u&&Se(u),ge({},S,{upArrow:function(p){return!ye(p)&&(p.preventDefault(),p.stopPropagation(),u&&!this._calcNextItem(-1))?(this._clearFocusedItem(),!1):!0},downArrow:function(p){return!ye(p)&&(p.preventDefault(),p.stopPropagation(),u&&!this._calcNextItem(1))?(this._clearFocusedItem(),!1):!0},enter:function(p){u||this.close();var i=this.option("opened");return i&&p.preventDefault(),i}})},_getDefaultOptions:function(){return ge(this.callBase(),{minSearchLength:1,maxItemCount:10,noDataText:"",showDropDownButton:!1,searchEnabled:!0})},_initMarkup:function(){this.callBase(),this.$element().addClass(gt),this.setAria("autocomplete","inline")},_displayGetterExpr:function(){return this.option("valueExpr")},_closeOutsideDropDownHandler:function(u){var{target:S}=u;return!Se(S).closest(this.$element()).length},_renderDimensions:function(){this.callBase(),this._updatePopupWidth(),this._updateListDimensions()},_popupWrapperClass:function(){return this.callBase()+" "+bt},_listConfig:function(){return ge(this.callBase(),{pageLoadMode:"none",onSelectionChanged:u=>{this._setSelectedItem(u.addedItems[0])}})},_listItemClickHandler:function(u){this._saveValueChangeEvent(u.event);var S=this._displayGetter(u.itemData);this.option("value",S),this.close()},_setListDataSource:function(){this._list&&(this._list.option("selectedItems",[]),this.callBase())},_refreshSelected:$e,_searchCanceled:function(){this.callBase(),this.close()},_loadItem:function(u,S){var p=this._getItemFromPlain(u,S);return new Ve().resolve(p).promise()},_dataSourceOptions:function(){return{paginate:!0,pageSize:this.option("maxItemCount")}},_searchDataSource:function(u){this._dataSource.pageSize(this.option("maxItemCount")),this.callBase(u),this._clearFocusedItem()},_clearFocusedItem:function(){this._list&&(this._list.option("focusedElement",null),this._list.option("selectedIndex",-1))},_renderValueEventName:function(){return"input keyup"},_valueChangeEventHandler:function(u){var S=this._input().val()||null;return this.callBase(u,S)},_optionChanged:function(u){switch(u.name){case"maxItemCount":this._searchDataSource();break;case"valueExpr":this._compileDisplayGetter(),this._setListOption("displayExpr",this._displayGetterExpr()),this.callBase(u);break;default:this.callBase(u)}},reset:function(){this.callBase(),this.close()}});Pe("dxAutocomplete",Fe);const vt=Object.freeze(Object.defineProperty({__proto__:null,default:Fe},Symbol.toStringTag,{value:"Module"})),St=ze(vt);/*!
 * devextreme-vue
 * Version: 22.2.12
 * Build date: Mon Apr 29 2024
 *
 * Copyright (c) 2012 - 2024 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var De;function yt(){if(De)return l;De=1;var u=l&&l.__importDefault||function(D){return D&&D.__esModule?D:{default:D}};Object.defineProperty(l,"__esModule",{value:!0}),l.DxToolbarItem=l.DxTo=l.DxShow=l.DxPosition=l.DxOptions=l.DxOffset=l.DxMy=l.DxItem=l.DxHide=l.DxFrom=l.DxDropDownOptions=l.DxCollision=l.DxButton=l.DxBoundaryOffset=l.DxAt=l.DxAnimation=l.DxAutocomplete=void 0;var S=u(St),p=Ce(),i=Ce(),C=p.createComponent({props:{accessKey:String,activeStateEnabled:Boolean,buttons:Array,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxItemCount:Number,maxLength:[Number,String],minSearchLength:Number,name:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDropDownButton:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:String,valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxItemCount":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDropDownButton":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=S.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});l.DxAutocomplete=C;var N=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});l.DxAnimation=N,N.$_optionName="animation",N.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var x=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxAt=x,x.$_optionName="at";var f=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});l.DxBoundaryOffset=f,f.$_optionName="boundaryOffset";var h=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});l.DxButton=h,h.$_optionName="buttons",h.$_isCollectionItem=!0,h.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var I=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxCollision=I,I.$_optionName="collision";var T=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});l.DxDropDownOptions=T,T.$_optionName="dropDownOptions",T.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var y=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});l.DxFrom=y,y.$_optionName="from",y.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var k=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});l.DxHide=k,k.$_optionName="hide",k.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var d=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});l.DxItem=d,d.$_optionName="items",d.$_isCollectionItem=!0;var r=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});l.DxMy=r,r.$_optionName="my";var g=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});l.DxOffset=g,g.$_optionName="offset";var A=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});l.DxOptions=A,A.$_optionName="options";var M=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});l.DxPosition=M,M.$_optionName="position";var v=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});l.DxShow=v,v.$_optionName="show";var c=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});l.DxTo=c,c.$_optionName="to";var m=i.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});return l.DxToolbarItem=m,m.$_optionName="toolbarItems",m.$_isCollectionItem=!0,l.default=C,l}var Ct=yt();const xt={class:"command symbol-input"},kt=["title"],_t=["title"],Dt={__name:"Chart",props:["fromDate","group"],setup(u,{expose:S}){const p=re(),i=Ge(),{t:C}=Oe(),N=ke("devices"),x=ke("mf"),f=E(null),h=E(null),I=E(null),T=E(null),y=E(null),k=E(null),d=E(null),r=E(null),g=E(null),A=u,M=B(()=>p.state.tradingShare.isLoading),v=B(()=>p.state.tradingShare.config),c=B(()=>n.symbol),m=B(()=>v.value.watchlist.includes(n.symbol)),D=B(()=>p.state.tradingShare.symbols),U=B(()=>A.fromDate),n=Ze({symbol:i.query.symbol??"VN30",inputSymbol:i.query.symbol??"VN30",series:{}});let t={chart:{},series:{},data:{index:[],stock:[]},crosshair:{},websocket:null};He(()=>{pe(),le(),y.value.createSeries(t.chart),d.value.createSeries(t.chart),new ResizeObserver(K).observe(f.value),document.addEventListener("keydown",P)}),je(()=>{me(),be(),document.removeEventListener("keydown",P)}),J(()=>p.state.tradingShare.stock,te),J(()=>v.value.whitespace,ee),J(()=>v.value.source,ae),S({getFilterTimes:O,getChartData:L,updateWatchlist:Y});function pe(){const e={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.5,bottom:.05}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:40,horzAlign:"center",vertAlign:"center",color:"rgba(54, 54, 64, 0.4)"}};t.chart=qe(h.value,e),t.chart.subscribeCrosshairMove(W),t.chart.subscribeCustomPriceLineDragged(F),t.series.whitespace=t.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),t.series.index=t.chart.addCandlestickSeries({priceScaleId:"index",upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01},scaleMargins:{top:.1,bottom:.55}}),t.series.stock=t.chart.addCandlestickSeries({upColor:"#30A165",downColor:"#EC3F3F",borderVisible:!1,wickUpColor:"#30A165",wickDownColor:"#EC3F3F",priceFormat:{minMove:.01}})}function me(){t.chart&&(t.chart.remove(),t.chart=null)}function $(e){e.preventDefault(),e.stopPropagation()}function G(){Q(),y.value.isSelected()?y.value.draw({time:t.crosshair.time}):d.value.isSelected()?d.value.draw({stock:t.data.stock,time:t.crosshair.time}):r.value.isSelected()?r.value.draw({price:ve(t.crosshair.y)}):g.value.isSelected()&&g.value.draw({price:ve(t.crosshair.y)})}function s(e){e.stopPropagation()}function O(){return y.value.get()}function W(e){if(e.time){let o=e.seriesPrices.get(t.series.stock);t.crosshair.time=e.time,t.crosshair.price=o}else N.phone||(t.crosshair.time=null,t.crosshair.price=null);e.point!=null&&(t.crosshair.x=e.point.x,t.crosshair.y=e.point.y)}function F(e){let a=e.customPriceLine.options();a.price=x.fmtNum(a.price);const b=+e.fromPriceString,_=a.price;switch(a.lineType){case"line":r.value.drag({lineOptions:a,oldPrice:b,newPrice:_});break;case"target":g.value.drag({lineOptions:a,newPrice:_});break}}function K(){f.value&&(t.chart.resize(f.value.offsetWidth,f.value.offsetHeight),T.value.checkFullscreen())}function P(e){if(e.ctrlKey||e.metaKey)switch(e.code){case"Numpad0":fe(!0);break;case"Numpad1":fe(!1);break;case"NumpadDecimal":z();break}else document.activeElement.tagName!="INPUT"&&e.keyCode>=65&&e.keyCode<=90&&(n.inputSymbol="",I.value.instance.focus())}function Y(e){v.value.watchlist=e}function z(){if(!n.symbol)return!1;const e={multi:!1,group:A.group,symbol:n.symbol,add:!m.value};p.dispatch("tradingShare/changeWatchlist",e).then(o=>{v.value.watchlist=x.isSet(o)?o:[]})}function ee(e){t.series.whitespace.setData(e)}function te(e){t.data.stock=x.cloneDeep(e),t.series.stock.setData(t.data.stock),t.chart.applyOptions({watermark:{text:n.symbol}})}function ne(e){t.data.index=e,t.series.index.setData(e)}function oe(e,o){let a=t.data[e].pop();if(!a)return!1;a.high=Math.max(a.high,o),a.low=Math.min(a.low,o),a.close=o,t.data[e].push(a),n.series[e].update(a)}function w(){if(!n.inputSymbol||!n.inputSymbol.trim()||(n.inputSymbol=n.inputSymbol.trim().toUpperCase(),n.symbol==n.inputSymbol))return!1;n.symbol=n.inputSymbol,I.value.instance.blur(),L()}function le(){p.dispatch("tradingShare/initChart")}function ae(e){e==="FIREANT"?Ne():(L(!0),be())}function L(e=!1,o=null){if(!n.symbol)return!1;o||(o=U.value),v.value.source==="FIREANT"?X(e,o):ie(e,o)}function X(e=!1,o=null){if(t.websocket&&t.websocket.readyState===WebSocket.OPEN){const a=we(o,"yyyy-MM-dd"),b=we(new Date,"yyyy-MM-dd");let _=`{"arguments":["${n.symbol}","D","${a}","${b}"],"invocationId":"stock","target":"GetBars","type":1}`;t.websocket.send(_),e&&(_=`{"arguments":["${v.value.index}","D","${a}","${b}"],"invocationId":"index","target":"GetBars","type":1}`,t.websocket.send(_)),q()}}function ie(e=!1,o=null){p.dispatch("tradingShare/getChartData",{symbol:n.symbol,from:Ie(o),withIndex:e}).then(a=>{e&&ne(a),q()})}function q(){d.value.remove(),r.value.remove(),g.value.remove()}function se(){fe()}function fe(e=!0){if(M.value)return!1;const o=D.value;let a=o.findIndex(_=>_===n.symbol);a=a+(e?1:-1),a<0?a=o.length-1:a>=o.length&&(a=0);const b=o[a];if(!b)return!1;n.inputSymbol=b,n.symbol=n.inputSymbol,L()}function Te(){if(!n.symbol||n.symbol===v.value.index)return!1;const e=O();if(e.length<2)return Ke.warning(C("trading.share.filterTimeWarning"));k.value.check({symbol:n.symbol,filterTimes:e})}function Ne(){let e="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg";t.websocket=new WebSocket(e),t.websocket.onopen=()=>{console.log("Đã kết nối tới WebSocket server"),t.websocket.send('{"protocol":"json","version":1}'),L(!0)},t.websocket.onmessage=o=>{const a=Ee(o.data);if(a.length==0)return!1;a.forEach(b=>{if(!b)return!1;if(b.type==3){const _=b.result.bars.map(({open:Z,high:H,low:j,close:Le,date:Re})=>{const Ae=Ie(new Date(Re));return{open:Z,high:H,low:j,close:Le,time:Ae}});b.invocationId==="stock"?(p.dispatch("tradingShare/getTools",{symbol:n.symbol}),te(_)):ne(_)}else if(b.type==1&&b.target==="UpdateLastPrices"){const _=b.arguments[0],Z=_.find(j=>j.symbol==v.value.index),H=_.find(j=>j.symbol==n.symbol);Z&&oe("index",Z.last),H&&oe("stock",H.last)}})},t.websocket.onerror=o=>{console.error("Lỗi kết nối WebSocket:",o)},t.websocket.onclose=()=>{console.log("Đã đóng kết nối WebSocket")}}function be(){t.websocket&&(t.websocket.readyState===WebSocket.OPEN&&t.websocket.close(),t.websocket=null)}function Ee(e){let o=[];return e.split("").forEach(a=>{const b=a.indexOf("{"),_=a.lastIndexOf("}");let Z=null;if(b!==-1&&_!==-1&&_>b){const H=a.substring(b,_+1);if(H!="{}")try{Z=JSON.parse(H)}catch(j){console.error("JSON parse error:",j)}}o.push(Z)}),o}function Q(){r.value.hide()}function ve(e){return x.fmtNum(t.series.stock.coordinateToPrice(e))}function Be(e,o=!1){if(o)t.series.index.removePriceLine(e);else return t.series.index.createPriceLine(e)}function he(e,o=!1){if(o)t.series.stock.removePriceLine(e);else return t.series.stock.createPriceLine(e)}return(e,o)=>(ce(),de("div",{ref_key:"chartContainerRef",ref:f,class:"share-chart",onClick:G,onContextmenu:$},[R("div",{ref_key:"chartRef",ref:h},null,512),R("div",{class:"area data-area",onClick:s,onContextmenu:$},[R("div",xt,[V(Ye(Ct.DxAutocomplete),{ref_key:"symbolAutocompleteRef",ref:I,"data-source":D.value,"item-template":"symbol-item","show-clear-button":!0,openOnFieldClick:!0,minSearchLength:0,maxItemCount:100,modelValue:n.inputSymbol,"onUpdate:modelValue":o[0]||(o[0]=a=>n.inputSymbol=a),onChange:w,onItemClick:w},{"symbol-item":Je(({data:a,index:b})=>[Xe(_e(b+1)+". "+_e(a),1)]),_:1},8,["data-source","modelValue"])]),Qe(R("div",{ref:"addWatchlistToolRef",class:xe(["command far",{"fa-heart-circle-minus":m.value,"fa-heart-circle-plus":!m.value}]),title:e.$t("trading.share.changeWatchlist"),onClick:z,onContextmenu:se},null,42,kt),[[Ue,c.value]]),R("div",{class:"command",title:e.$t("trading.share.reload"),onClick:o[1]||(o[1]=()=>L()),onContextmenu:o[2]||(o[2]=()=>L(!0))},[R("i",{class:xe(["far fa-sync-alt",{"fa-spin":M.value}])},null,2)],40,_t)],32),R("div",{class:"area tool-area",onClick:s,onContextmenu:$},[V(et,{ref_key:"fullscreenToolRef",ref:T,chartContainerRef:f.value},null,8,["chartContainerRef"]),V(tt,{ref:"tradingviewToolRef",vpsUser:v.value.vpsUser,vpsSession:v.value.vpsSession,chartContainerRef:f.value,symbol:n.symbol,timeframe:"1D"},null,8,["vpsUser","vpsSession","chartContainerRef","symbol"]),V(st,{ref_key:"filterTimeToolRef",ref:y,onHideContext:Q},null,512),V(dt,{ref_key:"checkToolRef",ref:k,symbol:n.symbol,onCheckSymbol:Te,onHideContext:Q},null,8,["symbol"]),V(ht,{ref_key:"reversalToolRef",ref:d,symbol:n.symbol,drawIndexLine:Be,drawStockLine:he,onHideContext:Q},null,8,["symbol"]),V(nt,{ref_key:"lineToolRef",ref:r,symbol:n.symbol,storeModule:"tradingShare",drawPriceLine:he,onHideContext:Q},null,8,["symbol"]),V(ot,{ref_key:"targetToolRef",ref:g,symbol:n.symbol,storeModule:"tradingShare",drawPriceLine:he,levels:[1,2],isPercent:!0,showPercent:!1,onHideContext:Q},null,8,["symbol"])],32)],544))}};export{Dt as default};
