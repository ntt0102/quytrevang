import{_ as g,b as _,c as u,e as c,w as l,f as v,g as h,r as d,o as m,d as e,t as a,h as p,i as y}from"./app-ad45c997.js";import{_ as $}from"./accordion-50adb57e.js";import{D as I}from"./load-indicator-e6a908c1.js";import{P}from"./Index-6119bc8e.js";import"./interest-formula-45587e77.js";const S={components:{DxAccordion:$,DxLoadIndicator:I,Pdf:P},data(){return{refreshKey:0,contract:{},formData:{},backupDocuments:[],qrSrc:null}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance},submit(){return this.$refs.submit.instance}},methods:{..._("Admin.contracts",["withdrawnContract"]),show(t){this.popup.option("title",this.$t(`components.withdrawnContract.${t.status==4?"withdrawnTitle":"title"}`)+" #"+t.code),this.contract=t,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",t.status==3?0:1),500),this.backupDocuments=t.url_withdrawn_docs.map(i=>({file:i,isUpload:!1})),this.formData.documents=this.backupDocuments;let o=`https://img.vietqr.io/image/${this.contract.bank_account.bank_name}-${this.contract.bank_account.account_number}-KRnx1D.jpg?accountName=${this.contract.bank_account.account_name}&amount=${this.contract.advance}&addInfo=${this.$t("models.contract.transfer.contentValue").replace("{contractCode}",this.contract.code)}`;this.$mf.fetchImage(o).then(i=>this.qrSrc=i),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(t){this.formData.documents=this.formData.documents.filter(o=>!o.isUpload),[...t.target.files].forEach(o=>this.formData.documents.push({file:URL.createObjectURL(o),isUpload:!0}))},onCheckBoxDeleteChange(t){t.value?this.formData.documents=this.formData.documents.filter(o=>o.isUpload):this.formData.documents=this.backupDocuments.concat(this.formData.documents)},saveClick(){!this.formData.isDelete&&this.$refs.receiptImage.files.length==0?this.$toasted.info(this.$t("messages.info.noChangedData")):this.submit.element().click()},onSubmit(){this.$bus.emit("checkPin",async()=>{let t=new FormData;t.append("contractId",this.contract.id),t.append("isDelete",this.formData.isDelete);for(var o=0;o<this.$refs.receiptImage.files.length;o++){let i=await this.$mf.resizeImage({file:this.$refs.receiptImage.files[o],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${o}]`,i)}this.withdrawnContract(t).then(i=>{i&&this.popup.hide()})})},downloadQR(){let t=document.createElement("a");t.href=this.qrSrc,t.download=`vietQR_${this.contract.code}`,t.click()},initFormData(){this.formData={isPdfPreview:!1,isDelete:!1,documents:[]},this.qrSrc=null},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}},V={class:"amount"},T={class:"text-dark"},B=e("span",{class:"text-dark"},"/",-1),x={class:"text-dark"},U={key:0},A={class:"text-dark"},N={class:"text-dark"},q={class:"way1"},R={class:"description text-darker"},H={class:"method"},L=e("div",{class:"method1"},null,-1),E={class:"method2"},W={class:"text-darker"},F={class:"download way2"},K={class:"upload-browser"},M={for:"receiptImage"},O=e("i",{class:"far fa-file-upload"},null,-1);function j(t,o,i,z,n,r){const f=d("DxButton"),w=d("DxCheckBox"),D=d("DxAccordion"),b=d("DxScrollView"),k=d("DxPopup"),C=d("Pdf");return m(),u("div",null,[c(k,{ref:"popup",showCloseButton:!0,fullScreen:!!t.$devices.phone,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:r.saveClick}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>t.$refs.submit.click()}}],wrapperAttr:{class:"confirm-contract-popup"},onHiding:r.onHiding},{content:l(()=>[c(b,null,{default:l(()=>[e("form",{onSubmit:o[7]||(o[7]=y((...s)=>r.onSubmit&&r.onSubmit(...s),["prevent"]))},[c(f,{ref:"submit",class:"display-none",useSubmitBehavior:!0},null,512),e("div",V,[e("div",null,[e("span",T,a(t.$t("components.withdrawnContract.amount")),1),e("b",null,a(n.contract.advance|t.currency),1),B,e("span",x,a(n.contract.total|t.currency),1)]),n.contract.advance<n.contract.total?(m(),u("div",U,[e("span",A,a(t.$t("components.withdrawnContract.surplus")),1),e("span",null,a(n.contract.total-n.contract.advance|t.currency),1),e("span",N,a(t.$t("components.withdrawnContract.newContract")),1)])):h("",!0)]),c(D,{ref:"accordion",collapsible:!0,items:[{title:t.$t("components.withdrawnContract.step1"),template:"step1Template"},{title:t.$t("components.withdrawnContract.step2"),template:"step2Template"}]},{step1Template:l(()=>[c(D,{collapsible:!0,items:[{title:t.$t("components.withdrawnContract.withdrawnWay1"),template:"way1Template"},{title:t.$t("components.withdrawnContract.withdrawnWay2"),template:"way2Template"}]},{way1Template:l(()=>[e("div",q,[e("div",R,a(t.$t("models.contract.transfer.qrCode")),1),e("div",H,[L,e("div",E,[e("div",null,[e("span",null,a(t.$t("models.user.bankName"))+":",1),e("span",null,a(n.contract.bank_account.bank_name),1)]),e("div",null,[e("span",null,a(t.$t("models.user.accountName"))+":",1),e("span",null,a(n.contract.bank_account.account_name),1)]),e("div",null,[e("span",null,a(t.$t("models.user.accountNumber"))+":",1),e("span",null,[p(a(n.contract.bank_account.account_number)+" ",1),e("i",{class:"far fa-copy",onClick:o[0]||(o[0]=s=>t.$mf.copyText(n.contract.bank_account.account_number))})])]),e("div",null,[e("span",null,a(t.$t("models.contract.transfer.amount"))+":",1),e("span",null,[p(a(n.contract.advance|t.currency())+" ",1),e("i",{class:"far fa-copy",onClick:o[1]||(o[1]=s=>t.$mf.copyText(n.contract.advance))})])]),e("div",null,[e("span",null,a(t.$t("models.contract.transfer.content"))+":",1),e("span",null,[p(a(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",n.contract.code))+" ",1),e("i",{class:"far fa-copy",onClick:o[2]||(o[2]=s=>t.$mf.copyText(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",n.contract.code)))})])]),e("div",W,a(t.$t("models.contract.transfer.note")),1)])])])]),way2Template:l(()=>[e("div",F,[c(f,{text:t.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:o[3]||(o[3]=()=>t.$refs.pdf.download({component:"WithdrawReceiptPdf",contract:n.contract,isPreview:n.formData.isPdfPreview}))},null,8,["text"]),t.$devices.phone?h("",!0):(m(),v(w,{key:0,modelValue:n.formData.isPdfPreview,"onUpdate:modelValue":o[4]||(o[4]=s=>n.formData.isPdfPreview=s),text:t.$t("components.withdrawnContract.preview")},null,8,["modelValue","text"]))])]),_:1},8,["items"])]),step2Template:l(()=>[(m(),u("div",{class:"upload",key:n.refreshKey},[e("div",K,[e("input",{ref:"receiptImage",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:o[5]||(o[5]=(...s)=>r.onUploadImageChange&&r.onUploadImageChange(...s))},null,544),e("label",M,[O,p(" "+a(t.$t("titles.chooseImage")),1)]),c(w,{id:"contractDelete",modelValue:n.formData.isDelete,"onUpdate:modelValue":o[6]||(o[6]=s=>n.formData.isDelete=s),text:t.$t("titles.deleteOldImage"),onValueChanged:r.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])])]))]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"]),t.$mf.isSet(n.contract)?(m(),v(C,{key:0,ref:"pdf"},null,512)):h("",!0)])}const Y=g(S,[["render",j]]);export{Y as default};
