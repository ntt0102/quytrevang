import{_ as P,b as k,c as u,e as a,w as l,f as D,g as f,r,o as m,d as s,h as c,t as h,i as I}from"./app-49a0ecdf.js";import{_ as x}from"./accordion-266191fa.js";import{P as v}from"./Index-53766997.js";import"./interest-formula-45587e77.js";const S={components:{DxAccordion:x,Pdf:v},data(){return{refreshKey:0,contract:{},formData:{},backupDocuments:[]}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance}},methods:{...k("Admin.contracts",["paidContract"]),show(e){this.popup.option("title",this.$t(`components.paidContract.${e.status==2?"confirmTitle":"title"}`)+" #"+e.code),this.contract=e,this.formData.isConfirmed=!!e.confirmed_by,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",e.status==0?0:1),500),this.backupDocuments=e.url_paid_docs.map(t=>({file:t,isUpload:!1})),this.formData.documents=this.backupDocuments,this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(e){this.formData.documents=this.formData.documents.filter(t=>!t.isUpload),[...e.target.files].forEach(t=>this.formData.documents.push({file:URL.createObjectURL(t),isUpload:!0}))},onCheckBoxDeleteChange(e){e.value?this.formData.documents=this.formData.documents.filter(t=>t.isUpload):this.formData.documents=this.backupDocuments.concat(this.formData.documents)},onSubmit(){this.$bus.emit("checkPin",async()=>{let e=new FormData;if(e.append("contractId",this.contract.id),e.append("isDelete",this.formData.isDelete),e.append("isConfirmed",this.formData.isConfirmed),this.$refs.receiptImage)for(var t=0;t<this.$refs.receiptImage.files.length;t++){let p=await this.$mf.resizeImage({file:this.$refs.receiptImage.files[t],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});e.append(`receiptImages[${t}]`,p)}this.paidContract(e).then(p=>{p&&this.popup.hide()})})},initFormData(){this.formData={isPdfPreview:!1,isDelete:!1,isConfirmed:!1,documents:[]}},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}},V={ref:"submit",class:"display-none"},B={class:"step1"},U={class:"download"},$={class:"upload-browser"},A={for:"receiptImage"},T=s("i",{class:"far fa-file-upload"},null,-1),H={class:"is-confirmed"},R={key:0};function L(e,t,p,z,o,n){const g=r("DxButton"),d=r("DxCheckBox"),C=r("DxAccordion"),_=r("RouterLink"),b=r("DxScrollView"),w=r("DxPopup"),y=r("Pdf");return m(),u("div",null,[a(w,{ref:"popup",showCloseButton:!0,fullScreen:!!e.$screen.getScreenSizeInfo.isXSmall,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:()=>e.$refs.submit.click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>n.popup.hide()}}],wrapperAttr:{class:"confirm-contract-popup"},onHiding:n.onHiding},{content:l(()=>[a(b,null,{default:l(()=>[s("form",{onSubmit:t[5]||(t[5]=I((...i)=>n.onSubmit&&n.onSubmit(...i),["prevent"]))},[s("button",V,null,512),a(C,{ref:"accordion",collapsible:!0,selectedIndex:0,items:[{title:e.$t("components.paidContract.step1"),template:"step1Template"},{title:e.$t("components.paidContract.step2"),template:"step2Template"}]},{step1Template:l(()=>[s("div",B,[s("div",U,[a(g,{text:e.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:t[0]||(t[0]=()=>e.$refs.pdf.download({component:"PayReceiptPdf",contract:o.contract,isPreview:o.formData.isPdfPreview}))},null,8,["text"]),e.$screen.getScreenSizeInfo.isXSmall?f("",!0):(m(),D(d,{key:0,modelValue:o.formData.isPdfPreview,"onUpdate:modelValue":t[1]||(t[1]=i=>o.formData.isPdfPreview=i),text:e.$t("components.paidContract.preview")},null,8,["modelValue","text"]))])])]),step2Template:l(()=>[(m(),u("div",{class:"upload",key:o.refreshKey},[s("div",$,[s("input",{ref:"receiptImage",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:t[2]||(t[2]=(...i)=>n.onUploadImageChange&&n.onUploadImageChange(...i))},null,544),s("label",A,[T,c(" "+h(e.$t("titles.chooseImage")),1)]),a(d,{id:"contractDelete",modelValue:o.formData.isDelete,"onUpdate:modelValue":t[3]||(t[3]=i=>o.formData.isDelete=i),text:e.$t("titles.deleteOldImage"),onValueChanged:n.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])])]))]),_:1},8,["items"]),s("div",H,[a(d,{modelValue:o.formData.isConfirmed,"onUpdate:modelValue":t[4]||(t[4]=i=>o.formData.isConfirmed=i),text:e.$t("components.paidContract.isConfirmed")},null,8,["modelValue","text"]),o.contract.confirmed_by?(m(),u("div",R,[c(" ("+h(e.$t("components.paidContract.confirmedBy"))+" ",1),a(_,{to:{name:"users",query:{code:o.contract.confirmed_by}}},{default:l(()=>[c("#"+h(o.contract.confirmed_by),1)]),_:1},8,["to"]),c(") ")])):f("",!0)])],32)]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"]),e.$mf.isSet(o.contract)?(m(),D(y,{key:0,ref:"pdf"},null,512)):f("",!0)])}const M=P(S,[["render",L]]);export{M as default};
