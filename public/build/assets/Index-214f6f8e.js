import{_ as D,j as S,m as h,b as f,c as T,d as v,t as R,e as a,w as u,r as d,o as p,f as g,g as y}from"./app-4ce1eb1f.js";import{D as B,a as P}from"./data-grid-3cdc16e0.js";import{L as x}from"./ListTagBox-593a768b.js";import E from"./DeletedUsersPopup-fb0f0166.js";import F from"./ConfirmUserPopup-d19e41b6.js";import{U as I}from"./UserDetailPopup-6020f980.js";import"./row_dragging-e1375391.js";import"./dialog-341a11a8.js";import"./exporter-6daaf42a.js";import"./accordion-160a7443.js";import"./Index-6f27b19f.js";import"./interest-formula-45587e77.js";const q={components:{DxDataGrid:B,DxColumn:P,ListTagBox:x,DeletedUsersPopup:E,ConfirmUserPopup:F,UserDetailPopup:I},data(){return{gridData:null,banks:[],rolesCalculateFilterExpression:function(e,i,n){return n==="search"&&typeof e=="string"?[this.dataField,"contains",e]:function(r){return(r.roles||[]).indexOf(e)!==-1}},permissionsCalculateFilterExpression:function(e,i,n){return n==="search"&&typeof e=="string"?[this.dataField,"contains",e]:function(r){return(r.permissions||[]).indexOf(e)!==-1}},validationRules:{name:[{type:"required",message:this.$t("models.user.name")+this.$mt.validations.required},{type:"stringLength",max:50,message:this.$t("models.user.validations.name")}],sex:[{type:"required",message:this.$t("models.user.sex")+this.$mt.validations.required}],role:[{type:"required",message:this.$t("models.user.roles")+this.$mt.validations.required}],birthday:[{type:"required",message:this.$t("models.user.birthday")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateBirthday,message:this.$t("models.user.validations.birthday")}],idNumber:[{type:"required",message:this.$t("models.user.idNumber")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateIdNumber,message:this.$t("models.user.idNumber")+this.$mt.validations.duplicate}],idIssuedOn:[{type:"required",message:this.$t("models.user.idIssuedOn")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateIdIssuedOn,message:this.$t("models.user.validations.idIssuedOn")}],phone:[{type:"required",message:this.$t("models.user.phone")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicatePhone,message:this.$t("models.user.phone")+this.$mt.validations.duplicate}],email:[{type:"required",message:this.$t("models.user.email")+this.$mt.validations.required},{type:"email",message:this.$t("models.user.email")+this.$mt.validations.email},{type:"async",validationCallback:this.validateDuplicateEmail,message:this.$t("models.user.email")+this.$mt.validations.duplicate}],address:[{type:"required",message:this.$t("models.user.address")+this.$mt.validations.required},{type:"stringLength",max:100,message:this.$t("models.user.validations.address")}]}}},beforeCreate(){this.$store.registerModule("Admin.users",S)},created(){this.fetch().then(()=>this.$mf.getBanks()).then(e=>this.banks=e)},destroyed(){this.$store.unregisterModule("Admin.users")},computed:{...h("Auth",["permissions","code"]),...h("Admin.users",["users","allRolesName","allPermissionsName"]),dataGrid:function(){return this.$refs.dataGrid.instance},contextMenu:function(){return this.$refs.contextMenu.instance}},watch:{users(){this.cloneDeepData()}},methods:{...f("Admin.users",["fetch","save","validateDuplicateEmail","validateDuplicateIdNumber","validateDuplicatePhone","resetState"]),...f("User.layout",["initLayout"]),onSaved(e){e.isDeleted=!1,this.save(e)},onToolbarPreparing(e){e.toolbarOptions.items.unshift({visible:this.$mf.isSet(this.$route.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:this.$t("buttons.back"),onClick:()=>{this.$router.go(-1)}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-share-square small",hint:this.$t("admin.users.buttons.sendNotification"),text:this.$t("admin.users.buttons.sendNotification"),onClick:()=>{this.dataGrid.getSelectedRowKeys().length>0?this.$router.push({name:"setting-notification",query:{codes:this.dataGrid.getSelectedRowKeys().join(",")}}):this.$toasted.show(this.$t("messages.info.noSelectedRow"))}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-trash small",hint:this.$t("admin.users.buttons.selectedDelete"),text:this.$t("admin.users.buttons.selectedDelete"),onClick:()=>{let i=this.dataGrid.getSelectedRowKeys();i.length>0?(this.$bus.emit("checkPin",()=>{this.dataGrid.option("editing.mode","batch"),i.forEach(n=>{this.dataGrid.deleteRow(this.dataGrid.getRowIndexByKey(n))}),this.dataGrid.saveEditData()}),this.dataGrid.option("editing.mode","popup")):this.$toasted.show(this.$t("messages.info.noSelectedRow"))}}},{locateInMenu:"auto",showText:"inMenu",location:"before",widget:"dxButton",options:{icon:"far fa-user-times small",hint:this.$t("admin.users.deletedUsers"),text:this.$t("admin.users.deletedUsers"),onClick:()=>this.$refs.deletedUsersPopup.show()}})},tagBoxCellTemplate(e,i){var n="Â ",r=(i.value||[]).map(o=>i.column.lookup.calculateCellValue(o)).join(", ");e.textContent=r||n,e.title=r},onValueChanged(e,i){i.setValue(e),i.component.updateDimensions()},validateBirthday(e){return moment(e.value).isBefore(moment().subtract(18,"years"))},validateIdIssuedOn(e){return moment(e.value).isBefore(moment().subtract(1,"day"))},onInitNewRow(e){e.data.roles=["user"],e.data.bank_account={},this.dataGrid.option("editing.popup.title",this.$t("models.user.popup.create"))},onEditingStart(e){this.dataGrid.option("editing.popup.title",`${this.$t("models.user.popup.edit")} #${e.data.code}`)},cloneDeepData(){this.gridData=this.$mf.cloneDeep(this.users),this.$route.query.code&&this.dataGrid.columnOption("code","filterValues",[+this.$route.query.code]),this.$route.query.selected&&setTimeout(()=>this.dataGrid.selectRows(this.$route.query.selected.split(","),!0),0)},onShown(e){this.$mf.checkPinDataGrid(e,this),this.$mf.pushPopupToHistoryState(()=>this.dataGrid.cancelEditData())},onCellPrepared(e){if(e.rowType==="data"){if(e.column.dataField==="level"){let i;e.value<4?i="#adadad":e.value==4?i="#edc578":i="#86c285",e.cellElement.style.color=i}e.column.dataField==="phone"&&(e.cellElement.innerHTML=this.$options.filters.phone(e.value))}},onCellDblClick(e){e.rowType=="data"&&e.columnIndex==5&&this.$mf.openLink(`https://zalo.me/${e.data.phone}`)}}},G={class:"users-page"},M={class:"content-block"},N={class:"content-block dx-card responsive-paddings"};function U(e,i,n,r,o,l){const s=d("DxColumn"),c=d("ListTagBox"),b=d("DxToolbar"),$=d("DxDataGrid"),w=d("DeletedUsersPopup"),C=d("ConfirmUserPopup"),k=d("UserDetailPopup");return p(),T("div",G,[v("h2",M,R(e.$t("admin.users.title")),1),v("div",N,[a($,{ref:"dataGrid","data-source":o.gridData,"key-expr":"code","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget","column-chooser":{enabled:!0,mode:"select",allowSearch:!0},paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"multiple",showCheckBoxesMode:"always"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"popup",popup:{showTitle:!0,onShown:l.onShown,onHiding:e.$mf.popRouteHistoryState},form:{colCount:2,labelLocation:e.$devices.phone?"top":"left",items:[{itemType:"group",caption:e.$t("models.user.groups.personalInfo"),items:[{dataField:"name"},{dataField:"sex"},{dataField:"birthday"}]},{itemType:"group",caption:e.$t("models.user.groups.idInfo"),items:[{dataField:"identity.number"},{dataField:"identity.issued_on"},{dataField:"",editorOptions:{value:e.$mt.idIssuedAtValue,readOnly:!0},label:{text:e.$t("models.user.idIssuedAt")}}]},{colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.contactInfo"),items:[{dataField:"phone"},{dataField:"email"},{dataField:"address",colSpan:2}]},{colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.bankInfo"),items:[{dataField:"bank_account.bank_name"},{dataField:"bank_account.account_name"},{dataField:"bank_account.account_number"}]},{visible:e.permissions.includes("system@control"),colCount:2,colSpan:2,itemType:"group",caption:e.$t("models.user.groups.permission"),items:[{dataField:"roles",colSpan:2},{dataField:"permissions",colSpan:2}]}]}},onCellPrepared:l.onCellPrepared,onContentReady:i[0]||(i[0]=t=>e.$mf.dataGridPreload(o.gridData,l.dataGrid)),onToolbarPreparing:l.onToolbarPreparing,onInitNewRow:l.onInitNewRow,onEditingStart:l.onEditingStart,onCellDblClick:l.onCellDblClick,onSaved:l.onSaved},{avatarCellTemplate:u(({})=>[]),roleTagBoxEditor:u(({data:t})=>[a(c,{value:t.value,"on-value-changed":m=>l.onValueChanged(m,t),"data-source":e.allRolesName,"data-grid-component":t.component},null,8,["value","on-value-changed","data-source","data-grid-component"])]),permissionTagBoxEditor:u(({data:t})=>[a(c,{value:t.value,"on-value-changed":m=>l.onValueChanged(m,t),"data-source":e.allPermissionsName,"data-grid-component":t.component},null,8,["value","on-value-changed","data-source","data-grid-component"])]),commandCellTemplate:u(({data:t})=>[a(b,{items:[{visible:[4,5].includes(t.data.level)||e.permissions.includes("system@control")&&t.data.level>5,locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${t.data.level==4?"check":"file-check"} small`,hint:e.$t(`components.confirmUser.${t.data.level==4?"title":"confirmedTitle"}`),text:e.$t(`components.confirmUser.${t.data.level==4?"title":"confirmedTitle"}`),onClick:()=>e.$refs.confirmUserPopup.show({user:t.data})}},{visible:t.data.level>=6,locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"far fa-usd-circle small",hint:e.$t("admin.users.buttons.viewContract"),text:e.$t("admin.users.buttons.viewContract"),onClick:()=>e.$router.push({name:"contracts",query:{userCode:t.data.code}})}},{visible:!t.data.permissions.includes("system@control")||e.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"edit",hint:e.$t("buttons.edit"),text:e.$t("buttons.edit"),onClick:()=>l.dataGrid.editRow(t.rowIndex)}},{visible:t.data.level<=6&&t.data.code!=e.code&&!t.data.permissions.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:e.$t("buttons.delete"),text:e.$t("buttons.delete"),onClick:()=>e.$bus.emit("checkPin",()=>l.dataGrid.deleteRow(t.rowIndex))}},{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"info",hint:e.$t("admin.users.detailUser"),text:e.$t("admin.users.detailUser"),onClick:()=>e.$refs.userDetailPopup.show({user:t.data})}}]},null,8,["items"])]),default:u(()=>[a(s,{fixed:!0,width:e.$devices.phone?35:125,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:e.$t(`titles.commandHeaderTitle${e.$devices.phone?"Short":""}`)},null,8,["width","caption"]),a(s,{width:60,"allow-sorting":!1,allowFiltering:!1,"data-field":"url_avatar","cell-template":"avatarCellTemplate",cssClass:"avatar-column",caption:e.$t("models.user.avatar")},null,8,["caption"]),a(s,{"allow-editing":!1,"data-field":"code","data-type":"string","header-filter":{allowSearch:!0},name:"code",caption:e.$t("models.user.codeShort")},null,8,["caption"]),a(s,{"allow-editing":!1,"data-field":"level",dataType:"number",caption:e.$t("models.user.status"),lookup:{dataSource:e.$mf.getUserLevelList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),a(s,{"data-field":"name","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.name"),"validation-rules":o.validationRules.name},null,8,["caption","validation-rules"]),a(s,{visible:!1,"data-field":"sex","data-type":"number",caption:e.$t("models.user.sex"),"validation-rules":o.validationRules.sex,lookup:{dataSource:e.$mf.getSexList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","validation-rules","lookup"]),a(s,{visible:!1,"data-field":"birthday","data-type":"date","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},caption:e.$t("models.user.birthday"),"validation-rules":o.validationRules.birthday},null,8,["editor-options","caption","validation-rules"]),a(s,{visible:!1,"data-field":"identity.number","data-type":"string","editor-options":{mask:"000000000000"},"header-filter":{allowSearch:!0},caption:e.$t("models.user.idNumber"),"validation-rules":o.validationRules.idNumber},null,8,["caption","validation-rules"]),a(s,{visible:!1,"data-field":"identity.issued_on","data-type":"date","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},caption:e.$t("models.user.idIssuedOn"),"validation-rules":o.validationRules.idIssuedOn},null,8,["editor-options","caption","validation-rules"]),a(s,{"data-field":"phone","data-type":"string","editor-options":{mask:"0000.000.000"},"header-filter":{allowSearch:!0},caption:e.$t("models.user.phone"),"validation-rules":o.validationRules.phone},null,8,["editor-options","caption","validation-rules"]),a(s,{visible:!1,"data-field":"email","data-type":"string",name:"email","header-filter":{allowSearch:!0},caption:e.$t("models.user.email"),"validation-rules":o.validationRules.email},null,8,["caption","validation-rules"]),a(s,{visible:!1,"data-field":"address","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.address"),"validation-rules":o.validationRules.address},null,8,["caption","validation-rules"]),a(s,{visible:!1,"data-field":"bank_account.bank_name","data-type":"string",lookup:{dataSource:o.banks,displayExpr:"short_name",valueExpr:"short_name",allowClearing:!0},"header-filter":{allowSearch:!0},caption:e.$t("models.user.bankName")},null,8,["lookup","caption"]),a(s,{visible:!1,"data-field":"bank_account.account_name","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.accountName")},null,8,["caption"]),a(s,{visible:!1,"data-field":"bank_account.account_number","data-type":"string","header-filter":{allowSearch:!0},caption:e.$t("models.user.accountNumber")},null,8,["caption"]),e.permissions.includes("system@control")?(p(),g(s,{key:0,visible:!1,"allow-sorting":!1,"data-field":"roles","data-type":"string","cell-template":l.tagBoxCellTemplate,"calculate-filter-expression":o.rolesCalculateFilterExpression,caption:e.$t("models.user.roles"),"edit-cell-template":"roleTagBoxEditor","validation-rules":o.validationRules.role,lookup:{dataSource:e.allRolesName}},null,8,["cell-template","calculate-filter-expression","caption","validation-rules","lookup"])):y("",!0),e.permissions.includes("system@control")?(p(),g(s,{key:1,visible:!1,"allow-sorting":!1,"data-field":"permissions","data-type":"string","cell-template":l.tagBoxCellTemplate,"calculate-filter-expression":o.permissionsCalculateFilterExpression,caption:e.$t("models.user.permissions"),"edit-cell-template":"permissionTagBoxEditor",lookup:{dataSource:e.allPermissionsName}},null,8,["cell-template","calculate-filter-expression","caption","lookup"])):y("",!0)]),_:1},8,["data-source","editing","onCellPrepared","onToolbarPreparing","onInitNewRow","onEditingStart","onCellDblClick","onSaved"])]),a(w,{ref:"deletedUsersPopup"},null,512),a(C,{ref:"confirmUserPopup"},null,512),a(k,{ref:"userDetailPopup"},null,512)])}const W=D(q,[["render",U]]);export{W as default};
