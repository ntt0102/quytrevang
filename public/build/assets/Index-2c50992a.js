import{y as jt,u as Ht,c as Wt,i as se,r as x,d as Yt,e as Ee,x as zt,z as Ut,w as De,v as P,f as Xt,g as Zt,h as m,j as ae,A as ge,t as _e,B as V,C as Kt,E as Gt,G as B,F as Jt,H as Re,I as Qt,o as er}from"./app-046cf3d5.js";import tr from"./CopyistStatusPopup-f8cb7e41.js";import{c as rr,_ as ir}from"./DailyCashFlowPopup-de35b2fe.js";import or from"./ColorPicker-fb750406.js";const sr="/build/assets/spinner-4da4a8c6.gif";class ar{constructor(){this.create()}create(){return new Promise((k,b)=>{const h=indexedDB.open("orderChart",1);h.onupgradeneeded=c=>{this.store=c.target.result,this.store.createObjectStore("order",{keyPath:"kind"}),this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("box",{keyPath:"point"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("pattern2",{keyPath:"point"}),this.store.createObjectStore("volprofile",{keyPath:"time"}),this.store.createObjectStore("alert",{keyPath:"price"}),k()},h.onsuccess=c=>{this.store=c.target.result,k()},h.onerror=()=>{location.reload(),b()}})}get(k){var b=this.store;return new Promise(function(c,f){var I=b.transaction(k,"readonly");if(Array.isArray(k)){var g=k.map(O=>I.objectStore(O)),W=g.map(h);Promise.all(W).then(O=>c(O))}else{var Y=I.objectStore(k);h(Y).then(O=>c(O))}});function h(c){return new Promise(function(f,I){const g=c.getAll();g.onsuccess=W=>f(W.target.result),g.onerror=()=>I()})}}set(k,b){const h=this.store.transaction(k,"readwrite").objectStore(k);Array.isArray(b)?b.length>0&&b.forEach(c=>h.put(c)):h.put(b)}clear(k){var b=this.store;return new Promise(function(h,c){const f=b.transaction(k,"readwrite").objectStore(k).clear();f.onsuccess=()=>{h()},f.onerror=I=>{console.error(`Error to empty Object Store: ${k}`),c()}})}}const o=new ar,lr="/build/assets/alert-4d705e53.mp3";const nr={class:"content-block dx-card responsive-paddings"},cr={class:"area data-area"},dr=["title"],pr=["title"],ur={class:"command noaction clock"},fr=["title"],vr={class:"area tool-area"},mr=["title"],hr=["title"],gr=["title"],yr=["title"],Cr=["title"],xr=["title"],br=["title"],Or=["title"],kr=["title"],Sr=["title"],Pr=["title"],Lr=["title"],Tr=["title"],wr=["title"],Fr=["src"],Ae=3,$e=2,Er="wss://datafeed.vps.com.vn/socket.io/?EIO=3&transport=websocket",Dr=120,_r={__name:"Index",setup(Me){const k={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:20,minBarSpacing:.01}},b=moment().format("YYYY-MM-DD"),h={START:moment(b+" 08:45:00").unix(),ATO:moment(b+" 09:00:00").unix(),ATC:moment(b+" 14:30:00").unix(),END:moment(b+" 14:45:00").unix()},c=Ht(),{t:f}=Wt(),I=se("devices"),g=se("mf"),W=se("bus"),Y=se("filters"),O=x(null),ye=x(null),z=x(null),Ce=x(null),xe=x(null),be=x(null),Oe=x(null),Ve=x(null),U=x(null),K=x(null),le=x(null),ne=x(null),ce=x(null),de=x(null),pe=x(null),G=x(null),J=x(null),q=x(null),X=x(null),Be=x(null);let e={chart:{},series:{},data:{whitespace:[],price:[],volume:[],spread:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},l1:{},l2:{},l3:{},l4:{},l5:{},pointCount:0},pattern1:{A:{},B:{},C:{},X:{},Y:{},Z:{}},pattern2:{E:{},S:{},T:{}},volprofile:{v1:{},v2:{},poc:{},pointCount:0},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const v=Yt({chartDate:b,clock:moment().format("HH:mm:ss"),isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),F=Ee(()=>c.state.tradingOrder.status),Ie=Ee(()=>`https://chart.vps.com.vn/tv/?loadLastChart=true&symbol=VN30F1M&u=${c.state.tradingOrder.config.vpsCode}&s=${c.state.tradingOrder.config.vpsSession}&resolution=1`);c.dispatch("tradingOrder/getConfig").then(()=>{ue()}),c.dispatch("tradingOrder/getStatus"),e.interval=setInterval(Je,1e3),e.interval60=setInterval(()=>c.dispatch("tradingOrder/getStatus"),6e4),o.create(),zt(()=>{e.chart=rr(ye.value,k),O.value.addEventListener("click",Ne),O.value.addEventListener("contextmenu",qe),e.chart.subscribeCrosshairMove(je),e.chart.subscribeCustomPriceLineDragged(He),e.series.whitespace=e.chart.addLineSeries({priceScaleId:"whitespace",visible:!1}),e.series.signal=e.chart.addHistogramSeries({priceScaleId:"signal",scaleMargins:{top:0,bottom:0},color:"#673AB7",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),e.series.box=e.chart.addHistogramSeries({priceScaleId:"box",scaleMargins:{top:0,bottom:0},color:"#26a69a",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),e.series.volprofile=e.chart.addHistogramSeries({priceScaleId:"volprofile",scaleMargins:{top:0,bottom:0},color:"#673AB7",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),e.series.volume=e.chart.addHistogramSeries({priceScaleId:"volume",scaleMargins:{top:.95,bottom:0},color:"#CCCCCC",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),e.series.spread=e.chart.addHistogramSeries({priceScaleId:"spread",scaleMargins:{top:0,bottom:.95},color:"#CCCCCC",lastValueVisible:!1,priceLineVisible:!1,visible:!1}),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",lastValueVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.1}}),new ResizeObserver(We).observe(O.value),document.addEventListener("keydown",Ye),document.addEventListener("fullscreenchange",ze),c.dispatch("tradingOrder/getChartData",v.chartDate).then(()=>{Xe()})}),Ut(()=>{clearInterval(e.interval),clearInterval(e.interval60),e.socketStop=!0,e.websocket.close(),e.websocket=null}),De(()=>c.state.tradingOrder.chartData,Ze),De(()=>c.state.tradingOrder.isChartLoading,t=>{Ce.value.style.display=t?"block":"none"});function qe(t){Qe(),t.preventDefault()}function Ne(){fe(),U.value.classList.contains("selected")?Q():pe.value.classList.contains("selected")?ct():K.value.classList.contains("selected")?ut():le.value.classList.contains("selected")?mt():ne.value.classList.contains("selected")?Te():de.value.classList.contains("selected")?bt():ce.value.classList.contains("selected")?(he(),Fe()):G.value.classList.contains("selected")&&wt()}function je(t){if(t.time){var r=t.seriesPrices.get(e.series.price);e.crosshair.time=t.time,e.crosshair.price=r}else I.phone||(e.crosshair.time=null,e.crosshair.price=null);t.point!=null&&(e.crosshair.x=t.point.x,e.crosshair.y=t.point.y)}function He(t){var r=t.customPriceLine,i=r.options();i.price=re(i.price);const s=+t.fromPriceString,a=i.price;switch(i.lineType){case"order":if(a!=s){var n=!1;i.kind=="entry"?F.value.position||(n=!0,e.order[i.kind].price=a,c.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"change",price:e.order.entry.price}}).then(d=>{d.isOk?(A(i.kind),P.success(f("trading.orderChart.changeEntrySuccess"))):(r.applyOptions({price:s}),w(d.message))})):(n=!0,e.order[i.kind].price=a,i.kind=="tp"?c.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"change",price:e.order.tp.price}}).then(d=>{d.isOk?(A(i.kind),P.success(f("trading.orderChart.changeTpSuccess"))):(r.applyOptions({price:s}),w(d.message))}):c.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"change",price:e.order.sl.price}}).then(d=>{d.isOk?(A(i.kind),P.success(f("trading.orderChart.changeSlSuccess"))):(r.applyOptions({price:s}),w(d.message))})),n||(r.applyOptions({price:s}),P.show(f("trading.orderChart.noChangeOrderLine")))}break;case"line":o.set("line",{price:s,removed:!0}),o.set("line",i),U.value.classList.remove("selected");break;case"ruler":switch(i.point){case"l0":if(o.set("ruler",i),e.ruler.pointCount==2){const R=+e.ruler.l1.options().title,H=+(a+R).toFixed(1);e.ruler.l1.applyOptions({price:H}),o.set("ruler",e.ruler.l1.options());const ie=+(a+R*2).toFixed(1);e.ruler.l2.applyOptions({price:ie}),o.set("ruler",e.ruler.l2.options());const oe=+(a+R*3).toFixed(1);e.ruler.l3.applyOptions({price:oe}),o.set("ruler",e.ruler.l3.options());const qt=+(a+R*4).toFixed(1);e.ruler.l4.applyOptions({price:qt}),o.set("ruler",e.ruler.l4.options());const Nt=+(a+R*5).toFixed(1);e.ruler.l5.applyOptions({price:Nt}),o.set("ruler",e.ruler.l5.options())}break;case"l1":const d=+e.ruler.l0.options().price,y=a-d;r.applyOptions({title:y.toFixed(1)}),o.set("ruler",r.options()),e.ruler.l2.applyOptions({title:(y*2).toFixed(1),price:+(d+y*2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(y*3).toFixed(1),price:+(d+y*3).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(y*4).toFixed(1),price:+(d+y*4).toFixed(1)}),o.set("ruler",e.ruler.l4.options()),e.ruler.l5.applyOptions({title:(y*5).toFixed(1),price:+(d+y*5).toFixed(1)}),o.set("ruler",e.ruler.l5.options());break;case"l2":const L=+e.ruler.l0.options().price,C=a-L;r.applyOptions({title:C.toFixed(1)}),o.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(C*.5).toFixed(1),price:+(L+C*.5).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(C*1.5).toFixed(1),price:+(L+C*1.5).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(C*2).toFixed(1),price:+(L+C*2).toFixed(1)}),o.set("ruler",e.ruler.l4.options()),e.ruler.l5.applyOptions({title:(C*2.5).toFixed(1),price:+(L+C*2.5).toFixed(1)}),o.set("ruler",e.ruler.l5.options());break;case"l3":const E=+e.ruler.l0.options().price,p=a-E;r.applyOptions({title:p.toFixed(1)}),o.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(p/3).toFixed(1),price:+(E+p/3).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(p*2/3).toFixed(1),price:+(E+p*2/3).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l4.applyOptions({title:(p*4/3).toFixed(1),price:+(E+p*4/3).toFixed(1)}),o.set("ruler",e.ruler.l4.options()),e.ruler.l5.applyOptions({title:(p*5/3).toFixed(1),price:+(E+p*5/3).toFixed(1)}),o.set("ruler",e.ruler.l5.options());break;case"l4":const D=+e.ruler.l0.options().price,_=a-D;r.applyOptions({title:_.toFixed(1)}),o.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(_/4).toFixed(1),price:+(D+_/4).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(_/2).toFixed(1),price:+(D+_/2).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(_*3/4).toFixed(1),price:+(D+_*3/4).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l5.applyOptions({title:(_*5/4).toFixed(1),price:+(D+_*5/4).toFixed(1)}),o.set("ruler",e.ruler.l5.options());break;case"l5":const j=+e.ruler.l0.options().price,S=a-j;r.applyOptions({title:S.toFixed(1)}),o.set("ruler",r.options()),e.ruler.l1.applyOptions({title:(S/5).toFixed(1),price:+(j+S/5).toFixed(1)}),o.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(S*2/5).toFixed(1),price:+(j+S*2/5).toFixed(1)}),o.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(S*3/5).toFixed(1),price:+(j+S*3/5).toFixed(1)}),o.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(S*4/5).toFixed(1),price:+(j+S*4/5).toFixed(1)}),o.set("ruler",e.ruler.l4.options());break}break;case"pattern1":if(g.isSet(e.pattern1.X)){const d=+e.pattern1.A.options().price,y=+e.pattern1.B.options().price,L=+e.pattern1.C.options().price,C=y-d;e.pattern1.X.applyOptions({price:+(L+C).toFixed(1),title:C.toFixed(1)}),o.set("pattern1",e.pattern1.X.options()),e.pattern1.Y.applyOptions({price:+(L+1.5*C).toFixed(1),title:(1.5*C).toFixed(1)}),o.set("pattern1",e.pattern1.Y.options()),e.pattern1.Z.applyOptions({price:+(L+2*C).toFixed(1),title:(2*C).toFixed(1)}),o.set("pattern1",e.pattern1.Z.options())}break;case"pattern2":if(g.isSet(e.pattern2.T)){const d=e.pattern2.E.options(),y=+d.price1,L=+d.price2,C=+d.price3,E=+d.price4,p=+d.price,D=C-L,_=y-E,j=C-E,S=p-E;let R,H;i.point=="S"?(H=+e.pattern2.S.options().price,R=p-H):(R=Math.abs(D)>Math.abs(S/2)?D:S/2,H=p-R,e.pattern2.S.applyOptions({price:+H.toFixed(1)}));const ie=H+(Math.abs(S)>Math.abs(j)?Math.abs(S)>Math.abs(_)?1:1.5:2)*S,oe=ie-p;e.pattern2.S.applyOptions({title:`SL=${(-R).toFixed(1)}`}),o.set("pattern2",e.pattern2.S.options()),e.pattern2.E.applyOptions({title:`RR=${(oe/R).toFixed(1)}`}),o.set("pattern2",e.pattern2.E.options()),e.pattern2.T.applyOptions({price:+ie.toFixed(1),title:`TP=${oe.toFixed(1)}`}),o.set("pattern2",e.pattern2.T.options())}break;case"alert":o.set("alert",{price:s,removed:!0});const u=e.data.price.slice(-1)[0].value;var l=a>=u?">":"<";r.applyOptions({title:l}),o.set("alert",r.options()),G.value.classList.remove("selected");break}}function We(){O.value&&(e.chart.resize(O.value.offsetWidth,O.value.offsetHeight),O.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Ye(t){if(t.ctrlKey||t.metaKey)switch(t.keyCode){case 38:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.05});break;case 40:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.05});break;case 37:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-10);break;case 39:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+10);break;case 96:K.value.click();break;case 97:U.value.click();break;case 98:be.value.click();break;case 99:xe.value.click();case 100:Oe.value.click();break}}function ze(){O.value&&(document.fullscreenElement?(v.isFullscreen=!0,O.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(v.isFullscreen=!1,O.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function Ue(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Xe(){return new Promise(async t=>{F.value.pending&&((await o.get("order")).map(y=>{e.order.side=y.side,e.order[y.kind].price=y.price,A(y.kind),M(!0)}),e.order.tp.hasOwnProperty("line")&&e.order.entry.line.applyOptions({draggable:!1})),(await o.get("line")).forEach(d=>{d.removed||e.lines.push(e.series.price.createPriceLine(d))});const i=await o.get("box");i.length==2&&(e.box=i,e.series.box.setData([i[0].x,i[1].x]),e.box[0].y=e.series.price.createPriceLine(i[0].y),e.box[1].y=e.series.price.createPriceLine(i[1].y));const s=await o.get("ruler");s.length>0&&(e.ruler.pointCount=s.length>1?2:1,s.forEach(d=>{e.ruler[d.point]=e.series.price.createPriceLine(d)}));const a=await o.get("pattern1");a.length>0&&a.forEach(d=>{e.pattern1[d.point]=e.series.price.createPriceLine(d)});const n=await o.get("pattern2");n.length>0&&n.forEach(d=>{e.pattern2[d.point]=e.series.price.createPriceLine(d)});const l=await o.get("volprofile");l.length>0&&(e.volprofile.v1=l[0],e.volprofile.pointCount++,e.series.volprofile.update(e.volprofile.v1),l.length==2&&(e.volprofile.v2=l[1],e.volprofile.pointCount++,e.series.volprofile.update(e.volprofile.v2)),me()),(await o.get("alert")).forEach(d=>{d.removed||e.alerts.push(e.series.price.createPriceLine(d))}),t()})}function Ze(){e.loadWhitespace&&(c.state.tradingOrder.chartData.price.length>0&&(e.data.whitespace=$(e.data.whitespace,Ge())),e.series.whitespace.setData(e.data.whitespace),e.loadWhitespace=!1),e.data.price=$(c.state.tradingOrder.chartData.price,e.data.price),e.series.price.setData(e.data.price),e.data.cash=$(c.state.tradingOrder.chartData.cash,e.data.cash),e.series.cash.setData(e.data.cash),e.data.volume=$(c.state.tradingOrder.chartData.volume,e.data.volume),e.series.volume.setData(e.data.volume),e.data.spread=$(c.state.tradingOrder.chartData.spread,e.data.spread),e.series.spread.setData(e.data.spread),e.shark=c.state.tradingOrder.chartData.shark}function Ke(t,r,i,s){e.data.price=$([t],e.data.price);const a=e.data.price.slice(-1)[0];e.series.price.update(a),e.data.volume=$([r],e.data.volume);const n=e.data.volume.slice(-1)[0];e.series.volume.update(n),e.data.spread=$([i],e.data.spread);const l=e.data.spread.slice(-1)[0];e.series.spread.update(l),e.data.cash=$([s],e.data.cash);const u=e.data.cash.slice(-1)[0];e.series.cash.update(u)}function Ge(){const t=v.chartDate,r=moment(`${t} 09:00:00`).unix(),i=moment(`${t} 11:30:00`).unix(),s=moment(`${t} 13:00:00`).unix(),a=moment(`${t} 14:30:00`).unix();var n=[],l;for(l=r;l<=i;l++)n.push({time:l+7*60*60});for(l=s;l<=a;l++)n.push({time:l+7*60*60});return n}function $(t,r){return Array.from(new Map([...t,...r].sort((i,s)=>i.time-s.time).map(i=>[i.time,i])).values())}function ue(){e.websocket=new WebSocket(Er),e.websocket.onopen=t=>{var r={action:"join",list:c.state.tradingOrder.config.symbol};e.websocket.send(`42${JSON.stringify(["regs",JSON.stringify(r)])}`)},e.websocket.onclose=t=>{if(e.socketStop)return!1;te()&&(ke(!1),ue(),moment().diff(e.socketRefreshTime,"seconds")>Dr&&(c.dispatch("tradingOrder/getChartData",v.chartDate),e.socketRefreshTime=moment()))},e.websocket.onmessage=t=>{if(ke(!0),t.data.substr(0,1)==4&&t.data.substr(1,1)==2){const r=JSON.parse(t.data.substr(2));if(r[0]=="stockps"){const i=r[1].data;if(i.id==3220){const s=moment(`${b} ${i.time}`).unix()+25200,a=e.data.price.length>0?i.lastPrice-e.data.price.slice(-1)[0].value:0;Ke({time:s,value:i.lastPrice},{time:s,value:i.lastVol,color:a>0?"#00FF00":a<0?"#FF0000":"#CCCCCC"},{time:s,value:-Math.abs(a),color:a>0?"#00FF00":a<0?"#FF0000":"#CCCCCC"},{time:s,value:e.data.cash.slice(-1)[0].value+a*i.lastVol}),Rt()}}}}}function Je(){const t=moment().unix();te(t)&&(F.value.position&&t>h.ATC-5*60&&(et(),t>h.ATC-15&&e.order.tp.hasOwnProperty("line")&&c.dispatch("tradingOrder/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(r=>{r.isOk?(T("entry"),T("tp"),T("sl"),M(!1),o.clear("order"),P.success(f("trading.orderChart.autoCancelTpSlSuccess")),Z()):w(r.message)})),t==h.START&&ue(),e.alerts.forEach(r=>{const i=r.options();if(!i.removed&&e.data.price.length){const s=e.data.price.slice(-1)[0].value;(i.title==">"&&s>=i.price||i.title=="<"&&s<=i.price)&&Z()}})),v.clock=moment().format("HH:mm:ss")}function Qe(){if(c.state.tradingOrder.config.openingMarket){const i=moment().unix();if(te(i)&&(e.order.tp.hasOwnProperty("line")||F.value.position&&i>h.ATO&&i<h.ATC&&(e.order.entry.price=e.data.price.slice(-1)[0].value,e.order.side=F.value.position,X.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",X.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",X.value.style.display="block"),!e.order.entry.hasOwnProperty("line"))){var t=null,r=0;F.value.position?(i<h.ATO?t="ATO":i>h.ATC&&(t="ATC"),t&&(e.order.entry.price=t,r=-F.value.position)):i>h.ATO&&i<h.ATC&&(t=N(e.crosshair.y),r=t>=e.data.price.slice(-1)[0].value?1:-1,e.order.side=r,e.order.entry.price=t),r&&(q.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",q.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",q.value.style.background=r>0?"green":"red",q.value.innerText=`${r>0?"LONG":"SHORT"} ${t}`,q.value.style.display="block")}}}function fe(){q.value.style.display="none",X.value.style.display="none"}function M(t){J.value.style.display=t?"block":"none"}function et(){J.value.classList.contains("blink")||J.value.classList.add("blink")}function ke(t){t?z.value.classList.contains("blink")&&z.value.classList.remove("blink"):z.value.classList.contains("blink")||z.value.classList.add("blink")}function A(t){var r,i;switch(t){case"entry":r="yellow",i=e.order.side>0?"LONG":"SHORT";break;case"tp":r="lime",i=Math.abs(e.order.tp.price-e.order.entry.price).toFixed(1);break;case"sl":r="red",i=Math.abs(e.order.sl.price-e.order.entry.price).toFixed(1);break}e.order[t].hasOwnProperty("line")?e.order[t].line.applyOptions({price:e.order[t].price,title:i}):e.order[t].line=e.series.price.createPriceLine({lineType:"order",kind:t,price:e.order[t].price,color:r,lineWidth:1,lineStyle:0,title:i,draggable:!0}),o.set("order",{kind:t,price:+e.order[t].price,side:e.order.side})}function T(t){e.order[t].hasOwnProperty("line")&&(e.series.price.removePriceLine(e.order[t].line),delete e.order[t].line)}function tt(t){v.showTradingView=!v.showTradingView,t.stopPropagation()}function rt(t){v.showColorPicker=!v.showColorPicker,t.stopPropagation()}function it(t){g.isSet(e.pattern1.X)&&(Q(+e.pattern1.X.options().price),Q(+e.pattern1.Y.options().price),Q(+e.pattern1.Z.options().price)),t.preventDefault(),t.stopPropagation()}function ot(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function st(t){at(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Q(t=null,r=null,i=null){const s="line";t||(t=re(N(e.crosshair.y))),r||(r=v.color);const a=e.lines.length;if(e.lines=e.lines.filter(n=>{const l=n.options(),u=l.type=t==+l.price;return u&&(e.series.price.removePriceLine(n),o.set("line",{price:t,removed:!0})),!u}),e.lines.length==a){const n={lineType:s,price:t,color:r,title:i,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(n)),o.set("line",n)}U.value.classList.remove("selected")}function at(){e.lines.forEach(t=>e.series.price.removePriceLine(t)),e.lines=[],o.clear("line")}function lt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function nt(t){Se(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ct(){if(e.crosshair.time){const t={value:N(e.crosshair.y),time:e.crosshair.time};if(e.box.length==0)ve({point2:t});else if(e.box.length==1)ve({point3:t});else{const r={value:+e.box[0].y.options().price,time:e.box[0].x.time},i={value:+e.box[1].y.options().price,time:e.box[1].x.time};Se(),ve({point2:r,point3:i,point4:t}),pe.value.classList.remove("selected")}}}function ve({point2:t,point3:r,point4:i}){let s={y:{color:"#26a69a",lineWidth:1,lineStyle:1,draggable:!1},x:{value:1}};if(g.isSet(i)){const a=e.data.whitespace.findIndex(d=>d.time===t.time),n=e.data.whitespace.findIndex(d=>d.time===r.time),u=e.data.whitespace.findIndex(d=>d.time===i.time)+n-a;if(u>=e.data.whitespace.length)return!1;s.y.price=i.value,s.x.time=i.time,ee(0,s),s.y.price=i.value+r.value-t.value,s.x.time=e.data.whitespace[u].time,ee(1,s)}else g.isSet(t)&&(s.y.price=t.value,s.x.time=t.time,ee(0,s)),g.isSet(r)&&(s.y.price=r.value,s.x.time=r.time,ee(1,s))}function ee(t,r){r.point=t,r.y.title=`B${t+1}`,e.box.push(g.cloneDeep(r)),o.set("box",e.box[t]),e.series.box.update(e.box[t].x),e.box[t].y=e.series.price.createPriceLine(e.box[t].y)}function Se(){e.box.length>0&&(e.series.price.removePriceLine(e.box[0].y),e.box.length>1&&e.series.price.removePriceLine(e.box[1].y)),e.series.box.setData([]),e.box=[],o.clear("box")}function dt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Pe()),t.stopPropagation()}function pt(t){Pe(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function ut(){const t=N(e.crosshair.y);var r={lineType:"ruler",price:t,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)r.point="l0",r.color="#F44336",r.title="0",e.ruler[r.point]=e.series.price.createPriceLine(r),e.ruler.pointCount++,o.set("ruler",r);else{const i=+e.ruler.l0.options().price,s=t-i;r.point="l1",r.color="#FF9800",r.title=s.toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),o.set("ruler",r);const a=2*s;r.point="l2",r.color="#FFEB3B",r.title=a.toFixed(1),r.price=+(i+a).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),o.set("ruler",r);const n=3*s;r.point="l3",r.color="#4CAF50",r.title=n.toFixed(1),r.price=+(i+n).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),o.set("ruler",r);const l=4*s;r.point="l4",r.color="#009688",r.title=l.toFixed(1),r.price=+(i+l).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),o.set("ruler",r);const u=5*s;r.point="l5",r.color="#00BCD4",r.title=u.toFixed(1),r.price=+(i+u).toFixed(1),e.ruler[r.point]=e.series.price.createPriceLine(r),o.set("ruler",r),e.ruler.pointCount++,K.value.classList.remove("selected")}}function Pe(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4),e.series.price.removePriceLine(e.ruler.l5)),e.ruler={l0:{},l1:{},l2:{},l3:{},l4:{},l5:{},pointCount:0},o.clear("ruler"))}function ft(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Le()),t.stopPropagation()}function vt(t){Le(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function mt(){var r={lineType:"pattern1",price:N(e.crosshair.y),lineWidth:1,lineStyle:1,draggable:!0};if(g.isSet(e.pattern1.A)?g.isSet(e.pattern1.B)?g.isSet(e.pattern1.C)||(r.point="C",r.title="C",r.color="#E91E63"):(r.point="B",r.title="B",r.color="#009688"):(r.point="A",r.title="A",r.color="#009688"),e.pattern1[r.point]=e.series.price.createPriceLine(r),o.set("pattern1",r),r.point=="C"){const i=+e.pattern1.A.options().price,s=+e.pattern1.B.options().price,a=+e.pattern1.C.options().price,n=s-i;r.point="X",r.price=+(a+n).toFixed(1),r.title=n.toFixed(1),r.color="#9C27B0",r.draggable=!1,e.pattern1[r.point]=e.series.price.createPriceLine(r),o.set("pattern1",r),r.point="Y",r.price=+(a+1.5*n).toFixed(1),r.title=(1.5*n).toFixed(1),r.color="#673AB7",e.pattern1[r.point]=e.series.price.createPriceLine(r),o.set("pattern1",r),r.point="Z",r.price=+(a+2*n).toFixed(1),r.title=(2*n).toFixed(1),r.color="#2196F3",e.pattern1[r.point]=e.series.price.createPriceLine(r),o.set("pattern1",r),le.value.classList.remove("selected")}}function Le(){g.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),g.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),g.isSet(e.pattern1.C)&&(e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X),e.series.price.removePriceLine(e.pattern1.Y),e.series.price.removePriceLine(e.pattern1.Z))),e.pattern1={A:{},B:{},C:{},X:{},Y:{},Z:{}},o.clear("pattern1"))}function ht(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||(t.target.classList.add("selected"),Te(!0)),t.stopPropagation()}function gt(t){we(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Te(t=!1){let r={};if(g.isSet(e.pattern2.E)){const D=e.pattern2.E.options();r={time:D.time1,value:D.price1},we()}else{if(t)return!1;r={time:e.crosshair.time,value:N(e.crosshair.y)}}const{point2:i,point3:s,point4:a,point5:n}=yt(r);if(i.value==r.value)return!1;const l=s.value-i.value,u=s.value-a.value,d=n.value-a.value,y=Math.abs(l)>Math.abs(d/2)?l:d/2,L=n.value-y,C=L+(Math.abs(d)>Math.abs(u)?1.5:2)*d,E=C-n.value;var p={lineType:"pattern2",lineWidth:1,lineStyle:1};p.price=n.value,p.time1=r.time,p.price1=r.value,p.price2=i.value,p.price3=s.value,p.price4=a.value,p.point="E",p.title=`RR=${(E/y).toFixed(1)}`,p.color="#FF9800",p.draggable=!0,e.pattern2[p.point]=e.series.price.createPriceLine(p),o.set("pattern2",p),p.price=+L.toFixed(1),p.point="S",p.title=`SL=${(-y).toFixed(1)}`,p.color="#E91E63",p.draggable=!0,e.pattern2[p.point]=e.series.price.createPriceLine(p),o.set("pattern2",p),p.point="T",p.price=+C.toFixed(1),p.title=`TP=${E.toFixed(1)}`,p.color="#2196F3",p.draggable=!1,e.pattern2[p.point]=e.series.price.createPriceLine(p),o.set("pattern2",p),ne.value.classList.remove("selected")}function yt(t){let r=0,i=0,s=t,a=t,n=t,l=t;for(let u of e.data.price)if(u.time>=t.time){if(u.value<t.value){if(s.value>a.value)break;if(u.value<n.value)r>i&&(s=n,a=l,i=r),n=u,l=u,r=0;else if(u.value>n.value){if(u.value>t.value)break;u.value>l.value&&(l=u,r=+Math.abs(l.value-n.value).toFixed(1))}}else if(u.value>t.value){if(s.value<a.value)break;if(u.value>n.value)r>i&&(s=n,a=l,i=r),n=u,l=u,r=0;else if(u.value<n.value){if(u.value<t.value)break;u.value<l.value&&(l=u,r=+Math.abs(l.value-n.value).toFixed(1))}}}return{point2:s,point3:a,point4:n,point5:l}}function we(){g.isSet(e.pattern2.T)&&(e.series.price.removePriceLine(e.pattern2.E),e.series.price.removePriceLine(e.pattern2.S),e.series.price.removePriceLine(e.pattern2.T),e.pattern2={E:{},S:{},T:{}},o.clear("pattern2"))}function Ct(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r?me():t.target.classList.add("selected"),t.stopPropagation()}function xt(t){kt(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function bt(){e.crosshair.time&&(e.volprofile.pointCount==0?(e.volprofile.v1={time:e.crosshair.time,value:1},e.series.volprofile.setData([e.volprofile.v1]),e.volprofile.pointCount++,o.set("volprofile",e.volprofile.v1)):e.crosshair.time>e.volprofile.v1.time&&(e.volprofile.v2={time:e.crosshair.time,value:1},e.series.volprofile.setData([e.volprofile.v1,e.volprofile.v2]),g.isSet(e.volprofile.v2)&&(o.clear("volprofile"),o.set("volprofile",e.volprofile.v1)),o.set("volprofile",e.volprofile.v2),me(),e.volprofile.pointCount++,de.value.classList.remove("selected")))}function me(){if(g.isSet(e.volprofile.v1)){const t=e.volprofile.v1.time,r=g.isSet(e.volprofile.v2)?e.volprofile.v2.time:moment().unix()+7*60*60,i=Ot(t,r),s={price:i.price,buy:i.buy,sell:i.sell,title:`POC ${i.buy} - ${i.sell}`,color:i.buy>=i.sell?"#2196F3":"#9C27B0",lineWidth:1,lineStyle:1,draggable:!1};g.isSet(e.volprofile.poc)&&e.series.price.removePriceLine(e.volprofile.poc),e.volprofile.poc=e.series.price.createPriceLine(s)}}function Ot(t,r){const i=e.data.price.filter(l=>l.time>=t&&l.time<=r),s=e.data.volume.filter(l=>l.time>=t&&l.time<=r);let a={};for(let l=0;l<i.length;l++)a[i[l].value]||(a[i[l].value]={buy:0,sell:0,total:0}),s[l].color=="#00FF00"&&(a[i[l].value].buy+=s[l].value),s[l].color=="#FF0000"&&(a[i[l].value].sell+=s[l].value),a[i[l].value].total+=s[l].value;const n=Object.keys(a).reduce((l,u)=>a[l].total>a[u].total?l:u);return{price:+n,buy:a[n].buy,sell:a[n].sell}}function kt(){g.isSet(e.volprofile.poc)&&e.series.price.removePriceLine(e.volprofile.poc),e.volprofile={v1:{},v2:{},poc:{},pointCount:0},e.series.volprofile.setData([]),o.clear("volprofile")}function St(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r?Fe(0):(t.target.classList.add("selected"),he()),t.stopPropagation()}function Pt(t){he(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function Fe(t=-1){t==-1&&(t=e.data.volume.findIndex(r=>r.time>=e.crosshair.time),e.volumeMax=e.data.volume[t].value-1,ce.value.classList.remove("selected"));for(let r=t;r<e.data.volume.length;r++)e.data.volume[r].value>e.volumeMax&&(e.volumeMax=e.data.volume[r].value,e.series.signal.update({time:e.data.volume[r].time,value:1}))}function he(){e.volumeMax=c.state.tradingOrder.config.volLimit,e.series.signal.setData([])}function Lt(t){v.showColorPicker=!1;const r=t.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),r||t.target.classList.add("selected"),t.stopPropagation()}function Tt(t){Ft(),t.target.classList.remove("selected"),t.preventDefault(),t.stopPropagation()}function wt(){const t="alert",r=re(N(e.crosshair.y)),i=e.alerts.length;if(e.alerts=e.alerts.filter(s=>{const a=s.options(),n=a.type=r==+a.price;return n&&(e.series.price.removePriceLine(s),o.set("alert",{price:r,removed:!0})),!n}),e.alerts.length==i){const s={lineType:t,price:r,title:r>=e.data.price.slice(-1)[0].value?">":"<",color:"red",lineWidth:1,lineStyle:1,draggable:!0};e.alerts.push(e.series.price.createPriceLine(s)),o.set("alert",s)}G.value.classList.remove("selected")}function Ft(){e.alerts.forEach(t=>e.series.price.removePriceLine(t)),e.alerts=[],o.clear("alert")}async function Et(){e.order.entry.hasOwnProperty("line")&&(e.order.tp.hasOwnProperty("line")?c.dispatch("tradingOrder/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(t=>{t.isOk?(T("entry"),T("tp"),T("sl"),M(!1),o.clear("order"),P.success(f("trading.orderChart.exitSuccess"))):(M(!0),w(t.message))}):c.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"delete"}}).then(t=>{t.isOk?(T("entry"),M(!1),o.clear("order"),P.success(f("trading.orderChart.deleteEntrySuccess"))):(M(!0),w(t.message))}))}function Dt(){const t=moment().unix();te(t)&&(t<h.ATO?Re(f("trading.orderChart.atoOrder"),f("titles.confirm")).then(i=>{i&&c.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(s=>{s.isOk?P.success(f("trading.orderChart.atoOrderSuccess")):w(s.message)})}):t<h.ATC?c.dispatch("tradingOrder/executeOrder",{action:"entry",data:{cmd:"new",side:e.order.side,price:e.order.entry.price}}).then(r=>{r.isOk?(A("entry"),M(!0),P.success(f("trading.orderChart.newEntrySuccess"))):w(r.message)}):Re(f("trading.orderChart.atcOrder"),f("titles.confirm")).then(i=>{i&&c.dispatch("tradingOrder/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(s=>{s.isOk?P.success(f("trading.orderChart.atcOrderSuccess")):w(s.message)})}))}function _t(){e.order.tp.price=e.order.entry.price+e.order.side*Ae,e.order.sl.price=e.order.entry.price-e.order.side*$e,c.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(t=>{t.isOk?(A("entry"),A("tp"),A("sl"),e.order.entry.line.applyOptions({draggable:!1}),P.success(f("trading.orderChart.newTpSlSuccess"))):w(t.message)})}function Rt(){if(e.order.entry.hasOwnProperty("line")){const t=e.data.price.slice(-1)[0].value;e.order.tp.hasOwnProperty("line")?((e.order.side>0&&t>=e.order.tp.price||e.order.side<0&&t<=e.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,c.dispatch("tradingOrder/executeOrder",{action:"sl",data:{cmd:"delete"}}).then(r=>{r.isOk?(T("entry"),T("tp"),T("sl"),M(!1),o.clear("order"),P.success(f("trading.orderChart.deleteTpSuccess")),fe(),Z()):w(r.message),e.isAutoOrdering=!1}))),(e.order.side>0&&t<=e.order.sl.price||e.order.side<0&&t>=e.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,c.dispatch("tradingOrder/executeOrder",{action:"tp",data:{cmd:"cancel"}}).then(r=>{r.isOk?(T("entry"),T("tp"),T("sl"),M(!1),o.clear("order"),P.success(f("trading.orderChart.deleteSlSuccess")),fe(),Z()):w(r.message),e.isAutoOrdering=!1})))):(e.order.side>0&&t>=e.order.entry.price||e.order.side<0&&t<=e.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.order.tp.price=e.order.entry.price+e.order.side*Ae,e.order.sl.price=e.order.entry.price-e.order.side*$e,c.dispatch("tradingOrder/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.order.tp.price},slData:{cmd:"new",price:e.order.sl.price}}).then(r=>{r.isOk?(A("tp"),A("sl"),e.order.entry.line.applyOptions({draggable:!1}),P.success(f("trading.orderChart.autoNewTpSlSuccess")),Z()):w(r.message),e.isAutoOrdering=!1})},1e3)))}}function At(){e.chart.timeScale().scrollToRealTime()}function te(t=null){return t||(t=moment().unix()),t>=h.START&&t<=h.END}function N(t){return re(e.series.price.coordinateToPrice(t))}function re(t){return t?+ +t.toFixed(1):0}function w(t){t||(t="unknown"),P.error(f(`trading.orderChart.${t}`))}function $t(){e.loadWhitespace=!0,c.dispatch("tradingOrder/getChartData",v.chartDate)}function Mt(){e.data.price=[],e.data.volume=[],e.data.spread=[],e.data.cash=[],e.data.whitespace=[],e.loadWhitespace=!0,c.dispatch("tradingOrder/getChartData",v.chartDate)}function Z(){let t=new Audio(lr);t.crossOrigin="anonymous",t.addEventListener("canplaythrough",function(){t.play()})}function Vt(){c.dispatch("tradingOrder/getAccountInfo").then(t=>{let r="";r+='<div style="width: 200px;">',r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${f("trading.orderChart.nav")}</div><div>: ${Y.currency(t.nav)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${f("trading.orderChart.maxVol")}</div><div>: ${Y.numberVnFormat(t.maxVol)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${f("trading.orderChart.vm")}</div><div>: ${Y.currency(t.vm)}</div></div>`,r+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${f("trading.orderChart.fee")}</div><div>: ${Y.currency(t.fee)}</div></div>`,r+="</div>",Qt(r,f("trading.orderChart.accountInfo"))})}function Bt(){W.emit("checkPin",()=>c.dispatch("tradingOrder/report"))}function It(){W.emit("checkPin",()=>c.dispatch("tradingOrder/export"))}return(t,r)=>{const i=Xt("DxToolbar");return er(),Zt(Jt,null,[m("div",nr,[ae(i,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-flag-checkered small",hint:t.$t("trading.orderChart.buttons.report"),onClick:Bt}},{location:"before",widget:"dxButton",options:{icon:"far fa-file-export small",hint:t.$t("trading.orderChart.buttons.export"),onClick:It}},{location:"before",widget:"dxButton",options:{icon:"far fa-chart-line small",hint:t.$t("trading.orderChart.buttons.cashflow"),onClick:()=>t.$refs.dailyCashFlowPopupRef.show()}}]},null,8,["items"]),m("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:O},[m("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:ye},[m("div",cr,[m("div",{ref_key:"connectionRef",ref:z,class:ge(`command far fa-${F.value.connection?"link":"unlink"}`),title:t.$t("trading.orderChart.connection"),onClick:r[0]||(r[0]=()=>t.$store.dispatch("tradingOrder/getStatus"))},null,10,dr),m("div",{class:ge(["command status",{green:F.value.position>0,red:F.value.position<0,pending:F.value.pending}]),title:t.$t("trading.orderChart.position"),onClick:Vt},_e(F.value.position),11,pr),m("div",ur,_e(v.clock),1),V(m("input",{type:"date",class:"chart-date command",title:t.$t("trading.orderChart.date"),"onUpdate:modelValue":r[1]||(r[1]=s=>v.chartDate=s),onChange:$t},null,40,fr),[[Kt,v.chartDate]]),m("img",{ref_key:"spinnerRef",ref:Ce,class:"command spinner",src:sr},null,512)]),m("div",vr,[m("div",{ref_key:"fullscreenToolRef",ref:xe,class:ge(`command far fa-${v.isFullscreen?"compress":"expand"}`),title:t.$t("trading.orderChart.fullscreen"),onClick:Ue},null,10,mr),m("div",{ref_key:"reloadToolRef",ref:be,class:"command far fa-sync-alt",title:t.$t("trading.orderChart.reload"),onClick:Mt},null,8,hr),m("div",{ref_key:"tradingviewRef",ref:Oe,class:"command far fa-chart-bar",title:t.$t("trading.orderChart.tradingview"),onClick:tt},null,8,gr),m("div",{ref_key:"colorToolRef",ref:Ve,class:"color command far fa-palette",style:Gt({color:v.color}),title:t.$t("trading.orderChart.colorTool"),onClick:rt,onContextmenu:it},[V(ae(or,{class:"color-picker",modelValue:v.color,"onUpdate:modelValue":r[2]||(r[2]=s=>v.color=s)},null,8,["modelValue"]),[[B,v.showColorPicker]])],44,yr),m("div",{ref_key:"lineToolRef",ref:U,class:"command far fa-horizontal-rule",title:t.$t("trading.orderChart.lineTool"),onClick:ot,onContextmenu:st},null,40,Cr),V(m("div",{ref_key:"pattern2ToolRef",ref:ne,class:"command far fa-heart",title:t.$t("trading.orderChart.pattern2Tool"),onClick:ht,onContextmenu:gt},null,40,xr),[[B,!0]]),m("div",{ref_key:"pattern1ToolRef",ref:le,class:"command far fa-star",title:t.$t("trading.orderChart.pattern1Tool"),onClick:ft,onContextmenu:vt},null,40,br),m("div",{ref_key:"rulerToolRef",ref:K,class:"command far fa-line-height",title:t.$t("trading.orderChart.rulerTool"),onClick:dt,onContextmenu:pt},null,40,Or),V(m("div",{ref_key:"scanSignalToolRef",ref:ce,class:"command far fa-search-location",title:t.$t("trading.orderChart.scanSignalTool"),onClick:St,onContextmenu:Pt},null,40,kr),[[B,!1]]),V(m("div",{ref_key:"boxToolRef",ref:pe,class:"command far fa-expand-alt",title:t.$t("trading.orderChart.boxTool"),onClick:lt,onContextmenu:nt},null,40,Sr),[[B,!1]]),V(m("div",{ref_key:"volprofileToolRef",ref:de,class:"command far fa-poll-h",title:t.$t("trading.orderChart.volprofileTool"),onClick:Ct,onContextmenu:xt},null,40,Pr),[[B,!1]]),V(m("div",{ref_key:"alertToolRef",ref:G,class:"command far fa-alarm-exclamation",title:t.$t("trading.orderChart.alertTool"),onClick:Lt,onContextmenu:Tt},null,40,Lr),[[B,!1]]),V(m("div",{class:"command far fa-info-circle",title:t.$t("trading.orderChart.copyistStatusPopup.title"),onClick:r[3]||(r[3]=()=>t.$refs.copyistStatusPopupRef.show())},null,8,Tr),[[B,!1]]),m("div",{ref_key:"cancelOrderRef",ref:J,class:"cancel-order command far fa-trash-alt",title:t.$t("trading.orderChart.cancelTool"),onClick:Et},null,8,wr)]),m("div",null,[m("div",{ref_key:"entryOrderRef",ref:q,class:"order-button entry",onClick:Dt}," Entry ",512),m("div",{ref_key:"tpslOrderRef",ref:X,class:"order-button tpsl",onClick:_t}," TP/SL ",512),m("div",{class:"chart-top command far fa-angle-double-right",onClick:At})]),V(m("iframe",{ref_key:"tradingviewChartRef",ref:Be,class:"tradingview-chart",src:Ie.value},null,8,Fr),[[B,v.showTradingView]])],512)],512)]),ae(tr,{ref:"copyistStatusPopupRef"},null,512),ae(ir,{ref:"dailyCashFlowPopupRef"},null,512)],64)}}},Vr=jt(_r,[["__scopeId","data-v-03ec13d4"]]);export{Vr as default};
