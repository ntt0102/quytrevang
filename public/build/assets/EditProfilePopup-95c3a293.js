import{k as i,D as o,l,m as r,a as d,n}from"./app-089c7b72.js";const u={components:{DxForm:i,DxItem:o,DxTextArea:l},data(){return{isLoading:!1,formData:null,banks:[],validationRules:{name:[{type:"required",message:this.$t("models.user.name")+this.$mt.validations.required},{type:"stringLength",max:50,message:this.$t("models.user.validations.name")}],sex:[{type:"required",message:this.$t("models.user.sex")+this.$mt.validations.required}],birthday:[{type:"required",message:this.$t("models.user.birthday")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateBirthday,message:this.$t("models.user.validations.birthday")}],idNumber:[{type:"required",message:this.$t("models.user.idNumber")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicateIdNumber,message:this.$t("models.user.idNumber")+this.$mt.validations.duplicate}],idIssuedOn:[{type:"required",message:this.$t("models.user.idIssuedOn")+this.$mt.validations.required},{type:"custom",validationCallback:this.validateIdIssuedOn,message:this.$t("models.user.validations.idIssuedOn")}],phone:[{type:"required",message:this.$t("models.user.phone")+this.$mt.validations.required},{type:"async",validationCallback:this.validateDuplicatePhone,message:this.$t("models.user.phone")+this.$mt.validations.duplicate}],email:[{type:"required",message:this.$t("models.user.email")+this.$mt.validations.required},{type:"email",message:this.$t("models.user.email")+this.$mt.validations.email},{type:"async",validationCallback:this.validateDuplicateEmail,message:this.$t("models.user.email")+this.$mt.validations.duplicate}],address:[{type:"required",message:this.$t("models.user.address")+this.$mt.validations.required},{type:"stringLength",max:100,message:this.$t("models.user.validations.address")}],bankAccount:{bankName:[{type:"required",message:this.$t("models.user.bankName")+this.$mt.validations.required}],accountName:[{type:"required",message:this.$t("models.user.accountName")+this.$mt.validations.required}],accountNumber:[{type:"required",message:this.$t("models.user.accountNumber")+this.$mt.validations.required},{type:"numeric",message:this.$t("models.user.accountNumber")+this.$mt.validations.numeric}]}}}},computed:{...r("User.profile",["profile"]),popup(){return this.$refs.popup.instance},form(){return this.$refs.form.instance}},methods:{...d("User.profile",["fetch","save","validateDuplicateEmail","validateDuplicateIdNumber","validateDuplicatePhone"]),show(){this.isLoading=!0,this.popup.show(),this.fetch().then(()=>{this.formData=this.$mf.cloneDeep(this.profile),setTimeout(()=>this.form.getEditor("name").focus(),500),this.$mf.getBanks().then(a=>this.banks=a),this.isLoading=!1}),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onSubmit(){this.$bus.emit("checkPin",()=>{this.save(this.formData).then(a=>{a&&this.popup.hide()})})},validateBirthday(a){return moment(a.value).isBefore(moment().subtract(18,"years"))},validateIdIssuedOn(a){return moment(a.value).isBefore(moment().subtract(1,"day"))},saveClick(){this.form.getButton("submit").element().click()}}};var m=function(){var e=this,t=e._self._c;return t("div",[t("DxPopup",{ref:"popup",attrs:{showCloseButton:!0,fullScreen:!!e.$devices.phone,"show-title":!0,title:e.$t("components.editProfile.title"),toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.save"),onClick:()=>e.form.getButton("submit").element().click()}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t("buttons.cancel"),onClick:()=>e.popup.hide()}}]},on:{hiding:e.$mf.popRouteHistoryState},scopedSlots:e._u([{key:"content",fn:function(){return[t("form",{on:{submit:function(s){return s.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("button",{ref:"submit",staticClass:"display-none"}),t("DxForm",{ref:"form",staticClass:"profile-form",attrs:{"form-data":e.formData,labelMode:"floating","col-count":2,"label-location":e.$devices.phone?"top":"left","scrolling-enabled":!0}},[t("DxItem",{attrs:{"item-type":"group",caption:e.$t("models.user.groups.personalInfo")}},[t("DxItem",{attrs:{"data-field":"name","validation-rules":e.validationRules.name,label:{text:e.$t("models.user.name")}}}),t("DxItem",{attrs:{"data-field":"sex","editor-type":"dxSelectBox","editor-options":{searchEnabled:!1,items:e.$mf.getSexList(),displayExpr:"name",valueExpr:"value",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":e.validationRules.sex,label:{text:e.$t("models.user.sex")}}}),t("DxItem",{attrs:{"data-field":"birthday","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":e.validationRules.birthday,label:{text:e.$t("models.user.birthday")}}})],1),t("DxItem",{attrs:{"item-type":"group",caption:e.$t("models.user.groups.idInfo")}},[t("DxItem",{attrs:{"data-field":"identity.number",editorOptions:{mask:"000000000000"},"validation-rules":e.validationRules.idNumber,label:{text:e.$t("models.user.idNumber")}}}),t("DxItem",{attrs:{"data-field":"identity.issued_on","editor-type":"dxDateBox","editor-options":{dateSerializationFormat:e.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true"},"validation-rules":e.validationRules.idIssuedOn,label:{text:e.$t("models.user.idIssuedOn")}}}),t("DxItem",{attrs:{"data-field":"",editorOptions:{value:e.$mt.idIssuedAtValue,readOnly:!0},label:{text:e.$t("models.user.idIssuedAt")}}})],1),t("DxItem",{attrs:{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.contactInfo")}},[t("DxItem",{attrs:{"data-field":"phone",editorOptions:{mask:"0000.000.000"},"validation-rules":e.validationRules.phone,label:{text:e.$t("models.user.phone")}}}),t("DxItem",{attrs:{"data-field":"email","validation-rules":e.validationRules.email,label:{text:e.$t("models.user.email")}}}),t("DxItem",{attrs:{"col-span":2,"data-field":"address","editor-type":"dxTextArea","validation-rules":e.validationRules.address,label:{text:e.$t("models.user.address")}}})],1),t("DxItem",{attrs:{"item-type":"group","col-span":2,"col-count":2,caption:e.$t("models.user.groups.bankInfo")}},[t("DxItem",{attrs:{"data-field":"bank_account.bank_name","editor-type":"dxSelectBox","editor-options":{searchEnabled:!0,items:e.banks,displayExpr:"short_name",searchExpr:"short_name",valueExpr:"short_name",placeholder:e.$t("titles.dxSelectPlacehoder")},"validation-rules":e.validationRules.bankAccount.bankName,label:{text:e.$t("models.user.bankName")}}}),t("DxItem",{attrs:{"data-field":"bank_account.account_number","validation-rules":e.validationRules.bankAccount.accountNumber,label:{text:e.$t("models.user.accountNumber")}}}),t("DxItem",{attrs:{"data-field":"bank_account.account_name","editor-type":"dxTextBox","editor-options":{inputAttr:{style:"text-transform: uppercase"}},"validation-rules":e.validationRules.bankAccount.accountName,label:{text:e.$t("models.user.accountName")}}})],1),t("DxItem",{attrs:{name:"submit",cssClass:"display-none","item-type":"button","button-options":{useSubmitBehavior:!0}}})],1),t("DxLoadPanel",{attrs:{position:{of:".profile-form"},visible:e.isLoading,shading:!1}})],1)]},proxy:!0}])})],1)},p=[],c=n(u,m,p,!1,null,null,null,null);const v=c.exports;export{v as E};
