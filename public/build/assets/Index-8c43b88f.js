import{A as ci,B as di,C as pi,l as ue,u as ui,r as C,a as fi,c as J,y as mi,E as vi,w as ze,x as k,b as gi,d as g,e as fe,G as _,t as Je,H as K,I as hi,J as me,K as yi,F as Si,h as xi,j as Ti,k as ve,z as He,L as Ci,m as ki,o as wi}from"./app-a651ab02.js";import bi from"./LineContext-962546a5.js";import Fi from"./ScanContext-2a38e84d.js";import Di from"./VpsOtpPopup-a743386b.js";import{c as Oi}from"./lightweight-charts.esm.development-03366bac.js";import{g as w}from"./getUnixTime-c1bb36fb.js";import"./text-box-61eee5e2.js";function Li(H,j,b){return ci((b==null?void 0:b.in)||H,+di(H)+j)}function be(H,j,b){return Li(H,j*pi,b)}const Ri={class:"content-block dx-card responsive-paddings"},Ai=["title"],Pi=["title"],Ei=["title"],_i=["title"],Bi=["title"],Ii=["title"],Mi=["title"],Vi=["title"],$i=["title"],Wi=g("i",{class:"far fa-heart-rate"},null,-1),Zi=[Wi],Yi=["title"],Ni=g("i",{class:"far fa-pipe"},null,-1),Xi=[Ni],zi=["title"],Ji=g("i",{class:"far fa-horizontal-rule"},null,-1),Hi=["title"],ji=g("i",{class:"far fa-grip-lines-vertical"},null,-1),qi=[ji],Qi=["title"],Ui=g("i",{class:"far fa-line-height"},null,-1),Gi=[Ui],Ki=["title"],eo=["src"],je=3,qe=2,to="wss://tradestation.fireant.vn/quote?access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSIsImtpZCI6IkdYdExONzViZlZQakdvNERWdjV4QkRITHpnSSJ9.eyJpc3MiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4iLCJhdWQiOiJodHRwczovL2FjY291bnRzLmZpcmVhbnQudm4vcmVzb3VyY2VzIiwiZXhwIjoxODg5NjIyNTMwLCJuYmYiOjE1ODk2MjI1MzAsImNsaWVudF9pZCI6ImZpcmVhbnQudHJhZGVzdGF0aW9uIiwic2NvcGUiOlsiYWNhZGVteS1yZWFkIiwiYWNhZGVteS13cml0ZSIsImFjY291bnRzLXJlYWQiLCJhY2NvdW50cy13cml0ZSIsImJsb2ctcmVhZCIsImNvbXBhbmllcy1yZWFkIiwiZmluYW5jZS1yZWFkIiwiaW5kaXZpZHVhbHMtcmVhZCIsImludmVzdG9wZWRpYS1yZWFkIiwib3JkZXJzLXJlYWQiLCJvcmRlcnMtd3JpdGUiLCJwb3N0cy1yZWFkIiwicG9zdHMtd3JpdGUiLCJzZWFyY2giLCJzeW1ib2xzLXJlYWQiLCJ1c2VyLWRhdGEtcmVhZCIsInVzZXItZGF0YS13cml0ZSIsInVzZXJzLXJlYWQiXSwianRpIjoiMjYxYTZhYWQ2MTQ5Njk1ZmJiYzcwODM5MjM0Njc1NWQifQ.dA5-HVzWv-BRfEiAd24uNBiBxASO-PAyWeWESovZm_hj4aXMAZA1-bWNZeXt88dqogo18AwpDQ-h6gefLPdZSFrG5umC1dVWaeYvUnGm62g4XS29fj6p01dhKNNqrsu5KrhnhdnKYVv9VdmbmqDfWR8wDgglk5cJFqalzq6dJWJInFQEPmUs9BW_Zs8tQDn-i5r4tYq2U8vCdqptXoM7YgPllXaPVDeccC9QNu2Xlp9WUvoROzoQXg25lFub1IYkTrM66gJ6t9fJRZToewCt495WNEOQFa_rwLCZ1QwzvL0iYkONHS_jZ0BOhBCdW9dWSawD6iF1SIQaFROvMDH1rg",co={__name:"Index",setup(H){const j={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.25,bottom:.25}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!0,rightOffset:1e3,minBarSpacing:.01,barSpacing:.05}},b=ue(new Date,"yyyy-MM-dd"),F={START:w(new Date(`${b}T08:45:00Z`)),ATO:w(new Date(`${b}T09:00:00Z`)),ATC:w(new Date(`${b}T14:30:00Z`)),END:w(new Date(`${b}T14:45:00Z`))},u=xi(),Fe=Ti(),{t:h}=ui(),Qe=ve("devices"),m=ve("mf"),ge=ve("bus"),ee=ve("filters"),R=C(null),De=C(null),Ue=C(null),Ge=C(null),Ke=C(null),et=C(null),tt=C(null),te=C(null),he=C(null),ye=C(null),Se=C(null),ie=C(null),xe=C(null),it=C(null),V=C(null),q=C(null),Oe=C(null);let e={chart:{},series:{},data:{whitespace:[],price:[]},tools:{},crosshair:{},interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,socketSendData:null,currentSeconds:w(be(new Date,7))};z();const d=fi({chartDate:Fe.query.date??b,clock:ue(new Date,"HH:mm:ss"),isFullscreen:!1,isSocketWarning:!1,isOrderWarning:!1,lineColor:"#F44336",lineTitle:"",progress:0,scanSide:"left",showScanContext:!1,showLineContext:!1,showTradingView:!1,tradingViewStyle:{left:"32px"}}),D=J(()=>u.state.tradingDerivative.status),A=J(()=>u.state.tradingDerivative.config),Le=J(()=>u.state.tradingDerivative.tools),ot=J(()=>u.state.tradingDerivative.isChartLoading),rt=J(()=>D.value.position!=0||!!D.value.pending||!!Le.value.order),st=J(()=>`https://chart.vps.com.vn/tv/?u=${A.value.vpsUser}&s=${A.value.vpsSession}&symbol=VN30F1M&resolution=1&lang=vi`);u.dispatch("tradingDerivative/initChart").then(()=>{B()&&Te(),!Fe.query.date&&A.value.lastOpeningDate&&(d.chartDate=A.value.lastOpeningDate),u.dispatch("tradingDerivative/getChartData",d.chartDate).then(i=>{i&&de()})}),e.interval=setInterval(vt,1e3),e.interval60=setInterval(()=>{B()?(Ye(),A.value.autoRefresh&&re()):clearInterval(e.interval60)},6e4),mi(()=>{e.chart=Oi(De.value,j),e.chart.subscribeCrosshairMove(lt),e.chart.subscribeCustomPriceLineDragged(ct),e.series.whitespace=e.chart.addHistogramSeries({priceScaleId:"whitespace",scaleMargins:{top:0,bottom:0},color:"#808080",lastValueVisible:!1,priceLineVisible:!1}),e.series.timeRange=e.chart.addHistogramSeries({priceScaleId:"timeRange",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.pickTime=e.chart.addHistogramSeries({priceScaleId:"pickTime",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.timeMark=e.chart.addHistogramSeries({priceScaleId:"timeMark",scaleMargins:{top:0,bottom:0},lastValueVisible:!1,priceLineVisible:!1}),e.series.price=e.chart.addLineSeries({color:"#F5F5F5",priceFormat:{minMove:.1}}),new ResizeObserver(dt).observe(R.value),document.addEventListener("keydown",Pe),document.addEventListener("fullscreenchange",Ee)}),vi(()=>{e.chart&&(e.chart.remove(),e.chart=null),document.removeEventListener("keydown",Pe),document.removeEventListener("fullscreenchange",Ee),clearInterval(e.interval),clearInterval(e.interval60),e.websocket&&(e.websocket.close(),e.websocket=null),e.socketStop=!0}),ze(()=>u.state.tradingDerivative.chartData,ft),ze(()=>Le.value,ut);function nt(i){d.showPatternContext=!1,d.showScanContext=!1,d.showLineContext=!1,le(!1),te.value.classList.contains("selected")?Vt():Se.value.classList.contains("selected")?Yt():ie.value.classList.contains("selected")?_t():xe.value.classList.contains("selected")?Tt():he.value.classList.contains("selected")?Dt():ye.value.classList.contains("selected")&&At()}function at(i){le(!0),i.preventDefault()}function Re(i){i.stopPropagation()}function Ae(i){i.preventDefault(),i.stopPropagation()}function lt(i){if(i.time){let o=i.seriesPrices.get(e.series.price);e.crosshair.time=i.time,e.crosshair.price=o}else Qe.phone||(e.crosshair.time=null,e.crosshair.price=null);i.point!=null&&(e.crosshair.x=i.point.x,e.crosshair.y=i.point.y)}function ct(i){let o=i.customPriceLine,t=o.options();t.price=parseFloat(t.price.toFixed(1));const r=+i.fromPriceString,s=t.price;switch(t.lineType){case"order":if(s!=r){let l=!1;t.kind=="entry"?D.value.position||(l=!0,e.tools.order[t.kind].price=s,u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"change",price:e.tools.order.entry.price}}).then(c=>{c.isOk?(Y([t.kind]),k.success(h("trading.derivative.changeEntrySuccess"))):(o.applyOptions({price:r}),O(c.message))})):(l=!0,e.tools.order[t.kind].price=s,t.kind=="tp"?u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"change",price:e.tools.order.tp.price}}).then(c=>{c.isOk?(Y([t.kind]),k.success(h("trading.derivative.changeTpSuccess"))):(o.applyOptions({price:r}),O(c.message))}):u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"change",price:e.tools.order.sl.price}}).then(c=>{c.isOk?(Y([t.kind]),k.success(h("trading.derivative.changeSlSuccess"))):(o.applyOptions({price:r}),O(c.message))})),l||(o.applyOptions({price:r}),k.show(h("trading.derivative.noChangeOrderLine")))}break;case"line":u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line",point:r});const n=t.color,a=t.title;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"line",points:[s],data:[{color:n,title:a}]}),te.value.classList.remove("selected");break;case"target":if(m.isSet(e.tools.target.B)){let l={isRemove:!1,name:"target",points:[],data:[]},c,p,f=+e.tools.target.A.options().price,y=+e.tools.target.B.options().price,v=y-f;if(c="A",t.point=="A")v=+e.tools.target.B.options().title,y=f+v;else if(t.point!="B"){let S=0;switch(t.point){case"X":S=1.5;break;case"Y":S=2;break;case"Z":S=3;break;case"W":S=5;break}v=parseFloat(((y-s)/S).toFixed(1)),f=y-v,p={price:f},e.tools.target[c].applyOptions(p)}l.points.push(c),l.data.push(f),c="B",p={price:y,title:v.toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),l.points.push(c),l.data.push(y),c="X",p={price:parseFloat((f-.5*v).toFixed(1)),title:(-.5*v).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="Y",p={price:parseFloat((f-v).toFixed(1)),title:(-v).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="Z",p={price:parseFloat((f-2*v).toFixed(1)),title:(-2*v).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),c="W",p={price:parseFloat((f-4*v).toFixed(1)),title:(-4*v).toFixed(1)},t.point==c&&delete p.price,e.tools.target[c].applyOptions(p),u.dispatch("tradingDerivative/drawTools",l)}break;case"pattern":if(m.isSet(e.tools.pattern.B)){let l,c;const p=e.tools.pattern.A.options(),f=e.tools.pattern.B.options(),y=e.tools.pattern.C.options(),v={A:{time:+p.time,price:+p.price},B:{price:+f.price},C:{price:+y.price}},{progress:S,timeMark:T,info:{ep1:L,ep2:I,ep3:M,entry:$,prStatus:W,x:E,X:U,y:Z,Y:G}}=se(v);ae(S),ne(T),X(v),l="A",c={title:`A ${L}`},e.tools.pattern[l].applyOptions(c),l="B",c={title:`B ${I}`},e.tools.pattern[l].applyOptions(c),l="C",c={title:`C ${M}`},e.tools.pattern[l].applyOptions(c),l="D",c={price:$,title:"Entry "+W},t.point==l&&delete c.price,e.tools.pattern[l].applyOptions(c),l="X",c={price:parseFloat(E.toFixed(1)),title:"X "+parseFloat(U.toFixed(1))},e.tools.pattern[l].applyOptions(c),l="Y",c={price:parseFloat(Z.toFixed(1)),title:"Y "+parseFloat(G.toFixed(1))},e.tools.pattern[l].applyOptions(c)}break}}function dt(){R.value&&(e.chart.resize(R.value.offsetWidth,R.value.offsetHeight),R.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Pe(i){if(i.ctrlKey)switch(i.keyCode){case 219:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing-.01});break;case 221:e.chart.timeScale().applyOptions({barSpacing:e.chart.options().timeScale.barSpacing+.01});break}if(i.altKey)switch(i.keyCode){case 219:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()-50);break;case 221:e.chart.timeScale().scrollToPosition(e.chart.timeScale().scrollPosition()+50);break}}function Ee(){R.value&&(document.fullscreenElement?(d.isFullscreen=!0,R.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(d.isFullscreen=!1,R.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function pt(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function ut(i){Xt(),Object.entries(i).forEach(([o,t])=>{switch(o){case"order":gt(t);break;case"pattern":Ce(i.pattern,!0);break;case"tr":Bt(t);break;case"0_pt":Me(t[0]);break;case"line":$t(t);break;case"target":Nt(t);break}})}function ft(i){d.chartDate==b&&B()||(i.price.length>0&&(e.data.whitespace=oe(e.data.whitespace,Be(d.chartDate))),e.series.whitespace.setData(e.data.whitespace),e.data.price=oe(e.data.price,i.price),e.series.price.setData(e.data.price))}function _e(i){let o=[];i.forEach(t=>{const r=w(be(new Date(t.date),7));o.push({time:r,value:t.price})}),o.length>1?(e.data.price=oe(e.data.price,o),e.series.price.setData(e.data.price)):(e.data.price.push(o[0]),e.series.price.update(o[0]))}function Be(i){const o=w(new Date(`${i}T09:00:00Z`)),t=w(new Date(`${i}T11:30:00Z`)),r=w(new Date(`${i}T13:00:00Z`)),s=w(new Date(`${i}T14:30:00Z`)),n=w(new Date(`${i}T14:00:00Z`));let a=[];for(let l=o;l<=s;l++){if(l>t&&l<r)continue;let c={time:l};(l==n||l==s)&&(c.value=1),a.push(c)}return a}function oe(i,o){return Array.from(new Map([...i,...o].sort((t,r)=>t.time-r.time).map(t=>[t.time,t])).values())}function Te(){u.dispatch("tradingDerivative/setChartLoading",!0),e.websocket=new WebSocket(to),e.websocket.onopen=i=>{let o='{"protocol":"json","version":1}';e.websocket.send(o),o='{"arguments":["VN30F1M"],"invocationId":"0","target":"SubscribeTrades","type":1}',e.websocket.send(o),e.socketSendData=o},e.websocket.onclose=i=>{!e.socketStop&&B()&&(d.isSocketWarning=!0,Te())},e.websocket.onmessage=i=>{d.isSocketWarning=!1,mt(i.data).forEach(t=>{if(!t)return!1;t.type==3?(de(),e.data.whitespace=oe(e.data.whitespace,Be(b)),e.series.whitespace.setData(e.data.whitespace),_e(t.result),u.dispatch("tradingDerivative/setChartLoading",!1)):t.type==1&&t.target=="UpdateTrades"&&t.arguments[0]=="VN30F1M"&&(jt(t.arguments[1].at(-1).price),_e(t.arguments[1]))})}}function mt(i){let o=[];return i.split("").forEach(t=>{const r=t.indexOf("{"),s=t.lastIndexOf("}");let n=null;if(r!==-1&&s!==-1&&s>r){const a=t.substring(r,s+1);a!="{}"&&(n=JSON.parse(a))}o.push(n)}),o}function vt(){e.currentSeconds=w(be(new Date,7)),B()&&(D.value.position&&e.currentSeconds>F.ATC-5*60&&(d.isOrderWarning=!0,e.currentSeconds>F.ATC-15&&m.isSet(e.tools.order.tp.line)&&u.dispatch("tradingDerivative/executeOrder",{action:"cancel",tpData:{cmd:"cancel"},slData:{cmd:"delete"}}).then(i=>{i.isOk?(N(["entry","tp","sl"]),k.success(h("trading.derivative.autoCancelTpSlSuccess"))):O(i.message)})),A.value.openingMarket&&e.currentSeconds==F.START&&Te()),d.clock=ue(new Date,"HH:mm:ss")}function Y(i){const o="order";let t={isRemove:!1,name:o,points:[],data:[]},r,s;i.forEach(n=>{switch(n){case"entry":r="yellow",s=e.tools.order.side>0?"LONG":"SHORT";break;case"tp":r="lime",s=parseFloat(Math.abs(e.tools.order.tp.price-e.tools.order.entry.price).toFixed(1));break;case"sl":r="red",s=parseFloat(Math.abs(e.tools.order.sl.price-e.tools.order.entry.price).toFixed(1));break}if(t.points.push(n),m.isSet(e.tools.order[n].line))e.tools.order[n].line.applyOptions({price:e.tools.order[n].price,title:s}),t.data.push(e.tools.order[n].line.options());else{const a={lineType:o,kind:n,side:e.tools.order.side,price:e.tools.order[n].price,color:r,lineWidth:1,lineStyle:0,title:s,draggable:!0};e.tools.order[n].line=e.series.price.createPriceLine(a),t.data.push(a)}}),u.dispatch("tradingDerivative/drawTools",t)}function gt(i){Object.entries(i).forEach(([o,t])=>{e.tools.order.side=t.side,e.tools.order[o].price=t.price,e.tools.order[o].line=e.series.price.createPriceLine(t)})}function N(i,o=!0){o&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"order"}),i.forEach(t=>{m.isSet(e.tools.order[t].line)&&(e.series.price.removePriceLine(e.tools.order[t].line),delete e.tools.order[t].line)})}function ht(i){d.showTradingView=!d.showTradingView,i.stopPropagation()}function yt(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||(Q(),X(),i.target.classList.add("selected"))}function St(){d.showScanContext=!d.showScanContext,d.showLineContext=!1}function xt(){u.dispatch("tradingDerivative/setAutoRefresh",!A.value.autoRefresh)}function Tt(){const i=d.scanSide=="left",o=e.crosshair.time?e.data.price.filter(r=>!x(r.time,i,e.crosshair.time)):e.data.price;let t=i?Ct(o):kt(o);t=wt(t),m.isSet(t)&&(Ve(),Q(),Ce(t),X(t)),xe.value.classList.remove("selected")}function Ct(i){let o,[t,r,s,n]=Array(4).fill({});for(let a=i.length-1;a>=0;a--){const l=i[a].value,c=i[a].time,p=P(c);if(p==-1)break;if(a==i.length-1&&(s={index:p,time:c,price:l},[r,t,n]=Array(3).fill(null).map(()=>m.cloneDeep(s))),o==null){if(l==s.price)continue;o=l>s.price}if(x(l,o,r.price)&&(x(t.price,!o,s.price)?([s,r]=[r,t].map(f=>m.cloneDeep(f)),t={index:p,time:c,price:l},n=m.cloneDeep(t),o=!o):r={index:p,time:c,price:l}),x(l,!o,t.price)?(t={index:p,time:c,price:l},n=m.cloneDeep(t)):n.index=p,x(l,o,n.price)&&(n={index:p,time:c,price:l}),s.index>t.index){const f=Math.abs(r.price-s.price);if(f>=1.5&&(t.index-n.index>s.index-r.index||Math.abs(t.price-n.price)>f))break}}return{A:t,B:r,C:s}}function kt(i){let o,[t,r,s]=Array(3).fill({});for(let n=0;n<i.length;n++){const a=i[n].value,l=i[n].time,c=P(l);if(c==-1)break;if(n==0&&(t={index:c,time:l,price:a},r=m.cloneDeep(t),s=m.cloneDeep(t)),o==null){if(a==t.price)continue;o=a>t.price}x(a,o,r.price)&&(r={index:c,time:l,price:a},s=m.cloneDeep(r)),x(r.price,o,t.price)&&x(a,!o,s.price)&&(x(a,o,t.price)?s={index:c,time:l,price:a}:(t=m.cloneDeep(r),r={index:c,time:l,price:a},s=m.cloneDeep(r),o=!o))}return{A:t,B:r,C:s}}function wt(i){const o={};return Object.entries(i).forEach(([t,r])=>{const{index:s,...n}=r;o[t]=n}),o}function bt(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||i.target.classList.add("selected")}function Ft(i){i.target.classList.remove("selected"),Q(),X()}function Dt(){const i="pattern",o=ce(e.crosshair.y),t=e.crosshair.time;let r={lineType:i,price:o,lineWidth:1,lineStyle:1,draggable:!0};if(m.isSet(e.tools.pattern.A)){const s=e.tools.pattern.A.options();if(m.isSet(e.tools.pattern.B)){const n=e.tools.pattern.B.options();let a,l,c;if(m.isSet(e.tools.pattern.C)){let p,f;const y=e.tools.pattern.C.options();a={A:{time:t,price:o},B:{price:+n.price},C:{price:+y.price}};const{progress:v,timeMark:S,info:{ep1:T,ep2:L,ep3:I,entry:M,prStatus:$,x:W,X:E,y:U,Y:Z}}=se(a);c=v,l=S,p="A",f={price:o,time:t,title:`A ${T}`},e.tools.pattern[p].applyOptions(f),p="B",f={title:`B ${L}`},e.tools.pattern[p].applyOptions(f),p="C",f={title:`C ${I}`},e.tools.pattern[p].applyOptions(f),p="D",f={price:M,title:"Entry "+$},e.tools.pattern[p].applyOptions(f),p="X",f={price:parseFloat(W.toFixed(1)),title:"X "+parseFloat(E.toFixed(1))},e.tools.pattern[p].applyOptions(f),p="Y",f={price:parseFloat(U.toFixed(1)),title:"Y "+parseFloat(Z.toFixed(1))},e.tools.pattern[p].applyOptions(f)}else{a={A:{time:+s.time,price:+s.price},B:{price:+n.price},C:{price:o}};const{progress:p,timeMark:f,info:{ep1:y,ep2:v,ep3:S,entry:T,prStatus:L,x:I,X:M,y:$,Y:W}}=se(a);c=p,l=f;let E="A";e.tools.pattern[E].applyOptions({title:`A ${y}`}),E="B",e.tools.pattern[E].applyOptions({title:`B ${v}`}),r.point="C",r.title=`C ${S}`,r.color="#FFEB3B",e.tools.pattern[r.point]=e.series.price.createPriceLine(r),r.point="D",r.price=T,r.title="Entry "+L,r.color="#9C27B0",r.draggable=!1,e.tools.pattern[r.point]=e.series.price.createPriceLine(r),r.point="Y",r.price=parseFloat($.toFixed(1)),r.title="Y "+parseFloat(W.toFixed(1)),r.color="#E91E63",r.draggable=!1,e.tools.pattern[r.point]=e.series.price.createPriceLine(r),r.point="X",r.price=parseFloat(I.toFixed(1)),r.title="X "+parseFloat(M.toFixed(1)),r.color="#2196F3",r.draggable=!1,e.tools.pattern[r.point]=e.series.price.createPriceLine(r)}ae(c),ne(l),X(a),he.value.classList.remove("selected")}else r.point="B",r.title="B 0",r.color="#4CAF50",e.tools.pattern[r.point]=e.series.price.createPriceLine(r)}else r.point="A",r.title="A 0",r.color="#F44336",r.time=t,e.tools.pattern[r.point]=e.series.price.createPriceLine(r)}function Ce(i,o=!1){const t=o?Ot(i):i;let s={lineType:"pattern",lineWidth:1,lineStyle:1,draggable:!0};const{progress:n,timeMark:a,info:{ep1:l,ep2:c,ep3:p,entry:f,prStatus:y,x:v,X:S,y:T,Y:L}}=se(t);ae(n),ne(a),s.point="A",s.title=`A ${l}`,s.color="#F44336",s.price=t.A.price,s.time=t.A.time,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="B",s.title=`B ${c}`,s.color="#4CAF50",s.price=t.B.price,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="C",s.price=t.C.price,s.title=`C ${p}`,s.color="#FFEB3B",e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="D",s.price=f,s.title="Entry "+y,s.color="#9C27B0",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="Y",s.price=parseFloat(T.toFixed(1)),s.title="Y "+parseFloat(L.toFixed(1)),s.color="#E91E63",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s),s.point="X",s.price=parseFloat(v.toFixed(1)),s.title="X "+parseFloat(S.toFixed(1)),s.color="#2196F3",s.draggable=!1,e.tools.pattern[s.point]=e.series.price.createPriceLine(s)}function re(){if(m.isSet(e.tools.pattern.C)){const i=e.tools.pattern.A.options(),o=e.tools.pattern.B.options(),t=e.tools.pattern.C.options(),r={A:{time:+i.time,price:+i.price},B:{price:+o.price},C:{price:+t.price}};Q(),Ce(r)}}function se(i){const o=ke(i.A,i.B),t=ke(o.R,i.C),r=o.R1.price,s=i.B.price,n=s-r,a=ke(t.R,{price:s+n},i.B.price),l=i.B.price-i.C.price,c=l>0,p=Math.abs(l)>o.pr,f=Math.abs(i.C.price-a.R2.price)>t.pr,y=Math.abs(a.R2.price-a.S2.price)>a.pr,v=x(i.C.price,c,o.S1.price),S=x(a.R2.price,!c,t.S1.price),T=x(a.S2.price,c,a.S1.price),L=v?p?1:0:2,I=S?f?1:0:2,M=T?y?1:0:2,$=`${L}${I}${M}`,W=a.S2.index-o.R.index>o.tr,E=a.S2.index-t.R.index>t.tr,U=a.S2.index-a.R2.index>a.tr;let Z=a.R1.price,G=0;Math.abs(n)>=1.5&&W&&L==1&&(E?I&&U&&M==1&&(Z=a.R2.price,G=2):t.ep<o.ep&&(Z=t.S1.price,G=1));const oi=[o.R.index+o.tr,t.R.index+t.tr,a.R2.index+a.tr],ri=parseFloat(o.ep.toFixed(1)),si=parseFloat(t.ep.toFixed(1)),ni=parseFloat(a.ep.toFixed(1)),ai=Ie(s+n,c),Ne=parseInt((a.breakIndex-o.R.index)/o.tr),Xe=Ne>1?n*Ne:n,li=Ie(s+Xe,c);return{progress:G,timeMark:oi,info:{ep1:ri,ep2:si,ep3:ni,entry:Z,prStatus:$,x:ai,X:n,y:li,Y:Xe}}}function ke(i,o,t=null){let r=m.cloneDeep(i),s=m.cloneDeep(o);const n=s.price>r.price;let a={},l={},c=0,p;return e.data.price.filter(f=>{let y=f.time>=r.time;return e.tools.pickTime&&(y&=f.time<=e.tools.pickTime),y}).every((f,y)=>{const v=f.value,S=f.time,T=P(S);if(T==-1)return!1;if((y==0||v==r.price)&&(a={R:{index:T,time:S,price:v},S:{index:T,time:S,price:v},pr:0,tr:0},l=a),x(v,n,a.R.price)){const L=Math.abs(a.R.price-l.R.price);L<.2&&(l.S.index=a.S.index,l.tr=l.S.index-l.R.index,l.pr+=L),a.tr>=l.tr&&a.pr>=l.pr&&(l=a),a={R:{index:T,time:S,price:v},S:{index:T,time:S,price:v},pr:0,tr:0},t&&!x(v,n,t)&&(c=T)}else a.S.index=T,a.tr=a.S.index-a.R.index,x(v,!n,a.S.price)&&(a.S.time=S,a.S.price=v,a.pr=Math.abs(a.S.price-a.R.price));return x(v,!n,r.price)?(a.S.price=r.price,!1):!!x(v,!n,s.price)}),m.isSet(a)&&(s.index=a.S.index,s.time=pe(a.S.index),p=Math.abs(s.price-l.R.price)/l.pr),{tr:l.tr,pr:l.pr,ep:l.pr?p:0,S1:l.S,R1:l.R,S2:a.S,R2:a.R,S:r,R:s,breakIndex:c}}function Ie(i,o){let t=parseFloat((i%1).toFixed(1));if(o){if(t>=.1&&t<=.2)return Math.floor(i);if(t>=.6&&t<=.7)return Math.floor(i)+.5}else{if(t>=.8&&t<=.9)return Math.ceil(i);if(t>=.3&&t<=.4)return Math.floor(i)+.5}return i}function Ot(i){let o=m.cloneDeep(i);const t=o.B.price-o.A.price,r=e.data.price.at(-1).value;if(x(r,!t,o.C.price)){let s=r;for(let n=e.data.price.length-1;n>=0;n--){const a=e.data.price[n].value;if(a==o.C.price)break;s=t?Math.min(s,a):Math.max(s,a)}o.C.price=s,X(o)}return o}function X(i={}){let o=!m.isSet(i),t={isRemove:o,name:"pattern",points:[],data:[]};o||Object.entries(i).forEach(([r,s])=>{t.points.push(r),t.data.push(s)}),u.dispatch("tradingDerivative/drawTools",t)}function Q(){m.isSet(e.tools.pattern.A)&&(e.series.price.removePriceLine(e.tools.pattern.A),m.isSet(e.tools.pattern.B)&&(e.series.price.removePriceLine(e.tools.pattern.B),m.isSet(e.tools.pattern.C)&&(e.series.price.removePriceLine(e.tools.pattern.C),e.series.price.removePriceLine(e.tools.pattern.D),e.series.price.removePriceLine(e.tools.pattern.X),e.series.price.removePriceLine(e.tools.pattern.Y)))),z(["pattern"]),ne([]),ae(0)}function ne(i){const o=["#F44336","#4CAF50","#FFEB3B"];let t=[];for(let r=0;r<i.length;r++)t.push({time:pe(i[r]),value:1,color:o[r]});t.length&&t.sort((r,s)=>r.time-s.time),e.series.timeMark.setData(t)}function ae(i){d.progress=i}function Lt(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||i.target.classList.add("selected")}function Rt(i){i.target.classList.remove("selected"),Ve(),re()}function At(){const i=e.crosshair.time;u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:"0_pt",points:[0],data:[i]}),Me(i),re(),ye.value.classList.remove("selected")}function Me(i){e.tools.pickTime=i,e.series.pickTime.setData([{time:i,value:1,color:"#9C27B0"}])}function Ve(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"0_pt"}),e.series.pickTime.setData([]),z(["pt"])}function Pt(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||i.target.classList.add("selected")}function Et(i){$e(),i.target.classList.remove("selected")}function _t(){let i={isRemove:!1,name:"tr",points:[],data:[]};const o=e.crosshair.time;let t={time:o,value:1};switch(e.tools.timeRange.length){case 0:t.color="OrangeRed",e.tools.timeRange[0]=t,i.points.push(0),i.data.push(o);break;case 1:t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(o),ie.value.classList.remove("selected");break;default:const r=P(e.tools.timeRange[0].time),s=P(e.tools.timeRange[1].time),a=P(o)+(s-r),l=pe(a);t.color="OrangeRed",e.tools.timeRange[0]=m.cloneDeep(t),i.points.push(0),i.data.push(o),t.time=l,t.color="lime",e.tools.timeRange[1]=t,i.points.push(1),i.data.push(l),ie.value.classList.remove("selected");break}e.series.timeRange.setData(e.tools.timeRange),u.dispatch("tradingDerivative/drawTools",i)}function Bt(i){let o,t;if(i.length==2)o=i[0],t=i[1];else if(i.length==3){const s=P(i[0]),n=P(i[1]),l=P(i[2])+(n-s);o=i[2],t=pe(l)}else return!1;let r=[{time:o,value:1,color:"OrangeRed"},{time:t,value:1,color:"lime"}];e.tools.timeRange=r,e.series.timeRange.setData(r)}function $e(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"tr"}),e.series.timeRange.setData([]),z(["tr"])}function It(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||i.target.classList.add("selected")}function Mt(i){d.showLineContext=!d.showLineContext,d.showScanContext=!1}function Vt(){const i="line",o=ce(e.crosshair.y),t=e.tools.lines.length;if(e.tools.lines=e.tools.lines.filter(r=>{const s=r.options(),n=s.type=o==+s.price;return n&&(e.series.price.removePriceLine(r),u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:i,point:o})),!n}),e.tools.lines.length==t){const r=d.lineColor,s=d.lineTitle,n={lineType:i,price:o,color:r,title:s,lineWidth:1,lineStyle:1,draggable:!0};e.tools.lines.push(e.series.price.createPriceLine(n)),u.dispatch("tradingDerivative/drawTools",{isRemove:!1,name:i,points:[o],data:[{color:r,title:s}]})}te.value.classList.remove("selected")}function $t(i){const t={lineType:"line",lineWidth:1,lineStyle:1,draggable:!0};Object.entries(i).forEach(([r,{color:s,title:n}])=>{t.price=+r,t.color=s,t.title=n,e.tools.lines.push(e.series.price.createPriceLine(t))})}function We(i=!0){e.tools.lines.length>0&&(i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"line"}),e.tools.lines.forEach(o=>e.series.price.removePriceLine(o)),z(["lines"]))}function Wt(i){d.showScanContext=!1,d.showLineContext=!1;const o=i.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command:not(.drawless)").forEach(t=>t.classList.remove("selected")),o||(i.target.classList.add("selected"),we())}function Zt(i){we(),i.target.classList.remove("selected")}function Yt(){const i="target",o=ce(e.crosshair.y);let t={lineType:i,price:o,lineWidth:1,lineStyle:1,draggable:!0},r={isRemove:!1,name:i,points:[],data:[o]};if(m.isSet(e.tools.target.A)){const s=+e.tools.target.A.options().price,n=o-s;t.point="B",t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),r.points.push(t.point),t.point="X",t.price=parseFloat((s-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((s-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((s-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((s-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t),Se.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),r.points.push(t.point);u.dispatch("tradingDerivative/drawTools",r)}function Nt(i){let t={lineType:"target",lineWidth:1,lineStyle:1,draggable:!0};const r=i.A,s=i.B,n=s-r;t.point="A",t.price=r,t.title="0",t.color="#FF9800",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="B",t.price=s,t.title=parseFloat(n.toFixed(1)),t.color="#F44336",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="X",t.price=parseFloat((r-.5*n).toFixed(1)),t.title=parseFloat((-.5*n).toFixed(1)),t.color="#2196F3",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Y",t.price=parseFloat((r-n).toFixed(1)),t.title=parseFloat(-n.toFixed(1)),t.color="#673AB7",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="Z",t.price=parseFloat((r-2*n).toFixed(1)),t.title=parseFloat((-2*n).toFixed(1)),t.color="#9C27B0",e.tools.target[t.point]=e.series.price.createPriceLine(t),t.point="W",t.price=parseFloat((r-4*n).toFixed(1)),t.title=parseFloat((-4*n).toFixed(1)),t.color="#E91E63",e.tools.target[t.point]=e.series.price.createPriceLine(t)}function we(i=!0){i&&u.dispatch("tradingDerivative/drawTools",{isRemove:!0,name:"target"}),m.isSet(e.tools.target.A)&&(e.series.price.removePriceLine(e.tools.target.A),m.isSet(e.tools.target.B)&&(e.series.price.removePriceLine(e.tools.target.B),e.series.price.removePriceLine(e.tools.target.X),e.series.price.removePriceLine(e.tools.target.Y),e.series.price.removePriceLine(e.tools.target.Z),e.series.price.removePriceLine(e.tools.target.W))),z(["target"])}function Xt(){N(["entry","tp","sl"],!1),We(!1),we(!1),$e(!1),Q()}function le(i){if(i){if(B()&&(m.isSet(e.tools.order.tp.line)||D.value.position&&e.currentSeconds>F.ATO&&e.currentSeconds<F.ATC&&(q.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-61?-61:1))+"px",q.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-51?-51:1))+"px",q.value.style.display="block"),!m.isSet(e.tools.order.entry.line))){let o=null,t=0;D.value.position?(e.currentSeconds<F.ATO?o="ATO":e.currentSeconds>F.ATC&&(o="ATC"),o&&(e.tools.order.entry.price=o,t=-D.value.position)):e.currentSeconds>F.ATO&&e.currentSeconds<F.ATC&&(o=ce(e.crosshair.y),t=o>=e.data.price.at(-1).value?1:-1,e.tools.order.side=t,e.tools.order.entry.price=o),t&&(V.value.style.left=+(e.crosshair.x+(e.crosshair.x>innerWidth-71?-71:1))+"px",V.value.style.top=+(e.crosshair.y+(e.crosshair.y>innerHeight-61?-61:1))+"px",V.value.style.background=t>0?"green":"red",V.value.innerText=`${t>0?"LONG":"SHORT"} ${o}`,V.value.style.display="block")}}else V.value.style.display="none",q.value.style.display="none"}function zt(){B()&&(e.currentSeconds<F.ATO?He(h("trading.derivative.atoOrder"),h("titles.confirm")).then(o=>{o&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATO"}}).then(t=>{t.isOk?k.success(h("trading.derivative.atoOrderSuccess")):O(t.message)})}):e.currentSeconds<F.ATC?u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"new",side:e.tools.order.side,price:e.tools.order.entry.price}}).then(i=>{i.isOk?(Y(["entry"]),k.success(h("trading.derivative.newEntrySuccess"))):O(i.message)}):He(h("trading.derivative.atcOrder"),h("titles.confirm")).then(o=>{o&&u.dispatch("tradingDerivative/executeOrder",{action:"exit",exitData:{cmd:"new",price:"ATC"}}).then(t=>{t.isOk?k.success(h("trading.derivative.atcOrderSuccess")):O(t.message)})}))}function Jt(){e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*je,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*qe,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(i=>{i.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),Y(["entry","tp","sl"]),k.success(h("trading.derivative.newTpSlSuccess"))):O(i.message)})}function Ht(){m.isSet(e.tools.order.entry.line)?m.isSet(e.tools.order.tp.line)?u.dispatch("tradingDerivative/executeOrder",{action:"exit",tpData:{cmd:"cancel"},slData:{cmd:"delete"},exitData:{cmd:"new",price:"MTL"}}).then(i=>{i.isOk?(N(["entry","tp","sl"]),k.success(h("trading.derivative.exitSuccess"))):O(i.message)}):u.dispatch("tradingDerivative/executeOrder",{action:"entry",etData:{cmd:"delete"}}).then(i=>{i.isOk?(N(["entry"]),k.success(h("trading.derivative.deleteEntrySuccess"))):O(i.message)}):de()}function jt(i){m.isSet(e.tools.order.entry.line)&&(m.isSet(e.tools.order.tp.line)?((e.tools.order.side>0&&i>=e.tools.order.tp.price||e.tools.order.side<0&&i<=e.tools.order.tp.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"sl",slData:{cmd:"delete"}}).then(o=>{o.isOk?(N(["entry","tp","sl"]),k.success(h("trading.derivative.deleteTpSuccess")),le(!1)):O(o.message),e.isAutoOrdering=!1}))),(e.tools.order.side>0&&i<=e.tools.order.sl.price||e.tools.order.side<0&&i>=e.tools.order.sl.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,u.dispatch("tradingDerivative/executeOrder",{action:"tp",tpData:{cmd:"cancel"}}).then(o=>{o.isOk?(N(["entry","tp","sl"]),k.success(h("trading.derivative.deleteSlSuccess")),le(!1)):O(o.message),e.isAutoOrdering=!1})))):(e.tools.order.side>0&&i>=e.tools.order.entry.price||e.tools.order.side<0&&i<=e.tools.order.entry.price)&&(e.isAutoOrdering||(e.isAutoOrdering=!0,setTimeout(()=>{e.tools.order.tp.price=e.tools.order.entry.price+e.tools.order.side*je,e.tools.order.sl.price=e.tools.order.entry.price-e.tools.order.side*qe,u.dispatch("tradingDerivative/executeOrder",{action:"tpsl",tpData:{cmd:"new",price:e.tools.order.tp.price},slData:{cmd:"new",price:e.tools.order.sl.price}}).then(o=>{o.isOk?(e.tools.order.entry.line.applyOptions({draggable:!1}),Y(["entry","tp","sl"]),k.success(h("trading.derivative.autoNewTpSlSuccess"))):O(o.message),e.isAutoOrdering=!1})},1e3))))}function qt(){e.chart.timeScale().scrollToRealTime()}function B(){return A.value.openingMarket&&e.currentSeconds>=F.START&&e.currentSeconds<=F.END}function ce(i){return parseFloat(e.series.price.coordinateToPrice(i).toFixed(1))}function O(i){i||(i="unknown"),k.error(h(`trading.derivative.${i}`))}function Qt(){if(!d.chartDate)return!1;u.dispatch("tradingDerivative/getChartData",d.chartDate)}function Ze(){B()&&e.websocket.send(e.socketSendData)}function Ut(){e.data.whitespace=[],e.data.price=[],Ze(),u.dispatch("tradingDerivative/getChartData",d.chartDate)}function Ye(){u.dispatch("tradingDerivative/getStatus")}function de(){u.dispatch("tradingDerivative/getTools")}function z(i){i==null&&(i=["order","lines","tr","pattern","target","pt"]),i.includes("order")&&(e.tools.order={side:0,entry:{},tp:{},sl:{}}),i.includes("lines")&&(e.tools.lines=[]),i.includes("target")&&(e.tools.target={}),i.includes("tr")&&(e.tools.timeRange=[]),i.includes("pattern")&&(e.tools.pattern={}),i.includes("pt")&&(e.tools.pickTime=null)}function Gt(){u.dispatch("tradingDerivative/getAccountInfo").then(i=>{let o="";o+='<div style="width: 200px;">',o+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.nav")}</div><div>: ${ee.currency(i.nav)}</div></div>`,o+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.maxVol")}</div><div>: ${ee.numberVnFormat(i.maxVol)}</div></div>`,o+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.vm")}</div><div>: ${ee.currency(i.vm)}</div></div>`,o+=`<div style="display: flex;"><div style="flex: 0 0 75px;">${h("trading.derivative.fee")}</div><div>: ${ee.currency(i.fee)}</div></div>`,o+="</div>",Ci(o,h("trading.derivative.accountInfo"))})}function Kt(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/report"))}function ei(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/export",d.chartDate))}function ti(){Oe.value.show()}function ii(){ge.emit("checkPin",()=>u.dispatch("tradingDerivative/loginDnse"))}function x(i,o,t,r=!1){return o?r?i>=t:i>t:r?i<=t:i<t}function P(i){let o=e.data.whitespace.findIndex(t=>t.time==i);if(o==-1){const t=ue(new Date(i*1e3),"yyyy-MM-dd"),r=w(new Date(`${t}T11:30:00Z`)),s=w(new Date(`${t}T13:00:00Z`)),n=w(new Date(`${t}T14:30:00Z`));i>r&&i<s?i=r:i>n&&(i=n),o=e.data.whitespace.findIndex(a=>a.time==i)}return o}function pe(i){return e.data.whitespace[i].time}return(i,o)=>{const t=ki("DxToolbar");return wi(),gi(Si,null,[g("div",Ri,[fe(t,{items:[{location:"before",widget:"dxButton",options:{icon:"far fa-file-chart-pie small",hint:i.$t("trading.derivative.buttons.report"),onClick:Kt}},{location:"before",widget:"dxButton",options:{icon:"far fa-cloud-arrow-down small",hint:i.$t("trading.derivative.buttons.export"),onClick:ei}},{location:"before",widget:"dxButton",options:{icon:"far fa-arrow-right-to-arc small",hint:i.$t("trading.derivative.buttons.loginVps"),onClick:ti}},{visible:!1,location:"before",widget:"dxButton",options:{icon:"far fa-sign-in-alt small",hint:i.$t("trading.derivative.buttons.loginDnse"),onClick:ii}}]},null,8,["items"]),g("div",{class:"order-chart-container",ref_key:"chartContainerRef",ref:R,onClick:nt,onContextmenu:at},[g("div",{class:"chart-wrapper",ref_key:"orderChartRef",ref:De},[g("div",{class:"area data-area",onClick:Re,onContextmenu:Ae},[g("div",{ref_key:"connectionRef",ref:Ue,class:_(["command",{yellow:D.value.pending}]),title:i.$t("trading.derivative.connection"),onClick:Ye},[g("i",{class:_(["far",{"fa-link-simple":D.value.connection,"fa-link-simple-slash":!D.value.connection,blink:d.isSocketWarning}])},null,2)],10,Ai),g("div",{class:_(["command status",{green:D.value.position>0,red:D.value.position<0}]),title:i.$t("trading.derivative.position"),onClick:Gt},Je(D.value.position),11,Pi),g("div",{class:"command clock",onClick:Ze},Je(d.clock),1),K(g("input",{type:"date",class:"chart-date command",title:i.$t("trading.derivative.date"),"onUpdate:modelValue":o[0]||(o[0]=r=>d.chartDate=r),onChange:Qt},null,40,Ei),[[hi,d.chartDate]]),g("div",{ref_key:"reloadToolRef",ref:et,class:"command",title:i.$t("trading.derivative.reload"),onClick:Ut,onContextmenu:de},[g("i",{class:_(["far fa-sync-alt",{"fa-spin":ot.value}])},null,2)],40,_i)],32),g("div",{class:"area tool-area",onClick:Re,onContextmenu:Ae},[g("div",{ref_key:"fullscreenToolRef",ref:Ge,class:"command",title:i.$t("trading.derivative.fullscreen"),onClick:pt},[g("i",{class:_(["far",{"fa-compress":d.isFullscreen,"fa-expand":!d.isFullscreen}])},null,2)],8,Bi),g("div",{ref_key:"tradingviewRef",ref:tt,class:"command far fa-chart-candlestick",title:i.$t("trading.derivative.tradingview"),onClick:ht},null,8,Ii),g("div",{class:_(["context command",{green:d.progress}]),title:i.$t("trading.derivative.progressTool"),onClick:re,onContextmenu:xt},[g("i",{class:_(["far",{"fa-badge-check":!d.progress,[`fa-circle-${d.progress}`]:d.progress,blink:A.value.autoRefresh}])},null,2)],42,Mi),g("div",{ref_key:"scanToolRef",ref:xe,class:"context command",title:i.$t("trading.derivative.scanTool"),onClick:yt,onContextmenu:St},[g("i",{class:_(["far",{[`fa-angles-${d.scanSide}`]:!0}])},null,2),K(fe(Fi,{class:"contextmenu",modelValue:d.scanSide,"onUpdate:modelValue":o[1]||(o[1]=r=>d.scanSide=r)},null,8,["modelValue"]),[[me,d.showScanContext]])],40,Vi),g("div",{ref_key:"patternToolRef",ref:he,class:"command",title:i.$t("trading.derivative.patternTool"),onClick:bt,onContextmenu:Ft},Zi,40,$i),g("div",{ref_key:"pickTimeToolRef",ref:ye,class:"command",title:i.$t("trading.derivative.pickTimeTool"),onClick:Lt,onContextmenu:Rt},Xi,40,Yi),g("div",{ref_key:"lineToolRef",ref:te,class:"context command",title:i.$t("trading.derivative.lineTool"),onClick:It,onContextmenu:Mt},[Ji,K(fe(bi,{class:"contextmenu",enable:d.showLineContext,title:d.lineTitle,"onUpdate:title":o[2]||(o[2]=r=>d.lineTitle=r),color:d.lineColor,"onUpdate:color":o[3]||(o[3]=r=>d.lineColor=r),onDeleteAllLine:We},null,8,["enable","title","color"]),[[me,d.showLineContext]])],40,zi),g("div",{ref_key:"timeRangeToolRef",ref:ie,class:"command",title:i.$t("trading.derivative.timeRangeTool"),onClick:Pt,onContextmenu:Et},qi,40,Hi),g("div",{ref_key:"targetToolRef",ref:Se,class:"command",title:i.$t("trading.derivative.targetTool"),onClick:Wt,onContextmenu:Zt},Gi,40,Qi),K(g("div",{ref_key:"cancelOrderRef",ref:it,class:"cancel-order command",title:i.$t("trading.derivative.cancelTool"),onClick:Ht},[g("i",{class:_(["far fa-trash-alt",{blink:d.isOrderWarning}])},null,2)],8,Ki),[[me,rt.value]])],32),g("div",null,[g("div",{ref_key:"entryOrderRef",ref:V,class:"order-button entry",onClick:zt}," Entry ",512),g("div",{ref_key:"tpslOrderRef",ref:q,class:"order-button tpsl",onClick:Jt}," TP/SL ",512),g("div",{class:"chart-top command far fa-angle-double-right",onClick:qt})]),K(g("iframe",{ref_key:"tradingviewChartRef",ref:Ke,class:"tradingview-chart",style:yi(d.tradingViewStyle),src:st.value},null,12,eo),[[me,d.showTradingView]])],512)],544)]),fe(Di,{ref_key:"vpsOtpPopupRef",ref:Oe},null,512)],64)}}};export{co as default};
