import{u as V,c as q,i as c,r as y,d as A,e as E,w as F,f,n as B,k as o,_ as M,o as z,j as e,l as i,m as I,D as s}from"./app-0b384ab8.js";const N={__name:"TrackStatisticPopup",setup(G,{expose:b}){const r=V(),{t:l}=q(),w=c("bus"),d=c("mt"),_=c("mc"),h=c("mf"),v=y(null),m=y(null),a=A({gridData:null,editPermission:"trades@edit",validationRules:{symbol:[{type:"required",message:l("trading.statistic.symbol")+d.validations.required}],buyDate:[{type:"required",message:l("trading.statistic.date")+d.validations.required}],buyVolume:[{type:"required",message:l("trading.statistic.volume")+d.validations.required},{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}],buyPrice:[{type:"required",message:l("trading.statistic.price")+d.validations.required},{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}],buyFee:[{type:"required",message:l("trading.statistic.fee")+d.validations.required},{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}],sellDate:[{type:"custom",validationCallback:k,message:l("trading.statistic.validations.sellDate")}],sellVolume:[{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}],sellPrice:[{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}],sellFee:[{type:"custom",validationCallback:n,message:l("trading.statistic.validations.array")}]}}),u=E(()=>r.state.auth.user.permissions);F(()=>r.state.tradingStatistic.data,t=>{a.gridData=h.cloneDeep(t)});function D(){v.value.show()}function R(t){t.changes.length&&w.emit("checkPin",()=>r.dispatch("tradingStatistic/save",t))}function $(t){t.data.buy_date=moment().format(_.SERVER_DATE_FORMAT),t.data.buy_volume="[]",t.data.buy_price="[]",t.data.buy_fee="[]",t.data.sell_volume="[]",t.data.sell_price="[]",t.data.sell_fee="[]"}function k(t){return t.value?moment(t.value).isAfter(moment(t.data.buy_date)):!0}function n(t){return/^\[.*\]$/.test(t.value)}function S(){r.dispatch("tradingStatistic/getData")}function C(){a.gridData=null}return b({show:D}),(t,p)=>{const P=f("DxToolbar"),T=f("DxScrollView");return z(),B(M,{ref_key:"popupRef",ref:v,title:t.$t("trading.statistic.buttons.addData"),onShown:S,onHidden:C},{default:o(()=>[e(T,null,{default:o(()=>[e(i(I),{ref_key:"dataGridRef",ref:m,"data-source":a.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:8},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:u.value.includes(a.editPermission),allowUpdating:u.value.includes(a.editPermission),allowDeleting:u.value.includes(a.editPermission),mode:"batch",startEditAction:"dblClick"},onContentReady:p[0]||(p[0]=g=>t.$mf.dataGridPreload(a.gridData,m.value.instance)),onInitNewRow:$,onSaved:R},{commandCellTemplate:o(({data:g})=>[e(P,{items:[{locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>{m.value.instance.deleteRow(g.rowIndex)}}}]},null,8,["items"])]),default:o(()=>[e(i(s),{fixed:!0,visible:u.value.includes(a.editPermission),width:35,type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t("titles.commandHeaderTitleShort")},null,8,["visible","caption"]),e(i(s),{"data-field":"symbol","data-type":"string",width:80,caption:t.$t("trading.statistic.symbol"),"validation-rules":a.validationRules.symbol},null,8,["caption","validation-rules"]),e(i(s),{alignment:"center",caption:t.$t("trading.statistic.buy")},{default:o(()=>[e(i(s),{"data-field":"buy_date","data-type":"date",width:110,"editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("trading.statistic.date"),"validation-rules":a.validationRules.buyDate},null,8,["editor-options","caption","validation-rules"]),e(i(s),{"data-field":"buy_volume","data-type":"string",caption:t.$t("trading.statistic.volume"),"validation-rules":a.validationRules.buyVolume},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"buy_price","data-type":"string",caption:t.$t("trading.statistic.price"),"validation-rules":a.validationRules.buyPrice},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"buy_fee","data-type":"string",caption:t.$t("trading.statistic.fee"),"validation-rules":a.validationRules.buyFee},null,8,["caption","validation-rules"])]),_:1},8,["caption"]),e(i(s),{alignment:"center",caption:t.$t("trading.statistic.sell")},{default:o(()=>[e(i(s),{"data-field":"sell_date","data-type":"date",width:110,"editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("trading.statistic.date"),"validation-rules":a.validationRules.sellDate},null,8,["editor-options","caption","validation-rules"]),e(i(s),{"data-field":"sell_volume","data-type":"string",caption:t.$t("trading.statistic.volume"),"validation-rules":a.validationRules.sellVolume},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"sell_price","data-type":"string",caption:t.$t("trading.statistic.price"),"validation-rules":a.validationRules.sellPrice},null,8,["caption","validation-rules"]),e(i(s),{"data-field":"sell_fee","data-type":"string",caption:t.$t("trading.statistic.fee"),"validation-rules":a.validationRules.sellFee},null,8,["caption","validation-rules"])]),_:1},8,["caption"])]),_:1},8,["data-source","editing"])]),_:1})]),_:1},8,["title"])}}};export{N as default};
