import{u as B,a as F,b as A,c as O,i as d,r as V,d as _,e as z,w as H,f as N,g as X,h as G,j as o,k as y,l,F as x,o as L,D as s,m as j}from"./app-bf6ad851.js";import W from"./PaidContractPopup-ed9d53e3.js";import U from"./WithdrawnContractPopup-d6faa88c.js";import{C as J}from"./ContractDetailPopup-22c925ad.js";import"./accordion-e8d2d33e.js";import"./Index-ce0ebfc6.js";import"./load-indicator-b4a22382.js";/* empty css                                                            */const K={class:"content-block dx-card responsive-paddings"},lt={__name:"Index",setup(Q){const u=B(),w=F(),c=A(),{t:i}=O();d("bus");const v=d("filters"),C=d("mc"),m=d("mt"),p=d("mf"),h=d("routeHistoryState"),a=V(null),n=_({gridData:null,validationRules:{}}),r=z(()=>u.state.auth.user.permissions);let f=!1;u.dispatch("adminContract/getContracts").then(()=>b()),H(()=>u.state.adminContract.contracts,t=>E(t));function $(t){u.dispatch("adminContract/save",{changes:t.changes})}function S(t){t.toolbarOptions.items.unshift({visible:p.isSet(c.query),location:"before",widget:"dxButton",options:{icon:"far fa-arrow-left small",hint:i("buttons.back"),onClick:()=>{w.go(-1)}}},{location:"before",widget:"dxButton",options:{icon:"far fa-history small",type:f?"default":"normal",hint:i("models.contract.includeWithdrawn"),onClick:()=>{f=!f,a.value.instance.beginCustomLoading(),u.dispatch("adminContract/getContracts",f)}}})}function b(){n.validationRules={user:[{type:"required",message:i("models.contract.user")+m.validations.required}],principal:[{type:"required",message:i("models.contract.principal")+m.validations.required},{type:"custom",validationCallback:T,message:i("models.contract.validations.principal").replace("{amount}",v.currency(n.principalMin))}],advance:[{type:"custom",validationCallback:D,message:i("models.contract.validations.advance").replace("{advance}",v.currency(.1*n.principalMin)).replace("{surplus}",v.currency(n.principalMin))}],interestRate:[{type:"required",message:i("models.contract.interestRate")+m.validations.required}],paidAt:[{type:"required",message:i("models.contract.paidAt")+m.validations.required}]}}function R(t){t.data.interest_rate=n.interestRate,t.data.paid_at=moment().format(C.SERVER_DATE_FORMAT),a.value.instance.columnOption("interest_rate","allowEditing",r.value.includes("system@control")),a.value.instance.option("editing.popup.title",i("models.contract.popup.create"))}function k(t){a.value.instance.columnOption("user_code","allowEditing",t.data.status==1||r.value.includes("system@control")),a.value.instance.columnOption("principal","allowEditing",t.data.status==1||r.value.includes("system@control")),a.value.instance.columnOption("interest_rate","allowEditing",r.value.includes("system@control")),a.value.instance.columnOption("paid_at","allowEditing",t.data.status==1||r.value.includes("system@control")),a.value.instance.columnOption("withdrawn_at","allowEditing",[2,3].includes(t.data.status)),a.value.instance.option("editing.popup.title",`${i("models.contract.popup.edit")} #${t.data.code}`)}function T(t){return t.value>=n.principalMin}function D(t){return t.value?t.value>=.1*n.principalMin&&t.data.total-t.value>=n.principalMin:!0}function E(t){n.gridData=p.cloneDeep(t),c.query.code&&a.value.instance.columnOption("code","filterValues",[+c.query.code]),c.query.userCode&&a.value.instance.columnOption("userCode","filterValues",[+c.query.userCode])}function M(t){p.checkPinDataGrid(t,a.value.instance),p.pushPopupToHistoryState(h,()=>a.value.instance.cancelEditData())}function P(){p.popRouteHistoryState(h)}function I(t){t.rowType=="data"&&t.columnIndex==2&&w.push({name:"users",query:{code:t.data.user_code}})}return(t,g)=>{const q=N("DxToolbar");return L(),X(x,null,[G("div",K,[o(l(j),{ref_key:"dataGridRef",ref:a,"data-source":n.gridData,"key-expr":"id","show-borders":!0,"column-auto-width":!0,"allow-column-reordering":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",paging:{pageSize:10},headerFilter:{visible:!0},loadPanel:{enabled:!0},selection:{mode:"single"},editing:{allowAdding:!0,allowUpdating:!0,allowDeleting:!0,confirmDelete:!1,mode:"popup",popup:{fullScreen:!!t.$screen.getScreenSizeInfo.isXSmall,showTitle:!0,onShown:M,onHiding:P},form:{labelLocation:t.$screen.getScreenSizeInfo.isXSmall?"top":"left",items:[{dataField:"user_code"},{dataField:"principal"},{dataField:"interest_rate"},{dataField:"paid_at"},{dataField:"advance"},{dataField:"withdrawn_at"}]}},onCellPrepared:t.$mf.setContractStatusColor,onContentReady:g[0]||(g[0]=e=>t.$mf.dataGridPreload(n.gridData,a.value.instance)),onInitNewRow:R,onEditingStart:k,onToolbarPreparing:S,onCellDblClick:I,onSaved:$},{commandCellTemplate:y(({data:e})=>[o(q,{items:[{visible:e.data.status==2&&r.value.includes("system@control")||[0,1].includes(e.data.status),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status==2?"file-":""}check small`,hint:t.$t(`components.paidContract.${e.data.status==2?"confirmTitle":"title"}`),text:t.$t(`components.paidContract.${e.data.status==2?"confirmTitle":"title"}`),onClick:()=>t.$refs.paidContractPopupRef.show(e.data)}},{visible:e.data.status==3||e.data.status==4&&r.value.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:`far fa-${e.data.status<=1?"check":e.data.status==3?"check-double":"file-check"} small`,hint:t.$t(`components.withdrawnContract.${e.data.status==4?"withdrawnTitle":"title"}`),text:t.$t(`components.withdrawnContract.${e.data.status==4?"withdrawnTitle":"title"}`),onClick:()=>t.$refs.withdrawnContractPopupRef.show(e.data)}},{visible:e.data.status<=3||r.value.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"edit",hint:t.$t("buttons.edit"),text:t.$t("buttons.edit"),onClick:()=>a.value.instance.editRow(e.rowIndex)}},{visible:e.data.status==0||r.value.includes("system@control"),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"trash",hint:t.$t("buttons.delete"),text:t.$t("buttons.delete"),onClick:()=>t.$bus.emit("checkPin",()=>a.value.instance.deleteRow(e.rowIndex))}},{visible:!isNaN(e.key),locateInMenu:"auto",showText:"inMenu",location:"center",widget:"dxButton",options:{type:"default",icon:"info",hint:t.$t("models.contract.popup.detail"),text:t.$t("models.contract.popup.detail"),onClick:()=>t.$refs.contractDetailPopupRef.show(e.data)}}]},null,8,["items"])]),default:y(()=>[o(l(s),{fixed:!0,width:t.$screen.getScreenSizeInfo.isXSmall?35:125,alignment:"center",type:"buttons",cssClass:"dx-datagrid-command-column","cell-template":"commandCellTemplate",caption:t.$t(`titles.commandHeaderTitle${t.$screen.getScreenSizeInfo.isXSmall?"Short":""}`)},null,8,["width","caption"]),o(l(s),{"allow-editing":!1,"data-field":"code",dataType:"string","header-filter":{allowSearch:!0},caption:t.$t("models.contract.codeShort")},null,8,["caption"]),o(l(s),{"allow-editing":!1,"data-field":"status",dataType:"number",caption:t.$t("models.contract.status"),lookup:{dataSource:t.$mf.getContractStatusList(),displayExpr:"name",valueExpr:"value"}},null,8,["caption","lookup"]),o(l(s),{"data-field":"user_code",dataType:"number",name:"userCode","header-filter":{allowSearch:!0},caption:t.$t("models.contract.user"),"validation-rules":n.validationRules.user,lookup:{dataSource:t.users,displayExpr:"name",valueExpr:"code",searchEnabled:!0,searchExpr:["code","name"]}},null,8,["caption","validation-rules","lookup"]),o(l(s),{"data-field":"principal","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.principal"),"validation-rules":n.validationRules.principal},null,8,["caption","validation-rules"]),o(l(s),{"data-field":"interest_rate","data-type":"number",format:"#0.## %/"+t.$t("models.contract.frequency"),"editor-options":{step:"0.0001",format:"#0.## %/"+t.$t("models.contract.frequency")},caption:t.$t("models.contract.interestRate"),"validation-rules":n.validationRules.interestRate},null,8,["format","editor-options","caption","validation-rules"]),o(l(s),{"data-field":"paid_at","data-type":"date","editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("models.contract.paidAt"),"validation-rules":n.validationRules.paidAt},null,8,["editor-options","caption","validation-rules"]),o(l(s),{"data-field":"advance","data-type":"number",format:"#,##0 ₫","editor-options":{step:"1000000",format:"#,##0 ₫"},"header-filter":{allowSearch:!0},caption:t.$t("models.contract.advance"),"validation-rules":n.validationRules.advance},null,8,["caption","validation-rules"]),o(l(s),{"data-field":"withdrawn_at","data-type":"date","editor-options":{dateSerializationFormat:t.$mc.DX_SERVER_DATE_FORMAT,showClearButton:"true",useMaskBehavior:"true",applyValueMode:"useButtons"},caption:t.$t("models.contract.withdrawnAt")},null,8,["editor-options","caption"])]),_:1},8,["data-source","editing","onCellPrepared"])]),o(W,{ref:"paidContractPopupRef"},null,512),o(U,{ref:"withdrawnContractPopupRef"},null,512),o(J,{ref:"contractDetailPopupRef"},null,512)],64)}}};export{lt as default};
