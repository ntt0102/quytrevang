import{_ as C,b as _,r as l,c as p,e as c,w as d,f as b,g as f,o as m,d as e,t as a,h as u,i as y}from"./app-6ea57162.js";import{_ as $}from"./accordion-b8ca3713.js";import{D as I}from"./load-indicator-852ae77b.js";import{P as S}from"./Index-9ee5660b.js";import"./interest-formula-45587e77.js";const P={components:{DxAccordion:$,DxLoadIndicator:I,Pdf:S},data(){return{refreshKey:0,contract:{},formData:{},backupDocuments:[],qrSrc:null}},mounted(){this.initFormData()},computed:{popup(){return this.$refs.popup.instance},accordion(){return this.$refs.accordion.instance},submit(){return this.$refs.submit.instance}},methods:{..._("Admin.contracts",["withdrawnContract"]),show(t){this.popup.option("title",this.$t(`components.withdrawnContract.${t.status==4?"withdrawnTitle":"title"}`)+" #"+t.code),this.contract=t,this.popup.show(),setTimeout(()=>this.accordion.option("selectedIndex",t.status==3?0:1),500),this.backupDocuments=t.url_withdrawn_docs.map(r=>({file:r,isUpload:!1})),this.formData.documents=this.backupDocuments;let o=`https://img.vietqr.io/image/${this.contract.bank_account.bank_name}-${this.contract.bank_account.account_number}-KRnx1D.jpg?accountName=${this.contract.bank_account.account_name}&amount=${this.contract.advance}&addInfo=${this.$t("models.contract.transfer.contentValue").replace("{contractCode}",this.contract.code)}`;this.$mf.fetchImage(o).then(r=>this.qrSrc=r),this.$mf.pushPopupToHistoryState(()=>this.popup.hide())},onUploadImageChange(t){this.formData.documents=this.formData.documents.filter(o=>!o.isUpload),[...t.target.files].forEach(o=>this.formData.documents.push({file:URL.createObjectURL(o),isUpload:!0}))},onCheckBoxDeleteChange(t){t.value?this.formData.documents=this.formData.documents.filter(o=>o.isUpload):this.formData.documents=this.backupDocuments.concat(this.formData.documents)},saveClick(){!this.formData.isDelete&&this.$refs.receiptImage.files.length==0?this.$toasted.info(this.$t("messages.info.noChangedData")):this.submit.element().click()},onSubmit(){this.$bus.emit("checkPin",async()=>{let t=new FormData;t.append("contractId",this.contract.id),t.append("isDelete",this.formData.isDelete);for(var o=0;o<this.$refs.receiptImage.files.length;o++){let r=await this.$mf.resizeImage({file:this.$refs.receiptImage.files[o],maxSize:this.$mc.MAX_SIZE_IMAGE_UPLOAD});t.append(`receiptImages[${o}]`,r)}this.withdrawnContract(t).then(r=>{r&&this.popup.hide()})})},downloadQR(){let t=document.createElement("a");t.href=this.qrSrc,t.download=`vietQR_${this.contract.code}`,t.click()},initFormData(){this.formData={isPdfPreview:!1,isDelete:!1,documents:[]},this.qrSrc=null},onHiding(){this.initFormData(),this.refreshKey++,this.$mf.popRouteHistoryState()}}},V={class:"amount"},T={class:"text-dark"},B=e("span",{class:"text-dark"},"/",-1),x={class:"text-dark"},U={key:0},A={class:"text-dark"},N={class:"text-dark"},q={class:"way1"},R={class:"description text-darker"},H={class:"method"},L=e("div",{class:"method1"},null,-1),E={class:"method2"},W={class:"text-darker"},z={class:"download way2"},F={class:"upload-browser"},K={for:"receiptImage"},M=e("i",{class:"far fa-file-upload"},null,-1);function O(t,o,r,X,n,i){const h=l("DxButton"),w=l("DxCheckBox"),D=l("DxAccordion"),k=l("DxScrollView"),v=l("DxPopup"),g=l("Pdf");return m(),p("div",null,[c(v,{ref:"popup",showCloseButton:!0,fullScreen:!!t.$screen.getScreenSizeInfo.isXSmall,"show-title":!0,toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.save"),onClick:i.saveClick}},{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:t.$t("buttons.cancel"),onClick:()=>t.$refs.submit.click()}}],wrapperAttr:{class:"confirm-contract-popup"},onHiding:i.onHiding},{content:d(()=>[c(k,null,{default:d(()=>[e("form",{onSubmit:o[7]||(o[7]=y((...s)=>i.onSubmit&&i.onSubmit(...s),["prevent"]))},[c(h,{ref:"submit",class:"display-none",useSubmitBehavior:!0},null,512),e("div",V,[e("div",null,[e("span",T,a(t.$t("components.withdrawnContract.amount")),1),e("b",null,a(n.contract.advance|t.currency),1),B,e("span",x,a(n.contract.total|t.currency),1)]),n.contract.advance<n.contract.total?(m(),p("div",U,[e("span",A,a(t.$t("components.withdrawnContract.surplus")),1),e("span",null,a(n.contract.total-n.contract.advance|t.currency),1),e("span",N,a(t.$t("components.withdrawnContract.newContract")),1)])):f("",!0)]),c(D,{ref:"accordion",collapsible:!0,items:[{title:t.$t("components.withdrawnContract.step1"),template:"step1Template"},{title:t.$t("components.withdrawnContract.step2"),template:"step2Template"}]},{step1Template:d(()=>[c(D,{collapsible:!0,items:[{title:t.$t("components.withdrawnContract.withdrawnWay1"),template:"way1Template"},{title:t.$t("components.withdrawnContract.withdrawnWay2"),template:"way2Template"}]},{way1Template:d(()=>[e("div",q,[e("div",R,a(t.$t("models.contract.transfer.qrCode")),1),e("div",H,[L,e("div",E,[e("div",null,[e("span",null,a(t.$t("models.user.bankName"))+":",1),e("span",null,a(n.contract.bank_account.bank_name),1)]),e("div",null,[e("span",null,a(t.$t("models.user.accountName"))+":",1),e("span",null,a(n.contract.bank_account.account_name),1)]),e("div",null,[e("span",null,a(t.$t("models.user.accountNumber"))+":",1),e("span",null,[u(a(n.contract.bank_account.account_number)+" ",1),e("i",{class:"far fa-copy",onClick:o[0]||(o[0]=s=>t.$mf.copyText(n.contract.bank_account.account_number))})])]),e("div",null,[e("span",null,a(t.$t("models.contract.transfer.amount"))+":",1),e("span",null,[u(a(n.contract.advance|t.currency())+" ",1),e("i",{class:"far fa-copy",onClick:o[1]||(o[1]=s=>t.$mf.copyText(n.contract.advance))})])]),e("div",null,[e("span",null,a(t.$t("models.contract.transfer.content"))+":",1),e("span",null,[u(a(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",n.contract.code))+" ",1),e("i",{class:"far fa-copy",onClick:o[2]||(o[2]=s=>t.$mf.copyText(t.$t("models.contract.transfer.contentValue").replace("{contractCode}",n.contract.code)))})])]),e("div",W,a(t.$t("models.contract.transfer.note")),1)])])])]),way2Template:d(()=>[e("div",z,[c(h,{text:t.$t("buttons.receiptDownload"),icon:"download",type:"default","styling-mode":"contained",onClick:o[3]||(o[3]=()=>t.$refs.pdf.download({component:"WithdrawReceiptPdf",contract:n.contract,isPreview:n.formData.isPdfPreview}))},null,8,["text"]),t.$screen.getScreenSizeInfo.isXSmall?f("",!0):(m(),b(w,{key:0,modelValue:n.formData.isPdfPreview,"onUpdate:modelValue":o[4]||(o[4]=s=>n.formData.isPdfPreview=s),text:t.$t("components.withdrawnContract.preview")},null,8,["modelValue","text"]))])]),_:1},8,["items"])]),step2Template:d(()=>[(m(),p("div",{class:"upload",key:n.refreshKey},[e("div",F,[e("input",{ref:"receiptImage",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:o[5]||(o[5]=(...s)=>i.onUploadImageChange&&i.onUploadImageChange(...s))},null,544),e("label",K,[M,u(" "+a(t.$t("titles.chooseImage")),1)]),c(w,{id:"contractDelete",modelValue:n.formData.isDelete,"onUpdate:modelValue":o[6]||(o[6]=s=>n.formData.isDelete=s),text:t.$t("titles.deleteOldImage"),onValueChanged:i.onCheckBoxDeleteChange},null,8,["modelValue","text","onValueChanged"])])]))]),_:1},8,["items"])],32)]),_:1})]),_:1},8,["fullScreen","toolbarItems","onHiding"]),t.$mf.isSet(n.contract)?(m(),b(g,{key:0,ref:"pdf"},null,512)):f("",!0)])}const Y=C(P,[["render",O]]);export{Y as default};
