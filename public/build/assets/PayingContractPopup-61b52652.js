import{u as O,c as z,i as g,r as h,d as F,e as I,x as H,f as _,n as u,k as m,_ as Q,v as G,o as c,j as d,h as t,t as a,l as w,g as K,P as S,q as p,p as R,s as X}from"./app-5631e8a8.js";import{_ as Z}from"./accordion-3a570b4f.js";import{_ as J}from"./load-indicator-248719c5.js";const W=["onSubmit"],Y={class:"caution"},ee={class:"step1"},te={class:"description text-darker"},oe={class:"method"},ne={class:"method1"},ae={key:0},se={class:"method2"},le={class:"text-darker"},ce={class:"upload"},ie={class:"upload-browser"},re={for:"receiptImage"},ue=t("i",{class:"far fa-file-upload"},null,-1),ve={__name:"PayingContractPopup",setup(me,{expose:V}){const D=O(),{t:f}=z(),q=g("bus"),B=g("mc"),$=g("mf"),i=h(null),y=h(null),k=h(null),o=F({formData:{},contract:{},qrSrc:null});let v=[];const C=I(()=>new Set(o.formData.documents.map(e=>e.file))),s=I(()=>D.state.userContract.transferInfo);H(()=>b());function T(e){i.value.setTitle(f(`components.payingContract.${e.status==0?"title":"changeReceiptTitle"}`)+" #"+e.code),o.contract=e,i.value.show()}function U(){let e=document.createElement("a");e.href=o.qrSrc,e.download=`vietQR_${o.contract.code}`,e.click()}function x(e){o.formData.documents=o.formData.documents.filter(n=>!n.isUpload),[...e.target.files].forEach(n=>o.formData.documents.push({file:URL.createObjectURL(n),isUpload:!0}))}function N(e){e.value?o.formData.documents=o.formData.documents.filter(n=>n.isUpload):o.formData.documents=v.concat(o.formData.documents)}function P(){o.formData.documents.findIndex(e=>e.isUpload)!=-1?k.value.click():G.show(f("messages.info.noUploadImage"))}function E(){q.emit("checkPin",async()=>{let e=new FormData;e.append("contractId",o.contract.id),e.append("isDelete",o.formData.isDelete);for(var n=0;n<receiptImageRef.value.files.length;n++){let l=await $.resizeImage({file:receiptImageRef.value.files[n],maxSize:B.MAX_SIZE_IMAGE_UPLOAD});e.append(`receiptImages[${n}]`,l)}D.dispatch("userContract/payingContract",e).then(l=>{l&&i.value.hide()})})}function b(){o.formData={isDelete:!1,documents:[]},o.qrSrc=null}function j(){setTimeout(()=>y.value.instance.option("selectedIndex",o.contract.status),0),v=o.contract.url_paid_docs.map(n=>({file:n,isUpload:!1})),o.formData.documents=v;let e=`https://img.vietqr.io/image/${s.value.bank_name}-${s.value.account_number}-KRnx1D.jpg?accountName=${s.value.account_name}&amount=${o.contract.principal}&addInfo=${f("models.contract.transfer.contentValue",[o.contract.code])}`;$.fetchImage(e).then(n=>o.qrSrc=n)}function L(){b()}return V({show:T}),(e,n)=>{const l=_("DxButton"),M=_("DxCheckBox"),A=_("DxScrollView");return c(),u(Q,{ref_key:"popupRef",ref:i,class:"paying-contract-popup",toolbarItems:[{toolbar:"bottom",location:"after",widget:"dxButton",options:{text:e.$t(`components.payingContract.${o.contract.status==0?"paidButton":"changeReceiptButton"}`),onClick:P}}],onShown:j,onHidden:L},{default:m(()=>[d(A,null,{default:m(()=>[t("form",{onSubmit:X(E,["prevent"])},[t("button",{ref_key:"submitRef",ref:k,class:"display-none"},null,512),t("div",Y,[t("div",null,a(e.$t("titles.caution"))+":",1),t("div",null,"  - "+a(e.$t("components.payingContract.paidDateCaution")),1),t("div",null,"  - "+a(e.$t("components.payingContract.timeCaution")),1)]),d(w(Z),{ref_key:"accordionRef",ref:y,collapsible:!0,items:[{title:e.$t("components.payingContract.step1"),template:"step1Template"},{title:e.$t("components.payingContract.step2"),template:"step2Template"}]},{step1Template:m(()=>[t("div",ee,[t("div",te,a(e.$t("models.contract.transfer.qrCode")),1),t("div",oe,[t("div",ne,[o.qrSrc?(c(),K("div",ae,[d(S,{images:[o.qrSrc]},null,8,["images"]),d(l,{class:"download-qr",text:e.$t("buttons.qrDownload"),icon:"download",type:"default","styling-mode":"text",onClick:U},null,8,["text"])])):(c(),u(w(J),{key:1,height:40,width:40}))]),t("div",se,[t("div",null,[t("span",null,a(e.$t("models.user.bankName"))+":",1),t("span",null,a(s.value.bank_name),1)]),t("div",null,[t("span",null,a(e.$t("models.user.accountName"))+":",1),t("span",null,a(s.value.account_name),1)]),t("div",null,[t("span",null,a(e.$t("models.user.accountNumber"))+":",1),t("span",null,[p(a(s.value.account_number)+" ",1),t("i",{class:"far fa-copy",onClick:n[0]||(n[0]=r=>e.$mf.copyText(s.value.account_number))})])]),t("div",null,[t("span",null,a(e.$t("models.contract.transfer.amount"))+":",1),t("span",null,[p(a(e.$filters.currency(o.contract.principal))+" ",1),t("i",{class:"far fa-copy",onClick:n[1]||(n[1]=r=>e.$mf.copyText(o.contract.principal))})])]),t("div",null,[t("span",null,a(e.$t("models.contract.transfer.content"))+":",1),t("span",null,[p(a(e.$t("models.contract.transfer.contentValue",[o.contract.code]))+" ",1),t("i",{class:"far fa-copy",onClick:n[2]||(n[2]=r=>e.$mf.copyText(e.$t("models.contract.transfer.contentValue",[o.contract.code])))})])]),t("div",le,a(e.$t("models.contract.transfer.note")),1)])])])]),step2Template:m(()=>[t("div",ce,[t("div",ie,[t("input",{ref:"receiptImageRef",type:"file",id:"receiptImage",multiple:"multiple",accept:"images/*",onChange:x},null,544),t("label",re,[ue,p(" "+a(e.$t("titles.chooseImage")),1)]),o.contract.status==1?(c(),u(M,{key:0,id:"contractDelete",modelValue:o.formData.isDelete,"onUpdate:modelValue":n[3]||(n[3]=r=>o.formData.isDelete=r),text:e.$t("titles.deleteOldImage"),onValueChanged:N},null,8,["modelValue","text"])):R("",!0)]),C.value.length?(c(),u(S,{key:0,images:C.value},null,8,["images"])):R("",!0)])]),_:1},8,["items"])],40,W)]),_:1})]),_:1},8,["toolbarItems"])}}};export{ve as default};
