import{K as lt,L as it,M as ne,N as ae,y as rt,u as at,b as st,c as ut,i as oe,r as D,d as pt,e as ct,x as dt,w as le,g as mt,h as w,B as q,C as ft,j as ie,l as ht,A as gt,E as vt,G as re,o as Ct}from"./app-ceb2964d.js";import{_ as xt}from"./spinner-40be0a1e.js";import yt from"./ColorPicker-cb828343.js";import{c as bt}from"./lightweight-charts.esm.development-03366bac.js";class Ft{constructor(){this.create()}create(){return new Promise((y,b)=>{const P=indexedDB.open("stockChart",1);P.onupgradeneeded=m=>{this.store=m.target.result,this.store.createObjectStore("line",{keyPath:"price"}),this.store.createObjectStore("ruler",{keyPath:"point"}),this.store.createObjectStore("pattern1",{keyPath:"point"}),this.store.createObjectStore("uplps",{keyPath:"title"}),this.store.createObjectStore("downlps",{keyPath:"title"}),y()},P.onsuccess=m=>{this.store=m.target.result,y()},P.onerror=()=>{location.reload(),b()}})}get(y){var b=this.store;return new Promise(function(m,v){var L=b.transaction(y,"readonly");if(Array.isArray(y)){var T=y.map(B=>L.objectStore(B)),k=T.map(P);Promise.all(k).then(B=>m(B))}else{var I=L.objectStore(y);P(I).then(B=>m(B))}});function P(m){return new Promise(function(v,L){const T=m.getAll();T.onsuccess=k=>v(k.target.result),T.onerror=()=>L()})}}set(y,b){const P=this.store.transaction(y,"readwrite").objectStore(y);Array.isArray(b)?b.length>0&&b.forEach(m=>P.put(m)):P.put(b)}clear(y){var b=this.store;return new Promise(function(P,m){const v=b.transaction(y,"readwrite").objectStore(y).clear();v.onsuccess=()=>{P()},v.onerror=L=>{console.error(`Error to empty Object Store: ${y}`),m()}})}}const l=new Ft;var u={};const St=lt(it);/*!
 * devextreme-vue
 * Version: 22.2.6
 * Build date: Tue Apr 18 2023
 *
 * Copyright (c) 2012 - 2023 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */var wt=ne&&ne.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(u,"__esModule",{value:!0});u.DxToolbarItem=u.DxTo=u.DxShow=u.DxPosition=u.DxOptions=u.DxOffset=u.DxMy=u.DxItem=u.DxHide=u.DxFrom=u.DxDropDownOptions=u.DxCollision=u.DxButton=u.DxBoundaryOffset=u.DxAt=u.DxAnimation=u.DxSelectBox=void 0;var Pt=wt(St),Ot=ae,S=ae,se=Ot.createComponent({props:{acceptCustomValue:Boolean,accessKey:String,activeStateEnabled:Boolean,buttons:Array,customItemCreateEvent:String,dataSource:{},deferRendering:Boolean,disabled:Boolean,displayExpr:[Function,String],displayValue:String,dropDownButtonTemplate:{},dropDownOptions:Object,elementAttr:Object,fieldTemplate:{},focusStateEnabled:Boolean,grouped:Boolean,groupTemplate:{},height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,inputAttr:{},isValid:Boolean,items:Array,itemTemplate:{},label:String,labelMode:String,maxLength:[Number,String],minSearchLength:Number,name:String,noDataText:String,onChange:Function,onClosed:Function,onContentReady:Function,onCopy:Function,onCustomItemCreating:Function,onCut:Function,onDisposing:Function,onEnterKey:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onInput:Function,onItemClick:Function,onKeyDown:Function,onKeyUp:Function,onOpened:Function,onOptionChanged:Function,onPaste:Function,onSelectionChanged:Function,onValueChanged:Function,opened:Boolean,openOnFieldClick:Boolean,placeholder:String,readOnly:Boolean,rtlEnabled:Boolean,searchEnabled:Boolean,searchExpr:[Array,Function,String],searchMode:String,searchTimeout:Number,selectedItem:{},showClearButton:Boolean,showDataBeforeSearch:Boolean,showDropDownButton:Boolean,showSelectionControls:Boolean,spellcheck:Boolean,stylingMode:String,tabIndex:Number,text:String,useItemTextAsTitle:Boolean,validationError:{},validationErrors:Array,validationMessageMode:String,validationMessagePosition:String,validationStatus:String,value:{},valueChangeEvent:String,valueExpr:[Function,String],visible:Boolean,width:[Function,Number,String],wrapItemText:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:acceptCustomValue":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:buttons":null,"update:customItemCreateEvent":null,"update:dataSource":null,"update:deferRendering":null,"update:disabled":null,"update:displayExpr":null,"update:displayValue":null,"update:dropDownButtonTemplate":null,"update:dropDownOptions":null,"update:elementAttr":null,"update:fieldTemplate":null,"update:focusStateEnabled":null,"update:grouped":null,"update:groupTemplate":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:inputAttr":null,"update:isValid":null,"update:items":null,"update:itemTemplate":null,"update:label":null,"update:labelMode":null,"update:maxLength":null,"update:minSearchLength":null,"update:name":null,"update:noDataText":null,"update:onChange":null,"update:onClosed":null,"update:onContentReady":null,"update:onCopy":null,"update:onCustomItemCreating":null,"update:onCut":null,"update:onDisposing":null,"update:onEnterKey":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onInput":null,"update:onItemClick":null,"update:onKeyDown":null,"update:onKeyUp":null,"update:onOpened":null,"update:onOptionChanged":null,"update:onPaste":null,"update:onSelectionChanged":null,"update:onValueChanged":null,"update:opened":null,"update:openOnFieldClick":null,"update:placeholder":null,"update:readOnly":null,"update:rtlEnabled":null,"update:searchEnabled":null,"update:searchExpr":null,"update:searchMode":null,"update:searchTimeout":null,"update:selectedItem":null,"update:showClearButton":null,"update:showDataBeforeSearch":null,"update:showDropDownButton":null,"update:showSelectionControls":null,"update:spellcheck":null,"update:stylingMode":null,"update:tabIndex":null,"update:text":null,"update:useItemTextAsTitle":null,"update:validationError":null,"update:validationErrors":null,"update:validationMessageMode":null,"update:validationMessagePosition":null,"update:validationStatus":null,"update:value":null,"update:valueChangeEvent":null,"update:valueExpr":null,"update:visible":null,"update:width":null,"update:wrapItemText":null},model:{prop:"value",event:"update:value"},computed:{instance:function(){return this.$_instance}},beforeCreate:function(){this.$_WidgetClass=Pt.default,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={button:{isCollectionItem:!0,optionName:"buttons"},dropDownOptions:{isCollectionItem:!1,optionName:"dropDownOptions"},item:{isCollectionItem:!0,optionName:"items"}}}});u.DxSelectBox=se;var K=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:hide":null,"update:show":null},props:{hide:[Object,Number,String],show:[Object,Number,String]}});u.DxAnimation=K;K.$_optionName="animation";K.$_expectedChildren={hide:{isCollectionItem:!1,optionName:"hide"},show:{isCollectionItem:!1,optionName:"show"}};var ue=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxAt=ue;ue.$_optionName="at";var pe=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxBoundaryOffset=pe;pe.$_optionName="boundaryOffset";var N=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:location":null,"update:name":null,"update:options":null},props:{location:String,name:String,options:Object}});u.DxButton=N;N.$_optionName="buttons";N.$_isCollectionItem=!0;N.$_expectedChildren={options:{isCollectionItem:!1,optionName:"options"}};var ce=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxCollision=ce;ce.$_optionName="collision";var X=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:animation":null,"update:bindingOptions":null,"update:closeOnOutsideClick":null,"update:container":null,"update:contentTemplate":null,"update:copyRootClassesToWrapper":null,"update:deferRendering":null,"update:disabled":null,"update:dragAndResizeArea":null,"update:dragEnabled":null,"update:dragOutsideBoundary":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:fullScreen":null,"update:height":null,"update:hideOnOutsideClick":null,"update:hideOnParentScroll":null,"update:hint":null,"update:hoverStateEnabled":null,"update:maxHeight":null,"update:maxWidth":null,"update:minHeight":null,"update:minWidth":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onHidden":null,"update:onHiding":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:onResize":null,"update:onResizeEnd":null,"update:onResizeStart":null,"update:onShowing":null,"update:onShown":null,"update:onTitleRendered":null,"update:position":null,"update:resizeEnabled":null,"update:restorePosition":null,"update:rtlEnabled":null,"update:shading":null,"update:shadingColor":null,"update:showCloseButton":null,"update:showTitle":null,"update:tabIndex":null,"update:title":null,"update:titleTemplate":null,"update:toolbarItems":null,"update:visible":null,"update:width":null,"update:wrapperAttr":null},props:{accessKey:String,activeStateEnabled:Boolean,animation:Object,bindingOptions:Object,closeOnOutsideClick:[Boolean,Function],container:{},contentTemplate:{},copyRootClassesToWrapper:Boolean,deferRendering:Boolean,disabled:Boolean,dragAndResizeArea:{},dragEnabled:Boolean,dragOutsideBoundary:Boolean,elementAttr:{},focusStateEnabled:Boolean,fullScreen:Boolean,height:[Function,Number,String],hideOnOutsideClick:[Boolean,Function],hideOnParentScroll:Boolean,hint:String,hoverStateEnabled:Boolean,maxHeight:[Function,Number,String],maxWidth:[Function,Number,String],minHeight:[Function,Number,String],minWidth:[Function,Number,String],onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onHidden:Function,onHiding:Function,onInitialized:Function,onOptionChanged:Function,onResize:Function,onResizeEnd:Function,onResizeStart:Function,onShowing:Function,onShown:Function,onTitleRendered:Function,position:[Function,Object,String],resizeEnabled:Boolean,restorePosition:Boolean,rtlEnabled:Boolean,shading:Boolean,shadingColor:String,showCloseButton:Boolean,showTitle:Boolean,tabIndex:Number,title:String,titleTemplate:{},toolbarItems:Array,visible:Boolean,width:[Function,Number,String],wrapperAttr:{}}});u.DxDropDownOptions=X;X.$_optionName="dropDownOptions";X.$_expectedChildren={animation:{isCollectionItem:!1,optionName:"animation"},position:{isCollectionItem:!1,optionName:"position"},toolbarItem:{isCollectionItem:!0,optionName:"toolbarItems"}};var W=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxFrom=W;W.$_optionName="from";W.$_expectedChildren={position:{isCollectionItem:!1,optionName:"position"}};var Y=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxHide=Y;Y.$_optionName="hide";Y.$_expectedChildren={from:{isCollectionItem:!1,optionName:"from"},to:{isCollectionItem:!1,optionName:"to"}};var H=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:template":null,"update:text":null,"update:visible":null},props:{disabled:Boolean,html:String,template:{},text:String,visible:Boolean}});u.DxItem=H;H.$_optionName="items";H.$_isCollectionItem=!0;var de=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:String,y:String}});u.DxMy=de;de.$_optionName="my";var me=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:x":null,"update:y":null},props:{x:Number,y:Number}});u.DxOffset=me;me.$_optionName="offset";var fe=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:bindingOptions":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:icon":null,"update:onClick":null,"update:onContentReady":null,"update:onDisposing":null,"update:onFocusIn":null,"update:onFocusOut":null,"update:onInitialized":null,"update:onOptionChanged":null,"update:rtlEnabled":null,"update:stylingMode":null,"update:tabIndex":null,"update:template":null,"update:text":null,"update:type":null,"update:useSubmitBehavior":null,"update:validationGroup":null,"update:visible":null,"update:width":null},props:{accessKey:String,activeStateEnabled:Boolean,bindingOptions:Object,disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Function,Number,String],hint:String,hoverStateEnabled:Boolean,icon:String,onClick:Function,onContentReady:Function,onDisposing:Function,onFocusIn:Function,onFocusOut:Function,onInitialized:Function,onOptionChanged:Function,rtlEnabled:Boolean,stylingMode:String,tabIndex:Number,template:{},text:String,type:String,useSubmitBehavior:Boolean,validationGroup:String,visible:Boolean,width:[Function,Number,String]}});u.DxOptions=fe;fe.$_optionName="options";var he=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:at":null,"update:boundary":null,"update:boundaryOffset":null,"update:collision":null,"update:my":null,"update:of":null,"update:offset":null},props:{at:[Object,String],boundary:{},boundaryOffset:[Object,String],collision:[Object,String],my:[Object,String],of:{},offset:[Object,String]}});u.DxPosition=he;he.$_optionName="position";var ge=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:complete":null,"update:delay":null,"update:direction":null,"update:duration":null,"update:easing":null,"update:from":null,"update:staggerDelay":null,"update:start":null,"update:to":null,"update:type":null},props:{complete:Function,delay:Number,direction:String,duration:Number,easing:String,from:Object,staggerDelay:Number,start:Function,to:Object,type:String}});u.DxShow=ge;ge.$_optionName="show";var ve=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:left":null,"update:opacity":null,"update:position":null,"update:scale":null,"update:top":null},props:{left:Number,opacity:Number,position:Object,scale:Number,top:Number}});u.DxTo=ve;ve.$_optionName="to";var U=S.createConfigurationComponent({emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:html":null,"update:locateInMenu":null,"update:location":null,"update:menuItemTemplate":null,"update:options":null,"update:showText":null,"update:template":null,"update:text":null,"update:toolbar":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,html:String,locateInMenu:String,location:String,menuItemTemplate:{},options:{},showText:String,template:{},text:String,toolbar:String,visible:Boolean,widget:String}});u.DxToolbarItem=U;U.$_optionName="toolbarItems";U.$_isCollectionItem=!0;var Dt=u.default=se;const Lt={class:"content-block dx-card responsive-paddings"},Tt={class:"area data-area"},Bt=["title"],_t={class:"area tool-area"},kt=["title"],Et=["title"],At=["title"],Nt=["title"],It=["title"],Rt=["title"],$t=["title"],Mt=["title"],jt=["src"],Vt={__name:"Index",setup(_){const y={localization:{dateFormat:"dd/MM/yyyy",locale:"vi-VN"},rightPriceScale:{visible:!0,scaleMargins:{top:.05,bottom:.4}},leftPriceScale:{visible:!1},layout:{backgroundColor:"#000000",textColor:"#CCCCCC"},grid:{vertLines:{color:"#1B1E27",style:2},horzLines:{color:"#1B1E27",style:2}},crosshair:{mode:0},timeScale:{timeVisible:!1,rightOffset:20,minBarSpacing:.01},watermark:{visible:!0,fontSize:50,horzAlign:"center",vertAlign:"center",color:"rgba(171, 71, 188, 0.2)"}},b=at();st(),ut();const P=oe("devices"),m=oe("mf"),v=D(null),L=D(null),T=D(null),k=D(null),I=D(null),B=D(null),Ce=D(null),A=D(null),R=D(null),$=D(null),M=D(null),j=D(null),xe=D(null);let e={chart:{},series:{},data:{whitespace:[],original:[],price:[],cash:[]},order:{side:0,entry:{},tp:{},sl:{}},lines:[],ruler:{l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},target:{A:{},B:{},C:{},D:{}},pattern1:{A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},pattern2:{O:{}},uplps:{P1:{},P2:{},C1:{},C2:{}},downlps:{P1:{},P2:{},C1:{},C2:{}},box:[],alerts:[],crosshair:{},shark:null,loadWhitespace:!0,interval:null,interval60:null,websocket:null,isAutoOrdering:!1,socketStop:!1,volumeMax:0,socketRefreshTime:moment()};const c=pt({symbol:"VNINDEX",isFullscreen:!1,color:"#F44336",showColorPicker:!1,showTradingView:!1}),ye=ct(()=>`https://chart.vps.com.vn/tv/?symbol=${c.symbol}`);l.create(),dt(()=>{e.chart=bt(L.value,y),v.value.addEventListener("click",Fe),v.value.addEventListener("contextmenu",be),e.chart.subscribeCrosshairMove(Se),e.chart.subscribeCustomPriceLineDragged(we),e.series.cash=e.chart.addLineSeries({priceScaleId:"cash",scaleMargins:{top:.61,bottom:.01},color:"yellow",priceFormat:{minMove:1},lastValueVisible:!1}),e.series.ohlc=e.chart.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{minMove:.01}}),e.series.price=e.chart.addLineSeries({color:"#CCCCCC",priceFormat:{minMove:.01},lastValueVisible:!1,priceLineVisible:!1}),new ResizeObserver(Pe).observe(v.value),document.addEventListener("fullscreenchange",Oe),b.dispatch("tradingStock/getChartData",c.symbol).then(()=>{Le()})}),le(()=>b.state.tradingStock.chartData,Te),le(()=>b.state.tradingStock.isChartLoading,n=>{k.value.style.display=n?"block":"none"});function be(n){n.preventDefault()}function Fe(){A.value.classList.contains("selected")?E():R.value.classList.contains("selected")?$e():$.value.classList.contains("selected")?Ve():M.value.classList.contains("selected")?J():j.value.classList.contains("selected")&&ee()}function Se(n){if(n.time){let t=n.seriesPrices.get(e.series.price);e.crosshair.time=n.time,e.crosshair.price=t}else P.phone||(e.crosshair.time=null,e.crosshair.price=null);n.point!=null&&(e.crosshair.x=n.point.x,e.crosshair.y=n.point.y)}function we(n){let t=n.customPriceLine,i=t.options();i.price=z(i.price);const s=+n.fromPriceString,a=i.price;switch(i.lineType){case"line":l.set("line",{price:s,removed:!0}),l.set("line",i),A.value.classList.remove("selected");break;case"ruler":switch(i.point){case"l0":if(l.set("ruler",i),e.ruler.pointCount==2){const x=+e.ruler.l1.options().title,Qe=+(a-x).toFixed(1);e.ruler.ln1.applyOptions({price:Qe}),l.set("ruler",e.ruler.ln1.options());const et=+(a+x).toFixed(1);e.ruler.l1.applyOptions({price:et}),l.set("ruler",e.ruler.l1.options());const tt=+(a+x*2).toFixed(1);e.ruler.l2.applyOptions({price:tt}),l.set("ruler",e.ruler.l2.options());const nt=+(a+x*3).toFixed(1);e.ruler.l3.applyOptions({price:nt}),l.set("ruler",e.ruler.l3.options());const ot=+(a+x*4).toFixed(1);e.ruler.l4.applyOptions({price:ot}),l.set("ruler",e.ruler.l4.options())}break;case"ln1":const r=+e.ruler.l0.options().price,o=a-r;t.applyOptions({title:o.toFixed(1)}),l.set("ruler",t.options()),e.ruler.l1.applyOptions({title:(-o).toFixed(1),price:+(r-o).toFixed(1)}),l.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(-o*2).toFixed(1),price:+(r-o*2).toFixed(1)}),l.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(-o*3).toFixed(1),price:+(r-o*3).toFixed(1)}),l.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(-o*4).toFixed(1),price:+(r-o*4).toFixed(1)}),l.set("ruler",e.ruler.l4.options());break;case"l1":const p=+e.ruler.l0.options().price,d=a-p;t.applyOptions({title:d.toFixed(1)}),l.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-d).toFixed(1),price:+(p-d).toFixed(1)}),l.set("ruler",e.ruler.ln1.options()),e.ruler.l2.applyOptions({title:(d*2).toFixed(1),price:+(p+d*2).toFixed(1)}),l.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(d*3).toFixed(1),price:+(p+d*3).toFixed(1)}),l.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(d*4).toFixed(1),price:+(p+d*4).toFixed(1)}),l.set("ruler",e.ruler.l4.options());break;case"l2":const C=+e.ruler.l0.options().price,g=a-C;t.applyOptions({title:g.toFixed(1)}),l.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-g*.5).toFixed(1),price:+(C-g*.5).toFixed(1)}),l.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(g*.5).toFixed(1),price:+(C+g*.5).toFixed(1)}),l.set("ruler",e.ruler.l1.options()),e.ruler.l3.applyOptions({title:(g*1.5).toFixed(1),price:+(C+g*1.5).toFixed(1)}),l.set("ruler",e.ruler.l3.options()),e.ruler.l4.applyOptions({title:(g*2).toFixed(1),price:+(C+g*2).toFixed(1)}),l.set("ruler",e.ruler.l4.options());break;case"l3":const F=+e.ruler.l0.options().price,O=a-F;t.applyOptions({title:O.toFixed(1)}),l.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-O/3).toFixed(1),price:+(F-O/3).toFixed(1)}),l.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(O/3).toFixed(1),price:+(F+O/3).toFixed(1)}),l.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(O*2/3).toFixed(1),price:+(F+O*2/3).toFixed(1)}),l.set("ruler",e.ruler.l2.options());break;case"l4":const f=+e.ruler.l0.options().price,h=a-f;t.applyOptions({title:h.toFixed(1)}),l.set("ruler",t.options()),e.ruler.ln1.applyOptions({title:(-h/4).toFixed(1),price:+(f-h/4).toFixed(1)}),l.set("ruler",e.ruler.ln1.options()),e.ruler.l1.applyOptions({title:(h/4).toFixed(1),price:+(f+h/4).toFixed(1)}),l.set("ruler",e.ruler.l1.options()),e.ruler.l2.applyOptions({title:(h/2).toFixed(1),price:+(f+h/2).toFixed(1)}),l.set("ruler",e.ruler.l2.options()),e.ruler.l3.applyOptions({title:(h*3/4).toFixed(1),price:+(f+h*3/4).toFixed(1)}),l.set("ruler",e.ruler.l3.options());break}break;case"pattern1":if(m.isSet(e.pattern1.C)){const r=+e.pattern1.A.options().price,p=+e.pattern1.B.options().price-r;e.pattern1.B.applyOptions({title:p.toFixed(1)}),l.set("pattern1",e.pattern1.B.options()),e.pattern1.C.applyOptions({price:+(r+.5*p).toFixed(1),title:(.5*p).toFixed(1)}),l.set("pattern1",e.pattern1.C.options()),e.pattern1.X1.applyOptions({price:+(r-.375*p).toFixed(1),title:(-.375*p).toFixed(1)}),l.set("pattern1",e.pattern1.X1.options()),e.pattern1.X2.applyOptions({price:+(r-.5*p).toFixed(1),title:(-.5*p).toFixed(1)}),l.set("pattern1",e.pattern1.X2.options()),e.pattern1.Y1.applyOptions({price:+(r-p).toFixed(1),title:-p.toFixed(1)}),l.set("pattern1",e.pattern1.Y1.options()),e.pattern1.Y2.applyOptions({price:+(r-2*p).toFixed(1),title:(-2*p).toFixed(1)}),l.set("pattern1",e.pattern1.Y2.options())}break}}function Pe(){v.value&&(e.chart.resize(v.value.offsetWidth,v.value.offsetHeight),v.value.classList.contains("fullscreen")&&(document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"))}function Oe(){v.value&&(document.fullscreenElement?(c.isFullscreen=!0,v.value.classList.add("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="hidden",document.querySelector(".header-component").style.visibility="hidden",document.querySelector(".sc-launcher").style.visibility="hidden",document.querySelector(".dx-drawer-content").style.transform="unset"):(c.isFullscreen=!1,v.value.classList.remove("fullscreen"),document.querySelector(".dx-drawer-panel-content").style.visibility="unset",document.querySelector(".header-component").style.visibility="unset",document.querySelector(".sc-launcher").style.visibility="unset",document.querySelector(".dx-drawer-content").style.transform="translate(0px, 0px)"))}function De(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()}function Le(){return new Promise(async n=>{(await l.get("line")).forEach(o=>{o.removed||e.lines.push(e.series.price.createPriceLine(o))});const i=await l.get("ruler");i.length>0&&(e.ruler.pointCount=i.length>1?2:1,i.forEach(o=>{e.ruler[o.point]=e.series.price.createPriceLine(o)}));const s=await l.get("pattern1");s.length>0&&s.forEach(o=>{e.pattern1[o.point]=e.series.price.createPriceLine(o)});const a=await l.get("uplps");a.length>0&&a.forEach(o=>{e.uplps[o.title]=e.series[o.title.includes("P")?"price":"cash"].createPriceLine(o)});const r=await l.get("downlps");r.length>0&&r.forEach(o=>{e.downlps[o.title]=e.series[o.title.includes("P")?"price":"cash"].createPriceLine(o)}),n()})}function Te(){e.data=b.state.tradingStock.chartData,e.series.ohlc.setData(e.data.ohlc),e.series.price.setData(e.data.price),e.series.cash.setData(e.data.cash),e.chart.applyOptions({watermark:{text:c.symbol}}),T.value.blur()}function Be(n){c.showTradingView=!c.showTradingView,n.stopPropagation()}function _e(n){c.showColorPicker=!c.showColorPicker,n.stopPropagation()}function ke(n){m.isSet(e.pattern1.X)&&(E(+e.pattern1.X.options().price),E(+e.pattern1.Y.options().price),E(+e.pattern1.Z.options().price),E(+e.pattern1.T.options().price)),n.preventDefault(),n.stopPropagation()}function Ee(n){c.showColorPicker=!1;const t=n.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),t||n.target.classList.add("selected"),n.stopPropagation()}function Ae(n){Ne(),n.target.classList.remove("selected"),n.preventDefault(),n.stopPropagation()}function E(n=null,t=!1,i=!1){const s="line";n||(n=z(V(e.crosshair.y)));const a=e.lines.length;if(e.lines=e.lines.filter(r=>{const o=r.options(),p=o.type=n==+o.price;return p&&(e.series.price.removePriceLine(r),l.set("line",{price:n,removed:!0})),!p}),e.lines.length==a&&!i||t){const r={lineType:s,price:n,color:c.color,lineWidth:1,lineStyle:1,draggable:!0};e.lines.push(e.series.price.createPriceLine(r)),l.set("line",r)}A.value.classList.remove("selected")}function Ne(){e.lines.forEach(n=>e.series.price.removePriceLine(n)),e.lines=[],l.clear("line")}function Ie(n){c.showColorPicker=!1;const t=n.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),t||(n.target.classList.add("selected"),G()),n.stopPropagation()}function Re(n){G(),n.target.classList.remove("selected"),n.preventDefault(),n.stopPropagation()}function $e(){const n=V(e.crosshair.y);let t={lineType:"ruler",price:n,lineWidth:1,lineStyle:1,draggable:!0};if(e.ruler.pointCount==0)t.point="l0",t.color="#F44336",t.title="0",e.ruler[t.point]=e.series.price.createPriceLine(t),e.ruler.pointCount++,l.set("ruler",t);else{const i=+e.ruler.l0.options().price,s=n-i;t.point="l1",t.color="#FF9800",t.title=s.toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),l.set("ruler",t);const a=-s;t.point="ln1",t.color="#FF9800",t.title=a.toFixed(1),t.price=+(i+a).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),l.set("ruler",t);const r=2*s;t.point="l2",t.color="#FFEB3B",t.title=r.toFixed(1),t.price=+(i+r).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),l.set("ruler",t);const o=3*s;t.point="l3",t.color="#4CAF50",t.title=o.toFixed(1),t.price=+(i+o).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),l.set("ruler",t);const p=4*s;t.point="l4",t.color="#009688",t.title=p.toFixed(1),t.price=+(i+p).toFixed(1),e.ruler[t.point]=e.series.price.createPriceLine(t),l.set("ruler",t),e.ruler.pointCount++,R.value.classList.remove("selected")}}function G(){e.ruler.pointCount>0&&(e.series.price.removePriceLine(e.ruler.l0),e.ruler.pointCount>1&&(e.series.price.removePriceLine(e.ruler.ln1),e.series.price.removePriceLine(e.ruler.l1),e.series.price.removePriceLine(e.ruler.l2),e.series.price.removePriceLine(e.ruler.l3),e.series.price.removePriceLine(e.ruler.l4)),e.ruler={l0:{},ln1:{},l1:{},l2:{},l3:{},l4:{},pointCount:0},l.clear("ruler"))}function Me(n){c.showColorPicker=!1;const t=n.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),t||(n.target.classList.add("selected"),Z()),n.stopPropagation()}function je(n){Z(),n.target.classList.remove("selected"),n.preventDefault(),n.stopPropagation()}function Ve(){const n=V(e.crosshair.y);let t={lineType:"pattern1",price:n,lineWidth:1,lineStyle:1,draggable:!0};if(m.isSet(e.pattern1.A)){const i=+e.pattern1.A.options().price,s=n-i;t.point="B",t.title=s.toFixed(1),t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),t.point="C",t.price=+(i+.5*s).toFixed(1),t.title=(.5*s).toFixed(1),t.color="#FF9800",t.draggable=!1,e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),t.point="X1",t.price=+(i-.375*s).toFixed(1),t.title=(-.375*s).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),t.point="X2",t.price=+(i-.5*s).toFixed(1),t.title=(-.5*s).toFixed(1),t.color="#2196F3",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),t.point="Y1",t.price=+(i-s).toFixed(1),t.title=-s.toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),t.point="Y2",t.price=+(i-2*s).toFixed(1),t.title=(-2*s).toFixed(1),t.color="#673AB7",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t),$.value.classList.remove("selected")}else t.point="A",t.title="0",t.color="#FF9800",e.pattern1[t.point]=e.series.price.createPriceLine(t),l.set("pattern1",t)}function Z(){m.isSet(e.pattern1.A)&&(e.series.price.removePriceLine(e.pattern1.A),m.isSet(e.pattern1.B)&&(e.series.price.removePriceLine(e.pattern1.B),e.series.price.removePriceLine(e.pattern1.C),e.series.price.removePriceLine(e.pattern1.X1),e.series.price.removePriceLine(e.pattern1.X2),e.series.price.removePriceLine(e.pattern1.Y1),e.series.price.removePriceLine(e.pattern1.Y2)),e.pattern1={A:{},B:{},C:{},X1:{},X2:{},Y1:{},Y2:{}},l.clear("pattern1"))}function ze(n){c.showColorPicker=!1;const t=n.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),t?J():n.target.classList.add("selected"),n.stopPropagation()}function qe(n){Q(),n.target.classList.remove("selected"),n.preventDefault(),n.stopPropagation()}function J(){let n,t;m.isSet(e.uplps.P1)?(n=+e.uplps.P1.options().startTime,t=e.crosshair.time,Q()):n=e.crosshair.time;const{price1:i,price2:s,cash1:a,cash2:r}=Ke(n,t);let o={lineWidth:1,lineStyle:1,color:"#009688",draggable:!1};o.startTime=n,o.price=i,o.title="P1",e.uplps[o.title]=e.series.price.createPriceLine(o),l.set("uplps",o),o.price=s,o.title="P2",e.uplps[o.title]=e.series.price.createPriceLine(o),l.set("uplps",o),o.price=a,o.title="C1",e.uplps[o.title]=e.series.cash.createPriceLine(o),l.set("uplps",o),o.price=r,o.title="C2",e.uplps[o.title]=e.series.cash.createPriceLine(o),l.set("uplps",o),M.value.classList.remove("selected")}function Ke(n,t){let i,s,a,r=0,o=0,p,d,C=0,g=0;for(let F=0;F<e.data.price.length;F++){const O=e.data.price[F].time;if(O<n)continue;if(t&&O>t)break;const f=e.data.price[F].value,h=e.data.cash[F].value;if(i==null&&(i=f,s=f,a=f,p=h,d=h),f>a)r>o&&(s=a,o=r),a=f,r=0;else if(f<a){const x=+(a-f).toFixed(1);x>r&&(r=x)}if(f<i&&o>0)break;if(h>d)C>g&&(p=d,g=C),d=h,C=0;else if(h<d){const x=+(d-h).toFixed(1);x>C&&(C=x)}}return{price1:+(s-o).toFixed(2),price2:+(a-o).toFixed(2),cash1:+(p-g).toFixed(0),cash2:+(d-g).toFixed(0)}}function Q(){m.isSet(e.uplps.P1)&&(e.series.price.removePriceLine(e.uplps.P1),e.series.price.removePriceLine(e.uplps.P2)),m.isSet(e.uplps.C1)&&(e.series.cash.removePriceLine(e.uplps.C1),e.series.cash.removePriceLine(e.uplps.C2)),e.uplps={P1:{},P2:{},C1:{},C2:{}},l.clear("uplps")}function Xe(n){c.showColorPicker=!1;const t=n.target.classList.contains("selected");document.querySelectorAll(".tool-area > .command").forEach(i=>i.classList.remove("selected")),t?ee():n.target.classList.add("selected"),n.stopPropagation()}function We(n){te(),n.target.classList.remove("selected"),n.preventDefault(),n.stopPropagation()}function ee(){let n,t;m.isSet(e.downlps.P1)?(n=+e.downlps.P1.options().startTime,t=e.crosshair.time,te()):n=e.crosshair.time;const{price1:i,price2:s,cash1:a,cash2:r}=Ye(n,t);let o={lineWidth:1,lineStyle:1,color:"#E91E63",draggable:!1};o.startTime=n,o.price=i,o.title="P1",e.downlps[o.title]=e.series.price.createPriceLine(o),l.set("downlps",o),o.price=s,o.title="P2",e.downlps[o.title]=e.series.price.createPriceLine(o),l.set("downlps",o),o.price=a,o.title="C1",e.downlps[o.title]=e.series.cash.createPriceLine(o),l.set("downlps",o),o.price=r,o.title="C2",e.downlps[o.title]=e.series.cash.createPriceLine(o),l.set("downlps",o),j.value.classList.remove("selected")}function Ye(n,t){let i,s,a,r=0,o=0,p,d,C=0,g=0;for(let F=0;F<e.data.price.length;F++){const O=e.data.price[F].time;if(O<n)continue;if(t&&O>t)break;const f=e.data.price[F].value,h=e.data.cash[F].value;if(i==null&&(i=f,s=f,a=f,p=h,d=h),f<a)r<o&&(s=a,o=r),a=f,r=0;else if(f>a){const x=+(a-f).toFixed(1);x<r&&(r=x)}if(f>i&&o<0)break;if(h<d)C<g&&(p=d,g=C),d=h,C=0;else if(h>d){const x=+(d-h).toFixed(1);x<C&&(C=x)}}return{price1:+(s-o).toFixed(1),price2:+(a-o).toFixed(1),cash1:+(p-g).toFixed(1),cash2:+(d-g).toFixed(1)}}function te(){m.isSet(e.downlps.P1)&&(e.series.price.removePriceLine(e.downlps.P1),e.series.price.removePriceLine(e.downlps.P2)),m.isSet(e.downlps.C1)&&(e.series.cash.removePriceLine(e.downlps.C1),e.series.cash.removePriceLine(e.downlps.C2)),e.downlps={P1:{},P2:{},C1:{},C2:{}},l.clear("downlps")}function V(n,t="price"){return z(e.series[t].coordinateToPrice(n))}function z(n){return n?+ +n.toFixed(1):0}function He(n){if(c.symbol=="")return!1;c.symbol=c.symbol.toUpperCase(),b.dispatch("tradingStock/getChartData",c.symbol)}function Ue(n){n.target.select()}function Ge(){console.log("optionChanged")}function Ze(){console.log("keyDown")}function Je(){console.log("keyUp")}return(n,t)=>(Ct(),mt("div",Lt,[w("div",{class:"stock-container",ref_key:"chartContainerRef",ref:v},[w("div",{class:"chart-wrapper",ref_key:"chartRef",ref:L},[w("div",Tt,[q(w("input",{ref_key:"symbolRef",ref:T,type:"text",class:"command symbol-input",title:n.$t("trading.stock.symbol"),"onUpdate:modelValue":t[0]||(t[0]=i=>c.symbol=i),onChange:He,onFocus:Ue},null,40,Bt),[[ft,c.symbol]]),ie(ht(Dt),{"data-source":["AAA","BBB","CCC"],"input-attr":{class:"command"},value:"AAA",onOptionChanged:Ge,onKeyUp:Je,onKeyDown:Ze}),w("img",{ref_key:"spinnerRef",ref:k,class:"command spinner",src:xt},null,512)]),w("div",_t,[w("div",{ref_key:"fullscreenToolRef",ref:I,class:gt(`command far fa-${c.isFullscreen?"compress":"expand"}`),title:n.$t("trading.orderChart.fullscreen"),onClick:De},null,10,kt),w("div",{ref_key:"tradingviewRef",ref:B,class:"command far fa-chart-bar",title:n.$t("trading.orderChart.tradingview"),onClick:Be},null,8,Et),w("div",{ref_key:"colorToolRef",ref:Ce,class:"color command far fa-palette",style:vt({color:c.color}),title:n.$t("trading.orderChart.colorTool"),onClick:_e,onContextmenu:ke},[q(ie(yt,{class:"color-picker",modelValue:c.color,"onUpdate:modelValue":t[1]||(t[1]=i=>c.color=i)},null,8,["modelValue"]),[[re,c.showColorPicker]])],44,At),w("div",{ref_key:"lineToolRef",ref:A,class:"command far fa-horizontal-rule",title:n.$t("trading.orderChart.lineTool"),onClick:Ee,onContextmenu:Ae},null,40,Nt),w("div",{ref_key:"pattern1ToolRef",ref:$,class:"command far fa-dot-circle",title:n.$t("trading.orderChart.pattern1Tool"),onClick:Me,onContextmenu:je},null,40,It),w("div",{ref_key:"uplpsToolRef",ref:M,class:"command far fa-arrow-up",title:n.$t("trading.orderChart.uplpsTool"),onClick:ze,onContextmenu:qe},null,40,Rt),w("div",{ref_key:"downlpsToolRef",ref:j,class:"command far fa-arrow-down",title:n.$t("trading.orderChart.downlpsTool"),onClick:Xe,onContextmenu:We},null,40,$t),w("div",{ref_key:"rulerToolRef",ref:R,class:"command far fa-line-height",title:n.$t("trading.orderChart.rulerTool"),onClick:Ie,onContextmenu:Re},null,40,Mt)]),q(w("iframe",{ref_key:"tradingviewChartRef",ref:xe,class:"tradingview-chart",src:ye.value},null,8,jt),[[re,c.showTradingView]])],512)],512)]))}},Wt=rt(Vt,[["__scopeId","data-v-0ebaddbf"]]);export{Wt as default};
